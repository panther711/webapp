!function(s){function e(e){for(var t,n,a=e[0],o=e[1],r=0,i=[];r<a.length;r++)n=a[r],Object.prototype.hasOwnProperty.call(l,n)&&l[n]&&i.push(l[n][0]),l[n]=0;for(t in o)Object.prototype.hasOwnProperty.call(o,t)&&(s[t]=o[t]);for(u&&u(e);i.length;)i.shift()()}var n={},l={0:0};function c(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,c),t.l=!0,t.exports}c.e=function(o){var e=[],n=l[o];if(0!==n)if(n)e.push(n[2]);else{var t=new Promise(function(e,t){n=l[o]=[e,t]});e.push(n[2]=t);var a,r=document.createElement("script");r.charset="utf-8",r.timeout=120,c.nc&&r.setAttribute("nonce",c.nc),r.src=function(e){return c.p+""+({}[e]||e)+".prod.js"}(o);var i=new Error;a=function(e){r.onerror=r.onload=null,clearTimeout(s);var t=l[o];if(0!==t){if(t){var n=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src;i.message="Loading chunk "+o+" failed.\n("+n+": "+a+")",i.name="ChunkLoadError",i.type=n,i.request=a,t[1](i)}l[o]=void 0}};var s=setTimeout(function(){a({type:"timeout",target:r})},12e4);r.onerror=r.onload=a,document.head.appendChild(r)}return Promise.all(e)},c.m=s,c.c=n,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(n,a,function(e){return t[e]}.bind(null,a));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/umd/",c.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],a=t.push.bind(t);t.push=e,t=t.slice();for(var o=0;o<t.length;o++)e(t[o]);var u=a;c(c.s=8)}([function(e,t){e.exports=React},function(e,t){e.exports=ReactIntl},function(e,t,n){(function(t){e.exports=function(){var e=function(t){var n;return function(e){return n||t(n={exports:{},parent:e},n.exports),n.exports}},y=e(function(e,t){e.exports={version:"0.16.1"}}),_=e(function(e,t){"use strict";var p=[{name:"ST",start:/(?:^|[\W_])(\*)[^\s*]/,end:/[^\s*](\*)(?=$|[\W_])/},{name:"EM",start:/(?:^|\W)(_)[^\s_]/,end:/[^\s_](_)(?=$|\W)/},{name:"DL",start:/(?:^|[\W_])(~)[^\s~]/,end:/[^\s~](~)(?=$|[\W_])/},{name:"CO",start:/(?:^|\W)(`)[^`]/,end:/[^`](`)(?=$|\W)/}],h=[{name:"LN",dataName:"url",pack:function(e){return/^[a-z]+:\/\//i.test(e)||(e="http://"+e),{url:e}},re:/(?:(?:https?|ftp):\/\/|www\.|ftp\.)[-A-Z0-9+&@#\/%=~_|$?!:,.]*[A-Z0-9+&@#\/%=~_|$]/gi},{name:"MN",dataName:"val",pack:function(e){return{val:e.slice(1)}},re:/\B@(\w\w+)/g},{name:"HT",dataName:"val",pack:function(e){return{val:e.slice(1)}},re:/\B#(\w\w+)/g}],f={ST:{name:"b",isVoid:!1},EM:{name:"i",isVoid:!1},DL:{name:"del",isVoid:!1},CO:{name:"tt",isVoid:!1},BR:{name:"br",isVoid:!0},LN:{name:"a",isVoid:!1},MN:{name:"a",isVoid:!1},HT:{name:"a",isVoid:!1},IM:{name:"img",isVoid:!0},FM:{name:"div",isVoid:!1},RW:{name:"div",isVoid:!1},BN:{name:"button",isVoid:!1},HD:{name:"",isVoid:!1}};function a(e,t){var n;try{for(var a=(n=atob(e)).length,o=new ArrayBuffer(a),r=new Uint8Array(o),i=0;i<a;i++)r[i]=n.charCodeAt(i);return URL.createObjectURL(new Blob([o],{type:t}))}catch(e){console.log("Drafty: failed to convert object.",e.message)}return null}var m={ST:{open:function(){return"<b>"},close:function(){return"</b>"}},EM:{open:function(){return"<i>"},close:function(){return"</i>"}},DL:{open:function(){return"<del>"},close:function(){return"</del>"}},CO:{open:function(){return"<tt>"},close:function(){return"</tt>"}},BR:{open:function(){return"<br/>"},close:function(){return""}},HD:{open:function(){return""},close:function(){return""}},LN:{open:function(e){return'<a href="'+e.url+'">'},close:function(e){return"</a>"},props:function(e){return e?{href:e.url,target:"_blank"}:null}},MN:{open:function(e){return'<a href="#'+e.val+'">'},close:function(e){return"</a>"},props:function(e){return e?{name:e.val}:null}},HT:{open:function(e){return'<a href="#'+e.val+'">'},close:function(e){return"</a>"},props:function(e){return e?{name:e.val}:null}},BN:{open:function(e){return"<button>"},close:function(e){return"</button>"},props:function(e){return e?{"data-act":e.act,"data-val":e.val,"data-name":e.name,"data-ref":e.ref}:null}},IM:{open:function(e){var t=a(e.val,e.mime),n=e.ref?e.ref:t;return(e.name?'<a href="'+n+'" download="'+e.name+'">':"")+'<img src="'+t+'"'+(e.width?' width="'+e.width+'"':"")+(e.height?' height="'+e.height+'"':"")+' border="0" />'},close:function(e){return e.name?"</a>":""},props:function(e){return e?{src:a(e.val,e.mime),title:e.name,"data-width":e.width,"data-height":e.height,"data-name":e.name,"data-size":e.val?.75*e.val.length|0:0,"data-mime":e.mime}:null}},FM:{open:function(e){return"<div>"},close:function(e){return"</div>"}},RW:{open:function(e){return"<div>"},close:function(e){return"</div>"}}},l=function(){};l.parse=function(e){if("string"!=typeof e)return null;var t=e.split(/\r?\n/),c=[],u={},d=[];t.map(function(t){var e,n,a=[];if(p.map(function(e){a=a.concat(function(e,t,n,a){for(var o=[],r=0,i=e.slice(0);0<i.length;){var s=t.exec(i);if(null==s)break;var l=s.index+s[0].lastIndexOf(s[1]);i=i.slice(l+1),r=(l+=r)+1;var c=n?n.exec(i):null;if(null==c)break;var u=c.index+c[0].indexOf(c[1]);i=i.slice(u+1),r=(u+=r)+1,o.push({text:e.slice(l+1,u),children:[],start:l,end:u,type:a})}return o}(t,e.start,e.end,e.name))}),0==a.length)n={txt:t};else{a.sort(function(e,t){return e.start-t.start}),a=function e(t){if(0==t.length)return[];for(var n=[t[0]],a=t[0],o=1;o<t.length;o++)t[o].start>a.end?(n.push(t[o]),a=t[o]):t[o].end<a.end&&a.children.push(t[o]);for(var o in n)n[o].children=e(n[o].children);return n}(a);var o=function e(t,n){var a="",o=[];for(var r in t){var i=t[r];if(!i.text){var s=e(i.children,a.length+n);i.text=s.txt,o=o.concat(s.fmt)}i.type&&o.push({at:a.length+n,len:i.text.length,tp:i.type}),a+=i.text}return{txt:a,fmt:o}}(function e(t,n,a,o){var r=[];if(0==o.length)return[];for(var i in o){var s=o[i];s.start>n&&r.push({text:t.slice(n,s.start)});var l={type:s.type},c=e(t,s.start+1,s.end,s.children);0<c.length?l.children=c:l.text=s.text,r.push(l),n=s.end+1}return n<a&&r.push({text:t.slice(n,a)}),r}(t,0,t.length,a),0);n={txt:o.txt,fmt:o.fmt}}if(0<(e=function(t){var n,a=[];if(h.map(function(e){for(;null!==(n=e.re.exec(t));)a.push({offset:n.index,len:n[0].length,unique:n[0],data:e.pack(n[0]),type:e.name})}),0==a.length)return a;a.sort(function(e,t){return e.offset-t.offset});var o=-1;return a=a.filter(function(e){var t=e.offset>o;return o=e.offset+e.len,t})}(n.txt)).length){var r=[];for(var i in e){var s=e[i],l=u[s.unique];l||(l=c.length,u[s.unique]=l,c.push({tp:s.type,data:s.data})),r.push({at:s.offset,len:s.len,key:l})}n.ent=r}d.push(n)});var n={txt:""};if(0<d.length){n.txt=d[0].txt,n.fmt=(d[0].fmt||[]).concat(d[0].ent||[]);for(var a=1;a<d.length;a++){var o=d[a],r=n.txt.length+1;n.fmt.push({tp:"BR",len:1,at:r-1}),n.txt+=" "+o.txt,o.fmt&&(n.fmt=n.fmt.concat(o.fmt.map(function(e){return e.at+=r,e}))),o.ent&&(n.fmt=n.fmt.concat(o.ent.map(function(e){return e.at+=r,e})))}0==n.fmt.length&&delete n.fmt,0<c.length&&(n.ent=c)}return n},l.insertImage=function(e,t,n,a,o,r,i,s,l){return(e=e||{txt:" "}).ent=e.ent||[],e.fmt=e.fmt||[],e.fmt.push({at:t,len:1,key:e.ent.length}),e.ent.push({tp:"IM",data:{mime:n,val:a,width:o,height:r,name:i,ref:l,size:0|s}}),e},l.appendImage=function(e,t,n,a,o,r,i,s){return(e=e||{txt:""}).txt+=" ",l.insertImage(e,e.txt.length-1,t,n,a,o,r,i,s)},l.attachFile=function(e,t,n,a,o,r){(e=e||{txt:""}).ent=e.ent||[],e.fmt=e.fmt||[],e.fmt.push({at:-1,len:0,key:e.ent.length});var i={tp:"EX",data:{mime:t,val:n,name:a,ref:r,size:0|o}};return r instanceof Promise&&(i.data.ref=r.then(function(e){i.data.ref=e},function(e){})),e.ent.push(i),e},l.wrapAsForm=function(e,t,n){return"string"==typeof e&&(e={txt:e}),e.fmt=e.fmt||[],e.fmt.push({at:t,len:n,tp:"FM"}),e},l.insertButton=function(e,t,n,a,o,r,i){return"string"==typeof e&&(e={txt:e}),!e||!e.txt||e.txt.length<t+n?null:n<=0||-1==["url","pub"].indexOf(o)?null:"url"!=o||i?(i=""+i,e.ent=e.ent||[],e.fmt=e.fmt||[],e.fmt.push({at:t,len:n,key:e.ent.length}),e.ent.push({tp:"BN",data:{act:o,val:r,ref:i,name:a}}),e):null},l.appendButton=function(e,t,n,a,o,r){var i=(e=e||{txt:""}).txt.length;return e.txt+=t,l.insertButton(e,i,t.length,n,a,o,r)},l.attachJSON=function(e,t){return(e=e||{txt:""}).ent=e.ent||[],e.fmt=e.fmt||[],e.fmt.push({at:-1,len:0,key:e.ent.length}),e.ent.push({tp:"EX",data:{mime:"application/json",val:t}}),e},l.appendLineBreak=function(e){return(e=e||{txt:""}).fmt=e.fmt||[],e.fmt.push({at:e.txt.length,len:1,tp:"BR"}),e.txt+=" ",e},l.UNSAFE_toHTML=function(e){var t,n,a,o=e.txt,r=e.fmt,i=e.ent,s=[];if(r)for(var l in r){var c=r[l],u=c.tp,d=void 0;if(!u){var p=i[0|c.key];p&&(u=p.tp,d=p.data)}m[u]&&(s.push({idx:c.at+c.len,len:-c.len,what:m[u].close(d)}),s.push({idx:c.at,len:c.len,what:m[u].open(d)}))}for(var h in s.sort(function(e,t){return t.idx==e.idx?t.len-e.len:t.idx-e.idx}),s)s[h].what&&(t=o,n=s[h].idx,a=s[h].what,o=t.slice(0,n)+a+t.slice(n));return o},l.format=function(e,t,n){var a=e.txt,o=e.fmt,r=e.ent;if(a=a||"",Array.isArray(r)||(r=[]),!Array.isArray(o)){if(1!=r.length)return[a];o=[{at:0,len:0,key:0}]}var i=[].concat(o);return i.map(function(e){e.at=e.at||0,e.len=e.len||0,e.len<0&&(e.len=0),e.at<-1&&(e.at=-1)}),i.sort(function(e,t){return e.at-t.at==0?t.len-e.len:e.at-t.at}),i=i.map(function(e){var t,n=e.tp;return n||(e.key=e.key||0,r[e.key]&&(t=r[e.key].data,n=r[e.key].tp)),{tp:n=n||"HD",data:t,at:e.at,len:e.len}}),function e(t,n,a,o,r,i){for(var s=[],l=0;l<o.length;l++){var c=o[l];if(!(c.at<0)){n<c.at&&(s.push(r.call(i,null,void 0,t.slice(n,c.at),s.length)),n=c.at);for(var u=[],d=l+1;d<o.length&&o[d].at<c.at+c.len;d++)u.push(o[d]),l=d;var p=f[c.tp]||{};s.push(r.call(i,c.tp,c.data,p.isVoid?null:e(t,n,c.at+c.len,u,r,i),s.length)),n=c.at+c.len}}return n<a&&s.push(r.call(i,null,void 0,t.slice(n,a),s.length)),s}(a,0,a.length,i,t,n)},l.toPlainText=function(e){return"string"==typeof e?e:e.txt},l.isPlainText=function(e){return"string"==typeof e||!(e.fmt||e.ent)},l.hasAttachments=function(e){if(e.ent&&0<e.ent.length)for(var t in e.ent)if(e.ent[t]&&"EX"==e.ent[t].tp)return!0;return!1},l.attachments=function(e,t,n){if(e.ent&&0<e.ent.length)for(var a in e.ent)e.ent[a]&&"EX"==e.ent[a].tp&&t.call(n,e.ent[a].data,a)},l.getDownloadUrl=function(e){var t=null;return"application/json"!=e.mime&&e.val?t=a(e.val,e.mime):"string"==typeof e.ref&&(t=e.ref),t},l.isUploading=function(e){return e.ref instanceof Promise},l.getPreviewUrl=function(e){return e.val?a(e.val,e.mime):null},l.getEntitySize=function(e){return e.size?e.size:e.val?.75*e.val.length|0:0},l.getEntityMimeType=function(e){return e.mime||"text/plain"},l.tagName=function(e){return f[e]?f[e].name:void 0},l.attrValue=function(e,t){if(t&&m[e])return m[e].props(t)},l.getContentType=function(){return"text/x-drafty"},void 0!==e&&(e.exports=l)}),P={exports:{}};return function(e){"use strict";function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if(void 0===r)var r=_({});var E,t=y({}).version;"undefined"!=typeof WebSocket&&(E=WebSocket),"undefined"==typeof btoa&&(e.btoa=function(){for(var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n="",a=0,o=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.charAt(0|o)||(r="=",o%1);n+=r.charAt(63&a>>8-o%1*8)){if(255<(e=t.charCodeAt(o+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");a=a<<8|e}return n}),"undefined"==typeof atob&&(e.atob=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").replace(/=+$/,""),t="";if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,a=0,o=0,r=0;n=e.charAt(r++);~n&&(o=a%4?64*o+n:n,a++%4)&&(t+=String.fromCharCode(255&o>>(-2*a&6))))n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return t}),"undefined"==typeof window&&(e.window={WebSocket:E,URL:{createObjectURL:function(){throw new Error("Unable to use window.URL in a non browser application")}}});var u="0",h=t||"0.15",f="tinodejs/"+h,S="Connection failed",C="Disconnected by client";function o(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function m(e,t,n){if("object"!=w(t)){if(t===l.DEL_CHAR)return;return void 0===t?e:t}if(null===t)return t;if(t instanceof Date)return e&&e instanceof Date&&!(e<t)?e:t;if(t instanceof c)return new c(t);if(t instanceof Array)return t;for(var a in e&&e!==l.DEL_CHAR||(e=t.constructor()),t)!t.hasOwnProperty(a)||n&&n[a]||"_noForwarding"==a||(e[a]=m(e[a],t[a]));return e}function s(e,t,n,a){return e[t]=m(e[t],n,a),e[t]}function k(){var e=null;if("withCredentials"in new XMLHttpRequest)e=new XMLHttpRequest;else{if("undefined"==typeof XDomainRequest)throw new Error("Browser not supported");e=new XDomainRequest}return e}function M(e,t){if("ts"===e&&"string"==typeof t&&20<=t.length&&t.length<=24){var n=new Date(t);if(n)return n}else if("acs"===e&&"object"===w(t))return new c(t);return t}function g(e,t){return"string"==typeof t&&128<t.length?"<"+t.length+", bytes: "+t.substring(0,12)+"..."+t.substring(t.length-12)+">":function(e,t){if(t instanceof Date)t=function(e){if(e&&0!=e.getTime()){var t=e.getUTCMilliseconds();return e.getUTCFullYear()+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())+"T"+n(e.getUTCHours())+":"+n(e.getUTCMinutes())+":"+n(e.getUTCSeconds())+(t?"."+n(t,3):"")+"Z"}function n(e,t){return"0".repeat((t=t||2)-(""+e).length)+e}}(t);else if(null==t||!1===t||Array.isArray(t)&&0==t.length||"object"==w(t)&&0==Object.keys(t).length)return;return t}(0,t)}function T(e,t,n){var a=null;return"http"!==t&&"https"!==t&&"ws"!==t&&"wss"!==t||(a=t+"://","/"!==(a+=e).charAt(a.length-1)&&(a+="/"),a+="v"+u+"/channels","http"!==t&&"https"!==t||(a+="/lp"),a+="?apikey="+n),a}var b=function(e,t,n,a,o){var r=this,i=e,s=a,l=t,p=o,c=2e3,u=10,d=.3,h=null,f=0,m=!1,g=function(e){r.logger&&r.logger(e)};function b(){var t=this;clearTimeout(h);var n=c*(Math.pow(2,f)*(1+d*Math.random()));f=u<=f?f:f+1,this.onAutoreconnectIteration&&this.onAutoreconnectIteration(n),h=setTimeout(function(){if(g("Reconnecting, iter="+f+", timeout="+n),m)t.onAutoreconnectIteration&&t.onAutoreconnectIteration(-1);else{var e=t.connect();t.onAutoreconnectIteration?t.onAutoreconnectIteration(0,e):e.catch(function(){})}},n)}function v(){clearTimeout(h),h=null,f=0}function y(o){var r=null;o.connect=function(e){return m=!1,r&&r.readyState==r.OPEN?Promise.resolve():(e&&(i=e),new Promise(function(t,n){var e=T(i,s?"wss":"ws",l);g("Connecting to: "+e);var a=new E(e);a.onopen=function(e){o.onOpen&&o.onOpen(),t(),p&&v()},a.onclose=function(e){if(r=null,o.onDisconnect){var t=m?418:503;o.onDisconnect(new Error(m?C:S+" ("+t+")"),t)}!m&&p&&b.call(o)},a.onerror=function(e){n(e)},a.onmessage=function(e){o.onMessage&&o.onMessage(e.data)},r=a}))},o.reconnect=function(){v(),o.connect()},o.disconnect=function(){m=!0,r&&(v(),r.close(),r=null)},o.sendText=function(e){if(!r||r.readyState!=r.OPEN)throw new Error("Websocket is not connected");r.send(e)},o.isConnected=function(){return r&&r.readyState==r.OPEN},o.transport=function(){return"ws"},o.probe=function(){o.sendText("1")}}function _(u){var d=null,a=null,o=null;u.connect=function(e){return m=!1,a?Promise.resolve():(e&&(i=e),new Promise(function(e,t){var n=T(i,s?"https":"http",l);g("Connecting to: "+n),(a=function o(r,i,s){var l=k(),c=!1;return l.onreadystatechange=function(e){if(4==l.readyState)if(201==l.status){var t=JSON.parse(l.responseText,M);d=r+"&sid="+t.ctrl.params.sid,(l=o(d)).send(null),u.onOpen&&u.onOpen(),i&&(c=!0,i()),p&&v()}else if(l.status<400)u.onMessage&&u.onMessage(l.responseText),(l=o(d)).send(null);else{if(s&&!c&&(c=!0,s(l.responseText)),u.onMessage&&l.responseText&&u.onMessage(l.responseText),u.onDisconnect){var n=l.status||(m?418:503),a=l.responseText||(m?C:S);u.onDisconnect(new Error(a+" ("+n+")"),n)}l=null,!m&&p&&b.call(u)}},l.open("GET",r,!0),l}(n,e,t)).send(null)}).catch(function(){}))},u.reconnect=function(){v(),u.connect()},u.disconnect=function(){m=!0,v(),o&&(o.onreadystatechange=void 0,o.abort(),o=null),a&&(a.onreadystatechange=void 0,a.abort(),a=null),u.onDisconnect&&u.onDisconnect(new Error(C+" (418)"),418),d=null},u.sendText=function(e){var t,n;if(t=d,(n=k()).onreadystatechange=function(e){if(4==n.readyState&&400<=n.status)throw new Error("LP sender failed, "+n.status)},n.open("POST",t,!0),!(o=n)||1!=o.readyState)throw new Error("Long poller failed to connect");o.send(e)},u.isConnected=function(){return a&&!0},u.transport=function(){return"lp"},u.probe=function(){u.sendText("1")}}"lp"===n?_(this):"ws"===n?y(this):"object"==("undefined"==typeof window?"undefined":w(window))&&window.WebSocket?y(this):_(this),this.onMessage=void 0,this.onDisconnect=void 0,this.onOpen=void 0,this.onAutoreconnectIteration=void 0,this.logger=void 0},l=function(e,t,n,a,o,r){var i=this;this._appName=e||"Undefined",this._apiKey=n,this._browser="",this._platform=r,this._hwos="undefined",this._humanLanguage="xx","undefined"!=typeof navigator&&(this._browser=function(e,t){e=e||"";var n="";/reactnative/i.test(t)&&(n="ReactNative; ");var a,o=(e=e.replace(" (KHTML, like Gecko)","")).match(/(AppleWebKit\/[.\d]+)/i);if(o){for(var r=["chrome","safari","mobile","version"],i=e.substr(o.index+o[0].length).split(" "),s=[],l=function(e){var t=/([\w.]+)[\/]([\.\d]+)/.exec(i[e]);t&&s.push([t[1],t[2],r.findIndex(function(e){return e==t[1].toLowerCase()})])},c=0;c<i.length;c++)l(c);s.sort(function(e,t){var n=e[2]-t[2];return 0!=n?n:t[0].length-e[0].length}),a=0<s.length?s[0][0]+"/"+s[0][1]:o[1]}else a=/trident/i.test(e)?(o=/(?:\brv[ :]+([.\d]+))|(?:\bMSIE ([.\d]+))/g.exec(e))?"MSIE/"+(o[1]||o[2]):"MSIE/?":/firefox/i.test(e)?(o=/Firefox\/([.\d]+)/g.exec(e))?"Firefox/"+o[1]:"Firefox/?":/presto/i.test(e)?(o=/Opera\/([.\d]+)/g.exec(e))?"Opera/"+o[1]:"Opera/?":(o=/([\w.]+)\/([.\d]+)/.exec(e))?o[1]+"/"+o[2]:(o=e.split(" "))[0];if(1<(o=a.split("/")).length){var u=o[1].split(".");a=o[0]+"/"+u[0]+(u[1]?"."+u[1]:"")}return n+a}(navigator.userAgent,navigator.product),this._hwos=navigator.platform,this._humanLanguage=navigator.language||"en-US"),this._loggingEnabled=!1,this._trimLongStrings=!1,this._myUID=null,this._authenticated=!1,this._login=null,this._authToken=null,this._inPacketCount=0,this._messageId=Math.floor(65535*Math.random()+65535),this._serverInfo=null,this._deviceToken=null,this._pendingPromises={},this._connection=new b(t,n,a,o,!0),this.logger=function(e){if(i._loggingEnabled){var t=new Date,n=("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)+":"+("0"+t.getUTCMilliseconds()).slice(-3);console.log("["+n+"] "+e)}},this._connection.logger=this.logger,this._cache={};var s=this.cachePut=function(e,t,n){i._cache[e+":"+t]=n},l=this.cacheGet=function(e,t){return i._cache[e+":"+t]},c=this.cacheDel=function(e,t){delete i._cache[e+":"+t]},u=this.cacheMap=function(e,t){for(var n in i._cache)if(e(i._cache[n],n,t))break};this.attachCacheToTopic=function(e){e._tinode=i,e._cacheGetUser=function(e){var t=l("user",e);if(t)return{user:e,public:m({},t)}},e._cachePutUser=function(e,t){return s("user",e,m({},t.public))},e._cacheDelUser=function(e){return c("user",e)},e._cachePutSelf=function(){return s("topic",e.name,e)},e._cacheDelSelf=function(){return c("topic",e.name)}};var d=function(e,t,n,a){var o=i._pendingPromises[e];o&&(delete i._pendingPromises[e],200<=t&&t<400?o.resolve&&o.resolve(n):o.reject&&o.reject(new Error(a+" ("+t+")")))},p=(setInterval(function(){var e=new Error("Timeout (504)"),t=new Date((new Date).getTime()-5e3);for(var n in i._pendingPromises){var a=i._pendingPromises[n];a&&a.ts<t&&(console.log("expiring promise",n),delete i._pendingPromises[n],a.reject&&a.reject(e))}},1e3),this.getNextUniqueId=function(){return 0!=i._messageId?""+i._messageId++:void 0});this.initPacket=function(e,t){switch(e){case"hi":return{hi:{id:p(),ver:h,ua:i._appName+" ("+(i._browser?i._browser+"; ":"")+i._hwos+"); "+f,dev:i._deviceToken,lang:i._humanLanguage,platf:i._platform}};case"acc":return{acc:{id:p(),user:null,scheme:null,secret:null,login:!1,tags:null,desc:{},cred:{}}};case"login":return{login:{id:p(),scheme:null,secret:null}};case"sub":return{sub:{id:p(),topic:t,set:{},get:{}}};case"leave":return{leave:{id:p(),topic:t,unsub:!1}};case"pub":return{pub:{id:p(),topic:t,noecho:!1,head:null,content:{}}};case"get":return{get:{id:p(),topic:t,what:null,desc:{},sub:{},data:{}}};case"set":return{set:{id:p(),topic:t,desc:{},sub:{},tags:[]}};case"del":return{del:{id:p(),topic:t,what:null,delseq:null,user:null,hard:!1}};case"note":return{note:{topic:t,what:null,seq:void 0}};default:throw new Error("Unknown packet type requested: "+e)}},this.send=function(e,t){var n;t&&(n=function(n){var e=null;return n&&(e=new Promise(function(e,t){i._pendingPromises[n]={resolve:e,reject:t,ts:new Date}})),e}(t)),e=function t(n){return Object.keys(n).forEach(function(e){"_"==e[0]?delete n[e]:n[e]?Array.isArray(n[e])&&0==n[e].length?delete n[e]:n[e]?"object"!=w(n[e])||n[e]instanceof Date||(t(n[e]),0==Object.getOwnPropertyNames(n[e]).length&&delete n[e]):delete n[e]:delete n[e]}),n}(e);var a=JSON.stringify(e);i.logger("out: "+(i._trimLongStrings?JSON.stringify(e,g):a));try{i._connection.sendText(a)}catch(e){if(!t)throw e;d(t,503,null,e.message)}return n},this.loginSuccessful=function(e){e.params&&e.params.user&&(i._myUID=e.params.user,i._authenticated=e&&200<=e.code&&e.code<300,e.params&&e.params.token&&e.params.expires?i._authToken={token:e.params.token,expires:new Date(e.params.expires)}:i._authToken=null,i.onLogin&&i.onLogin(e.code,e.text))},this._connection.onMessage=function(e){if(e)if(i._inPacketCount++,i.onRawMessage&&i.onRawMessage(e),"0"!==e){var o=JSON.parse(e,M);o?(i.logger("in: "+(i._trimLongStrings?JSON.stringify(o,g):e)),i.onMessage&&i.onMessage(o),o.ctrl?(i.onCtrlMessage&&i.onCtrlMessage(o.ctrl),o.ctrl.id&&d(o.ctrl.id,o.ctrl.code,o.ctrl,o.ctrl.text),setTimeout(function(){if(205==o.ctrl.code&&"evicted"==o.ctrl.text){var e=l("topic",o.ctrl.topic);e&&e._resetSub()}else if(o.ctrl.params&&"data"==o.ctrl.params.what){var t=l("topic",o.ctrl.topic);t&&t._allMessagesReceived(o.ctrl.params.count)}else if(o.ctrl.params&&"sub"==o.ctrl.params.what){var n=l("topic",o.ctrl.topic);n&&n._processMetaSub([])}},0)):setTimeout(function(){if(o.meta){var e=l("topic",o.meta.topic);e&&e._routeMeta(o.meta),o.meta.id&&d(o.meta.id,200,o.meta,"META"),i.onMetaMessage&&i.onMetaMessage(o.meta)}else if(o.data){var t=l("topic",o.data.topic);t&&t._routeData(o.data),i.onDataMessage&&i.onDataMessage(o.data)}else if(o.pres){var n=l("topic",o.pres.topic);n&&n._routePres(o.pres),i.onPresMessage&&i.onPresMessage(o.pres)}else if(o.info){var a=l("topic",o.info.topic);a&&a._routeInfo(o.info),i.onInfoMessage&&i.onInfoMessage(o.info)}else i.logger("ERROR: Unknown packet received.")},0)):(i.logger("in: "+e),i.logger("ERROR: failed to parse data"))}else i.onNetworkProbe&&i.onNetworkProbe()},this._connection.onOpen=function(){i.hello()},this._connection.onAutoreconnectIteration=function(e,t){i.onAutoreconnectIteration&&i.onAutoreconnectIteration(e,t)},this._connection.onDisconnect=function(e,t){for(var n in i._inPacketCount=0,i._serverInfo=null,i._authenticated=!1,u(function(e,t){0===t.lastIndexOf("topic:",0)&&e._resetSub()}),i._pendingPromises){var a=i._pendingPromises[n];a&&a.reject&&a.reject(e)}i._pendingPromises={},i.onDisconnect&&i.onDisconnect(e)}};l.credential=function(e,t,n,a){if("object"==w(e)){var o=e;t=o.val,n=o.params,a=o.resp,e=o.meth}return e&&(t||a)?[{meth:e,val:t,resp:a,params:n}]:null},l.topicType=function(e){return{me:"me",fnd:"fnd",grp:"grp",new:"grp",usr:"p2p"}["string"==typeof e?e.substring(0,3):"xxx"]},l.isNewGroupTopicName=function(e){return"string"==typeof e&&"new"==e.substring(0,3)},l.getVersion=function(){return h},l.setWebSocketProvider=function(e){E=e},l.getLibrary=function(){return f},l.MESSAGE_STATUS_NONE=0,l.MESSAGE_STATUS_QUEUED=1,l.MESSAGE_STATUS_SENDING=2,l.MESSAGE_STATUS_FAILED=3,l.MESSAGE_STATUS_SENT=4,l.MESSAGE_STATUS_RECEIVED=5,l.MESSAGE_STATUS_READ=6,l.MESSAGE_STATUS_TO_ME=7,l.DEL_CHAR="␡",l.prototype={connect:function(e){return this._connection.connect(e)},reconnect:function(){this._connection.reconnect()},disconnect:function(){this._connection.disconnect()},networkProbe:function(){this._connection.probe()},isConnected:function(){return this._connection.isConnected()},isAuthenticated:function(){return this._authenticated},account:function(e,t,n,a,o){var r=this.initPacket("acc");return r.acc.user=e,r.acc.scheme=t,r.acc.secret=n,r.acc.login=a,o&&(r.acc.desc.defacs=o.defacs,r.acc.desc.public=o.public,r.acc.desc.private=o.private,r.acc.tags=o.tags,r.acc.cred=o.cred,r.acc.token=o.token),this.send(r,r.acc.id)},createAccount:function(e,t,n,a){var o=this,r=this.account("new",e,t,n,a);return n&&(r=r.then(function(e){return o.loginSuccessful(e),e})),r},createAccountBasic:function(e,t,n){return e=e||"",t=t||"",this.createAccount("basic",o(e+":"+t),!0,n)},updateAccountBasic:function(e,t,n,a){return t=t||"",n=n||"",this.account(e,"basic",o(t+":"+n),!1,a)},hello:function(){var t=this,e=this.initPacket("hi");return this.send(e,e.hi.id).then(function(e){return e.params&&(t._serverInfo=e.params),t.onConnect&&t.onConnect(),e}).catch(function(e){t.onDisconnect&&t.onDisconnect(e)})},setDeviceToken:function(e,t){var n=!1;return e&&e!=this._deviceToken&&(this._deviceToken=e,t&&this.isConnected()&&this.isAuthenticated()&&(this.send({hi:{dev:e}}),n=!0)),n},login:function(e,t,n){var a=this,o=this.initPacket("login");return o.login.scheme=e,o.login.secret=t,o.login.cred=n,this.send(o,o.login.id).then(function(e){return a.loginSuccessful(e),e})},loginBasic:function(t,e,n){var a=this;return this.login("basic",o(t+":"+e),n).then(function(e){return a._login=t,e})},loginToken:function(e,t){return this.login("token",e,t)},requestResetAuthSecret:function(e,t,n){return this.login("reset",o(e+":"+t+":"+n))},getAuthToken:function(){return this._authToken&&this._authToken.expires.getTime()>Date.now()?this._authToken:this._authToken=null},setAuthToken:function(e){this._authToken=e},subscribe:function(e,t,n){var a=this.initPacket("sub",e);return e=e||"new",a.sub.get=t,n&&(n.sub&&(a.sub.set.sub=n.sub),n.desc&&(l.isNewGroupTopicName(e)?a.sub.set.desc=n.desc:"p2p"==l.topicType(e)&&n.desc.defacs&&(a.sub.set.desc={defacs:n.desc.defacs})),n.tags&&(a.sub.set.tags=n.tags)),this.send(a,a.sub.id)},leave:function(e,t){var n=this.initPacket("leave",e);return n.leave.unsub=t,this.send(n,n.leave.id)},createMessage:function(e,t,n){var a=this.initPacket("pub",e),o="string"==typeof t?r.parse(t):t;return o&&!r.isPlainText(o)&&(a.pub.head={mime:r.getContentType()},t=o),a.pub.noecho=n,a.pub.content=t,a.pub},publish:function(e,t,n){return this.publishMessage(this.createMessage(e,t,n))},publishMessage:function(e){return(e=Object.assign({},e)).seq=void 0,e.from=void 0,e.ts=void 0,this.send({pub:e},e.id)},getMeta:function(e,t){var n=this.initPacket("get",e);return n.get=m(n.get,t),this.send(n,n.get.id)},setMeta:function(e,t){var n=this.initPacket("set",e),a=[];return t&&["desc","sub","tags","cred"].map(function(e){t.hasOwnProperty(e)&&(a.push(e),n.set[e]=t[e])}),0==a.length?Promise.reject(new Error("Invalid {set} parameters")):this.send(n,n.set.id)},delMessages:function(e,t,n){var a=this.initPacket("del",e);return a.del.what="msg",a.del.delseq=t,a.del.hard=n,this.send(a,a.del.id)},delTopic:function(t){var n=this,e=this.initPacket("del",t);return e.del.what="topic",this.send(e,e.del.id).then(function(e){return n.cacheDel("topic",t),n.ctrl})},delSubscription:function(e,t){var n=this.initPacket("del",e);return n.del.what="sub",n.del.user=t,this.send(n,n.del.id)},delCredential:function(e,t,n){if("me"!=e)throw new Error("Invalid topic for deleting credentials '"+e+"'");var a=this.initPacket("del",e);return a.del.what="cred",a.del.cred={meth:t,val:n},this.send(a,a.del.id)},note:function(e,t,n){if(n<=0||268435455<=n)throw new Error("Invalid message id "+n);var a=this.initPacket("note",e);a.note.what=t,a.note.seq=n,this.send(a)},noteKeyPress:function(e){var t=this.initPacket("note",e);t.note.what="kp",this.send(t)},getTopic:function(e){var t=this.cacheGet("topic",e);return!t&&e&&(t="me"==e?new i:"fnd"==e?new d:new a(e),this.cachePut("topic",e,t),this.attachCacheToTopic(t)),t},newTopic:function(e){var t=new a("new",e);return this.attachCacheToTopic(t),t},newGroupTopicName:function(){return"new"+this.getNextUniqueId()},newTopicWith:function(e,t){var n=new a(e,t);return this.attachCacheToTopic(n),n},getMeTopic:function(){return this.getTopic("me")},getFndTopic:function(){return this.getTopic("fnd")},getLargeFileHelper:function(){return new p(this)},getCurrentUserID:function(){return this._myUID},isMe:function(e){return this._myUID===e},getCurrentLogin:function(){return this._login},getServerInfo:function(){return this._serverInfo},enableLogging:function(e,t){this._loggingEnabled=e,this._trimLongStrings=e&&t},isTopicOnline:function(e){var t=this.getMeTopic(),n=t&&t.getContact(e);return n&&n.online},wantAkn:function(e){this._messageId=e?Math.floor(16777215*Math.random()+16777215):0},onWebsocketOpen:void 0,onConnect:void 0,onDisconnect:void 0,onLogin:void 0,onCtrlMessage:void 0,onDataMessage:void 0,onPresMessage:void 0,onMessage:void 0,onRawMessage:void 0,onNetworkProbe:void 0,onAutoreconnectIteration:void 0};var n=function(e){var t=(this.topic=e)._tinode.getMeTopic();this.contact=t&&t.getContact(e.name),this.what={}};n.prototype={_get_ims:function(){var e=this.contact&&this.contact.updated,t=this.topic._lastDescUpdate||0;return t<e?e:t},withData:function(e,t,n){return this.what.data={since:e,before:t,limit:n},this},withLaterData:function(e){return this.withData(0<this.topic._maxSeq?this.topic._maxSeq+1:void 0,void 0,e)},withEarlierData:function(e){return this.withData(void 0,0<this.topic._minSeq?this.topic._minSeq:void 0,e)},withDesc:function(e){return this.what.desc={ims:e},this},withLaterDesc:function(){return this.withDesc(this._get_ims())},withSub:function(e,t,n){var a={ims:e,limit:t};return"me"==this.topic.getType()?a.topic=n:a.user=n,this.what.sub=a,this},withOneSub:function(e,t){return this.withSub(e,void 0,t)},withLaterOneSub:function(e){return this.withOneSub(this.topic._lastSubsUpdate,e)},withLaterSub:function(e){return this.withSub("p2p"==this.topic.getType()?this._get_ims():this.topic._lastSubsUpdate,e)},withTags:function(){return this.what.tags=!0,this},withCred:function(){return"me"==this.topic.getType()?this.what.cred=!0:console.log("Invalid topic type for MetaGetBuilder:withCreds",this.topic.getType()),this},withDel:function(e,t){return(e||t)&&(this.what.del={since:e,limit:t}),this},withLaterDel:function(e){return this.withDel(0<this.topic._maxSeq?this.topic._maxDel+1:void 0,e)},build:function(){var t=[],n=this,a={};return["data","sub","desc","tags","cred","del"].map(function(e){n.what.hasOwnProperty(e)&&(t.push(e),0<Object.getOwnPropertyNames(n.what[e]).length&&(a[e]=n.what[e]))}),0<t.length?a.what=t.join(" "):a=void 0,a}};var c=function e(t){t&&(this.given="number"==typeof t.given?t.given:e.decode(t.given),this.want="number"==typeof t.want?t.want:e.decode(t.want),this.mode=t.mode?"number"==typeof t.mode?t.mode:e.decode(t.mode):this.given&this.want)};c._NONE=0,c._JOIN=1,c._READ=2,c._WRITE=4,c._PRES=8,c._APPROVE=16,c._SHARE=32,c._DELETE=64,c._OWNER=128,c._BITMASK=c._JOIN|c._READ|c._WRITE|c._PRES|c._APPROVE|c._SHARE|c._DELETE|c._OWNER,c._INVALID=1048576,c._checkFlag=function(e,t,n){if(["given","want","mode"].includes(t=t||"mode"))return 0!=(e[t]&n);throw new Error("Invalid AccessMode component '"+t+"'")},c.decode=function(e){if(!e)return null;if("number"==typeof e)return e&c._BITMASK;if("N"===e||"n"===e)return c._NONE;for(var t={J:c._JOIN,R:c._READ,W:c._WRITE,P:c._PRES,A:c._APPROVE,S:c._SHARE,D:c._DELETE,O:c._OWNER},n=c._NONE,a=0;a<e.length;a++){var o=t[e.charAt(a).toUpperCase()];o&&(n|=o)}return n},c.encode=function(e){if(null===e||e===c._INVALID)return null;if(e===c._NONE)return"N";for(var t=["J","R","W","P","A","S","D","O"],n="",a=0;a<t.length;a++)0!=(e&1<<a)&&(n+=t[a]);return n},c.update=function(e,t){if(!t||"string"!=typeof t)return e;var n=t.charAt(0);if("+"==n||"-"==n){for(var a=e,o=t.split(/([-+])/),r=1;r<o.length-1;r+=2){n=o[r];var i=c.decode(o[r+1]);if(i==c._INVALID)return e;null!=i&&("+"===n?a|=i:"-"===n&&(a&=~i))}e=a}else{var s=c.decode(t);s!=c._INVALID&&(e=s)}return e},c.prototype={toString:function(){return'{mode: "'+c.encode(this.mode)+'", given: "'+c.encode(this.given)+'", want: "'+c.encode(this.want)+'"}'},setMode:function(e){return this.mode=c.decode(e),this},updateMode:function(e){return this.mode=c.update(this.mode,e),this},getMode:function(){return c.encode(this.mode)},setGiven:function(e){return this.given=c.decode(e),this},updateGiven:function(e){return this.given=c.update(this.given,e),this},getGiven:function(){return c.encode(this.given)},setWant:function(e){return this.want=c.decode(e),this},updateWant:function(e){return this.want=c.update(this.want,e),this},getWant:function(){return c.encode(this.want)},getMissing:function(){return c.encode(this.want&~this.given)},getExcessive:function(){return c.encode(this.given&~this.want)},updateAll:function(e){return e&&(this.updateGiven(e.given),this.updateWant(e.want),this.mode=this.given&this.want),this},isOwner:function(e){return c._checkFlag(this,e,c._OWNER)},isPresencer:function(e){return c._checkFlag(this,e,c._PRES)},isMuted:function(e){return!this.isPresencer(e)},isJoiner:function(e){return c._checkFlag(this,e,c._JOIN)},isReader:function(e){return c._checkFlag(this,e,c._READ)},isWriter:function(e){return c._checkFlag(this,e,c._WRITE)},isApprover:function(e){return c._checkFlag(this,e,c._APPROVE)},isAdmin:function(e){return this.isOwner(e)||this.isApprover(e)},isSharer:function(e){return this.isAdmin(e)||c._checkFlag(this,e,c._SHARE)},isDeleter:function(e){return c._checkFlag(this,e,c._DELETE)}};var a=function(e,t){this._tinode=null,this.name=e,this.created=null,this.updated=null,this.touched=null,this.acs=new c(null),this.private=null,this.public=null,this._users={},this._queuedSeqId=268435455,this._maxSeq=0,this._minSeq=0,this._noEarlierMsgs=!1,this._maxDel=0,this._tags=[],this._credentials=[],this._messages=function(l){var r=[];function o(e,t,n){for(var a=0,o=t.length-1,r=0,i=0,s=!1;a<=o;)if((i=l(t[r=(a+o)/2|0],e))<0)a=r+1;else{if(!(0<i)){s=!0;break}o=r-1}return s?r:n?-1:i<0?r+1:r}return l=l||function(e,t){return e===t?0:e<t?-1:1},{getAt:function(e){return r[e]},put:function(){var e,t,n;for(var a in e=1==arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments)t=e[a],(n=r).splice(o(t,n,!1),0,t)},delAt:function(e){var t=r.splice(e,1);if(t&&0<t.length)return t[0]},delRange:function(e,t){return r.splice(e,t-e)},size:function(){return r.length},reset:function(e){r=[]},forEach:function(e,t,n,a){t|=0,n=n||r.length;for(var o=t;o<n;o++)e.call(a,r[o],o)},find:function(e,t){return o(e,r,!t)}}}(function(e,t){return e.seq-t.seq}),this._subscribed=!1,this._lastDescUpdate=null,this._lastSubsUpdate=null,this._new=!0,t&&(this.onData=t.onData,this.onMeta=t.onMeta,this.onPres=t.onPres,this.onInfo=t.onInfo,this.onMetaDesc=t.onMetaDesc,this.onMetaSub=t.onMetaSub,this.onSubsUpdated=t.onSubsUpdated,this.onTagsUpdated=t.onTagsUpdated,this.onCredsUpdated=callbacls.onCredsUpdated,this.onDeleteTopic=t.onDeleteTopic,this.onAllMessagesReceived=t.onAllMessagesReceived)};a.prototype={isSubscribed:function(){return this._subscribed},subscribe:function(e,n){var a=this;return this._subscribed?Promise.resolve(this):this._tinode.subscribe(this.name||"new",e,n).then(function(e){if(300<=e.code)return e;if(a._subscribed=!0,a.acs=e.params&&e.params.acs?e.params.acs:a.acs,a._new){if(a._new=!1,a.name=e.topic,a.created=e.ts,a.updated=e.ts,a._cachePutSelf(),"me"!=a.name&&"fnd"!=a.name){var t=a._tinode.getMeTopic();t&&t._processMetaSub([{_noForwarding:!0,topic:a.name,created:e.ts,updated:e.ts,acs:a.acs}])}n&&n.desc&&(n.desc._noForwarding=!0,a._processMetaDesc(n.desc))}return e})},createMessage:function(e,t){return this._tinode.createMessage(this.name,e,t)},publish:function(e,t){return this.publishMessage(this.createMessage(e,t))},publishMessage:function(t){var n=this;if(!this._subscribed)return Promise.reject(new Error("Cannot publish on inactive topic"));if(r.hasAttachments(t.content)&&!t.head.attachments){var a=[];r.attachments(t.content,function(e){a.push(e.ref)}),t.head.attachments=a}return t._sending=!0,t._failed=!1,this._tinode.publishMessage(t).then(function(e){return t._sending=!1,t.seq=e.params.seq,t.ts=e.ts,n._routeData(t),e}).catch(function(e){console.log("Message rejected by the server",e),t._sending=!1,t._failed=!0,n.onData&&n.onData()})},publishDraft:function(t,e){var n=this;if(!e&&!this._subscribed)return Promise.reject(new Error("Cannot publish on inactive topic"));var a=t.seq||this._getQueuedSeqId();return t._noForwarding||(t._noForwarding=!0,t.seq=a,t.ts=new Date,t.from=this._tinode.getCurrentUserID(),t.noecho=!0,this._messages.put(t),this.onData&&this.onData(t)),(e||Promise.resolve()).then(function(){return t._cancelled?{code:300,text:"cancelled"}:n.publishMessage(t)},function(e){console.log("Message draft rejected by the server",e),t._sending=!1,t._failed=!0,n._messages.delAt(n._messages.find(t)),n.onData&&n.onData()})},leave:function(t){var n=this;return this._subscribed||t?this._tinode.leave(this.name,t).then(function(e){return n._resetSub(),t&&n._gone(),e}):Promise.reject(new Error("Cannot leave inactive topic"))},getMeta:function(e){return this._tinode.getMeta(this.name,e)},getMessagesPage:function(e,t){var n=this,a=this.startMetaQuery();t?a.withLaterData(e):a.withEarlierData(e);var o=this.getMeta(a.build());return t||(o=o.then(function(e){e&&e.params&&!e.params.count&&(n._noEarlierMsgs=!0)})),o},setMeta:function(t){var n=this;return t.tags&&(t.tags=function(e){var t=[];if(Array.isArray(e)){for(var n=0,a=e.length;n<a;n++){var o=e[n];o&&1<(o=o.trim().toLowerCase()).length&&t.push(o)}t.sort().filter(function(e,t,n){return!t||e!=n[t-1]})}return 0==t.length&&t.push(l.DEL_CHAR),t}(t.tags)),this._tinode.setMeta(this.name,t).then(function(e){return e&&300<=e.code||(t.sub&&(e.params&&e.params.acs&&(t.sub.acs=e.params.acs,t.sub.updated=e.ts),t.sub.user||(t.sub.user=n._tinode.getCurrentUserID(),t.desc||(t.desc={})),t.sub._noForwarding=!0,n._processMetaSub([t.sub])),t.desc&&(e.params&&e.params.acs&&(t.desc.acs=e.params.acs,t.desc.updated=e.ts),n._processMetaDesc(t.desc)),t.tags&&n._processMetaTags(t.tags),t.cred&&n._processMetaCreds([t.cred],!0)),e})},invite:function(e,t){return this.setMeta({sub:{user:e,mode:t}})},archive:function(e){return this.private&&this.private.arch==e?Promise.resolve(e):this.setMeta({desc:{private:{arch:!!e||l.DEL_CHAR}}})},delMessages:function(t,e){var n=this;if(!this._subscribed)return Promise.reject(new Error("Cannot delete messages in inactive topic"));t.sort(function(e,t){return e.low<t.low||e.low==t.low&&(!t.hi||e.hi>=t.hi)});var a=t.reduce(function(e,t){return t.low<268435455&&(!t.hi||t.hi<268435455?e.push(t):e.push({low:t.low,hi:n._maxSeq+1})),e},[]);return(0<a.length?this._tinode.delMessages(this.name,a,e):Promise.resolve({params:{del:0}})).then(function(e){return e.params.del>n._maxDel&&(n._maxDel=e.params.del),t.map(function(e){e.hi?n.flushMessageRange(e.low,e.hi):n.flushMessage(e.low)}),n.onData&&n.onData(),e})},delMessagesAll:function(e){return this.delMessages([{low:1,hi:this._maxSeq+1,_all:!0}],e)},delMessagesList:function(e,t){e.sort(function(e,t){return e-t});var n=e.reduce(function(e,t){if(0==e.length)e.push({low:t});else{var n=e[e.length-1];!n.hi&&t!=n.low+1||t>n.hi?e.push({low:t}):n.hi=n.hi?Math.max(n.hi,t+1):t+1}return e},[]);return this.delMessages(n,t)},delTopic:function(){var t=this;return this._tinode.delTopic(this.name).then(function(e){return t._resetSub(),t._gone(),e})},delSubscription:function(t){var n=this;return this._subscribed?this._tinode.delSubscription(this.name,t).then(function(e){return delete n._users[t],n.onSubsUpdated&&n.onSubsUpdated(Object.keys(n._users)),e}):Promise.reject(new Error("Cannot delete subscription in inactive topic"))},note:function(e,t){var n=this._users[this._tinode.getCurrentUserID()];n?(!n[e]||n[e]<t)&&(this._subscribed?this._tinode.note(this.name,e,t):this._tinode.logger("Not sending {note} on inactive topic"),n[e]=t):this._tinode.logger("note(): user not found "+this._tinode.getCurrentUserID());var a=this._tinode.getMeTopic();a&&a.setMsgReadRecv(this.name,e,t)},noteRecv:function(e){this.note("recv",e)},noteRead:function(e){this.note("read",e)},noteKeyPress:function(){this._subscribed?this._tinode.noteKeyPress(this.name):this._tinode.logger("Cannot send notification in inactive topic")},userDesc:function(e){var t=this._cacheGetUser(e);if(t)return t},p2pPeerDesc:function(){if("p2p"==this.getType())return this._users[this.name]},subscribers:function(e,t){var n=e||this.onMetaSub;if(n)for(var a in this._users)n.call(t,this._users[a],a,this._users)},tags:function(){return this._tags.slice(0)},subscriber:function(e){return this._users[e]},messages:function(e,t,n,a){var o=e||this.onData;if(o){var r="number"==typeof t?this._messages.find({seq:t}):void 0,i="number"==typeof n?this._messages.find({seq:n},!0):void 0;-1!=r&&-1!=i&&this._messages.forEach(o,r,i,a)}},queuedMessages:function(e,t){if(!e)throw new Error("Callback must be provided");this.messages(e,268435455,void 0,t)},msgReceiptCount:function(e,t){var n=0;if(0<t){var a=this._tinode.getCurrentUserID();for(var o in this._users){var r=this._users[o];r.user!==a&&r[e]>=t&&n++}}return n},msgReadCount:function(e){return this.msgReceiptCount("read",e)},msgRecvCount:function(e){return this.msgReceiptCount("recv",e)},msgHasMoreMessages:function(e){return e?this.seq>this._maxSeq:1<this._minSeq&&!this._noEarlierMsgs},isNewMessage:function(e){return this._maxSeq<=e},flushMessage:function(e){var t=this._messages.find({seq:e});return 0<=t?this._messages.delAt(t):void 0},flushMessageRange:function(e,t){var n=this._messages.find({seq:e});return 0<=n?this._messages.delRange(n,this._messages.find({seq:t},!0)):[]},cancelSend:function(e){var t=this._messages.find({seq:e});if(0<=t){var n=this._messages.getAt(t),a=this.msgStatus(n);if(1==a||3==a)return n._cancelled=!0,this._messages.delAt(t),this.onData&&this.onData(),!0}return!1},getType:function(){return l.topicType(this.name)},getAccessMode:function(){return this.acs},getDefaultAccess:function(){return this.defacs},startMetaQuery:function(){return new n(this)},isArchived:function(){return!(!this.private||!this.private.arch)},msgStatus:function(e){var t=0;return this._tinode.isMe(e.from)?e._sending?t=2:e._failed?t=3:268435455<=e.seq?t=1:0<this.msgReadCount(e.seq)?t=6:0<this.msgRecvCount(e.seq)?t=5:0<e.seq&&(t=4):t=7,t},_routeData:function(e){e.content&&((!this.touched||this.touched<e.ts)&&(this.touched=e.ts),e._noForwarding||this._messages.put(e)),e.seq>this._maxSeq&&(this._maxSeq=e.seq),(e.seq<this._minSeq||0==this._minSeq)&&(this._minSeq=e.seq),this.onData&&this.onData(e);var t=this._tinode.getMeTopic();t&&t.setMsgReadRecv(this.name,this._tinode.isMe(e.from)?"read":"msg",e.seq,e.ts)},_routeMeta:function(e){e.desc&&(this._lastDescUpdate=e.ts,this._processMetaDesc(e.desc)),e.sub&&0<e.sub.length&&(this._lastSubsUpdate=e.ts,this._processMetaSub(e.sub)),e.del&&this._processDelMessages(e.del.clear,e.del.delseq),e.tags&&this._processMetaTags(e.tags),e.cred&&this._processMetaCreds(e.cred),this.onMeta&&this.onMeta(e)},_routePres:function(e){var t;switch(e.what){case"del":this._processDelMessages(e.clear,e.delseq);break;case"on":case"off":(t=this._users[e.src])?t.online="on"==e.what:this._tinode.logger("Presence update for an unknown user",this.name,e.src);break;case"acs":if(t=this._users[e.src])t.acs.updateAll(e.dacs),this._processMetaSub([{user:e.src,updated:new Date,acs:t.acs}]);else{var n=(new c).updateAll(e.dacs);n&&n.mode!=c._NONE&&((t=this._cacheGetUser(e.src))?t.acs=n:(t={user:e.src,acs:n},this.getMeta(this.startMetaQuery().withOneSub(void 0,e.src).build())),t.updated=new Date,this._processMetaSub([t]))}break;default:this._tinode.logger("Ignored presence update",e.what)}this.onPres&&this.onPres(e)},_routeInfo:function(e){if("kp"!==e.what){var t=this._users[e.from];if(t&&(t[e.what]=e.seq,t.recv<t.read&&(t.recv=t.read)),this._tinode.isMe(e.from)){var n=this._tinode.getMeTopic();n&&n.setMsgReadRecv(e.topic,e.what,e.seq)}}this.onInfo&&this.onInfo(e)},_processMetaDesc:function(e){if("p2p"==this.getType()&&delete e.defacs,m(this,e),"string"==typeof this.created&&(this.created=new Date(this.created)),"string"==typeof this.updated&&(this.updated=new Date(this.updated)),"string"==typeof this.touched&&(this.touched=new Date(this.touched)),"me"!==this.name&&!e._noForwarding){var t=this._tinode.getMeTopic();t&&t._processMetaSub([{_noForwarding:!0,topic:this.name,updated:this.updated,touched:this.touched,acs:e.acs,seq:e.seq,read:e.read,recv:e.recv,public:e.public,private:e.private}])}this.onMetaDesc&&this.onMetaDesc(this)},_processMetaSub:function(e){for(var t in e){var n=e[t];n.updated=new Date(n.updated),n.deleted=n.deleted?new Date(n.deleted):null;var a=null;a=n.deleted?(delete this._users[n.user],n):(this._tinode.isMe(n.user)&&n.acs&&this._processMetaDesc({updated:n.updated||new Date,touched:n.updated,acs:n.acs}),this._updateCachedUser(n.user,n)),this.onMetaSub&&this.onMetaSub(a)}this.onSubsUpdated&&this.onSubsUpdated(Object.keys(this._users))},_processMetaTags:function(e){1==e.length&&e[0]==l.DEL_CHAR&&(e=[]),this._tags=e,this.onTagsUpdated&&this.onTagsUpdated(e)},_processMetaCreds:function(e){},_processDelMessages:function(e,t){this._maxDel=Math.max(e,this._maxDel),this.clear=Math.max(e,this.clear);var n=this,a=0;Array.isArray(t)&&t.map(function(e){if(e.hi)for(var t=e.low;t<e.hi;t++)a++,n.flushMessage(t);else a++,n.flushMessage(e.low)}),0<a&&this.onData&&this.onData()},_allMessagesReceived:function(e){this.onAllMessagesReceived&&this.onAllMessagesReceived(e)},_resetSub:function(){this._subscribed=!1},_gone:function(){this._messages.reset(),this._users={},this.acs=new c(null),this.private=null,this.public=null,this._maxSeq=0,this._minSeq=0,this._subscribed=!1;var e=this._tinode.getMeTopic();e&&e._routePres({_noForwarding:!0,what:"gone",topic:"me",src:this.name}),this.onDeleteTopic&&this.onDeleteTopic()},_updateCachedUser:function(e,t){var n=this._cacheGetUser(e);return n=m(n||{},t),this._cachePutUser(e,n),s(this._users,e,n)},_getQueuedSeqId:function(){return this._queuedSeqId++}};var i=function(e){a.call(this,"me",e),this._contacts={},e&&(this.onContactUpdate=e.onContactUpdate)};i.prototype=Object.create(a.prototype,{_processMetaSub:{value:function(e){var t=0;for(var n in e){var a=e[n],o=a.topic;if("fnd"!=o&&"me"!=o){a.updated=new Date(a.updated),a.touched=a.touched?new Date(a.touched):void 0,a.deleted=a.deleted?new Date(a.deleted):null;var r=null;if(a.deleted)r=a,delete this._contacts[o];else if(a.acs&&!a.acs.isJoiner())(r=a).deleted=new Date,delete this._contacts[o];else if(void 0!==a.seq&&(a.seq=0|a.seq,a.recv=0|a.recv,a.read=0|a.read,a.unread=a.seq-a.read),a.seen&&a.seen.when&&(a.seen.when=new Date(a.seen.when)),r=s(this._contacts,o,a),"p2p"==l.topicType(o)&&this._cachePutUser(o,r),!a._noForwarding){var i=this._tinode.getTopic(o);i&&(a._noForwarding=!0,i._processMetaDesc(a))}t++,this.onMetaSub&&this.onMetaSub(r)}}this.onSubsUpdated&&this.onSubsUpdated(Object.keys(this._contacts),t)},enumerable:!0,configurable:!0,writable:!1},_processMetaCreds:{value:function(e,t){var a=this;1==e.length&&e[0]==l.DEL_CHAR&&(e=[]),t?e.map(function(t){if(t.val){var e=a._credentials.findIndex(function(e){return e.meth==t.meth&&e.val==t.val});e<0?(t.done||0<=(e=a._credentials.findIndex(function(e){return e.meth==t.meth&&!e.done}))&&a._credentials.splice(e,1),a._credentials.push(t)):a._credentials[e].done=t.done}else if(t.resp){var n=a._credentials.findIndex(function(e){return e.meth==t.meth&&!e.done});0<=n&&(a._credentials[n].done=!0)}}):this._credentials=e,this.onCredsUpdated&&this.onCredsUpdated(this._credentials)},enumerable:!0,configurable:!0,writable:!1},_routePres:{value:function(e){var t=this._contacts[e.src];if(t){switch(e.what){case"on":t.online=!0;break;case"off":t.online&&(t.online=!1,t.seen?t.seen.when=new Date:t.seen={when:new Date});break;case"msg":t.touched=new Date,t.seq=0|e.seq,t.unread=t.seq-t.read;break;case"upd":this.getMeta(this.startMetaQuery().withLaterOneSub(e.src).build());break;case"acs":t.acs?t.acs.updateAll(e.dacs):t.acs=(new c).updateAll(e.dacs),t.touched=new Date;break;case"ua":t.seen={when:new Date,ua:e.ua};break;case"recv":t.recv=t.recv?Math.max(t.recv,e.seq):0|e.seq;break;case"read":t.read=t.read?Math.max(t.read,e.seq):0|e.seq,t.unread=t.seq-t.read;break;case"gone":delete this._contacts[e.src];break;case"del":break;default:console.log("Unsupported presence update in 'me'",e.what)}this.onContactUpdate&&this.onContactUpdate(e.what,t)}else if("acs"==e.what){var n=new c(e.dacs);if(!n||n.mode==c._INVALID)return void this._tinode.logger("Invalid access mode update",e.src,e.dacs);if(n.mode==c._NONE)return void this._tinode.logger("Removing non-existent subscription",e.src,e.dacs);this.getMeta(this.startMetaQuery().withOneSub(void 0,e.src).build()),this._contacts[e.src]={touched:new Date,topic:e.src,online:!1,acs:n}}else"tags"==e.what&&this.getMeta(this.startMetaQuery().withTags().build());this.onPres&&this.onPres(e)},enumerable:!0,configurable:!0,writable:!1},publish:{value:function(){return Promise.reject(new Error("Publishing to 'me' is not supported"))},enumerable:!0,configurable:!0,writable:!1},delCredential:{value:function(n,a){var o=this;return this._subscribed?this._tinode.delCredential(this.name,n,a).then(function(e){var t=o._credentials.findIndex(function(e){return e.meth==n&&e.val==a});return-1<t&&o._credentials.splice(t,1),o.onCredsUpdated&&o.onCredsUpdated(o._credentials),e}):Promise.reject(new Error("Cannot delete credential in inactive 'me' topic"))},enumerable:!0,configurable:!0,writable:!1},contacts:{value:function(e,t,n){var a=e||this.onMetaSub;if(a)for(var o in this._contacts)(t||this._contacts[o]&&this._contacts[o].acs&&this._contacts[o].acs.isJoiner())&&a.call(n,this._contacts[o],o,this._contacts)},enumerable:!0,configurable:!0,writable:!0},setMsgReadRecv:{value:function(e,t,n,a){var o,r=this._contacts[e],i=!1;if(r){switch(n|=0,r.seq=0|r.seq,r.read=0|r.read,r.recv=0|r.recv,t){case"recv":o=r.recv,r.recv=Math.max(r.recv,n),i=o!=r.recv;break;case"read":o=r.read,r.read=Math.max(r.read,n),i=o!=r.read;break;case"msg":o=r.seq,r.seq=Math.max(r.seq,n),(!r.touched||r.touched<a)&&(r.touched=a),i=o!=r.seq}r.recv<r.read&&(r.recv=r.read,i=!0),r.seq<r.recv&&(r.seq=r.recv,(!r.touched||r.touched<a)&&(r.touched=a),i=!0),r.unread=r.seq-r.read,!i||r.acs&&r.acs.isMuted()||!this.onContactUpdate||this.onContactUpdate(t,r)}},enumerable:!0,configurable:!0,writable:!0},getContact:{value:function(e){return this._contacts[e]},enumerable:!0,configurable:!0,writable:!0},getAccessMode:{value:function(e){var t=this._contacts[e];return t?t.acs:null},enumerable:!0,configurable:!0,writable:!0},isArchived:{value:function(e){var t=this._contacts[e];return t?!(!t.private||!t.private.arch):null},enumerable:!0,configurable:!0,writable:!0},getCredentials:{value:function(){return this._credentials},enumerable:!0,configurable:!0,writable:!0}}),i.prototype.constructor=i;var d=function(e){a.call(this,"fnd",e),this._contacts={}};d.prototype=Object.create(a.prototype,{_processMetaSub:{value:function(e){var t=Object.getOwnPropertyNames(this._contacts).length;for(var n in this._contacts={},e){var a=e[n],o=a.topic?a.topic:a.user;a.updated=new Date(a.updated),a.seen&&a.seen.when&&(a.seen.when=new Date(a.seen.when)),a=s(this._contacts,o,a),t++,this.onMetaSub&&this.onMetaSub(a)}0<t&&this.onSubsUpdated&&this.onSubsUpdated(Object.keys(this._contacts))},enumerable:!0,configurable:!0,writable:!1},publish:{value:function(){return Promise.reject(new Error("Publishing to 'fnd' is not supported"))},enumerable:!0,configurable:!0,writable:!1},setMeta:{value:function(e){var t=this;return Object.getPrototypeOf(d.prototype).setMeta.call(this,e).then(function(){0<Object.keys(t._contacts).length&&(t._contacts={},t.onSubsUpdated&&t.onSubsUpdated([]))})},enumerable:!0,configurable:!0,writable:!1},contacts:{value:function(e,t){var n=e||this.onMetaSub;if(n)for(var a in this._contacts)n.call(t,this._contacts[a],a,this._contacts)},enumerable:!0,configurable:!0,writable:!0}}),d.prototype.constructor=d;var p=function(e){this._tinode=e,this._apiKey=e._apiKey,this._authToken=e.getAuthToken(),this._msgId=e.getNextUniqueId(),this.xhr=k(),this.toResolve=null,this.toReject=null,this.onProgress=null,this.onSuccess=null,this.onFailure=null};p.prototype={uploadWithBaseUrl:function(e,t,n,a,o){var r=this;if(!this._authToken)throw new Error("Must authenticate first");var i=this,s="/v"+u+"/file/u/";if(e){if(0!=e.indexOf("http://")&&0!=e.indexOf("https://"))throw new Error("Invalid base URL '"+e+"'");s=e+s}this.xhr.open("POST",s,!0),this.xhr.setRequestHeader("X-Tinode-APIKey",this._apiKey),this.xhr.setRequestHeader("X-Tinode-Auth","Token "+this._authToken.token);var l=new Promise(function(e,t){r.toResolve=e,r.toReject=t});this.onProgress=n,this.onSuccess=a,this.onFailure=o,this.xhr.upload.onprogress=function(e){e.lengthComputable&&i.onProgress&&i.onProgress(e.loaded/e.total)},this.xhr.onload=function(){var e;try{e=JSON.parse(this.response,M)}catch(e){i._tinode.logger("Invalid server response in LargeFileHelper",this.response)}200<=this.status&&this.status<300?(i.toResolve&&i.toResolve(e.ctrl.params.url),i.onSuccess&&i.onSuccess(e.ctrl)):400<=this.status?(i.toReject&&i.toReject(new Error(e.ctrl.text+" ("+e.ctrl.code+")")),i.onFailure&&i.onFailure(e.ctrl)):i._tinode.logger("Unexpected server response status",this.status,this.response)},this.xhr.onerror=function(e){i.toReject&&i.toReject(new Error("failed")),i.onFailure&&i.onFailure(null)},this.xhr.onabort=function(e){i.toReject&&i.toReject(new Error("upload cancelled by user")),i.onFailure&&i.onFailure(null)};try{var c=new FormData;c.append("file",t),c.set("id",this._msgId),this.xhr.send(c)}catch(e){this.toReject&&this.toReject(e),this.onFailure&&this.onFailure(null)}return l},upload:function(e,t,n,a){return this.uploadWithBaseUrl(void 0,e,t,n,a)},download:function(e,n,a,t){var o=this;if(/^\s*([a-z][a-z0-9+.-]*:|\/\/)/im.test(e))throw new Error("The URL '"+e+"' must be relative, not absolute");if(!this._authToken)throw new Error("Must authenticate first");var r=this;this.xhr.open("GET",e,!0),this.xhr.setRequestHeader("X-Tinode-APIKey",this._apiKey),this.xhr.setRequestHeader("X-Tinode-Auth","Token "+this._authToken.token),this.xhr.responseType="blob",this.onProgress=t,this.xhr.onprogress=function(e){r.onProgress&&r.onProgress(e.loaded)};var i=new Promise(function(e,t){o.toResolve=e,o.toReject=t});this.xhr.onload=function(){if(200==this.status){var e=document.createElement("a");e.href=window.URL.createObjectURL(new Blob([this.response],{type:a})),e.style.display="none",e.setAttribute("download",n),document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(e.href),r.toResolve&&r.toResolve()}else if(400<=this.status&&r.toReject){var t=new FileReader;t.onload=function(){try{var e=JSON.parse(this.result,M);r.toReject(new Error(e.ctrl.text+" ("+e.ctrl.code+")"))}catch(e){r._tinode.logger("Invalid server response in LargeFileHelper",this.result),r.toReject(e)}},t.readAsText(this.response)}},this.xhr.onerror=function(e){r.toReject&&r.toReject(new Error("failed"))},this.xhr.onabort=function(){r.toReject&&r.toReject(null)};try{this.xhr.send()}catch(e){this.toReject&&this.toReject(e)}return i},cancel:function(){this.xhr&&this.xhr.readyState<4&&this.xhr.abort()},getId:function(){return this._msgId}};var v=function e(t,n){this.status=e.STATUS_NONE,this.topic=t,this.content=n};v.STATUS_NONE=0,v.STATUS_QUEUED=1,v.STATUS_SENDING=2,v.STATUS_FAILED=3,v.STATUS_SENT=4,v.STATUS_RECEIVED=5,v.STATUS_READ=6,v.STATUS_TO_ME=7,(v.prototype={toJSON:function(){},fromJSON:function(e){}}).constructor=v,P.exports=l,P.exports.Drafty=r}.call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),P=P.exports}()}).call(this,n(7))},function(e,t){e.exports=ReactDOM},function(e){e.exports=JSON.parse('{"en":{"archived_contacts":"Archived contacts ({count})","contacts_not_found":"You have no chats<br />¯∖_(ツ)_/¯","full_name_prompt":"Full name, e.g. John Doe","email_prompt":"Email, e.g. jdoe@example.com","button_sign_up":"Sign up","validate_credential_action":"confirm","label_your_name":"Your name","label_password":"Password","password_unchanged_prompt":"Unchanged","label_message_sound":"Message sound:","label_push_notifications":"Notification alerts:","label_push_notifications_disabled":"Notification alerts (requires HTTPS):","title_tag_manager":"Tags (user discovery)","label_user_contacts":"Contacts:","label_user_id":"Address:","label_default_access_mode":"Default access mode:","button_logout":"Logout","label_legal":"Legal","link_contact_us":"Contact Us","link_terms_of_service":"Terms of Service","link_privacy_policy":"Privacy Policy","requested_permissions":"Requested","granted_permissions":"Granted","menu_item_edit_permissions":"Edit permissions","label_other_user":"Other","title_info":"Info","label_topic_name":"Name","label_private":"Private comment","private_editing_placeholder":"Visible to you only","label_muting_topic":"Muted:","action_more":"More","label_your_permissions":"Your permissions:","label_permissions":"Permissions:","label_you":"You:","label_default_access":"Default access mode:","action_delete_messages":"Delete Messages","action_leave_chat":"Leave Conversation","action_report_group":"Report Group","action_block_contact":"Block Contact","action_report_contact":"Report Contact","label_group_members":"Group members:","button_add_members":"Add members","group_has_no_members":"No members","login_prompt":"Login","password_prompt":"Password","stay_logged_in":"Stay logged in","forgot_password_link":"Forgot password?","button_sign_in":"Sign in","label_client":"Client:","label_server":"Server:","online_now":"online now","last_seen_timestamp":"Last seen","title_not_found":"Not found","unnamed_topic":"Unnamed","messages_not_readable":"no access to messages","peers_messaging_disabled":"Peer\'s messaging is disabled.","enable_peers_messaging":"Enable","tabtitle_find_user":"find","tabtitle_new_group":"new group","tabtitle_group_by_id":"by id","search_for_contacts":"Use search to find contacts","new_password_placeholder":"Enter new password","label_reset_password":"Send a password reset email:","credential_email_prompt":"Your registration email","button_reset":"Reset","button_send_request":"Send request","label_server_to_use":"Server to use:","label_wire_transport":"Wire transport:","button_update":"Update","sidepanel_title_login":"Sign In","sidepanel_title_register":"Create Account","sidepanel_title_settings":"Settings","sidepanel_title_edit_account":"Edit Account","sidepanel_title_newtpk":"Start New Chat","sidepanel_title_cred":"Confirm Credentials","sidepanel_title_reset":"Reset Password","sidepanel_title_archive":"Archived Chats","update_available":"Update available. <a href=\\"\\">Reload</a>.","reconnect_countdown":"Disconnected. Reconnecting in {seconds}…","reconnect_now":"Try now","phone_dative":"phone","email_dative":"email","enter_confirmation_code_prompt":"Enter confirmation code sent to you by {method}:","numeric_confirmation_code_prompt":"Numbers only","button_confirm":"Confirm","save_attachment":"save","invalid_content":"invalid content","user_not_found":"Not found","badge_you":"you","badge_owner":"owner","menu_item_info":"Info","menu_item_clear_messages":"Clear messages","menu_item_clear_messages_for_all":"Clear for All","menu_item_delete":"Delete","menu_item_delete_for_all":"Delete for All","menu_item_mute":"Mute","menu_item_unmute":"Unmute","menu_item_delete_topic":"Delete","menu_item_unblock":"Unblock","menu_item_block":"Block","menu_item_member_delete":"Remove","menu_item_archive_topic":"Archive","action_cancel":"cancel","upload_finishing":"finishing...","no_contacts":"You have no contacts :-(","contacts_not_found_short":"No contacts match \'{query}\'","title_group_members":"Group Members","title_all_contacts":"All Contacts","button_ok":"OK","button_cancel":"Cancel","more_online_members":"+{overflow} more","download_action":"download","label_file_name":"File name:","label_content_type":"Content type:","label_size":"Size:","chat_invitation":"You are invited to start a new chat. What would you like to do?","chat_invitation_accept":"Accept","chat_invitation_ignore":"Ignore","chat_invitation_block":"Block","error_invalid_id":"Invalid ID","group_user_id_prompt":"Group or User ID","button_subscribe":"Subscribe","topic_name_editing_placeholder":"Freeform name of the group","button_create":"Create","permission_join":"Join ({val})","permission_read":"Read ({val})","permission_write":"Write ({val})","permission_pres":"Get notified ({val})","permission_admin":"Approve ({val})","permission_share":"Share ({val})","permission_delete":"Delete ({val})","permission_owner":"Owner ({val})","title_permissions":"Permissions","message_sending":"sending...","message_sending_failed":"failed","search_placeholder":"List like email:alice@example.com, tel:17025550003...","messaging_disabled_prompt":"Messaging disabled","new_message_prompt":"New message","file_attachment_too_large":"The file size {size} exceeds the {limit} limit.","cannot_initiate_file_upload":"Cannot initiate file upload.","tags_not_found":"No tags defined. Add some.","tags_editor_no_tags":"Add some tags","title_manage_tags":"Manage"},"ru":{"contacts_not_found":"Чатов нет<br />¯∖_(ツ)_/¯","full_name_prompt":"Полное имя, напр. Иван Петров","email_prompt":"Email, напр. ivan@example.com","button_sign_up":"Создать счет","label_your_name":"Ваше имя","label_password":"Пароль","password_unchanged_prompt":"Не изменен","label_user_id":"Адрес:","label_default_access_mode":"Доступ по умолчанию:","label_message_sound":"Звук нового сообщения:","label_push_notifications":"Уведомления:","label_push_notifications_disabled":"Уведомления (требуют HTTPS):","title_tag_manager":"Таги для поиска","button_logout":"Выйти","login_prompt":"Логин","password_prompt":"Пароль","stay_logged_in":"Запомнить","forgot_password_link":"Напомнить пароль","button_sign_in":"Войти","label_client":"Клиент:","label_server":"Сервер:","online_now":"онлайн","last_seen_timestamp":"Был активен","title_not_found":"Не найден","unnamed_topic":"Без названия","messages_not_readable":"нет доступа к сообщениям","tabtitle_find_user":"найти","tabtitle_new_group":"создать","tabtitle_group_by_id":"по id","label_server_to_use":"Использовать сервер:","label_wire_transport":"Соединение:","button_update":"Применить","sidepanel_title_login":"Авторизация","sidepanel_title_register":"Зарегистрироваться","sidepanel_title_settings":"Настройки","sidepanel_title_edit_account":"Редактировать счет","sidepanel_title_newtpk":"Новый чат","sidepanel_title_cred":"Подтвердить","sidepanel_title_reset":"Сменить пароль","tags_not_found":"Тагов нет. Добавьте","tags_editor_no_tags":"Добавьте таги","title_manage_tags":"Редактировать","message_sending":"в пути...","message_sending_failed":"ошибка","search_placeholder":"Список, напр. email:alice@example.com, tel:+17025550003...","messaging_disabled_prompt":"Отправка недоступна","new_message_prompt":"Новое сообщение","file_attachment_too_large":"Размер файла {size} превышает {limit} лимит.","cannot_initiate_file_upload":"Ошибка загрузки файла.","search_for_contacts":"Поиск контактов","enter_confirmation_code_prompt":"Код подтверждения, полученный по {method}:","numeric_confirmation_code_prompt":"Только цифры","button_confirm":"Подтвердить","button_ok":"OK","button_cancel":"Отменить","invalid_content":"сообщение не читается","label_file_name":"Имя файла:","label_content_type":"Тип:","label_size":"Размер:","phone_dative":"телефону","email_dative":"емейлу","title_group_members":"Участники","download_action":"скачать","permission_join":"Подписываться ({val})","permission_read":"Читать ({val})","permission_write":"Писать ({val})","permission_pres":"Уведомлять ({val})","permission_admin":"Подтверждать ({val})","permission_share":"Приглашать ({val})","permission_delete":"Удалять ({val})","permission_owner":"Владелец ({val})","title_permissions":"Права доступа","requested_permissions":"Требуются","granted_permissions":"Получены","menu_item_edit_permissions":"Права доступа","label_other_user":"Второй","label_topic_name":"Название","label_private":"Комментарий","private_editing_placeholder":"Виден только вам","label_muting_topic":"Без уведомлений","action_more":"Ещё","label_your_permissions":"Ваши права доступа:","label_permissions":"Права доступа:","label_you":"Вы:","label_default_access":"Права по умолчанию:","label_group_members":"Участники чата:","button_add_members":"Добавить","group_has_no_members":"Нет участников","action_leave_chat":"Уйти из чата","menu_item_info":"Информация","menu_item_clear_messages":"Удалить сообщения","menu_item_clear_messages_for_all":"Удалить для всех","menu_item_delete":"Удалить","menu_item_delete_for_all":"Удалить для всех","menu_item_mute":"Не уведомлять","menu_item_unmute":"Уведомлять","menu_item_delete_topic":"Удалить чат","menu_item_unblock":"Разблокировать","menu_item_block":"Заблокировать","menu_item_member_delete":"Отписать","title_info":"Подробности","new_password_placeholder":"Введите новый пароль","label_reset_password":"Отправить емейл для смены пароля:","credential_email_prompt":"Регистрационный емейл","button_reset":"Изменить","button_send_request":"Отправить","action_cancel":"отменить","upload_finishing":"завершение...","no_contacts":"Ничего нет :-(","contacts_not_found_short":"Нет контактов для запроса \'{query}\'","title_all_contacts":"Все контакты","error_invalid_id":"Неверный ID","group_user_id_prompt":"ID чата или пользователя","button_subscribe":"Подписаться","topic_name_editing_placeholder":"Название чата","button_create":"Создать","badge_you":"вы","badge_owner":"влад.","update_available":"Есть новая версия приложения. <a href=\\"\\">Обновить</a>.","user_not_found":"Не найден","reconnect_countdown":"Нет связи. Подключение через {seconds}…","reconnect_now":"Подключить сейчас.","save_attachment":"сохранить","menu_item_archive_topic":"В архив","archived_contacts":"Чаты в архиве ({count})","sidepanel_title_archive":"Архив чатов","chat_invitation":"Вас пригласили начать новый чат. Как вы хотите поступить?","chat_invitation_accept":"Принять","chat_invitation_ignore":"Игнорировать","chat_invitation_block":"Заблокировать","peers_messaging_disabled":"Чат заблокирован у корреспондента.","enable_peers_messaging":"Разблокировать.","more_online_members":"+еще {overflow}","label_user_contacts":"Конакты:","validate_credential_action":"подтвердить","label_legal":"Прочее","link_contact_us":"Связаться с нами","link_terms_of_service":"Условия сервиса","link_privacy_policy":"Политика конфиденциальности","action_delete_messages":"Удалить сообщения","action_block_contact":"Заблокировать контакт","action_report_contact":"Сообщить о нарушении","action_report_group":"Сообщить о нарушении"},"zh":{"archived_contacts":"已归档联系人 ({count})","contacts_not_found":"你尚无会话<br />¯∖_(ツ)_/¯","full_name_prompt":"全名，例如张伟","email_prompt":"电子邮件，例如 zhang@example.com","button_sign_up":"注册","label_your_name":"你的姓名","label_password":"密码","password_unchanged_prompt":"未改变","label_user_id":"地址：","label_default_access_mode":"蓦然访问模式：","label_message_sound":"消息提示音：","label_push_notifications":"通知提醒：","label_push_notifications_disabled":"通知提醒（需要 HTTPS）：","title_tag_manager":"标签（用户发现）","button_logout":"登出","requested_permissions":"已请求","granted_permissions":"已授予","menu_item_edit_permissions":"编辑权限","label_other_user":"其他","title_info":"信息","label_topic_name":"名称","label_private":"私人评论","private_editing_placeholder":"仅自己可见","label_muting_topic":"已静音：","action_more":"更多","label_your_permissions":"你的权限：","label_permissions":"权限：","label_you":"你：","label_default_access":"默认权限模式：","label_group_members":"群组成员：","button_add_members":"添加成员","group_has_no_members":"无成员","action_leave_chat":"离开","login_prompt":"登录","password_prompt":"密码","stay_logged_in":"保持登录","forgot_password_link":"忘记密码？","button_sign_in":"登录","label_client":"客户端：","label_server":"服务器：","online_now":"在线","last_seen_timestamp":"最后可见","title_not_found":"无法找到","unnamed_topic":"未命名","messages_not_readable":"无消息访问权限","peers_messaging_disabled":"成员间消息已禁用。","enable_peers_messaging":"启用","tabtitle_find_user":"搜索","tabtitle_new_group":"新群组","tabtitle_group_by_id":"通过 id","search_for_contacts":"使用搜索寻找联系人","new_password_placeholder":"输入新密码","label_reset_password":"发送密码重置邮件：","credential_email_prompt":"你的注册邮箱","button_reset":"重置","button_send_request":"发送请求","label_server_to_use":"使用的服务器：","label_wire_transport":"线路传输：","button_update":"更新","sidepanel_title_login":"登录","sidepanel_title_register":"创建账户","sidepanel_title_settings":"设置","sidepanel_title_edit_account":"编辑账户","sidepanel_title_newtpk":"开始新会话","sidepanel_title_cred":"确认凭据","sidepanel_title_reset":"重置密码","sidepanel_title_archive":"已存档会话","update_available":"更新可用。<a href=\\"\\">重新载入</a>.","reconnect_countdown":"连接已断开。{seconds} 秒后重新连接…","reconnect_now":"立即尝试","phone_dative":"电话","email_dative":"电子邮件","enter_confirmation_code_prompt":"输入通过{method}发送的验证码：","numeric_confirmation_code_prompt":"仅数字","button_confirm":"确认","save_attachment":"保存","invalid_content":"无效内容","user_not_found":"未找到","badge_you":"你","badge_owner":"所有者","menu_item_info":"信息","menu_item_clear_messages":"清空消息","menu_item_clear_messages_for_all":"全部清除","menu_item_delete":"删除","menu_item_delete_for_all":"全部删除","menu_item_mute":"静音","menu_item_unmute":"取消静音","menu_item_delete_topic":"删除","menu_item_unblock":"取消屏蔽","menu_item_block":"屏蔽","menu_item_member_delete":"移除","menu_item_archive_topic":"归档","action_cancel":"取消","upload_finishing":"正在结束...","no_contacts":"你尚无联系人 ：-(","contacts_not_found_short":"无联系人匹配 \'{query}\'","title_group_members":"群组成员","title_all_contacts":"全部联系人","button_ok":"好","button_cancel":"取消","download_action":"下载","label_file_name":"文件名：","label_content_type":"内容类型：","label_size":"大小：","chat_invitation":"你受邀开始新会话。你想怎么做？","chat_invitation_accept":"接受","chat_invitation_ignore":"忽略","chat_invitation_block":"屏蔽","error_invalid_id":"无效 ID","group_user_id_prompt":"群组或用户 ID","button_subscribe":"订阅","topic_name_editing_placeholder":"群组自由格式名称","button_create":"创建","permission_join":"加入 ({val})","permission_read":"读取 ({val})","permission_write":"写入 ({val})","permission_pres":"获取通知 ({val})","permission_admin":"批准 ({val})","permission_share":"分享 ({val})","permission_delete":"删除 ({val})","permission_owner":"所有者 ({val})","title_permissions":"权限","message_sending":"正在发送...","message_sending_failed":"发送失败","search_placeholder":"列表如 email:alice@example.com, tel:+17025550003...","messaging_disabled_prompt":"消息已禁用","new_message_prompt":"新消息","file_attachment_too_large":"文件大小 {size} 超过 {limit} 限制。","cannot_initiate_file_upload":"无法初始化文件上传。","tags_not_found":"尚未定义标签。添加一些。","tags_editor_no_tags":"添加一些标签","title_manage_tags":"管理标签","more_online_members":"还有{overflow}个","label_user_contacts":"往来：","validate_credential_action":"确认","label_legal":"法律东西","link_contact_us":"联系我们","link_terms_of_service":"条款和条件","link_privacy_policy":"隐私政策","action_delete_messages":"删除所有帖子","action_block_contact":"屏蔽联系人","action_report_contact":"检举垃圾邮件","action_report_group":"检举垃圾邮件"}}')},function(e,t){e.exports=firebase},function(e,t){e.exports=firebase.messaging},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);var a=n(0),E=n.n(a),o=n(3),r=n.n(o),S=n(1),i=n(4),s=n(5),l=(n(6),n(2)),C=n.n(l),c="TinodeWeb/0.16.1",u={hosted:"web.tinode.co",local:"localhost:6060"},d=u.hosted,p="JRWPS",h=195840;function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var m,g,b,v=(m=y,b=[{key:"parseUrlHash",value:function(e){var t=e.split("?",2),n={},a=[];return t[0]&&(a=t[0].substr(1).split("/")),t[1]&&t[1].split("&").forEach(function(e){var t=e.split("=");t[0]&&(n[decodeURIComponent(t[0])]=decodeURIComponent(t[1]))}),{path:a,params:n}}},{key:"navigateTo",value:function(e){window.location.hash=e}},{key:"composeUrlHash",value:function(e,t){var n=e.join("/"),a=[];for(var o in t)t.hasOwnProperty(o)&&a.push(o+"="+t[o]);return 0<a.length&&(n+="?"+a.join("&")),n}},{key:"addUrlParam",value:function(e,t,n){var a=this.parseUrlHash(e);return a.params[t]=n,this.composeUrlHash(a.path,a.params)}},{key:"removeUrlParam",value:function(e,t){var n=this.parseUrlHash(e);return delete n.params[t],this.composeUrlHash(n.path,n.params)}},{key:"setUrlSidePanel",value:function(e,t){var n=this.parseUrlHash(e);return n.path[0]=t,this.composeUrlHash(n.path,n.params)}},{key:"setUrlTopic",value:function(e,t){var n=this.parseUrlHash(e);return n.path[1]=t,delete n.params.info,this.composeUrlHash(n.path,n.params)}}],(g=null)&&f(m.prototype,g),void(b&&f(m,b)),y);function y(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y)}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P,O,N,j=Object(S.defineMessages)({info:{id:"menu_item_info",defaultMessage:"Info"},clear_messages:{id:"menu_item_clear_messages",defaultMessage:"Clear messages"},clear_for_all:{id:"menu_item_clear_messages_for_all",defaultMessage:"Clear for All"},delete:{id:"menu_item_delete",defaultMessage:"Delete"},delete_for_all:{id:"menu_item_delete_for_all",defaultMessage:"Delete for All"},mute:{id:"menu_item_mute",defaultMessage:"Mute"},unmute:{id:"menu_item_unmute",defaultMessage:"Unmute"},topic_delete:{id:"menu_item_delete_topic",defaultMessage:"Delete"},unblock:{id:"menu_item_unblock",defaultMessage:"Unblock"},block:{id:"menu_item_block",defaultMessage:"Block"},member_delete:{id:"menu_item_member_delete",defaultMessage:"Remove"},archive:{id:"menu_item_archive_topic",defaultMessage:"Archive"}}),A=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(x,E.a.Component),P=x,(O=[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handlePageClick,!1),document.addEventListener("keyup",this.handleEscapeKey,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handlePageClick,!1),document.removeEventListener("keyup",this.handleEscapeKey,!1)}},{key:"handlePageClick",value:function(e){r.a.findDOMNode(this).contains(e.target)||(e.preventDefault(),e.stopPropagation(),this.props.hide())}},{key:"handleEscapeKey",value:function(e){27===e.keyCode&&this.props.hide()}},{key:"handleClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.hide();var t=this.props.items[e.currentTarget.dataset.id];"string"==typeof t&&(t=this.MenuItems[t]),t?this.props.onAction(t.id,t.handler(this.props.params,this.props.onError),this.props.params):console.log("Invalid menu item ID",e.currentTarget.dataset.id)}},{key:"deleteMessages",value:function(e,t,n,a){var o=this.props.tinode.getTopic(n.topicName);if(o){if(e||!o.cancelSend(n.seq))return(e?o.delMessagesAll(t):o.delMessagesList([n.seq],t)).catch(function(e){a&&a(e.message,"err")})}else console.log("Topic not found: ",n.topicName)}},{key:"topicPermissionSetter",value:function(e,t,n){var a=this.props.tinode.getTopic(t.topicName);if(a){var o,r;if(t.user){if(!(r=a.subscriber(t.user)))return void console.log("Subscriber not found",t.topicName+"["+t.user+"]");o=r.acs.updateGiven(e).getGiven()}else o=a.getAccessMode().updateWant(e).getWant();var i=a.setMeta({sub:{user:t.user,mode:o}});return n&&(i=i.catch(function(e){n(e.message,"err")})),i}console.log("Topic not found",t.topicName)}},{key:"render",value:function(){var t=this,n=0,a=[];this.props.items.map(function(e){"string"==typeof e&&(e=t.MenuItems[e]),e&&e.title&&a.push("-"==e.title?E.a.createElement("li",{className:"separator",key:n}):E.a.createElement("li",{onClick:t.handleClick,"data-id":n,key:n},e.title)),n++});var e=13*(.7+2.5*a.length),o={left:(this.props.bounds.right-this.props.clickAt.x<156?this.props.clickAt.x-this.props.bounds.left-156:this.props.clickAt.x-this.props.bounds.left)+"px",top:(this.props.bounds.bottom-this.props.clickAt.y<e?this.props.clickAt.y-this.props.bounds.top-e:this.props.clickAt.y-this.props.bounds.top)+"px"};return E.a.createElement("ul",{className:"menu",style:o},a)}}])&&w(P.prototype,O),void(N&&w(P,N)),x);function x(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,x),a=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?M(e):t}(this,k(x).call(this,e));var t=e.intl.formatMessage;return a.handlePageClick=a.handlePageClick.bind(M(a)),a.handleEscapeKey=a.handleEscapeKey.bind(M(a)),a.handleClick=a.handleClick.bind(M(a)),a.MenuItems={topic_info:{id:"topic_info",title:t(j.info),handler:null},messages_clear:{id:"messages_clear",title:t(j.clear_messages),handler:function(e,t){return a.deleteMessages(!0,!1,e,t)}},messages_clear_hard:{id:"messages_clear_hard",title:t(j.clear_for_all),handler:function(e,t){return a.deleteMessages(!0,!0,e,t)}},message_delete:{id:"message_delete",title:t(j.delete),handler:function(e,t){return a.deleteMessages(!1,!1,e,t)}},message_delete_hard:{id:"message_delete_hard",title:t(j.delete_for_all),handler:function(e,t){return a.deleteMessages(!1,!0,e,t)}},topic_unmute:{id:"topic_unmute",title:t(j.unmute),handler:a.topicPermissionSetter.bind(M(a),"+P")},topic_mute:{id:"topic_mute",title:t(j.mute),handler:a.topicPermissionSetter.bind(M(a),"-P")},topic_unblock:{id:"topic_unblock",title:t(j.unblock),handler:a.topicPermissionSetter.bind(M(a),"+JP")},topic_block:{id:"topic_block",title:t(j.block),handler:function(t,e){return a.topicPermissionSetter("-JP",t,e).then(function(e){return a.props.onTopicRemoved(t.topicName),e})}},topic_delete:{id:"topic_delete",title:t(j.topic_delete),handler:function(e,t){var n=a.props.tinode.getTopic(e.topicName);if(n)return n.delTopic().catch(function(e){t&&t(e.message,"err")});console.log("Topic not found: ",e.topicName)}},topic_archive:{id:"topic_archive",title:t(j.archive),handler:function(e,t){var n=a.props.tinode.getTopic(e.topicName);if(n)return n.archive(!0).catch(function(e){t&&t(e.message,"err")});console.log("Topic not found: ",e.topicName)}},permissions:{id:"permissions",title:t({id:"menu_item_edit_permissions"}),handler:null},member_delete:{id:"member_delete",title:t(j.member_delete),handler:function(e,t){var n=a.props.tinode.getTopic(e.topicName);if(n&&e.user)return n.delSubscription(e.user).catch(function(e){t&&t(e.message,"err")});console.log("Topic or user not found: '"+e.topicName+"', '"+e.user+"'")}},member_mute:{id:"member_mute",title:t(j.mute),handler:a.topicPermissionSetter.bind(M(a),"-P")},member_unmute:{id:"member_unmute",title:t(j.unmute),handler:a.topicPermissionSetter.bind(M(a),"+P")},member_block:{id:"member_block",title:t(j.block),handler:a.topicPermissionSetter.bind(M(a),"-J")},member_unblock:{id:"member_unblock",title:t(j.unblock),handler:a.topicPermissionSetter.bind(M(a),"+J")}},a}var D=Object(S.injectIntl)(A);function U(e,t){t=t||window.navigator.userLanguage||window.navigator.language;var n=new Date;return e.getFullYear()==n.getFullYear()?e.getMonth()==n.getMonth()&&e.getDate()==n.getDate()?e.toLocaleTimeString(t,{hour12:!1,hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString(t,{hour12:!1,month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):e.toLocaleDateString(t,{hour12:!1,year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function R(e){if(!e||0==e)return"0 Bytes";var t=["Bytes","KB","MB","GB","TB","PB"],n=Math.min(0|Math.floor(Math.log2(e)/10),t.length-1),a=e/Math.pow(1024,n),o=0<n?a<3?2:a<30?1:0:0;return a.toFixed(o)+" "+t[n]}function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function L(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var W,G,B,V=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(K,E.a.PureComponent),W=K,(G=[{key:"render",value:function(){var e;if(!0===this.props.avatar){var t="grp"==C.a.topicType(this.props.topic);if(this.props.topic&&this.props.title&&this.props.title.trim()){var n=this.props.title.trim().charAt(0),a="lettertile "+(t?"color":"dark-color")+Math.abs(function(e){var t=0;e=""+e;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(this.props.topic))%16;e=E.a.createElement("div",{className:a},E.a.createElement("div",null,n))}else e=t?E.a.createElement("i",{className:"material-icons"},"group"):E.a.createElement("i",{className:"material-icons"},"person")}else e=this.props.avatar?E.a.createElement("img",{className:"avatar",alt:"avatar",src:this.props.avatar,onError:function(e){e.target.onerror=null,e.target.src="/img/broken_image.png"}}):null;return e}}])&&I(W.prototype,G),void(B&&I(W,B)),K);function K(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,K),L(this,q(K).apply(this,arguments))}var z=["image/jpeg","image/gif","image/png","image/svg","image/svg+xml"],J=["jpg","gif","png","svg","svg"];function Y(e){return e&&e.type&&e.data?"data:image/"+e.type+";base64,"+e.data:null}function Q(e,t,n,a,o){if(t|=0,n|=0,a|=0,(e|=0)<=0||t<=0||n<=0||a<=0)return null;o&&(n=a=Math.min(n,a));var r=Math.min(Math.min(e,n)/e,Math.min(t,a)/t),i={dstWidth:e*r|0,dstHeight:t*r|0};return o?(i.dstWidth=i.dstHeight=Math.min(i.dstWidth,i.dstHeight),i.srcWidth=i.srcHeight=Math.min(e,t),i.xoffset=(e-i.srcWidth)/2|0,i.yoffset=(t-i.srcWidth)/2|0):(i.xoffset=i.yoffset=0,i.srcWidth=e,i.srcHeight=t),i}function X(e,t){var n=z.indexOf(t),a=J[n],o=e.lastIndexOf(".");return 0<=o&&(e=e.substring(0,o)),e+"."+a}function $(i,s,l,c,u,d){var e=new Image;e.crossOrigin="Anonymous",e.onerror=function(e){d("Image format unrecognized")},e.onload=function(){var e=Q(this.width,this.height,s,l,c);if(e){var t=document.createElement("canvas");t.width=e.dstWidth,t.height=e.dstHeight;var n=t.getContext("2d");n.imageSmoothingEnabled=!0,n.drawImage(this,e.xoffset,e.yoffset,e.srcWidth,e.srcHeight,0,0,e.dstWidth,e.dstHeight);var a=this.width!=e.dstWidth||this.height!=e.dstHeight||z.indexOf(i.type)<0?"image/jpeg":i.type,o=t.toDataURL(a);if(a=te(o.split(",")[0])){var r=.78;if(ne(o.length)>h&&(a="image/jpeg"),"image/jpeg"==a)for(;ne(o.length)>h&&.45<r;)o=t.toDataURL(a,r),r*=.84;ne(o.length)>h?d("The image size "+bytesToHumanSize(ne(o.length))+" exceeds the "+bytesToHumanSize(h)+" limit.","err"):(t=null,u(o.split(",")[1],a,e.dstWidth,e.dstHeight,X(i.name,a)))}else d("Unsupported image format")}else d("Invalid image")},e.src=URL.createObjectURL(i)}function Z(a,o,r){var i=new FileReader;i.addEventListener("load",function(){var e=i.result.split(","),t=te(e[0]);if(t){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){o(e[1],t,this.width,this.height,X(a.name,t))},n.onerror=function(e){r("Image format not recognized")},n.src=URL.createObjectURL(a)}else r("Failed to process image file")},!1),i.readAsDataURL(a)}function ee(e,t){var n=new FileReader;n.addEventListener("load",function(){t(e.type,n.result.split(",")[1],e.name)}),n.readAsDataURL(e)}function te(e){var t=/^data:(image\/[-+a-z0-9.]+);base64/.exec(e);return t&&1<t.length?t[1]:null}function ne(e){return 3*Math.floor(e/4)}function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var le,ce,ue,de=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(pe,E.a.Component),le=pe,(ce=[{key:"componentDidUpdate",value:function(e){this.props.avatar!=e.avatar&&this.setState({dataUrl:this.props.avatar})}},{key:"handleFileUpload",value:function(e){var a=this;$(e.target.files[0],128,128,!0,function(e,t){var n=Y({data:e,type:t});a.setState({dataUrl:n}),a.props.onImageChanged(n)},function(e){a.props.onError(e,"err")}),e.target.value=""}},{key:"render",value:function(){var t=this,e="file-input-avatar-"+(Math.random()+"").substr(2);return E.a.createElement("div",{className:"avatar-upload"},this.props.readOnly||!this.state.dataUrl?null:E.a.createElement("a",{href:"#",className:"clear-avatar",onClick:function(e){e.preventDefault(),t.props.onImageChanged(null)}},E.a.createElement("i",{className:"material-icons"},"clear")),this.state.dataUrl?E.a.createElement("img",{src:this.state.dataUrl,className:"preview"}):this.props.readOnly&&this.props.uid?E.a.createElement("div",{className:"avatar-box"},E.a.createElement(V,{avatar:!0,topic:this.props.uid,title:this.props.title})):E.a.createElement("div",{className:"blank"},128,"×",128),this.props.readOnly?null:E.a.createElement("input",{type:"file",id:e,className:"inputfile hidden",accept:"image/*",onChange:this.handleFileUpload}),this.props.readOnly?null:E.a.createElement("label",{htmlFor:e,className:"round"},E.a.createElement("i",{className:"material-icons"},"file_upload")))}}])&&oe(le.prototype,ce),void(ue&&oe(le,ue)),pe);function pe(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,pe),(t=function(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?ie(e):t}(this,re(pe).call(this,e))).state={dataUrl:e.avatar},t.handleFileUpload=t.handleFileUpload.bind(ie(t)),t}function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ge(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ve,ye,_e,we=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(Ee,E.a.PureComponent),ve=Ee,(ye=[{key:"handleChange",value:function(){this.props.onChange(this.props.name,!this.props.checked)}},{key:"render",value:function(){return this.props.onChange?this.props.checked?E.a.createElement("i",{className:"material-icons blue clickable",onClick:this.handleChange},"check_box"):E.a.createElement("i",{className:"material-icons blue clickable",onClick:this.handleChange},"check_box_outline_blank"):this.props.checked?E.a.createElement("i",{className:"material-icons"},"check_box"):E.a.createElement("i",{className:"material-icons"},"check_box_outline_blank")}}])&&fe(ve.prototype,ye),void(_e&&fe(ve,_e)),Ee);function Ee(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ee),(t=function(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?ge(e):t}(this,me(Ee).call(this,e))).handleChange=t.handleChange.bind(ge(t)),t}function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ke(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Te(e,t){return(Te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe,Oe,Ne,je={muted:"notifications_off",banned:"block"},Ae=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Te(e,t)}(xe,E.a.PureComponent),Pe=xe,(Oe=[{key:"render",value:function(){var n=null;return this.props.badges&&0<this.props.badges.length?(n=[],this.props.badges.map(function(e){if(e.icon)n.push(E.a.createElement("i",{className:"material-icons as-badge",key:e.key||e.icon},je[e.icon]));else{var t="badge"+(e.color?" "+e.color:"");n.push(E.a.createElement("span",{className:t,key:e.key||e.name},e.name))}}),E.a.createElement(E.a.Fragment,null,n)):null}}])&&Ce(Pe.prototype,Oe),void(Ne&&Ce(Pe,Ne)),xe);function xe(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,xe),ke(this,Me(xe).apply(this,arguments))}function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ue(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Re(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Le,qe,He,We=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(Ge,E.a.PureComponent),Le=Ge,(qe=[{key:"render",value:function(){return 0<this.props.count?E.a.createElement("span",{className:"unread"},9<this.props.count?"9+":this.props.count):null}}])&&Ue(Le.prototype,qe),void(He&&Ue(Le,He)),Ge);function Ge(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ge),Re(this,Fe(Ge).apply(this,arguments))}function Be(e){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ke(e){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ye,Qe,Xe,$e=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(Ze,E.a.Component),Ye=Ze,(Qe=[{key:"handleClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onSelected&&this.props.onSelected(this.props.item,this.props.index,this.props.now,this.props.acs)}},{key:"handleContextClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.showContextMenu({topicName:this.props.item,y:e.pageY,x:e.pageX})}},{key:"render",value:function(){var e=this.props.title;e?30<e.length&&(e=e.substring(0,28)+"..."):e=E.a.createElement("i",null,E.a.createElement(S.FormattedMessage,{id:"unnamed_topic"}));var t=this.props.now?"online":"offline",n=!this.props.avatar||this.props.avatar,a=this.props.badges?this.props.badges.slice():[],o=[];return this.props.acs&&(this.props.showMode&&a.push({name:this.props.acs.getMode(),key:"mode"}),this.props.acs.isMuted()&&o.push({icon:"muted"}),this.props.acs.isJoiner()||o.push({icon:"banned"})),E.a.createElement("li",{className:!this.props.showCheckmark&&this.props.selected?"selected":null,onClick:this.handleClick},E.a.createElement("div",{className:"avatar-box"},E.a.createElement(V,{avatar:n,title:this.props.title,topic:this.props.item}),this.props.showOnline?E.a.createElement("span",{className:t}):this.props.showCheckmark&&this.props.selected?E.a.createElement("i",{className:"checkmark material-icons"},"check_circle"):null),E.a.createElement("div",{className:"text-box"},E.a.createElement("div",null,E.a.createElement("span",{className:"contact-title"},e),E.a.createElement(We,{count:this.props.unread}),E.a.createElement(Ae,{badges:o})),this.props.comment?E.a.createElement("div",{className:"contact-comment"},this.props.comment):null,E.a.createElement(E.a.Fragment,null,E.a.createElement(Ae,{badges:a}))),this.props.showContextMenu?E.a.createElement("span",{className:"menuTrigger"},E.a.createElement("a",{href:"#",onClick:this.handleContextClick},E.a.createElement("i",{className:"material-icons"},"expand_more"))):null)}}])&&Ve(Ye.prototype,Qe),void(Xe&&Ve(Ye,Xe)),Ze);function Ze(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ze),(t=function(e,t){return!t||"object"!==Be(t)&&"function"!=typeof t?ze(e):t}(this,Ke(Ze).call(this,e))).handleClick=t.handleClick.bind(ze(t)),t.handleContextClick=t.handleContextClick.bind(ze(t)),t}function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function at(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt,it,st,lt=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(ct,E.a.PureComponent),rt=ct,(it=[{key:"handleClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onAction(this.props.action)}},{key:"render",value:function(){var e=this.props.intl.formatMessage;return E.a.createElement("li",{onClick:this.handleClick,className:"action"},E.a.createElement("div",{className:"action-text"},e(this.props.title,this.props.values)))}}])&&tt(rt.prototype,it),void(st&&tt(rt,st)),ct);function ct(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ct),(t=function(e,t){return!t||"object"!==et(t)&&"function"!=typeof t?at(e):t}(this,nt(ct).call(this,e))).handleClick=t.handleClick.bind(at(t)),t}var ut=Object(S.injectIntl)(lt);function dt(e){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ht(e,t){return!t||"object"!==dt(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function ft(e){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gt,bt,vt,yt=Object(S.defineMessages)({badge_you:{id:"badge_you",defaultMessage:"you"},badge_owner:{id:"badge_owner",defaultMessage:"owner"}}),_t=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(wt,E.a.Component),gt=wt,(bt=[{key:"render",value:function(){var i=this,s=this.props.intl.formatMessage,l=Array.isArray(this.props.topicSelected),c=[],u=0;return this.props.contacts&&0<this.props.contacts.length&&this.props.contacts.map(function(e){if(e.action)c.push(E.a.createElement(ut,{title:e.title,action:e.action,values:e.values,key:e.action,onAction:i.props.onAction}));else{var t=e.topic?e.topic:e.user;if(i.props.filterFunc&&i.props.filter){var n=[t];if(e.private&&e.private.comment&&n.push((""+e.private.comment).toLowerCase()),e.public&&e.public.fn&&n.push((""+e.public.fn).toLowerCase()),!i.props.filterFunc(i.props.filter,n))return}var a=l?-1<i.props.topicSelected.indexOf(t):i.props.topicSelected===t,o=[];i.props.showMode&&(t===i.props.myUserId&&o.push({name:s(yt.badge_you),color:"green"}),e.acs&&e.acs.isOwner()&&o.push({name:s(yt.badge_owner),color:"blue"}));var r=Array.isArray(e.private)?e.private.join(","):e.private?e.private.comment:null;c.push(E.a.createElement($e,{title:e.public?e.public.fn:null,avatar:Y(e.public?e.public.photo:null),comment:r,unread:i.props.showUnread?e.unread:0,now:e.online&&i.props.connected,acs:e.acs,showMode:i.props.showMode,badges:o,showCheckmark:l,selected:a,showOnline:i.props.showOnline,onSelected:i.props.onTopicSelected,showContextMenu:i.props.showContextMenu,item:t,index:c.length,key:t})),u++}},this),E.a.createElement("div",{className:this.props.noScroll?null:"scrollable-panel"},0==u?E.a.createElement("div",{className:"center-medium-text",dangerouslySetInnerHTML:{__html:this.props.emptyListMessage}}):null,0<c.length?E.a.createElement("ul",{className:"contact-box"},c):null)}}])&&pt(gt.prototype,bt),void(vt&&pt(gt,vt)),wt);function wt(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,wt),ht(this,ft(wt).apply(this,arguments))}var Et=Object(S.injectIntl)(_t);function St(e){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function kt(e,t){return!t||"object"!==St(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tt(e,t){return(Tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pt,Ot,Nt,jt=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tt(e,t)}(At,E.a.PureComponent),Pt=At,(Ot=[{key:"render",value:function(){var t=this;return E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onCancel()}},E.a.createElement("i",{className:"material-icons"},"close"))}}])&&Ct(Pt.prototype,Ot),void(Nt&&Ct(Pt,Nt)),At);function At(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,At),kt(this,Mt(At).apply(this,arguments))}function xt(e){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Dt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ft(e,t){return(Ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var It,Lt,qt,Ht=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ft(e,t)}(Wt,E.a.PureComponent),It=Wt,(Lt=[{key:"componentDidUpdate",value:function(e){e.level!==this.props.level&&this.setState({show:!!this.props.level})}},{key:"hide",value:function(){this.setState({show:!1}),this.props.onClearError&&this.props.onClearError()}},{key:"render",value:function(){var t=this,e={err:"error",warn:"warning",info:"info"}[this.props.level]||"",n="alert-box "+e;return E.a.createElement("div",{className:n},E.a.createElement("div",{className:"icon"},E.a.createElement("i",{className:"material-icons"},e)),E.a.createElement(E.a.Fragment,null,E.a.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.text}}),this.props.action?E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.action()}},this.props.actionText):null),E.a.createElement("div",{className:"cancel"},E.a.createElement(jt,{onCancel:this.hide})))}}])&&Dt(It.prototype,Lt),void(qt&&Dt(It,qt)),Wt);function Wt(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Wt),(t=function(e,t){return!t||"object"!==xt(t)&&"function"!=typeof t?Rt(e):t}(this,Ut(Wt).call(this,e))).state={show:!1},t.hide=t.hide.bind(Rt(t)),t}function Gt(e){return(Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bt(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Vt(e){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zt(e,t){return(zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jt,Yt,Qt,Xt=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zt(e,t)}($t,E.a.PureComponent),Jt=$t,(Yt=[{key:"handleCancel",value:function(e){e.preventDefault(),this.props.onCancel(this.props.topic,this.props.index)}},{key:"render",value:function(){var e=this.props.title||this.props.topic,t=this.props.invalid?"chip invalid":"chip";return E.a.createElement("div",{className:t},this.props.noAvatar?E.a.createElement("span",{className:"spacer"}):E.a.createElement("div",{className:"avatar-box"},E.a.createElement(V,{avatar:this.props.avatar||!0,topic:this.props.topic,title:this.props.title})),E.a.createElement("span",null,e),this.props.onCancel&&!this.props.required?E.a.createElement("a",{href:"#",onClick:this.handleCancel},"×"):E.a.createElement("span",{className:"spacer"}))}}])&&Bt(Jt.prototype,Yt),void(Qt&&Bt(Jt,Qt)),$t);function $t(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,$t),(t=function(e,t){return!t||"object"!==Gt(t)&&"function"!=typeof t?Kt(e):t}(this,Vt($t).call(this,e))).handleCancel=t.handleCancel.bind(Kt(t)),t}function Zt(e){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function en(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function tn(e){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function an(e,t){return(an=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var on,rn,sn,ln=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&an(e,t)}(cn,E.a.Component),on=cn,sn=[{key:"deriveStateFromProps",value:function(e){return{placeholder:e.chips?"":e.prompt,sortedChips:cn.sortChips(e.chips,e.staticMembers),chipIndex:cn.indexChips(e.chips)}}},{key:"indexChips",value:function(e){var t={},n=0;return e.map(function(e){t[e.user]=n,n++}),t}},{key:"sortChips",value:function(e,t){var n=[],a=[];return e.map(function(e){t.includes(e.user)?n.push(e):a.push(e)}),n.concat(a)}}],(rn=[{key:"componentDidUpdate",value:function(e,t){e.chips==this.props.chips&&e.staticMembers==this.props.staticMembers&&e.prompt==this.props.prompt||this.setState(cn.deriveStateFromProps(this.props)),(!t||this.props.chips.length>t.sortedChips.length)&&this.setState({input:""})}},{key:"handleTextInput",value:function(e){this.setState({input:e.target.value}),this.props.filterFunc&&this.props.filterFunc(e.target.value)}},{key:"removeChipAt",value:function(e){var t=this.state.sortedChips[e];this.props.onChipRemoved(t.user,this.state.chipIndex[t.user])}},{key:"handleChipCancel",value:function(e,t){this.removeChipAt(t)}},{key:"handleFocusGained",value:function(){this.setState({focused:!0})}},{key:"handleFocusLost",value:function(){this.setState({focused:!1}),this.props.onFocusLost&&this.props.onFocusLost(this.state.input)}},{key:"handleKeyDown",value:function(e){if("Backspace"===e.key){if(0==this.state.input.length&&0<this.state.sortedChips.length){var t=this.state.sortedChips.length-1;this.state.sortedChips[t].user!==this.props.staticMembers&&this.removeChipAt(t)}}else"Enter"===e.key?this.props.onEnter&&this.props.onEnter(this.state.input):"Escape"===e.key&&this.props.onCancel&&this.props.onCancel()}},{key:"render",value:function(){var t=this,n=[],a=0;this.state.sortedChips.map(function(e){n.push(E.a.createElement(Xt,{onCancel:t.handleChipCancel,avatar:Y(e.public?e.public.photo:null),title:e.public?e.public.fn:void 0,noAvatar:t.props.avatarDisabled,topic:e.user,required:t.props.staticMembers.includes(e.user),invalid:e.invalid,index:a,key:e.user})),a++});var e="chip-input"+(this.state.focused?" focused":"");return E.a.createElement("div",{className:e},n,E.a.createElement("input",{type:"text",placeholder:this.state.placeholder,onChange:this.handleTextInput,onFocus:this.handleFocusGained,onBlur:this.handleFocusLost,onKeyDown:this.handleKeyDown,value:this.state.input,autoFocus:!0}))}}])&&en(on.prototype,rn),void(sn&&en(on,sn)),cn);function cn(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,cn),(t=function(e,t){return!t||"object"!==Zt(t)&&"function"!=typeof t?nn(e):t}(this,tn(cn).call(this,e))).state=cn.deriveStateFromProps(e),t.state.input="",t.state.focused=!1,t.handleTextInput=t.handleTextInput.bind(nn(t)),t.removeChipAt=t.removeChipAt.bind(nn(t)),t.handleChipCancel=t.handleChipCancel.bind(nn(t)),t.handleFocusGained=t.handleFocusGained.bind(nn(t)),t.handleFocusLost=t.handleFocusLost.bind(nn(t)),t.handleKeyDown=t.handleKeyDown.bind(nn(t)),t}function un(e){return(un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fn(e,t){return(fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var mn,gn,bn,vn=Object(S.defineMessages)({no_contacts:{id:"no_contacts",defaultMessage:"You have no contacts :-("},contacts_not_found:{id:"contacts_not_found_short",defaultMessage:"No contacts match '{query}'"}}),yn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fn(e,t)}(_n,E.a.Component),mn=_n,bn=[{key:"indexMembers",value:function(e){var t={};return e.map(function(e){t[e.user]={delta:0,present:!0}}),t}},{key:"staticMembers",value:function(e,t,n){var a=[];return e.map(function(e){!t&&e.user!=n||a.push(e.user)}),a}},{key:"selectedContacts",value:function(e){var t=[];return e.map(function(e){t.push(e.user)}),t}},{key:"doContactFiltering",value:function(e,t){if(e){for(var n=0;n<t.length;n++)if(0<=t[n].indexOf(e))return!0;return!1}return!0}}],(gn=[{key:"handleContactSelected",value:function(e,t){var n=this.state.index[e];if(n){if(n.present)return;n.delta+=1,n.present=!0}else n={delta:1,present:!0};var a=this.state.members.slice();a.push(this.props.contacts[t]);var o=_n.selectedContacts(a),r=this.state.index;r[e]=n,this.setState({members:a,index:r,selectedContacts:o})}},{key:"handleMemberRemoved",value:function(e,t){var n=this.state.index[e];if(n&&n.present){n.present=!1,n.delta-=1;var a=this.state.members.slice();a.splice(t,1);var o=_n.selectedContacts(a),r=this.state.index;r[e]=n,this.setState({members:a,index:r,selectedContacts:o})}}},{key:"handleContactFilter",value:function(e){var t=this.props.intl.formatMessage,n=e?t(vn.contacts_not_found,{query:e}):t(vn.no_contacts);this.setState({contactFilter:e,noContactsMessage:n})}},{key:"handleSubmit",value:function(){var t=this,n=[],a=[],o=[];Object.keys(this.state.index).map(function(e){t.state.index[e].present&&n.push(e),0<t.state.index[e].delta?a.push(e):t.state.index[e].delta<0&&o.push(e)}),this.props.onSubmit(n,a,o)}},{key:"handleCancel",value:function(){this.props.onCancel()}},{key:"render",value:function(){return this.props.intl.formatMessage,E.a.createElement("div",{id:"group-manager"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"title_group_members",defaultMessage:"Group Members"}))),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(ln,{chips:this.state.members,staticMembers:this.state.staticMembers,prompt:"add members",filterFunc:this.handleContactFilter,onChipRemoved:this.handleMemberRemoved})),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"title_all_contacts",defaultMessage:"All Contacts"}))),E.a.createElement(Et,{contacts:this.props.contacts,myUserId:this.props.myUserId,topicSelected:this.state.selectedContacts,filter:this.state.contactFilter,filterFunc:_n.doContactFiltering,emptyListMessage:this.state.noContactsMessage,showOnline:!1,showUnread:!1,onTopicSelected:this.handleContactSelected}),E.a.createElement("div",{id:"group-manager-buttons",className:"panel-form-row"},E.a.createElement("button",{className:"blue",onClick:this.handleSubmit},E.a.createElement(S.FormattedMessage,{id:"button_ok",defaultMessage:"OK"})),E.a.createElement("button",{className:"white",onClick:this.handleCancel},E.a.createElement(S.FormattedMessage,{id:"button_cancel",defaultMessage:"Cancel"}))))}}])&&dn(mn.prototype,gn),void(bn&&dn(mn,bn)),_n);function _n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_n),(t=function(e,t){return!t||"object"!==un(t)&&"function"!=typeof t?hn(e):t}(this,pn(_n).call(this,e))).state={members:e.members,index:_n.indexMembers(e.members),staticMembers:_n.staticMembers(e.members,e.keepInitialMembers,e.requiredMember),contactFilter:"",noContactsMessage:e.intl.formatMessage(vn.no_contacts),selectedContacts:_n.selectedContacts(e.members)},t.handleContactSelected=t.handleContactSelected.bind(hn(t)),t.handleMemberRemoved=t.handleMemberRemoved.bind(hn(t)),t.handleContactFilter=t.handleContactFilter.bind(hn(t)),t.handleSubmit=t.handleSubmit.bind(hn(t)),t.handleCancel=t.handleCancel.bind(hn(t)),t}var wn=Object(S.injectIntl)(yn);function En(e){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Cn(e){return(Cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mn(e,t){return(Mn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tn,Pn,On,Nn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mn(e,t)}(jn,E.a.PureComponent),Tn=jn,(Pn=[{key:"handeTextChange",value:function(e){this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)}},{key:"handleVisibility",value:function(e){e.preventDefault(),this.setState({visible:!this.state.visible})}},{key:"handleKeyDown",value:function(e){27==e.keyCode?(this.setState({value:this.props.value,visible:!1}),this.props.onFinished&&this.props.onFinished()):13==e.keyCode&&this.handleEditingFinished()}},{key:"handleEditingFinished",value:function(e){var t=this;if(e){var n=e.currentTarget;setTimeout(function(){n.contains(document.activeElement)||t.props.onFinished&&t.props.onFinished(t.state.value)},0)}else this.props.onFinished&&this.props.onFinished(this.state.value.trim())}},{key:"render",value:function(){return E.a.createElement("div",{tabIndex:"-1",className:"group-focus",onBlur:this.handleEditingFinished},E.a.createElement("input",{className:"with-visibility",type:this.state.visible?"text":"password",value:this.state.value,placeholder:this.props.placeholder,required:this.props.required?"required":"",autoFocus:this.props.autoFocus?"autoFocus":"",autoComplete:this.props.autoComplete,onChange:this.handeTextChange,onKeyDown:this.handleKeyDown}),E.a.createElement("span",{onClick:this.handleVisibility},E.a.createElement("i",{className:"material-icons clickable light-gray"},this.state.visible?"visibility":"visibility_off")))}}])&&Sn(Tn.prototype,Pn),void(On&&Sn(Tn,On)),jn);function jn(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,jn),(t=function(e,t){return!t||"object"!==En(t)&&"function"!=typeof t?kn(e):t}(this,Cn(jn).call(this,e))).state={value:t.props.value,visible:!1},t.handleVisibility=t.handleVisibility.bind(kn(t)),t.handeTextChange=t.handeTextChange.bind(kn(t)),t.handleKeyDown=t.handleKeyDown.bind(kn(t)),t.handleEditingFinished=t.handleEditingFinished.bind(kn(t)),t}function An(e){return(An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Dn(e){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Un(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rn(e,t){return(Rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fn,In,Ln,qn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rn(e,t)}(Hn,E.a.Component),Fn=Hn,(In=[{key:"componentDidUpdate",value:function(e,t){var n=this.props.value||"";t.initialValue==n||t.active||this.setState({initialValue:n,value:n})}},{key:"handeTextChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleKeyDown",value:function(e){27===e.keyCode?this.setState({value:this.props.value,active:!1}):13===e.keyCode&&this.handleEditingFinished(e)}},{key:"handleStartEditing",value:function(){this.props.readOnly||(r.a.findDOMNode(this).focus(),this.setState({active:!0}))}},{key:"handleEditingFinished",value:function(e){if(!this.props.required||e.target.checkValidity()){this.setState({active:!1});var t=this.state.value.trim();(t||this.props.value)&&t!==this.props.value&&this.props.onFinished(t)}else this.setState({value:this.props.value,active:!1})}},{key:"handlePasswordFinished",value:function(e){this.setState({active:!1}),e&&e!==this.props.value&&this.props.onFinished(e)}},{key:"render",value:function(){if(this.state.active)var e=this.props.type||"text";else{var t="password"==this.props.type?"••••••••":this.state.value,n="in-place-edit"+(this.props.readOnly?" disabled":"");t||(t=this.props.placeholder,n+=" placeholder"),20<t.length&&(t=t.substring(0,19)+"...")}return this.state.active?"password"==e?E.a.createElement(Nn,{value:this.state.value,placeholder:this.props.placeholder,required:this.props.required?"required":"",autoComplete:this.props.autoComplete,autoFocus:!0,onFinished:this.handlePasswordFinished}):E.a.createElement("input",{type:e,value:this.state.value,placeholder:this.props.placeholder,required:this.props.required?"required":"",autoComplete:this.props.autoComplete,autoFocus:!0,onChange:this.handeTextChange,onKeyDown:this.handleKeyDown,onBlur:this.handleEditingFinished}):E.a.createElement("span",{className:n,onClick:this.handleStartEditing},E.a.createElement("span",{className:"content"},t))}}])&&xn(Fn.prototype,In),void(Ln&&xn(Fn,Ln)),Hn);function Hn(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Hn),(t=function(e,t){return!t||"object"!==An(t)&&"function"!=typeof t?Un(e):t}(this,Dn(Hn).call(this,e))).state={active:e.active,initialValue:e.value||"",value:e.value||""},t.handeTextChange=t.handeTextChange.bind(Un(t)),t.handleKeyDown=t.handleKeyDown.bind(Un(t)),t.handleStartEditing=t.handleStartEditing.bind(Un(t)),t.handleEditingFinished=t.handleEditingFinished.bind(Un(t)),t.handlePasswordFinished=t.handlePasswordFinished.bind(Un(t)),t}function Wn(e){return(Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Bn(e){return(Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kn(e,t){return(Kn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zn,Jn,Yn,Qn=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kn(e,t)}(Xn,E.a.PureComponent),zn=Xn,(Jn=[{key:"handleToggle",value:function(){var e=!this.state.open;this.setState({open:e}),this.props.onToggle&&this.props.onToggle(e)}},{key:"render",value:function(){return E.a.createElement("label",{className:"small clean-clickable",onClick:this.handleToggle},this.props.title,"...",this.state.open?E.a.createElement("i",{className:"material-icons"},"expand_more"):E.a.createElement("i",{className:"material-icons"},"chevron_right"))}}])&&Gn(zn.prototype,Jn),void(Yn&&Gn(zn,Yn)),Xn);function Xn(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Xn),(t=function(e,t){return!t||"object"!==Wn(t)&&"function"!=typeof t?Vn(e):t}(this,Bn(Xn).call(this,e))).state={open:e.open},t.handleToggle=t.handleToggle.bind(Vn(t)),t}function $n(e){return($n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zn(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ea(e){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ta(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function na(e,t){return(na=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var aa,oa,ra,ia=Object(S.defineMessages)({joiner:{id:"permission_join",defaultMessage:"Join ({val})"},reader:{id:"permission_read",defaultMessage:"Read ({val})"},writer:{id:"permission_write",defaultMessage:"Write ({val})"},preser:{id:"permission_pres",defaultMessage:"Get notified ({val})"},approver:{id:"permission_admin",defaultMessage:"Approve ({val})"},sharer:{id:"permission_share",defaultMessage:"Share ({val})"},deleter:{id:"permission_delete",defaultMessage:"Delete ({val})"},owner:{id:"permission_owner",defaultMessage:"Owner ({val})"}}),sa=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&na(e,t)}(la,E.a.Component),aa=la,(oa=[{key:"handleChange",value:function(e){var t=this.state.mode;-1==t.indexOf(e)?t+=e:t=t.replace(e,""),this.setState({mode:t})}},{key:"handleSubmit",value:function(){var e=(this.state.mode||"N").split("").sort().join("");e!==(this.props.mode||"N").split("").sort().join("")?this.props.onSubmit(e):this.props.onCancel()}},{key:"handleCancel",value:function(){this.props.onCancel()}},{key:"render",value:function(){for(var e=this.props.intl.formatMessage,t="JRWPASDO",n={J:e(ia.joiner,{val:"J"}),R:e(ia.reader,{val:"R"}),W:e(ia.writer,{val:"W"}),P:e(ia.preser,{val:"P"}),A:e(ia.approver,{val:"A"}),S:e(ia.sharer,{val:"S"}),D:e(ia.deleter,{val:"D"}),O:e(ia.owner,{val:"O"})},a=this.props.skip||"",o=this.state.mode,r=(this.props.compare||"").replace("N",""),i=[],s=0;s<t.length;s++){var l=t.charAt(s);0<=a.indexOf(l)&&o.indexOf(l)<0||i.push(E.a.createElement("tr",{key:l},E.a.createElement("td",null,n[l]),E.a.createElement("td",{className:"checkbox"},a.indexOf(l)<0?E.a.createElement(we,{name:l,checked:0<=o.indexOf(l),onChange:this.handleChange}):E.a.createElement(we,{name:l,checked:0<=o.indexOf(l)})),this.props.compare?E.a.createElement("td",{className:"checkbox"},E.a.createElement(we,{name:l,checked:0<=r.indexOf(l)})):null))}return E.a.createElement("div",{className:"panel-form-column"},this.props.userTitle?E.a.createElement("ul",{className:"contact-box"},E.a.createElement($e,{item:this.props.item,title:this.props.userTitle,avatar:Y(this.props.userAvatar?this.props.userAvatar:null)})):null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"title_permissions",defaultMessage:"Permissions"})),E.a.createElement("table",{className:"permission-editor"},this.props.compare?E.a.createElement("thead",null,E.a.createElement("tr",null,E.a.createElement("th",null),E.a.createElement("th",null,this.props.modeTitle),E.a.createElement("th",null,this.props.compareTitle))):null,E.a.createElement("tbody",null,i)),E.a.createElement("br",null),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:"blue",onClick:this.handleSubmit},E.a.createElement(S.FormattedMessage,{id:"button_ok"})),E.a.createElement("button",{className:"white",onClick:this.handleCancel},E.a.createElement(S.FormattedMessage,{id:"button_cancel"}))))}}])&&Zn(aa.prototype,oa),void(ra&&Zn(aa,ra)),la);function la(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,la),(t=function(e,t){return!t||"object"!==$n(t)&&"function"!=typeof t?ta(e):t}(this,ea(la).call(this,e))).state={mode:(e.mode||"").replace("N","")},t.handleChange=t.handleChange.bind(ta(t)),t.handleSubmit=t.handleSubmit.bind(ta(t)),t.handleCancel=t.handleCancel.bind(ta(t)),t}var ca=Object(S.injectIntl)(sa);function ua(e){var t=document.getElementById("shortcut-icon"),n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("link");a.type="image/png",a.id="shortcut-icon",a.rel="shortcut icon",a.href="img/logo32x32"+(0<e?"a":"")+".png",t&&n.removeChild(t),n.appendChild(a),document.title=(0<e?"("+e+") ":"")+"Tinode"}function da(e,t){var n=null;if((e&&e.trim()||t)&&(n={},e&&(n.fn=e.trim()),t)){var a=t.indexOf(",");n.photo=0<=a?{data:t.substring(a+1),type:"jpg"}:t}return n}function pa(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!=t.length)return!1;e.sort(),t.sort();for(var n=0,a=e.length;n<a;n++)if(e[n]!==t[n])return!1;return!0}function ha(e,t){if(!e)return null;if(e=e.replace(/[^\x20-\x7E]/gim,"").trim(),!/^([a-z][a-z0-9+.-]*:|\/\/)/i.test(e))return e;if(/^blob:http/.test(e))return e;var n=Array.isArray(t)?t.join("|"):"http|https";return new RegExp("^(("+n+"):|//)","i").test(e)?e:null}function fa(e){return(fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ma(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ga(e){return(ga=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ba(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function va(e,t){return(va=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ya,_a,wa,Ea=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&va(e,t)}(Sa,E.a.Component),ya=Sa,wa=[{key:"getDerivedStateFromProps",value:function(e,t){return pa(e.tags,t.tags)||t.activated?null:{tags:e.tags}}}],(_a=[{key:"handleTagInput",value:function(e){if(this.setState({tagInput:e}),0<e.length){var t=e[e.length-1];'"'==e[0]?1<e.length&&'"'==t&&this.handleAddTag(e.substring(1,e.length-1)):","!=t&&" "!=t&&";"!=t&&'"'!=t||this.handleAddTag(e.substring(0,e.length-1).trim())}}},{key:"handleAddTag",value:function(e){if(0<e.length){var t=this.state.tags.slice(0);return t.push(e),this.setState({tags:t,tagInput:""}),this.props.onTagsChanged&&this.props.onTagsChanged(t),t}return this.state.tags}},{key:"handleRemoveTag",value:function(e,t){var n=this.state.tags.slice(0);n.splice(t,1),this.setState({tags:n}),this.props.onTagsChanged&&this.props.onTagsChanged(n)}},{key:"handleSubmit",value:function(){this.props.onSubmit(this.handleAddTag(this.state.tagInput.trim())),this.setState({activated:!1,tags:this.props.tags})}},{key:"handleCancel",value:function(){this.setState({activated:!1,tagInput:"",tags:this.props.tags}),this.props.onCancel&&this.props.onCancel()}},{key:"render",value:function(){var t=this,n=[];return this.state.activated?this.state.tags.map(function(e){n.push({user:e,invalid:e.length<4})}):(this.state.tags.map(function(e){n.push(E.a.createElement("span",{className:"badge",key:n.length},e))}),0==n.length&&(n=E.a.createElement("i",null,E.a.createElement(S.FormattedMessage,{id:"tags_not_found",defaultMessage:"No tags defined. Add some."})))),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},this.props.title)),this.state.activated?E.a.createElement("div",null,E.a.createElement(S.FormattedMessage,{id:"tags_editor_no_tags",defaultMessage:"Add some tags"},function(e){return E.a.createElement(ln,{chips:n,avatarDisabled:!0,prompt:e,onEnter:t.handleAddTag,onFocusLost:t.handleAddTag,onCancel:t.handleCancel,onChipRemoved:t.handleRemoveTag,filterFunc:t.handleTagInput})}),this.props.onSubmit||this.props.onCancel?E.a.createElement("div",{id:"tag-manager-buttons",className:"panel-form-row"},E.a.createElement("button",{className:"blue",onClick:this.handleSubmit},E.a.createElement(S.FormattedMessage,{id:"button_ok",defautMessage:"OK",description:"Confirmation button [OK]"})),E.a.createElement("button",{className:"white",onClick:this.handleCancel},E.a.createElement(S.FormattedMessage,{id:"button_cancel",defautMessage:"Cancel",description:"Rejection button [Cancel]"}))):null):E.a.createElement("div",{className:"quoted"},E.a.createElement("a",{href:"#",className:"flat-button",onClick:function(e){e.preventDefault(),t.setState({activated:!0})}},E.a.createElement("i",{className:"material-icons"},"edit"),"  ",E.a.createElement(S.FormattedMessage,{id:"title_manage_tags",defaultMessage:"Manage"})),E.a.createElement(E.a.Fragment,null,n)))}}])&&ma(ya.prototype,_a),void(wa&&ma(ya,wa)),Sa);function Sa(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Sa),(t=function(e,t){return!t||"object"!==fa(t)&&"function"!=typeof t?ba(e):t}(this,ga(Sa).call(this,e))).state={tags:t.props.tags,tagInput:"",activated:t.props.activated},t.handleTagInput=t.handleTagInput.bind(ba(t)),t.handleAddTag=t.handleAddTag.bind(ba(t)),t.handleRemoveTag=t.handleRemoveTag.bind(ba(t)),t.handleSubmit=t.handleSubmit.bind(ba(t)),t.handleCancel=t.handleCancel.bind(ba(t)),t}function Ca(e){return(Ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ka(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ma(e){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ta(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pa(e,t){return(Pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Oa,Na,ja,Aa=Object(S.defineMessages)({requested:{id:"requested_permissions",defaultMessage:"Requested"},granted:{id:"granted_permissions",defaultMessage:"Granted"},edit_permissions:{id:"menu_item_edit_permissions",defaultMessage:"Edit permissions"},other_user:{id:"label_other_user",defaultMessage:"Other"}}),xa=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pa(e,t)}(Da,E.a.Component),Oa=Da,(Na=[{key:"componentDidUpdate",value:function(e){var t=this.props.tinode.getTopic(e.topic);t&&(this.onMetaDesc!=t.onMetaDesc&&(this.previousMetaDesc=t.onMetaDesc,t.onMetaDesc=this.onMetaDesc,this.previousSubsUpdated=t.onSubsUpdated,t.onSubsUpdated=this.onSubsUpdated,"grp"==t.getType()?(this.previousTagsUpdated=t.onTagsUpdated,t.onTagsUpdated=this.onTagsUpdated):this.previousTagsUpdated=void 0),this.state.topic!=e.topic&&(this.setState({topic:e.topic}),this.resetDesc(t,e),this.resetSubs(t,e)))}},{key:"componentWillUnmount",value:function(){var e=this.props.tinode.getTopic(this.props.topic);e&&(this.setState({topic:null}),e.onMetaDesc=this.previousMetaDesc,e.onSubsUpdated=this.previousSubsUpdated,e.onTagsUpdated=this.previousTagsUpdated)}},{key:"resetSubs",value:function(e,t){var n={contactList:[]};if("p2p"==e.getType()){var a=e.subscriber(t.topic);a?(n.modeGiven2=a.acs.getGiven(),n.modeWant2=a.acs.getWant()):(n.modeGiven2="N",n.modeWant2="N")}else e.subscribers(function(e){n.contactList.push(e)},this);this.setState(n)}},{key:"resetDesc",value:function(e,t){var n=e.getDefaultAccess()||{},a=e.getAccessMode();this.setState({owner:a&&a.isOwner(),admin:a&&a.isAdmin(),sharer:a&&a.isSharer(),muted:a&&a.isMuted(),fullName:e.public?e.public.fn:void 0,avatar:Y(e.public?e.public.photo:null),private:e.private?e.private.comment:null,address:e.name,groupTopic:"grp"==e.getType(),showMemberPanel:!1,access:a?a.getMode():void 0,modeGiven:a?a.getGiven():void 0,modeWant:a?a.getWant():void 0,auth:n.auth,anon:n.anon}),"grp"==e.getType()&&a&&a.isOwner()&&e.getMeta(e.startMetaQuery().withTags().build())}},{key:"onMetaDesc",value:function(e){var t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetDesc(t,this.props),this.previousMetaDesc&&this.previousMetaDesc!=this.onMetaDesc&&this.previousMetaDesc(e))}},{key:"onSubsUpdated",value:function(e){var t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetSubs(t,this.props),this.previousSubsUpdated&&this.previousSubsUpdated!=this.onSubsUpdated&&this.previousSubsUpdated(e))}},{key:"onTagsUpdated",value:function(e){this.setState({tags:e}),this.previousTagsUpdated&&this.previousTagsUpdated!=this.onTagsUpdated&&this.previousTagsUpdated()}},{key:"handleFullNameUpdate",value:function(e){e=e.trim(),this.state.fullName!==e&&(this.setState({fullName:e}),this.props.onTopicDescUpdate(this.props.topic,da(e,null),null))}},{key:"handlePrivateUpdate",value:function(e){this.state.priv!==e&&(this.setState({private:e}),this.props.onTopicDescUpdate(this.props.topic,null,e||C.a.DEL_CHAR))}},{key:"handleImageChanged",value:function(e){this.setState({avatar:e}),this.props.onTopicDescUpdate(this.props.topic,da(null,e||C.a.DEL_CHAR),null)}},{key:"handleMuted",value:function(e,t){this.setState({muted:t}),this.props.onChangePermissions(this.props.topic,t?"-P":"+P")}},{key:"handlePermissionsChanged",value:function(e){switch(this.state.showPermissionEditorFor){case"auth":this.props.onTopicDescUpdate(this.props.topic,null,null,{auth:e});break;case"anon":this.props.onTopicDescUpdate(this.props.topic,null,null,{anon:e});break;case"mode":case"want":this.props.onChangePermissions(this.props.topic,e);break;case"given":this.props.onChangePermissions(this.props.topic,e,this.props.topic);break;case"user":this.props.onChangePermissions(this.props.topic,e,this.state.userPermissionsEdited)}this.setState({showPermissionEditorFor:void 0})}},{key:"handleLaunchPermissionsEditor",value:function(e,t){var n,a,o,r,i,s,l,c=this.props.intl.formatMessage;switch(e){case"mode":n=this.state.access;break;case"want":n=this.state.modeWant,a=this.state.modeGiven,o=this.state.groupTopic?"O":"ASDO",r=c(Aa.requested),i=c(Aa.granted);break;case"given":n=this.state.modeGiven2,a=this.state.modeWant2,o=this.state.groupTopic?this.state.owner?"":"O":"ASDO",r=c(Aa.granted),i=c(Aa.requested);break;case"auth":n=this.state.auth,o="O";break;case"anon":n=this.state.anon,o="O";break;case"user":var u=this.props.tinode.getTopic(this.props.topic);if(!u)return;var d=u.subscriber(t);if(!d||!d.acs)return;n=d.acs.getGiven(),a=d.acs.getWant(),o=this.state.owner?"":"O",r=c(Aa.granted),i=c(Aa.requested),d.public&&(s=d.public.fn,l=d.public.photo);break;default:console.log("Unknown permission editing mode '"+e+"'")}this.setState({showPermissionEditorFor:e,userPermissionsEdited:t,userPermissionsTitle:s,userPermissionsAvatar:l,editedPermissions:n,immutablePermissions:a,editedPermissionsTitle:r,immutablePermissionsTitle:i,editedPermissionsSkipped:o})}},{key:"handleHidePermissionsEditor",value:function(){this.setState({showPermissionEditorFor:void 0})}},{key:"handleShowAddMembers",value:function(e){e.preventDefault(),this.props.onInitFind(),this.setState({showMemberPanel:!0})}},{key:"handleHideAddMembers",value:function(){this.setState({showMemberPanel:!1})}},{key:"handleMemberUpdateRequest",value:function(e,t,n){this.props.onMemberUpdateRequest(this.props.topic,t,n),this.setState({showMemberPanel:!1})}},{key:"handleLeave",value:function(e){e.preventDefault(),this.props.onLeaveTopic(this.props.topic)}},{key:"handleMemberSelected",value:function(e){this.setState({selectedContact:e})}},{key:"handleMoreInfo",value:function(e){this.setState({moreInfoExpanded:e})}},{key:"handleTagsUpdated",value:function(e){pa(this.state.tags.slice(0),e.slice(0))||this.props.onTopicTagsUpdate(this.props.topic,e)}},{key:"handleContextMenu",value:function(e){var t=this.props.intl.formatMessage,n=this,a=this.props.tinode.getTopic(this.props.topic);if(a){var o=a.subscriber(e.topicName);if(o&&o.acs){var r=[{title:t(Aa.edit_permissions),handler:function(){n.handleLaunchPermissionsEditor("user",e.topicName)}},"member_delete",o.acs.isMuted()?"member_unmute":"member_mute",o.acs.isJoiner()?"member_block":"member_unblock"];this.props.showContextMenu({topicName:this.props.topic,x:e.x,y:e.y,user:e.topicName},r)}}}},{key:"render",value:function(){var t=this,e=this.props.intl.formatMessage;return E.a.createElement("div",{id:"info-view"},E.a.createElement("div",{className:"caption-panel",id:"info-caption-panel"},E.a.createElement("div",{className:"panel-title",id:"info-title"},E.a.createElement(S.FormattedMessage,{id:"title_info",defaultMessage:"Info"})),E.a.createElement("div",null,E.a.createElement(jt,{onCancel:this.props.onCancel}))),this.props.displayMobile?E.a.createElement(Ht,{level:this.props.errorLevel,text:this.props.errorText,onClearError:this.props.onError}):null,this.state.showMemberPanel?E.a.createElement(wn,{members:this.state.contactList,requiredMember:this.props.myUserId,keepInitialMembers:!this.state.admin&&!this.state.owner,myUserId:this.props.myUserId,contacts:this.props.searchableContacts,onCancel:this.handleHideAddMembers,onSubmit:this.handleMemberUpdateRequest}):this.state.showPermissionEditorFor?E.a.createElement(ca,{mode:this.state.editedPermissions,compare:this.state.immutablePermissions,skip:this.state.editedPermissionsSkipped,modeTitle:this.state.editedPermissionsTitle,compareTitle:this.state.immutablePermissionsTitle,userTitle:this.state.userPermissionsTitle,item:this.state.userPermissionsEdited,userAvatar:this.state.userPermissionsAvatar,onSubmit:this.handlePermissionsChanged,onCancel:this.handleHidePermissionsEditor}):E.a.createElement("div",{id:"info-view-content",className:"scrollable-panel"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_topic_name",defaultMessage:"Name"}))),E.a.createElement("div",null,E.a.createElement(qn,{placeholder:this.state.groupTopic?"Group name":E.a.createElement("i",null,"Unknown"),readOnly:!this.state.owner,value:this.state.fullName,required:!0,onFinished:this.handleFullNameUpdate})),E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_private",defaultMessage:"Private comment"}))),E.a.createElement("div",null,E.a.createElement(S.FormattedMessage,{id:"private_editing_placeholder",defaultMessage:"Visible to you only"},function(e){return E.a.createElement(qn,{placeholder:e,value:t.state.private,onFinished:t.handlePrivateUpdate})}))),E.a.createElement(de,{avatar:this.state.avatar,readOnly:!this.state.owner,uid:this.props.topic,title:this.state.fullName,onImageChanged:this.handleImageChanged,onError:this.props.onError})),E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",null,E.a.createElement(S.FormattedMessage,{id:"label_muting_topic",defaultMessage:"Muted:"})),E.a.createElement(we,{name:"P",checked:this.state.muted,onChange:this.handleMuted})),E.a.createElement(S.FormattedMessage,{id:"action_more",defaultMessage:"More"},function(e){return E.a.createElement(Qn,{title:e,open:t.state.moreInfoExpanded,onToggle:t.handleMoreInfo})}),this.state.moreInfoExpanded?E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",null,E.a.createElement(S.FormattedMessage,{id:"label_user_id"})),E.a.createElement("tt",null,this.state.address)),this.state.groupTopic?E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",null,E.a.createElement(S.FormattedMessage,{id:"label_your_permissions",defaultMessage:"Your permissions:"})),E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"want")},this.state.access)):E.a.createElement("div",null,E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_permissions",defaultMessage:"Permissions:"}))),E.a.createElement("div",{className:"quoted"},E.a.createElement("div",null,E.a.createElement(S.FormattedMessage,{id:"label_you",defaultMessage:"You:"}),"  ",E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"want")},this.state.access)),E.a.createElement("div",null,this.state.fullName?this.state.fullName:e(Aa.other_user),":  ",E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"given")},this.state.modeGiven2)))),this.state.sharer&&(this.state.auth||this.state.anon)?E.a.createElement("div",null,E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_default_access",defaultMessage:"Default access mode:"}))),E.a.createElement("div",{className:"quoted"},E.a.createElement("div",null,"Auth: ",this.state.admin?E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"auth")},this.state.auth):E.a.createElement("tt",null,this.state.auth)),E.a.createElement("div",null,"Anon: ",this.state.admin?E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"anon")},this.state.anon):E.a.createElement("tt",null,this.state.anon)))):null):null),E.a.createElement("div",{className:"hr"}),this.state.owner?E.a.createElement(E.a.Fragment,null,E.a.createElement(S.FormattedMessage,{id:"title_tag_manager"},function(e){return E.a.createElement(Ea,{title:e,tags:t.state.tags,activated:!1,onSubmit:t.handleTagsUpdated})}),E.a.createElement("div",{className:"hr"})):null,E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("a",{href:"#",className:"flat-button",onClick:this.handleDeleteMessages},E.a.createElement("i",{className:"material-icons"},"delete_outline")," &npbs;",E.a.createElement(S.FormattedMessage,{id:"action_delete_messages",defaultMessage:"Delete Messages"})),E.a.createElement("a",{href:"#",className:"red flat-button",onClick:this.handleLeave},E.a.createElement("i",{className:"material-icons"},"exit_to_app")," &npbs;",E.a.createElement(S.FormattedMessage,{id:"action_leave_chat",defaultMessage:"Leave Conversation"})),this.state.groupTopic?E.a.createElement("a",{href:"#",className:"red flat-button",onClick:this.handleReport},E.a.createElement("i",{className:"material-icons"},"report")," &npbs;",E.a.createElement(S.FormattedMessage,{id:"action_report_group",defaultMessage:"Report Group"})):E.a.createElement(E.a.Fragment,null,E.a.createElement("a",{href:"#",className:"red flat-button",onClick:this.handleBlock},E.a.createElement("i",{className:"material-icons"},"block")," &npbs;",E.a.createElement(S.FormattedMessage,{id:"action_block_contact",defaultMessage:"Block Contact"})),E.a.createElement("a",{href:"#",className:"red flat-button",onClick:this.handleReport},E.a.createElement("i",{className:"material-icons"},"report")," &npbs;",E.a.createElement(S.FormattedMessage,{id:"action_report_contact",defaultMessage:"Report Contact"})))),this.state.groupTopic?E.a.createElement(E.a.Fragment,null,E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_group_members",defaultMessage:"Group members:"}))),E.a.createElement("div",{className:"panel-form-row"},this.state.sharer?E.a.createElement("a",{href:"#",className:"flat-button",onClick:this.handleShowAddMembers},E.a.createElement("i",{className:"material-icons"},"person_add")," ",E.a.createElement(S.FormattedMessage,{id:"button_add_members",defaultMessage:"Add members"})):null),E.a.createElement(S.FormattedMessage,{id:"group_has_no_members",defaultMessage:"No members"},function(e){return E.a.createElement(Et,{contacts:t.state.contactList,myUserId:t.props.myUserId,emptyListMessage:e,topicSelected:t.state.selectedContact,showOnline:!1,showUnread:!1,showMode:!0,noScroll:!0,onTopicSelected:t.handleMemberSelected,showContextMenu:!!t.state.admin&&t.handleContextMenu})}))):null))}}])&&ka(Oa.prototype,Na),void(ja&&ka(Oa,ja)),Da);function Da(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Da),(t=function(e,t){return!t||"object"!==Ca(t)&&"function"!=typeof t?Ta(e):t}(this,Ma(Da).call(this,e))).state={topic:null,owner:!1,admin:!1,sharer:!1,muted:!1,address:null,groupTopic:void 0,fullName:void 0,avatar:null,private:null,selectedContact:null,access:null,modeGiven:null,modeWant:null,modeGiven2:null,modeWant2:null,auth:null,anon:null,contactList:[],tags:[],showMemberPanel:!1,showPermissionEditorFor:void 0,moreInfoExpanded:!1,previousMetaDesc:void 0,previousSubsUpdated:void 0,previousTagsUpdated:void 0},t.resetSubs=t.resetSubs.bind(Ta(t)),t.resetDesc=t.resetDesc.bind(Ta(t)),t.onMetaDesc=t.onMetaDesc.bind(Ta(t)),t.onSubsUpdated=t.onSubsUpdated.bind(Ta(t)),t.onTagsUpdated=t.onTagsUpdated.bind(Ta(t)),t.handleFullNameUpdate=t.handleFullNameUpdate.bind(Ta(t)),t.handlePrivateUpdate=t.handlePrivateUpdate.bind(Ta(t)),t.handleImageChanged=t.handleImageChanged.bind(Ta(t)),t.handleMuted=t.handleMuted.bind(Ta(t)),t.handlePermissionsChanged=t.handlePermissionsChanged.bind(Ta(t)),t.handleLaunchPermissionsEditor=t.handleLaunchPermissionsEditor.bind(Ta(t)),t.handleHidePermissionsEditor=t.handleHidePermissionsEditor.bind(Ta(t)),t.handleShowAddMembers=t.handleShowAddMembers.bind(Ta(t)),t.handleHideAddMembers=t.handleHideAddMembers.bind(Ta(t)),t.handleMemberUpdateRequest=t.handleMemberUpdateRequest.bind(Ta(t)),t.handleLeave=t.handleLeave.bind(Ta(t)),t.handleMemberSelected=t.handleMemberSelected.bind(Ta(t)),t.handleMoreInfo=t.handleMoreInfo.bind(Ta(t)),t.handleTagsUpdated=t.handleTagsUpdated.bind(Ta(t)),t.handleContextMenu=t.handleContextMenu.bind(Ta(t)),t}var Ua=Object(S.injectIntl)(xa);function Ra(e){return(Ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fa(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ia(e,t){return!t||"object"!==Ra(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function La(e){return(La=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qa(e,t){return(qa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ha,Wa,Ga,Ba=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qa(e,t)}(Va,E.a.PureComponent),Ha=Va,(Wa=[{key:"render",value:function(){var t=this;return E.a.createElement("div",{className:"uploader"},E.a.createElement("div",null,E.a.createElement("span",{style:{width:100*this.props.progress+"%"}})),this.props.progress<.999?E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onCancel()}},E.a.createElement("i",{className:"material-icons"},"close")," ",E.a.createElement(S.FormattedMessage,{id:"action_cancel",defaultMessage:"cancel"})):E.a.createElement(S.FormattedMessage,{id:"upload_finishing",defaultMessage:"finishing..."}))}}])&&Fa(Ha.prototype,Wa),void(Ga&&Fa(Ha,Ga)),Va);function Va(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Va),Ia(this,La(Va).apply(this,arguments))}function Ka(e){return(Ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function za(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ja(e){return(Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ya(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qa(e,t){return(Qa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xa,$a,Za,eo=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qa(e,t)}(to,E.a.Component),Xa=to,($a=[{key:"downloadFile",value:function(e,t,n){var a=this,o=this.props.tinode.getLargeFileHelper();this.setState({downloader:o}),o.download(e,t,n,function(e){a.setState({progress:e/a.props.size})}).then(function(){a.setState({downloader:null,progress:0})}).catch(function(e){e&&a.props.onError("Error downloading file: "+e.message,"err"),a.setState({downloader:null,progress:0})})}},{key:"handleCancel",value:function(){this.props.uploader?this.props.onCancelUpload():this.state.downloader&&this.state.downloader.cancel()}},{key:"render",value:function(){var t=this,e=this.props.filename||"file_attachment";36<e.length&&(e=e.substr(0,16)+"..."+e.substr(-16));var n,a,o=0<this.props.size?E.a.createElement("span",{className:"small gray"},"(",R(this.props.size),")"):null;return a=this.props.uploader||this.state.downloader||!function(e){return!/^\s*([a-z][a-z0-9+.-]*:|\/\/)/im.test(e)}(this.props.downloadUrl)?(n=ha(this.props.downloadUrl)||"about:blank",null):(n="#",function(e){e.preventDefault(),t.downloadFile(t.props.downloadUrl,t.props.filename,t.props.mimetype)}),E.a.createElement("div",{className:"attachment"},E.a.createElement("div",null,E.a.createElement("i",{className:"material-icons big gray"},"insert_drive_file")),E.a.createElement("div",{className:"flex-column"},E.a.createElement("div",null,e," ",o),this.props.uploader||this.state.downloader?E.a.createElement(Ba,{progress:this.props.uploader?this.props.progress:this.state.progress,onCancel:this.handleCancel}):E.a.createElement("div",null,E.a.createElement("a",{href:n,download:this.props.filename,onClick:a},E.a.createElement("i",{className:"material-icons"},"file_download")," ",E.a.createElement(S.FormattedMessage,{id:"save_attachment",defaultMessage:"save"})))))}}])&&za(Xa.prototype,$a),void(Za&&za(Xa,Za)),to);function to(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,to),(t=function(e,t){return!t||"object"!==Ka(t)&&"function"!=typeof t?Ya(e):t}(this,Ja(to).call(this,e))).state={downloader:null,progress:0},t.downloadFile=t.downloadFile.bind(Ya(t)),t.handleCancel=t.handleCancel.bind(Ya(t)),t}function no(e){return(no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function oo(e,t){return!t||"object"!==no(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function ro(e){return(ro=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function io(e,t){return(io=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var so,lo,co,uo=Object(S.defineMessages)({sending:{id:"message_sending",defaultMessage:"sending..."},failed:{id:"message_sending_failed",defaultMessage:"failed"}}),po=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&io(e,t)}(ho,E.a.PureComponent),so=ho,(lo=[{key:"render",value:function(){var e,t=this.props.intl.formatMessage;e=this.props.received<=C.a.MESSAGE_STATUS_SENDING?t(uo.sending):this.props.received==C.a.MESSAGE_STATUS_FAILED?t(uo.failed):U(this.props.timestamp,this.props.intl.locale);var n=null;return this.props.received<=C.a.MESSAGE_STATUS_SENDING?n=E.a.createElement("i",{className:"material-icons small"},"access_time"):this.props.received==C.a.MESSAGE_STATUS_FAILED?n=E.a.createElement("i",{className:"material-icons small amber"},"warning"):this.props.received==C.a.MESSAGE_STATUS_SENT?n=E.a.createElement("i",{className:"material-icons small"},"done"):this.props.received==C.a.MESSAGE_STATUS_RECEIVED?n=E.a.createElement("i",{className:"material-icons small"},"done_all"):this.props.received==C.a.MESSAGE_STATUS_READ&&(n=E.a.createElement("i",{className:"material-icons small blue"},"done_all")),E.a.createElement("span",{className:"timestamp"},e," ",n)}}])&&ao(so.prototype,lo),void(co&&ao(so,co)),ho);function ho(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ho),oo(this,ro(ho).apply(this,arguments))}var fo=Object(S.injectIntl)(po);function mo(e){return(mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function go(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function bo(e){return(bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function vo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yo(e,t){return(yo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _o,wo,Eo,So=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yo(e,t)}(Co,E.a.Component),_o=Co,(wo=[{key:"handlePreviewImage",value:function(e){e.preventDefault(),this.props.onImagePreview({url:e.target.src,filename:e.target.title,width:e.target.dataset.width,height:e.target.dataset.height,size:e.target.dataset.size,type:e.target.dataset.mime})}},{key:"handleFormButtonClick",value:function(e){e.preventDefault();var t={seq:this.props.seq,resp:{}};e.target.dataset.name&&(t.resp[e.target.dataset.name]=e.target.dataset.val?e.target.dataset.val:void 0===e.target.dataset.val?1:""+e.target.dataset.val),"url"==e.target.dataset.act&&(t.ref=ha(e.target.dataset.ref)||"about:blank");var n=e.target.dataset.title||"unknown";this.props.onFormResponse(e.target.dataset.act,n,t)}},{key:"handleContextClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.showContextMenu({seq:this.props.seq,y:e.pageY,x:e.pageX})}},{key:"handleProgress",value:function(e){this.setState({progress:e})}},{key:"handleCancelUpload",value:function(){this.props.uploader.cancel()}},{key:"render",value:function(){var t=this,e=this.props.sequence+" "+(this.props.response?"left":"right"),n="single"==this.props.sequence||"last"==this.props.sequence?"bubble tip":"bubble",a=this.props.userAvatar||!0,o=this.props.userFrom&&this.props.response&&("single"==this.props.sequence||"last"==this.props.sequence),r=this.props.content,i=[];return this.props.mimeType==l.Drafty.getContentType()?(l.Drafty.attachments(r,function(e,t){"application/json"!=e.mime&&i.push(E.a.createElement(eo,{tinode:this.props.tinode,downloadUrl:l.Drafty.getDownloadUrl(e),filename:e.name,uploader:l.Drafty.isUploading(e),mimetype:e.mime,size:l.Drafty.getEntitySize(e),progress:this.state.progress,onCancelUpload:this.handleCancelUpload,onError:this.props.onError,key:t}))},this),r=E.a.createElement("span",null,l.Drafty.format(r,ko,this))):"string"!=typeof r&&(r=E.a.createElement(E.a.Fragment,null,E.a.createElement("i",{className:"material-icons"},"error_outline")," ",E.a.createElement("i",null,E.a.createElement(S.FormattedMessage,{id:"invalid_content",defaultMessage:"invalid content"})))),E.a.createElement("li",{className:e},this.props.userFrom&&this.props.response?E.a.createElement("div",{className:"avatar-box"},o?E.a.createElement(V,{topic:this.props.userFrom,title:this.props.userName,avatar:a}):null):null,E.a.createElement("div",null,E.a.createElement("div",{className:n},E.a.createElement("div",{className:"message-content"},r,i,E.a.createElement(fo,{timestamp:this.props.timestamp,received:this.props.received})),E.a.createElement("span",{className:"menuTrigger"},E.a.createElement("a",{href:"#",onClick:this.handleContextClick},E.a.createElement("i",{className:"material-icons"},"expand_more")))),o?E.a.createElement("div",{className:"author"},E.a.createElement(S.FormattedMessage,{id:"user_not_found",defaultMessage:"Not found"},function(e){return t.props.userName||E.a.createElement("i",null,e)})):null))}}])&&go(_o.prototype,wo),void(Eo&&go(_o,Eo)),Co);function Co(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Co),(t=function(e,t){return!t||"object"!==mo(t)&&"function"!=typeof t?vo(e):t}(this,bo(Co).call(this,e))).state={progress:0},e.uploader&&(e.uploader.onProgress=t.handleProgress.bind(vo(t))),t.handlePreviewImage=t.handlePreviewImage.bind(vo(t)),t.handleFormButtonClick=t.handleFormButtonClick.bind(vo(t)),t.handleContextClick=t.handleContextClick.bind(vo(t)),t.handleCancelUpload=t.handleCancelUpload.bind(vo(t)),t}function ko(e,t,n,a){var o=l.Drafty.tagName(e);if(o){var r=l.Drafty.attrValue(e,t)||{};switch(r.key=a,e){case"IM":if(t){r.className="inline-image";var i=Q(t.width,t.height,Math.min(this.props.viewportWidth-52,468),312,!1);i=i||{dstWidth:32,dstHeight:32},r.style={width:i.dstWidth+"px",height:i.dstHeight+"px"},r.src=function(e){if(!e)return null;var t=ha(e);return t||(/data:image\/[a-z0-9.-]+;base64,/i.test(e.trim())?e:null)}(r.src),r.src?(r.onClick=this.handlePreviewImage,r.className+=" image-clickable"):r.src="img/broken_image.png"}break;case"BN":r.onClick=this.handleFormButtonClick;var s=E.a.Children.map(n,function(e){return"string"==typeof e?e:void 0});s&&0!=s.length||(s=[r.name]),r["data-title"]=s.join("");break;case"FM":r.className="bot-form"}return E.a.createElement(o,r,n)}return n}function Mo(e){return(Mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function To(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Po(e,t){return!t||"object"!==Mo(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Oo(e){return(Oo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function No(e,t){return(No=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jo,Ao,xo,Do=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&No(e,t)}(Uo,E.a.Component),jo=Uo,(Ao=[{key:"render",value:function(){var t=[],e=(this.props.subscribers||[]).length,n=Math.min(4,e);return(this.props.subscribers||[]).some(function(e){return t.push(E.a.createElement("div",{className:"avatar-box",key:e.user},E.a.createElement(V,{topic:e.user,avatar:Y(e.public?e.public.photo:null)||!0,title:e.public?e.public.fn:null}))),t.length==n}),E.a.createElement("div",{id:"topic-users"},t," ",n<e?E.a.createElement("span",null,E.a.createElement(S.FormattedMessage,{id:"more_online_members",defaultMessage:"+{overflow} more",values:{overflow:e-n}})):null)}}])&&To(jo.prototype,Ao),void(xo&&To(jo,xo)),Uo);function Uo(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Uo),Po(this,Oo(Uo).call(this,e))}function Ro(e){return(Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fo(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Io(e,t){return!t||"object"!==Ro(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Lo(e){return(Lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qo(e,t){return(qo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ho,Wo,Go,Bo=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qo(e,t)}(Vo,E.a.PureComponent),Ho=Vo,(Wo=[{key:"assignWidth",value:function(e){if(e&&!this.state.width){var t=e.getBoundingClientRect();this.setState({width:0|t.width,height:0|t.height})}}},{key:"render",value:function(){var t=this;if(!this.props.content)return null;var e=Q(this.props.content.width,this.props.content.height,this.state.width,this.state.height,!1),n=e?{width:e.dstWidth+"px",height:e.dstHeight+"px"}:this.props.content.width>this.props.content.height?{width:"100%"}:{height:"100%"};n.maxWidth="100%",n.maxHeight="100%";var a=this.props.content.filename,o=Math.max((this.state.width/13/1.5|0)-2,12);a.length>o&&(a=a.slice(0,o/2-1)+"..."+a.slice(1-o/2));var r=this.props.content.width||"-",i=this.props.content.height||"-";return E.a.createElement("div",{id:"image-preview",onClick:this.props.onClose},E.a.createElement("div",{id:"image-preview-caption-panel"},E.a.createElement("a",{href:this.props.content.url,download:this.props.content.filename},E.a.createElement("i",{className:"material-icons"},"file_download")," ",E.a.createElement(S.FormattedMessage,{id:"download_action",defaultMessage:"download"})),E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onClose()}},E.a.createElement("i",{className:"material-icons gray"},"close"))),E.a.createElement("div",{id:"image-preview-container",ref:function(e){return t.assignWidth(e)}},E.a.createElement("img",{src:this.props.content.url,style:n})),E.a.createElement("div",{id:"image-preview-footer"},E.a.createElement("div",null,E.a.createElement("div",null,E.a.createElement("b",null,E.a.createElement(S.FormattedMessage,{id:"label_file_name",defaultMessage:"File name:"}))),E.a.createElement("div",null,E.a.createElement("span",{title:this.props.content.filename},a||"-"))),E.a.createElement("div",null,E.a.createElement("div",null,E.a.createElement("b",null,E.a.createElement(S.FormattedMessage,{id:"label_content_type",defaultMessage:"Content type:"}))),E.a.createElement("div",null,this.props.content.type)),E.a.createElement("div",null,E.a.createElement("div",null,E.a.createElement("b",null,E.a.createElement(S.FormattedMessage,{id:"label_size",defaultMessage:"Size:"}))),E.a.createElement("div",null,r," × ",i," px; ",R(this.props.content.size)))))}}])&&Fo(Ho.prototype,Wo),void(Go&&Fo(Ho,Go)),Vo);function Vo(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Vo),(t=Io(this,Lo(Vo).call(this,e))).state={width:0,height:0},t}function Ko(e){return(Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zo(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Jo(e){return(Jo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qo(e,t){return(Qo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xo,$o,Zo,er=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qo(e,t)}(tr,E.a.PureComponent),Xo=tr,($o=[{key:"handleButtonAction",value:function(e,t){e.preventDefault(),this.props.onAction(t)}},{key:"render",value:function(){var t=this;return E.a.createElement("div",{className:"accept-invite-panel"},E.a.createElement("div",{className:"title"},E.a.createElement(S.FormattedMessage,{id:"chat_invitation",defaultMessage:"You are invited to start a new chat. What would you like to do?"})),E.a.createElement("div",{className:"footer"},E.a.createElement("button",{className:"blue",onClick:function(e){t.handleButtonAction(e,"accept")}},E.a.createElement(S.FormattedMessage,{id:"chat_invitation_accept",defaultMessage:"Accept"})),E.a.createElement("button",{className:"white",onClick:function(e){t.handleButtonAction(e,"delete")}},E.a.createElement(S.FormattedMessage,{id:"chat_invitation_ignore",defaultMessage:"Ignore"})),E.a.createElement("button",{className:"white",onClick:function(e){t.handleButtonAction(e,"block")}},E.a.createElement(S.FormattedMessage,{id:"chat_invitation_block",defaultMessage:"Block"}))))}}])&&zo(Xo.prototype,$o),void(Zo&&zo(Xo,Zo)),tr);function tr(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,tr),(t=function(e,t){return!t||"object"!==Ko(t)&&"function"!=typeof t?Yo(e):t}(this,Jo(tr).call(this,e))).handleButtonAction=t.handleButtonAction.bind(Yo(t)),t}function nr(e){return(nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ar(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function or(e,t){return!t||"object"!==nr(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function rr(e){return(rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ir(e,t){return(ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var sr,lr,cr,ur=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ir(e,t)}(dr,E.a.PureComponent),sr=dr,(lr=[{key:"render",value:function(){return this.props.show?E.a.createElement("div",{className:"load-spinner-box"},E.a.createElement("div",{className:"loader-spinner"})):null}}])&&ar(sr.prototype,lr),void(cr&&ar(sr,cr)),dr);function dr(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,dr),or(this,rr(dr).apply(this,arguments))}function pr(e){return(pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hr(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function fr(e,t){return!t||"object"!==pr(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function mr(e){return(mr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gr(e,t){return(gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var br,vr,yr,_r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gr(e,t)}(wr,E.a.PureComponent),br=wr,(vr=[{key:"render",value:function(){var e=c+" ("+C.a.getLibrary()+")";return E.a.createElement("div",{id:"dummy-view",className:this.props.hideSelf?"nodisplay":null},E.a.createElement("div",null,E.a.createElement("a",{href:"https://github.com/tinode/chat/"},E.a.createElement("img",{id:"logo",alt:"logo",src:"img/logo.svg"}),E.a.createElement("h2",null,"Tinode Web")),E.a.createElement("p",null,E.a.createElement(S.FormattedMessage,{id:"label_client",defaultMessage:"Client:"})," ",e),E.a.createElement("p",null,E.a.createElement(S.FormattedMessage,{id:"label_server",defaultMessage:"Server:"})," ",this.props.serverVersion," (",this.props.serverAddress,")")))}}])&&hr(br.prototype,vr),void(yr&&hr(br,yr)),wr);function wr(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,wr),fr(this,mr(wr).apply(this,arguments))}function Er(e){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sr(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Cr(e){return(Cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mr(e,t){return(Mr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Tr,Pr,Or,Nr=Object(S.defineMessages)({messaging_disabled:{id:"messaging_disabled_prompt",defaultMessage:"Messaging disabled"},type_new_message:{id:"new_message_prompt",defaultMessage:"New message"},file_attachment_too_large:{id:"file_attachment_too_large",defaultMessage:"The file size {size} exceeds the {limit} limit."},cannot_initiate_upload:{id:"cannot_initiate_file_upload",defaultMessage:"Cannot initiate file upload."}}),jr=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mr(e,t)}(Ar,E.a.PureComponent),Tr=Ar,(Pr=[{key:"componentDidMount",value:function(){this.messageEditArea.addEventListener("paste",this.handlePasteEvent,!1)}},{key:"componentWillUnmount",value:function(){this.messageEditArea.removeEventListener("paste",this.handlePasteEvent,!1)}},{key:"componentDidUpdate",value:function(){this.messageEditArea.focus()}},{key:"handlePasteEvent",value:function(e){var r=this;this.props.disabled||!function(e,t,n,a){var o=(e.clipboardData||e.originalEvent.clipboardData||{}).items;for(var r in o){var i=o[r];if("file"!==i.kind);else{var s=i.getAsFile();if(s)return s.type&&"image"==s.type.split("/")[0]?s.size>h||z.indexOf(s.type)<0?$(s,768,768,!1,t,a):Z(s,t,a):ee(s,n),!0;console.log("Failed to get file object from pasted file item",i.kind,i.type)}}return!1}(e,function(e,t,n,a,o){r.props.sendMessage(l.Drafty.insertImage(null,0,t,e,n,a,o))},function(e,t,n){r.props.sendMessage(l.Drafty.attachFile(null,e,t,n))},this.props.onError)||e.preventDefault()}},{key:"handleAttachImage",value:function(e){var r=this;if(e.target.files&&0<e.target.files.length){var t=e.target.files[0];t.size>h||z.indexOf(t.type)<0?$(t,768,768,!1,function(e,t,n,a,o){r.props.sendMessage(l.Drafty.insertImage(null,0,t,e,n,a,o))},function(e){r.props.onError(e,"err")}):Z(t,function(e,t,n,a,o){r.props.sendMessage(l.Drafty.insertImage(null,0,t,e,n,a,o))},function(e){r.props.onError(e,"err")})}e.target.value=""}},{key:"handleAttachFile",value:function(e){var a=this,t=this.props.intl.formatMessage;if(e.target.files&&0<e.target.files.length){var n=e.target.files[0];if(n.size>1<<23)this.props.onError(t(Nr.file_attachment_too_large,{size:R(n.size),limit:R(1<<23)}),"err");else if(n.size>h){var o=this.props.tinode.getLargeFileHelper();if(!o)return void this.props.onError(t(Nr.cannot_initiate_upload));var r=o.upload(n),i=l.Drafty.attachFile(null,n.type,null,n.name,n.size,r);this.props.sendMessage(i,r,o)}else ee(n,function(e,t,n){a.props.sendMessage(l.Drafty.attachFile(null,e,t,n))},this.props.onError)}e.target.value=""}},{key:"handleSend",value:function(e){e.preventDefault(),this.state.message.trim()&&(this.props.sendMessage(this.state.message.trim()),this.setState({message:""}))}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(e.shiftKey||(e.preventDefault(),e.stopPropagation(),this.handleSend(e)))}},{key:"handleMessageTyping",value:function(e){var t={message:e.target.value},n=(new Date).getTime();if(3e3<n-this.state.keypressTimestamp){var a=this.props.tinode.getTopic(this.props.topic);a.isSubscribed()&&a.noteKeyPress(),t.keypressTimestamp=n}this.setState(t)}},{key:"render",value:function(){var t=this,e=this.props.intl.formatMessage,n=this.props.disabled?e(Nr.messaging_disabled):e(Nr.type_new_message);return E.a.createElement("div",{id:"send-message-panel"},this.props.disabled?E.a.createElement("i",{className:"material-icons disabled"},"photo"):E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.attachImage.click()},title:"Add image"},E.a.createElement("i",{className:"material-icons secondary"},"photo")),this.props.disabled?E.a.createElement("i",{className:"material-icons disabled"},"attach_file"):E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.attachFile.click()},title:"Attach file"},E.a.createElement("i",{className:"material-icons secondary"},"attach_file")),E.a.createElement("textarea",{id:"sendMessage",placeholder:n,disabled:this.props.disabled,value:this.state.message,onChange:this.handleMessageTyping,onKeyPress:this.handleKeyPress,ref:function(e){t.messageEditArea=e},autoFocus:!0}),this.props.disabled?E.a.createElement("i",{className:"material-icons disabled"},"send"):E.a.createElement("a",{href:"#",onClick:this.handleSend,title:"Send"},E.a.createElement("i",{className:"material-icons"},"send")),E.a.createElement("input",{type:"file",ref:function(e){t.attachFile=e},onChange:this.handleAttachFile,style:{display:"none"}}),E.a.createElement("input",{type:"file",ref:function(e){t.attachImage=e},accept:"image/*",onChange:this.handleAttachImage,style:{display:"none"}}))}}])&&Sr(Tr.prototype,Pr),void(Or&&Sr(Tr,Or)),Ar);function Ar(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ar),(t=function(e,t){return!t||"object"!==Er(t)&&"function"!=typeof t?kr(e):t}(this,Cr(Ar).call(this,e))).state={message:"",keypressTimestamp:(new Date).getTime()-3e3-1},t.handlePasteEvent=t.handlePasteEvent.bind(kr(t)),t.handleAttachImage=t.handleAttachImage.bind(kr(t)),t.handleAttachFile=t.handleAttachFile.bind(kr(t)),t.handleSend=t.handleSend.bind(kr(t)),t.handleKeyPress=t.handleKeyPress.bind(kr(t)),t.handleMessageTyping=t.handleMessageTyping.bind(kr(t)),t}var xr=Object(S.injectIntl)(jr);function Dr(e){return(Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ur(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Rr(e){return(Rr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Fr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ir(e,t){return(Ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lr=C.a.Drafty,qr=Object(S.defineMessages)({online_now:{id:"online_now",defaultMessage:"online now"},last_seen:{id:"last_seen_timestamp",defaultMessage:"Last seen"},not_found:{id:"title_not_found",defaultMessage:"Not found"}});function Hr(e){if(e){var t=e.getExcessive()||"";return e.isJoiner("given")&&(t.includes("R")||t.includes("W"))}return!1}function Wr(e){if(e){var t=e.getMissing()||"";return e.isJoiner("want")&&(t.includes("R")||t.includes("W"))}return!1}var Gr,Br,Vr,Kr=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ir(e,t)}(zr,E.a.Component),Gr=zr,Vr=[{key:"getDerivedStateFromProps",value:function(t,e){var n={};if(t.topic){if(t.topic!=e.topic){var a=t.tinode.getTopic(t.topic);if(n={topic:t.topic,imagePreview:null,typingIndicator:!1,scrollPosition:0,fetchingMessages:!1},a){var o=[],r=[];t.connected&&a.subscribers(function(e){e.online&&e.user!=t.myUserId&&r.push(e)}),a.messages(function(e){e.deleted||o.push(e)}),Object.assign(n,{messages:o,onlineSubs:r}),a.public?Object.assign(n,{title:a.public.fn,avatar:Y(a.public.photo)}):Object.assign(n,{title:"",avatar:null});var i=a.p2pPeerDesc();i?Object.assign(n,{peerMessagingDisabled:Wr(i.acs)}):e.peerMessagingDisabled&&Object.assign(n,{peerMessagingDisabled:!1})}else Object.assign(n,{messages:[],onlineSubs:[],title:"",avatar:null,peerMessagingDisabled:!1})}}else n={messages:[],onlineSubs:[],topic:null,title:"",avatar:null,imagePreview:null,typingIndicator:!1,scrollPosition:0,fetchingMessages:!1,peerMessagingDisabled:!1};return t.acs?(t.acs.isWriter()!=e.isWriter&&(n.isWriter=!e.isWriter),t.acs.isReader()!=e.isReader&&(n.isReader=!e.isReader),!t.acs.isReader("given")!=e.readingBlocked&&(n.readingBlocked=!e.readingBlocked)):(e.isWriter&&(n.isWriter=!1),e.isReader&&(n.isReader=!1),e.readingBlocked||(e.readingBlocked=!0)),Hr(t.acs)==!e.unconformed&&(n.unconfirmed=!e.unconformed),!t.connected&&e.onlineSubs&&0<e.onlineSubs.length&&(n.onlineSubs=[]),n}}],(Br=[{key:"componentDidMount",value:function(){this.messagesScroller&&this.messagesScroller.addEventListener("scroll",this.handleScrollEvent)}},{key:"componentWillUnmount",value:function(){this.leave(this.state.topic),this.messagesScroller&&this.messagesScroller.removeEventListener("scroll",this.handleScrollEvent)}},{key:"componentDidUpdate",value:function(e,t){var n=this;this.messagesScroller&&(t.topic!=this.state.topic||t.messages.length!=this.state.messages.length?this.messagesScroller.scrollTop=this.messagesScroller.scrollHeight-this.state.scrollPosition:e.viewportHeight>this.props.viewportHeight&&(this.messagesScroller.scrollTop+=e.viewportHeight-this.props.viewportHeight));var a=this.props.tinode.getTopic(this.state.topic);if(this.state.topic!=t.topic&&(t.topic&&(this.leave(t.topic),this.props.readTimerHandler(null)),a&&(a.onData=this.handleNewMessage,a.onAllMessagesReceived=this.handleAllMessagesReceived,a.onInfo=this.handleInfoReceipt,a.onMetaDesc=this.handleDescChange,a.onSubsUpdated=this.handleSubsUpdated,a.onPres=this.handleSubsUpdated)),a&&!a.isSubscribed()&&this.props.ready&&(this.state.topic!=t.topic||!e.ready)){var o=this.props.newTopicParams&&this.props.newTopicParams._topicName==this.props.topic,r=a.startMetaQuery().withLaterDesc().withLaterSub();(this.state.isReader||o)&&(r=r.withLaterData(24),this.state.isReader&&(r=r.withLaterDel()),this.setState({fetchingMessages:!0}));var i=o?this.props.newTopicParams:void 0;a.subscribe(r.build(),i).then(function(e){n.state.topic!=e.topic&&n.setState({topic:e.topic}),n.props.onNewTopicCreated(n.props.topic,e.topic),a.queuedMessages(function(e){!e._sending&&a.isSubscribed()&&a.publishMessage(e)})}).catch(function(e){console.log("Failed subscription to",n.state.topic),n.props.onError(e.message,"err");var t=zr.getDerivedStateFromProps({},{});t.title=n.props.intl.formatMessage(qr.not_found),n.setState(t)})}}},{key:"leave",value:function(e){var t=this;if(e){var n=this.props.tinode.getTopic(e);n&&n.isSubscribed()&&n.leave(!1).catch(function(){}).finally(function(){t.setState({fetchingMessages:!1}),n.onData=void 0,n.onAllMessagesReceived=void 0,n.onInfo=void 0,n.onMetaDesc=void 0,n.onSubsUpdated=void 0,n.onPres=void 0})}}},{key:"handleScrollReference",value:function(e){e&&(e.addEventListener("scroll",this.handleScrollEvent),this.messagesScroller=e)}},{key:"handleScrollEvent",value:function(e){var o=this;this.setState({scrollPosition:e.target.scrollHeight-e.target.scrollTop}),e.target.scrollTop<=0&&this.setState(function(e,t){var n={};if(!e.fetchingMessages){var a=o.props.tinode.getTopic(o.state.topic);a&&a.isSubscribed()&&a.msgHasMoreMessages()&&(n.fetchingMessages=!0,a.getMessagesPage(24).catch(function(e){o.setState({fetchingMessages:!1}),o.props.onError(e.message,"err")}))}return n})}},{key:"handleDescChange",value:function(e){e.public?this.setState({title:e.public.fn,avatar:Y(e.public.photo)}):this.setState({title:"",avatar:null}),e.acs&&this.setState({isWriter:e.acs.isWriter(),isReader:e.acs.isReader(),readingBlocked:!e.acs.isReader("given"),unconfirmed:Hr(e.acs)})}},{key:"handleSubsUpdated",value:function(){var t=this;if(this.state.topic){var n=[],e=this.props.tinode.getTopic(this.state.topic);e.subscribers(function(e){e.online&&e.user!=t.props.myUserId&&n.push(e)});var a={onlineSubs:n},o=e.p2pPeerDesc();o?Object.assign(a,{peerMessagingDisabled:Wr(o.acs)}):this.state.peerMessagingDisabled&&Object.assign(a,{peerMessagingDisabled:!1}),this.setState(a)}}},{key:"handleNewMessage",value:function(e){var t=this.props.tinode.getTopic(this.state.topic),n={messages:[]};t.messages(function(e){e.deleted||(n.messages=n.messages.concat(e))}),e&&!e.deleted&&(t.isNewMessage(e.seq)&&(n.scrollPosition=0),t.msgStatus(e)>=C.a.MESSAGE_STATUS_SENT&&e.from!=this.props.myUserId&&this.props.readTimerHandler(function(){t.noteRead(e.seq)}),this.props.onData(e)),this.setState(n)}},{key:"handleAllMessagesReceived",value:function(e){this.setState({fetchingMessages:!1})}},{key:"handleInfoReceipt",value:function(e){switch(e.what){case"kp":clearTimeout(this.keyPressTimer);var t=this;this.keyPressTimer=setTimeout(function(){t.setState({typingIndicator:!1})},4e3),this.state.typingIndicator||this.setState({typingIndicator:!0});break;case"read":case"recv":this.forceUpdate();break;default:console.log("Other change in topic: ",e.what)}}},{key:"handleImagePreview",value:function(e){this.setState({imagePreview:e})}},{key:"handleCloseImagePreview",value:function(){this.setState({imagePreview:null})}},{key:"handleFormResponse",value:function(e,t,n){if("pub"==e)this.props.sendMessage(Lr.attachJSON(Lr.parse(t),n));else if("url"==e){var a=new URL(n.ref),o=a.searchParams;for(var r in n.resp)n.resp.hasOwnProperty(r)&&o.set(r,n.resp[r]);["name","seq"].map(function(e){n[e]&&o.set(e,n[e])}),o.set("uid",this.props.myUserId),a.search=o,window.open(a,"_blank")}else console.log("Unknown action in form",e)}},{key:"handleContextClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.showContextMenu({topicName:this.state.topic,y:e.pageY,x:e.pageX})}},{key:"handleShowContextMenuMessage",value:function(e){e.topicName=this.state.topic;var t=["message_delete"],n=this.props.tinode.getTopic(e.topicName);if(n){var a=n.getAccessMode();a&&a.isDeleter()&&t.push("message_delete_hard")}this.props.showContextMenu(e,t)}},{key:"handleNewChatAcceptance",value:function(e){this.props.onNewChat(this.state.topic,e)}},{key:"handleEnablePeer",value:function(e){e.preventDefault(),this.props.onChangePermissions(this.state.topic,p,this.state.topic)}},{key:"render",value:function(){var e,t=this,n=this.props.intl.formatMessage;if(this.state.topic){for(var a=this.props.tinode.getTopic(this.state.topic),o="grp"==a.getType(),r=[],i=null,s=null,l=0;l<this.state.messages.length;l++){var c=this.state.messages[l],u=null;l+1<this.state.messages.length&&(u=this.state.messages[l+1].from);var d="single";c.from==i?d=c.from==u?"middle":"last":c.from==u&&(d="first"),i=c.from;var p=!(c.from==this.props.myUserId),h=a.msgStatus(c),f=void 0,m=void 0,g=void 0;if(o){var b=a.userDesc(c.from);b&&b.public&&(f=b.public.fn,m=Y(b.public.photo)),g=c.from,s="chat-box group"}else s="chat-box";r.push(E.a.createElement(So,{tinode:this.props.tinode,content:c.content,mimeType:c.head?c.head.mime:null,timestamp:c.ts,response:p,seq:c.seq,userFrom:g,userName:f,userAvatar:m,sequence:d,received:h,uploader:c._uploader,viewportWidth:this.props.viewportWidth,showContextMenu:this.handleShowContextMenuMessage,onImagePreview:this.handleImagePreview,onFormResponse:this.handleFormResponse,onError:this.props.onError,key:c.seq}))}var v=null,y=this.props.tinode.getMeTopic().getContact(this.state.topic);y&&"p2p"==C.a.topicType(y.topic)&&(y.online?v=n(qr.online_now):y.seen&&(v=n(qr.last_seen)+": "+U(y.seen.when,this.props.intl.locale)));var _=this.state.avatar||!0,w=this.props.online?"online"+(this.state.typingIndicator?" typing":""):"offline";e=E.a.createElement("div",{id:"topic-view",className:this.props.hideSelf?"nodisplay":null},E.a.createElement("div",{id:"topic-caption-panel",className:"caption-panel"},this.props.displayMobile?E.a.createElement("a",{href:"#",id:"hide-message-view",onClick:function(e){e.preventDefault(),t.props.onHideMessagesView()}},E.a.createElement("i",{className:"material-icons"},"arrow_back")):null,E.a.createElement("div",{className:"avatar-box"},E.a.createElement(V,{avatar:_,topic:this.state.topic,title:this.state.title}),E.a.createElement("span",{className:w})),E.a.createElement("div",{id:"topic-title-group"},E.a.createElement("div",{id:"topic-title",className:"panel-title"},this.state.title||E.a.createElement("i",null,E.a.createElement(S.FormattedMessage,{id:"unnamed_topic",defaultMessage:"Unnamed"}))),E.a.createElement("div",{id:"topic-last-seen"},v)),o?E.a.createElement(Do,{subscribers:this.state.onlineSubs}):E.a.createElement("div",{id:"topic-users"}),E.a.createElement("div",null,E.a.createElement("a",{href:"#",onClick:this.handleContextClick},E.a.createElement("i",{className:"material-icons"},"more_vert")))),this.props.displayMobile?E.a.createElement(Ht,{level:this.props.errorLevel,text:this.props.errorText,onClearError:this.props.onError}):null,E.a.createElement(ur,{show:this.state.fetchingMessages}),E.a.createElement("div",{id:"messages-container"},E.a.createElement("div",{id:"messages-panel",ref:this.handleScrollReference},E.a.createElement("ul",{id:"scroller",className:s},r)),this.state.isReader?null:E.a.createElement("div",{id:"write-only-background"},this.state.readingBlocked?E.a.createElement("div",{id:"write-only-note"},E.a.createElement(S.FormattedMessage,{id:"messages_not_readable",defaultMessage:"no access to messages"})):null)),this.state.peerMessagingDisabled&&!this.state.unconfirmed?E.a.createElement("div",{id:"peer-messaging-disabled-note"},E.a.createElement("i",{className:"material-icons secondary"},"block")," ",E.a.createElement(S.FormattedMessage,{id:"peers_messaging_disabled",defaultMessage:"Peer's messaging is disabled."})," ",E.a.createElement("a",{href:"#",onClick:this.handleEnablePeer},E.a.createElement(S.FormattedMessage,{id:"enable_peers_messaging",defaultMessage:"Enable"})),"."):null,this.state.unconfirmed?E.a.createElement(er,{onAction:this.handleNewChatAcceptance}):E.a.createElement(xr,{tinode:this.props.tinode,topic:this.props.topic,disabled:!this.state.isWriter,sendMessage:this.props.sendMessage,onError:this.props.onError}),this.state.imagePreview?E.a.createElement(Bo,{content:this.state.imagePreview,onClose:this.handleCloseImagePreview}):null)}else e=E.a.createElement(_r,{hideSelf:this.props.hideSelf,serverVersion:this.props.serverVersion,serverAddress:this.props.serverAddress});return e}}])&&Ur(Gr.prototype,Br),void(Vr&&Ur(Gr,Vr)),zr);function zr(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,zr),(t=function(e,t){return!t||"object"!==Dr(t)&&"function"!=typeof t?Fr(e):t}(this,Rr(zr).call(this,e))).state=zr.getDerivedStateFromProps(e,{}),t.leave=t.leave.bind(Fr(t)),t.handleScrollReference=t.handleScrollReference.bind(Fr(t)),t.handleScrollEvent=t.handleScrollEvent.bind(Fr(t)),t.handleDescChange=t.handleDescChange.bind(Fr(t)),t.handleSubsUpdated=t.handleSubsUpdated.bind(Fr(t)),t.handleNewMessage=t.handleNewMessage.bind(Fr(t)),t.handleAllMessagesReceived=t.handleAllMessagesReceived.bind(Fr(t)),t.handleInfoReceipt=t.handleInfoReceipt.bind(Fr(t)),t.handleImagePreview=t.handleImagePreview.bind(Fr(t)),t.handleCloseImagePreview=t.handleCloseImagePreview.bind(Fr(t)),t.handleFormResponse=t.handleFormResponse.bind(Fr(t)),t.handleContextClick=t.handleContextClick.bind(Fr(t)),t.handleShowContextMenuMessage=t.handleShowContextMenuMessage.bind(Fr(t)),t.handleNewChatAcceptance=t.handleNewChatAcceptance.bind(Fr(t)),t.handleEnablePeer=t.handleEnablePeer.bind(Fr(t)),t}var Jr=Object(S.injectIntl)(Kr);function Yr(e){return(Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qr(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Xr(e,t){return!t||"object"!==Yr(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function $r(e){return($r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zr(e,t){return(Zr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ei,ti,ni,ai=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zr(e,t)}(oi,E.a.PureComponent),ei=oi,(ti=[{key:"render",value:function(){var t=this;return E.a.createElement("div",null,E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onNewTopic()}},E.a.createElement("i",{className:"material-icons"},"chat"))," ",E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onSettings()}},E.a.createElement("i",{className:"material-icons"},"settings")))}}])&&Qr(ei.prototype,ti),void(ni&&Qr(ei,ni)),oi);function oi(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,oi),Xr(this,$r(oi).apply(this,arguments))}function ri(e){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ii(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function si(e,t){return!t||"object"!==ri(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function li(e){return(li=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ci(e,t){return(ci=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ui,di,pi,hi=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ci(e,t)}(fi,E.a.PureComponent),ui=fi,(di=[{key:"render",value:function(){var t=this;return E.a.createElement("div",null,E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onSignUp()}},E.a.createElement("i",{className:"material-icons"},"person_add"))," ",E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),t.props.onSettings()}},E.a.createElement("i",{className:"material-icons"},"settings")))}}])&&ii(ui.prototype,di),void(pi&&ii(ui,pi)),fi);function fi(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,fi),si(this,li(fi).apply(this,arguments))}function mi(e){return(mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gi(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function bi(e,t){return!t||"object"!==mi(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function vi(e){return(vi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yi(e,t){return(yi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _i,wi,Ei,Si=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yi(e,t)}(Ci,E.a.PureComponent),_i=Ci,(wi=[{key:"render",value:function(){return E.a.createElement("div",{id:"side-caption-panel",className:"caption-panel"},E.a.createElement("div",{id:"self-avatar",className:"avatar-box"},E.a.createElement(V,{avatar:this.props.avatar,topic:this.props.myUserId,title:this.props.title})),E.a.createElement("div",{id:"sidepanel-title",className:"panel-title"},this.props.title),"login"===this.props.state?E.a.createElement(hi,{onSignUp:this.props.onSignUp,onSettings:this.props.onSettings}):"contacts"===this.props.state?E.a.createElement(ai,{onNewTopic:this.props.onNewTopic,onSettings:this.props.onSettings}):null,this.props.onCancel?E.a.createElement(jt,{onCancel:this.props.onCancel}):null)}}])&&gi(_i.prototype,wi),void(Ei&&gi(_i,Ei)),Ci);function Ci(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ci),bi(this,vi(Ci).apply(this,arguments))}function ki(e){return(ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mi(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ti(e){return(Ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Oi(e,t){return(Oi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ni,ji,Ai,xi=Object(S.defineMessages)({archived_contacts_title:{id:"archived_contacts",defaultMessage:"Archived contacts ({count})"}}),Di=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oi(e,t)}(Ui,E.a.Component),Ni=Ui,Ai=[{key:"deriveStateFromProps",value:function(t){var n=[],a=0,o=0;return t.chatList.map(function(e){e.private&&e.private.arch?t.archive?n.push(e):o++:t.archive||(n.push(e),a+=0<e.unread?1:0)}),n.sort(function(e,t){return(t.touched||0)-(e.touched||0)}),0<o&&n.push({action:"archive",title:xi.archived_contacts_title,values:{count:o}}),{contactList:n,unreadThreads:a}}}],(ji=[{key:"componentDidUpdate",value:function(e,t){if(e.chatList!=this.props.chatList){var n=Ui.deriveStateFromProps(this.props);this.setState(n),n.unreadThreads!=t.unreadThreads&&ua(n.unreadThreads)}}},{key:"handleAction",value:function(e){this.props.onShowArchive()}},{key:"render",value:function(){var t=this;return E.a.createElement(S.FormattedHTMLMessage,{id:"contacts_not_found",defaultMessage:"You have no chats<br />¯∖_(ツ)_/¯"},function(e){return E.a.createElement(Et,{connected:t.props.connected,contacts:t.state.contactList,emptyListMessage:e,topicSelected:t.props.topicSelected,myUserId:t.props.myUserId,showOnline:!0,showUnread:!0,onTopicSelected:t.props.onTopicSelected,showContextMenu:t.props.showContextMenu,onAction:t.handleAction})})}}])&&Mi(Ni.prototype,ji),void(Ai&&Mi(Ni,Ai)),Ui);function Ui(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ui),(t=function(e,t){return!t||"object"!==ki(t)&&"function"!=typeof t?Pi(e):t}(this,Ti(Ui).call(this,e))).handleAction=t.handleAction.bind(Pi(t)),t.state=Ui.deriveStateFromProps(e),t}function Ri(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Fi,Ii,Li,qi=(Fi=Hi,Li=[{key:"setObject",value:function(e,t){localStorage.setItem(e,JSON.stringify(t))}},{key:"getObject",value:function(e){var t=localStorage.getItem(e);return t&&JSON.parse(t)}},{key:"updateObject",value:function(e,t){var n=this.getObject(e);this.setObject(e,Object.assign(n||{},t))}},{key:"removeItem",value:function(e){localStorage.removeItem(e)}}],(Ii=null)&&Ri(Fi.prototype,Ii),void(Li&&Ri(Fi,Li)),Hi);function Hi(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Hi)}function Wi(e){return(Wi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gi(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Bi(e){return(Bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ki(e,t){return(Ki=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var zi,Ji,Yi,Qi=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ki(e,t)}(Xi,E.a.PureComponent),zi=Xi,(Ji=[{key:"handleLoginChange",value:function(e){this.setState({login:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e})}},{key:"handleEmailChange",value:function(e){this.setState({email:e.target.value})}},{key:"handleFnChange",value:function(e){this.setState({fn:e.target.value})}},{key:"handleImageChanged",value:function(e){this.setState({imageDataUrl:e})}},{key:"handleToggleSaveToken",value:function(){qi.setObject("keep-logged-in",!this.state.saveToken),this.setState({saveToken:!this.state.saveToken})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({errorCleared:!1}),this.props.onCreateAccount(this.state.login.trim(),this.state.password.trim(),da(this.state.fn,this.state.imageDataUrl),{meth:"email",val:this.state.email})}},{key:"render",value:function(){var t=this,e="blue";return this.props.disabled&&(e+=" disabled"),E.a.createElement("form",{className:"panel-form-column",onSubmit:this.handleSubmit},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("div",{className:"panel-form-column"},E.a.createElement(S.FormattedMessage,{id:"login_prompt"},function(e){return E.a.createElement("input",{type:"text",placeholder:e,autoComplete:"user-name",value:t.state.login,onChange:t.handleLoginChange,required:!0,autoFocus:!0})}),E.a.createElement(S.FormattedMessage,{id:"password_prompt"},function(e){return E.a.createElement(Nn,{placeholder:e,autoComplete:"new-password",value:t.state.password,onFinished:t.handlePasswordChange,required:!0})})),E.a.createElement(de,{onImageChanged:this.handleImageChanged,onError:this.props.onError})),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(S.FormattedMessage,{id:"full_name_prompt",defaultMessage:"Full name, e.g. John Doe"},function(e){return E.a.createElement("input",{type:"text",placeholder:e,autoComplete:"name",value:t.state.fn,onChange:t.handleFnChange,required:!0})})),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(S.FormattedMessage,{id:"email_prompt",defaultMessage:"Email, e.g. jdoe@example.com"},function(e){return E.a.createElement("input",{type:"email",placeholder:e,autoComplete:"email",value:t.state.email,onChange:t.handleEmailChange,required:!0})})),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(we,{id:"save-token",name:"save-token",checked:this.state.saveToken,onChange:this.handleToggleSaveToken}),E.a.createElement(S.FormattedMessage,{id:"stay_logged_in"},function(e){return E.a.createElement("label",{htmlFor:"save-token"}," ",e)})),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:e,type:"submit"},E.a.createElement(S.FormattedMessage,{id:"button_sign_up",defaultMessage:"Sign up"}))))}}])&&Gi(zi.prototype,Ji),void(Yi&&Gi(zi,Yi)),Xi);function Xi(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Xi),(t=function(e,t){return!t||"object"!==Wi(t)&&"function"!=typeof t?Vi(e):t}(this,Bi(Xi).call(this,e))).state={login:"",password:"",email:"",fn:"",imageDataUrl:null,errorCleared:!1,saveToken:qi.getObject("keep-logged-in")},t.handleLoginChange=t.handleLoginChange.bind(Vi(t)),t.handlePasswordChange=t.handlePasswordChange.bind(Vi(t)),t.handleEmailChange=t.handleEmailChange.bind(Vi(t)),t.handleFnChange=t.handleFnChange.bind(Vi(t)),t.handleImageChanged=t.handleImageChanged.bind(Vi(t)),t.handleToggleSaveToken=t.handleToggleSaveToken.bind(Vi(t)),t.handleSubmit=t.handleSubmit.bind(Vi(t)),t}function $i(e){return($i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zi(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function es(e){return(es=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ts(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ns(e,t){return(ns=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var as,os,rs,is=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ns(e,t)}(ss,E.a.Component),as=ss,(os=[{key:"componentDidMount",value:function(){var e=this.props.tinode.getMeTopic();e.onCredsUpdated=this.tnCredsUpdated,e.onTagsUpdated=this.tnNewTags}},{key:"componentWillUnmount",value:function(){var e=this.props.tinode.getMeTopic();e.onTagsUpdated=this.state.previousOnTags,e.onCredsUpdated=void 0}},{key:"tnNewTags",value:function(e){this.setState({tags:e})}},{key:"tnCredsUpdated",value:function(e){this.setState({credentials:e||[]})}},{key:"handleFullNameUpdate",value:function(e){this.setState({fullName:e}),this.props.onUpdateAccount(void 0,da(e,null))}},{key:"handlePasswordUpdate",value:function(e){this.setState({password:e}),this.props.onUpdateAccount(e)}},{key:"handleImageChanged",value:function(e){this.setState({avatar:e}),this.props.onUpdateAccount(void 0,da(null,e||C.a.DEL_CHAR))}},{key:"handleCheckboxClick",value:function(e,t){"sound"==e?this.props.onToggleMessageSounds(t):"alert"==e&&this.props.onTogglePushNotifications(t)}},{key:"handleCredChange",value:function(e){this.setState({newCred:e.target.value,addCredInvalid:!1})}},{key:"handleCredKeyDown",value:function(e){27===e.keyCode?this.setState({newCred:"",addCredActive:!1}):13===e.keyCode&&this.handleCredEntered(e)}},{key:"handleCredEntered",value:function(e){var t=this.state.newCred.trim();if(t){var n,a=function(e){return e=e.trim(),/^(?:\+?(\d{1,3}))?[- (.]*(\d{3})[- ).]*(\d{3})[- .]*(\d{2})[- .]*(\d{2})?$/.test(e)?e.replace(/[- ().]*/,""):null}(t);a?n="tel":(a=function(e){return e=e.trim(),/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(e)?e:null}(t))&&(n="email"),n?(this.props.onCredAdd(n,a),this.setState({addCredActive:!1,newCred:""})):this.setState({addCredInvalid:!0})}else this.setState({addCredActive:!1,addCredInvalid:!1})}},{key:"handleLaunchPermissionsEditor",value:function(e){this.setState({showPermissionEditorFor:e,editedPermissions:this.state[e]})}},{key:"handleHidePermissionsEditor",value:function(){this.setState({showPermissionEditorFor:void 0})}},{key:"handlePermissionsChanged",value:function(e){var t={};t[this.state.showPermissionEditorFor]=e,this.props.onUpdateAccount(void 0,void 0,t);var n={showPermissionEditorFor:void 0};n[this.state.showPermissionEditorFor]=e,this.setState(n)}},{key:"handleTagsUpdated",value:function(e){pa(this.state.tags.slice(0),e.slice(0))||this.props.onUpdateTags(e)}},{key:"render",value:function(){var n=this,e=[];return this.state.credentials.map(function(t){e.push(E.a.createElement("div",{key:t.meth+":"+t.val+":"+t.done},t.meth,": ",E.a.createElement("tt",null,t.val),E.a.createElement("span",null," ",t.done?null:E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),n.props.onCredConfirm(t.meth,t.val)}},E.a.createElement(S.FormattedMessage,{id:"validate_credential_action",defaultMessage:"confirm"}))," ",E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),n.props.onCredDelete(t.meth,t.val)}},E.a.createElement("i",{className:"material-icons gray"},"delete_outline")))))}),E.a.createElement(E.a.Fragment,null,this.state.showPermissionEditorFor?E.a.createElement(ca,{mode:this.state.editedPermissions,skip:"O",onSubmit:this.handlePermissionsChanged,onCancel:this.handleHidePermissionsEditor}):E.a.createElement("div",{id:"edit-account",className:"scrollable-panel"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_your_name",defaultMessage:"Your name"}))),E.a.createElement("div",null,E.a.createElement(S.FormattedMessage,{id:"full_name_prompt"},function(e){return E.a.createElement(qn,{placeholder:e,value:n.state.fullName,onFinished:n.handleFullNameUpdate})})),E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_password",defaultMessage:"Password"}))),E.a.createElement("div",null,E.a.createElement(S.FormattedMessage,{id:"password_unchanged_prompt",defaultMessage:"Unchanged"},function(e){return E.a.createElement(qn,{placeholder:e,type:"password",onFinished:n.handlePasswordUpdate})}))),E.a.createElement(de,{avatar:this.state.avatar,uid:this.props.myUserId,title:this.state.fullName,onImageChanged:this.handleImageChanged,onError:this.props.onError})),E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{htmlFor:"message-sound"},E.a.createElement(S.FormattedMessage,{id:"label_message_sound",defaultMessage:"Message sound:"})),E.a.createElement(we,{name:"sound",id:"message-sound",checked:this.props.messageSounds,onChange:this.handleCheckboxClick})),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{htmlFor:"desktop-alerts"},this.props.desktopAlertsEnabled?E.a.createElement(S.FormattedMessage,{id:"label_push_notifications",defaultMessage:"Notification alerts:"}):E.a.createElement(S.FormattedMessage,{id:"label_push_notifications_disabled",defaultMessage:"Notification alerts (requires HTTPS):"})),E.a.createElement(we,{name:"alert",id:"desktop-alerts",checked:this.props.desktopAlerts,onChange:this.props.desktopAlertsEnabled?this.handleCheckboxClick:null})),E.a.createElement("div",{className:"hr"}),E.a.createElement(S.FormattedMessage,{id:"title_tag_manager",defaultMessage:"Tags (user discovery)"},function(e){return E.a.createElement(Ea,{title:e,activated:!1,tags:n.state.tags,onSubmit:n.handleTagsUpdated})}),E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_user_contacts",defaultMessage:"Contacts:"}))),E.a.createElement("div",{className:"quoted"},e,this.state.addCredActive?E.a.createElement("input",{type:"text",value:this.state.value,className:this.state.addCredInvalid?"invalid":null,placeholder:"Phone number or email",required:"required",autoFocus:!0,onChange:this.handleCredChange,onKeyDown:this.handleCredKeyDown,onBlur:this.handleCredEntered}):null,E.a.createElement("div",null,E.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),n.setState({addCredActive:!0})}},"+ Add another")))),E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_user_id",defaultMessage:"Address:"})),E.a.createElement("tt",null,this.props.myUserId)),E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_default_access_mode",defaultMessage:"Default access mode:"}))),E.a.createElement("div",{className:"quoted"},E.a.createElement("div",null,"Auth: ",E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"auth")},this.state.auth)),E.a.createElement("div",null,"Anon: ",E.a.createElement("tt",{className:"clickable",onClick:this.handleLaunchPermissionsEditor.bind(this,"anon")},this.state.anon)))),E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("a",{href:"#",className:"red flat-button",onClick:function(e){e.preventDefault(),n.props.onLogout()}},E.a.createElement("i",{className:"material-icons"},"exit_to_app")," ",E.a.createElement(S.FormattedMessage,{id:"button_logout",defaultMessage:"Logout"}))),E.a.createElement("div",{className:"hr"}),E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("div",null,E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_legal",defaultMessage:"Legal"}))),E.a.createElement("div",{className:"quoted"},E.a.createElement("a",{href:"email:info@tinode.co",className:"flat-button",target:"_blank"},E.a.createElement("i",{className:"material-icons"},"email"),"  ",E.a.createElement(S.FormattedMessage,{id:"link_contact_us",defaultMessage:"Contact Us"}))),E.a.createElement("div",{className:"quoted"},E.a.createElement("a",{href:"https://tinode.co/terms.html",className:"flat-button",target:"_blank"},E.a.createElement("i",{className:"material-icons"},"description"),"  ",E.a.createElement(S.FormattedMessage,{id:"link_terms_of_service",defaultMessage:"Terms of Service"}))),E.a.createElement("div",{className:"quoted"},E.a.createElement("a",{href:"https://tinode.co/privacy.htnl",className:"flat-button",target:"_blank"},E.a.createElement("i",{className:"material-icons"},"policy"),"  ",E.a.createElement(S.FormattedMessage,{id:"link_privacy_policy",defaultMessage:"Privacy Policy"}))))))}}])&&Zi(as.prototype,os),void(rs&&Zi(as,rs)),ss);function ss(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ss);var n=(t=function(e,t){return!t||"object"!==$i(t)&&"function"!=typeof t?ts(e):t}(this,es(ss).call(this,e))).props.tinode.getMeTopic(),a=n.getDefaultAccess();return t.state={fullName:n.public?n.public.fn:void 0,avatar:Y(n.public?n.public.photo:null),auth:a?a.auth:null,anon:a?a.anon:null,tags:n.tags(),credentials:n.getCredentials()||[],addCredActive:!1,addCredInvalid:!1,newCred:"",showPermissionEditorFor:void 0,previousOnTags:n.onTagsUpdated},t.tnNewTags=t.tnNewTags.bind(ts(t)),t.tnCredsUpdated=t.tnCredsUpdated.bind(ts(t)),t.handleFullNameUpdate=t.handleFullNameUpdate.bind(ts(t)),t.handlePasswordUpdate=t.handlePasswordUpdate.bind(ts(t)),t.handleImageChanged=t.handleImageChanged.bind(ts(t)),t.handleCheckboxClick=t.handleCheckboxClick.bind(ts(t)),t.handleCredChange=t.handleCredChange.bind(ts(t)),t.handleCredKeyDown=t.handleCredKeyDown.bind(ts(t)),t.handleCredEntered=t.handleCredEntered.bind(ts(t)),t.handleLaunchPermissionsEditor=t.handleLaunchPermissionsEditor.bind(ts(t)),t.handleHidePermissionsEditor=t.handleHidePermissionsEditor.bind(ts(t)),t.handlePermissionsChanged=t.handlePermissionsChanged.bind(ts(t)),t.handleTagsUpdated=t.handleTagsUpdated.bind(ts(t)),t}function ls(e){return(ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cs(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function us(e){return(us=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ds(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ps(e,t){return(ps=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hs,fs,ms,gs=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ps(e,t)}(bs,E.a.Component),hs=bs,(fs=[{key:"handleLoginChange",value:function(e){this.setState({login:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"handleToggleSaveToken",value:function(){qi.setObject("keep-logged-in",!this.state.saveToken),this.setState({saveToken:!this.state.saveToken})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onLogin(this.state.login.trim(),this.state.password.trim())}},{key:"render",value:function(){var t=this,e="blue";return this.props.disabled&&(e+=" disabled"),E.a.createElement("form",{id:"login-form",onSubmit:this.handleSubmit},E.a.createElement(S.FormattedMessage,{id:"login_prompt",defaultMessage:"Login"},function(e){return E.a.createElement("input",{type:"text",id:"inputLogin",placeholder:e,autoComplete:"username",autoCorrect:"off",autoCapitalize:"none",value:t.state.login,onChange:t.handleLoginChange,required:!0,autoFocus:!0})}),E.a.createElement(S.FormattedMessage,{id:"password_prompt",defaultMessage:"Password"},function(e){return E.a.createElement(Nn,{type:"password",id:"inputPassword",placeholder:e,autoComplete:"current-password",value:t.state.password,onChange:t.handlePasswordChange,required:!0})}),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(we,{id:"save-token",name:"save-token",checked:this.state.saveToken,onChange:this.handleToggleSaveToken}),E.a.createElement("label",{htmlFor:"save-token"}," ",E.a.createElement(S.FormattedMessage,{id:"stay_logged_in",defaultMessage:"Stay logged in"})),E.a.createElement("a",{href:"#reset"},E.a.createElement(S.FormattedMessage,{id:"forgot_password_link",defaultMessage:"Forgot password?"}))),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:e,type:"submit"},E.a.createElement(S.FormattedMessage,{id:"button_sign_in",defaultMessage:"Sign in"}))))}}])&&cs(hs.prototype,fs),void(ms&&cs(hs,ms)),bs);function bs(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,bs),(t=function(e,t){return!t||"object"!==ls(t)&&"function"!=typeof t?ds(e):t}(this,us(bs).call(this,e))).state={login:e.login,password:"",hostName:e.serverAddress,saveToken:qi.getObject("keep-logged-in")},t.handleLoginChange=t.handleLoginChange.bind(ds(t)),t.handlePasswordChange=t.handlePasswordChange.bind(ds(t)),t.handleToggleSaveToken=t.handleToggleSaveToken.bind(ds(t)),t.handleSubmit=t.handleSubmit.bind(ds(t)),t}function vs(e){return(vs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ys(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _s(e){return(_s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ws(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Es(e,t){return(Es=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ss,Cs,ks,Ms=Object(S.defineMessages)({invalid_id:{id:"error_invalid_id",defaultMessage:"Invalid ID"}}),Ts=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Es(e,t)}(Ps,E.a.PureComponent),Ss=Ps,(Cs=[{key:"handleChange",value:function(e){this.setState({groupId:e.target.value})}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&this.handleSubmit(e)}},{key:"handleSubmit",value:function(e){if(e.preventDefault(),this.state.groupId){var t=this.state.groupId.trim();3<t.length&&("usr"==t.substr(0,3)||"grp"==t.substr(0,3))?this.props.onSubmit(t):this.props.onError(this.props.intl.formatMessage(Ms.invalid_id),"err")}}},{key:"render",value:function(){var t=this;return E.a.createElement("div",{className:"panel-form"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(S.FormattedMessage,{id:"group_user_id_prompt",defaultMessage:"Group or User ID"},function(e){return E.a.createElement("input",{type:"text",placeholder:e,value:t.state.groupId,onChange:t.handleChange,onKeyPress:t.handleKeyPress,required:!0})})),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:"blue",onClick:this.handleSubmit},E.a.createElement(S.FormattedMessage,{id:"button_subscribe",defaultMessage:"Subscribe"}))))}}])&&ys(Ss.prototype,Cs),void(ks&&ys(Ss,ks)),Ps);function Ps(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ps),(t=function(e,t){return!t||"object"!==vs(t)&&"function"!=typeof t?ws(e):t}(this,_s(Ps).call(this,e))).state={groupId:""},t.handleChange=t.handleChange.bind(ws(t)),t.handleKeyPress=t.handleKeyPress.bind(ws(t)),t.handleSubmit=t.handleSubmit.bind(ws(t)),t}var Os=Object(S.injectIntl)(Ts);function Ns(e){return(Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function js(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function As(e){return(As=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ds(e,t){return(Ds=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Us,Rs,Fs,Is=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ds(e,t)}(Ls,E.a.PureComponent),Us=Ls,(Rs=[{key:"handleFnChange",value:function(e){this.setState({fn:e.target.value})}},{key:"handlePrivateChange",value:function(e){this.setState({private:e.target.value})}},{key:"handleImageChanged",value:function(e){this.setState({imageDataUrl:e})}},{key:"handleTagsChanged",value:function(e){this.setState({tags:e})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.state.fn&&this.state.fn.trim()&&this.props.onSubmit(this.state.fn.trim(),this.state.imageDataUrl,this.state.private.trim(),this.state.tags)}},{key:"render",value:function(){var t=this,e="blue";return this.props.disabled&&(e+=" disabled"),E.a.createElement("form",{className:"panel-form",onSubmit:this.handleSubmit},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("div",{className:"panel-form-column"},E.a.createElement("label",{className:"small",htmlFor:"new-topic-fn"},E.a.createElement(S.FormattedMessage,{id:"label_topic_name"})),E.a.createElement(S.FormattedMessage,{id:"topic_name_editing_placeholder",defaultMessage:"Freeform name of the group"},function(e){return E.a.createElement("input",{type:"text",id:"new-topic-fn",placeholder:e,value:t.state.fn,onChange:t.handleFnChange,autoFocus:!0,required:!0})}),E.a.createElement("br",null),E.a.createElement("label",{className:"small",htmlFor:"new-topic-priv"},E.a.createElement(S.FormattedMessage,{id:"label_private"})),E.a.createElement(S.FormattedMessage,{id:"private_editing_placeholder"},function(e){return E.a.createElement("input",{type:"text",id:"new-topic-priv",placeholder:e,value:t.state.private,onChange:t.handlePrivateChange})})),E.a.createElement(de,{onError:this.props.onError,onImageChanged:this.handleImageChanged})),E.a.createElement(S.FormattedMessage,{id:"title_tag_manager"},function(e){return E.a.createElement(Ea,{tags:t.state.tags,activated:!0,onTagsChanged:t.handleTagsChanged,title:e})}),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:e},E.a.createElement(S.FormattedMessage,{id:"button_create",defaultMessage:"Create"}))))}}])&&js(Us.prototype,Rs),void(Fs&&js(Us,Fs)),Ls);function Ls(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ls),(t=function(e,t){return!t||"object"!==Ns(t)&&"function"!=typeof t?xs(e):t}(this,As(Ls).call(this,e))).state={fn:"",private:"",imageDataUrl:null,tags:[]},t.handleFnChange=t.handleFnChange.bind(xs(t)),t.handlePrivateChange=t.handlePrivateChange.bind(xs(t)),t.handleImageChanged=t.handleImageChanged.bind(xs(t)),t.handleTagsChanged=t.handleTagsChanged.bind(xs(t)),t.handleTagsChanged=t.handleTagsChanged.bind(xs(t)),t.handleSubmit=t.handleSubmit.bind(xs(t)),t}function qs(e){return(qs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hs(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ws(e){return(Ws=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bs(e,t){return(Bs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Vs,Ks,zs,Js=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bs(e,t)}(Ys,E.a.PureComponent),Vs=Ys,(Ks=[{key:"componentWillUnmount",value:function(){this.state.edited&&(this.setState({search:"",edited:!1}),this.props.onSearchContacts(C.a.DEL_CHAR))}},{key:"handleSearchChange",value:function(e){this.setState({search:e.target.value})}},{key:"handleSearch",value:function(e){e.preventDefault();var t=this.state.search.trim();this.setState({edited:0<t.length}),this.props.onSearchContacts(0<t.length?t:C.a.DEL_CHAR)}},{key:"handleClear",value:function(e){e.preventDefault(),this.state.edited&&this.props.onSearchContacts(C.a.DEL_CHAR),this.setState({search:"",edited:!1})}},{key:"handleKeyDown",value:function(e){"Enter"===e.key?this.handleSearch(e):"Escape"===e.key&&this.handleClear()}},{key:"render",value:function(){var t=this;return E.a.createElement("div",{className:"panel-form"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("i",{className:"material-icons search"},"search"),E.a.createElement(S.FormattedMessage,{id:"search_placeholder",defaultMessage:"List like email:alice@example.com, tel:17025550003..."},function(e){return E.a.createElement("input",{className:"search",type:"text",placeholder:e,value:t.state.search,onChange:t.handleSearchChange,onKeyDown:t.handleKeyDown,required:!0,autoFocus:!0})}),E.a.createElement("a",{href:"#",onClick:this.handleClear},E.a.createElement("i",{className:"material-icons"},"close"))))}}])&&Hs(Vs.prototype,Ks),void(zs&&Hs(Vs,zs)),Ys);function Ys(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ys),(t=function(e,t){return!t||"object"!==qs(t)&&"function"!=typeof t?Gs(e):t}(this,Ws(Ys).call(this,e))).state={edited:!1,search:""},t.handleSearchChange=t.handleSearchChange.bind(Gs(t)),t.handleSearch=t.handleSearch.bind(Gs(t)),t.handleClear=t.handleClear.bind(Gs(t)),t.handleKeyDown=t.handleKeyDown.bind(Gs(t)),t}function Qs(e){return(Qs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xs(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function $s(e){return($s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zs(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function el(e,t){return(el=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var tl,nl,al,ol=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&el(e,t)}(rl,E.a.Component),tl=rl,(nl=[{key:"componentDidMount",value:function(){this.props.onInitFind()}},{key:"handleTabClick",value:function(e){e.preventDefault(),v.navigateTo(v.addUrlParam(window.location.hash,"tab",e.currentTarget.dataset.id)),this.setState({tabSelected:e.currentTarget.dataset.id})}},{key:"handleContactSelected",value:function(e){"p2p"===this.state.tabSelected&&(v.navigateTo(v.removeUrlParam(window.location.hash,"tab")),this.props.onCreateTopic(e,void 0))}},{key:"handleNewGroupSubmit",value:function(e,t,n,a){v.navigateTo(v.removeUrlParam(window.location.hash,"tab")),this.props.onCreateTopic(void 0,da(e,t),n,a)}},{key:"handleGroupByID",value:function(e){v.navigateTo(v.removeUrlParam(window.location.hash,"tab")),this.props.onCreateTopic(e)}},{key:"render",value:function(){var t=this;return E.a.createElement("div",{className:"flex-column"},E.a.createElement("ul",{className:"tabbar"},E.a.createElement("li",{className:"p2p"===this.state.tabSelected?"active":null},E.a.createElement("a",{href:"#","data-id":"p2p",onClick:this.handleTabClick},E.a.createElement(S.FormattedMessage,{id:"tabtitle_find_user",defaultMessage:"find"}))),E.a.createElement("li",{className:"grp"===this.state.tabSelected?"active":null},E.a.createElement("a",{href:"#","data-id":"grp",onClick:this.handleTabClick},E.a.createElement(S.FormattedMessage,{id:"tabtitle_new_group",defaultMessage:"new group"}))),E.a.createElement("li",{className:"byid"===this.state.tabSelected?"active":null},E.a.createElement("a",{href:"#","data-id":"byid",onClick:this.handleTabClick},E.a.createElement(S.FormattedMessage,{id:"tabtitle_group_by_id",defaultMessage:"by id"})))),"grp"===this.state.tabSelected?E.a.createElement(Is,{onSubmit:this.handleNewGroupSubmit}):"byid"===this.state.tabSelected?E.a.createElement(Os,{onSubmit:this.handleGroupByID,onError:this.props.onError}):E.a.createElement("div",{className:"flex-column"},E.a.createElement(Js,{type:"p2p",onSearchContacts:this.props.onSearchContacts}),E.a.createElement(S.FormattedMessage,{id:"search_for_contacts",defaultMessage:"Use search to find contacts"},function(e){return E.a.createElement(Et,{contacts:t.props.searchResults,myUserId:t.props.myUserId,emptyListMessage:e,showOnline:!1,showUnread:!1,showContextMenu:!1,onTopicSelected:t.handleContactSelected})})))}}])&&Xs(tl.prototype,nl),void(al&&Xs(tl,al)),rl);function rl(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,rl),(t=function(e,t){return!t||"object"!==Qs(t)&&"function"!=typeof t?Zs(e):t}(this,$s(rl).call(this,e))).state={tabSelected:"p2p"},t.handleTabClick=t.handleTabClick.bind(Zs(t)),t.handleContactSelected=t.handleContactSelected.bind(Zs(t)),t.handleNewGroupSubmit=t.handleNewGroupSubmit.bind(Zs(t)),t.handleGroupByID=t.handleGroupByID.bind(Zs(t)),t}function il(e){return(il="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sl(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function ll(e){return(ll=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ul(e,t){return(ul=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dl,pl,hl,fl=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ul(e,t)}(ml,E.a.PureComponent),dl=ml,(pl=[{key:"componentDidMount",value:function(){var e=v.parseUrlHash(window.location.hash);this.setState({token:e.params.token,scheme:e.params.scheme})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.state.token?this.props.onReset(this.state.scheme,this.state.password.trim(),this.state.token):this.props.onRequest("email",this.state.email.trim())}},{key:"handleEmailChange",value:function(e){this.setState({email:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"render",value:function(){var t=this,e=this.state.token&&this.state.scheme;return E.a.createElement("form",{id:"password-reset-form",onSubmit:this.handleSubmit},e?E.a.createElement(S.FormattedMessage,{id:"new_password_placeholder",defaultMessage:"Enter new password"},function(e){return E.a.createElement(Nn,{placeholder:e,autoComplete:"new-password",value:t.state.password,required:!0,autoFocus:!0,onChange:t.handlePasswordChange})}):E.a.createElement(E.a.Fragment,null,E.a.createElement("label",{htmlFor:"inputEmail"},E.a.createElement(S.FormattedMessage,{id:"label_reset_password",defaultMessage:"Send a password reset email:"})),E.a.createElement(S.FormattedMessage,{id:"credential_email_prompt",defaultMessage:"Your registration email"},function(e){return E.a.createElement("input",{type:"email",id:"inputEmail",placeholder:e,autoComplete:"email",value:t.state.email,onChange:t.handleEmailChange,required:!0,autoFocus:!0})})),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:"blue",type:"submit"},e?E.a.createElement(S.FormattedMessage,{id:"button_reset",defaultMessage:"Reset"}):E.a.createElement(S.FormattedMessage,{id:"button_send_request",defaultMessage:"Send request"}))))}}])&&sl(dl.prototype,pl),void(hl&&sl(dl,hl)),ml);function ml(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ml),(t=function(e,t){return!t||"object"!==il(t)&&"function"!=typeof t?cl(e):t}(this,ll(ml).call(this,e))).state={email:"",password:""},t.handleSubmit=t.handleSubmit.bind(cl(t)),t.handleEmailChange=t.handleEmailChange.bind(cl(t)),t.handlePasswordChange=t.handlePasswordChange.bind(cl(t)),t}function gl(e){return(gl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bl(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function vl(e){return(vl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _l(e,t){return(_l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wl,El,Sl,Cl=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_l(e,t)}(kl,E.a.PureComponent),wl=kl,(El=[{key:"handleHostNameChange",value:function(e){this.setState({hostName:e.target.value,changed:!0})}},{key:"handleEditingFinished",value:function(){this.state.changed&&(this.setState({changed:!1}),this.props.onServerAddressChange(this.state.hostName.trim()))}},{key:"render",value:function(){var e=[];for(var t in u){var n=u[t];e.push(E.a.createElement("option",{key:n,value:n}))}return E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("input",{type:"search",id:"host-name",placeholder:this.props.hostName,list:"known-hosts",className:"quoted",value:this.state.hostName,onChange:this.handleHostNameChange,onBlur:this.handleEditingFinished,required:!0}),E.a.createElement("datalist",{id:"known-hosts"},e))}}])&&bl(wl.prototype,El),void(Sl&&bl(wl,Sl)),kl);function kl(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,kl),(t=function(e,t){return!t||"object"!==gl(t)&&"function"!=typeof t?yl(e):t}(this,vl(kl).call(this,e))).state={hostName:e.serverAddress,changed:!1},t.handleHostNameChange=t.handleHostNameChange.bind(yl(t)),t.handleEditingFinished=t.handleEditingFinished.bind(yl(t)),t}function Ml(e){return(Ml="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Tl(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Pl(e){return(Pl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ol(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nl(e,t){return(Nl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jl,Al,xl,Dl=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nl(e,t)}(Ul,E.a.PureComponent),jl=Ul,(Al=[{key:"handleSubmit",value:function(e){e.preventDefault(),this.props.onUpdate({transport:this.state.transport,serverAddress:this.state.serverAddress})}},{key:"handleTransportSelected",value:function(e){this.setState({transport:e.currentTarget.value})}},{key:"handleServerAddressChange",value:function(e){this.setState({serverAddress:e})}},{key:"render",value:function(){var a={def:"default",ws:"websocket",lp:"long polling"},o=[],r=this;return["def","ws","lp"].map(function(e){var t="transport-"+e,n=a[e];o.push(E.a.createElement("li",{key:e},E.a.createElement("input",{type:"radio",id:t,name:"transport-select",value:e,checked:r.state.transport===e,onChange:r.handleTransportSelected}),E.a.createElement("label",{htmlFor:t},n)))}),E.a.createElement("form",{id:"settings-form",className:"panel-form",onSubmit:this.handleSubmit},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_server_to_use",defaultMessage:"Server to use:"}))),E.a.createElement(Cl,{serverAddress:this.state.serverAddress,onServerAddressChange:this.handleServerAddressChange}),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small"},E.a.createElement(S.FormattedMessage,{id:"label_wire_transport",defaultMessage:"Wire transport:"}))),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("ul",{className:"quoted"},o)),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{type:"submit",className:"blue"},E.a.createElement(S.FormattedMessage,{id:"button_update",defaultMessage:"Update"}))))}}])&&Tl(jl.prototype,Al),void(xl&&Tl(jl,xl)),Ul);function Ul(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Ul),(t=function(e,t){return!t||"object"!==Ml(t)&&"function"!=typeof t?Ol(e):t}(this,Pl(Ul).call(this,e))).state={transport:e.transport||"def",serverAddress:e.serverAddress},t.handleSubmit=t.handleSubmit.bind(Ol(t)),t.handleTransportSelected=t.handleTransportSelected.bind(Ol(t)),t.handleServerAddressChange=t.handleServerAddressChange.bind(Ol(t)),t}function Rl(e){return(Rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fl(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Il(e){return(Il=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ll(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ql(e,t){return(ql=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Hl,Wl,Gl,Bl=Object(S.defineMessages)({phone:{id:"phone_dative",defaultMessage:"phone"},email:{id:"email_dative",defaultMessage:"email"}}),Vl=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ql(e,t)}(Kl,E.a.PureComponent),Hl=Kl,(Wl=[{key:"handleChange",value:function(e){this.setState({code:e.target.value})}},{key:"handleKeyPress",value:function(e){"Enter"===e.key?this.handleSubmit(e):"Escape"==e.key&&this.handleCancel(e)}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.state.code&&this.state.code.trim()&&this.props.onSubmit(this.props.credMethod,this.state.code.trim())}},{key:"handleCancel",value:function(e){e.preventDefault(),this.props.onCancel()}},{key:"render",value:function(){var t=this,e=this.props.intl.formatMessage,n={email:e(Bl.email),tel:e(Bl.phone)}[this.props.credMethod]||this.props.credMethod;return E.a.createElement("div",{className:"panel-form"},E.a.createElement("div",{className:"panel-form-row"},E.a.createElement("label",{className:"small",htmlFor:"enter-confirmation-code"},E.a.createElement(S.FormattedMessage,{id:"enter_confirmation_code_prompt",defaultMessage:"Enter confirmation code sent to you by {method}:",values:{method:n}}))),E.a.createElement("div",{className:"panel-form-row"},E.a.createElement(S.FormattedMessage,{id:"numeric_confirmation_code_prompt",defaultMessage:"Numbers only"},function(e){return E.a.createElement("input",{type:"text",id:"enter-confirmation-code",placeholder:e,value:t.state.code,onChange:t.handleChange,onKeyPress:t.handleKeyPress,required:!0})})),E.a.createElement("div",{className:"dialog-buttons"},E.a.createElement("button",{className:"blue",onClick:this.handleSubmit},E.a.createElement(S.FormattedMessage,{id:"button_confirm",defaultMessage:"Confirm"})),E.a.createElement("button",{className:"white",onClick:this.handleCancel},E.a.createElement(S.FormattedMessage,{id:"button_cancel"}))))}}])&&Fl(Hl.prototype,Wl),void(Gl&&Fl(Hl,Gl)),Kl);function Kl(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Kl),(t=function(e,t){return!t||"object"!==Rl(t)&&"function"!=typeof t?Ll(e):t}(this,Il(Kl).call(this,e))).state={code:e.credCode||""},t.handleChange=t.handleChange.bind(Ll(t)),t.handleKeyPress=t.handleKeyPress.bind(Ll(t)),t.handleSubmit=t.handleSubmit.bind(Ll(t)),t.handleCancel=t.handleCancel.bind(Ll(t)),t}var zl=Object(S.injectIntl)(Vl);function Jl(e){return(Jl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yl(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function Ql(e){return(Ql=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $l(e,t){return($l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zl,ec,tc,nc=Object(S.defineMessages)({login:{id:"sidepanel_title_login",defaultMessage:"Sign In"},register:{id:"sidepanel_title_register",defaultMessage:"Create Account"},settings:{id:"sidepanel_title_settings",defaultMessage:"Settings"},edit:{id:"sidepanel_title_edit_account",defaultMessage:"Edit Account"},newtpk:{id:"sidepanel_title_newtpk",defaultMessage:"Start New Chat"},cred:{id:"sidepanel_title_cred",defaultMessage:"Confirm Credentials"},reset:{id:"sidepanel_title_reset",defaultMessage:"Reset Password"},archive:{id:"sidepanel_title_archive",defaultMessage:"Archived Chats"}}),ac=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$l(e,t)}(oc,E.a.Component),Zl=oc,(ec=[{key:"handleLoginRequested",value:function(e,t){this.props.onLoginRequest(e,t)}},{key:"render",value:function(){var e,t,n,a=this.props.intl.formatMessage,o=this.props.state||(this.props.myUserId?"contacts":"login");return t="contacts"==o?(e=this.props.title,!this.props.avatar||this.props.avatar):(e=a(nc[o]),!1),-1==["login","contacts"].indexOf(o)&&(n=this.props.onCancel),E.a.createElement("div",{id:"sidepanel",className:this.props.hideSelf?"nodisplay":null},E.a.createElement(Si,{state:o,title:e,avatar:t,myUserId:this.props.myUserId,onSignUp:this.props.onSignUp,onSettings:this.props.onSettings,onNewTopic:this.props.onNewTopic,onCancel:n}),E.a.createElement(Ht,{level:this.props.errorLevel,text:this.props.errorText,action:this.props.errorAction,actionText:this.props.errorActionText,onClearError:this.props.onError}),"login"===o?E.a.createElement(gs,{login:this.props.login,disabled:this.props.loginDisabled,onLogin:this.handleLoginRequested}):"register"===o?E.a.createElement(Qi,{onCreateAccount:this.props.onCreateAccount,onCancel:this.props.onCancel,onError:this.props.onError}):"settings"===o?E.a.createElement(Dl,{transport:this.props.transport,serverAddress:this.props.serverAddress,onCancel:this.props.onCancel,onUpdate:this.props.onGlobalSettings}):"edit"===o?E.a.createElement(is,{tinode:this.props.tinode,myUserId:this.props.myUserId,messageSounds:this.props.messageSounds,desktopAlerts:this.props.desktopAlerts,desktopAlertsEnabled:this.props.desktopAlertsEnabled,onUpdateAccount:this.props.onUpdateAccount,onUpdateTags:this.props.onUpdateAccountTags,onTogglePushNotifications:this.props.onTogglePushNotifications,onToggleMessageSounds:this.props.onToggleMessageSounds,onCredAdd:this.props.onCredAdd,onCredDelete:this.props.onCredDelete,onCredConfirm:this.props.onCredConfirm,onLogout:this.props.onLogout,onCancel:this.props.onCancel,onError:this.props.onError}):"contacts"===o||"archive"==o?E.a.createElement(Di,{tinode:this.props.tinode,myUserId:this.props.myUserId,connected:this.props.connected,topicSelected:this.props.topicSelected,archive:"archive"==o,chatList:this.props.chatList,showContextMenu:this.props.showContextMenu,onTopicSelected:this.props.onTopicSelected,onShowArchive:this.props.onShowArchive}):"newtpk"===o?E.a.createElement(ol,{searchResults:this.props.searchResults,onInitFind:this.props.onInitFind,onSearchContacts:this.props.onSearchContacts,onCreateTopic:this.props.onCreateTopic,onError:this.props.onError}):"cred"===o?E.a.createElement(zl,{credCode:this.props.credCode,credMethod:this.props.credMethod,onSubmit:this.props.onValidateCredentials,onCancel:this.props.onCancel,onError:this.props.onError}):"reset"===o?E.a.createElement(fl,{onRequest:this.props.onPasswordResetRequest,onReset:this.props.onResetPassword}):null)}}])&&Yl(Zl.prototype,ec),void(tc&&Yl(Zl,tc)),oc);function oc(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,oc),(t=function(e,t){return!t||"object"!==Jl(t)&&"function"!=typeof t?Xl(e):t}(this,Ql(oc).call(this,e))).handleLoginRequested=t.handleLoginRequested.bind(Xl(t)),t}var rc=Object(S.injectIntl)(ac);function ic(e){return(ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sc(){return"object"==ic(window.location)&&"https:"==window.location.protocol}function lc(e){return(lc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uc(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function dc(e){return(dc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pc(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hc(e,t){return(hc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fc,mc,gc,bc=new Audio("audio/msg.mp3"),vc=Object(S.defineMessages)({update_available:{id:"update_available",defaultMessage:'Update available. <a href="">Reload</a>.'},reconnect_countdown:{id:"reconnect_countdown",defaultMessage:"Disconnected. Reconnecting in {seconds}…"},reconnect_now:{id:"reconnect_now",defaultMessage:"Try now"}}),yc=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hc(e,t)}(_c,E.a.Component),fc=_c,gc=[{key:"tnSetup",value:function(e,t){var n=new C.a(c,e,"AQEAAAABAAD_rAp4DJh05a1HAwFT3A6K",t,sc());return n.enableLogging(!0,!0),n}},{key:"prepareSearchableContacts",value:function(e,t){var n={},a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;"p2p"==C.a.topicType(l.topic)&&(n[l.topic]={user:l.topic,updated:l.updated,public:l.public,private:l.private,acs:l.acs})}}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}var c=!0,u=!1,d=void 0;try{for(var p,h=t[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var f=p.value;n[f.user]||(n[f.user]=f)}}catch(e){u=!0,d=e}finally{try{c||null==h.return||h.return()}finally{if(u)throw d}}return Object.values(n)}}],(mc=[{key:"getBlankState",value:function(){var e,t=qi.getObject("settings")||{};return cc(e={connected:!1,ready:!1,transport:t.transport||null,serverAddress:t.serverAddress||function(){var e=d;return"object"==ic(window.location)&&("file:"==window.location.protocol||"localhost"==window.location.hostname?e=u.local:window.location.hostname&&(e=window.location.hostname+(window.location.port?":"+window.location.port:""))),e}(),serverVersion:"no connection",messageSounds:!t.messageSoundsOff,desktopAlerts:t.desktopAlerts,desktopAlertsEnabled:(sc()||"object"==ic(window.location)&&"localhost"==window.location.hostname)&&void 0!==s&&"undefined"!=typeof navigator&&"undefined"!=typeof FIREBASE_INIT,firebaseToken:qi.getObject("firebase-token"),errorText:"",errorLevel:null,errorAction:void 0,errorActionText:null,sidePanelSelected:"login",sidePanelTitle:null,sidePanelAvatar:null,dialogSelected:null,contextMenuVisible:!1,login:"",password:"",myUserId:null,liveConnection:navigator.onLine,topicSelected:"",topicSelectedOnline:!1,topicSelectedAcs:null,newTopicParams:null,loginDisabled:!1,displayMobile:window.innerWidth<=640,showInfoPanel:!1,mobilePanel:"sidepanel"},"contextMenuVisible",!1),cc(e,"contextMenuBounds",null),cc(e,"contextMenuClickAt",null),cc(e,"contextMenuParams",null),cc(e,"contextMenuItems",[]),cc(e,"chatList",[]),cc(e,"searchResults",[]),cc(e,"searchableContacts",[]),cc(e,"credMethod",void 0),cc(e,"credCode",void 0),e}},{key:"componentDidMount",value:function(){var t=this;if(window.addEventListener("resize",this.handleResize),window.addEventListener("online",function(e){t.handleOnline(!0)}),window.addEventListener("offline",function(e){t.handleOnline(!1)}),window.addEventListener("hashchange",this.handleHashRoute),document.addEventListener("visibilitychange",this.handleVisibilityEvent),this.setState({viewportWidth:document.documentElement.clientWidth,viewportHeight:document.documentElement.clientHeight}),this.tinode=_c.tnSetup(this.state.serverAddress,this.state.transport),this.tinode.onConnect=this.handleConnected,this.tinode.onDisconnect=this.handleDisconnect,this.tinode.onAutoreconnectIteration=this.handleAutoreconnectIteration,this.state.desktopAlertsEnabled)try{this.fbPush=s.initializeApp(FIREBASE_INIT,c).messaging(),this.fbPush.usePublicVapidKey(FIREBASE_INIT.messagingVapidKey),navigator.serviceWorker.register("/service-worker.js").then(function(e){t.checkForAppUpdate(e),t.fbPush.useServiceWorker(e),t.initDesktopAlerts(),t.state.desktopAlerts&&(t.state.firebaseToken?t.tinode.setDeviceToken(t.state.firebaseToken,!0):t.togglePushToken(!0))}).catch(function(e){console.log("Failed to register service worker:",e)})}catch(e){this.handleError("Failed to initialize push notifications","err"),console.log("Failed to initialize push notifications",e),this.setState({desktopAlertsEnabled:!1})}var e=qi.getObject("keep-logged-in")?qi.getObject("auth-token"):void 0,n=v.parseUrlHash(window.location.hash);e?(e.expires=new Date(e.expires),this.tinode.setAuthToken(e),this.tinode.connect().catch(function(e){t.handleError(e.message,"err")}),delete n.params.info,delete n.params.tab,n.path[0]="",v.navigateTo(v.composeUrlHash(n.path,n.params))):n.params.token||v.navigateTo(""),this.readTimer=null,this.readTimerCallback=null,this.handleHashRoute()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),window.removeEventListener("hashchange",this.handleHashRoute),document.removeEventListener("visibilitychange",this.handleVisibilityEvent)}},{key:"handleResize",value:function(){var e=document.documentElement.clientWidth<=640;this.setState({viewportWidth:document.documentElement.clientWidth,viewportHeight:document.documentElement.clientHeight}),this.state.displayMobile!=e&&this.setState({displayMobile:e})}},{key:"checkForAppUpdate",value:function(t){var n=this,a=this.props.intl.formatHTMLMessage;t.onupdatefound=function(){var e=t.installing;e.onstatechange=function(){"installed"==e.state&&navigator.serviceWorker.controller&&n.handleError(a(vc.update_available),"info")}}}},{key:"handleHashRoute",value:function(){var e=v.parseUrlHash(window.location.hash);e.path&&0<e.path.length?(["register","settings","edit","cred","reset","newtpk","archive","contacts",""].includes(e.path[0])?this.setState({sidePanelSelected:e.path[0]}):console.log("Unknown sidepanel view",e.path[0]),1<e.path.length&&e.path[1]!=this.state.topicSelected&&this.setState({topicSelected:C.a.topicType(e.path[1])?e.path[1]:null})):this.setState({sidePanelSelected:""}),e.params.method&&this.setState({credMethod:e.params.method}),e.params.code&&this.setState({credCode:e.params.code}),this.setState({showInfoPanel:e.params.info,newTopicTabSelected:e.params.tab})}},{key:"handleOnline",value:function(e){e?this.handleError("",null):this.handleError("No connection","warn"),this.setState({liveConnection:e})}},{key:"handleAppVisibility",value:function(e,t){clearTimeout(this.readTimer),this.readTimerCallback=t,this.readTimer=e&&t?setTimeout(t,1e3):null}},{key:"handleReadTimer",value:function(e){this.handleAppVisibility(!document.hidden,e)}},{key:"handleVisibilityEvent",value:function(){this.handleAppVisibility(!document.hidden,this.readTimerCallback)}},{key:"handleError",value:function(e,t,n,a){this.setState({errorText:e,errorLevel:t,errorAction:n,errorActionText:a})}},{key:"handleLoginRequest",value:function(e,t){var n=this;this.setState({loginDisabled:!0,login:e,password:t}),this.handleError("",null),this.tinode.isConnected()?this.doLogin(e,t,{meth:this.state.credMethod,resp:this.state.credCode}):this.tinode.connect().catch(function(e){n.setState({loginDisabled:!1}),n.handleError(e.message,"err")})}},{key:"handleConnected",value:function(){var e=this.tinode.getServerInfo();this.setState({serverVersion:e.ver+" "+(e.build?e.build:"none")+"; "}),this.doLogin(this.state.login,this.state.password,{meth:this.state.credMethod,resp:this.state.credCode})}},{key:"handleAutoreconnectIteration",value:function(e,t){var n=this;if(clearInterval(this.reconnectCountdown),e<0)this.handleError();else if(t)t.then(function(){n.handleError()}).catch(function(e){n.handleError(e.message,"err")});else{var a=this.props.intl.formatHTMLMessage,o=e/1e3;o|=o,this.reconnectCountdown=setInterval(function(){var e=99<o?function(e){var t=Math.floor(e/60),n=e%60;return n=n<10?"0".concat(n):n,"".concat(t,":").concat(n)}(o):o;n.handleError(a(vc.reconnect_countdown,{seconds:e}),"warn",function(){clearInterval(n.reconnectCountdown),n.tinode.reconnect()},a(vc.reconnect_now)),o-=1},1e3)}}},{key:"handleDisconnect",value:function(e){this.setState({connected:!1,ready:!1,topicSelectedOnline:!1,dialogSelected:null,errorText:e&&e.message?e.message:"Disconnected",errorLevel:e&&e.message?"err":"warn",loginDisabled:!1,contextMenuVisible:!1,serverVersion:"no connection"})}},{key:"doLogin",value:function(e,t,n){var a=this;if(this.tinode.isAuthenticated())v.navigateTo("");else{n=C.a.credential(n);var o=null,r=this.tinode.getAuthToken();e&&t?(this.setState({password:null}),o=this.tinode.loginBasic(e,t,n)):r&&(o=this.tinode.loginToken(r.token,n)),o?o.then(function(e){300<=e.code&&"validate credentials"===e.text?(n&&a.handleError("Code does not match","warn"),a.handleCredentialsRequest(e.params)):a.handleLoginSuccessful()}).catch(function(e){a.setState({loginDisabled:!1,credMethod:void 0,credCode:void 0}),a.handleError(e.message,"err"),localStorage.removeItem("auth-token"),v.navigateTo("")}):(v.navigateTo(""),this.setState({loginDisabled:!1}))}}},{key:"handleCredentialsRequest",value:function(e){var t=v.parseUrlHash(window.location.hash);t.path[0]="cred",t.params.method=e.cred[0],v.navigateTo(v.composeUrlHash(t.path,t.params))}},{key:"handleLoginSuccessful",value:function(){var t=this;this.handleError("",null),qi.getObject("keep-logged-in")&&qi.setObject("auth-token",this.tinode.getAuthToken());var e=this.tinode.getMeTopic();e.onMetaDesc=this.tnMeMetaDesc,e.onContactUpdate=this.tnMeContactUpdate,e.onSubsUpdated=this.tnMeSubsUpdated,this.setState({connected:!0,credMethod:void 0,credCode:void 0,myUserId:this.tinode.getCurrentUserID()}),e.subscribe(e.startMetaQuery().withLaterSub().withDesc().withTags().withCred().build()).catch(function(e){localStorage.removeItem("auth-token"),t.handleError(e.message,"err"),v.navigateTo("")}),v.navigateTo(v.setUrlSidePanel(window.location.hash,"contacts"))}},{key:"tnMeMetaDesc",value:function(e){e&&e.public&&this.setState({sidePanelTitle:e.public.fn,sidePanelAvatar:Y(e.public.photo)})}},{key:"tnMeContactUpdate",value:function(e,t){if("on"==e||"off"==e)this.resetContactList(),this.state.topicSelected==t.topic&&this.setState({topicSelectedOnline:"on"==e});else if("read"==e)this.resetContactList();else if("msg"==e){var n=this.tinode.getTopic(t.topic),a=n&&n.isArchived();document.hidden?(this.state.messageSounds&&!a&&bc.play(),this.resetContactList()):this.state.topicSelected!=t.topic&&(this.state.messageSounds&&!a&&bc.play(),this.resetContactList())}else"recv"==e||("gone"==e||"unsub"==e?(this.state.topicSelected==t.topic&&this.handleTopicSelected(null),this.resetContactList()):"acs"==e?this.state.topicSelected==t.topic&&this.setState({topicSelectedAcs:t.acs}):"del"==e||console.log("Unsupported (yet) presence update:"+e+" in: "+t.topic))}},{key:"tnMeSubsUpdated",value:function(e){this.resetContactList()}},{key:"resetContactList",value:function(){var t=this,n={chatList:[]};this.state.ready||(n.ready=!0),this.tinode.getMeTopic().contacts(function(e){n.chatList.push(e),t.state.topicSelected==e.topic&&(n.topicSelectedOnline=e.online,n.topicSelectedAcs=e.acs)}),n.searchableContacts=_c.prepareSearchableContacts(n.chatList,this.state.searchResults),this.setState(n)}},{key:"tnData",value:function(e){var t=this,n=this.tinode.getTopic(e.topic);n.msgStatus(e)>=C.a.MESSAGE_STATUS_SENT&&e.from!=this.state.myUserId&&(clearTimeout(this.receivedTimer),this.receivedTimer=setTimeout(function(){t.receivedTimer=void 0,n.noteRecv(e.seq)},500))}},{key:"tnInitFind",value:function(){var t=this,e=this.tinode.getFndTopic();e.onSubsUpdated=this.tnFndSubsUpdated,e.isSubscribed()?this.tnFndSubsUpdated():e.subscribe(e.startMetaQuery().withSub().build()).catch(function(e){t.handleError(e.message,"err")})}},{key:"tnFndSubsUpdated",value:function(){var t=[];this.tinode.getFndTopic().contacts(function(e){t.push(e)}),this.setState({searchResults:t,searchableContacts:_c.prepareSearchableContacts(this.state.chatList,t)})}},{key:"handleSearchContacts",value:function(e){var t=this,n=this.tinode.getFndTopic();n.setMeta({desc:{public:e}}).then(function(e){return n.getMeta(n.startMetaQuery().withSub().build())}).catch(function(e){t.handleError(e.message,"err")})}},{key:"handleTopicSelected",value:function(e,t,n,a){this.state.newTopicParams&&this.state.newTopicParams._topicName!=e&&this.setState({newTopicParams:null}),e?(this.setState({errorText:"",errorLevel:null,mobilePanel:"topic-view",showInfoPanel:!1}),this.state.topicSelected!=e&&(this.setState({topicSelectedOnline:n,topicSelectedAcs:a}),v.navigateTo(v.setUrlTopic("",e)))):(this.setState({errorText:"",errorLevel:null,mobilePanel:"sidepanel",topicSelectedOnline:!1,topicSelectedAcs:null,showInfoPanel:!1}),v.navigateTo(v.setUrlTopic("",null)))}},{key:"handleHideMessagesView",value:function(){this.setState({mobilePanel:"sidepanel"}),v.navigateTo(v.setUrlTopic(window.location.hash,null))}},{key:"handleSendMessage",value:function(e,t,n){var a=this,o=this.tinode.getTopic(this.state.topicSelected);(e=o.createMessage(e,!1))._uploader=n,o.isSubscribed()||(t=(t=t||Promise.resolve()).then(function(){return o.subscribe()})),t=t&&t.catch(function(e){a.handleError(e.message,"err")}),o.publishDraft(e,t).then(function(e){if(o.isArchived())return o.archive(!1)}).catch(function(e){a.handleError(e.message,"err")})}},{key:"handleNewChatInvitation",value:function(t,e){var n=this,a=this.tinode.getTopic(t),o=null;switch(e){case"accept":var r=a.getAccessMode().getGiven();o=a.setMeta({sub:{mode:r}}),"p2p"==a.getType()&&(o=o.then(function(e){a.setMeta({sub:{user:t,mode:r}})}));break;case"delete":o=a.delTopic();break;case"block":var i=a.getAccessMode().updateWant("-JP").getWant();o=a.setMeta({sub:{mode:i}}).then(function(e){return n.handleTopicSelected(null)});break;default:console.log("Unknown invitation action",'"'+e+'""')}null!=o&&o.catch(function(e){n.handleError(e.message,"err")})}},{key:"handleNewAccount",value:function(){v.navigateTo(v.setUrlSidePanel(window.location.hash,"register"))}},{key:"handleNewAccountRequest",value:function(e,t,n,a,o){var r=this;this.tinode.connect(this.state.serverAddress).then(function(){return r.tinode.createAccountBasic(e,t,{public:n,tags:o,cred:C.a.credential(a)})}).then(function(e){300<=e.code&&"validate credentials"==e.text?r.handleCredentialsRequest(e.params):r.handleLoginSuccessful(r)}).catch(function(e){r.handleError(e.message,"err")})}},{key:"handleUpdateAccountRequest",value:function(e,t,n){var a=this;if(t||n){var o={};t&&(o.public=t),n&&(o.defacs=n),this.tinode.getMeTopic().setMeta({desc:o}).catch(function(e){a.handleError(e.message,"err")})}e&&this.tinode.updateAccountBasic(null,this.tinode.getCurrentLogin(),e).catch(function(e){a.handleError(e.message,"err")})}},{key:"handleUpdateAccountTagsRequest",value:function(e){var t=this;this.tinode.getMeTopic().setMeta({tags:e}).catch(function(e){t.handleError(e.message,"err")})}},{key:"handleSettings",value:function(){v.navigateTo(v.setUrlSidePanel(window.location.hash,this.state.myUserId?"edit":"settings"))}},{key:"handleGlobalSettings",value:function(e){var t=e.serverAddress||this.state.serverAddress,n=e.transport||this.state.transport;this.tinode&&(this.tinode.onDisconnect=void 0,this.tinode.disconnect()),this.tinode=_c.tnSetup(t,n),this.tinode.onConnect=this.handleConnected,this.tinode.onDisconnect=this.handleDisconnect,this.setState({serverAddress:t,transport:n}),qi.setObject("settings",{serverAddress:t,transport:n}),v.navigateTo(v.setUrlSidePanel(window.location.hash,""))}},{key:"handleShowArchive",value:function(){v.navigateTo(v.setUrlSidePanel(window.location.hash,this.state.myUserId?"archive":""))}},{key:"initDesktopAlerts",value:function(){var e=this;this.fbPush.onTokenRefresh(function(){e.requestPushToken()}),this.fbPush.onMessage(function(e){})}},{key:"togglePushToken",value:function(e){var t=this;e?this.state.firebaseToken?(this.setState({desktopAlerts:!0}),qi.updateObject("settings",{desktopAlerts:!0})):this.fbPush.requestPermission().then(function(){t.requestPushToken()}).catch(function(e){t.handleError(e.message,"err"),t.setState({desktopAlerts:!1,firebaseToken:null}),qi.updateObject("settings",{desktopAlerts:!1}),console.log("Failed to get permission to notify.",e)}):this.state.firebaseToken?this.fbPush.deleteToken(this.state.firebaseToken).catch(function(e){console.log("Unable to delete token.",e)}).finally(function(){qi.updateObject("settings",{desktopAlerts:!1}),localStorage.removeItem("firebase-token"),t.setState({desktopAlerts:!1,firebaseToken:null})}):(this.setState({desktopAlerts:!1,firebaseToken:null}),qi.updateObject("settings",{desktopAlerts:!1}))}},{key:"requestPushToken",value:function(){var t=this;this.fbPush.getToken().then(function(e){e!=t.state.firebaseToken&&(t.tinode.setDeviceToken(e,!0),qi.setObject("firebase-token",e)),t.setState({firebaseToken:e,desktopAlerts:!0}),qi.updateObject("settings",{desktopAlerts:!0})}).catch(function(e){t.handleError(e.message,"err"),console.log("Failed to retrieve firebase token",e)})}},{key:"handleToggleMessageSounds",value:function(e){this.setState({messageSounds:e}),qi.updateObject("settings",{messageSoundsOff:!e})}},{key:"handleCredAdd",value:function(e,t){var n=this;this.tinode.getMeTopic().setMeta({cred:{meth:e,val:t}}).catch(function(e){n.handleError(e.message,"err")})}},{key:"handleCredDelete",value:function(e,t){var n=this;this.tinode.getMeTopic().delCredential(e,t).catch(function(e){n.handleError(e.message,"err")})}},{key:"handleCredConfirm",value:function(e,t){this.handleCredentialsRequest({cred:[e]})}},{key:"handleSidepanelCancel",value:function(){var e=v.parseUrlHash(window.location.hash);e.path[0]=this.state.myUserId?"contacts":"",e.params&&(delete e.params.code,delete e.params.method,delete e.params.tab),v.navigateTo(v.composeUrlHash(e.path,e.params)),this.setState({errorText:"",errorLevel:null})}},{key:"handleNewTopic",value:function(){v.navigateTo(v.setUrlSidePanel(window.location.hash,"newtpk"))}},{key:"handleNewTopicRequest",value:function(e,t,n,a){var o=this,r=e||this.tinode.newGroupTopicName(),i={_topicName:r};e?(i.sub={mode:p},i.desc={defacs:{auth:p}}):(i.desc={public:t,private:{comment:n}},i.tags=a),this.setState({newTopicParams:i},function(){o.handleTopicSelected(r)})}},{key:"handleNewTopicCreated",value:function(e,t){this.state.topicSelected==e&&e!=t&&this.setState({topicSelected:t},function(){v.navigateTo(v.setUrlTopic("",t))})}},{key:"handleTopicUpdateRequest",value:function(e,t,n,a){var o=this,r=this.tinode.getTopic(e);if(r){var i={};t&&(i.public=t),n&&(i.private=n===C.a.DEL_CHAR?C.a.DEL_CHAR:{comment:n}),a&&(i.defacs=a),r.setMeta({desc:i}).catch(function(e){o.handleError(e.message,"err")})}}},{key:"handleChangePermissions",value:function(e,t,n){var a=this,o=this.tinode.getTopic(e);if(o){var r=o.getAccessMode();t=n?(r.updateGiven(t),r.getGiven()):(r.updateWant(t),r.getWant()),o.setMeta({sub:{user:n,mode:t}}).catch(function(e){a.handleError(e.message,"err")})}}},{key:"handleTagsUpdated",value:function(e,t){var n=this,a=this.tinode.getTopic(e);a&&a.setMeta({tags:t}).catch(function(e){n.handleError(e.message,"err")})}},{key:"handleLogout",value:function(){ua(0),localStorage.removeItem("auth-token"),localStorage.removeItem("firebase-token"),localStorage.removeItem("settings"),this.state.firebaseToken&&this.fbPush.deleteToken(this.state.firebaseToken),this.tinode&&(this.tinode.onDisconnect=void 0,this.tinode.disconnect()),this.setState(this.getBlankState()),this.tinode=_c.tnSetup(this.state.serverAddress,this.state.transport),this.tinode.onConnect=this.handleConnected,this.tinode.onDisconnect=this.handleDisconnect,v.navigateTo("")}},{key:"handleLeaveUnsubRequest",value:function(e){var t=this,n=this.tinode.getTopic(e);n&&n.leave(!0).then(function(e){v.navigateTo(v.setUrlTopic(window.location.hash,""))}).catch(function(e){t.handleError(e.message,"err")})}},{key:"handleDialogCancel",value:function(){this.setState({dialogSelected:null})}},{key:"handleShowContextMenu",value:function(e,t){this.setState({contextMenuVisible:!0,contextMenuClickAt:{x:e.x,y:e.y},contextMenuParams:e,contextMenuItems:t||this.defaultTopicContextMenu(e.topicName),contextMenuBounds:r.a.findDOMNode(this).getBoundingClientRect()})}},{key:"defaultTopicContextMenu",value:function(e){var t=this.tinode.getTopic(e),n=this.props.intl.formatMessage,a=!1,o=!1,r=!1,i=!1,s=!1,l=!1;if(t){i=t.isSubscribed(),l=t.isArchived();var c=t.getAccessMode();c&&(a=c.isMuted(),o=!c.isJoiner(),r=!c.isJoiner("want"),s=c.isDeleter())}return[i?{title:n({id:"menu_item_info"}),handler:this.handleShowInfoView}:null,i?"messages_clear":null,i&&s?"messages_clear_hard":null,a?o?null:"topic_unmute":"topic_mute",r?"topic_unblock":"topic_block",l?null:"topic_archive","topic_delete"]}},{key:"handleHideContextMenu",value:function(){this.setState({contextMenuVisible:!1,contextMenuClickAt:null,contextMenuParams:null,contextMenuBounds:null})}},{key:"handleContextMenuAction",value:function(e,t,n){var a=this;"topic_archive"==e&&t&&n.topicName&&n.topicName==this.state.topicSelected&&t.then(function(){a.handleTopicSelected(null)})}},{key:"handleShowInfoView",value:function(){v.navigateTo(v.addUrlParam(window.location.hash,"info",!0)),this.setState({showInfoPanel:!0})}},{key:"handleHideInfoView",value:function(){v.navigateTo(v.removeUrlParam(window.location.hash,"info")),this.setState({showInfoPanel:!1})}},{key:"handleMemberUpdateRequest",value:function(e,t,n){var a=this;if(e){var o=this.tinode.getTopic(e);o&&(t&&0<t.length&&t.map(function(e){o.invite(e,null).catch(function(e){a.handleError(e.message,"err")})}),n&&0<n.length&&n.map(function(e){o.delSubscription(e).catch(function(e){a.handleError(e.message,"err")})}))}}},{key:"handleValidateCredentialsRequest",value:function(e,t){var n=this;this.tinode.isAuthenticated()?this.tinode.getMeTopic().setMeta({cred:{meth:e,resp:t}}).then(function(){v.navigateTo("")}).catch(function(e){n.handleError(e.message,"err")}):(this.setState({credMethod:e,credCode:t}),this.doLogin(null,null,{meth:e,resp:t}))}},{key:"handlePasswordResetRequest",value:function(e,t){var n=this;this.tinode.connect().then(function(){return n.tinode.requestResetAuthSecret("basic",e,t)}).catch(function(e){n.handleError(e.message,"err")})}},{key:"handleResetPassword",value:function(e,t,n){var a=this;(n=function(t){if(t){t=t.replace("-","+").replace("_","/");try{t=btoa(atob(t))}catch(e){console.log("Failed to base64 re-encode string"),t=null}}return t}(n))?this.tinode.connect().then(function(){return a.tinode.updateAccountBasic(null,null,t,{token:n})}).catch(function(e){a.handleError(e.message,"err")}):this.handleError("Invalid security token","err")}},{key:"render",value:function(){var t=this;return E.a.createElement("div",{id:"app-container"},this.state.contextMenuVisible?E.a.createElement(D,{tinode:this.tinode,bounds:this.state.contextMenuBounds,clickAt:this.state.contextMenuClickAt,params:this.state.contextMenuParams,items:this.state.contextMenuItems,hide:this.handleHideContextMenu,onAction:this.handleContextMenuAction,onTopicRemoved:function(e){e==t.state.topicSelected&&t.handleTopicSelected(null)},onError:this.handleError}):null,E.a.createElement(rc,{tinode:this.tinode,connected:this.state.connected,displayMobile:this.state.displayMobile,hideSelf:this.state.displayMobile&&"sidepanel"!==this.state.mobilePanel,state:this.state.sidePanelSelected,title:this.state.sidePanelTitle,avatar:this.state.sidePanelAvatar,login:this.state.login,myUserId:this.state.myUserId,loginDisabled:this.state.loginDisabled,errorText:this.state.errorText,errorLevel:this.state.errorLevel,errorAction:this.state.errorAction,errorActionText:this.state.errorActionText,topicSelected:this.state.topicSelected,chatList:this.state.chatList,credMethod:this.state.credMethod,credCode:this.state.credCode,transport:this.state.transport,messageSounds:this.state.messageSounds,desktopAlerts:this.state.desktopAlerts,desktopAlertsEnabled:this.state.desktopAlertsEnabled,serverAddress:this.state.serverAddress,onGlobalSettings:this.handleGlobalSettings,onSignUp:this.handleNewAccount,onSettings:this.handleSettings,onLoginRequest:this.handleLoginRequest,onCreateAccount:this.handleNewAccountRequest,onUpdateAccount:this.handleUpdateAccountRequest,onUpdateAccountTags:this.handleUpdateAccountTagsRequest,onTogglePushNotifications:this.togglePushToken,onToggleMessageSounds:this.handleToggleMessageSounds,onCredAdd:this.handleCredAdd,onCredDelete:this.handleCredDelete,onCredConfirm:this.handleCredConfirm,onTopicSelected:this.handleTopicSelected,onCreateTopic:this.handleNewTopicRequest,onNewTopic:this.handleNewTopic,onLogout:this.handleLogout,onCancel:this.handleSidepanelCancel,onError:this.handleError,onValidateCredentials:this.handleValidateCredentialsRequest,onPasswordResetRequest:this.handlePasswordResetRequest,onResetPassword:this.handleResetPassword,onShowArchive:this.handleShowArchive,onInitFind:this.tnInitFind,searchResults:this.state.searchResults,onSearchContacts:this.handleSearchContacts,showContextMenu:this.handleShowContextMenu}),E.a.createElement(Jr,{tinode:this.tinode,connected:this.state.connected,ready:this.state.ready,online:this.state.topicSelectedOnline,acs:this.state.topicSelectedAcs,displayMobile:this.state.displayMobile,viewportWidth:this.state.viewportWidth,viewportHeight:this.state.viewportHeight,hideSelf:this.state.displayMobile&&("topic-view"!==this.state.mobilePanel||this.state.showInfoPanel),topic:this.state.topicSelected,myUserId:this.state.myUserId,serverVersion:this.state.serverVersion,serverAddress:this.state.serverAddress,errorText:this.state.errorText,errorLevel:this.state.errorLevel,errorAction:this.state.errorAction,errorActionText:this.state.errorActionText,newTopicParams:this.state.newTopicParams,onHideMessagesView:this.handleHideMessagesView,onData:this.tnData,onError:this.handleError,onNewTopicCreated:this.handleNewTopicCreated,readTimerHandler:this.handleReadTimer,showContextMenu:this.handleShowContextMenu,onChangePermissions:this.handleChangePermissions,onNewChat:this.handleNewChatInvitation,sendMessage:this.handleSendMessage}),this.state.showInfoPanel?E.a.createElement(Ua,{tinode:this.tinode,connected:this.state.connected,displayMobile:this.state.displayMobile,topic:this.state.topicSelected,searchableContacts:this.state.searchableContacts,myUserId:this.state.myUserId,errorText:this.state.errorText,errorLevel:this.state.errorLevel,errorAction:this.state.errorAction,errorActionText:this.state.errorActionText,onTopicDescUpdate:this.handleTopicUpdateRequest,onCancel:this.handleHideInfoView,onChangePermissions:this.handleChangePermissions,onMemberUpdateRequest:this.handleMemberUpdateRequest,onLeaveTopic:this.handleLeaveUnsubRequest,onAddMember:this.handleManageGroupMembers,onTopicTagsUpdate:this.handleTagsUpdated,onInitFind:this.tnInitFind,onError:this.handleError,showContextMenu:this.handleShowContextMenu}):null)}}])&&uc(fc.prototype,mc),void(gc&&uc(fc,gc)),_c);function _c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_c),(t=function(e,t){return!t||"object"!==lc(t)&&"function"!=typeof t?pc(e):t}(this,dc(_c).call(this,e))).state=t.getBlankState(),t.handleResize=t.handleResize.bind(pc(t)),t.handleHashRoute=t.handleHashRoute.bind(pc(t)),t.handleOnline=t.handleOnline.bind(pc(t)),t.checkForAppUpdate=t.checkForAppUpdate.bind(pc(t)),t.handleAppVisibility=t.handleAppVisibility.bind(pc(t)),t.handleReadTimer=t.handleReadTimer.bind(pc(t)),t.handleVisibilityEvent=t.handleVisibilityEvent.bind(pc(t)),t.handleError=t.handleError.bind(pc(t)),t.handleLoginRequest=t.handleLoginRequest.bind(pc(t)),t.handleConnected=t.handleConnected.bind(pc(t)),t.handleAutoreconnectIteration=t.handleAutoreconnectIteration.bind(pc(t)),t.doLogin=t.doLogin.bind(pc(t)),t.handleCredentialsRequest=t.handleCredentialsRequest.bind(pc(t)),t.handleLoginSuccessful=t.handleLoginSuccessful.bind(pc(t)),t.handleDisconnect=t.handleDisconnect.bind(pc(t)),t.tnMeMetaDesc=t.tnMeMetaDesc.bind(pc(t)),t.tnMeContactUpdate=t.tnMeContactUpdate.bind(pc(t)),t.tnMeSubsUpdated=t.tnMeSubsUpdated.bind(pc(t)),t.resetContactList=t.resetContactList.bind(pc(t)),t.tnData=t.tnData.bind(pc(t)),t.tnInitFind=t.tnInitFind.bind(pc(t)),t.tnFndSubsUpdated=t.tnFndSubsUpdated.bind(pc(t)),t.handleSearchContacts=t.handleSearchContacts.bind(pc(t)),t.handleTopicSelected=t.handleTopicSelected.bind(pc(t)),t.handleHideMessagesView=t.handleHideMessagesView.bind(pc(t)),t.handleSendMessage=t.handleSendMessage.bind(pc(t)),t.handleNewChatInvitation=t.handleNewChatInvitation.bind(pc(t)),t.handleNewAccount=t.handleNewAccount.bind(pc(t)),t.handleNewAccountRequest=t.handleNewAccountRequest.bind(pc(t)),t.handleUpdateAccountRequest=t.handleUpdateAccountRequest.bind(pc(t)),t.handleUpdateAccountTagsRequest=t.handleUpdateAccountTagsRequest.bind(pc(t)),t.handleSettings=t.handleSettings.bind(pc(t)),t.handleGlobalSettings=t.handleGlobalSettings.bind(pc(t)),t.handleShowArchive=t.handleShowArchive.bind(pc(t)),t.handleToggleMessageSounds=t.handleToggleMessageSounds.bind(pc(t)),t.handleCredAdd=t.handleCredAdd.bind(pc(t)),t.handleCredDelete=t.handleCredDelete.bind(pc(t)),t.handleCredConfirm=t.handleCredConfirm.bind(pc(t)),t.initDesktopAlerts=t.initDesktopAlerts.bind(pc(t)),t.togglePushToken=t.togglePushToken.bind(pc(t)),t.requestPushToken=t.requestPushToken.bind(pc(t)),t.handleSidepanelCancel=t.handleSidepanelCancel.bind(pc(t)),t.handleNewTopic=t.handleNewTopic.bind(pc(t)),t.handleNewTopicRequest=t.handleNewTopicRequest.bind(pc(t)),t.handleNewTopicCreated=t.handleNewTopicCreated.bind(pc(t)),t.handleTopicUpdateRequest=t.handleTopicUpdateRequest.bind(pc(t)),t.handleChangePermissions=t.handleChangePermissions.bind(pc(t)),t.handleTagsUpdated=t.handleTagsUpdated.bind(pc(t)),t.handleLogout=t.handleLogout.bind(pc(t)),t.handleLeaveUnsubRequest=t.handleLeaveUnsubRequest.bind(pc(t)),t.handleDialogCancel=t.handleDialogCancel.bind(pc(t)),t.handleShowContextMenu=t.handleShowContextMenu.bind(pc(t)),t.defaultTopicContextMenu=t.defaultTopicContextMenu.bind(pc(t)),t.handleHideContextMenu=t.handleHideContextMenu.bind(pc(t)),t.handleShowInfoView=t.handleShowInfoView.bind(pc(t)),t.handleHideInfoView=t.handleHideInfoView.bind(pc(t)),t.handleMemberUpdateRequest=t.handleMemberUpdateRequest.bind(pc(t)),t.handleValidateCredentialsRequest=t.handleValidateCredentialsRequest.bind(pc(t)),t.handlePasswordResetRequest=t.handlePasswordResetRequest.bind(pc(t)),t.handleResetPassword=t.handleResetPassword.bind(pc(t)),t.handleContextMenuAction=t.handleContextMenuAction.bind(pc(t)),t}var wc=Object(S.injectIntl)(yc),Ec={zh:function(){return n.e(3).then(n.t.bind(null,9,7))},ru:function(){return n.e(2).then(n.t.bind(null,10,7))},en:function(){return n.e(1).then(n.t.bind(null,11,7))}},Sc=v.parseUrlHash(window.location.hash).params,Cc=Sc&&Sc.hl||navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage||"en";console.log("== Got language",Cc);var kc=Cc.toLowerCase().split(/[-_]/)[0];(Ec[Cc]||Ec[kc]||Ec.en)().then(function(e){Object(S.addLocaleData)(e)});var Mc=i[Cc]||i[kc]||i.en;r.a.render(E.a.createElement(S.IntlProvider,{locale:Cc,messages:Mc,textComponent:E.a.Fragment},E.a.createElement(wc,null)),document.getElementById("mountPoint"))}]);
//# sourceMappingURL=index.prod.js.map