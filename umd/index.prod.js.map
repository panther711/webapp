{"version":3,"file":"index.prod.js","mappings":"0BAAA,QAEQ,EAMgB,WAKpB,IAAIA,EAAW,CACX,UAAW,CAAEC,KAAM,OAAQC,KAAM,aACjC,IAAO,CAAED,KAAM,cAAeC,KAAM,QACpC,IAAO,CAAED,KAAM,kBAAmBC,KAAM,QACxC,IAAO,CAAED,KAAM,kBAAmBC,KAAM,QACxC,IAAO,CAAED,KAAM,oBAAqBC,KAAM,QAC1C,IAAO,CAAED,KAAM,UAAWC,KAAM,UAChC,IAAO,CAAED,KAAM,iBAAkBC,KAAM,QACvC,IAAO,CAAED,KAAM,qBAAsBC,KAAM,QAC3C,IAAM,CAAED,KAAM,OAAQC,KAAM,UAC5B,GAAM,CAAED,KAAM,SAAUC,KAAM,UAC9B,UAAW,CAAED,KAAM,gBAAiBC,KAAM,aAC1C,MAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,MAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,MAAQ,CAAED,KAAM,qBAAsBC,KAAM,UAC5C,MAAQ,CAAED,KAAM,YAAaC,KAAM,UACnC,MAAQ,CAAED,KAAM,oBAAqBC,KAAM,aAC3C,MAAQ,CAAED,KAAM,uBAAwBC,KAAM,aAC9C,KAAQ,CAAED,KAAM,gBAAiBC,KAAM,UACvC,UAAW,CAAED,KAAM,UAAWC,KAAM,aACpC,SAAW,CAAED,KAAM,WAAYC,KAAM,aACrC,KAAO,CAAED,KAAM,OAAQC,KAAM,aAC7B,KAAQ,CAAED,KAAM,SAAUC,KAAM,UAChC,KAAQ,CAAED,KAAM,eAAgBC,KAAM,QACtC,SAAW,CAAED,KAAM,OAAQC,KAAM,aACjC,MAAQ,CAAED,KAAM,aAAcC,KAAM,UACpC,MAAQ,CAAED,KAAM,kBAAmBC,KAAM,UACzC,QAAU,CAAED,KAAM,UAAWC,KAAM,UACnC,QAAU,CAAED,KAAM,eAAgBC,KAAM,UACxC,QAAU,CAAED,KAAM,UAAWC,KAAM,UACnC,QAAU,CAAED,KAAM,eAAgBC,KAAM,UACxC,KAAO,CAAED,KAAM,gBAAiBC,KAAM,UACtC,MAAQ,CAAED,KAAM,mBAAoBC,KAAM,aAC1C,MAAQ,CAAED,KAAM,6BAA8BC,KAAM,QACpD,MAAQ,CAAED,KAAM,wBAAyBC,KAAM,QAC/C,MAAQ,CAAED,KAAM,qBAAsBC,KAAM,UAC5C,OAAS,CAAED,KAAM,gBAAiBC,KAAM,QACxC,KAAO,CAAED,KAAM,WAAYC,KAAM,SACjC,KAAO,CAAED,KAAM,UAAWC,KAAM,QAChC,MAAQ,CAAED,KAAM,QAASC,KAAM,UAC/B,KAAO,CAAED,KAAM,YAAaC,KAAM,UAClC,KAAQ,CAAED,KAAM,aAAcC,KAAM,UAEpC,IAAM,CAAED,KAAM,WAAYC,KAAM,QAChC,KAAQ,CAAED,KAAM,eAAgBC,KAAM,aACtC,KAAQ,CAAED,KAAM,oBAAqBC,KAAM,QAC3C,GAAM,CAAED,KAAM,WAAYC,KAAM,QAChC,GAAM,CAAED,KAAM,WAAYC,KAAM,QAChC,GAAM,CAAED,KAAM,cAAeC,KAAM,UACnC,GAAM,CAAED,KAAM,aAAcC,KAAM,aAClC,GAAM,CAAED,KAAM,QAASC,KAAM,UAC7B,GAAM,CAAED,KAAM,eAAgBC,KAAM,UACpC,MAAQ,CAAED,KAAM,iBAAkBC,KAAM,aACxC,GAAM,CAAED,KAAM,YAAaC,KAAM,aACjC,IAAM,CAAED,KAAM,aAAcC,KAAM,QAClC,GAAM,CAAED,KAAM,kBAAmBC,KAAM,UACvC,GAAM,CAAED,KAAM,gBAAiBC,KAAM,QACrC,IAAM,CAAED,KAAM,oBAAqBC,KAAM,QACzC,IAAM,CAAED,KAAM,iBAAkBC,KAAM,OACtC,IAAM,CAAED,KAAM,mBAAoBC,KAAM,OACxC,GAAM,CAAED,KAAM,aAAcC,KAAM,UAClC,MAAQ,CAAED,KAAM,iBAAkBC,KAAM,OACxC,GAAK,CAAED,KAAM,SAAUC,KAAM,aAC7B,IAAM,CAAED,KAAM,YAAaC,KAAM,aACjC,GAAM,CAAED,KAAM,aAAcC,KAAM,QAClC,GAAM,CAAED,KAAM,cAAeC,KAAM,QACnC,GAAM,CAAED,KAAM,kBAAmBC,KAAM,QACvC,GAAM,CAAED,KAAM,QAASC,KAAM,QAC7B,GAAM,CAAED,KAAM,gBAAiBC,KAAM,QACrC,GAAM,CAAED,KAAM,iBAAkBC,KAAM,aACtC,GAAM,CAAED,KAAM,kBAAmBC,KAAM,QACvC,GAAM,CAAED,KAAM,oBAAqBC,KAAM,QACzC,GAAM,CAAED,KAAM,iBAAkBC,KAAM,UACtC,UAAW,CAAED,KAAM,SAAUC,KAAM,aACnC,GAAM,CAAED,KAAM,aAAcC,KAAM,aAClC,GAAM,CAAED,KAAM,cAAeC,KAAM,QACnC,MAAQ,CAAED,KAAM,WAAYC,KAAM,QAClC,EAAK,CAAED,KAAM,YAAaC,KAAM,QAChC,GAAM,CAAED,KAAM,cAAeC,KAAM,QACnC,EAAK,CAAED,KAAM,cAAeC,KAAM,QAClC,KAAQ,CAAED,KAAM,aAAcC,KAAM,QACpC,GAAM,CAAED,KAAM,aAAcC,KAAM,QAClC,MAAQ,CAAED,KAAM,WAAYC,KAAM,QAClC,MAAQ,CAAED,KAAM,WAAYC,KAAM,QAClC,OAAS,CAAED,KAAM,kBAAmBC,KAAM,QAC1C,OAAS,CAAED,KAAM,8BAA+BC,KAAM,QACtD,OAAS,CAAED,KAAM,qBAAsBC,KAAM,SAC7C,KAAQ,CAAED,KAAM,cAAeC,KAAM,OACrC,KAAQ,CAAED,KAAM,qBAAsBC,KAAM,QAC5C,KAAQ,CAAED,KAAM,OAAQC,KAAM,UAC9B,OAAS,CAAED,KAAM,WAAYC,KAAM,UACnC,EAAK,CAAED,KAAM,UAAWC,KAAM,UAC9B,KAAQ,CAAED,KAAM,eAAgBC,KAAM,UACtC,OAAS,CAAED,KAAM,YAAaC,KAAM,UACpC,MAAQ,CAAED,KAAM,iBAAkBC,KAAM,QACxC,QAAU,CAAED,KAAM,gBAAiBC,KAAM,UACzC,QAAU,CAAED,KAAM,eAAgBC,KAAM,UACxC,OAAS,CAAED,KAAM,mBAAoBC,KAAM,UAC3C,GAAM,CAAED,KAAM,iBAAkBC,KAAM,QACtC,MAAQ,CAAED,KAAM,eAAgBC,KAAM,QACtC,KAAQ,CAAED,KAAM,aAAcC,KAAM,QACpC,KAAQ,CAAED,KAAM,cAAeC,KAAM,QACrC,KAAQ,CAAED,KAAM,iBAAkBC,KAAM,aACxC,KAAQ,CAAED,KAAM,2BAA4BC,KAAM,QAClD,KAAQ,CAAED,KAAM,sBAAuBC,KAAM,QAC7C,KAAQ,CAAED,KAAM,wBAAyBC,KAAM,UAC/C,GAAM,CAAED,KAAM,QAASC,KAAM,aAC7B,GAAM,CAAED,KAAM,iBAAkBC,KAAM,QACtC,KAAQ,CAAED,KAAM,aAAcC,KAAM,QACpC,KAAQ,CAAED,KAAM,YAAaC,KAAM,QACnC,KAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,GAAM,CAAED,KAAM,aAAcC,KAAM,QAClC,GAAM,CAAED,KAAM,cAAeC,KAAM,QACnC,KAAQ,CAAED,KAAM,kBAAmBC,KAAM,QACzC,KAAQ,CAAED,KAAM,eAAgBC,KAAM,QACtC,KAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,KAAQ,CAAED,KAAM,iBAAkBC,KAAM,QACxC,KAAQ,CAAED,KAAM,eAAgBC,KAAM,QACtC,KAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,KAAQ,CAAED,KAAM,cAAeC,KAAM,QACrC,KAAQ,CAAED,KAAM,kBAAmBC,KAAM,QACzC,OAAS,CAAED,KAAM,cAAeC,KAAM,UACtC,QAAS,CAAED,KAAM,aAAcC,KAAM,SACrC,OAAS,CAAED,KAAM,YAAaC,KAAM,SACpC,GAAM,CAAED,KAAM,QAASC,KAAM,aAC7B,GAAM,CAAED,KAAM,oBAAqBC,KAAM,SACzC,MAAQ,CAAED,KAAM,0BAA2BC,KAAM,SACjD,GAAM,CAAED,KAAM,WAAYC,KAAM,QAChC,MAAQ,CAAED,KAAM,mBAAoBC,KAAM,UAC1C,KAAQ,CAAED,KAAM,WAAYC,KAAM,QAClC,GAAM,CAAED,KAAM,iBAAkBC,KAAM,aACtC,GAAM,CAAED,KAAM,qBAAsBC,KAAM,aAC1C,IAAM,CAAED,KAAM,aAAcC,KAAM,aAClC,IAAM,CAAED,KAAM,gBAAiBC,KAAM,QACrC,IAAM,CAAED,KAAM,iBAAkBC,KAAM,QACtC,IAAM,CAAED,KAAM,kBAAmBC,KAAM,aACvC,IAAM,CAAED,KAAM,eAAgBC,KAAM,QACpC,GAAM,CAAED,KAAM,gBAAiBC,KAAM,QACrC,GAAM,CAAED,KAAM,uBAAwBC,KAAM,UAC5C,GAAM,CAAED,KAAM,iBAAkBC,KAAM,QACtC,GAAM,CAAED,KAAM,sBAAuBC,KAAM,QAC3C,GAAM,CAAED,KAAM,6BAA8BC,KAAM,UAClD,MAAQ,CAAED,KAAM,mBAAoBC,KAAM,aAC1C,KAAQ,CAAED,KAAM,kBAAmBC,KAAM,aACzC,KAAQ,CAAED,KAAM,uBAAwBC,KAAM,QAC9C,KAAQ,CAAED,KAAM,uBAAwBC,KAAM,QAC9C,KAAQ,CAAED,KAAM,sBAAuBC,KAAM,QAC7C,KAAQ,CAAED,KAAM,qBAAsBC,KAAM,aAC5C,IAAO,CAAED,KAAM,kBAAmBC,KAAM,QACxC,IAAO,CAAED,KAAM,sBAAuBC,KAAM,UAC5C,KAAQ,CAAED,KAAM,oBAAqBC,KAAM,aAC3C,KAAO,CAAED,KAAM,iBAAkBC,KAAM,QACvC,KAAO,CAAED,KAAM,kBAAmBC,KAAM,UACxC,KAAO,CAAED,KAAM,mBAAoBC,KAAM,UACzC,KAAO,CAAED,KAAM,kBAAmBC,KAAM,UACxC,KAAO,CAAED,KAAM,iBAAkBC,KAAM,QACvC,KAAO,CAAED,KAAM,qBAAsBC,KAAM,QAC3C,UAAW,CAAED,KAAM,OAAQC,KAAM,aACjC,GAAM,CAAED,KAAM,WAAYC,KAAM,aAChC,GAAM,CAAED,KAAM,UAAWC,KAAM,QAC/B,GAAM,CAAED,KAAM,oBAAqBC,KAAM,aACzC,IAAM,CAAED,KAAM,WAAYC,KAAM,QAChC,IAAM,CAAED,KAAM,qBAAsBC,KAAM,QAC1C,IAAM,CAAED,KAAM,sBAAuBC,KAAM,QAC3C,GAAM,CAAED,KAAM,cAAeC,KAAM,QACnC,KAAQ,CAAED,KAAM,iBAAkBC,KAAM,QACxC,IAAM,CAAED,KAAM,gBAAiBC,KAAM,QACrC,GAAM,CAAED,KAAM,eAAgBC,KAAM,aACpC,GAAM,CAAED,KAAM,aAAcC,KAAM,QAClC,GAAM,CAAED,KAAM,gBAAiBC,KAAM,QACrC,KAAQ,CAAED,KAAM,eAAgBC,KAAM,QACtC,IAAM,CAAED,KAAM,mBAAoBC,KAAM,QACxC,UAAW,CAAED,KAAM,cAAeC,KAAM,aACxC,KAAQ,CAAED,KAAM,eAAgBC,KAAM,aACtC,KAAO,CAAED,KAAM,kBAAmBC,KAAM,UACxC,KAAO,CAAED,KAAM,WAAYC,KAAM,UACjC,KAAO,CAAED,KAAM,eAAgBC,KAAM,UACrC,KAAO,CAAED,KAAM,WAAYC,KAAM,UACjC,KAAO,CAAED,KAAM,UAAWC,KAAM,QAChC,KAAO,CAAED,KAAM,eAAgBC,KAAM,UACrC,KAAO,CAAED,KAAM,oBAAqBC,KAAM,QAC1C,KAAO,CAAED,KAAM,kBAAmBC,KAAM,QACxC,QAAU,CAAED,KAAM,WAAYC,KAAM,aACpC,KAAO,CAAED,KAAM,eAAgBC,KAAM,aACrC,KAAO,CAAED,KAAM,aAAcC,KAAM,QACnC,KAAO,CAAED,KAAM,oBAAqBC,KAAM,QAC1C,KAAO,CAAED,KAAM,qBAAsBC,KAAM,QAC3C,KAAO,CAAED,KAAM,qBAAsBC,KAAM,QAC3C,GAAM,CAAED,KAAM,cAAeC,KAAM,aACnC,MAAQ,CAAED,KAAM,aAAcC,KAAM,QACpC,KAAQ,CAAED,KAAM,mBAAoBC,KAAM,UAC1C,GAAM,CAAED,KAAM,mBAAoBC,KAAM,QACxC,GAAM,CAAED,KAAM,iBAAkBC,KAAM,QACtC,GAAM,CAAED,KAAM,oBAAqBC,KAAM,QACzC,KAAO,CAAED,KAAM,qBAAsBC,KAAM,QAC3C,MAAQ,CAAED,KAAM,oBAAqBC,KAAM,UAC3C,MAAQ,CAAED,KAAM,2BAA4BC,KAAM,QAClD,KAAQ,CAAED,KAAM,uBAAwBC,KAAM,QAC9C,GAAK,CAAED,KAAM,eAAgBC,KAAM,aACnC,EAAK,CAAED,KAAM,qBAAsBC,KAAM,QACzC,EAAK,CAAED,KAAM,iBAAkBC,KAAM,aACrC,EAAK,CAAED,KAAM,aAAcC,KAAM,UACjC,IAAO,CAAED,KAAM,eAAgBC,KAAM,UACrC,IAAO,CAAED,KAAM,cAAeC,KAAM,UACpC,MAAQ,CAAED,KAAM,cAAeC,KAAM,aACrC,MAAQ,CAAED,KAAM,qBAAsBC,KAAM,QAC5C,KAAO,CAAED,KAAM,qBAAsBC,KAAM,UAC3C,MAAQ,CAAED,KAAM,qBAAsBC,KAAM,aAC5C,MAAQ,CAAED,KAAM,kBAAmBC,KAAM,QACzC,MAAQ,CAAED,KAAM,kBAAmBC,KAAM,UACzC,SAAW,CAAED,KAAM,OAAQC,KAAM,aACjC,MAAQ,CAAED,KAAM,MAAOC,KAAM,aAC7B,KAAQ,CAAED,KAAM,UAAWC,KAAM,aACjC,MAAQ,CAAED,KAAM,kBAAmBC,KAAM,QACzC,KAAQ,CAAED,KAAM,aAAcC,KAAM,UACpC,KAAQ,CAAED,KAAM,cAAeC,KAAM,QACrC,KAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,KAAQ,CAAED,KAAM,gBAAiBC,KAAM,QACvC,KAAQ,CAAED,KAAM,mBAAoBC,KAAM,QAC1C,MAAQ,CAAED,KAAM,YAAaC,KAAM,aACnC,KAAO,CAAED,KAAM,UAAWC,KAAM,UAChC,KAAO,CAAED,KAAM,cAAeC,KAAM,UACpC,KAAO,CAAED,KAAM,aAAcC,KAAM,QACnC,KAAO,CAAED,KAAM,YAAaC,KAAM,UAClC,KAAO,CAAED,KAAM,YAAaC,KAAM,WAGtC,SAASC,EAAUC,EAAUC,GACzBD,EAASE,UAAYC,OAAOC,OAAOH,EAAUC,WAC7CF,EAASE,UAAUG,YAAcL,EAGrC,SAASM,EAAST,EAAMC,GACpBS,KAAKV,KAAOA,GAAQ,UACpBU,KAAKT,KAAOA,GAAQ,UAaxB,SAASU,EAASX,EAAMC,GACpBQ,EAASG,KAAKF,KAAMV,EAAMC,GAAQ,QAGtC,SAASY,EAAOC,GACZ,OAAOA,EAAIC,OAAS,GAAM,EAAI,IAAMD,EAAMA,EAyB9C,SAASE,EAAUhB,EAAMC,GACrBQ,EAASG,KAAKF,KAAMV,EAAMC,GAAQ,SAyBtC,SAASgB,EAAcjB,EAAMC,GACzBQ,EAASG,KAAKF,KAAMV,EAAMC,GAAQ,aA8FtC,SAASiB,EAASC,GACdF,EAAcL,KAAKF,KAAM,OAAQ,QACjCA,KAAKU,UAAUD,GA+DnB,SAASE,EAAgBC,EAAMC,EAAUC,EAAUC,GAO/C,GALwB,iBAAbD,IACPC,EAAUD,EACVA,OAAWE,IAGVF,EACD,OAAO,IAAIG,SAAQ,SAASC,GACxBP,EAAgBC,EAAMC,EAAUK,EAASH,MAIjD,IACI,IAAII,EAAS,IAAIC,WACjBD,EAAOE,UAAY,WACf,IACI,IAAIC,EAAO,IAAId,EAAS,IAAIe,WAAWJ,EAAOK,SAC1CF,EAAKG,YAAYZ,EAAUE,KAC3BH,EAAOU,EAAKI,OAAOd,EAAKrB,OAE9B,MAAOoC,IAGTb,EAASF,IAEbO,EAAOS,kBAAkBhB,GAC3B,MAAOe,GACLb,EAASF,IAOjB,OAtQAb,EAASJ,UAAUkC,eAAiB,aACpC9B,EAASJ,UAAUe,UAAY,SAASD,GACpCT,KAAKS,OAASA,EACdT,KAAK6B,kBAET9B,EAASJ,UAAUmC,aAAe,aAClC/B,EAASJ,UAAUoC,QAAU,SAASC,GAClChC,KAAKgC,KAAOA,EACZhC,KAAK8B,gBAMTtC,EAAUS,EAAUF,GAIpBE,EAASN,UAAUkC,eAAiB,WAEhC7B,KAAKgC,KAAO,GACZ,IAAK,IAAIC,EAAI,EAAGA,EAAIjC,KAAKS,OAAOJ,OAAQ4B,IAAK,CACzC,IAAI7B,EAAMJ,KAAKS,OAAOwB,GAAGC,SAAS,IAClClC,KAAKgC,MAAQ7B,EAAOC,KAG5BH,EAASN,UAAUmC,aAAe,WAC9B,IAAIzB,EAASL,KAAKgC,KAAK3B,OAAS,EAChCL,KAAKS,OAAS,IAAIc,WAAWlB,GAC7B,IAAK,IAAI4B,EAAI,EAAGA,EAAI5B,EAAQ4B,IAAK,CAC7B,IAAI7B,EAAMJ,KAAKgC,KAAKG,OAAW,EAAJF,EAAO,GAClCjC,KAAKS,OAAOwB,GAAKG,SAAShC,EAAK,MAGvCH,EAASN,UAAU0C,SAAW,WAC1B,OAAOD,SAASpC,KAAKgC,KAAM,KAE/B/B,EAASN,UAAU2C,SAAW,SAASC,GACnCvC,KAAK+B,QAAQ5B,EAAOoC,EAAML,SAAS,OAMvC1C,EAAUc,EAAWP,GACrBO,EAAUX,UAAU6C,kBAAoB,WACpC,OAAOxC,KAAKS,QAAiC,IAAvBT,KAAKS,OAAOJ,OAAeoC,aAAeC,cAEpEpC,EAAUX,UAAUkC,eAAiB,WACjC,IAAIc,EAAY3C,KAAKS,OAAOmC,UAExBC,EAAa,IADI7C,KAAKwC,oBACT,CAAmBG,EAAUG,QAC9C9C,KAAKgC,KAAOa,EAAW,IAE3BvC,EAAUX,UAAUmC,aAAe,WAC/B,IACIe,EAAa,IADI7C,KAAKwC,oBACT,CAAmB,CAAExC,KAAKgC,OACvCW,EAAY,IAAIpB,WAAWsB,EAAWC,QAC1C9C,KAAKS,OAASkC,EAAUC,WAE5BtC,EAAUX,UAAU0C,SAAW,WAC3B,OAAOrC,KAAKgC,MAEhB1B,EAAUX,UAAU2C,SAAW,SAASC,GACpCvC,KAAK+B,QAAQQ,IAMjB/C,EAAUe,EAAeR,GACzBQ,EAAcZ,UAAUoD,SAAW,WAC/B,OAAO/C,KAAKS,OAAOT,KAAKgD,WAE5BzC,EAAcZ,UAAUsD,SAAW,WAI/B,IAHA,IAAIC,EAAYlD,KAAK+C,WACjBI,EAAQ,EAAID,EAAUhB,SAAS,GAAG7B,OAClCkC,EAAQW,GAAa,GAAM,EAAIC,GAC1BlB,EAAI,EAAGA,EAAIkB,EAAOlB,IAEvBM,GAAS,IACTA,GAASvC,KAAK+C,WAElB,OAAOR,GAEXhC,EAAcZ,UAAUkC,eAAiB,WAErC,IADA7B,KAAKgC,KAAO,GACPhC,KAAKgD,OAAS,EAAGhD,KAAKgD,OAAShD,KAAKS,OAAOJ,OAAQL,KAAKgD,OAASI,EAAK,CACvE,IAAIC,EAAKrD,KAAKiD,WACVK,EAAMtD,KAAKiD,WACXG,EAAMG,KAAKC,IAAIxD,KAAKgD,OAASM,EAAKtD,KAAKS,OAAOJ,QAC9C2B,EAAOhC,KAAKS,OAAOgD,MAAMzD,KAAKgD,OAAQI,GAEtCM,EAAOrE,EAASgE,IAAO,CAAE/D,KAAM,UAAWC,KAAM,WAChDoE,EAAM5D,EACV,OAAQ2D,EAAKnE,MACT,IAAK,YACDoE,EAAMpD,EACN,MACJ,IAAK,OACDoD,EAAM1D,EACN,MACJ,IAAK,QACD0D,EAAMrD,EAGd,IAAIsD,EAAU,IAAID,EAAID,EAAKpE,KAAMoE,EAAKnE,MACtCqE,EAAQlD,UAAUsB,GAClBhC,KAAKgC,KAAK6B,KAAK,CACXR,GAAIA,EACJS,MAAOT,EAAGnB,SAAS,IACnBF,KAAM4B,MAIlBrD,EAAcZ,UAAUoE,UAAY,SAASC,EAAGC,GAC5C,IAAK,IAAId,EAAQ,EAAGe,EAAO,IAAMF,GAAKE,GAAQf,EAAQ,EAAGA,IAASe,GAAQ,KAE1E,IAAKD,EAED,IADA,IAAI1B,EAAQ2B,EAAOF,EACV/B,EAAIkB,EAAQ,EAAGlB,GAAK,EAAGA,IAAK,CAEjC,IAAIkC,EAAI5B,EAAQ,IAChBvC,KAAKS,OAAOT,KAAKgD,OAASf,GAAKkC,EAC/B5B,GAASA,EAAQ4B,GAAK,IAI9BnE,KAAKgD,QAAUG,GAEnB5C,EAAcZ,UAAUyE,cAAgB,SAASH,GAC7CjE,KAAKgD,OAAS,EACd,IAAK,IAAIf,EAAI,EAAGA,EAAIjC,KAAKgC,KAAK3B,OAAQ4B,IAAK,CACvC,IAAI2B,EAAU5D,KAAKgC,KAAKC,GACpBoC,EAAUT,EAAQ5B,KAAKvB,OACvB6D,EAAgBD,EAAQhE,OAC5BL,KAAK+D,UAAUH,EAAQP,GAAIY,GAC3BjE,KAAK+D,UAAUO,EAAeL,GACzBA,GACDjE,KAAKS,OAAO8D,IAAIF,EAASrE,KAAKgD,QAElChD,KAAKgD,QAAUsB,EAEnB,OAAOtE,KAAKgD,QAEhBzC,EAAcZ,UAAUmC,aAAe,WAEnC,IAAIzB,EAASL,KAAKoE,cAAc,SAChCpE,KAAKS,OAAS,IAAIc,WAAWlB,GAE7BL,KAAKoE,iBAET7D,EAAcZ,UAAU6E,eAAiB,SAASnB,GAC9C,IAAK,IAAIpB,EAAI,EAAGA,EAAIjC,KAAKgC,KAAK3B,OAAQ4B,IAAK,CACvC,IAAI2B,EAAU5D,KAAKgC,KAAKC,GACxB,GAAI2B,EAAQP,KAAOA,EACf,OAAOO,EAAQ5B,KAGvB,OAAO,MAOXxC,EAAUgB,EAAUD,GACpBC,EAASb,UAAU8B,YAAc,SAASZ,EAAUE,GAChD,IAAI0D,EAAS1D,GAAWA,EAAQ0D,YACjBzD,IAAXyD,EACAA,EAAS,SAASC,GACdC,QAAQC,IAAIF,IAERD,IACRA,EAAS,cAGb,IAAII,EAAiB7E,KAAKwE,eAAe,WACzC,IAAKK,EAED,OADAJ,EAAO,mDACA,EAGX,IAAIK,EAAcD,EAAeL,eAAe,UAChD,IAAKM,EAED,OADAL,EAAO,gDACA,EAGX,IAAIM,EAAmBD,EAAYN,eAAe,QAClD,IAAKO,EAED,OADAN,EAAO,yDACA,EAGX,IAAIO,EAAkBF,EAAYN,eAAe,MACjD,GAAIQ,EAAiB,CACjB,KAAIA,EAAgB3C,YAAc,GAK9B,OADAoC,EAAO,oDACA,EAJPA,EAAO,2EACPO,EAAgB1C,SAASzB,QAM7B4D,EAAO,oDAEPO,EAAkB,IAAI1E,EAAU,WAAY,UAC5BgC,SAASzB,GACzBiE,EAAY9C,KAAK6B,KAAK,CAClBR,GAAI,KACJrB,KAAMgD,IAUd,OALAD,EAAiBzC,SAAS,KAC1BwC,EAAYhD,eACZ+C,EAAe/C,eACf9B,KAAK8B,gBAEE,GAEXtB,EAASb,UAAU+B,OAAS,SAASuD,GACjC,OAAO,IAAIC,KAAK,CAAElF,KAAKS,OAAOqC,QAAU,CAAEvD,KAAM0F,GAAY,gBAoChEtE,EAAgBwE,QAAUxE,EAEnBA,QA7fc,gECDrByE,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBtE,IAAjBuE,EACH,OAAOA,EAAaC,QAGrB,IAAIC,EAASL,EAAyBE,GAAY,CAGjDE,QAAS,IAOV,OAHAE,EAAoBJ,GAAUG,EAAQA,EAAOD,QAASH,GAG/CI,EAAOD,QCpBfH,EAAoBM,EAAKF,IACxB,IAAIG,EAASH,GAAUA,EAAOI,WAC7B,IAAOJ,EAAiB,QACxB,IAAM,EAEP,OADAJ,EAAoBS,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRP,EAAoBS,EAAI,CAACN,EAASQ,KACjC,IAAI,IAAIC,KAAOD,EACXX,EAAoBa,EAAEF,EAAYC,KAASZ,EAAoBa,EAAEV,EAASS,IAC5ErG,OAAOuG,eAAeX,EAASS,EAAK,CAAEG,YAAY,EAAMC,IAAKL,EAAWC,MCJ3EZ,EAAoBiB,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAOvG,MAAQ,IAAIwG,SAAS,cAAb,GACd,MAAOC,GACR,GAAsB,iBAAXC,OAAqB,OAAOA,QALjB,GCAxBrB,EAAoBa,EAAI,CAACS,EAAKC,IAAUhH,OAAOD,UAAUkH,eAAe3G,KAAKyG,EAAKC,G,mBCAlF,MAAM,EAA+BE,M,aCArC,MAAM,EAA+BC,S,aCArC,MAAM,EAA+BC,U,uz0DCoF/BC,EAAsB,SAAUC,GAElC,MAAMC,EAAM,GACZ,IAAIC,EAAI,EACR,IAAK,IAAInF,EAAI,EAAGA,EAAIiF,EAAI7G,OAAQ4B,IAAK,CACjC,IAAIkC,EAAI+C,EAAIG,WAAWpF,GACnBkC,EAAI,IACJgD,EAAIC,KAAOjD,EAENA,EAAI,MACTgD,EAAIC,KAAQjD,GAAK,EAAK,IACtBgD,EAAIC,KAAY,GAAJjD,EAAU,KAEA,QAAZ,MAAJA,IACNlC,EAAI,EAAIiF,EAAI7G,QACyB,QAAZ,MAAxB6G,EAAIG,WAAWpF,EAAI,KAEpBkC,EAAI,QAAgB,KAAJA,IAAe,KAA6B,KAAtB+C,EAAIG,aAAapF,IACvDkF,EAAIC,KAAQjD,GAAK,GAAM,IACvBgD,EAAIC,KAASjD,GAAK,GAAM,GAAM,IAC9BgD,EAAIC,KAASjD,GAAK,EAAK,GAAM,IAC7BgD,EAAIC,KAAY,GAAJjD,EAAU,MAGtBgD,EAAIC,KAAQjD,GAAK,GAAM,IACvBgD,EAAIC,KAASjD,GAAK,EAAK,GAAM,IAC7BgD,EAAIC,KAAY,GAAJjD,EAAU,KAG9B,OAAOgD,GA0CLG,EAAS,CAIXC,eAAgB,KAIhBC,eAAgB,KAKhBC,sBAAuB,KAKvBC,sBAAuB,KAKvBC,kBAAmB,iEAIfC,mBACA,OAAO5H,KAAK2H,kBAAoB,OAKhCE,2BACA,OAAO7H,KAAK2H,kBAAoB,OASpCG,mBAAoC,mBAATC,KAU3BC,gBAAgBC,EAAOC,GACnB,IAAKC,MAAMC,QAAQH,GACf,MAAMI,MAAM,iDAEhBrI,KAAKsI,QACL,MAAMC,EAAgBL,EAChBlI,KAAKyH,sBACLzH,KAAKuH,eACLiB,EAAS,GACf,IAAK,IAAIvG,EAAI,EAAGA,EAAIgG,EAAM5H,OAAQ4B,GAAK,EAAG,CACtC,MAAMwG,EAAQR,EAAMhG,GACdyG,EAAYzG,EAAI,EAAIgG,EAAM5H,OAC1BsI,EAAQD,EAAYT,EAAMhG,EAAI,GAAK,EACnC2G,EAAY3G,EAAI,EAAIgG,EAAM5H,OAC1BwI,EAAQD,EAAYX,EAAMhG,EAAI,GAAK,EACnC6G,EAAWL,GAAS,EACpBM,GAAqB,EAARN,IAAiB,EAAME,GAAS,EACnD,IAAIK,GAAqB,GAARL,IAAiB,EAAME,GAAS,EAC7CI,EAAmB,GAARJ,EACVD,IACDK,EAAW,GACNP,IACDM,EAAW,KAGnBR,EAAO3E,KAAK0E,EAAcO,GAAWP,EAAcQ,GAAWR,EAAcS,GAAWT,EAAcU,IAEzG,OAAOT,EAAOU,KAAK,KAUvBC,aAAalB,EAAOC,GAGhB,OAAIlI,KAAK8H,qBAAuBI,EACrBkB,KAAKnB,GAETjI,KAAKgI,gBAAgBf,EAAoBgB,GAAQC,IAU5DmB,aAAapB,EAAOC,GAGhB,OAAIlI,KAAK8H,qBAAuBI,EACrBH,KAAKE,GAhJE,SAAU9E,GAEhC,MAAMgE,EAAM,GACZ,IAAImC,EAAM,EAAGnF,EAAI,EACjB,KAAOmF,EAAMnG,EAAM9C,QAAQ,CACvB,MAAMkJ,EAAKpG,EAAMmG,KACjB,GAAIC,EAAK,IACLpC,EAAIhD,KAAOqF,OAAOC,aAAaF,QAE9B,GAAIA,EAAK,KAAOA,EAAK,IAAK,CAC3B,MAAMG,EAAKvG,EAAMmG,KACjBnC,EAAIhD,KAAOqF,OAAOC,cAAoB,GAALF,IAAY,EAAW,GAALG,QAElD,GAAIH,EAAK,KAAOA,EAAK,IAAK,CAE3B,MAGMI,IAAY,EAALJ,IAAW,IAAa,GAH1BpG,EAAMmG,OAG2B,IAAa,GAF9CnG,EAAMmG,OAE+C,EAAW,GADhEnG,EAAMmG,MAEb,MACJnC,EAAIhD,KAAOqF,OAAOC,aAAa,OAAUE,GAAK,KAC9CxC,EAAIhD,KAAOqF,OAAOC,aAAa,OAAc,KAAJE,QAExC,CACD,MAAMD,EAAKvG,EAAMmG,KACXM,EAAKzG,EAAMmG,KACjBnC,EAAIhD,KAAOqF,OAAOC,cAAoB,GAALF,IAAY,IAAa,GAALG,IAAY,EAAW,GAALE,IAG/E,OAAOzC,EAAI+B,KAAK,IAqHLW,CAAkB7J,KAAK8J,wBAAwB7B,EAAOC,KAiBjE4B,wBAAwB7B,EAAOC,GAC3BlI,KAAKsI,QACL,MAAMyB,EAAgB7B,EAChBlI,KAAK0H,sBACL1H,KAAKwH,eACLgB,EAAS,GACf,IAAK,IAAIvG,EAAI,EAAGA,EAAIgG,EAAM5H,QAAS,CAC/B,MAAMoI,EAAQsB,EAAc9B,EAAM+B,OAAO/H,MAEnC0G,EADY1G,EAAIgG,EAAM5H,OACF0J,EAAc9B,EAAM+B,OAAO/H,IAAM,IACzDA,EACF,MACM4G,EADY5G,EAAIgG,EAAM5H,OACF0J,EAAc9B,EAAM+B,OAAO/H,IAAM,KACzDA,EACF,MACMgI,EADYhI,EAAIgG,EAAM5H,OACF0J,EAAc9B,EAAM+B,OAAO/H,IAAM,GAE3D,KADEA,EACW,MAATwG,GAA0B,MAATE,GAA0B,MAATE,GAA0B,MAAToB,EACnD,MAAM5B,QAEV,MAAMS,EAAYL,GAAS,EAAME,GAAS,EAE1C,GADAH,EAAO3E,KAAKiF,GACE,KAAVD,EAAc,CACd,MAAME,EAAaJ,GAAS,EAAK,IAASE,GAAS,EAEnD,GADAL,EAAO3E,KAAKkF,GACE,KAAVkB,EAAc,CACd,MAAMjB,EAAaH,GAAS,EAAK,IAAQoB,EACzCzB,EAAO3E,KAAKmF,KAIxB,OAAOR,GAOXF,QACI,IAAKtI,KAAKuH,eAAgB,CACtBvH,KAAKuH,eAAiB,GACtBvH,KAAKwH,eAAiB,GACtBxH,KAAKyH,sBAAwB,GAC7BzH,KAAK0H,sBAAwB,GAE7B,IAAK,IAAIzF,EAAI,EAAGA,EAAIjC,KAAK4H,aAAavH,OAAQ4B,IAC1CjC,KAAKuH,eAAetF,GAAKjC,KAAK4H,aAAaoC,OAAO/H,GAClDjC,KAAKwH,eAAexH,KAAKuH,eAAetF,IAAMA,EAC9CjC,KAAKyH,sBAAsBxF,GAAKjC,KAAK6H,qBAAqBmC,OAAO/H,GACjEjC,KAAK0H,sBAAsB1H,KAAKyH,sBAAsBxF,IAAMA,EAExDA,GAAKjC,KAAK2H,kBAAkBtH,SAC5BL,KAAKwH,eAAexH,KAAK6H,qBAAqBmC,OAAO/H,IAAMA,EAC3DjC,KAAK0H,sBAAsB1H,KAAK4H,aAAaoC,OAAO/H,IAAMA,MAiBxEiI,EAAgC,SAAUhD,GAE5C,OAViB,SAAUA,GAC3B,MAAMiD,EAAYlD,EAAoBC,GACtC,OAAOI,EAAOU,gBAAgBmC,GAAW,GAQlCC,CAAalD,GAAKmD,QAAQ,MAAO,KA6G5C,MAAMC,EACFxK,cACIE,KAAKuK,OAAS,OACdvK,KAAKkB,QAAU,OACflB,KAAKwK,QAAU,IAAIvJ,SAAQ,CAACC,EAASqJ,KACjCvK,KAAKkB,QAAUA,EACflB,KAAKuK,OAASA,KAQtBE,aAAa3J,GACT,MAAO,CAAC4J,EAAOnI,KACPmI,EACA1K,KAAKuK,OAAOG,GAGZ1K,KAAKkB,QAAQqB,GAEO,mBAAbzB,IAGPd,KAAKwK,QAAQG,OAAM,SAGK,IAApB7J,EAAST,OACTS,EAAS4J,GAGT5J,EAAS4J,EAAOnI,MAmKpC,SAASqI,IACL,MAA4B,iBAAdC,UASlB,SAASC,IACL,OAAO,IAAI7J,SAAQ,CAACC,EAASqJ,KACzB,IACI,IAAIQ,GAAW,EACf,MAAMC,EAAgB,0DAChBC,EAAUC,KAAKL,UAAUM,KAAKH,GACpCC,EAAQG,UAAY,KAChBH,EAAQzJ,OAAO6J,QAEVN,GACDG,KAAKL,UAAUS,eAAeN,GAElC9J,GAAQ,IAEZ+J,EAAQM,gBAAkB,KACtBR,GAAW,GAEfE,EAAQO,QAAU,KACd,IAAIC,EACJlB,GAAiC,QAAxBkB,EAAKR,EAAQP,aAA0B,IAAPe,OAAgB,EAASA,EAAG/G,UAAY,KAGzF,MAAOgG,GACHH,EAAOG,OA2FnB,MAAMgB,UAAsBrD,MACxBvI,YAEA6L,EAAMjH,EAENkH,GACIC,MAAMnH,GACN1E,KAAK2L,KAAOA,EACZ3L,KAAK4L,WAAaA,EAElB5L,KAAKV,KAbM,gBAgBXM,OAAOkM,eAAe9L,KAAM0L,EAAc/L,WAGtC0I,MAAM0D,mBACN1D,MAAM0D,kBAAkB/L,KAAMgM,EAAarM,UAAUE,SAIjE,MAAMmM,EACFlM,YAAYmM,EAASC,EAAaC,GAC9BnM,KAAKiM,QAAUA,EACfjM,KAAKkM,YAAcA,EACnBlM,KAAKmM,OAASA,EAElBtM,OAAO8L,KAAS3J,GACZ,MAAM4J,EAAa5J,EAAK,IAAM,GACxBoK,EAAW,GAAGpM,KAAKiM,WAAWN,IAC9BU,EAAWrM,KAAKmM,OAAOR,GACvBjH,EAAU2H,EAOxB,SAAyBA,EAAUrK,GAC/B,OAAOqK,EAAShC,QAAQiC,GAAS,CAACC,EAAGtG,KACjC,MAAM1D,EAAQP,EAAKiE,GACnB,OAAgB,MAAT1D,EAAgBiH,OAAOjH,GAAS,IAAI0D,SAVhBuG,CAAgBH,EAAUT,GAAc,QAE7Da,EAAc,GAAGzM,KAAKkM,gBAAgBxH,MAAY0H,MAExD,OADc,IAAIV,EAAcU,EAAUK,EAAab,IAU/D,MAAMU,EAAU,gBAkMhB,SAASI,EAAU3G,EAAG4G,GAClB,GAAI5G,IAAM4G,EACN,OAAO,EAEX,MAAMC,EAAQhN,OAAOiN,KAAK9G,GACpB+G,EAAQlN,OAAOiN,KAAKF,GAC1B,IAAK,MAAMI,KAAKH,EAAO,CACnB,IAAKE,EAAME,SAASD,GAChB,OAAO,EAEX,MAAME,EAAQlH,EAAEgH,GACVG,EAAQP,EAAEI,GAChB,GAAII,EAASF,IAAUE,EAASD,IAC5B,IAAKR,EAAUO,EAAOC,GAClB,OAAO,OAGV,GAAID,IAAUC,EACf,OAAO,EAGf,IAAK,MAAMH,KAAKD,EACZ,IAAKF,EAAMI,SAASD,GAChB,OAAO,EAGf,OAAO,EAEX,SAASI,EAASC,GACd,OAAiB,OAAVA,GAAmC,iBAAVA,EAq0BpC,SAASC,EAAmBpB,GACxB,OAAIA,GAAWA,EAAQqB,UACZrB,EAAQqB,UAGRrB,EAuBf,SAASsB,EAAiBtC,EAASuC,GAC/B,OAAO,IAAIvM,SAAQ,CAACC,EAASqJ,KACzBU,EAAQG,UAAYqC,IAChBvM,EAAQuM,EAAMC,OAAOlM,SAEzByJ,EAAQO,QAAUiC,IACd,IAAIhC,EACJlB,EAAO,GAAGiD,MAA+C,QAA7B/B,EAAKgC,EAAMC,OAAOhD,aAA0B,IAAPe,OAAgB,EAASA,EAAG/G,eAOzG,MAAMiJ,EACF7N,YAAY8N,GACR5N,KAAK4N,IAAMA,EACX5N,KAAK6N,iBAAmB7N,KAAK4N,IAAIC,iBAErCC,YAAYC,EAAYC,EAAO,YAC3B,OAAO,IAAIC,EAAmBjO,KAAK4N,IAAIE,YAAY5N,KAAKF,KAAK4N,IAAKG,EAAYC,IAElFE,kBAAkBC,EAAWpN,GACzB,OAAO,IAAIqN,EAAmBpO,KAAK4N,IAAIM,kBAAkBC,EAAWpN,IAExEsK,QACIrL,KAAK4N,IAAIvC,SAMjB,MAAM4C,EACFnO,YAAYuO,GACRrO,KAAKqO,aAAeA,EACpBrO,KAAKsO,SAAW,IAAIrN,SAAQ,CAACC,EAASqJ,KAClCvK,KAAKqO,aAAaE,WAAa,WAC3BrN,KAEJlB,KAAKqO,aAAa7C,QAAU,KACxBjB,EAAOvK,KAAKqO,aAAa3D,QAE7B1K,KAAKqO,aAAaG,QAAU,KACxBjE,EAAOvK,KAAKqO,aAAa3D,WAIrC+D,YAAYN,GACR,OAAO,IAAIC,EAAmBpO,KAAKqO,aAAaI,YAAYN,KAMpE,MAAMC,EACFtO,YAAY4O,GACR1O,KAAK0O,OAASA,EAElBC,MAAMrP,GACF,OAAO,IAAIsP,EAAa5O,KAAK0O,OAAOC,MAAMrP,IAE9CuP,YAAYvP,EAAMwP,EAAS/N,GACvB,OAAO,IAAI6N,EAAa5O,KAAK0O,OAAOG,YAAYvP,EAAMwP,EAAS/N,IAEnEsF,IAAIJ,GAEA,OAAOsH,EADSvN,KAAK0O,OAAOrI,IAAIJ,GACC,gCAErC8I,IAAIxM,EAAO0D,GAEP,OAAOsH,EADSvN,KAAK0O,OAAOK,IAAIxM,EAAO0D,GACN,8BAErC+I,OAAO/I,GAEH,OAAOsH,EADSvN,KAAK0O,OAAOM,OAAO/I,GACF,iCAErCgJ,QAEI,OAAO1B,EADSvN,KAAK0O,OAAOO,QACK,0CAMzC,MAAML,EACF9O,YAAYoP,GACRlP,KAAKkP,OAASA,EAElB7I,IAAIJ,GAEA,OAAOsH,EADSvN,KAAKkP,OAAO7I,IAAIJ,GACC,iCAMzC,SAASkJ,EAAOC,EAAQC,EAAWC,GAC/B,OAAO,IAAIrO,SAAQ,CAACC,EAASqJ,KACzB,IACI,MAAMU,EAAUJ,UAAUM,KAAKiE,EAAQC,GACvCpE,EAAQG,UAAYqC,IAChBvM,EAAQ,IAAIyM,EAAUF,EAAMC,OAAOlM,UAEvCyJ,EAAQO,QAAUiC,IACd,IAAIhC,EACJlB,EAAO,4BAA0D,QAA7BkB,EAAKgC,EAAMC,OAAOhD,aAA0B,IAAPe,OAAgB,EAASA,EAAG/G,YAEzGuG,EAAQM,gBAAkBkC,IACtB6B,EAAgB,IAAI3B,EAAU1C,EAAQzJ,QAASiM,EAAM8B,WAAY9B,EAAM+B,WAAY,IAAIvB,EAAmBhD,EAAQ6C,eAG1H,MAAOrH,GACH8D,EAAO,4BAA4B9D,EAAE/B,eAOjD+K,eAAeC,EAASN,GACpB,OAAO,IAAInO,SAAQ,CAACC,EAASqJ,KACzB,IACI,MAAMU,EAAUJ,UAAUS,eAAe8D,GACzCnE,EAAQG,UAAY,KAChBlK,KAEJ+J,EAAQO,QAAUiC,IACd,IAAIhC,EACJlB,EAAO,sCAAsC6E,OAA0C,QAA7B3D,EAAKgC,EAAMC,OAAOhD,aAA0B,IAAPe,OAAgB,EAASA,EAAG/G,YAGnI,MAAO+B,GACH8D,EAAO,sCAAsC6E,OAAY3I,EAAE/B,eC3/DvE,MAAMiL,EAOF7P,YAAYR,EAAMsQ,EAAiBrQ,GAC/BS,KAAKV,KAAOA,EACZU,KAAK4P,gBAAkBA,EACvB5P,KAAKT,KAAOA,EACZS,KAAK6P,mBAAoB,EAIzB7P,KAAK8P,aAAe,GACpB9P,KAAK+P,kBAAoB,OACzB/P,KAAKgQ,kBAAoB,KAE7BC,qBAAqBjC,GAEjB,OADAhO,KAAK+P,kBAAoB/B,EAClBhO,KAEXkQ,qBAAqBL,GAEjB,OADA7P,KAAK6P,kBAAoBA,EAClB7P,KAEXmQ,gBAAgBC,GAEZ,OADApQ,KAAK8P,aAAeM,EACbpQ,KAEXqQ,2BAA2BvP,GAEvB,OADAd,KAAKgQ,kBAAoBlP,EAClBd,MAoBf,MAAMsQ,EAAqB,YAsB3B,MAAMC,EACFzQ,YAAYR,EAAMkR,GACdxQ,KAAKV,KAAOA,EACZU,KAAKwQ,UAAYA,EACjBxQ,KAAKyQ,UAAY,KACjBzQ,KAAK0Q,UAAY,IAAIC,IACrB3Q,KAAK4Q,kBAAoB,IAAID,IAC7B3Q,KAAK6Q,iBAAmB,IAAIF,IAC5B3Q,KAAK8Q,gBAAkB,IAAIH,IAM/BtK,IAAI0K,GAEA,MAAMC,EAAuBhR,KAAKiR,4BAA4BF,GAC9D,IAAK/Q,KAAK4Q,kBAAkBM,IAAIF,GAAuB,CACnD,MAAMG,EAAW,IAAI7G,EAErB,GADAtK,KAAK4Q,kBAAkBrM,IAAIyM,EAAsBG,GAC7CnR,KAAKoR,cAAcJ,IACnBhR,KAAKqR,uBAEL,IACI,MAAMC,EAAWtR,KAAKuR,uBAAuB,CACzCC,mBAAoBR,IAEpBM,GACAH,EAASjQ,QAAQoQ,GAGzB,MAAO7K,KAMf,OAAOzG,KAAK4Q,kBAAkBvK,IAAI2K,GAAsBxG,QAE5DiH,aAAa1Q,GACT,IAAI0K,EAEJ,MAAMuF,EAAuBhR,KAAKiR,4BAA4BlQ,MAAAA,OAAyC,EAASA,EAAQgQ,YAClHW,EAAyF,QAA7EjG,EAAK1K,MAAAA,OAAyC,EAASA,EAAQ2Q,gBAA6B,IAAPjG,GAAgBA,EACvH,IAAIzL,KAAKoR,cAAcJ,KACnBhR,KAAKqR,uBAeJ,CAED,GAAIK,EACA,OAAO,KAGP,MAAMrJ,MAAM,WAAWrI,KAAKV,yBApBhC,IACI,OAAOU,KAAKuR,uBAAuB,CAC/BC,mBAAoBR,IAG5B,MAAOvK,GACH,GAAIiL,EACA,OAAO,KAGP,MAAMjL,GActBkL,eACI,OAAO3R,KAAKyQ,UAEhBmB,aAAanB,GACT,GAAIA,EAAUnR,OAASU,KAAKV,KACxB,MAAM+I,MAAM,yBAAyBoI,EAAUnR,qBAAqBU,KAAKV,SAE7E,GAAIU,KAAKyQ,UACL,MAAMpI,MAAM,iBAAiBrI,KAAKV,kCAItC,GAFAU,KAAKyQ,UAAYA,EAEZzQ,KAAKqR,uBAAV,CAIA,GAwKR,SAA0BZ,GACtB,MAAuC,UAAhCA,EAAUV,kBAzKT8B,CAAiBpB,GACjB,IACIzQ,KAAKuR,uBAAuB,CAAEC,mBAAoBlB,IAEtD,MAAO7J,IAUX,IAAK,MAAO+K,EAAoBM,KAAqB9R,KAAK4Q,kBAAkBmB,UAAW,CACnF,MAAMf,EAAuBhR,KAAKiR,4BAA4BO,GAC9D,IAEI,MAAMF,EAAWtR,KAAKuR,uBAAuB,CACzCC,mBAAoBR,IAExBc,EAAiB5Q,QAAQoQ,GAE7B,MAAO7K,OAMfuL,cAAcjB,EAAaT,aACvBtQ,KAAK4Q,kBAAkB5B,OAAO+B,GAC9B/Q,KAAK6Q,iBAAiB7B,OAAO+B,GAC7B/Q,KAAK0Q,UAAU1B,OAAO+B,GAI1BtB,eACI,MAAMwC,EAAW9J,MAAM+J,KAAKlS,KAAK0Q,UAAUyB,gBACrClR,QAAQmR,IAAI,IACXH,EACEI,QAAOpG,GAAW,aAAcA,IAEhCqG,KAAIrG,GAAWA,EAAQsG,SAASvD,cAClCiD,EACEI,QAAOpG,GAAW,YAAaA,IAE/BqG,KAAIrG,GAAWA,EAAQuG,cAGpCC,iBACI,OAAyB,MAAlBzS,KAAKyQ,UAEhBW,cAAcL,EAAaT,aACvB,OAAOtQ,KAAK0Q,UAAUQ,IAAIH,GAE9B2B,WAAW3B,EAAaT,aACpB,OAAOtQ,KAAK6Q,iBAAiBxK,IAAI0K,IAAe,GAEpD4B,WAAWC,EAAO,IACd,MAAM,QAAE7R,EAAU,IAAO6R,EACnB5B,EAAuBhR,KAAKiR,4BAA4B2B,EAAKpB,oBACnE,GAAIxR,KAAKoR,cAAcJ,GACnB,MAAM3I,MAAM,GAAGrI,KAAKV,QAAQ0R,mCAEhC,IAAKhR,KAAKyS,iBACN,MAAMpK,MAAM,aAAarI,KAAKV,oCAElC,MAAMgS,EAAWtR,KAAKuR,uBAAuB,CACzCC,mBAAoBR,EACpBjQ,QAAAA,IAGJ,IAAK,MAAOyQ,EAAoBM,KAAqB9R,KAAK4Q,kBAAkBmB,UAAW,CAE/Ef,IADiChR,KAAKiR,4BAA4BO,IAElEM,EAAiB5Q,QAAQoQ,GAGjC,OAAOA,EAUXuB,OAAO/R,EAAUiQ,GACb,IAAItF,EACJ,MAAMuF,EAAuBhR,KAAKiR,4BAA4BF,GACxD+B,EAA8E,QAAzDrH,EAAKzL,KAAK8Q,gBAAgBzK,IAAI2K,UAA0C,IAAPvF,EAAgBA,EAAK,IAAIsH,IACrHD,EAAkBE,IAAIlS,GACtBd,KAAK8Q,gBAAgBvM,IAAIyM,EAAsB8B,GAC/C,MAAMG,EAAmBjT,KAAK0Q,UAAUrK,IAAI2K,GAI5C,OAHIiC,GACAnS,EAASmS,EAAkBjC,GAExB,KACH8B,EAAkB9D,OAAOlO,IAOjCoS,sBAAsB5B,EAAUP,GAC5B,MAAMoC,EAAYnT,KAAK8Q,gBAAgBzK,IAAI0K,GAC3C,GAAKoC,EAGL,IAAK,MAAMrS,KAAYqS,EACnB,IACIrS,EAASwQ,EAAUP,GAEvB,MAAOtF,KAKf8F,wBAAuB,mBAAEC,EAAkB,QAAEzQ,EAAU,KACnD,IAAIuQ,EAAWtR,KAAK0Q,UAAUrK,IAAImL,GAClC,IAAKF,GAAYtR,KAAKyQ,YAClBa,EAAWtR,KAAKyQ,UAAUb,gBAAgB5P,KAAKwQ,UAAW,CACtDgB,oBAyCuBT,EAzC2BS,EA0CvDT,IAAeT,OAAqBtP,EAAY+P,GAzC3ChQ,QAAAA,IAEJf,KAAK0Q,UAAUnM,IAAIiN,EAAoBF,GACvCtR,KAAK6Q,iBAAiBtM,IAAIiN,EAAoBzQ,GAM9Cf,KAAKkT,sBAAsB5B,EAAUE,GAMjCxR,KAAKyQ,UAAUT,mBACf,IACIhQ,KAAKyQ,UAAUT,kBAAkBhQ,KAAKwQ,UAAWgB,EAAoBF,GAEzE,MAAO7F,IAqBvB,IAAuCsF,EAhB/B,OAAOO,GAAY,KAEvBL,4BAA4BF,EAAaT,aACrC,OAAItQ,KAAKyQ,UACEzQ,KAAKyQ,UAAUZ,kBAAoBkB,EAAaT,EAGhDS,EAGfM,uBACI,QAAUrR,KAAKyQ,WAC0B,aAArCzQ,KAAKyQ,UAAUV,mBA8B3B,MAAMqD,EACFtT,YAAYR,GACRU,KAAKV,KAAOA,EACZU,KAAKqT,UAAY,IAAI1C,IAWzB2C,aAAa7C,GACT,MAAM8C,EAAWvT,KAAKwT,YAAY/C,EAAUnR,MAC5C,GAAIiU,EAASd,iBACT,MAAM,IAAIpK,MAAM,aAAaoI,EAAUnR,yCAAyCU,KAAKV,QAEzFiU,EAAS3B,aAAanB,GAE1BgD,wBAAwBhD,GACHzQ,KAAKwT,YAAY/C,EAAUnR,MAC/BmT,kBAETzS,KAAKqT,UAAUrE,OAAOyB,EAAUnR,MAEpCU,KAAKsT,aAAa7C,GAStB+C,YAAYlU,GACR,GAAIU,KAAKqT,UAAUnC,IAAI5R,GACnB,OAAOU,KAAKqT,UAAUhN,IAAI/G,GAG9B,MAAMiU,EAAW,IAAIhD,EAASjR,EAAMU,MAEpC,OADAA,KAAKqT,UAAU9O,IAAIjF,EAAMiU,GAClBA,EAEXG,eACI,OAAOvL,MAAM+J,KAAKlS,KAAKqT,UAAUlB,WChYzC,MAAMzB,EAAY,GAYlB,IAAIiD,GACJ,SAAWA,GACPA,EAASA,EAAgB,MAAI,GAAK,QAClCA,EAASA,EAAkB,QAAI,GAAK,UACpCA,EAASA,EAAe,KAAI,GAAK,OACjCA,EAASA,EAAe,KAAI,GAAK,OACjCA,EAASA,EAAgB,MAAI,GAAK,QAClCA,EAASA,EAAiB,OAAI,GAAK,SANvC,CAOGA,IAAaA,EAAW,KAC3B,MAAMC,EAAoB,CACtB,MAASD,EAASE,MAClB,QAAWF,EAASG,QACpB,KAAQH,EAASI,KACjB,KAAQJ,EAASK,KACjB,MAASL,EAASM,MAClB,OAAUN,EAASO,QAKjBC,EAAkBR,EAASI,KAO3BK,EAAgB,CAClB,CAACT,EAASE,OAAQ,MAClB,CAACF,EAASG,SAAU,MACpB,CAACH,EAASI,MAAO,OACjB,CAACJ,EAASK,MAAO,OACjB,CAACL,EAASM,OAAQ,SAOhBI,EAAoB,CAAC/C,EAAUgD,KAAYC,KAC7C,GAAID,EAAUhD,EAASkD,SACnB,OAEJ,MAAMC,GAAM,IAAIC,MAAOC,cACjBC,EAASR,EAAcE,GAC7B,IAAIM,EAIA,MAAM,IAAIvM,MAAM,8DAA8DiM,MAH9E3P,QAAQiQ,GAAQ,IAAIH,OAASnD,EAAShS,WAAYiV,ICxD1D,MAAMM,EACF/U,YAAY0Q,GACRxQ,KAAKwQ,UAAYA,EAIrBsE,wBAII,OAHkB9U,KAAKwQ,UAAUkD,eAI5BpB,KAAIiB,IACL,GAoBZ,SAAkCA,GAC9B,MAAM9C,EAAY8C,EAAS5B,eAC3B,MAAkF,aAA1ElB,MAAAA,OAA6C,EAASA,EAAUlR,MAtB5DwV,CAAyBxB,GAAW,CACpC,MAAMtH,EAAUsH,EAAS9B,eACzB,MAAO,GAAGxF,EAAQ+I,WAAW/I,EAAQgJ,UAGrC,OAAO,QAGV5C,QAAO6C,GAAaA,IACpBhM,KAAK,MAgBlB,MAAMiM,EAAS,gBACTC,EAAY,SAkBZ3Q,EAAS,IDMf,MAOI3E,YAAYR,GACRU,KAAKV,KAAOA,EAIZU,KAAKqV,UAAYlB,EAKjBnU,KAAKsV,YAAcjB,EAInBrU,KAAKuV,gBAAkB,KAIvB7E,EAAU7M,KAAK7D,MAEfwU,eACA,OAAOxU,KAAKqV,UAEZb,aAASgB,GACT,KAAMA,KAAO7B,GACT,MAAM,IAAI8B,UAAU,kBAAkBD,+BAE1CxV,KAAKqV,UAAYG,EAGrBE,YAAYF,GACRxV,KAAKqV,UAA2B,iBAARG,EAAmB5B,EAAkB4B,GAAOA,EAEpEG,iBACA,OAAO3V,KAAKsV,YAEZK,eAAWH,GACX,GAAmB,mBAARA,EACP,MAAM,IAAIC,UAAU,qDAExBzV,KAAKsV,YAAcE,EAEnBI,qBACA,OAAO5V,KAAKuV,gBAEZK,mBAAeJ,GACfxV,KAAKuV,gBAAkBC,EAK3BK,SAAStB,GACLvU,KAAKuV,iBAAmBvV,KAAKuV,gBAAgBvV,KAAM2T,EAASE,SAAUU,GACtEvU,KAAKsV,YAAYtV,KAAM2T,EAASE,SAAUU,GAE9C3P,OAAO2P,GACHvU,KAAKuV,iBACDvV,KAAKuV,gBAAgBvV,KAAM2T,EAASG,WAAYS,GACpDvU,KAAKsV,YAAYtV,KAAM2T,EAASG,WAAYS,GAEhD7Q,QAAQ6Q,GACJvU,KAAKuV,iBAAmBvV,KAAKuV,gBAAgBvV,KAAM2T,EAASI,QAASQ,GACrEvU,KAAKsV,YAAYtV,KAAM2T,EAASI,QAASQ,GAE7CuB,QAAQvB,GACJvU,KAAKuV,iBAAmBvV,KAAKuV,gBAAgBvV,KAAM2T,EAASK,QAASO,GACrEvU,KAAKsV,YAAYtV,KAAM2T,EAASK,QAASO,GAE7C7J,SAAS6J,GACLvU,KAAKuV,iBAAmBvV,KAAKuV,gBAAgBvV,KAAM2T,EAASM,SAAUM,GACtEvU,KAAKsV,YAAYtV,KAAM2T,EAASM,SAAUM,KCnFxB,iBAwEpB,EAAqB,YACrBwB,EAAsB,CACxB,CAACZ,GAAS,YACV,uBAAU,mBACV,sBAAU,iBACV,6BAAU,wBACV,sBAAU,iBACV,6BAAU,wBACV,iBAAU,YACV,wBAAU,mBACV,qBAAU,YACV,4BAAU,mBACV,sBAAU,UACV,6BAAU,iBACV,0BAAU,WACV,iCAAU,kBACV,sBAAU,WACV,6BAAU,kBACV,wBAAU,YACV,+BAAU,mBACV,0BAAU,UACV,iCAAU,iBACV,oBAAU,WACV,2BAAU,kBACV,sBAAU,WACV,6BAAU,kBACV,UAAW,UACX,SAAQ,eAsBNa,EAAQ,IAAIrF,IAOZsF,EAAc,IAAItF,IAMxB,SAASuF,EAAcC,EAAK1F,GACxB,IACI0F,EAAI3F,UAAU8C,aAAa7C,GAE/B,MAAOhK,GACHhC,EAAOoR,MAAM,aAAapF,EAAUnR,4CAA4C6W,EAAI7W,OAAQmH,IAiBpG,SAAS2P,EAAmB3F,GACxB,MAAM4F,EAAgB5F,EAAUnR,KAChC,GAAI2W,EAAY/E,IAAImF,GAEhB,OADA5R,EAAOoR,MAAM,sDAAsDQ,OAC5D,EAEXJ,EAAY1R,IAAI8R,EAAe5F,GAE/B,IAAK,MAAM0F,KAAOH,EAAM7D,SACpB+D,EAAcC,EAAK1F,GAEvB,OAAO,EAWX,SAAS,EAAa0F,EAAK7W,GACvB,MAAMgX,EAAsBH,EAAI3F,UAC3BgD,YAAY,aACZ/B,aAAa,CAAEC,UAAU,IAI9B,OAHI4E,GACKA,EAAoBC,mBAEtBJ,EAAI3F,UAAUgD,YAAYlU,GAsCrC,MAcMkX,EAAgB,IAAIxK,EAAa,MAAO,WAd/B,CACX,SAAyB,oFAEzB,eAAqC,gCACrC,gBAAuC,kFACvC,cAAmC,kDACnC,uBAAqD,6EAErD,uBAAqD,wDACrD,eAAqC,8EACrC,cAAmC,mFACnC,cAAqC,iFACrC,iBAAyC,sFAoB7C,MAAMyK,EACF3W,YAAYiB,EAAS2V,EAAQlG,GACzBxQ,KAAK2W,YAAa,EAClB3W,KAAK4W,SAAWhX,OAAOiX,OAAO,GAAI9V,GAClCf,KAAK8W,QAAUlX,OAAOiX,OAAO,GAAIH,GACjC1W,KAAK+W,MAAQL,EAAOpX,KACpBU,KAAKgX,gCACDN,EAAOO,+BACXjX,KAAKkX,WAAa1G,EAClBxQ,KAAKwQ,UAAU8C,aAAa,IAAI3D,EAAU,OAAO,IAAM3P,MAAM,WAE7DiX,qCAEA,OADAjX,KAAKmX,iBACEnX,KAAKgX,gCAEZC,mCAA+BzB,GAC/BxV,KAAKmX,iBACLnX,KAAKgX,gCAAkCxB,EAEvClW,WAEA,OADAU,KAAKmX,iBACEnX,KAAK+W,MAEZhW,cAEA,OADAf,KAAKmX,iBACEnX,KAAK4W,SAEZF,aAEA,OADA1W,KAAKmX,iBACEnX,KAAK8W,QAEZtG,gBACA,OAAOxQ,KAAKkX,WAEZE,gBACA,OAAOpX,KAAK2W,WAEZS,cAAU5B,GACVxV,KAAK2W,WAAanB,EAMtB2B,iBACI,GAAInX,KAAKoX,UACL,MAAMZ,EAAc3W,OAAO,cAAiC,CAAEwX,QAASrX,KAAK+W,SA2BxF,SAASO,EAAcvW,EAASwW,EAAY,IACxC,GAAyB,iBAAdA,EAAwB,CAE/BA,EAAY,CAAEjY,KADDiY,GAGjB,MAAMb,EAAS9W,OAAOiX,OAAO,CAAEvX,KAAM,EAAoB2X,gCAAgC,GAASM,GAC5FjY,EAAOoX,EAAOpX,KACpB,GAAoB,iBAATA,IAAsBA,EAC7B,MAAMkX,EAAc3W,OAAO,eAAmC,CAC1DwX,QAAS7N,OAAOlK,KAGxB,MAAMkY,EAAcxB,EAAM3P,IAAI/G,GAC9B,GAAIkY,EAAa,CAEb,GAAI9K,EAAU3L,EAASyW,EAAYzW,UAC/B2L,EAAUgK,EAAQc,EAAYd,QAC9B,OAAOc,EAGP,MAAMhB,EAAc3W,OAAO,gBAAqC,CAAEwX,QAAS/X,IAGnF,MAAMkR,EAAY,IAAI4C,EAAmB9T,GACzC,IAAK,MAAMmR,KAAawF,EAAY9D,SAChC3B,EAAU8C,aAAa7C,GAE3B,MAAMgH,EAAS,IAAIhB,EAAgB1V,EAAS2V,EAAQlG,GAEpD,OADAwF,EAAMzR,IAAIjF,EAAMmY,GACTA,EAgFX,SAASC,EAAgBC,EAAkB1C,EAAS2C,GAChD,IAAInM,EAGJ,IAAIuJ,EAA2D,QAAhDvJ,EAAKsK,EAAoB4B,UAAsC,IAAPlM,EAAgBA,EAAKkM,EACxFC,IACA5C,GAAW,IAAI4C,KAEnB,MAAMC,EAAkB7C,EAAQ8C,MAAM,SAChCC,EAAkB9C,EAAQ6C,MAAM,SACtC,GAAID,GAAmBE,EAAiB,CACpC,MAAMC,EAAU,CACZ,+BAA+BhD,oBAA0BC,OAY7D,OAVI4C,GACAG,EAAQnU,KAAK,iBAAiBmR,sDAE9B6C,GAAmBE,GACnBC,EAAQnU,KAAK,OAEbkU,GACAC,EAAQnU,KAAK,iBAAiBoR,2DAElCxQ,EAAOqR,KAAKkC,EAAQ9O,KAAK,MAG7BkN,EAAmB,IAAIzG,EAAU,GAAGqF,aAAmB,KAAM,CAAGA,QAAAA,EAASC,QAAAA,KAAY,YA4CzF,MAEMgD,EAAa,2BACnB,IAAIC,EAAY,KAChB,SAASC,IAkBL,OAjBKD,IACDA,EAAY/I,EANJ,8BACG,GAK6B,CAACiJ,EAAI7I,KAMzC,GACS,IADDA,EAEA6I,EAAGlK,kBAAkB+J,MAE9BtN,OAAMlE,IACL,MAAM+P,EAAc3W,OAAO,eAAmC,CAC1DwY,qBAAsB5R,EAAE/B,cAI7BwT,EAgBXzI,eAAe6I,GAA2BnC,EAAKoC,GAC3C,IACI,MACMC,SADWL,KACHrK,YAAYmK,EAAY,aAChCxJ,EAAc+J,EAAG/J,YAAYwJ,GAEnC,aADMxJ,EAAYM,IAAIwJ,EAAiBE,GAAWtC,IAC3CqC,EAAGlK,SAEd,MAAO7H,GACH,MAAM+P,EAAc3W,OAAO,cAAmC,CAC1DwY,qBAAsB5R,EAAE/B,WAIpC,SAAS+T,GAAWtC,GAChB,MAAO,GAAGA,EAAI7W,QAAQ6W,EAAIpV,QAAQ2X,QAsBtC,MAAMC,GACF7Y,YAAY0Q,GACRxQ,KAAKwQ,UAAYA,EAUjBxQ,KAAK4Y,iBAAmB,KACxB,MAAMzC,EAAMnW,KAAKwQ,UAAUgD,YAAY,OAAO/B,eAC9CzR,KAAK6Y,SAAW,IAAIC,GAAqB3C,GACzCnW,KAAK+Y,wBAA0B/Y,KAAK6Y,SAASG,OAAOC,MAAKzX,IACrDxB,KAAK4Y,iBAAmBpX,EACjBA,KAUfiO,yBACI,MAKMyJ,EALiBlZ,KAAKwQ,UACvBgD,YAAY,mBACZ/B,eAGwBqD,wBACvBqE,EAAOC,KAMb,GAL8B,OAA1BpZ,KAAK4Y,mBACL5Y,KAAK4Y,uBAAyB5Y,KAAK+Y,yBAInC/Y,KAAK4Y,iBAAiBS,wBAA0BF,IAChDnZ,KAAK4Y,iBAAiBU,WAAWC,MAAKC,GAAuBA,EAAoBL,OAASA,IAa9F,OARInZ,KAAK4Y,iBAAiBU,WAAWzV,KAAK,CAAEsV,KAAAA,EAAMD,MAAAA,IAGlDlZ,KAAK4Y,iBAAiBU,WAAatZ,KAAK4Y,iBAAiBU,WAAWjH,QAAOmH,IACvE,MAAMC,EAAc,IAAI/E,KAAK8E,EAAoBL,MAAMO,UAEvD,OADYhF,KAAKD,MACJgF,GArDqB,UAuD/BzZ,KAAK6Y,SAASc,UAAU3Z,KAAK4Y,kBASxCnJ,4BAKI,GAJ8B,OAA1BzP,KAAK4Y,wBACC5Y,KAAK+Y,wBAGe,OAA1B/Y,KAAK4Y,kBACuC,IAA5C5Y,KAAK4Y,iBAAiBU,WAAWjZ,OACjC,MAAO,GAEX,MAAM8Y,EAAOC,MAEP,iBAAEQ,EAAgB,cAAEC,GAyBlC,SAAoCC,EAAiBC,EAtG5B,MAyGrB,MAAMH,EAAmB,GAEzB,IAAIC,EAAgBC,EAAgBrW,QACpC,IAAK,MAAM+V,KAAuBM,EAAiB,CAE/C,MAAME,EAAiBJ,EAAiBK,MAAKC,GAAMA,EAAGhB,QAAUM,EAAoBN,QACpF,GAAKc,GAiBD,GAHAA,EAAeG,MAAMtW,KAAK2V,EAAoBL,MAG1CiB,GAAWR,GAAoBG,EAAS,CACxCC,EAAeG,MAAME,MACrB,YAbJ,GAJAT,EAAiB/V,KAAK,CAClBqV,MAAOM,EAAoBN,MAC3BiB,MAAO,CAACX,EAAoBL,QAE5BiB,GAAWR,GAAoBG,EAAS,CAGxCH,EAAiBS,MACjB,MAcRR,EAAgBA,EAAcpW,MAAM,GAExC,MAAO,CACHmW,iBAAAA,EACAC,cAAAA,GA9D4CS,CAA2Bta,KAAK4Y,iBAAiBU,YACvFiB,EAAerQ,EAA8BsQ,KAAKC,UAAU,CAAExF,QAAS,EAAGqE,WAAYM,KAgB5F,OAdA5Z,KAAK4Y,iBAAiBS,sBAAwBF,EAC1CU,EAAcxZ,OAAS,GAEvBL,KAAK4Y,iBAAiBU,WAAaO,QAI7B7Z,KAAK6Y,SAASc,UAAU3Z,KAAK4Y,oBAGnC5Y,KAAK4Y,iBAAiBU,WAAa,GAE9BtZ,KAAK6Y,SAASc,UAAU3Z,KAAK4Y,mBAE/B2B,GAGf,SAASnB,KAGL,OAFc,IAAI1E,MAELC,cAAc+F,UAAU,EAAG,IA0C5C,MAAM5B,GACFhZ,YAAYqW,GACRnW,KAAKmW,IAAMA,EACXnW,KAAK2a,wBAA0B3a,KAAK4a,+BAExCnL,qCACI,QAAK7E,KAIME,IACFmO,MAAK,KAAM,IACXtO,OAAM,KAAM,IAMzB8E,aAEI,SAD8BzP,KAAK2a,wBAI9B,CAED,aAvNZlL,eAA2C0G,GACvC,IAEI,aADiBgC,KAEZrK,YAAYmK,GACZxJ,YAAYwJ,GACZ5R,IAAIoS,GAAWtC,IAExB,MAAO1P,GACH,MAAM+P,EAAc3W,OAAO,cAAiC,CACxDwY,qBAAsB5R,EAAE/B,WA4MSmW,CAA4B7a,KAAKmW,MACrC,CAAEmD,WAAY,IAJ3C,MAAO,CAAEA,WAAY,IAQ7B7J,gBAAgBqL,GACZ,IAAIrP,EAEJ,SAD8BzL,KAAK2a,wBAI9B,CACD,MAAMI,QAAiC/a,KAAKgZ,OAC5C,OAAOV,GAA2BtY,KAAKmW,IAAK,CACxCkD,sBAAyE,QAAjD5N,EAAKqP,EAAiBzB,6BAA0C,IAAP5N,EAAgBA,EAAKsP,EAAyB1B,sBAC/HC,WAAYwB,EAAiBxB,cAKzC7J,UAAUqL,GACN,IAAIrP,EAEJ,SAD8BzL,KAAK2a,wBAI9B,CACD,MAAMI,QAAiC/a,KAAKgZ,OAC5C,OAAOV,GAA2BtY,KAAKmW,IAAK,CACxCkD,sBAAyE,QAAjD5N,EAAKqP,EAAiBzB,6BAA0C,IAAP5N,EAAgBA,EAAKsP,EAAyB1B,sBAC/HC,WAAY,IACLyB,EAAyBzB,cACzBwB,EAAiBxB,gBAWxC,SAASc,GAAWN,GAEhB,OAAO5P,EAEPsQ,KAAKC,UAAU,CAAExF,QAAS,EAAGqE,WAAYQ,KAAoBzZ,OAmBjE,IAAgCuX,GAAAA,GAiBT,GAhBnBxB,EAAmB,IAAIzG,EAAU,mBAAmBa,GAAa,IAAIqE,EAA0BrE,IAAY,YAC3G4F,EAAmB,IAAIzG,EAAU,aAAaa,GAAa,IAAImI,GAAqBnI,IAAY,YAEhGkH,EAAgBvC,EAAQC,EAAWwC,IAEnCF,EAAgBvC,EAAQC,EAAW,WAEnCsC,EAAgB,UAAW,IC12B/BA,EAnBW,WACG,SAkBiB,OClB/B,MAAM,GAAO,0BACP,GAAU,QAkBVsD,GAAqB,IACrBC,GAAkB,UAClBC,GAAwB,SAExBC,GAA0B,KA4B1B,GAAgB,IAAInP,EA3BV,gBACK,gBAkBS,CAC1B,4BAA+D,kDAC/D,iBAAyC,2CACzC,yBAAyD,mCACzD,iBAAyC,6FACzC,cAAmC,kDACnC,8BAAmE,6EAIvE,SAASoP,GAAc1Q,GACnB,OAAQA,aAAiBgB,GACrBhB,EAAMiB,KAAKqB,SAAS,kBAmB5B,SAASqO,IAAyB,UAAEC,IAChC,MAAO,4DAAqCA,kBAEhD,SAASC,GAAiCC,GACtC,MAAO,CACHC,MAAOD,EAASC,MAChBC,cAAe,EACfC,WAuCmCC,EAvCUJ,EAASG,UAyCnDE,OAAOD,EAAkBvR,QAAQ,IAAK,SAxCzCyR,aAAcpH,KAAKD,OAsC3B,IAA2CmH,EAnC3CnM,eAAesM,GAAqBC,EAAaR,GAC7C,MACMS,SADqBT,EAASU,QACLxR,MAC/B,OAAO,GAAc7K,OAAO,iBAAuC,CAC/Dmc,YAAAA,EACAG,WAAYF,EAAUtQ,KACtByQ,cAAeH,EAAUvX,QACzB2X,aAAcJ,EAAUK,SAGhC,SAASC,IAAW,OAAEC,IAClB,OAAO,IAAIC,QAAQ,CACf,eAAgB,mBAChBC,OAAQ,mBACR,iBAAkBF,IAG1B,SAASG,GAAmBC,GAAW,aAAEC,IACrC,MAAMC,EAAUP,GAAWK,GAE3B,OADAE,EAAQC,OAAO,gBAoBnB,SAAgCF,GAC5B,MAAO,UAA4BA,IArBHG,CAAuBH,IAChDC,EAOXrN,eAAewN,GAAmBC,GAC9B,MAAM1b,QAAe0b,IACrB,OAAI1b,EAAO8a,QAAU,KAAO9a,EAAO8a,OAAS,IAEjCY,IAEJ1b,EAmFX,SAAS2b,GAAMC,GACX,OAAO,IAAInc,SAAQC,IACfmc,WAAWnc,EAASkc,MAyC5B,MAAME,GAAoB,oBAM1B,SAASC,KACL,IAGI,MAAMC,EAAe,IAAIjc,WAAW,KACrB2J,KAAKuS,QAAUvS,KAAKwS,UAC5BC,gBAAgBH,GAEvBA,EAAa,GAAK,IAAcA,EAAa,GAAK,GAClD,MAAMI,EASd,SAAgBJ,GAIZ,OAjD2BK,EA8CaL,EA7C5BpU,KAAKI,OAAOC,gBAAgBoU,IAC7BxT,QAAQ,MAAO,KAAKA,QAAQ,MAAO,MA+C7BlI,OAAO,EAAG,IAjD/B,IAA+B0b,EAoCXC,CAAON,GACnB,OAAOF,GAAkBS,KAAKH,GAAOA,EAfzB,GAiBhB,MAAOnS,GAEH,MAnBY,IA+CpB,SAASuS,GAAOpB,GACZ,MAAO,GAAGA,EAAUvF,WAAWuF,EAAUlE,QAmB7C,MAAMuF,GAAqB,IAAItN,IAK/B,SAASuN,GAAWtB,EAAWgB,GAC3B,MAAM3X,EAAM+X,GAAOpB,GACnBuB,GAAuBlY,EAAK2X,GAqChC,SAA4B3X,EAAK2X,GAC7B,MAAMQ,EAAUC,KACZD,GACAA,EAAQE,YAAY,CAAErY,IAAAA,EAAK2X,IAAAA,IAE/BW,KAzCAC,CAAmBvY,EAAK2X,GA2B5B,SAASO,GAAuBlY,EAAK2X,GACjC,MAAMzK,EAAY8K,GAAmB5X,IAAIJ,GACzC,GAAKkN,EAGL,IAAK,MAAMrS,KAAYqS,EACnBrS,EAAS8c,GAUjB,IAAIa,GAAmB,KAEvB,SAASJ,KAOL,OANKI,IAAoB,qBAAsBvT,OAC3CuT,GAAmB,IAAIC,iBAAiB,yBACxCD,GAAiBE,UAAYlY,IACzB0X,GAAuB1X,EAAEzE,KAAKiE,IAAKQ,EAAEzE,KAAK4b,OAG3Ca,GAEX,SAASF,KAC2B,IAA5BN,GAAmBW,MAAcH,KACjCA,GAAiBpT,QACjBoT,GAAmB,MAoB3B,MAEMI,GAAoB,+BAC1B,IAAI,GAAY,KAChB,SAAS,KAcL,OAbK,KACD,GAAY1P,EANE,kCACG,GAKmC,CAACiJ,EAAI7I,KAMrD,GACS,IADDA,EAEA6I,EAAGlK,kBAAkB2Q,QAI9B,GAGXpP,eAAelL,GAAIqY,EAAWra,GAC1B,MAAM0D,EAAM+X,GAAOpB,GAEbpE,SADW,MACH1K,YAAY+Q,GAAmB,aACvCpQ,EAAc+J,EAAG/J,YAAYoQ,IAC7BC,QAAkBrQ,EAAYpI,IAAIJ,GAMxC,aALMwI,EAAYM,IAAIxM,EAAO0D,SACvBuS,EAAGlK,SACJwQ,GAAYA,EAASlB,MAAQrb,EAAMqb,KACpCM,GAAWtB,EAAWra,EAAMqb,KAEzBrb,EAGXkN,eAAesP,GAAOnC,GAClB,MAAM3W,EAAM+X,GAAOpB,GAEbpE,SADW,MACH1K,YAAY+Q,GAAmB,mBACvCrG,EAAG/J,YAAYoQ,IAAmB7P,OAAO/I,SACzCuS,EAAGlK,SAQbmB,eAAeuP,GAAOpC,EAAWqC,GAC7B,MAAMhZ,EAAM+X,GAAOpB,GAEbpE,SADW,MACH1K,YAAY+Q,GAAmB,aACvCK,EAAQ1G,EAAG/J,YAAYoQ,IACvBC,QAAkBI,EAAM7Y,IAAIJ,GAC5BkZ,EAAWF,EAASH,GAW1B,YAViB9d,IAAbme,QACMD,EAAMlQ,OAAO/I,SAGbiZ,EAAMnQ,IAAIoQ,EAAUlZ,SAExBuS,EAAGlK,UACL6Q,GAAcL,GAAYA,EAASlB,MAAQuB,EAASvB,KACpDM,GAAWtB,EAAWuC,EAASvB,KAE5BuB,EAuBX1P,eAAe2P,GAAqBC,GAChC,IAAIC,EACJ,MAAMC,QAA0BP,GAAOK,EAAczC,WAAW4C,IAC5D,MAAMD,EAkBd,SAAyCC,GAKrC,OAAOC,GAJOD,GAAY,CACtB5B,IAAKL,KACLmC,mBAAoB,IArBMC,CAAgCH,GACpDI,EA+Bd,SAAwCP,EAAeE,GACnD,GAA6C,IAAzCA,EAAkBG,mBAA4C,CAC9D,IAAKG,UAAUC,OAAQ,CAGnB,MAAO,CACHP,kBAAAA,EACAD,oBAHiCre,QAAQsJ,OAAO,GAAc1K,OAAO,iBAO7E,MAAMkgB,EAAkB,CACpBnC,IAAK2B,EAAkB3B,IACvB8B,mBAAoB,EACpBM,iBAAkBtL,KAAKD,OAErB6K,EAcd7P,eAAoC4P,EAAeE,GAC/C,IACI,MAAMU,QAxZdxQ,gBAAyC,UAAEmN,EAAS,yBAAEsD,IAA4B,IAAEtC,IAChF,MAAMuC,EAAW9E,GAAyBuB,GACpCE,EAAUP,GAAWK,GAErBwD,EAAmBF,EAAyBzO,aAAa,CAC3DC,UAAU,IAEd,GAAI0O,EAAkB,CAClB,MAAMC,QAAyBD,EAAiBE,sBAC5CD,GACAvD,EAAQC,OAAO,oBAAqBsD,GAG5C,MAAME,EAAO,CACT3C,IAAAA,EACA4C,YAAatF,GACbxC,MAAOkE,EAAUlE,MACjB+H,WAAYxF,IAEVhQ,EAAU,CACZ2J,OAAQ,OACRkI,QAAAA,EACAyD,KAAM/F,KAAKC,UAAU8F,IAEnB/E,QAAiByB,IAAmB,IAAMyD,MAAMP,EAAUlV,KAChE,GAAIuQ,EAASmF,GAAI,CACb,MAAMC,QAAsBpF,EAASU,OAOrC,MANoC,CAChC0B,IAAKgD,EAAchD,KAAOA,EAC1B8B,mBAAoB,EACpB7C,aAAc+D,EAAc/D,aAC5BgE,UAAWtF,GAAiCqF,EAAcC,YAK9D,YAAY9E,GAAqB,sBAAuBP,GAoXdsF,CAA0BzB,EAAeE,GACnF,OAAOhb,GAAI8a,EAAczC,UAAWqD,GAExC,MAAOxZ,GAaH,MAZI2U,GAAc3U,IAAkC,MAA5BA,EAAEmF,WAAWuQ,iBAG3B4C,GAAOM,EAAczC,iBAIrBrY,GAAI8a,EAAczC,UAAW,CAC/BgB,IAAK2B,EAAkB3B,IACvB8B,mBAAoB,IAGtBjZ,GAhCsBsa,CAAqB1B,EAAeU,GAChE,MAAO,CAAER,kBAAmBQ,EAAiBT,oBAAAA,GAE5C,OAA6C,IAAzCC,EAAkBG,mBAChB,CACHH,kBAAAA,EACAD,oBAAqB0B,GAAyB3B,IAI3C,CAAEE,kBAAAA,GAzDgB0B,CAA+B5B,EAAeE,GAEvE,OADAD,EAAsBM,EAAiBN,oBAChCM,EAAiBL,qBAE5B,MAxPgB,KAwPZA,EAAkB3B,IAEX,CAAE2B,wBAAyBD,GAE/B,CACHC,kBAAAA,EACAD,oBAAAA,GAyER7P,eAAeuR,GAAyB3B,GAIpC,IAAI6B,QAAcC,GAA0B9B,EAAczC,WAC1D,KAAoC,IAA7BsE,EAAMxB,0BAEHvC,GAAM,KACZ+D,QAAcC,GAA0B9B,EAAczC,WAE1D,GAAiC,IAA7BsE,EAAMxB,mBAA4C,CAElD,MAAM,kBAAEH,EAAiB,oBAAED,SAA8BF,GAAqBC,GAC9E,OAAIC,GAKOC,EAGf,OAAO2B,EAUX,SAASC,GAA0BvE,GAC/B,OAAOoC,GAAOpC,GAAW4C,IACrB,IAAKA,EACD,MAAM,GAAc3f,OAAO,0BAE/B,OAAO4f,GAAqBD,MAGpC,SAASC,GAAqByB,GAC1B,OASiD,KADb3B,EARD2B,GASTxB,oBACtBH,EAAkBS,iBAAmBhF,GAAqBtG,KAAKD,MATxD,CACHmJ,IAAKsD,EAAMtD,IACX8B,mBAAoB,GAGrBwB,EAEX,IAAwC3B,EAqBxC9P,eAAe2R,IAAyB,UAAExE,EAAS,yBAAEsD,GAA4BX,GAC7E,MAAMY,EAiCV,SAAsCvD,GAAW,IAAEgB,IAC/C,MAAO,GAAGvC,GAAyBuB,MAAcgB,wBAlChCyD,CAA6BzE,EAAW2C,GACnDzC,EAAUH,GAAmBC,EAAW2C,GAExCa,EAAmBF,EAAyBzO,aAAa,CAC3DC,UAAU,IAEd,GAAI0O,EAAkB,CAClB,MAAMC,QAAyBD,EAAiBE,sBAC5CD,GACAvD,EAAQC,OAAO,oBAAqBsD,GAG5C,MAAME,EAAO,CACTe,aAAc,CACVb,WAAYxF,GACZvC,MAAOkE,EAAUlE,QAGnBzN,EAAU,CACZ2J,OAAQ,OACRkI,QAAAA,EACAyD,KAAM/F,KAAKC,UAAU8F,IAEnB/E,QAAiByB,IAAmB,IAAMyD,MAAMP,EAAUlV,KAChE,GAAIuQ,EAASmF,GAAI,CAGb,OAD2BpF,SADCC,EAASU,QAKrC,YAAYH,GAAqB,sBAAuBP,GA6BhE/L,eAAe8R,GAAiBlC,EAAemC,GAAe,GAC1D,IAAIC,EACJ,MAAMP,QAAclC,GAAOK,EAAczC,WAAW4C,IAChD,IAAKkC,GAAkBlC,GACnB,MAAM,GAAc3f,OAAO,kBAE/B,MAAM8hB,EAAenC,EAASqB,UAC9B,IAAKW,GA8Fb,SAA0BX,GACtB,OAAoC,IAA5BA,EAAUnF,gBAGtB,SAA4BmF,GACxB,MAAMpM,EAAMC,KAAKD,MACjB,OAAQA,EAAMoM,EAAU/E,cACpB+E,EAAU/E,aAAe+E,EAAUlF,UAAYlH,EAAM0G,GALpDyG,CAAmBf,GAhGCgB,CAAiBF,GAElC,OAAOnC,EAEN,GAAmC,IAA/BmC,EAAajG,cAGlB,OADA+F,EAwBZhS,eAAyC4P,EAAemC,GAIpD,IAAIN,QAAcY,GAAuBzC,EAAczC,WACvD,KAAyC,IAAlCsE,EAAML,UAAUnF,qBAEbyB,GAAM,KACZ+D,QAAcY,GAAuBzC,EAAczC,WAEvD,MAAMiE,EAAYK,EAAML,UACxB,OAAgC,IAA5BA,EAAUnF,cAEH6F,GAAiBlC,EAAemC,GAGhCX,EAxCYkB,CAA0B1C,EAAemC,GACjDhC,EAEN,CAED,IAAKK,UAAUC,OACX,MAAM,GAAcjgB,OAAO,eAE/B,MAAMkgB,EA0FlB,SAA6CP,GACzC,MAAMwC,EAAsB,CACxBtG,cAAe,EACfuG,YAAavN,KAAKD,OAEtB,OAAO7U,OAAOiX,OAAOjX,OAAOiX,OAAO,GAAI2I,GAAW,CAAEqB,UAAWmB,IA/F/BE,CAAoC1C,GAE5D,OADAiC,EAsDZhS,eAAwC4P,EAAeE,GACnD,IACI,MAAMsB,QAAkBO,GAAyB/B,EAAeE,GAC1D4C,EAA2BviB,OAAOiX,OAAOjX,OAAOiX,OAAO,GAAI0I,GAAoB,CAAEsB,UAAAA,IAEvF,aADMtc,GAAI8a,EAAczC,UAAWuF,GAC5BtB,EAEX,MAAOpa,GACH,IAAI2U,GAAc3U,IACe,MAA5BA,EAAEmF,WAAWuQ,YAAkD,MAA5B1V,EAAEmF,WAAWuQ,WAKhD,CACD,MAAMgG,EAA2BviB,OAAOiX,OAAOjX,OAAOiX,OAAO,GAAI0I,GAAoB,CAAEsB,UAAW,CAAEnF,cAAe,WAC7GnX,GAAI8a,EAAczC,UAAWuF,cAJ7BpD,GAAOM,EAAczC,WAM/B,MAAMnW,GAxEa2b,CAAyB/C,EAAeU,GAChDA,MAMf,OAHkB0B,QACNA,EACNP,EAAML,UAoChB,SAASiB,GAAuBlF,GAC5B,OAAOoC,GAAOpC,GAAW4C,IACrB,IAAKkC,GAAkBlC,GACnB,MAAM,GAAc3f,OAAO,kBAE/B,MAAM8hB,EAAenC,EAASqB,UAC9B,OAiDgC,KADHA,EAhDGc,GAiDlBjG,eACdmF,EAAUoB,YAAcjH,GAAqBtG,KAAKD,MAjDvC7U,OAAOiX,OAAOjX,OAAOiX,OAAO,GAAI2I,GAAW,CAAEqB,UAAW,CAAEnF,cAAe,KAE7E8D,EA6Cf,IAAqCqB,KArBrC,SAASa,GAAkBnC,GACvB,YAA8Bve,IAAtBue,GACqC,IAAzCA,EAAkBG,mBAqF1BjQ,eAAe4S,GAAShD,EAAemC,GAAe,GAClD,MAAMc,EAAoBjD,QAO9B5P,eAAgD4P,GAC5C,MAAM,oBAAEC,SAA8BF,GAAqBC,GACvDC,SAEMA,EAVJiD,CAAiCD,GAIvC,aADwBf,GAAiBe,EAAmBd,IAC3C/F,MAgMrB,SAAS+G,GAAqBC,GAC1B,OAAO,GAAc5iB,OAAO,4BAA6D,CACrF4iB,UAAAA,IAoBR,MAAMC,GAAqB,gBAerBC,GAAmBnS,IACrB,MAEM6O,EAAgB,EAFV7O,EAAUgD,YAAY,OAAO/B,eAEDiR,IAAoBjR,eAK5D,MAJ8B,CAC1BmR,MAAO,IAtRfnT,eAAqB4P,GACjB,MAAMiD,EAAoBjD,GACpB,kBAAEE,EAAiB,oBAAED,SAA8BF,GAAqBkD,GAS9E,OARIhD,EACAA,EAAoB3U,MAAMhG,QAAQ+F,OAKlC6W,GAAiBe,GAAmB3X,MAAMhG,QAAQ+F,OAE/C6U,EAAkB3B,IA2QRgF,CAAMvD,GACnBgD,SAAWb,GAAiBa,GAAShD,EAAemC,KAKxDpL,EAAmB,IAAIzG,EAAU+S,IAxBdlS,IACnB,MAAM2F,EAAM3F,EAAUgD,YAAY,OAAO/B,eAEnCmL,EApDV,SAA0BzG,GACtB,IAAKA,IAAQA,EAAIpV,QACb,MAAMyhB,GAAqB,qBAE/B,IAAKrM,EAAI7W,KACL,MAAMkjB,GAAqB,YAG/B,MAAMK,EAAa,CACf,YACA,SACA,SAEJ,IAAK,MAAMC,KAAWD,EAClB,IAAK1M,EAAIpV,QAAQ+hB,GACb,MAAMN,GAAqBM,GAGnC,MAAO,CACHzL,QAASlB,EAAI7W,KACbgc,UAAWnF,EAAIpV,QAAQua,UACvBkB,OAAQrG,EAAIpV,QAAQyb,OACpB9D,MAAOvC,EAAIpV,QAAQ2X,OA8BLqK,CAAiB5M,GAQnC,MAN0B,CACtBA,IAAAA,EACAyG,UAAAA,EACAsD,yBAJ6B,EAAa/J,EAAK,aAK/C3D,QAAS,IAAMvR,QAAQC,aAeyC,WACpEkV,EAAmB,IAAIzG,EA1BS,yBA0B8BgT,GAAiB,YASnFjL,EAAgB,GAAM,IAEtBA,EAAgB,GAAM,GAAS,WCtmC/B,MAEMsL,GAAoB,0FAEpBC,GAAsB,kBAK5B,IAAIC,GAoBAC,GAsBJ,SAASC,GAAcvF,GACnB,MAAMwF,EAAa,IAAI9hB,WAAWsc,GAElC,OADqBzU,KAAKI,OAAOC,gBAAgB4Z,IAC7BhZ,QAAQ,KAAM,IAAIA,QAAQ,MAAO,KAAKA,QAAQ,MAAO,KAE7E,SAASiZ,GAAcC,GACnB,MACMjc,GAAUic,EADA,IAAIC,QAAQ,EAAKD,EAAaljB,OAAS,GAAM,IAExDgK,QAAQ,MAAO,KACfA,QAAQ,KAAM,KACboZ,EAAU1b,KAAKT,GACfoc,EAAc,IAAIniB,WAAWkiB,EAAQpjB,QAC3C,IAAK,IAAI4B,EAAI,EAAGA,EAAIwhB,EAAQpjB,SAAU4B,EAClCyhB,EAAYzhB,GAAKwhB,EAAQpc,WAAWpF,GAExC,OAAOyhB,GAxDX,SAAWP,GACPA,EAAYA,EAA0B,aAAI,GAAK,eAC/CA,EAAYA,EAAkC,qBAAI,GAAK,uBAF3D,CAGGD,KAAkBA,GAAgB,KAiBrC,SAAWC,GACPA,EAA2B,cAAI,gBAC/BA,EAAkC,qBAAI,uBAF1C,CAGGA,KAAgBA,GAAc,KAoDjC,MAAMQ,GAAc,uBAMdC,GAAwB,yBA2H9B,MAEM,GAAoB,2BAC1B,IAAI,GAAY,KAChB,SAAS,KAaL,OAZK,KACD,GAAYzU,EANE,8BACG,GAKmC,CAAC0U,EAAWtU,KAK5D,GACS,IADDA,EAEAsU,EAAU3V,kBAAkB,QAIrC,GAGXuB,eAAeqU,GAAMC,GACjB,MAAM9d,EAAM,GAAO8d,GACb3L,QAAW,KACX4L,QAAsB5L,EACvBtK,YAAY,IACZW,YAAY,IACZpI,IAAIJ,GACT,GAAI+d,EACA,OAAOA,EAEN,CAED,MAAMC,QA1JdxU,eAAkCyU,GAC9B,GAAI,cAAerZ,UAAW,CAG1B,MACMsZ,SADkBtZ,UAAUuZ,aACR9R,KAAI8F,GAAMA,EAAG9Y,OACvC,IAAK6kB,EAAQnX,SAAS2W,IAElB,OAAO,KAGf,IAAIK,EAAe,KACnB,MAAM5L,QAAWjJ,EAAOwU,GAdL,GAckClU,MAAO2I,EAAI7I,EAAYC,EAAY6U,KACpF,IAAI5Y,EACJ,GAAI8D,EAAa,EAEb,OAEJ,IAAK6I,EAAGvK,iBAAiByW,SAASV,IAE9B,OAEJ,MAAMnV,EAAc4V,EAAmB5V,YAAYmV,IAC7CrhB,QAAckM,EAAYE,MAAM,eAAetI,IAAI6d,GAEzD,SADMzV,EAAYQ,QACb1M,EAIL,GAAmB,IAAfgN,EAAkB,CAClB,MAAMgV,EAAahiB,EACnB,IAAKgiB,EAAWC,OAASD,EAAWE,SAAWF,EAAWpE,SACtD,OAEJ6D,EAAe,CACXvI,MAAO8I,EAAWG,SAClBC,WAA6C,QAAhClZ,EAAK8Y,EAAWI,kBAA+B,IAAPlZ,EAAgBA,EAAKiJ,KAAKD,MAC/EmQ,oBAAqB,CACjBJ,KAAMD,EAAWC,KACjBC,OAAQF,EAAWE,OACnBtE,SAAUoE,EAAWpE,SACrB0E,QAASN,EAAWM,QACpBC,SAAyC,iBAAxBP,EAAWO,SACtBP,EAAWO,SACX1B,GAAcmB,EAAWO,iBAItC,GAAmB,IAAfvV,EAAkB,CACvB,MAAMgV,EAAahiB,EACnByhB,EAAe,CACXvI,MAAO8I,EAAWG,SAClBC,WAAYJ,EAAWI,WACvBC,oBAAqB,CACjBJ,KAAMpB,GAAcmB,EAAWC,MAC/BC,OAAQrB,GAAcmB,EAAWE,QACjCtE,SAAUoE,EAAWpE,SACrB0E,QAASN,EAAWM,QACpBC,SAAU1B,GAAcmB,EAAWO,iBAI1C,GAAmB,IAAfvV,EAAkB,CACvB,MAAMgV,EAAahiB,EACnByhB,EAAe,CACXvI,MAAO8I,EAAWG,SAClBC,WAAYJ,EAAWI,WACvBC,oBAAqB,CACjBJ,KAAMpB,GAAcmB,EAAWC,MAC/BC,OAAQrB,GAAcmB,EAAWE,QACjCtE,SAAUoE,EAAWpE,SACrB0E,QAASN,EAAWM,QACpBC,SAAU1B,GAAcmB,EAAWO,gBAUnD,OALA1M,EAAG/M,cAEGqE,EAASiU,UACTjU,EAAS,8BACTA,EAAS,aAGnB,SAA2BsU,GACvB,IAAKA,IAAiBA,EAAaY,oBAC/B,OAAO,EAEX,MAAM,oBAAEA,GAAwBZ,EAChC,MAA2C,iBAA5BA,EAAaW,YACxBX,EAAaW,WAAa,GACI,iBAAvBX,EAAavI,OACpBuI,EAAavI,MAAMpb,OAAS,GACQ,iBAA7BukB,EAAoBJ,MAC3BI,EAAoBJ,KAAKnkB,OAAS,GACI,iBAA/BukB,EAAoBH,QAC3BG,EAAoBH,OAAOpkB,OAAS,GACI,iBAAjCukB,EAAoBzE,UAC3ByE,EAAoBzE,SAAS9f,OAAS,GACC,iBAAhCukB,EAAoBC,SAC3BD,EAAoBC,QAAQxkB,OAAS,GACG,iBAAjCukB,EAAoBE,UAC3BF,EAAoBE,SAASzkB,OAAS,EApBnC0kB,CAAkBf,GAAgBA,EAAe,KAwEtBgB,CAAmBjB,EAAqBnH,UAAUsH,UAChF,GAAID,EAEA,aADMgB,GAAMlB,EAAsBE,GAC3BA,GAKnBxU,eAAewV,GAAMlB,EAAsBC,GACvC,MAAM/d,EAAM,GAAO8d,GAEbvL,SADW,MACH1K,YAAY,GAAmB,aAG7C,aAFM0K,EAAG/J,YAAY,IAAmBM,IAAIiV,EAAc/d,SACpDuS,EAAGlK,SACF0V,EAUX,SAAS,IAAO,UAAEpH,IACd,OAAOA,EAAUlE,MAmBrB,MAuBM,GAAgB,IAAI1M,EAAa,YAAa,YAvBlC,CACd,4BAA+D,kDAC/D,2BAAwD,gDACxD,uBAAgD,wDAChD,qBAAiD,qEACjD,qBAAiD,mEACjD,sBAAmD,2EACnD,yBAAyD,mGACzD,qCAA0E,+EAC1E,yBAAyD,qEACzD,2BAA6D,2DAC7D,2BAA6D,yEAE7D,sBAAmD,oEACnD,wBAAuD,wDACvD,yBAAyD,4IAEzD,0BAA2D,uEAC3D,qBAAiD,iEACjD,oBAA+C,yCAC/C,gCAAuE,0IA+E3EyD,eAAeyV,GAAmBnB,EAAsBtI,GACpD,MACM0J,EAAqB,CACvBvQ,OAAQ,SACRkI,cAHkB,GAAWiH,IAKjC,IACI,MAAMvI,QAAiBkF,MAAM,GAAG0E,GAAYrB,EAAqBnH,cAAcnB,IAAS0J,GAClFE,QAAqB7J,EAASU,OACpC,GAAImJ,EAAa3a,MAAO,CACpB,MAAMhG,EAAU2gB,EAAa3a,MAAMhG,QACnC,MAAM,GAAc7E,OAAO,2BAA2D,CAClFylB,UAAW5gB,KAIvB,MAAO6gB,GACH,MAAM,GAAc1lB,OAAO,2BAA2D,CAClFylB,UAAWC,KAIvB,SAASH,IAAY,UAAE9J,IACnB,MAAO,uDAAwBA,kBAEnC7L,eAAe,IAAW,UAAEmN,EAAS,cAAEyC,IACnC,MAAMwB,QAAkBxB,EAAcgD,WACtC,OAAO,IAAI5F,QAAQ,CACf,eAAgB,mBAChBC,OAAQ,mBACR,iBAAkBE,EAAUJ,OAC5B,qCAAsC,OAAOqE,MAGrD,SAAS2E,IAAQ,OAAEf,EAAM,KAAED,EAAI,SAAErE,EAAQ,SAAE2E,IACvC,MAAMvE,EAAO,CACTkF,IAAK,CACDtF,SAAAA,EACAqE,KAAAA,EACAC,OAAAA,IAMR,OAHIK,IAAa9B,KACbzC,EAAKkF,IAAIC,kBAAoBZ,GAE1BvE,EAqBX9Q,eAAekW,GAAiBC,GAC5B,MAAMC,QAgFVpW,eAAmCqW,EAAgBhB,GAC/C,MAAMiB,QAAqBD,EAAeE,YAAYC,kBACtD,GAAIF,EACA,OAAOA,EAEX,OAAOD,EAAeE,YAAYE,UAAU,CACxCC,iBAAiB,EAGjBC,qBAAsB9C,GAAcwB,KAzFTuB,CAAoBT,EAAUE,eAAgBF,EAAUd,UACjFF,EAAsB,CACxBE,SAAUc,EAAUd,SACpBD,QAASe,EAAUE,eAAeQ,MAClCnG,SAAU0F,EAAiB1F,SAC3BqE,KAAMpB,GAAcyC,EAAiB7H,OAAO,SAC5CyG,OAAQrB,GAAcyC,EAAiB7H,OAAO,YAE5CgG,QAAqBF,GAAM8B,EAAU7B,sBAC3C,GAAKC,EAIA,IAkFT,SAAsBuC,EAAWC,GAC7B,MAAMC,EAAkBD,EAAe1B,WAAayB,EAAUzB,SACxD4B,EAAkBF,EAAerG,WAAaoG,EAAUpG,SACxDwG,EAAcH,EAAehC,OAAS+B,EAAU/B,KAChDoC,EAAgBJ,EAAe/B,SAAW8B,EAAU9B,OAC1D,OAAOgC,GAAmBC,GAAmBC,GAAeC,EAvFlDC,CAAa7C,EAAaY,oBAAqBA,GAWpD,OAAIlQ,KAAKD,OAASuP,EAAaW,WA1BZ,OAyD5BlV,eAA2BmW,EAAW5B,GAClC,IACI,MAAM8C,QAzJdrX,eAAkCsU,EAAsBC,GACpD,MAAMlH,QAAgB,GAAWiH,GAC3BxD,EAAOiF,GAAQxB,EAAaY,qBAC5BmC,EAAgB,CAClBnS,OAAQ,QACRkI,QAAAA,EACAyD,KAAM/F,KAAKC,UAAU8F,IAEzB,IAAI8E,EACJ,IACI,MAAM7J,QAAiBkF,MAAM,GAAG0E,GAAYrB,EAAqBnH,cAAcoH,EAAavI,QAASsL,GACrG1B,QAAqB7J,EAASU,OAElC,MAAOqJ,GACH,MAAM,GAAc1lB,OAAO,sBAAiD,CACxEylB,UAAWC,IAGnB,GAAIF,EAAa3a,MAAO,CACpB,MAAMhG,EAAU2gB,EAAa3a,MAAMhG,QACnC,MAAM,GAAc7E,OAAO,sBAAiD,CACxEylB,UAAW5gB,IAGnB,IAAK2gB,EAAa5J,MACd,MAAM,GAAc5b,OAAO,yBAE/B,OAAOwlB,EAAa5J,MA8HWuL,CAAmBpB,EAAU7B,qBAAsBC,GACxEiD,EAAsBrnB,OAAOiX,OAAOjX,OAAOiX,OAAO,GAAImN,GAAe,CAAEvI,MAAOqL,EAAcnC,WAAYjQ,KAAKD,QAEnH,aADMwQ,GAAMW,EAAU7B,qBAAsBkD,GACrCH,EAEX,MAAOrgB,GAEH,YADMygB,GAAoBtB,GACpBnf,GAtCC0gB,CAAYvB,EAAW,CAC1BnK,MAAOuI,EAAavI,MACpBkJ,WAAYjQ,KAAKD,MACjBmQ,oBAAAA,IAKGZ,EAAavI,MAnBpB,UACUyJ,GAAmBU,EAAU7B,qBAAsBC,EAAavI,OAE1E,MAAOhV,GAEH9B,QAAQmR,KAAKrP,GAEjB,OAAO2gB,GAAYxB,EAAU7B,qBAAsBa,GAXnD,OAAOwC,GAAYxB,EAAU7B,qBAAsBa,GA8B3DnV,eAAeyX,GAAoBtB,GAC/B,MAAM5B,QAAqBF,GAAM8B,EAAU7B,sBACvCC,UACMkB,GAAmBU,EAAU7B,qBAAsBC,EAAavI,aA7O9EhM,eAAwBsU,GACpB,MAAM9d,EAAM,GAAO8d,GAEbvL,SADW,MACH1K,YAAY,GAAmB,mBACvC0K,EAAG/J,YAAY,IAAmBO,OAAO/I,SACzCuS,EAAGlK,SAyOC+Y,CAASzB,EAAU7B,uBAG7B,MAAM8B,QAAyBD,EAAUE,eAAeE,YAAYC,kBACpE,OAAIJ,GACOA,EAAiByB,cAiBhC7X,eAAe2X,GAAYrD,EAAsBa,GAC7C,MAAMnJ,QAjMVhM,eAA+BsU,EAAsBa,GACjD,MAAM9H,QAAgB,GAAWiH,GAC3BxD,EAAOiF,GAAQZ,GACf2C,EAAmB,CACrB3S,OAAQ,OACRkI,QAAAA,EACAyD,KAAM/F,KAAKC,UAAU8F,IAEzB,IAAI8E,EACJ,IACI,MAAM7J,QAAiBkF,MAAM0E,GAAYrB,EAAqBnH,WAAY2K,GAC1ElC,QAAqB7J,EAASU,OAElC,MAAOqJ,GACH,MAAM,GAAc1lB,OAAO,yBAAuD,CAC9EylB,UAAWC,IAGnB,GAAIF,EAAa3a,MAAO,CACpB,MAAMhG,EAAU2gB,EAAa3a,MAAMhG,QACnC,MAAM,GAAc7E,OAAO,yBAAuD,CAC9EylB,UAAW5gB,IAGnB,IAAK2gB,EAAa5J,MACd,MAAM,GAAc5b,OAAO,4BAE/B,OAAOwlB,EAAa5J,MAsKA+L,CAAgBzD,EAAsBa,GACpDZ,EAAe,CACjBvI,MAAAA,EACAkJ,WAAYjQ,KAAKD,MACjBmQ,oBAAAA,GAGJ,aADMK,GAAMlB,EAAsBC,GAC3BA,EAAavI,MA4CxB,SAASgM,GAAmBC,GACxB,MAAMC,EAAU,CACZzV,KAAMwV,EAAgBxV,KAEtB0V,YAAaF,EAAgBG,aAE7BC,UAAWJ,EAAgBK,cAK/B,OAEJ,SAAsCJ,EAASK,GAC3C,IAAKA,EAAuBC,aACxB,OAEJN,EAAQM,aAAe,GACvB,MAAMC,EAAQF,EAAuBC,aAAaC,MAC5CA,IACFP,EAAQM,aAAaC,MAAQA,GAEjC,MAAM3H,EAAOyH,EAAuBC,aAAa1H,KAC3CA,IACFoH,EAAQM,aAAa1H,KAAOA,GAEhC,MAAM4H,EAAQH,EAAuBC,aAAaE,MAC5CA,IACFR,EAAQM,aAAaE,MAAQA,GApBjCC,CAA6BT,EAASD,GAuB1C,SAA8BC,EAASK,GACnC,IAAKA,EAAuBhmB,KACxB,OAEJ2lB,EAAQ3lB,KAAOgmB,EAAuBhmB,KA1BtCqmB,CAAqBV,EAASD,GA4BlC,SAA6BC,EAASK,GAClC,IAAKA,EAAuBM,WACxB,OAEJX,EAAQW,WAAa,GACrB,MAAMC,EAAOP,EAAuBM,WAAWC,KACzCA,IACFZ,EAAQW,WAAWC,KAAOA,GAG9B,MAAMC,EAAiBR,EAAuBM,WAAWG,gBACnDD,IACFb,EAAQW,WAAWE,eAAiBA,GAvCxCE,CAAoBf,EAASD,GACtBC,EAiFX,SAASgB,GAAcC,EAAIC,GACvB,MAAMC,EAAc,GACpB,IAAK,IAAI7mB,EAAI,EAAGA,EAAI2mB,EAAGvoB,OAAQ4B,IAC3B6mB,EAAYjlB,KAAK+kB,EAAG5e,OAAO/H,IACvBA,EAAI4mB,EAAGxoB,QACPyoB,EAAYjlB,KAAKglB,EAAG7e,OAAO/H,IAGnC,OAAO6mB,EAAY5f,KAAK,IA+C5B,SAAS,GAAqBuZ,GAC1B,OAAO,GAAc5iB,OAAO,4BAA6D,CACrF4iB,UAAAA,IA3DRkG,GAAc,mCAAoC,mCAClDA,GAAc,uBAAwB,uBA8EtC,MAAMI,GACFjpB,YAAYqW,EAAKkJ,EAAe2J,GAE5BhpB,KAAKipB,0CAA2C,EAChDjpB,KAAKkpB,2BAA6B,KAClClpB,KAAKmpB,iBAAmB,KACxBnpB,KAAKopB,UAAY,GACjBppB,KAAKqpB,qBAAsB,EAC3B,MAAMzM,EA1Dd,SAA0BzG,GACtB,IAAKA,IAAQA,EAAIpV,QACb,MAAM,GAAqB,4BAE/B,IAAKoV,EAAI7W,KACL,MAAM,GAAqB,YAG/B,MAAMujB,EAAa,CACf,YACA,SACA,QACA,sBAEE,QAAE9hB,GAAYoV,EACpB,IAAK,MAAM2M,KAAWD,EAClB,IAAK9hB,EAAQ+hB,GACT,MAAM,GAAqBA,GAGnC,MAAO,CACHzL,QAASlB,EAAI7W,KACbgc,UAAWva,EAAQua,UACnBkB,OAAQzb,EAAQyb,OAChB9D,MAAO3X,EAAQ2X,MACfwL,SAAUnjB,EAAQuoB,mBAiCA,CAAiBnT,GACnCnW,KAAK+jB,qBAAuB,CACxB5N,IAAAA,EACAyG,UAAAA,EACAyC,cAAAA,EACA2J,kBAAAA,GAGRxW,UACI,OAAOvR,QAAQC,WAoBvBuO,eAAe8Z,GAAkB3D,GAC7B,IACIA,EAAUE,qBAAuBjG,UAAU2J,cAAcC,SA/wBzC,4BA+wBmE,CAC/EnD,MA/wBa,yCAsxBjBV,EAAUE,eAAe9G,SAASrU,OAAM,SAI5C,MAAOlE,GACH,MAAM,GAAc5G,OAAO,qCAAwE,CAC/F6pB,oBAAqBjjB,EAAE/B,WA2EnC+K,eAAeka,GAAW/D,EAAW7kB,GACjC,IAAK8e,UACD,MAAM,GAAchgB,OAAO,4BAK/B,GAHgC,YAA5B+pB,aAAaC,kBACPD,aAAaE,oBAES,YAA5BF,aAAaC,WACb,MAAM,GAAchqB,OAAO,sBAI/B,aArCJ4P,eAA8BmW,EAAWd,GAC/BA,EACFc,EAAUd,SAAWA,EAEfc,EAAUd,WAChBc,EAAUd,SAAW9B,IA8BnB+G,CAAenE,EAAW7kB,MAAAA,OAAyC,EAASA,EAAQ+jB,gBAhE9FrV,eAA2BmW,EAAWE,GAIlC,GAHKA,GAAmBF,EAAUE,sBACxByD,GAAkB3D,GAEvBE,IAAoBF,EAAUE,eAAnC,CAGA,KAAMA,aAA0BkE,2BAC5B,MAAM,GAAcnqB,OAAO,2BAE/B+lB,EAAUE,eAAiBA,GAuDrBmE,CAAYrE,EAAW7kB,MAAAA,OAAyC,EAASA,EAAQmpB,2BAChFvE,GAAiBC,GAmB5BnW,eAAe0a,GAAWvE,EAAWwE,EAAapoB,GAC9C,MAAMqoB,EAWV,SAAsBD,GAClB,OAAQA,GACJ,KAAKjH,GAAYmH,qBACb,MAAO,oBACX,KAAKnH,GAAYoH,cACb,MAAO,0BACX,QACI,MAAM,IAAIliB,OAlBAmiB,CAAaJ,UACPxE,EAAU7B,qBAAqBiF,kBAAkB3iB,OAC/DokB,SAASJ,EAAW,CAE1BK,WAAY1oB,EAAKihB,mBACjB0H,aAAc3oB,EAx4BQ,kBAy4BtB4oB,aAAc5oB,EAx4BQ,iBAy4BtB6oB,oBAAqBtnB,KAAKunB,MAAMpW,KAAKD,MAAQ,OA+BrDhF,eAAesb,GAAqBnF,EAAWnY,GAC3C,MAAMia,EAAkBja,EAAMzL,KAC9B,IAAK0lB,EAAgBsD,oBACjB,OAEApF,EAAUuD,kBACVzB,EAAgB0C,cAAgBjH,GAAYoH,gBACF,mBAA/B3E,EAAUuD,iBACjBvD,EAAUuD,iBAAiB1B,GAAmBC,IAG9C9B,EAAUuD,iBAAiB8B,KAAKxD,GAAmBC,KAI3D,MAAMwD,EAAcxD,EAAgB1lB,KAzTxC,IAA0BA,EAEC,iBAFDA,EA0TDkpB,IAxTgBlpB,GAAQihB,MAAuBjhB,GAyTZ,MAApDkpB,EAv7BmC,uBAw7B7Bf,GAAWvE,EAAW8B,EAAgB0C,YAAac,GAIjE,MAAM,GAAO,sBACP,GAAU,SAuBVC,GAAkC3a,IACpC,MAAMoV,EAAYpV,EACbgD,YAAY,aACZ/B,eAIL,MAH0B,CACtB4Q,SAAWthB,GAAY4oB,GAAW/D,EAAW7kB,KAkCrD0O,eAAe2b,KACX,UAGUtgB,IAEV,MAAOrE,GACH,OAAO,EAKX,MAA0B,oBAAXC,QACXkE,ONtWqB,oBAAdiV,YAA8BA,UAAUwL,gBMwW/C,kBAAmBxL,WACnB,gBAAiBnZ,QACjB,iBAAkBA,QAClB,UAAWA,QACXsjB,0BAA0BrqB,UAAUkH,eAAe,qBACnDykB,iBAAiB3rB,UAAUkH,eAAe,UA8ElD,SAAS0kB,GAAqBpV,EHzqB9B,SAAgB7W,EAAO,aACnB,MAAM6W,EAAMH,EAAM3P,IAAI/G,GACtB,IAAK6W,EACD,MAAMK,EAAc3W,OAAO,SAAuB,CAAEwX,QAAS/X,IAEjE,OAAO6W,EGoqByB,IAchC,OATAiV,KAAoBnS,MAAKuS,IAErB,IAAKA,EACD,MAAM,GAAc3rB,OAAO,0BAEhC0M,IAEC,MAAM,GAAc1M,OAAO,6BAExB,EAAawN,EAAmB8I,GAAM,aAAa1E,eAiB9DhC,eAAe,GAASmW,EAAW7kB,GAE/B,OAAO4oB,GADP/D,EAAYvY,EAAmBuY,GACF7kB,GAYjC,SAAS0qB,GAAY7F,GAEjB,OA1GJnW,eAA6BmW,GACzB,IAAK/F,UACD,MAAM,GAAchgB,OAAO,4BAK/B,OAHK+lB,EAAUE,sBACLyD,GAAkB3D,GAErBsB,GAAoBtB,GAmGpB8F,CADP9F,EAAYvY,EAAmBuY,IAgBnC,SAAS+F,GAAU/F,EAAWgG,GAE1B,OAjGJ,SAAqBhG,EAAWgG,GAC5B,IAAK/L,UACD,MAAM,GAAchgB,OAAO,4BAG/B,OADA+lB,EAAUuD,iBAAmByC,EACtB,KACHhG,EAAUuD,iBAAmB,MA2F1B0C,CADPjG,EAAYvY,EAAmBuY,GACDgG,GA/L9BxV,EAAmB,IAAIzG,EAAU,aAfLa,IAC5B,MAAMoV,EAAY,IAAImD,GAAiBvY,EAAUgD,YAAY,OAAO/B,eAAgBjB,EAAUgD,YAAY,0BAA0B/B,eAAgBjB,EAAUgD,YAAY,uBAE1K,OADAqM,UAAU2J,cAAcsC,iBAAiB,WAAWrlB,GAAKskB,GAAqBnF,EAAWnf,KAClFmf,IAY+D,WACtExP,EAAmB,IAAIzG,EAAU,qBAAsBwb,GAAgC,YACvFzT,EAAgB,GAAM,IAEtBA,EAAgB,GAAM,GAAS,WC//BnC,MAAM,GAA+BqU,OCGtB,MAAMC,WAAcllB,IAAAA,cACjCmlB,SACE,OAAOjsB,KAAKoQ,MAAM8b,QAChB,yBAAKC,UAAU,mBACb,yBAAKA,UAAU,SACb,yBAAKA,UAAU,SAASnsB,KAAKoQ,MAAM8X,OACnC,yBAAKiE,UAAU,WAAWnsB,KAAKoQ,MAAM/L,SACrC,yBAAK8nB,UAAU,kBACZnsB,KAAKoQ,MAAMgc,SACV,4BAAQD,UAAU,UAAUE,QAASrsB,KAAKoQ,MAAMgc,UAC7CpsB,KAAKoQ,MAAM7F,QAAU,kBAAC,EAAA+hB,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,6BAG3E,KAEF,4BAAQJ,UAAU,UAAUE,QAASrsB,KAAKoQ,MAAMoc,WAC7CxsB,KAAKoQ,MAAMqc,SAAW,kBAAC,EAAAH,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,4BAMhF,MCvBG,MAAMtR,GAAkB,gBCClByR,GAAW,0BAMXC,GAAc,CAACC,OAAQ,gBAAiBC,MAAO,kBAG/CC,GAAeH,GAAYC,OAM3BG,GAAiB,IAcjBC,GAA0B,QAa1BC,GAAW,GAIXC,GAAc,IAiBdC,GAA6B,OAI7BC,GAA6B,GAAK,GAWlCC,GAAsB,GAOtBC,GAAmB,GAEnBC,GAA+B,IAyB/BC,GAAqB,CAChCC,WAAY,CACV,CAAEC,KAAM,CAAE,6BACV,CACEC,SAAU,+FACVC,WAAY,uCACZF,KAAM,CACJ,4CACA,8CACA,4CACA,8CACA,8CACA,mDCzHFG,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BpqB,KAAM,CACJL,GAAI,iBACJkpB,eAAgB,CAAF,wBAGhBwB,eAAgB,CACd1qB,GAAI,2BACJkpB,eAAgB,CAAF,kCAGhByB,cAAe,CACb3qB,GAAI,mCACJkpB,eAAgB,CAAF,iCAGhBvd,OAAQ,CACN3L,GAAI,mBACJkpB,eAAgB,CAAF,0BAGhB0B,eAAgB,CACd5qB,GAAI,2BACJkpB,eAAgB,CAAF,kCAGhB2B,WAAY,CACV7qB,GAAI,uBACJkpB,eAAgB,CAAF,yBAGhB4B,KAAM,CACJ9qB,GAAI,iBACJkpB,eAAgB,CAAF,wBAGhB6B,OAAQ,CACN/qB,GAAI,mBACJkpB,eAAgB,CAAF,0BAGhB8B,MAAO,CACLhrB,GAAI,kBACJkpB,eAAgB,CAAF,yBAGhB+B,QAAS,CACPjrB,GAAI,oBACJkpB,eAAgB,CAAF,2BAGhBgC,aAAc,CACZlrB,GAAI,yBACJkpB,eAAgB,CAAF,0BAGhBiC,qBAAsB,CACpBnrB,GAAI,uBACJkpB,eAAgB,CAAF,2FAGhBkC,wBAAyB,CACvBprB,GAAI,0BACJkpB,eAAgB,CAAF,mGAGhBmC,QAAS,CACPrrB,GAAI,oBACJkpB,eAAgB,CAAF,2BAIhBoC,MAAO,CACLtrB,GAAI,kBACJkpB,eAAgB,CAAF,yBAGhBqC,oBAAqB,CACnBvrB,GAAI,sBACJkpB,eAAgB,CAAF,qEAGhBsC,cAAe,CACbxrB,GAAI,0BACJkpB,eAAgB,CAAF,0BAGhBuC,QAAS,CACPzrB,GAAI,0BACJkpB,eAAgB,CAAF,2BAGhBwC,UAAW,CACT1rB,GAAI,0BACJkpB,eAAgB,CAAF,2BAGhByC,iBAAkB,CAChB3rB,GAAI,6BACJkpB,eAAgB,CAAF,oCAGhB0C,uBAAwB,CACtB5rB,GAAI,yBACJkpB,eAAgB,CAAF,uFAKlB,MAAM2C,WAAoBpoB,IAAAA,UACxBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKmvB,QAAUroB,IAAAA,YAEf,MAAM,cAACsoB,GAAiBhf,EAAMif,KAE9BrvB,KAAKsvB,gBAAkBtvB,KAAKsvB,gBAAgBC,KAAKvvB,MACjDA,KAAKwvB,gBAAkBxvB,KAAKwvB,gBAAgBD,KAAKvvB,MACjDA,KAAKyvB,YAAczvB,KAAKyvB,YAAYF,KAAKvvB,MAGzCA,KAAK0vB,UAAY,CACf,WAAc,CACZrsB,GAAI,aACJ6kB,MAAOkH,EAAcvB,GAASnqB,MAC9BisB,QAAS,MAEX,eAAkB,CAChBtsB,GAAI,iBACJ6kB,MAAOkH,EAAcvB,GAASE,gBAC9B4B,QAAS,CAACC,EAAQC,IACTzf,EAAM0f,YACXV,EAAcvB,GAASE,gBACvBqB,EAAcvB,GAASoB,yBACtB,KAAQjvB,KAAK+vB,gBAAe,GAAM,EAAOH,EAAQC,KAClD,MACA,EACA,OAIN,oBAAuB,CACrBxsB,GAAI,sBACJ6kB,MAAOkH,EAAcvB,GAASG,eAC9B2B,QAAS,CAACC,EAAQC,IACTzf,EAAM0f,YACXV,EAAcvB,GAASG,eACvBoB,EAAc1qB,QAAQ+pB,0BACrB,IAAezuB,KAAK+vB,gBAAe,GAAM,EAAMH,EAAQC,IACxD,MACA,EACA,OAIN,eAAkB,CAChBxsB,GAAI,iBACJ6kB,MAAOkH,EAAcvB,GAAS7e,QAC9B2gB,QAAS,CAACC,EAAQC,IACT7vB,KAAK+vB,gBAAe,GAAO,EAAOH,EAAQC,IAGrD,oBAAuB,CACrBxsB,GAAI,sBACJ6kB,MAAOkH,EAAcvB,GAASI,gBAC9B0B,QAAS,CAACC,EAAQC,IACT7vB,KAAK+vB,gBAAe,GAAO,EAAMH,EAAQC,IAGpD,qBAAwB,CACtBxsB,GAAI,uBACJ6kB,MAAOkH,EAAcvB,GAASK,YAC9ByB,QAAS,CAACC,EAAQC,IACT7vB,KAAKgwB,aAAaJ,EAAQC,IAGrC,gBAAmB,CACjBxsB,GAAI,kBACJ6kB,MAAOkH,EAAcvB,GAASQ,OAC9BsB,QAAS,CAACC,EAAQC,IACT7vB,KAAKiwB,eAAeL,EAAQC,IAGvC,kBAAqB,CACnBxsB,GAAI,oBACJ6kB,MAAOkH,EAAcvB,GAASS,SAC9BqB,QAAS,QAEX,aAAgB,CACdtsB,GAAI,eACJ6kB,MAAOkH,EAAcvB,GAASO,QAC9BuB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,OAEjD,WAAc,CACZqD,GAAI,aACJ6kB,MAAOkH,EAAcvB,GAASM,MAC9BwB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,OAEjD,cAAiB,CACfqD,GAAI,gBACJ6kB,MAAOkH,EAAcvB,GAASa,SAC9BiB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,QAEjD,YAAe,CACbqD,GAAI,cACJ6kB,MAAOkH,EAAcvB,GAASc,OAC9BgB,QAAS,CAACC,EAAQC,IACTzf,EAAM0f,YACXV,EAAcvB,GAASc,OACvBS,EAAcvB,GAASe,sBACtB,IACQ5uB,KAAKkwB,sBAAsB,MAAON,EAAQC,GAAc5W,MAAMkX,IACnEnwB,KAAKoQ,MAAMggB,eAAeR,EAAOS,WAC1BF,MAGX,MACA,EACA,OAIN,aAAgB,CACd9sB,GAAI,eACJ6kB,MAAOkH,EAAcvB,GAASU,cAC9BoB,QAAS,CAACC,EAAQC,IACTzf,EAAM0f,YACXV,EAAcvB,GAASU,cACvBa,EAAcvB,GAASW,uBACtB,KACC,MAAM8B,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,GAAKC,EAIL,OAAOA,EAAMG,UAAS,GAAM9lB,OAAO4a,IAC7BsK,GACFA,EAAatK,EAAI7gB,QAAS,UAL5BC,QAAQmR,KAAK,oBAAqB8Z,EAAOS,aAS7C,MACA,EACA,OAIN,cAAiB,CACfhtB,GAAI,gBACJ6kB,MAAOkH,EAAcvB,GAASiB,SAC9Ba,QAAS,CAACC,EAAQC,KAChB,MAAMS,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,GAAKC,EAIL,OAAOA,EAAMxB,SAAQ,GAAMnkB,OAAO4a,IAC5BsK,GACFA,EAAatK,EAAI7gB,QAAS,UAL5BC,QAAQmR,KAAK,oBAAqB8Z,EAAOS,aAU/C,cAAiB,CACfhtB,GAAI,gBACJ6kB,MAAOkH,EAAcvB,GAASkB,WAC9BY,QAAS,CAACC,EAAQC,KAChB,MAAMS,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,GAAKC,EAIL,OAAOA,EAAMxB,SAAQ,GAAOnkB,OAAO4a,IAC7BsK,GACFA,EAAatK,EAAI7gB,QAAS,UAL5BC,QAAQmR,KAAK,oBAAqB8Z,EAAOS,aAW/C,YAAe,CACbhtB,GAAI,cACJ6kB,MAAOkH,EAAcvB,GAASmB,kBAC9BW,QAAS,MAEX,cAAiB,CACftsB,GAAI,gBACJ6kB,MAAOkH,EAAcvB,GAASgB,eAC9Bc,QAAS,CAACC,EAAQC,KAChB,MAAMS,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,GAAKC,GAAUV,EAAOc,KAItB,OAAOJ,EAAMK,gBAAgBf,EAAOc,MAAM/lB,OAAO4a,IAC3CsK,GACFA,EAAatK,EAAI7gB,QAAS,UAL5BC,QAAQmR,KAAK,6BAA+B8Z,EAAOS,UAAY,OAAST,EAAOc,KAAO,OAU5F,YAAe,CACbrtB,GAAI,cACJ6kB,MAAOkH,EAAcvB,GAASM,MAC9BwB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,OAEjD,cAAiB,CACfqD,GAAI,gBACJ6kB,MAAOkH,EAAcvB,GAASO,QAC9BuB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,OAEjD,aAAgB,CACdqD,GAAI,eACJ6kB,MAAOkH,EAAcvB,GAASc,OAC9BgB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,QAEjD,eAAkB,CAChBqD,GAAI,iBACJ6kB,MAAOkH,EAAcvB,GAASa,SAC9BiB,QAAS3vB,KAAKkwB,sBAAsBX,KAAKvvB,KAAM,SAKrD4wB,oBACEC,SAAS/E,iBAAiB,YAAa9rB,KAAKsvB,iBAAiB,GAC7DuB,SAAS/E,iBAAiB,QAAS9rB,KAAKwvB,iBAAiB,GAG3DsB,uBACED,SAASE,oBAAoB,YAAa/wB,KAAKsvB,iBAAiB,GAChEuB,SAASE,oBAAoB,QAAS/wB,KAAKwvB,iBAAiB,GAG9DF,gBAAgB7oB,GACVzG,KAAKmvB,QAAQ6B,QAAQ1M,SAAS7d,EAAEiH,UAGpCjH,EAAEwqB,iBACFxqB,EAAEyqB,kBACFlxB,KAAKoQ,MAAM+gB,QAGb3B,gBAAgB/oB,GACI,KAAdA,EAAE2qB,SACJpxB,KAAKoQ,MAAM+gB,OAIf1B,YAAYhpB,GACVA,EAAEwqB,iBACFxqB,EAAEyqB,kBACFlxB,KAAKoQ,MAAM+gB,OACX,IAAIE,EAAOrxB,KAAKoQ,MAAMkhB,MAAM7qB,EAAE8qB,cAAcC,QAAQnuB,IACjC,iBAARguB,IACTA,EAAOrxB,KAAK0vB,UAAU2B,IAGnBA,EAGHrxB,KAAKoQ,MAAMqhB,SACTJ,EAAKhuB,GACLguB,EAAK1B,QAAQ3vB,KAAKoQ,MAAMwf,OAAQ5vB,KAAKoQ,MAAMshB,SAC3C1xB,KAAKoQ,MAAMwf,QALbjrB,QAAQ+F,MAAM,uBAAwBjE,EAAE8qB,cAAcC,QAAQnuB,IAWlE0sB,eAAe3d,EAAKuf,EAAM/B,EAAQC,GAChC,MAAMS,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,IAAKC,EAEH,YADA3rB,QAAQmR,KAAK,oBAAqB8Z,EAAOS,WAQ3C,IAAKje,GAAOke,EAAMsB,WAAWhC,EAAOiC,KAClC,OAOF,OAJgBzf,EACdke,EAAMwB,eAAeH,GACrBrB,EAAMyB,gBAAgB,CAACnC,EAAOiC,KAAMF,IAEvBhnB,OAAO4a,IAChBsK,GACFA,EAAatK,EAAI7gB,QAAS,UAMhCsrB,aAAaJ,EAAQC,GACnB,MAAMS,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAEhD,IAAKC,IAAUA,EAAM0B,aAAapC,EAAOiC,KACvC,OAEF,MAAMI,EAAM3B,EAAM4B,cAActC,EAAOvrB,SAAS,GAChD,OAAOisB,EAAM6B,aAAaF,GAAKtnB,OAAO4a,IAChCsK,GACFA,EAAatK,EAAI7gB,QAAS,UAMhCwrB,sBAAsBliB,EAAM4hB,EAAQC,GAClC,MAAMS,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,IAAKC,EAEH,YADA3rB,QAAQmR,KAAK,kBAAmB8Z,EAAOS,WAIzC,IAAI7uB,EAAS8uB,EAAM8B,WAAWxC,EAAOc,KAAM1iB,GAM3C,OALI6hB,IACFruB,EAASA,EAAOmJ,OAAO4a,IACrBsK,EAAatK,EAAI7gB,QAAS,WAGvBlD,EAGTyuB,eAAeL,EAAQC,GACrBD,EAAOyC,UAAUzC,EAAOiC,IAAKjC,EAAOvrB,QAASurB,EAAO0C,SAAU1C,EAAO2C,SAAU1C,GAGjF5D,SACE,MAAMuG,EAAO,GACb,IAAIC,EAAQ,EACZzyB,KAAKoQ,MAAMkhB,MAAMhf,KAAK+e,IACD,iBAARA,IACTA,EAAOrxB,KAAK0vB,UAAU2B,IAEpBA,GAAQA,EAAKnJ,OACfsK,EAAK3uB,KACW,KAAdwtB,EAAKnJ,MACH,wBAAIiE,UAAU,YAAYlmB,IAAKwsB,IAE/B,wBAAIpG,QAASrsB,KAAKyvB,YAAa,UAASgD,EAAOxsB,IAAKwsB,GAAQpB,EAAKnJ,QAGvEuK,OAIF,MACMC,EAAQzF,IAAY,GAAoB,IAAduF,EAAKnyB,QAQ/BsyB,EAAW,CACfC,MARY5yB,KAAKoQ,MAAMyiB,OAAOC,MAAQ9yB,KAAKoQ,MAAM2iB,QAAQ/uB,EAF7C,IAGThE,KAAKoQ,MAAM2iB,QAAQ/uB,EAAIhE,KAAKoQ,MAAMyiB,OAAOD,KAHhC,IAIT5yB,KAAKoQ,MAAM2iB,QAAQ/uB,EAAIhE,KAAKoQ,MAAMyiB,OAAOD,MAM/B,KACbI,KANWhzB,KAAKoQ,MAAMyiB,OAAOI,OAASjzB,KAAKoQ,MAAM2iB,QAAQG,EAAIR,EAC1D1yB,KAAKoQ,MAAM2iB,QAAQG,EAAIlzB,KAAKoQ,MAAMyiB,OAAOG,IAAMN,EAC/C1yB,KAAKoQ,MAAM2iB,QAAQG,EAAIlzB,KAAKoQ,MAAMyiB,OAAOG,KAIjC,MAGb,OACE,wBAAI7G,UAAU,OAAOgH,MAAOR,EAAUS,IAAKpzB,KAAKmvB,SAC7CqD,IAMT,UAAea,EAAAA,EAAAA,YAAWnE,IC9dpBoE,GAAe,CAAC,MAAS,oBAAqB,OAAU,QAAS,MAAS,iBAGjE,MAAMC,WAAsBzsB,IAAAA,cACzCmlB,SACE,IAAIuH,EAAS,KACb,OAAIxzB,KAAKoQ,MAAMojB,QAAUxzB,KAAKoQ,MAAMojB,OAAOnzB,OAAS,GAClDmzB,EAAS,GACTxzB,KAAKoQ,MAAMojB,OAAOlhB,KAAK3F,IACrB,MAAM8mB,EAAS9mB,EAAE8mB,MAAQ,IAAM9mB,EAAE8mB,MAAQ,GACrC9mB,EAAE+mB,KACJF,EAAO3vB,KAAK,uBAAGsoB,UAAW,0BAA4BsH,EAAOxtB,IAAK0G,EAAE1G,KAAO0G,EAAE+mB,MAAOJ,GAAa3mB,EAAE+mB,OAAS/mB,EAAE+mB,OAE9GF,EAAO3vB,KAAK,0BAAMsoB,UAAW,QAAUsH,EAAOxtB,IAAK0G,EAAE1G,KAAO0G,EAAErN,MAAOqN,EAAErN,UAGpE,oCAAGk0B,IAEL,MCAJ,SAASG,GAAcC,EAASC,GACrC,IAAIrwB,EAAiC,EAA3BD,KAAKunB,MAAM8I,EAAU,IAC3BC,IACFrwB,EAAMA,EAAM,GAAN,WAAeA,GAAQA,GAE/B,IAAIswB,EAAOF,EAAU,GAAM,EAE3B,OADAE,EAAMA,EAAM,GAAN,WAAeA,GAAQA,EAC7B,UAAUtwB,EAAV,YAAiBswB,GAIZ,SAASC,GAAiB5wB,GAC/B,IAAKA,GAAkB,GAATA,EACZ,MAAO,UAGT,MAAM6wB,EAAQ,CAAC,QAAS,KAAM,KAAM,KAAM,KAAM,MAC1CC,EAAS1wB,KAAKC,IAAwC,EAApCD,KAAKunB,MAAMvnB,KAAK2wB,KAAK/wB,GAAS,IAAS6wB,EAAM3zB,OAAO,GACtEoyB,EAAQtvB,EAAQI,KAAK4wB,IAAI,KAAMF,GAC/BG,EAAQH,EAAS,EAAKxB,EAAQ,EAAI,EAAKA,EAAQ,GAAK,EAAI,EAAM,EACpE,OAAOA,EAAM4B,QAAQD,GAAS,IAAMJ,EAAMC,GAIrC,SAASK,GAAgBC,EAAUC,GACxC,MAAuB,iBAAZD,EACFA,EAEFA,EAASl0B,OAASm0B,EACvBD,EAAS9wB,MAAM,EAAG+wB,EAAU,EAAI,GAAK,IAAMD,EAAS9wB,MAAM,EAAI+wB,EAAU,GAAKD,EAyB1E,SAASE,GAAepxB,EAAIqxB,EAAOC,GACxC,OAAQD,EAAQ,MAAQ,QAAUC,EAAK,MAAQ,QAVfC,EAU0CvxB,EATnEE,KAAKsxB,IAZd,SAA2BtyB,GACzB,IAAIuyB,EAAO,EACXvyB,EAAQ,GAAKA,EACb,IAAK,IAAIN,EAAI,EAAGA,EAAIM,EAAMlC,OAAQ4B,IAChC6yB,GAASA,GAAQ,GAAKA,EAAQvyB,EAAM8E,WAAWpF,GAC/C6yB,GAAcA,EAEhB,OAAOA,EAKSC,CAAkBH,IAAW,IADxC,IAA2BA,EC5D3B,SAASI,GAAcvC,GAC5B,MAAMwC,EAAUpE,SAASqE,eAAe,iBAClCC,EAAOtE,SAASsE,MAAQtE,SAASuE,qBAAqB,QAAQ,GAC9DC,EAAUxE,SAASyE,cAAc,QACvCD,EAAQ91B,KAAO,YACf81B,EAAQhyB,GAAK,gBACbgyB,EAAQE,IAAM,gBACdF,EAAQG,KAAO,iBAAmB/C,EAAQ,EAAI,IAAM,IAAM,OACtDwC,GACFE,EAAKM,YAAYR,GAEnBE,EAAKO,YAAYL,GAEjBxE,SAAS3I,OAASuK,EAAQ,EAAI,IAAIA,EAAM,KAAO,IAAM,SAIhD,SAASkD,GAAQzY,EAAI0Y,EAAUC,EAAeC,GACnD,IAAIC,EAAO,KAeX,IAdA7Y,EAAKA,GAAMA,EAAG8Y,UAIZD,EAAO,CACL7Y,GAAIA,IAIW,iBARnB4Y,EAAOA,GAAQA,EAAKE,UASlBD,EAAOA,GAAQ,GACfA,EAAKD,KAAOA,GAAc/J,GAAAA,OAAAA,UAGxB6J,EAAU,CACZG,EAAOA,GAAQ,GACf,IAAI9wB,EAAW4wB,EAEf,MAAMI,EAAU,2CAA2CC,KAAKN,GAC5DK,GACFhxB,EAAWgxB,EAAQ,GACnBF,EAAKI,MAAQ,CACXn0B,KAAM4zB,EAASlb,UAAUkb,EAASQ,QAAQ,KAAO,GACjDhD,IAAKrH,GAAAA,OAAAA,WAGPgK,EAAKI,MAAQ,CACXn0B,KAAM+pB,GAAAA,OAAAA,SACNqH,IAAKwC,GAGTG,EAAKI,MAAM52B,MAAQ0F,GAAY,cAAcyV,UAAU,SAASra,QAGlE,OAAO01B,EAIF,SAASM,GAAWtwB,EAAG4G,GAC5B,GAAI5G,IAAM4G,EACR,OAAO,EAGT,IAAKxE,MAAMC,QAAQrC,KAAOoC,MAAMC,QAAQuE,GACtC,OAAO,EAIT,GAAI5G,EAAE1F,QAAUsM,EAAEtM,OAChB,OAAO,EAGT0F,EAAEuwB,OACF3pB,EAAE2pB,OACF,IAAK,IAAIr0B,EAAI,EAAGs0B,EAAIxwB,EAAE1F,OAAQ4B,EAAIs0B,EAAGt0B,IACnC,GAAI8D,EAAE9D,KAAO0K,EAAE1K,GACb,OAAO,EAGX,OAAO,EAkCF,SAASu0B,GAAYC,EAAKC,GAC/B,GAAkB,iBAAPD,EACT,OAAOA,EAQT,GAJAA,EAAMA,EAAIpsB,QAAQ,kBAAmB,IAAI2rB,QAIpC,8BAA8BjY,KAAK0Y,GACtC,OAAOA,EAIT,GAAI,aAAa1Y,KAAK0Y,GACpB,OAAOA,EAIT,MAAME,EAAUxuB,MAAMC,QAAQsuB,GAAkBA,EAAextB,KAAK,KAAO,aAE3E,OADW,IAAI0tB,OAAO,MAAQD,EAAU,SAAU,KAC1C5Y,KAAK0Y,GAINA,EAHE,KASJ,SAASI,GAAmBJ,EAAKK,GACtC,IAAKL,EACH,OAAO,KAGT,MAAMM,EAAeP,GAAYC,GACjC,GAAIM,EACF,OAAOA,EAKT,OADW,IAAIH,OAAJ,eAAmBE,EAAnB,wBAAqD,KACzD/Y,KAAK0Y,EAAIT,QACPS,EAGF,KAIF,SAASO,GAAeC,GAC7B,OAAQA,GACN,KAAKlL,GAAAA,OAAAA,uBACH,MAAO,CAAEzsB,KAAM,eACjB,KAAKysB,GAAAA,OAAAA,sBACH,MAAO,CAAEzsB,KAAM,UAAWm0B,MAAO,gBACnC,KAAK1H,GAAAA,OAAAA,oBACH,MAAO,CAAEzsB,KAAM,QACjB,KAAKysB,GAAAA,OAAAA,wBACH,MAAO,CAAEzsB,KAAM,YACjB,KAAKysB,GAAAA,OAAAA,oBACH,MAAO,CAAEzsB,KAAM,WAAYm0B,MAAO,QAEtC,OAAO,KAMF,SAASyD,GAAkB1sB,GAChC,IAAI2sB,GAAc,EAWlB,MAAO,CACL3sB,QAVqBA,aAAmBnC,MACxCpH,QAAQsJ,OAAOC,GACf,IAAIvJ,SAAQ,CAACC,EAASqJ,KACpBC,EAAQyO,MACNzX,GAAU21B,EAAc5sB,EAAO,CAAC6sB,YAAY,IAASl2B,EAAQM,KAC7DkJ,GAAuBH,EAAd4sB,EAAqB,CAACC,YAAY,GAAgB1sB,QAM/D2sB,SACEF,GAAc,IAMb,SAASG,GAAYC,GAC1B,MAAe,iCAARA,EAIF,SAASC,GAAQtwB,EAAK7G,GAC3B,OAAO6G,GAAOA,EAAIwT,UAAU,EAAGra,GChNlB,MAAMo3B,WAAmB3wB,IAAAA,cACtCmlB,SACE,IAAIyL,EACJ,IAA0B,IAAtB13B,KAAKoQ,MAAMsnB,OAAiB,CAC9B,MAAMC,EAAU5L,GAAAA,OAAAA,iBAAwB/rB,KAAKoQ,MAAMkgB,OAC7CsH,EAAYnD,GAAez0B,KAAKoQ,MAAMkgB,MAAOqH,GACnD,GAAI33B,KAAKoQ,MAAMkgB,OAAStwB,KAAKoQ,MAAM8X,OAASloB,KAAKoQ,MAAM8X,MAAM8N,OAAQ,CACnE,MAAM6B,EAAS73B,KAAKoQ,MAAM8X,MAAM8N,OAAOhsB,OAAO,GACxCmiB,EAAY,cAAgByL,GAAa53B,KAAKoQ,MAAM0nB,QAAU,YAAc,IAClFJ,EAAU,yBAAKvL,UAAWA,GAAW,6BAAM0L,QACtC,CACL,MAAM1L,EAAY,kBAAoByL,GAAa53B,KAAKoQ,MAAM0nB,QAAU,YAAc,IACtFJ,EAASC,EAAU,uBAAGxL,UAAWA,GAAd,SAAqC,uBAAGA,UAAWA,GAAd,gBAErD,GAAInsB,KAAKoQ,MAAMsnB,OAAQ,CAC5B,MAAMjB,EAAMz2B,KAAKoQ,MAAMmgB,OAAOwH,aAAalB,GAAmB72B,KAAKoQ,MAAMsnB,OAAQ,UAE3EvL,EAAY,UAAYnsB,KAAKoQ,MAAM0nB,QAAU,WAAa,IAChEJ,EAAS,yBAAKvL,UAAWA,EAAW6L,IAAI,SAASC,IAAKxB,EACpD/E,QAAUjrB,IAAKA,EAAEiH,OAAOlC,QAAU,KAAM/E,EAAEiH,OAAOuqB,IAAI,kCAEvDP,EAAS,KAEX,OAAOA,GC3BI,MAAMQ,WAAoBpxB,IAAAA,cACvCmlB,SACE,OAAQjsB,KAAKoQ,MAAMqiB,MAAQ,EACzB,0BAAMtG,UAAU,UAAUnsB,KAAKoQ,MAAMqiB,MAAQ,EAAI,KAAOzyB,KAAKoQ,MAAMqiB,OACjE,MCJD,MAAM0F,GAA0B,CAAC,aAAc,YAAa,YAAa,YAAa,iBAChFC,GAA0B,CAAC,MAAc,MAAa,MAAa,MAAa,OAGtF,SAASC,GAAalC,GAC3B,GAAIA,GAAyB,iBAATA,EAAmB,CACrC,GAAIA,EAAM/C,IACR,OAAO+C,EAAM/C,IAEf,GAAI+C,EAAMn0B,MAAQm0B,EAAM52B,KAAM,CAE5B,MAAO,SADM42B,EAAM52B,KAAK+4B,WAAW,UAAYnC,EAAM52B,KAAQ,SAAW42B,EAAM52B,MACtD,WAAa42B,EAAMn0B,MAG/C,OAAO,KAMF,SAASu2B,GAAaC,EAAOC,EAAQC,EAAUC,EAAWC,GAO/D,GAJAH,GAAkB,EAClBC,GAAsB,EACtBC,GAAwB,GAHxBH,GAAgB,IAKH,GAAKC,GAAU,GAAKC,GAAY,GAAKC,GAAa,EAC7D,OAAO,KAGLC,IACFF,EAAWC,EAAYp1B,KAAKC,IAAIk1B,EAAUC,IAG5C,MAAME,EAAQt1B,KAAKC,IACjBD,KAAKC,IAAIg1B,EAAOE,GAAYF,EAC5Bj1B,KAAKC,IAAIi1B,EAAQE,GAAaF,GAG1B7Z,EAAO,CACXka,SAAWN,EAAQK,EAAS,EAC5BE,UAAYN,EAASI,EAAS,GAchC,OAXID,GAEFha,EAAKka,SAAWla,EAAKma,UAAYx1B,KAAKC,IAAIob,EAAKka,SAAUla,EAAKma,WAC9Dna,EAAKoa,SAAWpa,EAAKqa,UAAY11B,KAAKC,IAAIg1B,EAAOC,GACjD7Z,EAAKsa,SAAYV,EAAQ5Z,EAAKoa,UAAY,EAAK,EAC/Cpa,EAAKua,SAAYV,EAAS7Z,EAAKoa,UAAY,EAAK,IAEhDpa,EAAKsa,QAAUta,EAAKua,QAAU,EAC9Bva,EAAKoa,SAAWR,EAChB5Z,EAAKqa,UAAYR,GAEZ7Z,EAIF,SAASwa,GAAgBC,EAAO9B,GACrC,MAAM+B,EAAMnB,GAAwB/B,QAAQmB,GAC5C,GAAI+B,EAAM,IAAMD,EAEd,OAAOA,EAET,MAAME,EAAMnB,GAAgBkB,GAEtBE,EAAKH,EAAMI,YAAY,KAI7B,OAHID,GAAM,IACRH,EAAQA,EAAM3e,UAAU,EAAG8e,IAEtBH,EAAQ,IAAME,EAKhB,SAASG,GAAYC,EAAYjB,EAAUC,EAAW5e,EAAS6e,GACpE,OAAO,IAAI33B,SAAQ,CAACC,EAASqJ,KAC3B,MAAMqvB,EAAM,IAAIC,MAChBD,EAAIE,YAAc,YAClBF,EAAIpuB,QAAU,SAAS+Z,GACrBhb,EAAO,IAAIlC,MAAM,+BAEnBuxB,EAAIG,OAAStqB,iBAEXuqB,IAAIC,gBAAgBL,EAAI3B,KAGxB,MAAMiC,EAAM3B,GAAaqB,EAAIpB,MAAOoB,EAAInB,OAAQC,EAAUC,EAAWC,GACrE,IAAKsB,EAEH,YADA3vB,EAAO,IAAIlC,MAAM,kBAGnB,IAAI8xB,EAAStJ,SAASyE,cAAc,UACpC6E,EAAO3B,MAAQ0B,EAAIpB,SACnBqB,EAAO1B,OAASyB,EAAInB,UACpB,IAAIqB,EAAMD,EAAOE,WAAW,MAC5BD,EAAIE,uBAAwB,EAC5BF,EAAIG,UAAUX,EAAKM,EAAIhB,QAASgB,EAAIf,QAASe,EAAIlB,SAAUkB,EAAIjB,UAC7D,EAAG,EAAGiB,EAAIpB,SAAUoB,EAAInB,WAE1B,MAAMxB,EAAOY,GAAwBnrB,SAAS2sB,EAAWp6B,MAAQo6B,EAAWp6B,KAAO,aAEnF,IAAIqB,QAAa,IAAIK,SAAQC,GAAWi5B,EAAOz4B,OAAOR,EAASq2B,KAC/D,GAAK32B,EAAL,CAMA,KAAOmZ,EAAU,GAAKnZ,EAAKP,OAAS0Z,GAClCmgB,EAAIpB,SAA2B,aAAfoB,EAAIpB,SAA4B,EAChDoB,EAAInB,UAA6B,aAAhBmB,EAAInB,UAA6B,EAClDoB,EAAO3B,MAAQ0B,EAAIpB,SACnBqB,EAAO1B,OAASyB,EAAInB,UACpBqB,EAAMD,EAAOE,WAAW,MACxBD,EAAII,UAAU,EAAG,EAAGL,EAAO3B,MAAO2B,EAAO1B,QACzC2B,EAAIG,UAAUX,EAAKM,EAAIhB,QAASgB,EAAIf,QAASe,EAAIlB,SAAUkB,EAAIjB,UAC7D,EAAG,EAAGiB,EAAIpB,SAAUoB,EAAInB,WAC1Bn4B,QAAa,IAAIK,SAAQC,GAAWi5B,EAAOz4B,OAAOR,EAASq2B,KAG7D4C,EAAS,KACTj5B,EAAQ,CAACq2B,KAAMA,EAAM32B,KAAMA,EAAM43B,MAAO0B,EAAIpB,SAAUL,OAAQyB,EAAInB,UAAWz5B,KAAM85B,GAAgBO,EAAWr6B,KAAMi4B,UAlBlHhtB,EAAO,IAAIlC,MAAM,8BAoBrBuxB,EAAI3B,IAAM+B,IAAIS,gBAAgBd,MAwD3B,SAASe,GAAa95B,GAC3B,OAAO,IAAIK,SAAQ,CAACC,EAASqJ,KAC3B,MAAMpJ,EAAS,IAAIC,WACnBD,EAAOqK,QAAUe,IACfhC,EAAOpJ,EAAOuJ,QAEhBvJ,EAAO44B,OAAS,KACd74B,EAAQ,CAACq2B,KAAM32B,EAAKrB,KAAMo7B,KAAMx5B,EAAOK,OAAOo5B,MAAM,KAAK,MAE3Dz5B,EAAO05B,cAAcj6B,MA0FlB,SAASk6B,GAAiBC,GAC/B,IAAK5yB,MAAMC,QAAQ2yB,GACjB,OAAO,KAET,IACE,IAAIC,EAAM,GAEV,OADA,IAAIz5B,WAAWw5B,GAAKE,SAAQtuB,GAAKquB,GAAOxxB,OAAOC,aAAakD,KACrDjG,OAAO0C,KAAK4xB,GACnB,MAAOzV,IACT,OAAO,KAGF,SAAS2V,GAAiBC,GAC/B,MAAMJ,EAAM,GACZ,IAKE,MAHA,IADar0B,OAAOqB,KAAKozB,IAChBF,SAAQ92B,IACf42B,EAAIl3B,KAAKM,EAAEkD,WAAW,OAEjB0zB,EACP,MAAOxV,IACT,OAAO,KCxST,MAOM6V,GAAiB,OAKR,MAAMC,WAAoBv0B,IAAAA,cACvChH,YAAYsQ,GACVvE,MAAMuE,GAEN,IAAIkrB,EAAUJ,GAAiBl7B,KAAKoQ,MAAMkrB,SACtCnzB,MAAMC,QAAQkzB,IAAYA,EAAQj7B,OAPf,KAQrBi7B,EAAU,MAGZt7B,KAAKu7B,MAAQ,CACXC,SAAS,EACTC,SAAS,EACTC,YAAa,OACb76B,SAAUb,KAAKoQ,MAAMvP,SAAW,EAAI8yB,GAAc3zB,KAAKoQ,MAAMvP,SAAW,KAAQ,OAChF86B,QAAS37B,KAAKoQ,MAAMvP,UAAY,IAChCy6B,QAASA,GAGXt7B,KAAK47B,UAAY57B,KAAK47B,UAAUrM,KAAKvvB,MACrCA,KAAK67B,WAAa77B,KAAK67B,WAAWtM,KAAKvvB,MACvCA,KAAK87B,aAAe97B,KAAK87B,aAAavM,KAAKvvB,MAC3CA,KAAK+7B,UAAY/7B,KAAK+7B,UAAUxM,KAAKvvB,MAErCA,KAAKg8B,WAAah8B,KAAKg8B,WAAWzM,KAAKvvB,MACvCA,KAAKi8B,WAAaj8B,KAAKi8B,WAAW1M,KAAKvvB,MACvCA,KAAKk8B,YAAcl8B,KAAKk8B,YAAY3M,KAAKvvB,MAEzCA,KAAKm8B,YAAc,KAEnBn8B,KAAKo8B,WAAa,GAClBp8B,KAAKq8B,UAAYv1B,IAAAA,YAGnB8pB,oBACM5wB,KAAKoQ,MAAM6nB,KACbj4B,KAAK47B,YAGH57B,KAAKu7B,MAAMD,SACbt7B,KAAK67B,aAIT/K,uBACM9wB,KAAKm8B,cACPn8B,KAAKm8B,YAAYG,UAAY,KAC7Bt8B,KAAKm8B,YAAYI,aAAe,KAChCv8B,KAAKm8B,YAAYK,QAAU,KAC3Bx8B,KAAKm8B,YAAYM,QACjBz8B,KAAKm8B,YAAc,MAIvBO,mBAAmBC,GAKjB,GAJI38B,KAAKoQ,MAAM6nB,KAAO0E,EAAU1E,KAC9Bj4B,KAAK47B,YAGH57B,KAAKoQ,MAAMkrB,SAAWqB,EAAUrB,QAAS,CAC3C,IAAIA,EAAUJ,GAAiBl7B,KAAKoQ,MAAMkrB,SACtCnzB,MAAMC,QAAQkzB,IAAYA,EAAQj7B,OA9DjB,KA+DnBi7B,EAAU,MAEZt7B,KAAK48B,SAAS,CAACtB,QAASA,GAAUt7B,KAAK67B,aAI3CD,YACE57B,KAAKm8B,YAAc,IAAIU,MAAM78B,KAAKoQ,MAAM6nB,KACxCj4B,KAAKm8B,YAAYG,UAAY/vB,GAAKvM,KAAK48B,SAAS,CAACpB,SAAS,IAC1Dx7B,KAAKm8B,YAAYI,aAAehwB,GAAKvM,KAAK48B,SAAS,CACjDlB,YAAa/H,GAAc3zB,KAAKm8B,YAAYT,YAAa17B,KAAKu7B,MAAMI,WAEtE37B,KAAKm8B,YAAYK,QAAUjwB,IACzBvM,KAAKm8B,YAAYT,YAAc,EAC/B17B,KAAK48B,SAAS,CAACnB,SAAS,EAAOC,YAAa/H,GAAc,EAAG3zB,KAAKu7B,MAAMI,YAI5EE,aAEE77B,KAAKq8B,UAAUrL,QAAQwH,MA7FF,EA6FUx4B,KAAKq8B,UAAUrL,QAAQ8L,YACtD98B,KAAKq8B,UAAUrL,QAAQyH,OA9FF,EA8FWz4B,KAAKq8B,UAAUrL,QAAQ+L,aAEvD/8B,KAAKg9B,cAAgBh9B,KAAKq8B,UAAUrL,QAAQqJ,WAAW,MACvDr6B,KAAKg9B,cAAcC,QAAU,QAE7Bj9B,KAAKo8B,WAAap8B,KAAK87B,aAAa97B,KAAKu7B,MAAMD,SAC/Ct7B,KAAK+7B,YAIPA,YACE,IAAK/7B,KAAKq8B,UAAUrL,QAClB,OAGF,MAAMwH,EAAQx4B,KAAKk9B,eACbzE,EAASz4B,KAAKq8B,UAAUrL,QAAQyH,OAEtCz4B,KAAKg9B,cAAcG,UA9GJ,EAgHf,MAAMC,EAAY,KAChB,GAAKp9B,KAAKq8B,UAAUrL,UAKpBhxB,KAAKg9B,cAAcxC,UAAU,EAAG,EAAGx6B,KAAKq8B,UAAUrL,QAAQwH,MAAOC,GAE7Dz4B,KAAKo8B,YAAY,CACfp8B,KAAKu7B,MAAME,SACb/0B,OAAO22B,sBAAsBD,GAI/B,MAAME,EAAUt9B,KAAKoQ,MAAMvP,SACzB0C,KAAKg6B,IAAI,EAAGh6B,KAAKC,IAAmC,IAA/BxD,KAAKm8B,YAAYT,YAAqB17B,KAAKoQ,MAAMvP,SAAU,KAAO23B,EAAQgF,KAAmB,EAGpHx9B,KAAKg9B,cAAcS,YACnBz9B,KAAKg9B,cAAcU,YAActC,GACjC,IAAK,IAAIn5B,EAAI,EAAGA,EAAIjC,KAAKo8B,WAAW/7B,OAAQ4B,IAAK,CAC/C,IAAI+B,EAAI,EAAQ,GAAJ/B,EAA6Bu7B,EACrCtK,EAAIlzB,KAAKo8B,WAAWn6B,GAAKw2B,EAAS,GAEtC,MAAMhF,EAAQzvB,EAAIs5B,EAAUlC,GApIpB,OAqIJp7B,KAAKg9B,cAAcU,aAAejK,IACpCzzB,KAAKg9B,cAAcW,SACnB39B,KAAKg9B,cAAcS,YACnBz9B,KAAKg9B,cAAcU,YAAcjK,GAGnCzzB,KAAKg9B,cAAcY,OAAO55B,EAAkB,IAAdy0B,EAASvF,IACvClzB,KAAKg9B,cAAca,OAAO75B,EAAY,GAATy0B,EAAmB,GAAJvF,GAG9ClzB,KAAKg9B,cAAcW,SAGf39B,KAAKoQ,MAAMvP,WACbb,KAAKg9B,cAAcS,YACnBz9B,KAAKg9B,cAAcc,IAAIR,EAAUE,GAAyB,GAAT/E,EAAc+E,GAAgB,EAAG,EAAIj6B,KAAKw6B,IAC3F/9B,KAAKg9B,cAAcgB,UAnJT,OAoJVh+B,KAAKg9B,cAAciB,UAKzBb,IAIFtB,aAAaoC,GACX,MAAMC,EAAW56B,KAAKC,IAAI06B,EAAS79B,QAAUL,KAAKq8B,UAAUrL,QAAQwH,MAlKxD,GAkKgC,GAAqE,GAC3G4F,EAASF,EAAS79B,OAAS89B,EACjC,IAAIE,EAAO,GACPd,GAAO,EACX,IAAK,IAAIt7B,EAAE,EAAEA,EAAEk8B,EAASl8B,IAAK,CAC3B,IAAIq8B,EAAMr8B,EAAIm8B,EAAU,EACpBG,GAAOt8B,EAAI,GAAKm8B,EAAU,EAC1BI,EAAM,EACV,IAAK,IAAIC,EAAEH,EAAIG,EAAEF,EAAIE,IACnBD,GAAON,EAASO,GAElBJ,EAAKp8B,GAAKsB,KAAKg6B,IAAI,EAAGiB,GAAOD,EAAKD,IAClCf,EAAMh6B,KAAKg6B,IAAIc,EAAKp8B,GAAIs7B,GAG1B,OAAIA,EAAM,GAERv9B,KAAKk9B,eAA4B,GAAXiB,EAnLZ,EAoLHE,EAAK/rB,KAAIvM,GAAKA,EAAIw3B,KAEpB,KAGTvB,WAAWv1B,GACTA,EAAEwqB,iBACGjxB,KAAKu7B,MAAMC,UAGZx7B,KAAKu7B,MAAME,SACbz7B,KAAKm8B,YAAYM,QACjBz8B,KAAK48B,SAAS,CAACnB,SAAS,MAExBz7B,KAAKm8B,YAAYuC,OACjB1+B,KAAK48B,SAAS,CAACnB,SAAS,GAAOz7B,KAAK+7B,aAIxCG,YAAY3W,GACV5gB,QAAQC,IAAI2gB,GAGd0W,WAAWx1B,GAET,GADAA,EAAEwqB,iBACExqB,EAAEiH,QAAU1N,KAAKoQ,MAAMvP,SAAU,CACnC,MAAM89B,EAAOl4B,EAAEiH,OAAOkxB,wBAChB57B,GAAUyD,EAAEo4B,QAAUF,EAAK/L,MAAQ5yB,KAAKk9B,eAnN3B,EAoNnBl9B,KAAKm8B,YAAYT,YAAc17B,KAAKoQ,MAAMvP,SAAWmC,EAAS,IAC9DhD,KAAK48B,SAAS,CAAClB,YAAa/H,GAAc3zB,KAAKm8B,YAAYT,YAAa17B,KAAKu7B,MAAMI,YAC9E37B,KAAKu7B,MAAME,SAAWz7B,KAAKu7B,MAAMD,SACpCt7B,KAAK+7B,aAKX9P,SACE,MAAM6S,EAAY,kBACf9+B,KAAKoQ,MAAM2uB,MAAQ,GAAK,WACxB/+B,KAAKu7B,MAAMC,QAAU,GAAK,aACvBkD,EAAQ,uBAAGlJ,KAAK,IAAInJ,QAASrsB,KAAKg8B,WAAY9T,MAAM,QACtD,uBAAGiE,UAAW2S,GAAY9+B,KAAKu7B,MAAME,QAAU,eAC5Cz7B,KAAKu7B,MAAMC,QAAU,cAAgB,mBAE5C,OAAQ,yBAAKrP,UAAU,gBAAgBnsB,KAAKoQ,MAAM2uB,MAChD,oCACE,6BACG/+B,KAAKu7B,MAAMD,QACV,4BAAQnP,UAAU,WAAWiH,IAAKpzB,KAAKq8B,UAAWhQ,QAASrsB,KAAKi8B,aAChE,yBAAK9P,UAAU,YAAf,QAGHuS,GAGH,oCACGA,EACD,6BACG1+B,KAAKu7B,MAAMD,QACV,4BAAQnP,UAAU,WAAWiH,IAAKpzB,KAAKq8B,UAAWhQ,QAASrsB,KAAKi8B,aAChE,yBAAK9P,UAAU,YACb,kBAAC,EAAAG,iBAAD,CACEjpB,GAAE,sBAAuBkpB,eAAc,kCAG7C,yBAAKJ,UAAU,SAASnsB,KAAKu7B,MAAMG,YAAnC,IAAiD17B,KAAKu7B,MAAM16B,cC9PvD,MAAMm+B,WAAkBl4B,IAAAA,cACrChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXtD,IAAK,sBACL9E,MAAOvzB,OAAOiX,OAAO,CAACooB,QAAS,OAAQj/B,KAAKoQ,MAAM+iB,OAClDhH,UAAWnsB,KAAKoQ,MAAM+b,UACtB6L,IAAKh4B,KAAKoQ,MAAM4nB,IAChB3L,QAASrsB,KAAKoQ,MAAMic,SAIxBuE,oBAEE5wB,KAAKoQ,MAAM8uB,SACR10B,QACAyO,MAAKjX,GAAQhC,KAAK48B,SAAS,CAAC3E,IAAKj2B,EAAKi2B,IAAK9E,MAAO,IAAInzB,KAAKu7B,MAAMpI,MAAO8L,QAAS,OACjFt0B,OAAM,IAAM3K,KAAK48B,SAAS,CAAC3E,IAAK,2BAGrCnH,uBACE9wB,KAAKoQ,MAAM8uB,SAAS7H,SAGtBqF,mBAAmBC,GACbA,EAAUuC,UAAYl/B,KAAKoQ,MAAM8uB,WACnCl/B,KAAK48B,SAAS,CAAC3E,IAAK,sBAAuB9E,MAAO,IAAInzB,KAAKu7B,MAAMpI,MAAO8L,QAAS,SACjFj/B,KAAKoQ,MAAM8uB,SACR10B,QACAyO,MAAKjX,GAAQhC,KAAK48B,SAAS,CAAC3E,IAAKj2B,EAAKi2B,IAAK9E,MAAO,IAAInzB,KAAKu7B,MAAMpI,MAAO8L,QAAS,OACjFt0B,OAAM,IAAM3K,KAAK48B,SAAS,CAAC3E,IAAK,4BAIvChM,SACE,OAAOnlB,IAAAA,cAAoB,MAAO9G,KAAKu7B,QCpC5B,MAAM4D,WAAqBr4B,IAAAA,cACxCmlB,SACE,OACE,yBAAKE,UAAU,YACb,6BAAK,0BAAMgH,MAAO,CAACqF,MAA8B,IAAtBx4B,KAAKoQ,MAAMgvB,SAAkB,QACvDp/B,KAAKoQ,MAAMgvB,SAAW,KACrB,uBAAG5J,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMivB,aAC1D,uBAAGlT,UAAU,kBAAb,SADF,IAC0C,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBAC1DkpB,eAAc,6BAGlB,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,oCCTjD,MAAM+S,WAAuBx4B,IAAAA,cAC1ChH,YAAYsQ,GACVvE,MAAMuE,GAGR6b,SACE,OACE,yBAAKE,UAAU,gBACZrlB,IAAAA,cAAoB,MAAO9G,KAAKoQ,OACjC,yBAAK+b,UAAU,qBACb,kBAACgT,GAAD,CAAcC,SAAUp/B,KAAKoQ,MAAMgvB,SAAUC,SAAUr/B,KAAKoQ,MAAMmvB,oBCF5E,MAAM1R,IAAWC,EAAAA,EAAAA,gBAAe,CAC9B0R,YAAa,CACXn8B,GAAI,cACJkpB,eAAgB,CAAF,yBAGhBkT,kBAAmB,CACjBp8B,GAAI,oBACJkpB,eAAgB,CAAF,8BAGhBmT,aAAc,CACZr8B,GAAI,eACJkpB,eAAgB,CAAF,2BAGhBoT,eAAgB,CACdt8B,GAAI,iBACJkpB,eAAgB,CAAF,iCAMlB,SAASqT,GAAgBC,EAAI79B,EAAM89B,GACjC,IAAK99B,EAMH,OALA89B,EAAK7H,IAAM,uBACX6H,EAAK3M,MAAQ,CACXqF,MAAOnL,OACPoL,OAAQpL,QAEHwS,EAGTC,EAAK3T,UAAY,eACjB,MAAM+N,EAAM3B,GAAav2B,EAAKw2B,MAAOx2B,EAAKy2B,OACxCz4B,KAAK+/B,cAAgB,EAAIx8B,KAAKC,IAAIxD,KAAK+/B,cAAgB9S,KAAgBA,OACrEA,MAAiBA,KAAe,IAChC,CAAC6L,SZG0B,GYHGC,UZGH,IYuB/B,OAzBA+G,EAAK3M,MAAQ,CACXqF,MAAO0B,EAAIpB,SAAW,KACtBL,OAAQyB,EAAInB,UAAY,KAExBiH,SAAU9F,EAAIpB,SAAW,KACzBmH,UAAW/F,EAAInB,UAAY,MAExBmH,GAAAA,OAAAA,aAAoBl+B,GAevB69B,EAAKP,IAdLQ,EAAK7H,IAAMj4B,KAAK+3B,aAAalB,GAAmBiJ,EAAK7H,IAAK,UAC1D6H,EAAK9H,IAAMh2B,EAAK1C,KACZwgC,EAAK7H,KACH10B,KAAKg6B,IAAIv7B,EAAKw2B,OAAS,EAAGx2B,EAAKy2B,QAAU,GAAKpL,KAEhDyS,EAAKzT,QAAUrsB,KAAKmgC,eACpBL,EAAK3T,WAAa,oBAEpB2T,EAAKM,QAAU,QAEfN,EAAK7H,IAAM,wBAOR4H,EAUF,SAASQ,GAAclN,EAAOnxB,EAAMmQ,EAAQlM,EAAKq6B,GACtD,GAAIA,EAAMtzB,SAAS,MACjB,OAAOuzB,GAAergC,KAAKF,KAAMmzB,EAAOnxB,EAAMmQ,EAAQlM,GAGxD,IAAKktB,EAEH,OAAOhhB,EAGT,IAAI0tB,EAAKK,GAAAA,OAAAA,QAAe/M,GACpB2M,EAAOI,GAAAA,OAAAA,UAAiB/M,EAAOnxB,IAAS,GAE5C,OADA89B,EAAK75B,IAAMA,EACHktB,GACN,IAAK,KAEC2M,EAAK7H,MACP6H,EAAK7H,IAAMj4B,KAAK+3B,aAAalB,GAAmBiJ,EAAK7H,IAAK,UAC1D6H,EAAKj/B,SAAWmB,EAAKnB,SAAW,EAAqB,EAAhBmB,EAAKnB,cAAgBG,EAC1D8+B,EAAKxE,QAAUt5B,EAAKs5B,QACpBwE,EAAKM,QAAU,QAEjBP,EAAKxE,GAELlpB,EAAS,KACT,MACF,IAAK,KACHA,EAAS,KACT,MACF,IAAK,KAwCL,IAAK,KAEH,MAvCF,IAAK,KAEH2tB,EAAK3T,UAAY,YACjB,MACF,IAAK,KACH0T,EAAK,KACL1tB,EAAS,KACT,MACF,IAAK,KAEH0tB,EAAKD,GAAgB1/B,KAAKF,KAAM6/B,EAAI79B,EAAM89B,GAE1C3tB,EAAS,KACT,MACF,IAAK,KAEH2tB,EAAKzT,QAAUrsB,KAAKwgC,kBACpB,IAAIC,EAAQ35B,IAAAA,SAAAA,IAAmBqL,GAASuuB,GACf,iBAATA,EAAoBA,OAAQ1/B,IAEvCy/B,GAAyB,GAAhBA,EAAMpgC,SAClBogC,EAAQ,CAACX,EAAKxgC,OAGhBwgC,EAAK,cAAgBW,EAAMv3B,KAAK,IAChC,MACF,IAAK,KAEH42B,EAAK3T,UAAY,UACbnqB,IACF89B,EAAK3T,WAAa,IAAMsI,GAAezyB,EAAKwT,KAAK,GAAO,IAE1D,MACF,IAAK,KAEHsqB,EAAK3T,UAAY,WACjB,MAIF,IAAK,KAEH2T,EAAK3T,UAAY,cACjB2T,EAAKzT,QAAUrsB,KAAK2gC,aACpB,MACF,QACE,IAAKd,EAAI,CAEPA,EAAK/4B,IAAAA,SACLg5B,EAAO,CAAC75B,IAAKA,GAEb,IAAIsa,EAAOpO,EACNhK,MAAMC,QAAQ+J,IAAYA,EAAOjJ,KAAK,IAAI8sB,SAC7CzV,EAAO,CAAC,0BAAMta,IAAI,KAAKkmB,UAAU,QAAQnsB,KAAKovB,cAAcvB,GAAS8R,mBAEvExtB,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,uBAAtB,aAA2D,KAAKyU,OAAOrgB,IAIvF,OAAKsf,EAGE/4B,IAAAA,cAAoB+4B,EAAIC,EAAM3tB,GAF5BA,EASJ,SAAS0uB,GAAiB1N,EAAOnxB,EAAMmQ,EAAQlM,GACpD,IAAKktB,EAEH,OAAOhhB,EAGT,IAAI0tB,EAAKK,GAAAA,OAAAA,QAAe/M,GACxB,MAAM2M,EAAO,CAAE75B,IAAKA,GACpB,OAAQktB,GACN,IAAK,KAEH0M,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,kBAAtB,OAAgD,IAAKwH,GAAc3xB,EAAKnB,SAAS,MAC3F,MACF,IAAK,KAEHg/B,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,KACV,MACF,IAAK,KAEH2tB,EAAK3T,UAAY,oBACjB,MACF,IAAK,KACL,IAAK,KAEH0T,EAAK,OACL,MACF,IAAK,KAEHA,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,kBAAtB,SAAkD,IAAKnsB,KAAKovB,cAAcvB,GAAS6R,eAC7F,MACF,IAAK,KACHG,EAAK,OACLC,EAAK3T,UAAY,mBACjB,MACF,IAAK,KACH0T,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,kBAAtB,aACRnsB,KAAKovB,cAAcvB,GAAS2R,cAAcoB,OAAO,IAAKzuB,GAAU,IAClE,MACF,IAAK,KACH0tB,EAAK/4B,IAAAA,SACL,MACF,IAAK,KACH,GAAI9E,EAAM,CACR,GAAiB,oBAAbA,EAAKu1B,KAEP,OAAO,YAGFv1B,EAAKwT,WACLxT,EAAKoxB,IAEdyM,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,kBAAtB,cAAuD,IAAKnsB,KAAKovB,cAAcvB,GAAS4R,oBAClG,MACF,IAAK,KACL,IAAK,KACHI,EAAK,KACL1tB,EAAS,KACT,MACF,QACO0tB,IAEHA,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,uBAAtB,aAA2D,IAAKnsB,KAAKovB,cAAcvB,GAAS8R,kBAI5G,OAAKE,EAGE/4B,IAAAA,cAAoB+4B,EAAIC,EAAM3tB,GAF5BA,EAMX,SAAS2uB,GAAgBhB,EAAM99B,GAa7B,OAZA89B,EAAK3M,MAAQ,CACXqF,MAAOnL,OACPoL,OAAQpL,OACRqL,SAAUrL,OACVsL,UAAWtL,QAEbyS,EAAK3T,UAAY,eACjB2T,EAAK9H,IAAMh4B,KAAKovB,cAAcvB,GAAS6R,cAClC19B,IACH89B,EAAK7H,IAAM,wBAEb6H,EAAK5X,MAAQ4X,EAAK9H,IACX8H,EAST,SAASS,GAAepN,EAAOnxB,EAAMmQ,EAAQlM,GAC3C,GAAI,CAAC,KAAM,KAAM,KAAM,MAAM+G,SAASmmB,GAAQ,CAC5C,IAAI0M,EAAKK,GAAAA,OAAAA,QAAe/M,GACpB2M,EAAOI,GAAAA,OAAAA,UAAiB/M,EAAOnxB,IAAS,GAE5C,OADA89B,EAAK75B,IAAMA,EACJktB,GACL,IAAK,KACHhhB,EAAS,KACT,MACF,IAAK,KACH2tB,EAAOgB,GAAgB5gC,KAAKF,KAAM8/B,EAAM99B,GACxCmQ,EAAS,CAACrL,IAAAA,cAAoB,MAAOg5B,EAAM,MAAO,IAAKA,EAAK9H,KAC5D6H,EAAK/4B,IAAAA,SAELg5B,EAAO,CAAC75B,IAAKA,GACb,MACF,IAAK,KACH45B,EAAK,OACLC,EAAK3T,UAAY,UACbnqB,IACF89B,EAAK3T,WAAa,IAAMsI,GAAezyB,EAAKwT,KAAK,GAAO,IAE1D,MACF,IAAK,KACH,IAAI6jB,EACJ,GAAIr3B,EAAM,CACR,GAAiB,oBAAbA,EAAKu1B,KAEP,OAAO,KAET8B,EAAQr3B,EAAK1C,YAEN0C,EAAKwT,WACLxT,EAAKoxB,IAEdyM,EAAK/4B,IAAAA,SACLqL,EAAS,CAAC,uBAAGlM,IAAI,KAAKkmB,UAAU,kBAAtB,cACRmI,GAAgB+E,EAAO,KAAOr5B,KAAKovB,cAAcvB,GAAS4R,oBAGhE,OAAO34B,IAAAA,cAAoB+4B,EAAIC,EAAM3tB,GAEvC,OAAO0uB,GAAiB3gC,KAAKF,KAAMmzB,EAAOnxB,EAAMmQ,EAAQlM,GAI1D,SAAS86B,GAAW/+B,GAClB,IAAIwI,EAEJ,GAAIxI,EAAKwT,IAAK,CACZ,MAAM5U,EL9EH,SAAsBsG,EAAKqwB,GAChC,IAAKrwB,EACH,OAAO,KAGT,IAEE,MAAM8zB,EAAMjzB,KAAKb,GACX7G,EAAS26B,EAAI36B,OACb2gC,EAAM,IAAIC,YAAY5gC,GACtB06B,EAAM,IAAIx5B,WAAWy/B,GAC3B,IAAK,IAAI/+B,EAAI,EAAGA,EAAI5B,EAAQ4B,IAC1B84B,EAAI94B,GAAK+4B,EAAI3zB,WAAWpF,GAG1B,OAAO,IAAIiD,KAAK,CAAC87B,GAAM,CAAEzhC,KAAMg4B,IAC/B,MAAMhS,GACN5gB,QAAQ+F,MAAM,qCAAsC6a,GAGtD,OAAO,KK0DQ2b,CAAal/B,EAAKwT,IAAKxT,EAAKu1B,MACzC,IAAK32B,EACH,MAAM,IAAIyH,MAAM,iBAElBmC,EAAUvJ,QAAQC,QAAQN,OACrB,KAAIoB,EAAKoxB,IAUd,MAAM,IAAI/qB,MAAM,sBAThBmC,EAAUkW,MAAM1gB,KAAK+3B,aAAalB,GAAmB70B,EAAKoxB,IAAK,WAC5Dna,MAAKkoB,IACJ,GAAIA,EAAIxgB,GACN,OAAOwgB,EAAIvgC,OAEX,MAAM,IAAIyH,MAAJ,oCAAuC84B,EAAI7kB,OAA3C,YAAqD6kB,EAAIC,gBAQvE,OAAO52B,EACJyO,MAAKrY,GAEG84B,GAAY94B,EAAMysB,GAAqBA,IAAsB,GAAG,KACtEpU,MAAKooB,IACNr/B,EAAKu1B,KAAO8J,EAAO9J,KACnBv1B,EAAK4c,KAAOyiB,EAAOzgC,KAAKge,KACxB5c,EAAKw2B,MAAQ6I,EAAO7I,MACpBx2B,EAAKy2B,OAAS4I,EAAO5I,cACdz2B,EAAKoxB,IAGZpxB,EAAKi2B,IAAM+B,IAAIS,gBAAgB4G,EAAOzgC,MAC/B85B,GAAa2G,EAAOzgC,SAC1BqY,MAAKkiB,IACNn5B,EAAKwT,IAAM2lB,EAAIR,KACR34B,KACN2I,OAAM4a,IAMP,aALOvjB,EAAKwT,WACLxT,EAAKi2B,IACZj2B,EAAKw2B,MAAQnL,GACbrrB,EAAKy2B,OAASpL,GAER9H,KAKL,SAAS+b,GAAenO,EAAOnxB,EAAMmQ,EAAQlM,EAAKq6B,GACvD,GAAa,MAATnN,EAAe,CACjB,MAAM2M,EAAOgB,GAAgB5gC,KAAKF,KAAM,CAACiG,IAAKA,GAAMjE,GACpD,IAAIu/B,EACJ,IACEA,EAAgBrK,GAAkB6J,GAAW7gC,KAAKF,KAAMgC,IACxD,MAAO0I,GACP62B,EAAgBrK,GAAkBxsB,GAIpC,OAFAo1B,EAAKZ,SAAWqC,EAChBpvB,EAAS,CAACrL,IAAAA,cAAoBk4B,GAAWc,EAAM,MAAO,IAAKA,EAAK9H,KACzDlxB,IAAAA,cAAoBA,IAAAA,SAAgB,CAACb,IAAKA,GAAMkM,GAClD,GAAa,MAATghB,EAAe,CACxB,GAAImN,EAAMtzB,SAAS,MAEjB,OAAOlG,IAAAA,cAAoB,OAAQ,CAACb,IAAKA,GACvC,CAAC,uBAAGA,IAAI,KAAKkmB,UAAU,kBAAtB,gBAAyD,MAG9D,MAAM2T,EAAOI,GAAAA,OAAAA,UAAiB,KAAMl+B,IAAS,GAG7C,OAFA89B,EAAK75B,IAAMA,EACX65B,EAAK3T,UAAY,cACVrlB,IAAAA,cAAoBo5B,GAAAA,OAAAA,QAAe,MAAOJ,EAAM3tB,GAEzD,OAAOouB,GAAergC,KAAKF,KAAMmzB,EAAOnxB,EAAMmQ,EAAQlM,GC7YxD,MAAMu7B,WAAgB16B,IAAAA,UACpBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKyvB,YAAczvB,KAAKyvB,YAAYF,KAAKvvB,MACzCA,KAAKyhC,mBAAqBzhC,KAAKyhC,mBAAmBlS,KAAKvvB,MAGzDyvB,YAAYhpB,GACVA,EAAEwqB,iBACFxqB,EAAEyqB,kBACElxB,KAAKoQ,MAAMsxB,YAEb1hC,KAAKoQ,MAAMsxB,WAAW1hC,KAAKoQ,MAAMihB,KAAMrxB,KAAKoQ,MAAMzB,OAItD8yB,mBAAmBh7B,GACjBA,EAAEwqB,iBACFxqB,EAAEyqB,kBACFlxB,KAAKoQ,MAAMuxB,gBAAgB,CAAEtR,UAAWrwB,KAAKoQ,MAAMihB,KAAM6B,EAAGzsB,EAAEm7B,MAAO59B,EAAGyC,EAAEo7B,QAG5E5V,SACE,IAAI/D,EAAQloB,KAAKoQ,MAAM8X,MAClBA,EAGMA,EAAM7nB,OAAS,KAExB6nB,EAAQA,EAAMxN,UAAU,EAAG,IAAM,KAJjCwN,EAAQ,2BAAG,kBAAC,EAAAoE,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,8BAMhE,MAAMuV,EAAS9hC,KAAKoQ,MAAMqE,IAAM,SAAW,UACrCijB,GAAS13B,KAAKoQ,MAAMsnB,QAAS13B,KAAKoQ,MAAMsnB,OACxClE,EAASxzB,KAAKoQ,MAAMojB,OAASxzB,KAAKoQ,MAAMojB,OAAO/vB,QAAU,GACzDs+B,EAAc,GAuBpB,IAAIzG,EAtBAt7B,KAAKoQ,MAAM4xB,YACbD,EAAYl+B,KAAK,CAAC6vB,KAAM,WAAYD,MAAO,mBAEzCzzB,KAAKoQ,MAAM6xB,SACbF,EAAYl+B,KAAK,CAAC6vB,KAAM,QAASD,MAAO,gBAEtCzzB,KAAKoQ,MAAM8xB,aACbH,EAAYl+B,KAAK,CAAC6vB,KAAM,YAAaD,MAAO,iBAE1CzzB,KAAKoQ,MAAM+xB,MACTniC,KAAKoQ,MAAMgyB,UACb5O,EAAO3vB,KAAK,CAACvE,KAAMU,KAAKoQ,MAAM+xB,IAAIE,UAAWp8B,IAAK,SAEhDjG,KAAKoQ,MAAM+xB,IAAIG,WACjBP,EAAYl+B,KAAK,CAAC6vB,KAAM,UAErB1zB,KAAKoQ,MAAM+xB,IAAII,YAClBR,EAAYl+B,KAAK,CAAC6vB,KAAM,YAMxB1zB,KAAKoQ,MAAMoyB,mBACblH,EAAU,oCAAE,uBAAGnP,UAAU,kBAAkBnsB,KAAKoQ,MAAMqyB,kBAAoB,gBAAkB,aAChF,uBAAGtW,UAAU,kBAAb,eAC0B,iBAAtBnsB,KAAKoQ,MAAMkrB,QAC3BA,EAAUt7B,KAAKoQ,MAAMkrB,QACZ4E,GAAAA,OAAAA,QAAelgC,KAAKoQ,MAAMkrB,SACnCA,EAAUx0B,IAAAA,cAAoBA,IAAAA,SAAgB,KAAMo5B,GAAAA,OAAAA,OAAclgC,KAAKoQ,MAAMkrB,QAASuF,GACpF,CAACzR,cAAepvB,KAAKoQ,MAAMif,KAAKD,iBACzBpvB,KAAKoQ,MAAMkrB,UACpBA,EACE,oCAAE,uBAAGnP,UAAU,uBAAb,iBAAF,IAAuD,uBAAGA,UAAU,QAClE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClBkpB,eAAc,wCAItB,MAAMmH,EAAOsD,GAAeh3B,KAAKoQ,MAAM6mB,UACjCyL,EAAShP,EAAO,uBAAGvH,UAAW,oCACjCuH,EAAKD,MAAQ,IAAMC,EAAKD,MAAQ,KAAMC,EAAKp0B,MAAY,KACpDqjC,EAAa,iBAAmB3iC,KAAKoQ,MAAM0nB,QAAU,WAAa,IAExE,OACE,wBAAI3L,WAAYnsB,KAAKoQ,MAAMwyB,eAAiB5iC,KAAKoQ,MAAMyyB,SAAW,WAAa,KAAMxW,QAASrsB,KAAKyvB,aACjG,yBAAKtD,UAAU,cACb,kBAACsL,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQA,EACRxP,MAAOloB,KAAKoQ,MAAM8X,MAClBoI,MAAOtwB,KAAKoQ,MAAMihB,KAClByG,QAAS93B,KAAKoQ,MAAM0nB,UACrB93B,KAAKoQ,MAAM0nB,QAAU,uBAAG3L,UAAU,0BAAb,UACpBnsB,KAAKoQ,MAAM0yB,WAAa,0BAAM3W,UAAW2V,IACxC9hC,KAAKoQ,MAAMwyB,eAAiB5iC,KAAKoQ,MAAMyyB,SACxC,uBAAG1W,UAAU,4BAAb,gBACE,MAEN,yBAAKA,UAAU,YACb,6BAAK,0BAAMA,UAAWwW,GAAaza,GAChCloB,KAAKoQ,MAAM2yB,UAAY,yBAAK9K,IAAI,mBAAmB9L,UAAU,UAAU6L,IAAI,YAAe,KAC3F,kBAACzE,GAAD,CAAeC,OAAQuO,IACrB/hC,KAAKoQ,MAAM0nB,QAAsD,KAA5C,kBAACI,GAAD,CAAazF,MAAOzyB,KAAKoQ,MAAM4yB,UAEvDhjC,KAAKoQ,MAAMgyB,SACV,8BAAM,kBAAC7O,GAAD,CAAeC,OAAQA,KAC7BxzB,KAAKoQ,MAAM6yB,MAAQ,KAAO,yBAAK9W,UAAU,mBAAmBuW,EAAO,8BAAOpH,GAAWt7B,KAAKoQ,MAAM8yB,SAAW,OAE9GljC,KAAKoQ,MAAMuxB,gBACV,0BAAMxV,UAAU,eACd,uBAAGqJ,KAAK,IAAInJ,QAASrsB,KAAKyhC,oBACxB,uBAAGtV,UAAU,kBAAb,iBAEM,OAMpB,UAAekH,EAAAA,EAAAA,YAAWmO,IC7H1B,MAAM2B,WAAsBr8B,IAAAA,cAC1BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKyvB,YAAczvB,KAAKyvB,YAAYF,KAAKvvB,MAG3CyvB,YAAYhpB,GACVA,EAAEwqB,iBACFxqB,EAAEyqB,kBACFlxB,KAAKoQ,MAAMqhB,SAASzxB,KAAKoQ,MAAMgzB,QAGjCnX,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KACnC,OACE,wBAAIhD,QAASrsB,KAAKyvB,YAAatD,UAAU,UACvC,yBAAKA,UAAU,eAAeiD,EAAcpvB,KAAKoQ,MAAM8X,MAAOloB,KAAKoQ,MAAM+B,WAMjF,UAAekhB,EAAAA,EAAAA,YAAW8P,ICZpBtV,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BuV,UAAW,CACThgC,GAAI,YACJkpB,eAAgB,CAAF,uBAGhB+W,YAAa,CACXjgC,GAAI,cACJkpB,eAAgB,CAAF,2BAKlB,MAAMgX,WAAoBz8B,IAAAA,UACxBmlB,SACE,MAAM,cAAEmD,GAAkBpvB,KAAKoQ,MAAMif,KAC/BuT,EAAgBz6B,MAAMC,QAAQpI,KAAKoQ,MAAMozB,eACzCC,EAAe,GACrB,IAAIC,EAAgB,EAoGpB,OAnGI1jC,KAAKoQ,MAAMuzB,UAAY3jC,KAAKoQ,MAAMuzB,SAAStjC,OAAS,GACtDL,KAAKoQ,MAAMuzB,SAASrxB,KAAKnO,IACvB,GAAIA,EAAEi/B,OAEJK,EAAa5/B,KACX,kBAAC,GAAD,CACEqkB,MAAO/jB,EAAE+jB,MAAOkb,OAAQj/B,EAAEi/B,OAAQjxB,OAAQhO,EAAEgO,OAC5ClM,IAAK9B,EAAEi/B,OACP3R,SAAUzxB,KAAKoQ,MAAMqhB,gBAEpB,CAEL,MAAMxrB,EAAMjG,KAAKoQ,MAAMgyB,SAAWj+B,EAAEusB,KAAQvsB,EAAEmsB,OAASnsB,EAAEusB,KAGzD,GAAI1wB,KAAKoQ,MAAMwzB,YAAc5jC,KAAKoQ,MAAMiC,OAAQ,CAC9C,MAAMwxB,EAAW,CAAC59B,GAOlB,GANI9B,EAAE2/B,SAAW3/B,EAAE2/B,QAAQZ,SACzBW,EAAShgC,MAAM,GAAKM,EAAE2/B,QAAQZ,SAASa,eAErC5/B,EAAE6/B,QAAU7/B,EAAE6/B,OAAO9mB,IACvB2mB,EAAShgC,MAAM,GAAKM,EAAE6/B,OAAO9mB,IAAI6mB,gBAE9B/jC,KAAKoQ,MAAMwzB,WAAW5jC,KAAKoQ,MAAMiC,OAAQwxB,GAC5C,OAIJ,MAAMd,EAAYhX,GAAAA,OAAAA,mBAA0B9lB,GACtC48B,EAAWD,EACd5iC,KAAKoQ,MAAMozB,cAAcpN,QAAQnwB,IAAQ,EACzCjG,KAAKoQ,MAAMozB,gBAAkBv9B,EAC1ButB,EAAS,GACXxzB,KAAKoQ,MAAMgyB,WACTn8B,GAAOjG,KAAKoQ,MAAM6zB,UACpBzQ,EAAO3vB,KAAK,CAACvE,KAAM8vB,EAAcvB,GAASwV,WAAY5P,MAAO,UAE3DtvB,EAAEg+B,KAAOh+B,EAAEg+B,IAAI+B,WACjB1Q,EAAO3vB,KAAK,CAACvE,KAAM8vB,EAAcvB,GAASyV,aAAc7P,MAAO,UAInE,MAAMyP,EAAU/6B,MAAMC,QAAQjE,EAAE2/B,SAC9B3/B,EAAE2/B,QAAQ56B,KAAK,KAAQ/E,EAAE2/B,QAAU3/B,EAAE2/B,QAAQZ,QAAU,KACzD,IAAI5H,EACA6I,EACA3B,EACAC,EACA2B,EACJ,IAAKpkC,KAAKoQ,MAAMgyB,UAAYj+B,EAAEkgC,cAAe,CAC3C,MAAMpS,EAAM9tB,EAAEkgC,eAAc,GACxBpS,IACFkS,EAAYlS,EAAIkD,KAAOlD,EAAIkD,KAAKgP,UAAY,KAC5CC,EAAiBnS,EAAIqS,SAAWngC,EAAEogC,UAAUtS,GAAK,GACjDuQ,EAAqBvQ,EAAIkD,KAAOmC,GAAYrF,EAAIkD,KAAKoC,MAAQ,KAC7DkL,EAAoBxQ,EAAI/f,MAAQlS,KAAKoQ,MAAM6zB,SACvChS,EAAI5tB,UACNi3B,EAAgC,iBAAfrJ,EAAI5tB,QACnB4tB,EAAI5tB,QAAQlC,OAAO,EfCC,IeApB+9B,GAAAA,OAAAA,QAAejO,EAAI5tB,QfAC,MeK5Bo/B,EAAa5/B,KACX,kBAAC,GAAD,CACE0sB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBrI,MAAO/jB,EAAE6/B,OAAS7/B,EAAE6/B,OAAO9mB,GAAK,KAChCwa,OAAQW,GAAal0B,EAAE6/B,OAAS7/B,EAAE6/B,OAAO7N,MAAQ,MACjD+M,QAASA,EACT5H,QAASA,EACTkH,mBAAoBA,EACpBC,kBAAmBA,EACnB0B,UAAWA,EACXlN,SAAUmN,EACVpB,OAAQhjC,KAAKoQ,MAAMo0B,WAAargC,EAAE6+B,OAAS,EAC3CvuB,IAAKtQ,EAAE29B,QAAU9hC,KAAKoQ,MAAMq0B,UAC5BtC,IAAKh+B,EAAEg+B,IACPC,SAAUpiC,KAAKoQ,MAAMgyB,SACrB5O,OAAQA,EACRoP,cAAeA,EACfC,SAAUA,EACVC,WAAY9iC,KAAKoQ,MAAM0yB,aAAeC,EACtCA,UAAWA,EACXrB,WAAY1hC,KAAKoQ,MAAMs0B,gBACvB/C,gBAAiB3hC,KAAKoQ,MAAMuxB,gBAC5BK,WAAY79B,EAAEwgC,SAAWxgC,EAAEwgC,QAAQC,SACnC3C,QAAS99B,EAAEwgC,SAAWxgC,EAAEwgC,QAAQE,MAChC3C,YAAa/9B,EAAEwgC,SAAWxgC,EAAEwgC,QAAQG,OACpChN,QAAS3zB,EAAE4gC,SACX1T,KAAMprB,EACN0I,MAAO80B,EAAapjC,OACpB4F,IAAKA,KAETy9B,OAED1jC,MAIH,yBAAKmsB,UAAWnsB,KAAKoQ,MAAM40B,SAAW,KAAO,oBACzB,GAAjBtB,EACC,yBAAKvX,UAAU,qBACb8Y,wBAAyB,CAACC,OAAQllC,KAAKoQ,MAAM+0B,oBAE/C,KAED1B,EAAapjC,OAAS,EACrB,wBAAI8rB,UAAU,eACXsX,GAGH,OAOV,UAAepQ,EAAAA,EAAAA,YAAWkQ,ICrJX,MAAM6B,WAAuBt+B,IAAAA,cAC1ChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX8J,QAAQ,EACRC,OAAQ,IAGVtlC,KAAKulC,mBAAqBvlC,KAAKulC,mBAAmBhW,KAAKvvB,MACvDA,KAAKwlC,aAAexlC,KAAKwlC,aAAajW,KAAKvvB,MAC3CA,KAAKylC,YAAczlC,KAAKylC,YAAYlW,KAAKvvB,MACzCA,KAAK0lC,cAAgB1lC,KAAK0lC,cAAcnW,KAAKvvB,MAG/C8wB,uBACM9wB,KAAKu7B,MAAM8J,SACbrlC,KAAK48B,SAAS,CAAC0I,OAAQ,GAAID,QAAQ,IACnCrlC,KAAKoQ,MAAMu1B,iBAAiB5Z,GAAAA,OAAAA,WAIhCwZ,mBAAmB9+B,GACjBzG,KAAK48B,SAAS,CAAC0I,OAAQ7+B,EAAEiH,OAAOnL,QAGlCijC,aAAa/+B,GACXA,EAAEwqB,iBACF,IAAI2U,EAAQ5lC,KAAKu7B,MAAM+J,OAAOtP,OAC9Bh2B,KAAK48B,SAAS,CAACyI,OAASO,EAAMvlC,OAAS,IACvCL,KAAKoQ,MAAMu1B,iBAAiBC,EAAMvlC,OAAS,EAAIulC,EAAQ7Z,GAAAA,OAAAA,UAGzD0Z,YAAYh/B,GACVA,EAAEwqB,iBACEjxB,KAAKu7B,MAAM8J,QACbrlC,KAAKoQ,MAAMu1B,iBAAiB5Z,GAAAA,OAAAA,UAE9B/rB,KAAK48B,SAAS,CAAC0I,OAAQ,GAAID,QAAQ,IAGrCK,cAAcj/B,GACE,UAAVA,EAAER,IACJjG,KAAKwlC,aAAa/+B,GACC,WAAVA,EAAER,KACXjG,KAAKylC,cAITxZ,SACE,OACE,yBAAKE,UAAU,cACb,yBAAKA,UAAU,kBACb,uBAAGA,UAAU,yBAAb,UACA,2BAAOA,UAAU,SAAS5sB,KAAK,OAC3BsmC,YAAa7lC,KAAKoQ,MAAMy1B,YACxBtjC,MAAOvC,KAAKu7B,MAAM+J,OAAQQ,SAAU9lC,KAAKulC,mBACzCQ,UAAW/lC,KAAK0lC,cAAeM,UAAQ,EAACC,WAAS,IACpDjmC,KAAKu7B,MAAM+J,OACV,uBAAG9P,KAAK,IAAInJ,QAASrsB,KAAKylC,aAAa,uBAAGtZ,UAAU,kBAAb,kBAEvC,8BAAM,uBAAGA,UAAU,kBAAb,SCxDH,MAAM+Z,WAAsBp/B,IAAAA,UACzChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXqK,MAAO,MAGT5lC,KAAKwvB,gBAAkBxvB,KAAKwvB,gBAAgBD,KAAKvvB,MACjDA,KAAKmmC,YAAcnmC,KAAKmmC,YAAY5W,KAAKvvB,MAEzCA,KAAKomC,qBAAuBpmC,KAAKomC,qBAAqB7W,KAAKvvB,MAC3DA,KAAKqmC,sBAAwBrmC,KAAKqmC,sBAAsB9W,KAAKvvB,MAG/D4wB,oBACE5wB,KAAKoQ,MAAMk2B,aAGb9W,gBAAgB/oB,GACI,KAAdA,EAAE2qB,SAEJpxB,KAAKoQ,MAAM+gB,MAAK,GAIpBgV,YAAY1/B,GACVA,EAAEwqB,iBACFjxB,KAAKoQ,MAAM+gB,MAAK,GAGlBiV,qBAAqBR,GACnB5lC,KAAK48B,SAAS,CAAEgJ,MAAO7Z,GAAAA,OAAAA,YAAmB6Z,GAAS,KAAOA,IAC1D5lC,KAAKoQ,MAAMu1B,iBAAiBC,GAG9BS,sBAAsBE,GACpBvmC,KAAKoQ,MAAMs0B,gBAAgB6B,GAC3BvmC,KAAKoQ,MAAM+gB,MAAK,GAGlBlF,SACE,IAAI0X,EAA+B,MAApB3jC,KAAKu7B,MAAMqK,MAAgB5lC,KAAKoQ,MAAMo2B,cAAgBxmC,KAAKoQ,MAAMuzB,SAMhF,OAJAA,EAAWA,EAAStxB,QAAQlO,GAClBA,EAAE7E,MAAQU,KAAKoQ,MAAMozB,eAAkBr/B,EAAEg+B,IAAII,YAAcp+B,EAAEg+B,IAAIsE,aAIzE,yBAAKta,UAAU,mBACb,yBAAKA,UAAU,kBACb,yBAAKA,UAAU,sBACb,6BAAK,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,aAAckpB,eAAc,8BACnDma,WAAW,oEACb,6BAAK,uBAAGlR,KAAK,IAAInJ,QAASrsB,KAAKmmC,aAAa,uBAAGha,UAAU,kBAAb,YAE9C,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gCAAiCkpB,eAAc,qCAEhEoa,GAAuB,kBAACvB,GAAD,CACtBS,YAAac,EACbhB,iBAAkB3lC,KAAKomC,yBAE3B,kBAAC,EAAA9Z,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,gDAEpDqa,GAA0B,kBAAC,GAAD,CACzBrW,OAAQvwB,KAAKoQ,MAAMmgB,OACnBoT,SAAUA,EACVM,SAAUjkC,KAAKoQ,MAAM6zB,SACrBkB,iBAAkByB,EAClB9D,YAAY,EACZ0B,YAAY,EACZ7C,iBAAiB,EACjB+C,gBAAiB1kC,KAAKqmC,6BC/ErB,MAAMQ,WAAoB//B,IAAAA,cACvCmlB,SACE,MAAME,EAAY,oBAAsBnsB,KAAKoQ,MAAM02B,MAAQ,SAAW,KACjE9mC,KAAKoQ,MAAMnB,MAAQ,SAAW,KAAOjP,KAAKoQ,MAAM22B,SAAW,YAAc,IAC9E,OAAQ/mC,KAAKoQ,MAAM42B,KACjB,yBAAK7a,UAAWA,GAAW,yBAAKA,UAAU,oBAAgC,MCEjE,MAAM8a,WAAqBngC,IAAAA,UACxChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX96B,OAAQ2P,EAAMsnB,QAGhB13B,KAAKknC,mBAAqBlnC,KAAKknC,mBAAmB3X,KAAKvvB,MAGzD08B,mBAAmBC,GACb38B,KAAKoQ,MAAMsnB,QAAUiF,EAAUjF,QACjC13B,KAAK48B,SAAS,CAACn8B,OAAQT,KAAKoQ,MAAMsnB,SAItCwP,mBAAmBzgC,GACjB,MAAM0hB,EAAQ1hB,EAAEiH,OAAOy5B,MAAM,GAC7BnnC,KAAKoQ,MAAMg3B,eAAejf,EAAM5oB,KAAMy6B,IAAIS,gBAAgBtS,GAAQA,EAAM7oB,MAExEmH,EAAEiH,OAAOnL,MAAQ,GAGnB0pB,SAGE,MAAMob,EAAS,sBAAwB,GAAK9jC,KAAK+jC,UAAU5sB,UAAU,EAAG,GAClEyR,EAAY,iBAAmBnsB,KAAKoQ,MAAMm3B,SAAW,aAAe,IAC1E,OACE,yBAAKpb,UAAWA,GACbnsB,KAAKoQ,MAAMm3B,WAAavnC,KAAKu7B,MAAM96B,OAClC,KACA,uBAAG+0B,KAAK,IAAIrJ,UAAU,eAAeE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMg3B,mBACnF,uBAAGjb,UAAU,kBAAb,UAEHnsB,KAAKu7B,MAAM96B,OACV,yBAAKw3B,IAAKj4B,KAAKoQ,MAAMmgB,OAAOwH,aAAalB,GAAmB72B,KAAKu7B,MAAM96B,OAAQ,UAAW0rB,UAAU,YACpGnsB,KAAKoQ,MAAMm3B,UAAYvnC,KAAKoQ,MAAMm2B,IAChC,yBAAKpa,UAAU,cACb,kBAACsL,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,QAAQ,EACRpH,MAAOtwB,KAAKoQ,MAAMm2B,IAClBre,MAAOloB,KAAKoQ,MAAM8X,SAGtB,yBAAKiE,UAAU,SAASe,GAAxB,IAA4CA,IAC/CltB,KAAKoQ,MAAMm3B,SAAW,KACrB,2BAAOhoC,KAAK,OAAO8D,GAAIgkC,EAAQlb,UAAU,mBACvCqb,OAAO,UAAU1B,SAAU9lC,KAAKknC,qBACnClnC,KAAKoQ,MAAMm3B,SAAW,KACvB,2BAAOE,QAASJ,EAAQlb,UAAU,SAChC,uBAAGA,UAAU,kBAAb,gBAEF,kBAAC0a,GAAD,CAAaG,KAAMhnC,KAAKoQ,MAAMs3B,UAAWZ,OAAO,EAAM73B,OAAO,EAAM83B,UAAU,MC7DrF,MAAMzT,GAAe,CAAC,MAAS,iBAEzBzF,IAAWC,EAAAA,EAAAA,gBAAe,CAC9B6Z,eAAgB,CACdtkC,GAAI,iBACJkpB,eAAgB,CAAF,qCAGhBqb,YAAa,CACXvkC,GAAI,cACJkpB,eAAgB,CAAF,iCAGhBsb,aAAc,CACZxkC,GAAI,eACJkpB,eAAgB,CAAF,mCAOlB,MAAMub,WAAkBhhC,IAAAA,cACtBmlB,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KACnC,IAAImE,EAAS,KACb,OAAIxzB,KAAKoQ,MAAM23B,eAAiB/nC,KAAKoQ,MAAM23B,cAAc1nC,OAAS,GAChEmzB,EAAS,GACTxzB,KAAKoQ,MAAM23B,cAAcz1B,KAAK3F,IAC5B,MAAMu2B,EAAU9T,EAAcvB,GAAS,SAAWlhB,IAC5CwmB,EAAQ,kBAAoBxmB,EAAI,SACtC6mB,EAAO3vB,KAAK,yBAAKsoB,UAAU,gBAAgBlmB,IAAK0G,GAAG,uBAAGwf,UAAWgH,GAAQG,GAAa3mB,IAAMA,GAAhF,IAAwFu2B,OAE/F,oCAAG1P,IAEL,MAIX,UAAeH,EAAAA,EAAAA,YAAWyU,ICvCX,MAAME,WAAiBlhC,IAAAA,cACpChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKioC,aAAejoC,KAAKioC,aAAa1Y,KAAKvvB,MAG7CioC,eACEjoC,KAAKoQ,MAAM01B,SAAS9lC,KAAKoQ,MAAM9Q,MAAOU,KAAKoQ,MAAM83B,SAGnDjc,SACE,OACEjsB,KAAKoQ,MAAM01B,UACc,IAAvB9lC,KAAKoQ,MAAM83B,QACT,uBAAG/b,UAAU,gCAAgCE,QAASrsB,KAAKioC,cAA3D,cACqB,IAAvBjoC,KAAKoQ,MAAM83B,QACT,uBAAG/b,UAAU,gCAAgCE,QAASrsB,KAAKioC,cAA3D,2BACA,uBAAG9b,UAAU,0BAAb,2BAEAnsB,KAAKoQ,MAAM83B,QACT,uBAAG/b,UAAU,kBAAb,aACA,uBAAGA,UAAU,kBAAb,4BCtBG,MAAMgc,WAAmBrhC,IAAAA,cACtCmlB,SACE,OACE,uBAAGuJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMivB,aAC1D,uBAAGlT,UAAU,kBAAb,WCHO,MAAMic,WAAmBthC,IAAAA,cACtChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXyL,MAAM,GAGRhnC,KAAKmxB,KAAOnxB,KAAKmxB,KAAK5B,KAAKvvB,MAG7B08B,mBAAmBC,GACbA,EAAU0L,QAAUroC,KAAKoQ,MAAMi4B,OACjCroC,KAAK48B,SAAS,CACZoK,OAAShnC,KAAKoQ,MAAMi4B,QAK1BlX,OACEnxB,KAAK48B,SAAS,CAACoK,MAAM,IACjBhnC,KAAKoQ,MAAMk4B,cACbtoC,KAAKoQ,MAAMk4B,eAIfrc,SACE,MACMoc,EADQ,CAAC9iB,IAAK,QAASzP,KAAM,UAAWpS,KAAM,QAChC1D,KAAKoQ,MAAMi4B,QAAU,GACnClc,EAAY,YAAckc,EAChC,OACE,yBAAKlc,UAAWA,GACd,yBAAKA,UAAU,QAAO,uBAAGA,UAAU,kBAAkBkc,IACrD,8BACGroC,KAAKoQ,MAAMm4B,KACXvoC,KAAKoQ,MAAMgzB,OACV,oCACO,uBAAG5N,KAAK,IACXrC,MAAO,CAAEqV,WAAY,UACrBnc,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgzB,WAC/CpjC,KAAKoQ,MAAMq4B,aAGhB,MAEJ,yBAAKtc,UAAU,UAAS,kBAACgc,GAAD,CAAY9I,SAAUr/B,KAAKmxB,UC7C5C,MAAMuX,WAAa5hC,IAAAA,cAChChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAK2oC,aAAe3oC,KAAK2oC,aAAapZ,KAAKvvB,MAG7C2oC,aAAaliC,GACXA,EAAEwqB,iBACFjxB,KAAKoQ,MAAMivB,SAASr/B,KAAKoQ,MAAMkgB,MAAOtwB,KAAKoQ,MAAMzB,OAGnDsd,SACE,MAAM/D,EAAQloB,KAAKoQ,MAAM8X,OAASloB,KAAKoQ,MAAMkgB,MACvCnE,EAAYnsB,KAAKoQ,MAAMw4B,QAAU,eAAiB,OACxD,OACE,yBAAKzc,UAAWA,GACbnsB,KAAKoQ,MAAMy4B,SACV,0BAAM1c,UAAU,WAChB,yBAAKA,UAAU,cACb,kBAACsL,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQ13B,KAAKoQ,MAAMsnB,SAAU,EAC7BpH,MAAOtwB,KAAKoQ,MAAMkgB,MAClBpI,MAAOloB,KAAKoQ,MAAM8X,SAGxB,8BAAOA,GACNloB,KAAKoQ,MAAMivB,WAAar/B,KAAKoQ,MAAM41B,SAClC,uBAAGxQ,KAAK,IAAInJ,QAASrsB,KAAK2oC,cAA1B,KACE,0BAAMxc,UAAU,aC3Bb,MAAM2c,WAAkBhiC,IAAAA,UACrChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQuN,GAAUC,qBAAqB34B,GAC5CpQ,KAAKu7B,MAAMtzB,MAAQ,GACnBjI,KAAKu7B,MAAMyN,SAAU,EAErBhpC,KAAKipC,gBAAkBjpC,KAAKipC,gBAAgB1Z,KAAKvvB,MACjDA,KAAKkpC,aAAelpC,KAAKkpC,aAAa3Z,KAAKvvB,MAC3CA,KAAKmpC,iBAAmBnpC,KAAKmpC,iBAAiB5Z,KAAKvvB,MACnDA,KAAKopC,kBAAoBppC,KAAKopC,kBAAkB7Z,KAAKvvB,MACrDA,KAAKqpC,gBAAkBrpC,KAAKqpC,gBAAgB9Z,KAAKvvB,MACjDA,KAAK0lC,cAAgB1lC,KAAK0lC,cAAcnW,KAAKvvB,MAGpB,4BAACoQ,GAC1B,MAAO,CACLy1B,YAAaz1B,EAAMk5B,MAAQ,GAAKl5B,EAAMm5B,OACtCC,YAAaV,GAAUW,UAAUr5B,EAAMk5B,MAAOl5B,EAAMs5B,eACpDC,UAAWb,GAAUc,WAAWx5B,EAAMk5B,QAI1C5M,mBAAmBC,EAAWkN,GACxBlN,EAAU2M,OAAStpC,KAAKoQ,MAAMk5B,OAChC3M,EAAU+M,eAAiB1pC,KAAKoQ,MAAMs5B,eACtC/M,EAAU4M,QAAUvpC,KAAKoQ,MAAMm5B,QAC/BvpC,KAAK48B,SAASkM,GAAUC,qBAAqB/oC,KAAKoQ,UAE/Cy5B,GAAa7pC,KAAKoQ,MAAMk5B,MAAMjpC,OAASwpC,EAAUL,YAAYnpC,SAChEL,KAAK48B,SAAS,CAAC30B,MAAO,KAKT,kBAACqhC,GAChB,MAAM36B,EAAQ,GACd,IAAI8jB,EAAQ,EAKZ,OAJA6W,EAAMh3B,KAAK+e,IACT1iB,EAAM0iB,EAAKX,MAAQ+B,EACnBA,OAEK9jB,EAIO,iBAAC26B,EAAOQ,GACtB,MAAM9D,EAAW,GACX+D,EAAS,GAQf,OAPAT,EAAMh3B,KAAK+e,IACLyY,GAAQA,EAAK98B,SAASqkB,EAAKX,MAC7BsV,EAASniC,KAAKwtB,GAEd0Y,EAAOlmC,KAAKwtB,MAGT2U,EAASpF,OAAOmJ,GAGzBd,gBAAgBxiC,GACdzG,KAAK48B,SAAS,CAAC30B,MAAOxB,EAAEiH,OAAOnL,QAC3BvC,KAAKoQ,MAAMwzB,YACb5jC,KAAKoQ,MAAMwzB,WAAWn9B,EAAEiH,OAAOnL,OAInC2mC,aAAa5P,GACX,MAAM0Q,EAAUhqC,KAAKu7B,MAAMiO,YAAYlQ,GACvCt5B,KAAKoQ,MAAM65B,cAAcD,EAAQtZ,KAAM1wB,KAAKu7B,MAAMoO,UAAUK,EAAQtZ,OAGtEyY,iBAAiB9X,EAAMiI,GACrBt5B,KAAKkpC,aAAa5P,GAGpB8P,oBACEppC,KAAK48B,SAAS,CAACoM,SAAS,IAG1BK,kBACErpC,KAAK48B,SAAS,CAACoM,SAAS,IACpBhpC,KAAKoQ,MAAM85B,aACblqC,KAAKoQ,MAAM85B,YAAYlqC,KAAKu7B,MAAMtzB,OAItCy9B,cAAcj/B,GACZ,GAAc,cAAVA,EAAER,KACJ,GAA+B,GAA3BjG,KAAKu7B,MAAMtzB,MAAM5H,QAAeL,KAAKu7B,MAAMiO,YAAYnpC,OAAS,EAAG,CACrE,MAAMm5B,EAAKx5B,KAAKu7B,MAAMiO,YAAYnpC,OAAS,EACvCL,KAAKu7B,MAAMiO,YAAYhQ,GAAI9I,OAAS1wB,KAAKoQ,MAAMs5B,eACjD1pC,KAAKkpC,aAAa1P,QAGH,UAAV/yB,EAAER,IACPjG,KAAKoQ,MAAM+5B,SACbnqC,KAAKoQ,MAAM+5B,QAAQnqC,KAAKu7B,MAAMtzB,OAEb,WAAVxB,EAAER,KACPjG,KAAKoQ,MAAMivB,UACbr/B,KAAKoQ,MAAMivB,WAKjBpT,SACE,MAAMqd,EAAQ,GACd,IAAI7W,EAAQ,EACZ,MAAMiX,EAAgB1pC,KAAKoQ,MAAMs5B,eAAiB,GAClD1pC,KAAKu7B,MAAMiO,YAAYl3B,KAAK+e,IAC1BiY,EAAMzlC,KACJ,kBAAC6kC,GAAD,CACEnY,OAAQvwB,KAAKoQ,MAAMmgB,OACnB8O,SAAUr/B,KAAKmpC,iBACfzR,OAAQW,GAAahH,EAAK2S,OAAS3S,EAAK2S,OAAO7N,MAAQ,MACvDjO,MAAOmJ,EAAK2S,OAAS3S,EAAK2S,OAAO9mB,QAAKlc,EACtC6nC,SAAU7oC,KAAKoQ,MAAMg6B,eACrB9Z,MAAOe,EAAKX,KACZsV,SAAU0D,EAAc18B,SAASqkB,EAAKX,MACtCkY,QAASvX,EAAKuX,QACdj6B,MAAO8jB,EACPxsB,IAAKorB,EAAKX,QAEd+B,OAEF,MAAMtG,EAAY,cAAgBnsB,KAAKu7B,MAAMyN,QAAU,WAAa,IAC9D/C,IAAcjmC,KAAKoQ,MAAMi6B,SAAW,GAC1C,OACE,yBAAKle,UAAWA,GACbmd,EACD,2BAAO/pC,KAAK,OACVsmC,YAAa7lC,KAAKu7B,MAAMsK,YACxBC,SAAU9lC,KAAKipC,gBACfqB,QAAStqC,KAAKopC,kBACdmB,OAAQvqC,KAAKqpC,gBACbtD,UAAW/lC,KAAK0lC,cAChBnjC,MAAOvC,KAAKu7B,MAAMtzB,MAClBoiC,SAAUrqC,KAAKoQ,MAAMi6B,SACrBpE,UAAWA,MC3IrB,MAAMpY,IAAWC,EAAAA,EAAAA,gBAAe,CAC9B0c,YAAa,CACXnnC,GAAI,cACJkpB,eAAgB,CAAF,4CAGhBke,yBAA0B,CACxBpnC,GAAI,2BACJkpB,eAAgB,CAAF,mFAKlB,MAAMme,WAAqB5jC,IAAAA,UACzBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CAEXoP,QAASv6B,EAAMu6B,QACfh8B,MAAO+7B,GAAaE,aAAax6B,EAAMu6B,SACvCjB,cAAegB,GAAahB,cAAct5B,EAAMu6B,QAASv6B,EAAMy6B,mBAAoBz6B,EAAM06B,gBACzFC,cAAe,GACfC,kBAAmB56B,EAAMif,KAAKD,cAAcvB,GAAS2c,aACrDS,iBAAkBP,GAAaO,iBAAiB76B,EAAMu6B,UAGxD3qC,KAAKqmC,sBAAwBrmC,KAAKqmC,sBAAsB9W,KAAKvvB,MAC7DA,KAAKkrC,oBAAsBlrC,KAAKkrC,oBAAoB3b,KAAKvvB,MACzDA,KAAKmrC,oBAAsBnrC,KAAKmrC,oBAAoB5b,KAAKvvB,MACzDA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAK2oC,aAAe3oC,KAAK2oC,aAAapZ,KAAKvvB,MAG1B,oBAAC2qC,GAClB,IAAIh8B,EAAQ,GAIZ,OAHAg8B,EAAQr4B,KAAK+4B,IACX18B,EAAM08B,EAAE3a,MAAQ,CAAC4a,MAAO,EAAGC,SAAS,MAE/B58B,EAGW,qBAACg8B,EAASa,EAAaV,GACzC,IAAIW,EAAO,GAMX,OALAd,EAAQr4B,KAAK+4B,KACPG,GAAeH,EAAE3a,MAAQoa,IAC3BW,EAAK5nC,KAAKwnC,EAAE3a,SAGT+a,EAGc,wBAACd,GACtB,IAAIe,EAAM,GAIV,OAHAf,EAAQr4B,KAAK+4B,IACXK,EAAI7nC,KAAKwnC,EAAE3a,SAENgb,EAGTrF,sBAAsBzR,EAAQjmB,GAC5B,IAAI2N,EAAStc,KAAKu7B,MAAM5sB,MAAMimB,GAC9B,GAAItY,EAAQ,CACV,GAAIA,EAAOivB,QAET,OAEFjvB,EAAOgvB,OAAS,EAChBhvB,EAAOivB,SAAU,OAEjBjvB,EAAS,CAACgvB,MAAO,EAAGC,SAAS,GAG/B,IAAIF,EAAIrrC,KAAKu7B,MAAMoP,QAAQlnC,QAC3B4nC,EAAExnC,KAAK7D,KAAKoQ,MAAMuzB,SAASh1B,IAE3B,MAAM+8B,EAAMhB,GAAaO,iBAAiBI,GAEpCppC,EAAIjC,KAAKu7B,MAAM5sB,MACrB1M,EAAE2yB,GAAUtY,EAEZtc,KAAK48B,SAAS,CAAC+N,QAASU,EAAG18B,MAAO1M,EAAGgpC,iBAAkBS,IAGzDR,oBAAoBtW,EAAQjmB,GAC1B,MAAM2N,EAAStc,KAAKu7B,MAAM5sB,MAAMimB,GAChC,IAAKtY,IAAWA,EAAOivB,QACrB,OAEFjvB,EAAOivB,SAAU,EACjBjvB,EAAOgvB,OAAS,EAEhB,IAAID,EAAIrrC,KAAKu7B,MAAMoP,QAAQlnC,QAC3B4nC,EAAEM,OAAOh9B,EAAO,GAEhB,MAAM+8B,EAAMhB,GAAaO,iBAAiBI,GAEpCppC,EAAIjC,KAAKu7B,MAAM5sB,MACrB1M,EAAE2yB,GAAUtY,EAEZtc,KAAK48B,SAAS,CAAC+N,QAASU,EAAG18B,MAAO1M,EAAGgpC,iBAAkBS,IAGzDP,oBAAoB31B,GAClB,MAAM,cAAC4Z,GAAiBpvB,KAAKoQ,MAAMif,KAC7B4C,EAAOzc,EAEX4Z,EAAcvB,GAAS4c,yBAA0B,CAAC7E,MAAOpwB,IADzD4Z,EAAcvB,GAAS2c,aAGzBxqC,KAAK48B,SAAS,CAACmO,cAAev1B,EAAKw1B,kBAAmB/Y,IAG/B,0BAAC5f,EAAQF,GAChC,GAAIE,EAAQ,CACV,IAAK,IAAIpQ,EAAE,EAAGA,EAAEkQ,EAAO9R,OAAQ4B,IAC7B,GAAIkQ,EAAOlQ,GAAGm0B,QAAQ/jB,IAAW,EAC/B,OAAO,EAGX,OAAO,EAET,OAAO,EAGT+4B,eACE,IAAI95B,EAAWtR,KACX2qC,EAAU,GACViB,EAAQ,GACR5B,EAAU,GAEHpqC,OAAOiN,KAAK7M,KAAKu7B,MAAM5sB,OAC7B2D,KAAI,SAASvF,GACZuE,EAASiqB,MAAM5sB,MAAM5B,GAAGw+B,SAC1BZ,EAAQ9mC,KAAKkJ,GAGXuE,EAASiqB,MAAM5sB,MAAM5B,GAAGu+B,MAAQ,EAClCM,EAAM/nC,KAAKkJ,GACFuE,EAASiqB,MAAM5sB,MAAM5B,GAAGu+B,MAAQ,GACzCtB,EAAQnmC,KAAKkJ,MAGjB/M,KAAKoQ,MAAMy7B,SAASlB,EAASiB,EAAO5B,GAGtCrB,eACE3oC,KAAKoQ,MAAMivB,WAGbpT,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KACnC,OACE,yBAAKhsB,GAAG,iBACN,yBAAK8oB,UAAU,kBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,qCAG7D,yBAAKJ,UAAU,kBACb,kBAAC2c,GAAD,CACEvY,OAAQvwB,KAAKoQ,MAAMmgB,OACnB+Y,MAAOtpC,KAAKu7B,MAAMoP,QAClBjB,cAAe1pC,KAAKu7B,MAAMmO,cAC1BH,OAAO,cACP3F,WAAY5jC,KAAKmrC,oBACjBlB,cAAejqC,KAAKkrC,uBAExB,yBAAK/e,UAAU,kBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,oCAI5D,kBAAC,GAAD,CACEgE,OAAQvwB,KAAKoQ,MAAMmgB,OACnBoT,SAAU3jC,KAAKoQ,MAAMuzB,SACrBM,SAAUjkC,KAAKoQ,MAAM6zB,SACrBT,cAAexjC,KAAKu7B,MAAM0P,iBAC1B54B,OAAQrS,KAAKu7B,MAAMwP,cACnBnH,WAAY8G,GAAaoB,mBACzB3G,iBAAkBnlC,KAAKu7B,MAAMyP,kBAC7BlI,YAAY,EACZ0B,YAAY,EACZE,gBAAiB1kC,KAAKqmC,wBACxB,yBAAKhjC,GAAG,wBAAwB8oB,UAAU,kBACxC,4BAAQA,UAAU,YAAYE,QAASrsB,KAAK2oC,cAC1C,kBAAC,EAAArc,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,6BAErD,4BAAQJ,UAAU,UAAUE,QAASrsB,KAAKorC,cACxC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,4BAQ3D,UAAe8G,EAAAA,EAAAA,YAAWqX,ICjMpB7c,IAAWC,EAAAA,EAAAA,gBAAe,CAC9Bie,OAAQ,CACN1oC,GAAI,kBACJkpB,eAAgB,CAAF,kEAGhBprB,OAAQ,CACNkC,GAAI,kBACJkpB,eAAgB,CAAF,kEAGhByf,OAAQ,CACN3oC,GAAI,mBACJkpB,eAAgB,CAAF,mEAGhB0f,OAAQ,CACN5oC,GAAI,kBACJkpB,eAAgB,CAAF,0EAGhB2f,SAAU,CACR7oC,GAAI,mBACJkpB,eAAgB,CAAF,qEAGhB4f,OAAQ,CACN9oC,GAAI,mBACJkpB,eAAgB,CAAF,mEAGhB6f,QAAS,CACP/oC,GAAI,oBACJkpB,eAAgB,CAAF,oEAGhB8f,MAAO,CACLhpC,GAAI,mBACJkpB,eAAgB,CAAF,qEAKlB,MAAM+f,WAA0BxlC,IAAAA,UAC9BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXvtB,MAAOoC,EAAMpC,MAAQ,IAAI3D,QAAQ,IAAK,KAGxCrK,KAAKioC,aAAejoC,KAAKioC,aAAa1Y,KAAKvvB,MAC3CA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAK2oC,aAAe3oC,KAAK2oC,aAAapZ,KAAKvvB,MAG7CioC,aAAazyB,GACX,IAAIxH,EAAOhO,KAAKu7B,MAAMvtB,MAEV,GADAA,EAAKooB,QAAQ5gB,GAEvBxH,GAAQwH,EAERxH,EAAOA,EAAK3D,QAAQmL,EAAK,IAE3BxV,KAAK48B,SAAS,CAAC5uB,KAAMA,IAGvBo9B,eAEE,MAAMp9B,GAAQhO,KAAKu7B,MAAMvtB,MAAQ,KAAK4sB,MAAM,IAAItE,OAAOptB,KAAK,IAExD8E,KADYhO,KAAKoQ,MAAMpC,MAAQ,KAAK4sB,MAAM,IAAItE,OAAOptB,KAAK,IAE5DlJ,KAAKoQ,MAAMy7B,SAAS79B,GAEpBhO,KAAKoQ,MAAMivB,WAIfsJ,eACE3oC,KAAKoQ,MAAMivB,WAGbpT,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KAC7Bjd,EAAM,WACNm6B,EAAQ,CACZ,EAAKnd,EAAcvB,GAASke,OAAQ,CAACv2B,IAAK,MAC1C,EAAK4Z,EAAcvB,GAAS1sB,OAAQ,CAACqU,IAAK,MAC1C,EAAK4Z,EAAcvB,GAASme,OAAQ,CAACx2B,IAAK,MAC1C,EAAK4Z,EAAcvB,GAASoe,OAAQ,CAACz2B,IAAK,MAC1C,EAAK4Z,EAAcvB,GAASqe,SAAU,CAAC12B,IAAK,MAC5C,EAAK4Z,EAAcvB,GAASse,OAAQ,CAAC32B,IAAK,MAC1C,EAAK4Z,EAAcvB,GAASue,QAAS,CAAC52B,IAAK,MAC3C,EAAK4Z,EAAcvB,GAASwe,MAAO,CAAC72B,IAAK,OAG3C,IAAIg3B,EAAOxsC,KAAKoQ,MAAMo8B,MAAQ,GAC1Bx+B,EAAOhO,KAAKu7B,MAAMvtB,KAClBy+B,GAAWzsC,KAAKoQ,MAAMq8B,SAAW,IAAIpiC,QAAQ,IAAK,IAClDinB,EAAQ,GACZ,IAAK,IAAIrvB,EAAE,EAAGA,EAAEmQ,EAAI/R,OAAQ4B,IAAK,CAC/B,IAAIkC,EAAIiO,EAAIpI,OAAO/H,GACfuqC,EAAKpW,QAAQjyB,IAAM,GAAK6J,EAAKooB,QAAQjyB,GAAK,GAI9CmtB,EAAMztB,KACJ,wBAAIoC,IAAK9B,GACP,4BAAKooC,EAAMpoC,IACX,wBAAIgoB,UAAU,YAAYqgB,EAAKpW,QAAQjyB,GAAK,EAC1C,kBAAC6jC,GAAD,CAAU1oC,KAAM6E,EAAG+jC,QAAUl6B,EAAKooB,QAAQjyB,IAAM,EAAI2hC,SAAU9lC,KAAKioC,eAEnE,kBAACD,GAAD,CAAU1oC,KAAM6E,EAAG+jC,QAAUl6B,EAAKooB,QAAQjyB,IAAM,KAC3CnE,KAAKoQ,MAAMq8B,QAAU,wBAAItgB,UAAU,YACxC,kBAAC6b,GAAD,CAAU1oC,KAAM6E,EAAG+jC,QAAUuE,EAAQrW,QAAQjyB,IAAM,KAC7C,OAKd,OACE,yBAAKgoB,UAAU,qBACZnsB,KAAKoQ,MAAMs8B,UACV,wBAAIvgB,UAAU,qBAAoB,kBAAC,GAAD,CAChCoE,OAAQvwB,KAAKoQ,MAAMmgB,OACnBc,KAAMrxB,KAAKoQ,MAAMihB,KACjBnJ,MAAOloB,KAAKoQ,MAAMs8B,UAClBzJ,OAAO,EACPvL,OAAQW,GAAar4B,KAAKoQ,MAAMu8B,WAAa3sC,KAAKoQ,MAAMu8B,WAAa,SAAiB,KAC1F,2BAAOxgB,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAC3CkpB,eAAc,kCAChB,2BAAOJ,UAAU,qBAChBnsB,KAAKoQ,MAAMq8B,QACV,+BAAO,4BACL,6BAAS,4BAAKzsC,KAAKoQ,MAAMw8B,WACzB,4BAAK5sC,KAAKoQ,MAAMy8B,gBAElB,KACF,+BACGvb,IAEH,6BACA,yBAAKnF,UAAU,kBACb,4BAAQA,UAAU,UAAUE,QAASrsB,KAAK2oC,cACxC,kBAAC,EAAArc,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,6BAErD,4BAAQJ,UAAU,UAAUE,QAASrsB,KAAKorC,cACxC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,4BAQ3D,UAAe8G,EAAAA,EAAAA,YAAWiZ,IChKX,MAAMQ,WAAgBhmC,IAAAA,UACnChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CAEXwR,KAAM,EACNC,KAAM,EAENC,QAAS,EACTC,QAAS,EAETC,KAAM,EAENC,QAAS,EACTC,QAjBmB,KAsBrBrtC,KAAKstC,QAAUxmC,IAAAA,YAEf9G,KAAKutC,OAASzmC,IAAAA,YAEd9G,KAAKs7B,QAAUx0B,IAAAA,YAEf9G,KAAKwtC,YAAc1mC,IAAAA,YAGnB9G,KAAKytC,WAAa,EAClBztC,KAAK0tC,YAAc,EAGnB1tC,KAAK2tC,OAAS,EACd3tC,KAAK4tC,OAAS,EAEd5tC,KAAK6tC,aAAe,EAGpB7tC,KAAK8tC,WAAa,GAClB9tC,KAAK+tC,SAAW,GAEhB/tC,KAAKitC,QAAU,EACfjtC,KAAKktC,QAAU,EAEfltC,KAAKguC,YAAchuC,KAAKguC,YAAYze,KAAKvvB,MACzCA,KAAKiuC,OAASjuC,KAAKiuC,OAAO1e,KAAKvvB,MAC/BA,KAAKkuC,WAAaluC,KAAKkuC,WAAW3e,KAAKvvB,MACvCA,KAAKmuC,UAAYnuC,KAAKmuC,UAAU5e,KAAKvvB,MACrCA,KAAKouC,QAAUpuC,KAAKouC,QAAQ7e,KAAKvvB,MACjCA,KAAKquC,UAAYruC,KAAKquC,UAAU9e,KAAKvvB,MACrCA,KAAKsuC,WAAatuC,KAAKsuC,WAAW/e,KAAKvvB,MACvCA,KAAKuuC,YAAcvuC,KAAKuuC,YAAYhf,KAAKvvB,MACzCA,KAAKwuC,UAAYxuC,KAAKwuC,UAAUjf,KAAKvvB,MAGvC4wB,oBACE5wB,KAAKstC,QAAQtc,QAAQlF,iBAAiB,YAAa9rB,KAAKmuC,UAAW,CAAEM,SAAS,IAC9EzuC,KAAKstC,QAAQtc,QAAQlF,iBAAiB,aAAc9rB,KAAKmuC,UAAW,CAAEM,SAAS,IAG/EzuC,KAAK+tC,SAAW/tC,KAAKwtC,YAAYxc,QAAQ4N,wBAEzC5+B,KAAKitC,QAAUjtC,KAAK+tC,SAASvV,MAAQ,EACrCx4B,KAAKktC,QAAUltC,KAAK+tC,SAAStV,OAAS,EAGtCz4B,KAAK8tC,WAAa9tC,KAAKutC,OAAOvc,QAAQ4N,wBAGxC9N,uBACE9wB,KAAKstC,QAAQtc,QAAQD,oBAAoB,YAAa/wB,KAAKmuC,WAC3DnuC,KAAKstC,QAAQtc,QAAQD,oBAAoB,aAAc/wB,KAAKmuC,WAI9DI,YAAYxB,EAAMC,EAAMG,GAEtBntC,KAAK48B,SAAS,CACZmQ,KAAMA,EACNC,KAAMA,EACNG,KAAMA,EACNF,QAASjtC,KAAKitC,QAAUF,EACxBG,QAASltC,KAAKktC,QAAUF,IAI1B,MAAMpa,GAAQ5yB,KAAKitC,QAAUF,GAAQI,EAAOntC,KAAKitC,QAC3Cja,GAAOhzB,KAAKktC,QAAUF,GAAQG,EAAOntC,KAAKktC,QAChDltC,KAAKoQ,MAAM01B,UACRlT,EAAO5yB,KAAK8tC,WAAWlb,KAAO5yB,KAAK+tC,SAASnb,MAAQua,GACpDna,EAAMhzB,KAAK8tC,WAAW9a,IAAMhzB,KAAK+tC,SAAS/a,KAAOma,EAClDntC,KAAK8tC,WAAWtV,MAAQ2U,EACxBntC,KAAK8tC,WAAWrV,OAAS0U,EACzBA,GAIa,kBAACuB,EAAS9U,EAAK2T,EAAQjC,GACtC,IAAIqD,EAAWprC,KAAKC,IAAI,EAAG+pC,EAAO,GAAK3T,EAAI,GAAK0R,EAAO1R,EAAI,GAAK2T,EAAO,GAAKjC,GAQ5E,OAPgB,GAAZqD,GAGOprC,KAAKC,IAAI,EAAG+pC,EAAO,GAAK3T,EAAI,GAAIA,EAAI,GAAK2T,EAAO,IAAMoB,KAD/DD,GAAWpD,GAKNoD,EAGTV,cAEE,MAAMY,EAAU5uC,KAAKs7B,QAAQtK,QAAQ4N,wBAErC5+B,KAAKytC,WAAamB,EAAQpW,MAC1Bx4B,KAAK0tC,YAAckB,EAAQnW,OAG3B,MAAM2U,EAAU7pC,KAAKg6B,IAAIv9B,KAAK8tC,WAAWtV,MAAQoW,EAAQpW,MAAOx4B,KAAK8tC,WAAWrV,OAASmW,EAAQnW,QACjGz4B,KAAK48B,SAAS,CACZwQ,QAASA,EACTC,QAAS9pC,KAAKg6B,IA3HK,IA2HiB6P,EAAU,KAIhD,MAAMD,EAAO5pC,KAAKg6B,IAAIv9B,KAAK+tC,SAASvV,MAAQoW,EAAQpW,MAAOx4B,KAAK+tC,SAAStV,OAASmW,EAAQnW,QAEpFsU,EAAO/sC,KAAK8tC,WAAWlb,KAAO5yB,KAAK+tC,SAASnb,MAC/Cgc,EAAQpW,MAAQx4B,KAAK8tC,WAAWtV,OAAS,EACtCwU,EAAOhtC,KAAK8tC,WAAW9a,IAAMhzB,KAAK+tC,SAAS/a,KAC9C4b,EAAQnW,OAASz4B,KAAK8tC,WAAWrV,QAAU,EAE9Cz4B,KAAKuuC,YAAYxB,EAAMC,EAAMG,GAG/Bc,OAAOxnC,GACLzG,KAAKkuC,WAAWznC,EAAEiH,OAAOnL,OAG3B2rC,WAAWf,GACT,IAAIJ,EAAO/sC,KAAKu7B,MAAMwR,KAClBC,EAAOhtC,KAAKu7B,MAAMyR,KAItB,MAAM6B,EAAU7uC,KAAKitC,SAAWjtC,KAAKitC,QAAUF,GAAQI,EACjD2B,EAAWD,EAAU7uC,KAAKytC,WAAaN,EAEvC4B,EAAS/uC,KAAK8tC,WAAWlb,KAAO5yB,KAAK+tC,SAASnb,KAC9Coc,EAAUD,EAAS/uC,KAAK8tC,WAAWtV,MACrCuW,EAASF,EACX9B,GAAQ8B,EAAUE,EACTC,EAAUF,IACnB/B,GAAQiC,EAAUF,GAEpB,MAAMG,EAASjvC,KAAKktC,SAAWltC,KAAKktC,QAAUF,GAAQG,EAChD+B,EAAYD,EAASjvC,KAAK0tC,YAAcP,EACxCgC,EAAQnvC,KAAK8tC,WAAW9a,IAAMhzB,KAAK+tC,SAAS/a,IAC5Coc,EAAWD,EAAQnvC,KAAK8tC,WAAWrV,OACrC0W,EAAQF,EACVjC,GAAQiC,EAASE,EACRC,EAAWF,IACpBlC,GAAQoC,EAAWF,GAGrBlvC,KAAKuuC,YAAYxB,EAAMC,EAAMG,GAG/BgB,UAAU1nC,GACJA,EAAE4oC,SACJrvC,KAAK2tC,OAASlnC,EAAE4oC,QAAQ,GAAGxN,MAC3B7hC,KAAK4tC,OAASnnC,EAAE4oC,QAAQ,GAAGzN,QAE3B5hC,KAAK2tC,OAASlnC,EAAEo7B,MAChB7hC,KAAK4tC,OAASnnC,EAAEm7B,OAGlBl7B,OAAOolB,iBAAiB,YAAa9rB,KAAKquC,UAAW,CAAEI,SAAS,IAChE/nC,OAAOolB,iBAAiB,YAAa9rB,KAAKsuC,WAAY,CAAEG,SAAS,IACjE/nC,OAAOolB,iBAAiB,UAAW9rB,KAAKouC,QAAS,CAAEK,SAAS,IAC5D/nC,OAAOolB,iBAAiB,WAAY9rB,KAAKouC,QAAS,CAAEK,SAAS,IAE7D5d,SAAStQ,KAAK4S,MAAd,WAAoC,OAItCqb,UAAU3M,EAAOD,GACf,MAAM0N,EAAKzN,EAAQ7hC,KAAK2tC,OAClB4B,EAAK3N,EAAQ5hC,KAAK4tC,OAExB5tC,KAAK2tC,OAAS9L,EACd7hC,KAAK4tC,OAAShM,EAGd,MAAMgN,EAAU5uC,KAAKs7B,QAAQtK,QAAQ4N,wBAGrC,IAAImO,EAAOD,GAAQ0C,WAAWxvC,KAAKu7B,MAAMwR,KAAM,CAAC6B,EAAQhc,KAAMgc,EAAQ9b,OACpE,CAAC9yB,KAAK8tC,WAAWlb,KAAM5yB,KAAK8tC,WAAWhb,OAAQwc,GAC7CtC,EAAOF,GAAQ0C,WAAWxvC,KAAKu7B,MAAMyR,KAAM,CAAC4B,EAAQ5b,IAAK4b,EAAQ3b,QACnE,CAACjzB,KAAK8tC,WAAW9a,IAAKhzB,KAAK8tC,WAAW7a,QAASsc,GAEjDvvC,KAAKuuC,YAAYxB,EAAMC,EAAMhtC,KAAKu7B,MAAM4R,MAI1CkB,UAAU5nC,GACRA,EAAEwqB,iBACFjxB,KAAKwuC,UAAU/nC,EAAEo7B,MAAOp7B,EAAEm7B,OAG5B0M,WAAW7nC,GAGT,GAFAA,EAAEwqB,iBAEsB,GAApBxqB,EAAE4oC,QAAQhvC,OAEZ,YADAL,KAAKwuC,UAAU/nC,EAAE4oC,QAAQ,GAAGxN,MAAOp7B,EAAE4oC,QAAQ,GAAGzN,OAKlD,MAAO6N,EAAQC,GAAUjpC,EAAE4oC,QACrBM,EAAWpsC,KAAKqsC,MAAMH,EAAO5N,MAAQ6N,EAAO7N,QAAU4N,EAAO5N,MAAQ6N,EAAO7N,QAC/E4N,EAAO7N,MAAQ8N,EAAO9N,QAAU6N,EAAO7N,MAAQ8N,EAAO9N,QAEpD5hC,KAAK6tC,eACN7tC,KAAK6tC,aAAe8B,EAAW3vC,KAAKu7B,MAAM4R,MAG9C,IAAItU,EAAS8W,EAAW3vC,KAAK6tC,aAC7B7tC,KAAKkuC,WAAW3qC,KAAKg6B,IAAIv9B,KAAKotC,QAAS7pC,KAAKC,IAAIxD,KAAKqtC,QAASxU,KAGhEuV,QAAQ3nC,GACNC,OAAOqqB,oBAAoB,YAAa/wB,KAAKquC,WAC7C3nC,OAAOqqB,oBAAoB,YAAa/wB,KAAKsuC,YAC7C5nC,OAAOqqB,oBAAoB,UAAW/wB,KAAKouC,SAC3C1nC,OAAOqqB,oBAAoB,WAAY/wB,KAAKouC,SAE5Cvd,SAAStQ,KAAK4S,MAAd,WAAoC,GAEpCnzB,KAAKuuC,YAAYvuC,KAAKu7B,MAAMwR,KAAM/sC,KAAKu7B,MAAMyR,KAAMhtC,KAAKu7B,MAAM4R,MAGhElhB,SAEE,MAAM4jB,EAAM,eAAH,OAAkB7vC,KAAKu7B,MAAMwR,KAA7B,eAAwC/sC,KAAKu7B,MAAMyR,KAAnD,wBAAuEhtC,KAAKu7B,MAAM4R,KAAlF,KAEH2C,EAAO,GAAH,OAAM9vC,KAAKu7B,MAAM0R,QAAjB,cAA8BjtC,KAAKu7B,MAAM2R,QAAzC,MAIJI,EAAU,CACdta,IAAK,GAAF,OAAKhzB,KAAKktC,QAAUltC,KAAKu7B,MAAM2R,QAAUltC,KAAKu7B,MAAM4R,KAApD,MACHva,KAAM,GAAF,OAAK5yB,KAAKitC,QAAUjtC,KAAKu7B,MAAM0R,QAAUjtC,KAAKu7B,MAAM4R,KAApD,MACJ3U,MAAO,GAAF,OAAKx4B,KAAKytC,WAAaztC,KAAKu7B,MAAM4R,KAAlC,MACL1U,OAAQ,GAAF,OAAKz4B,KAAK0tC,YAAc1tC,KAAKu7B,MAAM4R,KAAnC,OAER,OACE,yBAAKhhB,UAAU,WACb,yBAAKA,UAAU,eAAeiH,IAAKpzB,KAAKwtC,aACtC,yBAAKvV,IAAKj4B,KAAKoQ,MAAM3P,OAAQ0rB,UAAU,UAAU6L,IAAI,GACnD7E,MAAO,CAAC4c,UAAWF,EAAKG,gBAAiBF,GAAO1c,IAAKpzB,KAAKs7B,QAAS2U,OAAQjwC,KAAKguC,cAClF,yBAAK7hB,UAAU,gBAAgBiH,IAAKpzB,KAAKutC,SACzC,yBAAKphB,UAAU,UAAUgH,MAAOma,EAASla,IAAKpzB,KAAKstC,WAErD,yBAAKnhB,UAAU,gBACb,2BAAO5sB,KAAK,QAAQ4sB,UAAU,SAC5B+jB,KAAK,QAAQ1sC,IAAKxD,KAAKu7B,MAAM6R,QAAS7P,IAAKv9B,KAAKu7B,MAAM8R,QAAS9qC,MAAOvC,KAAKu7B,MAAM4R,KAAMrH,SAAU9lC,KAAKiuC,YC1QnG,MAAMkC,WAAmBrpC,IAAAA,cACtChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXvI,IAAK,EACLJ,KAAM,EACN4F,MAAO,EACPC,OAAQ,EACRI,MAAO,GAGT74B,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAKioC,aAAejoC,KAAKioC,aAAa1Y,KAAKvvB,MAI7CioC,aAAarV,EAAMI,EAAKwF,EAAOC,EAAQI,GACrC74B,KAAK48B,SAAS,CACZhK,KAAMA,EACNI,IAAKA,EACLwF,MAAOA,EACPC,OAAQA,EACRI,MAAOA,IAIXuS,etBsGK,IAAmB7T,EAAM6Y,EAAQxd,EAAMI,EAAKwF,EAAOC,EAAQI,GAAxCtB,EsBrGZv3B,KAAKoQ,MAAMmnB,KtBqGO6Y,EsBrGDpwC,KAAKoQ,MAAMsnB,OtBqGF9E,EsBpGlC5yB,KAAKu7B,MAAM3I,KtBoG6BI,EsBpGvBhzB,KAAKu7B,MAAMvI,ItBoGiBwF,EsBpGZx4B,KAAKu7B,MAAM/C,MtBoGQC,EsBpGDz4B,KAAKu7B,MAAM9C,OtBoGFI,EsBnG5D74B,KAAKu7B,MAAM1C,MtBoGR,IAAI53B,SAAQ,CAACC,EAASqJ,KAC3B,MAAMqvB,EAAM,IAAIC,MAChBD,EAAIE,YAAc,YAClBF,EAAIpuB,QAAW+Z,IACbhb,EAAO,IAAIlC,MAAM,+BAEnBuxB,EAAIG,OAAS,KAEXC,IAAIC,gBAAgBL,EAAI3B,KAExB,IAAIkC,EAAStJ,SAASyE,cAAc,UACpC6E,EAAO3B,MAAQA,EAAQK,EACvBsB,EAAO1B,OAASA,EAASI,EACzB,IAAIuB,EAAMD,EAAOE,WAAW,MAC5BD,EAAIE,uBAAwB,EAC5BF,EAAIG,UAAUX,EAAKhH,EAAMI,EAAKwF,EAAOC,EAAQ,EAAG,EAAG0B,EAAO3B,MAAO2B,EAAO1B,QAExElB,EAAOY,GAAwBnrB,SAASuqB,GAAQA,EAAO,aAEvD4C,EAAOz4B,QAAQd,IAEbu5B,EAAS,KACLv5B,EACFM,EAAQ,CAACq2B,KAAMA,EAAM32B,KAAMA,EAAM43B,MAAOA,EAAOC,OAAQA,IAEvDluB,EAAO,IAAIlC,MAAM,+BAElBkvB,IAELqC,EAAI3B,IAAMmY,MsBhIPn3B,MAAK2gB,IACJ55B,KAAKoQ,MAAMy7B,SAASjS,EAAIrC,KAAMqC,EAAIh5B,KAAMg5B,EAAIpB,MAAOoB,EAAInB,WAExD9tB,OAAM4a,IACLvlB,KAAKoQ,MAAMshB,QAAQnM,MAIzB0G,SACE,OACE,yBAAKE,UAAU,cACb,yBAAKA,UAAU,kBACb,kBAAC2gB,GAAD,CACErsC,OAAQT,KAAKoQ,MAAMsnB,OACnBoO,SAAU9lC,KAAKioC,gBAEnB,yBAAK9b,UAAU,kBACZnsB,KAAKoQ,MAAMivB,SACV,4BAAQlT,UAAU,YAAYE,QAASrsB,KAAKoQ,MAAMivB,UAChD,kBAAC,EAAA/S,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,6BAEnD,KACJ,4BAAQJ,UAAU,UAAUE,QAASrsB,KAAKorC,cACxC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,4BC1D5C,MAAM8jB,WAAwBvpC,IAAAA,cAC3ChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXh5B,MAAOvC,KAAKoQ,MAAM7N,MAClB2pB,SAAS,GAGXlsB,KAAKswC,iBAAmBtwC,KAAKswC,iBAAiB/gB,KAAKvvB,MACnDA,KAAKuwC,gBAAkBvwC,KAAKuwC,gBAAgBhhB,KAAKvvB,MACjDA,KAAK0lC,cAAgB1lC,KAAK0lC,cAAcnW,KAAKvvB,MAC7CA,KAAKwwC,sBAAwBxwC,KAAKwwC,sBAAsBjhB,KAAKvvB,MAG/DuwC,gBAAgB9pC,GACdzG,KAAK48B,SAAS,CAACr6B,MAAOkE,EAAEiH,OAAOnL,QAC3BvC,KAAKoQ,MAAM01B,UACb9lC,KAAKoQ,MAAM01B,SAASr/B,GAIxB6pC,iBAAiB7pC,GACfA,EAAEwqB,iBACFjxB,KAAK48B,SAAS,CAAC1Q,SAAUlsB,KAAKu7B,MAAMrP,UAGtCwZ,cAAcj/B,GACK,IAAbA,EAAE2qB,SAEJpxB,KAAK48B,SAAS,CAACr6B,MAAOvC,KAAKoQ,MAAM7N,MAAO2pB,SAAS,IAC7ClsB,KAAKoQ,MAAMqgC,YACbzwC,KAAKoQ,MAAMqgC,cAES,IAAbhqC,EAAE2qB,SAEXpxB,KAAKwwC,wBAITA,sBAAsB/pC,GACpB,GAAIA,EAAG,CACL,IAAI8qB,EAAgB9qB,EAAE8qB,cACtBlU,YAAW,KACJkU,EAAcjN,SAASuM,SAAS6f,gBAC/B1wC,KAAKoQ,MAAMqgC,YACbzwC,KAAKoQ,MAAMqgC,WAAWzwC,KAAKu7B,MAAMh5B,SAGpC,QACMvC,KAAKoQ,MAAMqgC,YACpBzwC,KAAKoQ,MAAMqgC,WAAWzwC,KAAKu7B,MAAMh5B,MAAMyzB,QAI3C/J,SACE,OACE,yBAAKoe,SAAS,KAAKle,UAAU,cAC3Boe,OAAQvqC,KAAKwwC,uBACb,2BAAOrkB,UAAU,kBACf5sB,KAAMS,KAAKu7B,MAAMrP,QAAU,OAAS,WACpC3pB,MAAOvC,KAAKu7B,MAAMh5B,MAClBsjC,YAAa7lC,KAAKoQ,MAAMy1B,YACxBG,SAAUhmC,KAAKoQ,MAAM41B,SAAW,WAAa,GAC7CC,UAAWjmC,KAAKoQ,MAAM61B,UAAY,YAAc,GAChD0K,aAAc3wC,KAAKoQ,MAAMugC,aACzB7K,SAAU9lC,KAAKuwC,gBACfxK,UAAW/lC,KAAK0lC,gBAClB,0BAAMrZ,QAASrsB,KAAKswC,kBAClB,uBAAGnkB,UAAU,uCACVnsB,KAAKu7B,MAAMrP,QAAU,aAAe,qBCpElC,MAAM0kB,WAAoB9pC,IAAAA,UACvChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKmvB,QAAUroB,IAAAA,YAEf9G,KAAKu7B,MAAQ,CACXsV,OAAQzgC,EAAMygC,OACdC,aAAc1gC,EAAM7N,OAAS,GAC7BA,MAAO6N,EAAM7N,OAAS,IAGxBvC,KAAKuwC,gBAAkBvwC,KAAKuwC,gBAAgBhhB,KAAKvvB,MACjDA,KAAK0lC,cAAgB1lC,KAAK0lC,cAAcnW,KAAKvvB,MAC7CA,KAAK+wC,mBAAqB/wC,KAAK+wC,mBAAmBxhB,KAAKvvB,MACvDA,KAAKwwC,sBAAwBxwC,KAAKwwC,sBAAsBjhB,KAAKvvB,MAC7DA,KAAKgxC,uBAAyBhxC,KAAKgxC,uBAAuBzhB,KAAKvvB,MAGjE08B,mBAAmBC,EAAWkN,GAG5B,MAAM1qB,EAAWnf,KAAKoQ,MAAM7N,OAAS,GACjCsnC,EAAUiH,cAAgB3xB,GAAa0qB,EAAUgH,QACnD7wC,KAAK48B,SAAS,CACZkU,aAAc3xB,EACd5c,MAAO4c,IAKboxB,gBAAgB9pC,GACdzG,KAAK48B,SAAS,CAACr6B,MAAOkE,EAAEiH,OAAOnL,OAAS,KAG1CmjC,cAAcj/B,GACM,KAAdA,EAAE2qB,QAEJpxB,KAAK48B,SAAS,CAACr6B,MAAOvC,KAAKoQ,MAAM7N,MAAOsuC,QAAQ,IACzB,KAAdpqC,EAAE2qB,SAEXpxB,KAAKwwC,sBAAsB/pC,GAI9BsqC,qBACM/wC,KAAKoQ,MAAMm3B,UACdvnC,KAAK48B,SAAS,CAACiU,QAAQ,IAAO,KACxB7wC,KAAKmvB,QAAQ6B,SACfhxB,KAAKmvB,QAAQ6B,QAAQigB,WAM7BT,sBAAsB/iC,GACpB,MAAMlL,EAAQvC,KAAKu7B,MAAMh5B,MAAMyzB,QAC3Bh2B,KAAKoQ,MAAM41B,UAAcv4B,EAAMC,OAAOwjC,iBAAoB3uC,GAK9DvC,KAAK48B,SAAS,CAACiU,QAAQ,KAClBtuC,GAASvC,KAAKoQ,MAAM7N,QAAWA,IAAUvC,KAAKoQ,MAAM7N,OACvDvC,KAAKoQ,MAAMqgC,WAAWluC,IALtBvC,KAAK48B,SAAS,CAACr6B,MAAOvC,KAAKoQ,MAAM7N,MAAOsuC,QAAQ,IASpDG,uBAAuBzuC,GACrBvC,KAAK48B,SAAS,CAACiU,QAAQ,IACnBtuC,GAAUA,IAAUvC,KAAKoQ,MAAM7N,OACjCvC,KAAKoQ,MAAMqgC,WAAWluC,GAI1B0pB,SACE,IAAKjsB,KAAKu7B,MAAMsV,OAAQ,CACtB,IAAIM,EAA8B,YAAnBnxC,KAAKoQ,MAAM7Q,KAAqB,WAAaS,KAAKu7B,MAAMh5B,MACnE6uC,EAAY,iBAAmBpxC,KAAKoQ,MAAMm3B,SAAW,YAAc,IASvE,OARK4J,IACHA,EAAWnxC,KAAKoQ,MAAMy1B,YACtBuL,GAAa,gBAEVpxC,KAAKoQ,MAAMihC,WAAqC,GAAxBrxC,KAAKoQ,MAAMihC,YACtCD,GAAa,UAGP,0BAAMjlB,UAAWilB,EAAW/kB,QAASrsB,KAAK+wC,oBAChD,8BAAOI,IAIX,IAAIG,EACJ,MAAMxR,EAAO,GAwBb,MAvBuB,YAAnB9/B,KAAKoQ,MAAM7Q,MACb+xC,EAAUjB,GACVvQ,EAAK2Q,WAAazwC,KAAKgxC,yBAEnBhxC,KAAKoQ,MAAMihC,UAAY,GACzBC,EAAU,WACVxR,EAAKyR,KAAOvxC,KAAKoQ,MAAMihC,UACvBvR,EAAK3T,UAAY,iBAEjBmlB,EAAU,QACVxR,EAAKvgC,KAAOS,KAAKoQ,MAAM7Q,MAAQ,QAEjCugC,EAAKv9B,MAAQvC,KAAKu7B,MAAMh5B,MACxBu9B,EAAKgG,SAAW9lC,KAAKuwC,gBACrBzQ,EAAKiG,UAAY/lC,KAAK0lC,cACtB5F,EAAKyK,OAASvqC,KAAKwwC,uBAErB1Q,EAAK+F,YAAc7lC,KAAKoQ,MAAMy1B,YAC9B/F,EAAKkG,SAAWhmC,KAAKoQ,MAAM41B,SAAW,WAAa,GACnDlG,EAAK6Q,aAAe3wC,KAAKoQ,MAAMugC,aAC/B7Q,EAAKmG,WAAY,EACjBnG,EAAK1M,IAAMpzB,KAAKmvB,QAETroB,IAAAA,cAAoBwqC,EAASxR,EAAM,OCjH/B,MAAM0R,WAAmB1qC,IAAAA,UACtChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXkW,KAAMzxC,KAAKoQ,MAAMqhC,MAAQ,GACzBC,SAAU,GACVC,UAAW3xC,KAAKoQ,MAAMuhC,WAGxB3xC,KAAK4xC,eAAiB5xC,KAAK4xC,eAAeriB,KAAKvvB,MAC/CA,KAAK6xC,aAAe7xC,KAAK6xC,aAAatiB,KAAKvvB,MAC3CA,KAAK8xC,gBAAkB9xC,KAAK8xC,gBAAgBviB,KAAKvvB,MACjDA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAK2oC,aAAe3oC,KAAK2oC,aAAapZ,KAAKvvB,MAGd,gCAAC+xC,EAAWlI,GACzC,MAAM4H,EAAOM,EAAUN,MAAQ,GAC/B,OAAKpb,GAAWob,EAAM5H,EAAU4H,OAAU5H,EAAU8H,UAG7C,KAFE,CAACF,KAAMA,GAKlBG,eAAerJ,GAEb,GADAvoC,KAAK48B,SAAS,CAAC8U,SAAUnJ,IACrBA,EAAKloC,OAAS,EAAG,CACnB,MAAM2xC,EAAOzJ,EAAKA,EAAKloC,OAAO,GACf,KAAXkoC,EAAK,GAEHA,EAAKloC,OAAS,GAAa,KAAR2xC,GACrBhyC,KAAK6xC,aAAatJ,EAAK7tB,UAAU,EAAG6tB,EAAKloC,OAAO,IAEjC,KAAR2xC,GAAuB,KAARA,GAAuB,KAARA,GAAuB,KAARA,GAEtDhyC,KAAK6xC,aAAatJ,EAAK7tB,UAAU,EAAG6tB,EAAKloC,OAAO,GAAG21B,SAKzD6b,aAAaI,GACX,MAAMC,EAAclyC,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,chCtB5B,IgCwBzB,GAAIF,EAAI5xC,OAAS,GAAKL,KAAKu7B,MAAMkW,KAAKpxC,OAAS6xC,EAAa,CAC1D,MAAMT,EAAOzxC,KAAKu7B,MAAMkW,KAAKhuC,MAAM,GAOnC,OANAguC,EAAK5tC,KAAKouC,GAEVjyC,KAAK48B,SAAS,CAAC6U,KAAMA,EAAMC,SAAU,KACjC1xC,KAAKoQ,MAAMgiC,eACbpyC,KAAKoQ,MAAMgiC,cAAcX,GAEpBA,EAET,OAAOzxC,KAAKu7B,MAAMkW,KAGpBK,gBAAgBG,EAAKtjC,GACnB,MAAM8iC,EAAOzxC,KAAKu7B,MAAMkW,KAAKhuC,MAAM,GACnCguC,EAAK9F,OAAOh9B,EAAO,GACnB3O,KAAK48B,SAAS,CAAC6U,KAAMA,IACjBzxC,KAAKoQ,MAAMgiC,eACbpyC,KAAKoQ,MAAMgiC,cAAcX,GAI7BrG,eAEEprC,KAAKoQ,MAAMy7B,SAAS7rC,KAAK6xC,aAAa7xC,KAAKu7B,MAAMmW,SAAS1b,SAC1Dh2B,KAAK48B,SAAS,CAAC+U,WAAW,EAAOF,KAAMzxC,KAAKoQ,MAAMqhC,MAAQ,KAG5D9I,eACE3oC,KAAK48B,SAAS,CAAC+U,WAAW,EAAOD,SAAU,GAAID,KAAMzxC,KAAKoQ,MAAMqhC,MAAQ,KACpEzxC,KAAKoQ,MAAMivB,UACbr/B,KAAKoQ,MAAMivB,WAIfpT,SACE,MAAMomB,EAAeryC,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,ehChE5B,GgCiEpBG,EAAetyC,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,ehC/D5B,IgCiE1B,IAAIV,EAAO,GAiBX,OAhBIzxC,KAAKu7B,MAAMoW,UACb3xC,KAAKu7B,MAAMkW,KAAKn/B,KAAK2/B,IACnBR,EAAK5tC,KAAK,CAAC6sB,KAAMuhB,EAAKrJ,QAAUqJ,EAAI5xC,OAASgyC,GAAgBJ,EAAI5xC,OAASiyC,QAG5EtyC,KAAKu7B,MAAMkW,KAAKn/B,KAAK2/B,IACnBR,EAAK5tC,KAAK,0BAAMsoB,UAAU,QAAQlmB,IAAKwrC,EAAKpxC,QAAS4xC,OAEpC,GAAfR,EAAKpxC,SACPoxC,EACE,2BACE,kBAAC,EAAAnlB,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,mDAM1D,yBAAKJ,UAAU,qBACb,yBAAKA,UAAU,kBACb,2BAAOA,UAAU,SAASnsB,KAAKoQ,MAAM8X,QAEtCloB,KAAKu7B,MAAMoW,UACZ,6BACE,kBAAC,EAAArlB,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,mCAEtDgmB,GAAoB,kBAACzJ,GAAD,CACnBvY,OAAQvwB,KAAKoQ,MAAMmgB,OACnB+Y,MAAOmI,EACPrH,gBAAgB,EAChBb,OAAQgJ,EACRlI,SAAUrqC,KAAKoQ,MAAMi6B,SACrBF,QAASnqC,KAAK6xC,aACd3H,YAAalqC,KAAK6xC,aAClBxS,SAAUr/B,KAAK2oC,aACfsB,cAAejqC,KAAK8xC,gBACpBlO,WAAY5jC,KAAK4xC,mBAEpB5xC,KAAKoQ,MAAMy7B,UAAY7rC,KAAKoQ,MAAMivB,SACjC,yBAAKh8B,GAAG,sBAAsB8oB,UAAU,iCACtC,4BAAQA,UAAU,UAAUE,QAASrsB,KAAK2oC,cACxC,kBAAC,EAAArc,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,6BAErD,4BAAQJ,UAAU,UAAUE,QAASrsB,KAAKorC,cACxC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,0BAGnD,MAGJ,yBAAKJ,UAAU,UACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,cAAcE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAK48B,SAAS,CAAC+U,WAAW,MACjG,uBAAGxlB,UAAU,kBAAb,QADF,KAC+C,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,6BAGtG,oCAAGklB,MClIE,MAAMe,WAAsB1rC,IAAAA,UACzChH,YAAYsQ,GACVvE,MAAMuE,GAEN,MAAMkgB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC9C6R,EAAM7R,EAAMmiB,gBAClBzyC,KAAKu7B,MAAQ,CACXmX,KAAM3mB,GAAAA,OAAAA,cAAqB/rB,KAAKoQ,MAAMkgB,OACtC+b,MAAOlK,GAAOA,EAAI+B,UAClByO,SAAUriB,EAAM0T,OAAS1T,EAAM0T,OAAO9mB,QAAKlc,EAC3C8iC,QAASxT,EAAMwT,QAAUxT,EAAMwT,QAAQZ,QAAU,KACjD0P,YAAatiB,EAAM0T,OAAS1T,EAAM0T,OAAOlO,UAAO90B,EAChD02B,OAAQW,GAAa/H,EAAM0T,OAAS1T,EAAM0T,OAAO7N,MAAQ,MACzDsb,KAAMnhB,EAAMmhB,QAAU,GACtBoB,UAAW,KACXC,cAAe,MAGjB9yC,KAAK+yC,eAAiB,KAEtB/yC,KAAKgzC,UAAYhzC,KAAKgzC,UAAUzjB,KAAKvvB,MACrCA,KAAKizC,qBAAuBjzC,KAAKizC,qBAAqB1jB,KAAKvvB,MAC3DA,KAAKkzC,mBAAqBlzC,KAAKkzC,mBAAmB3jB,KAAKvvB,MACvDA,KAAKmzC,oBAAsBnzC,KAAKmzC,oBAAoB5jB,KAAKvvB,MACzDA,KAAKozC,oBAAsBpzC,KAAKozC,oBAAoB7jB,KAAKvvB,MACzDA,KAAKqzC,wBAA0BrzC,KAAKqzC,wBAAwB9jB,KAAKvvB,MACjEA,KAAKszC,aAAetzC,KAAKszC,aAAa/jB,KAAKvvB,MAC3CA,KAAKuzC,uBAAyBvzC,KAAKuzC,uBAAuBhkB,KAAKvvB,MAC/DA,KAAKwzC,kBAAoBxzC,KAAKwzC,kBAAkBjkB,KAAKvvB,MAGvD4wB,oBACE,MAAMN,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OACpDtwB,KAAK+yC,eAAiBziB,EAAMmjB,cAC5BnjB,EAAMmjB,cAAgBzzC,KAAKgzC,UAG7BliB,uBACgB9wB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC9CmjB,cAAgBzzC,KAAK+yC,eAG7BC,UAAUvB,GACRzxC,KAAK48B,SAAS,CAAC6U,KAAMA,IAGvBwB,qBAAqB/1B,IACnBA,EAAKA,EAAG8Y,OAAOtb,UAAU,EAAG4S,MAClBttB,KAAKu7B,MAAMoX,WAAaz1B,IAChCld,KAAK48B,SAAS,CAAC+V,SAAUz1B,IACzBld,KAAKoQ,MAAMsjC,kBAAkB1zC,KAAKoQ,MAAMkgB,MAAOqF,GAAQzY,EAAI,QAI/Dk2B,oBAAoBlQ,GAClBA,EAAUA,EAAQlN,OAAOtb,UAAU,EAAG4S,IAClCttB,KAAKu7B,MAAMuI,UAAYZ,IACzBljC,KAAK48B,SAAS,CAACkH,QAASZ,IACxBljC,KAAKoQ,MAAMsjC,kBAAkB1zC,KAAKoQ,MAAMkgB,MAAO,KAAM4S,GAAWnX,GAAAA,OAAAA,WAIpEsnB,wBAAwBM,IACtBA,EAAOA,EAAK3d,OAAOtb,UAAU,EAAG6S,OAE9BvtB,KAAK48B,SAAS,CAACgW,YAAae,IAC5B3zC,KAAKoQ,MAAMsjC,kBAAkB1zC,KAAKoQ,MAAMkgB,MAAOqF,GAAQ,KAAM,KAAM,KAAMge,KAK7ET,mBAAmB3b,EAAMqC,GAEvB55B,KAAK48B,SAAS,CAACiW,UAAWjZ,EAAKkZ,cAAevb,IACzCqC,IAEH55B,KAAK48B,SAAS,CAAClF,OAAQ,OACvB13B,KAAKoQ,MAAMsjC,kBAAkB1zC,KAAKoQ,MAAMkgB,MAAOqF,GAAQ,KAAM5J,GAAAA,OAAAA,YAKjEonB,oBAAoB5b,EAAM32B,EAAM43B,EAAOC,GACrC,MAAMhC,EAAM71B,EAAOo5B,IAAIS,gBAAgB75B,GAAQ,KAC/CZ,KAAK48B,SAAS,CAAClF,OAAQjB,EAAKoc,UAAW,KAAMC,cAAe,OACxDlyC,GACFZ,KAAKszC,aAAa/b,EAAM32B,EAAM43B,EAAOC,GAMzC6a,aAAa/b,EAAM32B,EAAM43B,EAAOC,GAC9B,MAAMmb,EAAiBzrB,IACrB,IAAI,KAACoP,EAAD,KAAO32B,GAAQunB,EACnB,GAAIvnB,EAAKge,KjC5DiB,KiC4DQ,CAEhC,MAAMi1B,EAAW7zC,KAAKoQ,MAAMmgB,OAAOujB,qBAEnC9zC,KAAK48B,SAAS,CAAC8K,WAAW,IAC1BmM,EAASE,OAAOnzC,GACbqY,MAAMwd,IACLz2B,KAAKoQ,MAAMsjC,kBAAkB1zC,KAAKoQ,MAAMkgB,MAAOqF,GAAQ,KAAMc,OAE9D9rB,OAAO4a,IACNvlB,KAAKoQ,MAAMshB,QAAQnM,EAAK,UAEzByuB,SAAQ,KACPh0C,KAAK48B,SAAS,CAAC8K,WAAW,YAG9B1nC,KAAK48B,SAAS,CAAC8K,WAAW,IAE1BhN,GAAa95B,GACVqY,MAAKkiB,IACJ,MAAM8Y,EAAK5b,GAAa,CAACr2B,KAAMm5B,EAAIR,KAAMp7B,KAAMg4B,IAC/Cv3B,KAAK48B,SAAS,CAACn8B,OAAQwzC,IACvBj0C,KAAKoQ,MAAMsjC,kBAAkB1zC,KAAKoQ,MAAMkgB,MAAOqF,GAAQ,KAAMse,IAC7Dj0C,KAAK48B,SAAS,CAAC8K,WAAW,QAK9BlP,EAAQtL,IAAeuL,EAASvL,IAAesL,GAASC,EAE1DiB,GAAY94B,EAAMssB,GAAaA,GAAaE,IAA4B,GACrEnU,MAAKooB,GAAUuS,EAAcvS,KAC7B12B,OAAM4a,GAAOvlB,KAAKoQ,MAAMshB,QAAQnM,EAAK,SAExCquB,EAAc,CAACrc,KAAMA,EAAM32B,KAAMA,EAAM43B,MAAOA,EAAOC,OAAQA,IAIjE8a,uBAAuB3Z,GACrB55B,KAAK48B,SAAS,CAACiW,UAAW,KAAMC,cAAe,OAGjDU,kBAAkB/B,GAEZpb,GAAWr2B,KAAKu7B,MAAMkW,KAAKhuC,MAAM,GAAIguC,EAAKhuC,MAAM,KAGpDzD,KAAKoQ,MAAM8jC,aAAazC,GAG1BxlB,SACE,GAAIjsB,KAAKu7B,MAAMsX,UACb,OACE,kBAAC1C,GAAD,CACEzY,OAAQ13B,KAAKu7B,MAAMsX,UACnBtb,KAAMv3B,KAAKu7B,MAAMuX,cACjBjH,SAAU7rC,KAAKmzC,oBACf9T,SAAUr/B,KAAKuzC,uBACf7hB,QAAS1xB,KAAKoQ,MAAMshB,UAI1B,MAAMyiB,EAAWn0C,KAAKu7B,MAAMmX,MAAQ1yC,KAAKu7B,MAAM8Q,MAE/C,OACE,oCACA,yBAAKlgB,UAAU,qBACb,gCACE,kBAAC8a,GAAD,CACE1W,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQ13B,KAAKu7B,MAAM7D,OACnB6P,UAAW4M,EACX5N,IAAKvmC,KAAKoQ,MAAMkgB,MAChBpI,MAAOloB,KAAKu7B,MAAMoX,SAClBvL,eAAgBpnC,KAAKkzC,mBACrBxhB,QAAS1xB,KAAKoQ,MAAMshB,WAEvB1xB,KAAKu7B,MAAMmX,KACV,yBAAKvmB,UAAU,SACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAAmBkpB,eAAc,gCAGvD,6BACE,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,8CAEnD6nB,GAA0B,kBAACxD,GAAD,CACzB/K,YAAauO,EACb7xC,MAAOvC,KAAKu7B,MAAMoX,SAClB3M,UAAU,EACVyK,WAAYzwC,KAAKizC,2BAKzB,oCACE,yBAAK9mB,UAAU,SACb,6BAAK,2BAAOA,UAAU,SACpB,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,4BAGxD,6BACE,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,iCAAkCkpB,eAAc,gDAEjE8nB,GAA2B,kBAACzD,GAAD,CAC1B/K,YAAawO,EACb9M,UAAW4M,EACX5xC,MAAOvC,KAAKu7B,MAAMoX,SAClB3M,UAAU,EACVyK,WAAYzwC,KAAKizC,2BAIzB,yBAAK9mB,UAAU,SACb,6BACE,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,uCAIvD,6BACE,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,8BAA+BkpB,eAAc,yCAE9D+nB,GAAwB,kBAAC1D,GAAD,CACvB/K,YAAayO,EACb/xC,MAAOvC,KAAKu7B,MAAMuI,QAClB2M,WAAYzwC,KAAKozC,2BAM5Be,GAAYn0C,KAAKu7B,MAAMqX,YACtB,yBAAKzmB,UAAU,SACb,6BAAK,2BAAOA,UAAU,SACpB,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,mCAGzD,6BACE,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,kCAClBkpB,eAAc,4CAEb+nB,GAAwB,kBAAC1D,GAAD,CACvB/K,YAAayO,EACb/M,UAAW4M,EACX5xC,MAAOvC,KAAKu7B,MAAMqX,YAClBvB,UAAW,EACXZ,WAAYzwC,KAAKqzC,8BAIvB,MAGLc,EACC,oCACE,yBAAKhoB,UAAU,OACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,+CAElDgoB,GAAsB,kBAAC/C,GAAD,CACrBjhB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBrI,MAAOqsB,EACP5C,WAAW,EACXF,KAAMzxC,KAAKu7B,MAAMkW,KACjB5F,SAAU7rC,KAAKwzC,uBAGrB,OC7QK,MAAMgB,WAAoB1tC,IAAAA,UACvChH,YAAYsQ,GACVvE,MAAMuE,GAEN,MAAMkgB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC9C6R,EAAM7R,EAAMmiB,gBAClBzyC,KAAKu7B,MAAQ,CACXmX,KAA0B,MAApB1yC,KAAKoQ,MAAMkgB,MACjB+b,MAAOlK,GAAOA,EAAI+B,UAClBuQ,aAAcnkB,EAAMokB,eAAiBpkB,EAAMokB,iBAAmB,OAAS,GACvEC,eAAe,EACfC,gBAAgB,EAChBC,QAAS,GACTpD,KAAM,IAGRzxC,KAAK80C,yBAAsB9zC,EAE3BhB,KAAKyzC,cAAgBzzC,KAAKyzC,cAAclkB,KAAKvvB,MAC7CA,KAAKwzC,kBAAoBxzC,KAAKwzC,kBAAkBjkB,KAAKvvB,MACrDA,KAAK+0C,eAAiB/0C,KAAK+0C,eAAexlB,KAAKvvB,MAC/CA,KAAKg1C,iBAAmBh1C,KAAKg1C,iBAAiBzlB,KAAKvvB,MACnDA,KAAKi1C,kBAAoBj1C,KAAKi1C,kBAAkB1lB,KAAKvvB,MACrDA,KAAKk1C,kBAAoBl1C,KAAKk1C,kBAAkB3lB,KAAKvvB,MAIvD08B,mBAAmBtsB,GACjB,MAAMkgB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASpgB,EAAMkgB,OAC1CA,IAILA,EAAM6kB,eAAiBn1C,KAAK+0C,eAExBzkB,EAAMmjB,eAAiBzzC,KAAKyzC,gBACP,OAAnBnjB,EAAM8kB,WACRp1C,KAAK80C,oBAAsBxkB,EAAMmjB,cACjCnjB,EAAMmjB,cAAgBzzC,KAAKyzC,eAE3BzzC,KAAK80C,yBAAsB9zC,GAI3BhB,KAAKu7B,MAAMjL,OAASlgB,EAAMkgB,OAC5BtwB,KAAK48B,SAAS,CAACtM,MAAOlgB,EAAMkgB,SAIhCQ,uBACE,MAAMR,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OACpDA,EAAM6kB,oBAAiBn0C,EACvBsvB,EAAMmjB,cAAgBzzC,KAAK80C,oBAG7BC,eAAeM,GACbr1C,KAAK48B,SAAS,CAAC6X,YAAaY,GAAS,KAGvCL,iBAAiBvuC,GACfzG,KAAK48B,SAAS,CAACiY,QAASpuC,EAAEiH,OAAOnL,MAAOqyC,gBAAgB,IAG1DK,kBAAkBxuC,GACE,KAAdA,EAAE2qB,QAEJpxB,KAAK48B,SAAS,CAACiY,QAAS,GAAIF,eAAe,IACpB,KAAdluC,EAAE2qB,SAEXpxB,KAAKk1C,kBAAkBzuC,GAI3ByuC,kBAAkBzuC,GAChB,MAAMlE,EAAQvC,KAAKu7B,MAAMsZ,QAAQ7e,OACjC,IAAKzzB,EAEH,YADAvC,KAAK48B,SAAS,CAAC+X,eAAe,EAAOC,gBAAgB,IAIvD,IACIhgC,EADAY,E9BFD,SAAiBA,GAEtB,OADAA,EAAMA,EAAIwgB,OACN,6EAA6EjY,KAAKvI,GAC7EA,EAAInL,QAAQ,WAAY,IAE1B,K8BHKirC,CAAQ/yC,GAEdiT,EACFZ,EAAS,OAETY,E9BEC,SAAiBA,GAEtB,OADAA,EAAMA,EAAIwgB,OACN,mDAAmDjY,KAAKvI,GACnDA,EAEF,K8BPG+/B,CAAQhzC,GACViT,IACFZ,EAAS,UAGTA,GACF5U,KAAKoQ,MAAMolC,UAAU5gC,EAAQY,GAC7BxV,KAAK48B,SAAS,CAAC+X,eAAe,EAAOE,QAAS,MAE9C70C,KAAK48B,SAAS,CAACgY,gBAAgB,IAKnCnB,cAAchC,GACZzxC,KAAK48B,SAAS,CAAC6U,KAAMA,IAEjBzxC,KAAK80C,qBAAuB90C,KAAK80C,qBAAuB90C,KAAKyzC,eAC/DzzC,KAAK80C,oBAAoBrD,GAK7B+B,kBAAkB/B,GACXpb,GAAWr2B,KAAKu7B,MAAMkW,KAAKhuC,MAAM,GAAIguC,EAAKhuC,MAAM,KACnDzD,KAAKoQ,MAAMqlC,yBAAyBz1C,KAAKoQ,MAAMkgB,MAAOmhB,GAI1DxlB,SACE,MAAMwoB,EAAc,GAiBpB,OAhBIz0C,KAAKu7B,MAAMmX,MACb1yC,KAAKu7B,MAAMkZ,YAAYniC,KAAKojC,IAC1BjB,EAAY5wC,KACV,yBAAKoC,IAAKyvC,EAAKC,KAAO,IAAMD,EAAKlgC,IAAM,IAAMkgC,EAAKE,MAAOF,EAAKC,KAA9D,KAAqE,4BAAKD,EAAKlgC,KAC7E,kCAASkgC,EAAKE,KAKZ,KAJA,uBAAGpgB,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMylC,cAAcH,EAAKC,KAAMD,EAAKlgC,OACxF,kBAAC,EAAA8W,iBAAD,CAAkBjpB,GAAE,6BAA8BkpB,eAAc,8BAFpE,IAKQ,uBAAGiJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM0lC,aAAaJ,EAAKC,KAAMD,EAAKlgC,OAAQ,uBACvG2W,UAAU,uBAD6F,yBAQ/G,yBAAKA,UAAU,oBACb,kBAACqmB,GAAD,CACEjiB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBD,MAAOtwB,KAAKoQ,MAAMkgB,MAClBojB,kBAAmB1zC,KAAKoQ,MAAMsjC,kBAC9BQ,aAAcl0C,KAAKwzC,kBACnB9hB,QAAS1xB,KAAKoQ,MAAMshB,UACrB1xB,KAAKu7B,MAAMmX,KACV,oCACE,yBAAKvmB,UAAU,OACf,yBAAKA,UAAU,qBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,gCAG3D,yBAAKJ,UAAU,UACZsoB,EACAz0C,KAAKu7B,MAAMoZ,cACV,2BAAOp1C,KAAK,OAAOgD,MAAOvC,KAAKu7B,MAAMh5B,MACnC4pB,UAAWnsB,KAAKu7B,MAAMqZ,eAAiB,UAAY,KACnD/O,YAAY,wBAAwBG,SAAS,WAAWC,WAAS,EACjEH,SAAU9lC,KAAKg1C,iBAAkBjP,UAAW/lC,KAAKi1C,kBAAmB1K,OAAQvqC,KAAKk1C,oBACjF,KACJ,6BACE,uBAAG1f,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAK48B,SAAS,CAAC+X,eAAe,MAC7E,uBAAGxoB,UAAU,kBAAb,OACA,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,sCAKlE,OCtKV,MAAMsB,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BC,eAAgB,CACd1qB,GAAI,wBACJkpB,eAAgB,CAAF,kCAGhB0C,uBAAwB,CACtB5rB,GAAI,yBACJkpB,eAAgB,CAAF,qFAGhBwpB,gBAAiB,CACf1yC,GAAI,yBACJkpB,eAAgB,CAAF,0CAGhBkC,wBAAyB,CACvBprB,GAAI,0BACJkpB,eAAgB,CAAF,mGAGhBgC,aAAc,CACZlrB,GAAI,eACJkpB,eAAgB,CAAF,uCAGhBiC,qBAAsB,CACpBnrB,GAAI,uBACJkpB,eAAgB,CAAF,2FAGhBypB,WAAY,CACV3yC,GAAI,oBACJkpB,eAAgB,CAAF,sCAGhB0pB,mBAAoB,CAClB5yC,GAAI,qBACJkpB,eAAgB,CAAF,qEAGhB2pB,cAAe,CACb7yC,GAAI,uBACJkpB,eAAgB,CAAF,iCAGhB4pB,sBAAuB,CACrB9yC,GAAI,wBACJkpB,eAAgB,CAAF,gEAGhB6pB,YAAa,CACX/yC,GAAI,qBACJkpB,eAAgB,CAAF,uCAGhB8pB,oBAAqB,CACnBhzC,GAAI,sBACJkpB,eAAgB,CAAF,gFAGhB+pB,WAAY,CACVjzC,GAAI,mBACJkpB,eAAgB,CAAF,2BAKlB,MAAMgqB,WAAsBzvC,IAAAA,cAC1BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKw2C,kBAAoBx2C,KAAKw2C,kBAAkBjnB,KAAKvvB,MACrDA,KAAKy2C,qBAAuBz2C,KAAKy2C,qBAAqBlnB,KAAKvvB,MAC3DA,KAAK02C,YAAc12C,KAAK02C,YAAYnnB,KAAKvvB,MACzCA,KAAK22C,YAAc32C,KAAK22C,YAAYpnB,KAAKvvB,MACzCA,KAAK42C,aAAe52C,KAAK42C,aAAarnB,KAAKvvB,MAG7Cw2C,kBAAkB/vC,GAChBA,EAAEwqB,iBACF,MAAM,cAAC7B,GAAiBpvB,KAAKoQ,MAAMif,KACnCrvB,KAAKoQ,MAAM0f,YACTV,EAAcvB,GAASU,cACvBa,EAAcvB,GAASW,uBACtB,KAAQxuB,KAAKoQ,MAAMymC,cAAc72C,KAAKoQ,MAAMkgB,SAC7C,MACA,EACA,MAIJmmB,qBAAqBhwC,GACnBA,EAAEwqB,iBACF,MAAM,cAAC7B,GAAiBpvB,KAAKoQ,MAAMif,KACnCrvB,KAAKoQ,MAAM0f,YACTV,EAAcpvB,KAAKoQ,MAAMg8B,QAAUve,GAASkoB,gBAAkBloB,GAASE,gBACvEqB,EAAcpvB,KAAKoQ,MAAMg8B,QAAUve,GAASY,wBAA0BZ,GAASoB,yBAC9E,KAAQjvB,KAAKoQ,MAAM0mC,iBAAiB92C,KAAKoQ,MAAMkgB,SAChD,MACA,EACA,MAIJomB,YAAYjwC,GACVA,EAAEwqB,iBACF,MAAM,cAAC7B,GAAiBpvB,KAAKoQ,MAAMif,KACnCrvB,KAAKoQ,MAAM0f,YACTV,EAAcvB,GAASmoB,YACvB5mB,EAAcvB,GAASooB,qBACtB,KAAQj2C,KAAKoQ,MAAM2mC,aAAa/2C,KAAKoQ,MAAMkgB,SAC5C,MACA,EACA,MAIJqmB,YAAYlwC,GACVA,EAAEwqB,iBACF,MAAM,cAAC7B,GAAiBpvB,KAAKoQ,MAAMif,KACnCrvB,KAAKoQ,MAAM0f,YACTV,EAAcvB,GAASqoB,eACvB9mB,EAAcvB,GAASsoB,wBACtB,KAAQn2C,KAAKoQ,MAAM4mC,aAAah3C,KAAKoQ,MAAMkgB,SAC5C,MACA,EACA,MAIJsmB,aAAanwC,GACXA,EAAEwqB,iBACF,MAAM,cAAC7B,GAAiBpvB,KAAKoQ,MAAMif,KACnCrvB,KAAKoQ,MAAM0f,YACTV,EAAcvB,GAASuoB,aACvBhnB,EAAcvB,GAASwoB,sBACtB9pC,IAAOvM,KAAKoQ,MAAM6mC,cAAcj3C,KAAKoQ,MAAMkgB,SAC5C,MACA,EACA,MAIJrE,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KACnC,OACE,yBAAKlD,UAAU,oBACb,yBAAKA,UAAU,qBACXnsB,KAAKoQ,MAAMgO,QAOX,KANA,uBAAGoX,KAAK,IAAIrJ,UAAU,cAAcE,QAASrsB,KAAKy2C,sBAChD,uBAAGtqB,UAAU,kBAAb,kBADF,KAEIiD,EAAcpvB,KAAKoQ,MAAMg8B,QAAUve,GAASkoB,gBAAkBloB,GAASE,iBAM5E/tB,KAAKoQ,MAAMi8B,MACV,uBAAG7W,KAAK,IAAIrJ,UAAU,qBAAqBE,QAASrsB,KAAKw2C,mBACvD,uBAAGrqB,UAAU,kBAAb,UADF,KACkDiD,EAAcvB,GAASU,eAGzE,uBAAGiH,KAAK,IAAIrJ,UAAU,qBAAqBE,QAASrsB,KAAK02C,aACvD,uBAAGvqB,UAAU,kBAAb,eADF,KACuDiD,EAAcvB,GAASmoB,aAG9Eh2C,KAAKoQ,MAAM8mC,WAKX,KAJA,uBAAG1hB,KAAK,IAAIrJ,UAAU,qBAAqBE,QAASrsB,KAAK22C,aACvD,uBAAGxqB,UAAU,kBAAb,SADF,KACiDiD,EAAcvB,GAASqoB,gBAKxEl2C,KAAKoQ,MAAMi8B,MAKX,KAJA,uBAAG7W,KAAK,IAAIrJ,UAAU,qBAAqBE,QAASrsB,KAAK42C,cACvD,uBAAGzqB,UAAU,kBAAb,UADF,KACkDiD,EAAcvB,GAASuoB,eAM7E,yBAAKjqB,UAAU,OACf,yBAAKA,UAAU,qBACZnsB,KAAKoQ,MAAM8mC,WACV,oCACE,yBAAK/qB,UAAU,SACb,+BACE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,yBAA0BkpB,eAAc,wCAFhE,IAIW,wBAAIJ,UAAU,YACrBE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM+mC,0BAA0B,UACzEn3C,KAAKoQ,MAAMgnC,SAGdp3C,KAAKoQ,MAAMgO,QA4BX,KA3BA,yBAAK+N,UAAU,SACb,6BACE,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,4BAA6BkpB,eAAc,4CAInE,yBAAKJ,UAAU,UACb,sCAAW,wBAAIA,UAAWnsB,KAAKoQ,MAAMi8B,MAAQ,YAAc,KACzDhgB,QAAU5lB,IACRA,EAAEwqB,iBACEjxB,KAAKoQ,MAAMi8B,OACbrsC,KAAKoQ,MAAM+mC,0BAA0B,UAErCn3C,KAAKoQ,MAAMoU,OAEjB,sCAAW,wBAAI2H,UAAWnsB,KAAKoQ,MAAMi8B,MAAQ,YAAc,KACzDhgB,QAAU5lB,IACRA,EAAEwqB,iBACEjxB,KAAKoQ,MAAMi8B,OACbrsC,KAAKoQ,MAAM+mC,0BAA0B,UAErCn3C,KAAKoQ,MAAMinC,UASzB,yBAAKlrB,UAAU,SACb,6BACE,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,oCAI3D,yBAAKJ,UAAU,UACb,6BACE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,0BADjD,IAEgD,wBAAIJ,UAAU,YAC1DE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM+mC,0BAA0B,UACzEn3C,KAAKoQ,MAAMgnC,SAGhB,6BAAMp3C,KAAKoQ,MAAMuiC,SAAW3yC,KAAKoQ,MAAMuiC,SAAWvjB,EAAcvB,GAASyoB,YAAzE,MACQ,wBAAInqB,UAAU,YAClBE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM+mC,0BAA0B,WACzEn3C,KAAKoQ,MAAMknC,kBAYhC,UAAejkB,EAAAA,EAAAA,YAAWkjB,ICnPpB1oB,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BpqB,KAAM,CACJL,GAAI,mBAEJkpB,eAAgB,CAAF,wBAEhBgrB,QAAS,CACPl0C,GAAI,sBAEJkpB,eAAgB,CAAF,2BAEhBirB,SAAU,CACRn0C,GAAI,uBAEJkpB,eAAgB,CAAF,4BAEhBoe,QAAS,CACPtnC,GAAI,sBAEJkpB,eAAgB,CAAF,2BAEhBkrB,KAAM,CACJp0C,GAAI,mBAEJkpB,eAAgB,CAAF,kCAEhBmrB,UAAW,CACTr0C,GAAI,wBACJkpB,eAAgB,CAAF,6BAGhBorB,WAAY,CACVt0C,GAAI,sBACJkpB,eAAgB,CAAF,2BAGhBqrB,UAAW,CACTv0C,GAAI,4BACJkpB,eAAgB,CAAF,iCAGhBsrB,UAAW,CACTx0C,GAAI,wBACJkpB,eAAgB,CAAF,6BAGhBurB,UAAW,CACTz0C,GAAI,mBACJkpB,eAAgB,CAAF,sCAGhByC,iBAAkB,CAChB3rB,GAAI,6BACJkpB,eAAgB,CAAF,sCAKlB,MAAMwrB,WAAiBjxC,IAAAA,UACrBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXjL,MAAO,KACP+b,OAAO,EACP2L,OAAO,EACP7L,QAAQ,EACRC,SAAS,EACT6L,OAAO,EACPC,QAAS,KACThB,gBAAYl2C,EACZod,aAASpd,EACT2xC,cAAU3xC,EACV4xC,iBAAa5xC,EACb02B,OAAQ,KACRoM,QAAS,KACTqU,gBAAiB,KACjBf,OAAQ,KACRgB,UAAW,KACXC,SAAU,KACVf,WAAY,KACZgB,UAAW,KACX9zB,KAAM,KACN6yB,KAAM,KACNkB,YAAa,GACbxQ,cAAe,GACfyQ,sBAAkBx3C,EAClBy3C,yBAAqBz3C,GAGvBhB,KAAK04C,UAAY14C,KAAK04C,UAAUnpB,KAAKvvB,MACrCA,KAAK24C,UAAY34C,KAAK24C,UAAUppB,KAAKvvB,MACrCA,KAAK44C,UAAY54C,KAAK44C,UAAUrpB,KAAKvvB,MACrCA,KAAK64C,WAAa74C,KAAK64C,WAAWtpB,KAAKvvB,MACvCA,KAAK84C,cAAgB94C,KAAK84C,cAAcvpB,KAAKvvB,MAC7CA,KAAK+4C,mBAAqB/4C,KAAK+4C,mBAAmBxpB,KAAKvvB,MACvDA,KAAKg5C,YAAch5C,KAAKg5C,YAAYzpB,KAAKvvB,MACzCA,KAAKi5C,gBAAkBj5C,KAAKi5C,gBAAgB1pB,KAAKvvB,MACjDA,KAAKk5C,yBAA2Bl5C,KAAKk5C,yBAAyB3pB,KAAKvvB,MACnEA,KAAKm5C,8BAAgCn5C,KAAKm5C,8BAA8B5pB,KAAKvvB,MAC7EA,KAAKo5C,qBAAuBp5C,KAAKo5C,qBAAqB7pB,KAAKvvB,MAC3DA,KAAKq5C,0BAA4Br5C,KAAKq5C,0BAA0B9pB,KAAKvvB,MACrEA,KAAKs5C,qBAAuBt5C,KAAKs5C,qBAAqB/pB,KAAKvvB,MAC3DA,KAAKu5C,kBAAoBv5C,KAAKu5C,kBAAkBhqB,KAAKvvB,MACrDA,KAAKw5C,mBAAqBx5C,KAAKw5C,mBAAmBjqB,KAAKvvB,MAIzD08B,mBAAmBtsB,GACjB,MAAMkgB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASpgB,EAAMkgB,OAC1CA,IAIDtwB,KAAK64C,YAAcvoB,EAAMuoB,aAC3B74C,KAAKw4C,iBAAmBloB,EAAMuoB,WAC9BvoB,EAAMuoB,WAAa74C,KAAK64C,WAExB74C,KAAKy4C,oBAAsBnoB,EAAMwoB,cACjCxoB,EAAMwoB,cAAgB94C,KAAK84C,eAGzB94C,KAAKu7B,MAAMjL,OAASlgB,EAAMkgB,QAC5BtwB,KAAK48B,SAAS,CAACtM,MAAOlgB,EAAMkgB,QAC5BtwB,KAAK24C,UAAUroB,EAAOlgB,GACtBpQ,KAAK04C,UAAUpoB,EAAOlgB,GACtBpQ,KAAK44C,UAAUtoB,KAInBQ,uBACE,MAAMR,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC/CA,IAGLtwB,KAAK48B,SAAS,CAACtM,MAAO,OACtBA,EAAMuoB,WAAa74C,KAAKw4C,iBACxBloB,EAAMwoB,cAAgB94C,KAAKy4C,qBAG7BC,UAAUpoB,EAAOlgB,GACf,MAAMqpC,EAAW,CAAClB,YAAa,IAC/B,GAAuB,OAAnBjoB,EAAM8kB,UAAoB,CAG5B,MAAMsE,EAAQppB,EAAMqpB,WAAWvpC,EAAMkgB,OACjCopB,GACFD,EAASnC,WAAaoC,EAAMvX,IAAIyX,WAChCH,EAASnB,UAAYoB,EAAMvX,IAAI0X,YAE/BJ,EAASnC,WpCrIa,IoCsItBmC,EAASnB,UpCtIa,UoCyIxBhoB,EAAMwpB,aAAaC,IACjBN,EAASlB,YAAY10C,KAAKk2C,KACzB/5C,MAGLA,KAAK48B,SAAS6c,GAGhBd,UAAUroB,EAAOlgB,GACf,MAAM4pC,EAAS1pB,EAAM2pB,oBAAsB,GACrC9X,EAAM7R,EAAMmiB,gBAEZjf,EAAS,GACf,GAAIlD,EAAMqU,QACR,IAAK,MAAO1+B,EAAKuP,KAAQ5V,OAAOmS,QAAQue,EAAMqU,SACxCnvB,GACFge,EAAO3vB,KAAKoC,GAKlBjG,KAAK48B,SAAS,CACZyP,MAAOlK,GAAOA,EAAI+B,UAClB8T,MAAO7V,GAAOA,EAAI+X,UAClB/N,OAAQhK,GAAOA,EAAIgY,WACnB/N,QAASjK,GAAOA,EAAIiY,YACpBnC,MAAO9V,GAAOA,EAAIG,UAElBqQ,SAAUnb,GAAQlH,EAAM0T,OAAS1T,EAAM0T,OAAO9mB,QAAKlc,EAAWssB,IAC9DslB,YAAapb,GAAQlH,EAAM0T,OAAS1T,EAAM0T,OAAOlO,UAAO90B,EAAWusB,IACnEmK,OAAQW,GAAa/H,EAAM0T,OAAS1T,EAAM0T,OAAO7N,MAAQ,MACzD4R,cAAevU,EACfsQ,QAAStM,GAAQlH,EAAMwT,QAAUxT,EAAMwT,QAAQZ,QAAU,KAAM5V,IAC/D+sB,SAAU/pB,EAAMgqB,aAChBpC,QAAS5nB,EAAMhxB,KACf43C,WAAY5mB,EAAMiqB,cAClBn8B,QAASkS,EAAMkqB,iBAAmBlqB,EAAMmqB,KACxCrD,OAAQjV,EAAMA,EAAIE,eAAYrhC,EAC9Bo3C,UAAWjW,EAAMA,EAAIyX,gBAAa54C,EAClCq3C,SAAUlW,EAAMA,EAAI0X,eAAY74C,EAChCwjB,KAAMw1B,EAAOx1B,KACb6yB,KAAM2C,EAAO3C,OAIjBuB,UAAUtoB,GACR,GAAuB,OAAnBA,EAAM8kB,UACR,OAGF,MAAMjT,EAAM7R,EAAMmiB,gBACdtQ,GAAOA,EAAI+B,WAEb5T,EAAMoqB,QAAQpqB,EAAMqqB,iBAAiBC,WAAWC,SAIpDhC,WAAWlF,GACT,MAAMrjB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC/CA,IAGLtwB,KAAK24C,UAAUroB,EAAOtwB,KAAKoQ,OAEvBpQ,KAAKw4C,kBAAoBx4C,KAAKw4C,kBAAoBx4C,KAAK64C,YACzD74C,KAAKw4C,iBAAiB7E,IAI1BmF,cAAcgC,GACZ,MAAMxqB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC/CA,IAGLtwB,KAAK04C,UAAUpoB,EAAOtwB,KAAKoQ,OAEvBpQ,KAAKy4C,qBAAuBz4C,KAAKy4C,qBAAuBz4C,KAAK84C,eAC/D94C,KAAKy4C,oBAAoBqC,IAI7B/B,mBAAmBnf,GACjB55B,KAAK48B,SAAS,CAAClF,OAAQkC,IACvB55B,KAAKoQ,MAAM2qC,kBAAkB/6C,KAAKoQ,MAAMkgB,MAAOqF,GAAQ,KAAMiE,GAAO7N,GAAAA,OAAAA,UAAkB,MAGxFitB,YAAYgC,EAAS9S,GACnBloC,KAAK48B,SAAS,CAACqb,MAAO/P,IACtBloC,KAAKoQ,MAAM6qC,oBAAoBj7C,KAAKoQ,MAAMkgB,MAAO4X,EAAU,KAAO,MAGpE+Q,gBAAgB+B,EAASE,GACvBl7C,KAAKoQ,MAAM+qC,iBAAiBn7C,KAAKoQ,MAAMkgB,OAGzC4oB,yBAAyBkC,EAAOC,GAC9B,OAAQD,GACN,IAAK,OACHp7C,KAAKoQ,MAAMkrC,yBAAyBt7C,KAAKoQ,MAAMkgB,MAAO,KAAM,KAAM,CAAC9L,KAAM62B,IACzE,MACF,IAAK,OACHr7C,KAAKoQ,MAAMkrC,yBAAyBt7C,KAAKoQ,MAAMkgB,MAAO,KAAM,KAAM,CAAC+mB,KAAMgE,IACzE,MACF,IAAK,OACL,IAAK,OACHr7C,KAAKoQ,MAAM6qC,oBAAoBj7C,KAAKoQ,MAAMkgB,MAAO+qB,GACjD,MACF,IAAK,QACHr7C,KAAKoQ,MAAM6qC,oBAAoBj7C,KAAKoQ,MAAMkgB,MAAO+qB,EAAMr7C,KAAKoQ,MAAMkgB,OAClE,MACF,IAAK,OACHtwB,KAAKoQ,MAAM6qC,oBAAoBj7C,KAAKoQ,MAAMkgB,MAAO+qB,EAAMr7C,KAAKu7B,MAAMggB,uBAItEv7C,KAAKw5C,qBAGPL,8BAA8BiC,EAAO7U,GACnC,MAAM,cAACnX,GAAiBpvB,KAAKoQ,MAAMif,KACnC,IAAImsB,EAAQC,EAAWC,EAAQC,EAAWC,EAAclP,EAAWC,EACnE,OAAQyO,GACN,IAAK,OACHI,EAASx7C,KAAKu7B,MAAM6b,OACpB,MACF,IAAK,OACHoE,EAASx7C,KAAKu7B,MAAM8c,SACpBoD,EAAYz7C,KAAKu7B,MAAM6c,UACnBp4C,KAAKu7B,MAAM8Q,MAEbqP,EAAS,KAGTA,EAAS3vB,GAAAA,OAAAA,WAAAA,OAAyBA,GAAAA,OAAAA,WAAAA,KAAuB,OAAQ/rB,KAAKu7B,MAAM6c,YACxEp4C,KAAKu7B,MAAMnd,UAEbs9B,GAAU,MAGdC,EAAYvsB,EAAcvB,GAAS6pB,WACnCkE,EAAexsB,EAAcvB,GAAS8pB,YACtC,MACF,IAAK,QACH6D,EAASx7C,KAAKu7B,MAAM+b,WACpBmE,EAAYz7C,KAAKu7B,MAAM+c,UACvBoD,EAAS17C,KAAKu7B,MAAM2b,WAAcl3C,KAAKu7B,MAAM8Q,MAAQ,GAAK,IAAO,OACjEsP,EAAYvsB,EAAcvB,GAAS8pB,YACnCiE,EAAexsB,EAAcvB,GAAS6pB,WACtC,MACF,IAAK,OACH8D,EAASx7C,KAAKu7B,MAAM/W,KACpBk3B,EAAS,IACT,MACF,IAAK,OACHF,EAASx7C,KAAKu7B,MAAM8b,KACpBqE,EAAS,IACT,MACF,IAAK,OAAQ,CACX,MAAMprB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OACpD,IAAKA,EACH,OAEF,MAAMI,EAAOJ,EAAMqpB,WAAWpT,GAC9B,IAAK7V,IAASA,EAAKyR,IACjB,OAEFqZ,EAAS9qB,EAAKyR,IAAIyX,WAClB6B,EAAY/qB,EAAKyR,IAAI0X,UACrB6B,EAAS17C,KAAKu7B,MAAM8Q,MAAQ,GAAK,IACjCsP,EAAYvsB,EAAcvB,GAAS8pB,YACnCiE,EAAexsB,EAAcvB,GAAS6pB,WAClChnB,EAAKsT,SACP0I,EAAYhc,EAAKsT,OAAO9mB,GACxByvB,EAAajc,EAAKsT,OAAO7N,OAE3B,MAEF,QAEE,YADAxxB,QAAQ+F,MAAM,oCAAsC0wC,EAAQ,KAGhEp7C,KAAK48B,SAAS,CACZ2e,sBAAuBhV,EACvBsV,qBAAsBnP,EACtBoP,sBAAuBnP,EACvBoP,kBAAmBP,EACnBQ,qBAAsBP,EACtBQ,uBAAwBN,EACxBO,0BAA2BN,EAC3BO,yBAA0BT,IAE5B17C,KAAKoQ,MAAMgsC,WAAX,eAA8BhB,IAGhChC,qBAAqB3yC,GACnBA,EAAEwqB,iBACFjxB,KAAKoQ,MAAMk2B,aACXtmC,KAAKoQ,MAAMgsC,WAAW,WAGxB/C,0BAA0B1O,EAASiB,EAAO5B,GACxChqC,KAAKoQ,MAAMisC,sBAAsBr8C,KAAKoQ,MAAMkgB,MAAOsb,EAAO5B,GAC1DhqC,KAAKoQ,MAAMgsC,WAAW,QAGxB9C,qBAAqB/S,GACnBvmC,KAAK48B,SAAS,CAACub,gBAAiB5R,IAGlCiT,qBACE,MAAMjlC,GAAQvU,KAAKoQ,MAAMksC,OAAS,QAAQ1hB,MAAM,KACjC,QAAXrmB,EAAK,GACPvU,KAAKoQ,MAAMgsC,WAAW,MACF,QAAX7nC,EAAK,GACC,QAAXA,EAAK,GACPvU,KAAKoQ,MAAMgsC,WAAW,QAEtBp8C,KAAKoQ,MAAMgsC,WAAW,YAGxBp8C,KAAKoQ,MAAMgsC,WAAW,QAI1B7C,kBAAkB3pB,GAChB,MAAM,cAACR,GAAiBpvB,KAAKoQ,MAAMif,KAC7BiB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OACpD,IAAKA,EACH,OAEF,MAAMI,EAAOJ,EAAMqpB,WAAW/pB,EAAOS,WACrC,IAAKK,IAASA,EAAKyR,IACjB,OAGF,MAAMuQ,EAAO1yC,KAAKoQ,MAAMmgB,OAAOmiB,KAAK9iB,EAAOS,WACrCksB,EAAY,CAChB,CAACr0B,MAAOkH,EAAcvB,GAASmB,kBAAmBW,QAAS,KACzD3vB,KAAKm5C,8BAA8BzG,EAAO,OAAS,OAAQ9iB,EAAOS,cAGjEqiB,GACH6J,EAAU14C,KAAK,iBAEjB04C,EAAU14C,KAAK6sB,EAAKyR,IAAIG,UAAY,gBAAkB,eACjDoQ,GACH6J,EAAU14C,KAAK6sB,EAAKyR,IAAII,WAAa,eAAiB,kBAExDviC,KAAKoQ,MAAMuxB,gBAAgB,CACzBtR,UAAWrwB,KAAKoQ,MAAMkgB,MACtBtsB,EAAG4rB,EAAO5rB,EACVkvB,EAAGtD,EAAOsD,EACVxC,KAAMd,EAAOS,WAAYksB,GAG7BtwB,SACE,MAAM1X,GAAQvU,KAAKoQ,MAAMksC,OAAS,QAAQ1hB,MAAM,KAC1C4hB,EAAOjoC,EAAK,GAClBA,EAAKkoC,QAEL,MAAM,cAACrtB,GAAiBpvB,KAAKoQ,MAAMif,KAC7BqtB,EAAattB,GAAuB,QAARotB,EAAiB3uB,GAAS,QAAUtZ,EAAK,IAAMsZ,GAAS2uB,KACrF3uB,GAAQ,MAEb,OACE,yBAAKxqB,GAAG,aACN,yBAAK8oB,UAAU,gBAAgB9oB,GAAG,sBAChC,yBAAK8oB,UAAU,cAAc9oB,GAAG,cAAcq5C,GAC9C,6BACE,kBAACvU,GAAD,CAAY9I,SAAUr/B,KAAKw5C,uBAG9Bx5C,KAAKoQ,MAAMusC,cACV,kBAACvU,GAAD,CACEC,MAAOroC,KAAKoQ,MAAMwsC,WAClBrU,KAAMvoC,KAAKoQ,MAAMysC,UACjBvU,aAActoC,KAAKoQ,MAAMshB,UAAc,KAClC,WAAR8qB,EACC,kBAAC,GAAD,CACEjsB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBoa,QAAS3qC,KAAKu7B,MAAMgd,YACpBzN,eAAgB9qC,KAAKoQ,MAAM6zB,SAC3B4G,oBAAqB7qC,KAAKu7B,MAAMyc,QAAUh4C,KAAKu7B,MAAM8Q,MACrDpI,SAAUjkC,KAAKoQ,MAAM6zB,SACrBN,SAAU3jC,KAAKoQ,MAAM0sC,mBACrBzd,SAAUr/B,KAAKw5C,mBACf3N,SAAU7rC,KAAKq5C,4BAEX,QAARmD,GAAkBjoC,EAAKlU,OAAS,EAC9B,kBAAC,GAAD,CACEkwB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBviB,KAAMhO,KAAKu7B,MAAMwgB,kBACjBtP,QAASzsC,KAAKu7B,MAAMygB,qBACpBxP,KAAMxsC,KAAKu7B,MAAM4gB,yBACjBvP,UAAW5sC,KAAKu7B,MAAM0gB,uBACtBpP,aAAc7sC,KAAKu7B,MAAM2gB,0BACzBxP,UAAW1sC,KAAKu7B,MAAMsgB,qBACtBxqB,KAAMrxB,KAAKu7B,MAAMggB,sBACjB5O,WAAY3sC,KAAKu7B,MAAMugB,sBACvBjQ,SAAW79B,GAAShO,KAAKk5C,yBAAyB3kC,EAAK,GAAIvG,GAC3DqxB,SAAUr/B,KAAKw5C,qBAEX,WAARgD,EACE,kBAAChI,GAAD,CACEjkB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBD,MAAOtwB,KAAKoQ,MAAMkgB,MAClBklB,UAAWx1C,KAAKoQ,MAAMolC,UACtBC,yBAA0Bz1C,KAAKoQ,MAAMqlC,yBACrCI,cAAe71C,KAAKoQ,MAAMylC,cAC1BC,aAAc91C,KAAKoQ,MAAM0lC,aACzBpC,kBAAmB1zC,KAAKoQ,MAAMkrC,yBAC9B5pB,QAAS1xB,KAAKoQ,MAAMshB,UAEhB,YAAR8qB,EACE,kBAAC,GAAD,CACElsB,MAAOtwB,KAAKoQ,MAAMkgB,MAClB+b,MAAOrsC,KAAKu7B,MAAM8Q,MAClB2L,MAAOh4C,KAAKu7B,MAAMyc,MAClB7L,OAAQnsC,KAAKu7B,MAAM4Q,OACnBC,QAASpsC,KAAKu7B,MAAM6Q,QACpB6L,MAAOj4C,KAAKu7B,MAAM0c,MAElBf,WAAYl3C,KAAKu7B,MAAM2b,WACvB94B,QAASpe,KAAKu7B,MAAMnd,QACpBg5B,OAAQp3C,KAAKu7B,MAAM6b,OACnBgB,UAAWp4C,KAAKu7B,MAAM6c,UACtBC,SAAUr4C,KAAKu7B,MAAM8c,SACrBf,WAAYt3C,KAAKu7B,MAAM+b,WACvBgB,UAAWt4C,KAAKu7B,MAAM+c,UACtB9zB,KAAMxkB,KAAKu7B,MAAM/W,KACjB6yB,KAAMr3C,KAAKu7B,MAAM8b,KAEjBvnB,YAAa9vB,KAAKoQ,MAAM0f,YACxBgnB,iBAAkB92C,KAAKoQ,MAAM0mC,iBAC7BC,aAAc/2C,KAAKoQ,MAAM2mC,aACzBC,aAAch3C,KAAKoQ,MAAM4mC,aACzBC,cAAej3C,KAAKoQ,MAAM6mC,cAC1BE,0BAA2Bn3C,KAAKm5C,8BAChCiD,WAAYp8C,KAAKoQ,MAAMgsC,aAEzB,yBAAK/4C,GAAG,oBAAoB8oB,UAAU,oBACpC,yBAAKA,UAAU,qBACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,0BAA0BE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgsC,WAAW,aACzG,uBAAGjwB,UAAU,kBAAb,QADF,IAEE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,cAAekpB,eAAc,2BAEnD,gCACE,kBAAC0a,GAAD,CACE1W,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQ13B,KAAKu7B,MAAM7D,OACnB6P,UAAU,EACVhB,IAAKvmC,KAAKoQ,MAAMkgB,MAChBpI,MAAOloB,KAAKu7B,MAAMoX,YAEtB,yBAAKxmB,UAAU,SACb,6BAAK,2BAAOA,UAAU,SACpB,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,4BAGxD,yBAAKJ,UAAU,oBAAoBnsB,KAAKu7B,MAAMoX,SAC7C3yC,KAAKu7B,MAAMnd,QAAU,yBAAK6Z,IAAI,mBAAmB9L,UAAU,UAAU6L,IAAI,YAAe,OAE1Fh4B,KAAKu7B,MAAMuI,QACV,yBAAK3X,UAAU,SACb,6BAAK,2BAAOA,UAAU,SACpB,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,uCAGrD,yBAAKJ,UAAU,oBAAoBnsB,KAAKu7B,MAAMuI,UAE9C,KAEJ,yBAAK3X,UAAU,SACb,2BAAOA,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,0BAD9E,IAGE,4BAAKvsB,KAAKu7B,MAAM2c,UAElB,yBAAK/rB,UAAU,SACb,kBAAC,GAAD,CAAW4b,cAAe/nC,KAAKu7B,MAAMwM,iBAEtC/nC,KAAKu7B,MAAMqX,YACV,yBAAKzmB,UAAU,SACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,kCAGzD,6BAAMvsB,KAAKu7B,MAAMqX,cACV,MAEb,yBAAKzmB,UAAU,OACf,yBAAKA,UAAU,kBACb,+BACE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,6BAG1D,kBAACyb,GAAD,CAAU1oC,KAAK,IAAI4oC,QAASloC,KAAKu7B,MAAM0c,MAAOnS,SAAU9lC,KAAKg5C,eAE9Dh5C,KAAKu7B,MAAM8e,SACV,yBAAKluB,UAAU,kBACb,+BACE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,wBAAyBkpB,eAAc,gCAG7D,kBAACyb,GAAD,CAAU1oC,KAAK,WAAW4oC,SAAS,EAAMpC,SAAU9lC,KAAKi5C,mBAG1D,KAEF,yBAAK9sB,UAAU,OACf,yBAAKA,UAAU,kBACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,cAAcE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgsC,WAAW,cAC7F,uBAAGjwB,UAAU,kBAAb,YADF,IACkD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClEkpB,eAAc,gCAGnBvsB,KAAKu7B,MAAM2b,YAAcl3C,KAAKu7B,MAAM4Q,OACnC,oCACE,yBAAKhgB,UAAU,OACf,yBAAKA,UAAU,kBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,sCAI7D,yBAAKJ,UAAU,kBACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,cAAcE,QAASrsB,KAAKo5C,sBAChD,uBAAGjtB,UAAU,kBAAb,cADF,KACqD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,qBACrEkpB,eAAc,mCAGpB,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,gCAEvDwwB,GAAe,kBAAC,GAAD,CACdxsB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBoT,SAAU3jC,KAAKu7B,MAAMgd,YACrBtU,SAAUjkC,KAAKoQ,MAAM6zB,SACrBkB,iBAAkB4X,EAClBvZ,cAAexjC,KAAKu7B,MAAM4c,gBAC1BrV,YAAY,EACZ0B,YAAY,EACZpC,UAAU,EACV4C,UAAU,EACVN,gBAAiB1kC,KAAKs5C,qBACtB3X,kBAAiB3hC,KAAKu7B,MAAMyc,OAAQh4C,KAAKu5C,uBAK/C,QASd,UAAelmB,EAAAA,EAAAA,YAAW0kB,IC1mBpBiF,GAAa,IAAIngB,MAAM,wBAE7B,MAAMogB,WAAyBn2C,IAAAA,UAC7BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXjL,MAAO,KACPqiB,cAAU3xC,EACV02B,OAAQ,KACRqQ,cAAe,GACfyQ,sBAAkBx3C,GAGpBhB,KAAK24C,UAAY34C,KAAK24C,UAAUppB,KAAKvvB,MACrCA,KAAK64C,WAAa74C,KAAK64C,WAAWtpB,KAAKvvB,MACvCA,KAAKk9C,iBAAmBl9C,KAAKk9C,iBAAiB3tB,KAAKvvB,MACnDA,KAAKm9C,iBAAmBn9C,KAAKm9C,iBAAiB5tB,KAAKvvB,MACnDA,KAAKo9C,UAAY,KAGnBxsB,oBACE,MAAMN,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC/CA,IAGLtwB,KAAK24C,UAAUroB,EAAOtwB,KAAKoQ,OrCuEa,GqCtEpCpQ,KAAKoQ,MAAMitC,YACbL,GAAWte,OACX1+B,KAAKo9C,UAAYE,aAAY,IAAMN,GAAWte,QAAQ,KACtD1+B,KAAKoQ,MAAMmtC,UAAUv9C,KAAKoQ,MAAMkgB,MAAOtwB,KAAKoQ,MAAMyhB,OAKtD6K,mBAAmBtsB,GACjB,MAAMkgB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASpgB,EAAMkgB,OAC1CA,IAIDtwB,KAAK64C,YAAcvoB,EAAMuoB,aAC3B74C,KAAKw4C,iBAAmBloB,EAAMuoB,WAC9BvoB,EAAMuoB,WAAa74C,KAAK64C,YAGtB74C,KAAKu7B,MAAMjL,OAASlgB,EAAMkgB,QAC5BtwB,KAAK48B,SAAS,CAACtM,MAAOlgB,EAAMkgB,QAC5BtwB,KAAK24C,UAAUroB,EAAOlgB,KAI1B0gB,uBACwB,MAAlB9wB,KAAKo9C,YACPI,cAAcx9C,KAAKo9C,WACnBJ,GAAWvgB,SAEb,MAAMnM,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC/CA,IAGLtwB,KAAK48B,SAAS,CAACtM,MAAO,OACtBA,EAAMuoB,WAAa74C,KAAKw4C,kBAG1BG,UAAUroB,EAAOlgB,GACAkgB,EAAM2pB,mBACT3pB,EAAMmiB,gBADlB,MAEMjf,EAAS,GACf,GAAIlD,EAAMqU,QACR,IAAK,MAAO1+B,EAAKuP,KAAQ5V,OAAOmS,QAAQue,EAAMqU,SACxCnvB,GACFge,EAAO3vB,KAAKoC,GAKlBjG,KAAK48B,SAAS,CACZ+V,SAAUnb,GAAQlH,EAAM0T,OAAS1T,EAAM0T,OAAO9mB,QAAKlc,EAAWssB,IAC9DoK,OAAQW,GAAa/H,EAAM0T,OAAS1T,EAAM0T,OAAO7N,MAAQ,MACzD4R,cAAevU,IAInBqlB,WAAWlF,GACT,MAAMrjB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKoQ,MAAMkgB,OAC/CA,IAGLtwB,KAAK24C,UAAUroB,EAAOtwB,KAAKoQ,OAEvBpQ,KAAKw4C,kBAAoBx4C,KAAKw4C,kBAAoBx4C,KAAK64C,YACzD74C,KAAKw4C,iBAAiB7E,IAI1BwJ,mBACEn9C,KAAKoQ,MAAMqtC,aAAaz9C,KAAKoQ,MAAMkgB,OAGrC4sB,mBACEl9C,KAAKoQ,MAAMgc,SAASpsB,KAAKoQ,MAAMkgB,MAAOtwB,KAAKoQ,MAAMyhB,KACjD7xB,KAAKoQ,MAAMstC,UAGbzxB,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KACnC,IAAIqtB,EAAa,UAMjB,OrChBwC,GqCWpC18C,KAAKoQ,MAAMitC,YACbX,EAAa,kBAAC,EAAApwB,iBAAD,CAAkBjpB,GAAE,uBAC7BkpB,eAAc,oCAIlB,yBAAKlpB,GAAG,aACN,yBAAK8oB,UAAU,gBAAgB9oB,GAAG,sBAChC,yBAAK8oB,UAAU,cAAc9oB,GAAG,cAAcq5C,GAC9C,6BACE,kBAACvU,GAAD,CAAY9I,SAAUr/B,KAAKk9C,qBAG/B,yBAAK75C,GAAG,oBAAoB8oB,UAAU,oBACpC,yBAAKA,UAAU,qBACb,gCACE,kBAAC8a,GAAD,CACE1W,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQ13B,KAAKu7B,MAAM7D,OACnB6P,UAAU,EACVhB,IAAKvmC,KAAKoQ,MAAMkgB,MAChBpI,MAAOloB,KAAKu7B,MAAMoX,YAEtB,yBAAKxmB,UAAU,6BACb,yBAAKA,UAAU,oBAAoBqL,GAAQx3B,KAAKu7B,MAAMoX,YAExD,yBAAKxmB,UAAU,8BACb,kBAAC,GAAD,CAAW4b,cAAe/nC,KAAKu7B,MAAMwM,iBAEvC,yBAAK1kC,GAAG,UAAU8oB,UAAU,+BrCxCI,GqCyC7BnsB,KAAKoQ,MAAMitC,UACV,oCACE,4BAAQlxB,UAAU,oBAAoBE,QAASrsB,KAAKk9C,kBAClD,uBAAG/wB,UAAU,kBAAb,aAEF,4BAAQA,UAAU,oBAAoBE,QAASrsB,KAAKm9C,kBAClD,uBAAGhxB,UAAU,kBAAb,UAIJ,UAUhB,UAAekH,EAAAA,EAAAA,YAAW4pB,IClKX,MAAMU,WAAkB72C,IAAAA,cACrChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXqiB,iBAAa58C,EACb68C,QAAI78C,EAEJ88C,oBAAgB98C,GAGlBhB,KAAK+9C,uBAAyB,CAC5BC,OAAO,EACPC,OAAO,GAGTj+C,KAAKk+C,SAAWp3C,IAAAA,YAChB9G,KAAKm+C,UAAYr3C,IAAAA,YAEjB9G,KAAKo+C,OAASp+C,KAAKo+C,OAAO7uB,KAAKvvB,MAC/BA,KAAKq+C,MAAQr+C,KAAKq+C,MAAM9uB,KAAKvvB,MAE7BA,KAAKs+C,qBAAuBt+C,KAAKs+C,qBAAqB/uB,KAAKvvB,MAE3DA,KAAKu+C,6BAA+Bv+C,KAAKu+C,6BAA6BhvB,KAAKvvB,MAC3EA,KAAKw+C,wBAA0Bx+C,KAAKw+C,wBAAwBjvB,KAAKvvB,MACjEA,KAAKy+C,yBAA2Bz+C,KAAKy+C,yBAAyBlvB,KAAKvvB,MACnEA,KAAK0+C,oCAAsC1+C,KAAK0+C,oCAAoCnvB,KAAKvvB,MACzFA,KAAK2+C,gCAAkC3+C,KAAK2+C,gCAAgCpvB,KAAKvvB,MACjFA,KAAK4+C,mCAAqC5+C,KAAK4+C,mCAAmCrvB,KAAKvvB,MACvFA,KAAK6+C,iBAAmB7+C,KAAK6+C,iBAAiBtvB,KAAKvvB,MAEnDA,KAAK8+C,oBAAsB9+C,KAAK8+C,oBAAoBvvB,KAAKvvB,MACzDA,KAAK++C,qBAAuB/+C,KAAK++C,qBAAqBxvB,KAAKvvB,MAC3DA,KAAKy+C,yBAA2Bz+C,KAAKy+C,yBAAyBlvB,KAAKvvB,MAEnEA,KAAKg/C,YAAch/C,KAAKg/C,YAAYzvB,KAAKvvB,MACzCA,KAAKi/C,wBAA0Bj/C,KAAKi/C,wBAAwB1vB,KAAKvvB,MAEjEA,KAAKk/C,KAAOl/C,KAAKk/C,KAAK3vB,KAAKvvB,MAC3BA,KAAKm/C,WAAan/C,KAAKm/C,WAAW5vB,KAAKvvB,MAEvCA,KAAKo/C,iBAAmBp/C,KAAKo/C,iBAAiB7vB,KAAKvvB,MACnDA,KAAKq/C,wBAA0Br/C,KAAKq/C,wBAAwB9vB,KAAKvvB,MACjEA,KAAKs/C,qBAAuBt/C,KAAKs/C,qBAAqB/vB,KAAKvvB,MAC3DA,KAAKu/C,YAAcv/C,KAAKu/C,YAAYhwB,KAAKvvB,MAEzCA,KAAKw/C,mBAAqBx/C,KAAKw/C,mBAAmBjwB,KAAKvvB,MACvDA,KAAKy/C,wBAA0Bz/C,KAAKy/C,wBAAwBlwB,KAAKvvB,MAGnEy/C,wBAAwB/7C,GACtB,MAAMm6C,EAAK79C,KAAKs+C,uBACVoB,EAAS1/C,KAAKu7B,MAAMqiB,YAC1B8B,EAAOC,YAAY1kB,SAAQ2kB,IACzBj7C,QAAQC,IAAI,6BAA8Bg7C,EAAMv8C,GAAIu8C,EAAMC,KAAMD,EAAME,YACtEjC,EAAGkC,SAASH,EAAOF,MAIvBtB,OAAO16C,GAEL,GADAiB,QAAQC,IAAI,eAAalB,GACR,QAAbA,EAAKs8C,KAGT,OAAQt8C,EAAK+J,OACX,IAAK,SAEHzN,KAAKy/C,wBAAwB/7C,GAC7B,MACF,IAAK,QACH1D,KAAK8+C,oBAAoBp7C,GACzB,MACF,IAAK,SACH1D,KAAK++C,qBAAqBr7C,GAC1B,MACF,IAAK,gBACH1D,KAAKy+C,yBAAyB/6C,GAC9B,MACF,IAAK,UACH1D,KAAKw/C,mBAAmB97C,IAK9BktB,oBACE,MAAMN,EAAQtwB,KAAKoQ,MAAMkgB,MACzBtwB,KAAK89C,eAAiBxtB,EAAM8tB,OAC5B9tB,EAAM8tB,OAASp+C,KAAKo+C,OtCYoB,GsCXnCp+C,KAAKoQ,MAAMitC,WtCakB,GsCZ7Br9C,KAAKoQ,MAAMitC,YAAwCr9C,KAAKk+C,SAASltB,SACpEhxB,KAAKq+C,QAITvtB,uBACE9wB,KAAKoQ,MAAMkgB,MAAM8tB,OAASp+C,KAAK89C,eAC/Bn5C,QAAQC,IAAI,sBACZ5E,KAAKk/C,OAGPb,QACE,GAAIr+C,KAAKu7B,MAAMqiB,YACbj5C,QAAQC,IAAI,iEACP,CACL,GtCHgC,GsCG5B5E,KAAKoQ,MAAMitC,UAGb,YADAr9C,KAAKoQ,MAAM6vC,SAASjgD,KAAKoQ,MAAMkgB,MAAMhxB,KAAMU,KAAKoQ,MAAMyhB,IAAK7xB,KAAKoQ,MAAMitC,WAKxEx9B,UAAUqgC,aAAaC,aAAangD,KAAK+9C,wBACtC9kC,MAAKymC,IACJ1/C,KAAK48B,SAAS,CAACghB,YAAa8B,IAC5B1/C,KAAKk+C,SAASltB,QAAQovB,UAAYV,EAElC1/C,KAAKoQ,MAAM6vC,SAASjgD,KAAKoQ,MAAMkgB,MAAMhxB,KAAMU,KAAKoQ,MAAMyhB,IAAK7xB,KAAKoQ,MAAMitC,cAEvE1yC,MAAM3K,KAAKi/C,0BAIlBX,uBACE,IAAIT,EAAK,IAAIwC,kBAAkB7yB,IAW/B,OATAqwB,EAAGyC,eAAiBtgD,KAAKw+C,wBACzBX,EAAG0C,2BAA6BvgD,KAAK0+C,oCACrCb,EAAG2C,0BAA4BxgD,KAAK4+C,mCACpCf,EAAG4C,uBAAyBzgD,KAAK2+C,gCACjCd,EAAG6C,oBAAsB1gD,KAAKu+C,6BAC9BV,EAAG8C,QAAU3gD,KAAK6+C,iBAElB7+C,KAAK48B,SAAS,CAACihB,GAAIA,IACnBl5C,QAAQC,IAAI,8BACLi5C,EAGTkB,qBAAqBr7C,GACnBiB,QAAQC,IAAI,4CAKZ,IAAI+uC,EAAO,IAAIiN,sBAAsBl9C,EAAKikB,SAC1C3nB,KAAKu7B,MAAMsiB,GAAGgD,qBAAqBlN,GAAMhpC,MAAM3K,KAAKg/C,aAGtDA,YAAY8B,GACVn8C,QAAQC,IAAR,gBAAqBk8C,EAAWxhD,KAAhC,aAAyCwhD,EAAWp8C,UAGtD65C,+BACEv+C,KAAKu7B,MAAMsiB,GAAGkD,cAAc9nC,MAAK+nC,GACxBhhD,KAAKu7B,MAAMsiB,GAAGoD,oBAAoBD,KAE1C/nC,MAAK,KACJjZ,KAAKoQ,MAAM8wC,YAAYlhD,KAAKoQ,MAAMkgB,MAAMhxB,KAAMU,KAAKoQ,MAAMyhB,IAAK7xB,KAAKu7B,MAAMsiB,GAAGsD,iBAAiBC,aAE9Fz2C,MAAM3K,KAAKg/C,aAGdR,wBAAwB/wC,GAClBA,EAAM4zC,WACRrhD,KAAKoQ,MAAMkxC,eAAethD,KAAKoQ,MAAMkgB,MAAMhxB,KAAMU,KAAKoQ,MAAMyhB,IAAKpkB,EAAM4zC,UAAUD,UAIrF3C,yBAAyB/6C,GACvB,IAAI29C,EAAY,IAAIE,gBAAgB79C,EAAKikB,SAEzC3nB,KAAKu7B,MAAMsiB,GAAG2D,gBAAgBH,GAC3B12C,MAAM3K,KAAKg/C,aAGhBN,oCAAoCjxC,GAClC,OAAQzN,KAAKu7B,MAAMsiB,GAAG4D,oBACpB,IAAK,SACL,IAAK,SACHzhD,KAAKo/C,oBAKXT,gCAAgClxC,GAC9B,GACO,WADCzN,KAAKu7B,MAAMsiB,GAAG6D,eAElB1hD,KAAKo/C,mBAKXR,mCAAmCnxC,GACjC9I,QAAQC,IAAI,+BAAgC6I,GAG9CoxC,iBAAiBpxC,GACfzN,KAAKm+C,UAAUntB,QAAQovB,UAAY3yC,EAAMk0C,QAAQ,GAEjD3hD,KAAK4hD,cAGP3C,wBAAwBx4C,GAEtB,OADA9B,QAAQC,IAAI,SAAO6B,GACZA,EAAEnH,MACP,IAAK,gBACHqF,QAAQC,IAAI,2EAEZ,MACF,IAAK,gBACL,IAAK,wBAEH,MACF,QACED,QAAQC,IAAI,gDAAkD6B,EAAE/B,SAMpE1E,KAAKo/C,mBAGPN,oBAAoBp7C,GAClB,IAAIk6C,EAAc,KAElB,MAAMC,EAAK79C,KAAKs+C,uBAEhB,IAAI3K,EAAO,IAAIiN,sBAAsBl9C,EAAKikB,SAE1Ck2B,EAAGgD,qBAAqBlN,GAAM16B,MAAK,KACjCtU,QAAQC,IAAI,6DACLib,UAAUqgC,aAAaC,aAAangD,KAAK+9C,2BAEjD9kC,MAAKymC,IACJ9B,EAAc8B,EACd1/C,KAAKk+C,SAASltB,QAAQovB,UAAYV,EAClC1/C,KAAK48B,SAAS,CAACghB,YAAa8B,IAE5B9B,EAAY+B,YAAY1kB,SAAQ2kB,IAC9Bj7C,QAAQC,IAAI,+BAAgCg7C,EAAMv8C,GAAIu8C,EAAMC,KAAMD,EAAME,YACxEjC,EAAGkC,SAASH,EAAOhC,SAGtB3kC,MAAK,IACG4kC,EAAGgE,iBAEX5oC,MAAK6oC,GACGjE,EAAGoD,oBAAoBa,KAE/B7oC,MAAK,KACJjZ,KAAKoQ,MAAM2xC,aAAa/hD,KAAKoQ,MAAMkgB,MAAMhxB,KAAMU,KAAKoQ,MAAMyhB,IAAKgsB,EAAGsD,iBAAiBC,aAEpFz2C,MAAM3K,KAAKi/C,yBAGdO,qBACEx/C,KAAKo/C,mBAGPD,WAAWtf,GACT,GAAU,MAANA,EAAc,OAClB,IAAI6f,EAAS7f,EAAGugB,UAChB,GAAc,MAAVV,EAAkB,OACtB,IAAIsC,EAAStC,EAAOC,YAEN,MAAVqC,GACFA,EAAO/mB,SAAS2kB,IACdA,EAAMV,OACNU,EAAMqC,SAAU,EAChBt9C,QAAQC,IAAI,iBAAkBg7C,EAAMv8C,GAAIu8C,EAAMC,KAAMD,EAAME,eAG9DjgB,EAAGugB,UAAY,KACfvgB,EAAG5H,IAAM,GAGXinB,OACEl/C,KAAKm/C,WAAWn/C,KAAKk+C,SAASltB,SAC9BhxB,KAAKm/C,WAAWn/C,KAAKm+C,UAAUntB,SACV,MAAjBhxB,KAAKu7B,MAAMsiB,KACb79C,KAAKu7B,MAAMsiB,GAAG8C,QAAU,KACxB3gD,KAAKu7B,MAAMsiB,GAAGqE,cAAgB,KAC9BliD,KAAKu7B,MAAMsiB,GAAGsE,eAAiB,KAC/BniD,KAAKu7B,MAAMsiB,GAAGyC,eAAiB,KAC/BtgD,KAAKu7B,MAAMsiB,GAAG0C,2BAA6B,KAC3CvgD,KAAKu7B,MAAMsiB,GAAG4C,uBAAyB,KACvCzgD,KAAKu7B,MAAMsiB,GAAG2C,0BAA4B,KAC1CxgD,KAAKu7B,MAAMsiB,GAAG6C,oBAAsB,KAEpC1gD,KAAKu7B,MAAMsiB,GAAGxyC,SAEhBrL,KAAK48B,SAAS,CAACihB,GAAI,OAGrBuB,mBACEp/C,KAAKk/C,OACLl/C,KAAKoQ,MAAMgyC,SAASpiD,KAAKoQ,MAAMkgB,MAAMhxB,KAAMU,KAAKoQ,MAAMyhB,KAIxD0tB,YAAYM,GACK7/C,KAAKu7B,MAAMqiB,YACnB+B,YAAY1kB,SAAQ2kB,IACrBA,EAAMC,MAAQA,IAGlBl7C,QAAQC,IAAI,gCAAiCg7C,EAAMv8C,GAAIu8C,EAAMC,KAAMD,EAAME,YACzEF,EAAMqC,SAAWrC,EAAMqC,YAGzBjiD,KAAK4hD,cAGPvC,0BACEr/C,KAAKu/C,YAAY,SAGnBD,uBACEt/C,KAAKu/C,YAAY,SAGnBtzB,SACE,IAAKjsB,KAAKoQ,MAAMkgB,MACd,OAAO,KAGT,MAAM+xB,EAAyC,MAA1BriD,KAAKm+C,UAAUntB,SAAuD,MAApChxB,KAAKm+C,UAAUntB,QAAQovB,UACxEkC,EAAsC,MAA1BtiD,KAAKu7B,MAAMqiB,aAAuB59C,KAAKu7B,MAAMqiB,YAAY2E,iBAAiB,GAAGN,QAAU,MAAQ,UAC3GO,EAAsC,MAA1BxiD,KAAKu7B,MAAMqiB,aAAuB59C,KAAKu7B,MAAMqiB,YAAY6E,iBAAiB,GAAGR,QAAU,WAAa,eAEtH,OACE,oCACE,yBAAK5+C,GAAG,sBAAsB8oB,UAAU,iBACrCnsB,KAAKoQ,MAAMusC,cACV,uBAAGnnB,KAAK,IAAInyB,GAAG,oBAAoBgpB,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMsyC,uBACjF,uBAAGv2B,UAAU,kBAAb,eAGF,KACF,yBAAKA,UAAU,cACb,kBAACsL,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQ13B,KAAKoQ,MAAMsnB,OACnBpH,MAAOtwB,KAAKoQ,MAAMkgB,MAClBpI,MAAOloB,KAAKoQ,MAAM8X,SAEtB,yBAAK7kB,GAAG,qBACN,yBAAKA,GAAG,cAAc8oB,UAAU,eAC9BnsB,KAAKoQ,MAAM8X,OACX,2BAAG,kBAAC,EAAAoE,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,iCAK5D,yBAAKlpB,GAAG,mBACN,yBAAK8oB,UAAU,yBACb,yBAAKA,UAAU,cACb,2BAAO9oB,GAAG,aAAa+vB,IAAKpzB,KAAKk+C,SAAUyE,UAAQ,EAAC1K,OAAK,EAAC2K,aAAW,IACrE,yBAAKz2B,UAAU,eACb,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClBkpB,eAAc,2BAGpB,yBAAKJ,UAAU,cACb,2BAAO9oB,GAAG,cAAc+vB,IAAKpzB,KAAKm+C,UAAWwE,UAAQ,EAACC,aAAW,IAChEP,EACC,yBAAKl2B,UAAU,eAAeqL,GAAQx3B,KAAKoQ,MAAM8X,MAAOoF,KAExD,OAGN,yBAAKjqB,GAAG,4BACN,4BAAQ8oB,UAAU,oBAAoBE,QAASrsB,KAAKo/C,kBAClD,uBAAGjzB,UAAU,kBAAb,aAEF,4BAAQA,UAAU,0BAA0BE,QAASrsB,KAAKq/C,yBAAyB,uBAAGlzB,UAAU,kBAAkBq2B,IAClH,4BAAQr2B,UAAU,0BAA0BE,QAASrsB,KAAKs/C,sBAAsB,uBAAGnzB,UAAU,kBAAkBm2B,KAEjH,4BAAQrqB,IAAI,0DCtXtB,IAAI4qB,GAAgB,SAAS/8C,EAAG6G,GAI5B,OAHAk2C,GAAgBjjD,OAAOkM,gBAClB,CAAEg3C,UAAW,cAAgB36C,OAAS,SAAUrC,EAAG6G,GAAK7G,EAAEg9C,UAAYn2C,IACvE,SAAU7G,EAAG6G,GAAK,IAAK,IAAIvF,KAAKuF,EAAO/M,OAAOD,UAAUkH,eAAe3G,KAAKyM,EAAGvF,KAAItB,EAAEsB,GAAKuF,EAAEvF,KACzFy7C,GAAc/8C,EAAG6G,IAGrB,SAASo2C,GAAUj9C,EAAG6G,GACzB,GAAiB,mBAANA,GAA0B,OAANA,EAC3B,MAAM,IAAI8I,UAAU,uBAAyBjM,OAAOmD,GAAK,iCAE7D,SAASq2C,IAAOhjD,KAAKF,YAAcgG,EADnC+8C,GAAc/8C,EAAG6G,GAEjB7G,EAAEnG,UAAkB,OAANgN,EAAa/M,OAAOC,OAAO8M,IAAMq2C,EAAGrjD,UAAYgN,EAAEhN,UAAW,IAAIqjD,GAG5E,IAAIC,GAAW,WAQlB,OAPAA,GAAWrjD,OAAOiX,QAAU,SAAkBqsC,GAC1C,IAAK,IAAIC,EAAGlhD,EAAI,EAAG0D,EAAIy9C,UAAU/iD,OAAQ4B,EAAI0D,EAAG1D,IAE5C,IAAK,IAAImF,KADT+7C,EAAIC,UAAUnhD,GACOrC,OAAOD,UAAUkH,eAAe3G,KAAKijD,EAAG/7C,KAAI87C,EAAE97C,GAAK+7C,EAAE/7C,IAE9E,OAAO87C,GAEJD,GAASI,MAAMrjD,KAAMojD,YAoEHxjD,OAAOC,OAyD7B,SAASyjD,GAAcC,EAAIrxC,EAAMsxC,GACpC,GAAIA,GAA6B,IAArBJ,UAAU/iD,OAAc,IAAK,IAA4BojD,EAAxBxhD,EAAI,EAAGs0B,EAAIrkB,EAAK7R,OAAY4B,EAAIs0B,EAAGt0B,KACxEwhD,GAAQxhD,KAAKiQ,IACRuxC,IAAIA,EAAKt7C,MAAMxI,UAAU8D,MAAMvD,KAAKgS,EAAM,EAAGjQ,IAClDwhD,EAAGxhD,GAAKiQ,EAAKjQ,IAGrB,OAAOshD,EAAG3iB,OAAO6iB,GAAMt7C,MAAMxI,UAAU8D,MAAMvD,KAAKgS,IAsCtD,ICjNWwxC,GCAAC,GAwCAC,GFyKchkD,OAAOC,OEjKzB,SAASgkD,GAAiBhkB,GAC7B,OAAOA,EAAGtgC,OAASokD,GAAKG,QAErB,SAASC,GAAkBlkB,GAC9B,OAAOA,EAAGtgC,OAASokD,GAAKK,SAErB,SAASC,GAAgBpkB,GAC5B,OAAOA,EAAGtgC,OAASokD,GAAKO,OAErB,SAASC,GAActkB,GAC1B,OAAOA,EAAGtgC,OAASokD,GAAKxqC,KAErB,SAASirC,GAAcvkB,GAC1B,OAAOA,EAAGtgC,OAASokD,GAAKU,KAErB,SAASC,GAAgBzkB,GAC5B,OAAOA,EAAGtgC,OAASokD,GAAKY,OAErB,SAASC,GAAgB3kB,GAC5B,OAAOA,EAAGtgC,OAASokD,GAAKc,OAErB,SAASC,GAAe7kB,GAC3B,OAAOA,EAAGtgC,OAASokD,GAAKgB,MAErB,SAASC,GAAa/kB,GACzB,OAAOA,EAAGtgC,OAASokD,GAAK1R,IAErB,SAAS4S,GAAiBhlB,GAC7B,SAAUA,GAAoB,iBAAPA,GAAmBA,EAAGtgC,OAASqkD,GAAcM,QAEjE,SAASY,GAAmBjlB,GAC/B,SAAUA,GAAoB,iBAAPA,GAAmBA,EAAGtgC,OAASqkD,GAAcmB,WD9ExE,SAAWrB,GAEPA,EAAUA,EAAyC,8BAAI,GAAK,gCAE5DA,EAAUA,EAA0B,eAAI,GAAK,iBAE7CA,EAAUA,EAA8B,mBAAI,GAAK,qBAEjDA,EAAUA,EAAgC,qBAAI,GAAK,uBAEnDA,EAAUA,EAAiC,sBAAI,GAAK,wBAEpDA,EAAUA,EAAiC,sBAAI,GAAK,wBAEpDA,EAAUA,EAAmC,wBAAI,GAAK,0BAEtDA,EAAUA,EAAsC,2BAAI,GAAK,6BAEzDA,EAAUA,EAAkC,uBAAI,GAAK,yBAErDA,EAAUA,EAAqC,0BAAI,IAAM,4BAEzDA,EAAUA,EAA4C,iCAAI,IAAM,mCAEhEA,EAAUA,EAA0C,+BAAI,IAAM,iCAE9DA,EAAUA,EAA+C,oCAAI,IAAM,sCAEnEA,EAAUA,EAAgD,qCAAI,IAAM,uCAEpEA,EAAUA,EAA2C,gCAAI,IAAM,kCAE/DA,EAAUA,EAA2C,gCAAI,IAAM,kCAE/DA,EAAUA,EAAoD,yCAAI,IAAM,2CAKxEA,EAAUA,EAAoD,yCAAI,IAAM,2CAExEA,EAAUA,EAA4C,iCAAI,IAAM,mCAKhEA,EAAUA,EAA8C,mCAAI,IAAM,qCAIlEA,EAAUA,EAA8C,mCAAI,IAAM,qCAElEA,EAAUA,EAAgC,qBAAI,IAAM,uBAEpDA,EAAUA,EAAuB,YAAI,IAAM,cAE3CA,EAAUA,EAA4B,iBAAI,IAAM,mBAEhDA,EAAUA,EAAiC,sBAAI,IAAM,wBAErDA,EAAUA,EAAwB,aAAI,IAAM,eA5DhD,CA6DGA,KAAcA,GAAY,KC7D7B,SAAWC,GAIPA,EAAKA,EAAc,QAAI,GAAK,UAI5BA,EAAKA,EAAe,SAAI,GAAK,WAI7BA,EAAKA,EAAa,OAAI,GAAK,SAI3BA,EAAKA,EAAW,KAAI,GAAK,OAIzBA,EAAKA,EAAW,KAAI,GAAK,OAIzBA,EAAKA,EAAa,OAAI,GAAK,SAI3BA,EAAKA,EAAa,OAAI,GAAK,SAK3BA,EAAKA,EAAY,MAAI,GAAK,QAI1BA,EAAKA,EAAU,IAAI,GAAK,MArC5B,CAsCGA,KAASA,GAAO,KAEnB,SAAWC,GACPA,EAAcA,EAAsB,OAAI,GAAK,SAC7CA,EAAcA,EAAwB,SAAI,GAAK,WAFnD,CAGGA,KAAkBA,GAAgB,KC3C9B,IAAIoB,GAAwB,+CCI/BC,GAAkB,4KAOf,SAASC,GAAsBC,GAClC,IAAI3jD,EAAS,GA0Gb,OAzGA2jD,EAAS96C,QAAQ46C,IAAiB,SAAUntC,GACxC,IAAIxU,EAAMwU,EAAMzX,OAChB,OAAQyX,EAAM,IAEV,IAAK,IACDtW,EAAO4jD,IAAc,IAAR9hD,EAAY,OAAiB,IAARA,EAAY,SAAW,QACzD,MAEJ,IAAK,IACD9B,EAAO6jD,KAAe,IAAR/hD,EAAY,UAAY,UACtC,MACJ,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACD,MAAM,IAAIgiD,WAAW,gEAEzB,IAAK,IACL,IAAK,IACD,MAAM,IAAIA,WAAW,8CAEzB,IAAK,IACL,IAAK,IACD9jD,EAAO+jD,MAAQ,CAAC,UAAW,UAAW,QAAS,OAAQ,UAAUjiD,EAAM,GACvE,MAEJ,IAAK,IACL,IAAK,IACD,MAAM,IAAIgiD,WAAW,2CACzB,IAAK,IACD9jD,EAAOgkD,IAAM,CAAC,UAAW,WAAWliD,EAAM,GAC1C,MACJ,IAAK,IACL,IAAK,IACL,IAAK,IACD,MAAM,IAAIgiD,WAAW,6DAEzB,IAAK,IACD9jD,EAAOikD,QAAkB,IAARniD,EAAY,QAAkB,IAARA,EAAY,SAAW,QAC9D,MACJ,IAAK,IACD,GAAIA,EAAM,EACN,MAAM,IAAIgiD,WAAW,iDAEzB9jD,EAAOikD,QAAU,CAAC,QAAS,OAAQ,SAAU,SAASniD,EAAM,GAC5D,MACJ,IAAK,IACD,GAAIA,EAAM,EACN,MAAM,IAAIgiD,WAAW,iDAEzB9jD,EAAOikD,QAAU,CAAC,QAAS,OAAQ,SAAU,SAASniD,EAAM,GAC5D,MAEJ,IAAK,IACD9B,EAAOkkD,QAAS,EAChB,MACJ,IAAK,IACL,IAAK,IACD,MAAM,IAAIJ,WAAW,8DAEzB,IAAK,IACD9jD,EAAOmkD,UAAY,MACnBnkD,EAAOokD,KAAO,CAAC,UAAW,WAAWtiD,EAAM,GAC3C,MACJ,IAAK,IACD9B,EAAOmkD,UAAY,MACnBnkD,EAAOokD,KAAO,CAAC,UAAW,WAAWtiD,EAAM,GAC3C,MACJ,IAAK,IACD9B,EAAOmkD,UAAY,MACnBnkD,EAAOokD,KAAO,CAAC,UAAW,WAAWtiD,EAAM,GAC3C,MACJ,IAAK,IACD9B,EAAOmkD,UAAY,MACnBnkD,EAAOokD,KAAO,CAAC,UAAW,WAAWtiD,EAAM,GAC3C,MACJ,IAAK,IACL,IAAK,IACL,IAAK,IACD,MAAM,IAAIgiD,WAAW,oEAEzB,IAAK,IACD9jD,EAAOqkD,OAAS,CAAC,UAAW,WAAWviD,EAAM,GAC7C,MAEJ,IAAK,IACD9B,EAAOskD,OAAS,CAAC,UAAW,WAAWxiD,EAAM,GAC7C,MACJ,IAAK,IACL,IAAK,IACD,MAAM,IAAIgiD,WAAW,8DAEzB,IAAK,IACD9jD,EAAOukD,aAAeziD,EAAM,EAAI,QAAU,OAC1C,MACJ,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACD,MAAM,IAAIgiD,WAAW,wEAE7B,MAAO,MAEJ9jD,ECtHJ,IAAI,GAAoB,wCC8B/B,IC/BIiK,GD+BAu6C,GAA2B,mCAC3BC,GAA8B,wBAC9BC,GAAsB,0BACtBC,GAA8B,SAClC,SAASC,GAA0Bl/C,GAC/B,IAAI1F,EAAS,GA6Bb,MA5B4B,MAAxB0F,EAAIA,EAAI7G,OAAS,GACjBmB,EAAO6kD,iBAAmB,gBAEG,MAAxBn/C,EAAIA,EAAI7G,OAAS,KACtBmB,EAAO6kD,iBAAmB,iBAE9Bn/C,EAAImD,QAAQ47C,IAA6B,SAAU15C,EAAG+5C,EAAIC,GAoBtD,MAlBkB,iBAAPA,GACP/kD,EAAOglD,yBAA2BF,EAAGjmD,OACrCmB,EAAOilD,yBAA2BH,EAAGjmD,QAGzB,MAAPkmD,EACL/kD,EAAOglD,yBAA2BF,EAAGjmD,OAGtB,MAAVimD,EAAG,GACR9kD,EAAOilD,yBAA2BH,EAAGjmD,QAIrCmB,EAAOglD,yBAA2BF,EAAGjmD,OACrCmB,EAAOilD,yBACHH,EAAGjmD,QAAwB,iBAAPkmD,EAAkBA,EAAGlmD,OAAS,IAEnD,MAEJmB,EAEX,SAASklD,GAAUx/C,GACf,OAAQA,GACJ,IAAK,YACD,MAAO,CACHy/C,YAAa,QAErB,IAAK,kBACL,IAAK,KACD,MAAO,CACHC,aAAc,cAEtB,IAAK,cACL,IAAK,KACD,MAAO,CACHD,YAAa,UAErB,IAAK,yBACL,IAAK,MACD,MAAO,CACHA,YAAa,SACbC,aAAc,cAEtB,IAAK,mBACL,IAAK,KACD,MAAO,CACHD,YAAa,cAErB,IAAK,8BACL,IAAK,MACD,MAAO,CACHA,YAAa,aACbC,aAAc,cAEtB,IAAK,aACL,IAAK,KACD,MAAO,CACHD,YAAa,UAI7B,SAASE,GAAyCC,GAE9C,IAAItlD,EAaJ,GAZgB,MAAZslD,EAAK,IAA0B,MAAZA,EAAK,IACxBtlD,EAAS,CACLulD,SAAU,eAEdD,EAAOA,EAAKrjD,MAAM,IAED,MAAZqjD,EAAK,KACVtlD,EAAS,CACLulD,SAAU,cAEdD,EAAOA,EAAKrjD,MAAM,IAElBjC,EAAQ,CACR,IAAImlD,EAAcG,EAAKrjD,MAAM,EAAG,GAShC,GARoB,OAAhBkjD,GACAnlD,EAAOmlD,YAAc,SACrBG,EAAOA,EAAKrjD,MAAM,IAEG,OAAhBkjD,IACLnlD,EAAOmlD,YAAc,aACrBG,EAAOA,EAAKrjD,MAAM,KAEjB0iD,GAA4BpoC,KAAK+oC,GAClC,MAAM,IAAIz+C,MAAM,6CAEpB7G,EAAOwlD,qBAAuBF,EAAKzmD,OAEvC,OAAOmB,EAEX,SAASylD,GAAqBC,GAC1B,IACIC,EAAWT,GAAUQ,GACzB,OAAIC,GAFS,GAUV,SAASC,GAAoBC,GAEhC,IADA,IAAI7lD,EAAS,GACJ8lD,EAAK,EAAGC,EAAWF,EAAQC,EAAKC,EAASlnD,OAAQinD,IAAM,CAC5D,IAAI7rC,EAAQ8rC,EAASD,GACrB,OAAQ7rC,EAAMqrC,MACV,IAAK,UACL,IAAK,IACDtlD,EAAO2xB,MAAQ,UACf,SACJ,IAAK,QACD3xB,EAAO2xB,MAAQ,UACf3xB,EAAOq3B,MAAQ,IACf,SACJ,IAAK,WACDr3B,EAAO2xB,MAAQ,WACf3xB,EAAOgmD,SAAW/rC,EAAM1a,QAAQ,GAChC,SACJ,IAAK,YACL,IAAK,KACDS,EAAOimD,aAAc,EACrB,SACJ,IAAK,oBACL,IAAK,IACDjmD,EAAOkmD,sBAAwB,EAC/B,SACJ,IAAK,eACL,IAAK,OACDlmD,EAAO2xB,MAAQ,OACf3xB,EAAOmmD,KAAqBlsC,EAAM1a,QAAQ,GArJ1CsJ,QAAQ,UAAW,IAsJnB,SACJ,IAAK,gBACL,IAAK,IACD7I,EAAOulD,SAAW,UAClBvlD,EAAOomD,eAAiB,QACxB,SACJ,IAAK,eACL,IAAK,KACDpmD,EAAOulD,SAAW,UAClBvlD,EAAOomD,eAAiB,OACxB,SACJ,IAAK,aACDpmD,EAASyhD,GAASA,GAASA,GAAS,GAAIzhD,GAAS,CAAEulD,SAAU,eAAiBtrC,EAAM1a,QAAQ8mD,QAAO,SAAUz1C,EAAK80C,GAAO,OAAQjE,GAASA,GAAS,GAAI7wC,GAAM60C,GAAqBC,MAAW,KAC7L,SACJ,IAAK,cACD1lD,EAASyhD,GAASA,GAASA,GAAS,GAAIzhD,GAAS,CAAEulD,SAAU,gBAAkBtrC,EAAM1a,QAAQ8mD,QAAO,SAAUz1C,EAAK80C,GAAO,OAAQjE,GAASA,GAAS,GAAI7wC,GAAM60C,GAAqBC,MAAW,KAC9L,SACJ,IAAK,kBACD1lD,EAAOulD,SAAW,WAClB,SAEJ,IAAK,oBACDvlD,EAAOsmD,gBAAkB,eACzBtmD,EAAOumD,YAAc,SACrB,SACJ,IAAK,mBACDvmD,EAAOsmD,gBAAkB,OACzBtmD,EAAOumD,YAAc,QACrB,SACJ,IAAK,uBACDvmD,EAAOsmD,gBAAkB,OACzBtmD,EAAOumD,YAAc,OACrB,SACJ,IAAK,sBACDvmD,EAAOsmD,gBAAkB,SACzB,SACJ,IAAK,QACDtmD,EAAOq3B,MAAQmvB,WAAWvsC,EAAM1a,QAAQ,IACxC,SAEJ,IAAK,gBACD,GAAI0a,EAAM1a,QAAQV,OAAS,EACvB,MAAM,IAAIilD,WAAW,4DAEzB7pC,EAAM1a,QAAQ,GAAGsJ,QAAQ67C,IAAqB,SAAU35C,EAAG+5C,EAAIC,EAAI0B,EAAIC,EAAIC,GACvE,GAAI7B,EACA9kD,EAAOwlD,qBAAuBT,EAAGlmD,WAEhC,IAAI4nD,GAAMC,EACX,MAAM,IAAI7/C,MAAM,sDAEf,GAAI8/C,EACL,MAAM,IAAI9/C,MAAM,oDAEpB,MAAO,MAEX,SAGR,GAAI89C,GAA4BpoC,KAAKtC,EAAMqrC,MACvCtlD,EAAOwlD,qBAAuBvrC,EAAMqrC,KAAKzmD,YAG7C,GAAI2lD,GAAyBjoC,KAAKtC,EAAMqrC,MAAxC,CAII,GAAIrrC,EAAM1a,QAAQV,OAAS,EACvB,MAAM,IAAIilD,WAAW,iEAEzB7pC,EAAMqrC,KAAKz8C,QAAQ27C,IAA0B,SAAUz5C,EAAG+5C,EAAIC,EAAI0B,EAAIC,EAAIC,GAkBtE,MAhBW,MAAP5B,EACA/kD,EAAO4mD,sBAAwB9B,EAAGjmD,OAG7B4nD,GAAgB,MAAVA,EAAG,GACdzmD,EAAOkmD,sBAAwBO,EAAG5nD,OAG7B6nD,GAAMC,GACX3mD,EAAO4mD,sBAAwBF,EAAG7nD,OAClCmB,EAAOkmD,sBAAwBQ,EAAG7nD,OAAS8nD,EAAG9nD,SAG9CmB,EAAO4mD,sBAAwB9B,EAAGjmD,OAClCmB,EAAOkmD,sBAAwBpB,EAAGjmD,QAE/B,MAEX,IAAI6mD,EAAMzrC,EAAM1a,QAAQ,GAEZ,MAARmmD,EACA1lD,EAASyhD,GAASA,GAAS,GAAIzhD,GAAS,CAAE6mD,oBAAqB,mBAE1DnB,IACL1lD,EAASyhD,GAASA,GAAS,GAAIzhD,GAAS4kD,GAA0Bc,UAK1E,GAAIjB,GAA4BloC,KAAKtC,EAAMqrC,MACvCtlD,EAASyhD,GAASA,GAAS,GAAIzhD,GAAS4kD,GAA0B3qC,EAAMqrC,WAD5E,CAIA,IAAIK,EAAWT,GAAUjrC,EAAMqrC,MAC3BK,IACA3lD,EAASyhD,GAASA,GAAS,GAAIzhD,GAAS2lD,IAE5C,IAAImB,EAAsCzB,GAAyCprC,EAAMqrC,MACrFwB,IACA9mD,EAASyhD,GAASA,GAAS,GAAIzhD,GAAS8mD,KAGhD,OAAO9mD,EC/RX,IAAI+mD,GAA8B,IAAI3xB,OAAO,IAAIgK,OAAOokB,GAAsBvkD,OAAQ,MAClF+nD,GAA4B,IAAI5xB,OAAO,GAAGgK,OAAOokB,GAAsBvkD,OAAQ,OACnF,SAASgoD,GAAepK,EAAOj7C,GAC3B,MAAO,CAAEi7C,MAAOA,EAAOj7C,IAAKA,GAIhC,IAAIslD,KAAwBl/C,OAAO7J,UAAU24B,WACzCqwB,KAA2Bn/C,OAAOo/C,cAClCC,KAAyBjpD,OAAOkpD,YAChCC,KAAyBv/C,OAAO7J,UAAUqpD,YAC1CC,KAAiBz/C,OAAO7J,UAAUupD,UAClCC,KAAe3/C,OAAO7J,UAAUypD,QAEhCC,KAD2BxtC,OAAOwtC,cAEhCxtC,OAAOwtC,cACP,SAAU1jD,GACR,MAAqB,iBAANA,GACX2jD,SAAS3jD,IACTpC,KAAKunB,MAAMnlB,KAAOA,GAClBpC,KAAKsxB,IAAIlvB,IAAM,kBAGvB4jD,IAAyB,EAC7B,IAQIA,GAA8F,OAA5C,QAAvB99C,GAPlB+9C,GAAG,4CAA6C,MAOtBtzB,KAAK,YAAyB,IAAPzqB,QAAgB,EAASA,GAAG,IAE1F,MAAOc,GACHg9C,IAAyB,EAE7B,IAyFIE,GAzFAnxB,GAAaowB,GAET,SAAoBvF,EAAG7d,EAAQ3S,GAC3B,OAAOwwB,EAAE7qB,WAAWgN,EAAQ3S,IAGhC,SAAoBwwB,EAAG7d,EAAQ3S,GAC3B,OAAOwwB,EAAE1/C,MAAMkvB,EAAUA,EAAW2S,EAAOjlC,UAAYilC,GAE/DsjB,GAAgBD,GACdn/C,OAAOo/C,cAEL,WAEI,IADA,IAAIc,EAAa,GACRpC,EAAK,EAAGA,EAAKlE,UAAU/iD,OAAQinD,IACpCoC,EAAWpC,GAAMlE,UAAUkE,GAM/B,IAJA,IAGI37C,EAHAg+C,EAAW,GACXtpD,EAASqpD,EAAWrpD,OACpB4B,EAAI,EAED5B,EAAS4B,GAAG,CAEf,IADA0J,EAAO+9C,EAAWznD,MACP,QACP,MAAMqjD,WAAW35C,EAAO,8BAC5Bg+C,GACIh+C,EAAO,MACDnC,OAAOC,aAAakC,GACpBnC,OAAOC,aAAyC,QAA1BkC,GAAQ,QAAY,IAAeA,EAAO,KAAS,OAEvF,OAAOg+C,GAEfb,GAEJD,GACMjpD,OAAOkpD,YAEL,SAAqB/2C,GAEjB,IADA,IAAIpL,EAAM,GACD2gD,EAAK,EAAGsC,EAAY73C,EAASu1C,EAAKsC,EAAUvpD,OAAQinD,IAAM,CAC/D,IAAI77C,EAAKm+C,EAAUtC,GAAKv6C,EAAItB,EAAG,GAAIo+C,EAAIp+C,EAAG,GAC1C9E,EAAIoG,GAAK88C,EAEb,OAAOljD,GAEfqiD,GAAcD,GAEV,SAAqB5F,EAAGx0C,GACpB,OAAOw0C,EAAE6F,YAAYr6C,IAGzB,SAAqBw0C,EAAGx0C,GACpB,IAAIiQ,EAAOukC,EAAE9iD,OACb,KAAIsO,EAAQ,GAAKA,GAASiQ,GAA1B,CAGA,IACIknC,EADAgE,EAAQ3G,EAAE97C,WAAWsH,GAEzB,OAAOm7C,EAAQ,OACXA,EAAQ,OACRn7C,EAAQ,IAAMiQ,IACbknC,EAAS3C,EAAE97C,WAAWsH,EAAQ,IAAM,OACrCm3C,EAAS,MACPgE,EAC4BhE,EAAS,OAAnCgE,EAAQ,OAAW,IAA0B,QAE7DZ,GAAYD,GAER,SAAmB9F,GACf,OAAOA,EAAE+F,aAGb,SAAmB/F,GACf,OAAOA,EAAE94C,QAAQk+C,GAA6B,KAEtDa,GAAUD,GAEN,SAAiBhG,GACb,OAAOA,EAAEiG,WAGb,SAAiBjG,GACb,OAAOA,EAAE94C,QAAQm+C,GAA2B,KAGxD,SAASgB,GAAGrG,EAAGj/C,GACX,OAAO,IAAI0yB,OAAOusB,EAAGj/C,GAIzB,GAAIqlD,GAAwB,CAExB,IAAIQ,GAAyBP,GAAG,4CAA6C,MAC7EC,GAAyB,SAAgCtG,EAAGx0C,GACxD,IAAIlD,EAGJ,OAFAs+C,GAAuBC,UAAYr7C,EAER,QAAnBlD,EADIs+C,GAAuB7zB,KAAKitB,GACrB,UAAuB,IAAP13C,EAAgBA,EAAK,SAK5Dg+C,GAAyB,SAAgCtG,EAAGx0C,GAExD,IADA,IAAImJ,EAAQ,KACC,CACT,IAAI3T,EAAI6kD,GAAY7F,EAAGx0C,GACvB,QAAU3N,IAANmD,GAAmB8lD,GAAc9lD,IAAM+lD,GAAiB/lD,GACxD,MAEJ2T,EAAMjU,KAAKM,GACXwK,GAASxK,GAAK,MAAU,EAAI,EAEhC,OAAOykD,GAAcvF,WAAM,EAAQvrC,IAG3C,IAAIqyC,GAAwB,WACxB,SAASA,EAAOzlD,EAAS3D,QACL,IAAZA,IAAsBA,EAAU,IACpCf,KAAK0E,QAAUA,EACf1E,KAAK2yB,SAAW,CAAE3vB,OAAQ,EAAGonD,KAAM,EAAGC,OAAQ,GAC9CrqD,KAAKsqD,YAAcvpD,EAAQupD,UAC3BtqD,KAAKuqD,sBAAwBxpD,EAAQwpD,oBACrCvqD,KAAKwqD,uBAAyBzpD,EAAQypD,qBA+xB1C,OA7xBAL,EAAOxqD,UAAU8qD,MAAQ,WACrB,GAAsB,IAAlBzqD,KAAKgD,SACL,MAAMqF,MAAM,gCAEhB,OAAOrI,KAAK0qD,aAAa,EAAG,IAAI,IAEpCP,EAAOxqD,UAAU+qD,aAAe,SAAUC,EAAcC,EAAeC,GAEnE,IADA,IAAIlB,EAAW,IACP3pD,KAAK8qD,SAAS,CAClB,IAAIC,EAAO/qD,KAAK+qD,OAChB,GAAa,MAATA,EAAwB,CAExB,IADIvpD,EAASxB,KAAKgrD,cAAcL,EAAcE,IACnCtlC,IACP,OAAO/jB,EAEXmoD,EAAS9lD,KAAKrC,EAAOgU,SAEpB,IAAa,MAATu1C,GAA0BJ,EAAe,EAC9C,MAEC,GAAa,KAATI,GACc,WAAlBH,GAAgD,kBAAlBA,EAQ9B,IAAa,KAATG,IACJ/qD,KAAKsqD,WACU,KAAhBtqD,KAAKirD,OACP,CACE,GAAIJ,EACA,MAGA,OAAO7qD,KAAK0K,MAAMg5C,GAAUwH,sBAAuBzC,GAAezoD,KAAKmrD,gBAAiBnrD,KAAKmrD,kBAGhG,GAAa,KAATJ,IACJ/qD,KAAKsqD,WACNc,GAASprD,KAAKirD,QAAU,GAAI,CAE5B,IADIzpD,EAASxB,KAAKqrD,SAASV,EAAcC,IAC9BrlC,IACP,OAAO/jB,EAEXmoD,EAAS9lD,KAAKrC,EAAOgU,SAEpB,CACD,IAAIhU,EACJ,IADIA,EAASxB,KAAKsrD,aAAaX,EAAcC,IAClCrlC,IACP,OAAO/jB,EAEXmoD,EAAS9lD,KAAKrC,EAAOgU,UAjC8C,CACnE,IAAImd,EAAW3yB,KAAKmrD,gBACpBnrD,KAAKurD,OACL5B,EAAS9lD,KAAK,CACVtE,KAAMokD,GAAKgB,MACX6G,SAAU/C,GAAe91B,EAAU3yB,KAAKmrD,qBA+BpD,MAAO,CAAE31C,IAAKm0C,EAAUpkC,IAAK,OAoBjC4kC,EAAOxqD,UAAU0rD,SAAW,SAAUV,EAAcC,GAChD,IAAIa,EAAgBzrD,KAAKmrD,gBACzBnrD,KAAKurD,OACL,IAAIG,EAAU1rD,KAAK2rD,eAEnB,GADA3rD,KAAK4rD,YACD5rD,KAAK6rD,OAAO,MAEZ,MAAO,CACHr2C,IAAK,CACDjW,KAAMokD,GAAKG,QACXvhD,MAAO,IAAIq+B,OAAO8qB,EAAS,MAC3BF,SAAU/C,GAAegD,EAAezrD,KAAKmrD,kBAEjD5lC,IAAK,MAGR,GAAIvlB,KAAK6rD,OAAO,KAAM,CACvB,IAAIC,EAAiB9rD,KAAK0qD,aAAaC,EAAe,EAAGC,GAAe,GACxE,GAAIkB,EAAevmC,IACf,OAAOumC,EAEX,IAAIC,EAAWD,EAAet2C,IAE1Bw2C,EAAsBhsD,KAAKmrD,gBAC/B,GAAInrD,KAAK6rD,OAAO,MAAO,CACnB,GAAI7rD,KAAK8qD,UAAYM,GAASprD,KAAK+qD,QAC/B,OAAO/qD,KAAK0K,MAAMg5C,GAAUuI,YAAaxD,GAAeuD,EAAqBhsD,KAAKmrD,kBAEtF,IAAIe,EAA8BlsD,KAAKmrD,gBAEvC,OAAIO,IADiB1rD,KAAK2rD,eAEf3rD,KAAK0K,MAAMg5C,GAAUwH,sBAAuBzC,GAAeyD,EAA6BlsD,KAAKmrD,mBAExGnrD,KAAK4rD,YACA5rD,KAAK6rD,OAAO,KAGV,CACHr2C,IAAK,CACDjW,KAAMokD,GAAK1R,IACX1vC,MAAOmpD,EACPK,SAAUA,EACVP,SAAU/C,GAAegD,EAAezrD,KAAKmrD,kBAEjD5lC,IAAK,MATEvlB,KAAK0K,MAAMg5C,GAAUuI,YAAaxD,GAAeuD,EAAqBhsD,KAAKmrD,mBAatF,OAAOnrD,KAAK0K,MAAMg5C,GAAUyI,aAAc1D,GAAegD,EAAezrD,KAAKmrD,kBAIjF,OAAOnrD,KAAK0K,MAAMg5C,GAAUuI,YAAaxD,GAAegD,EAAezrD,KAAKmrD,mBAMpFhB,EAAOxqD,UAAUgsD,aAAe,WAC5B,IAqqB6BxnD,EArqBzBioD,EAAcpsD,KAAKgD,SAEvB,IADAhD,KAAKurD,QACGvrD,KAAK8qD,UAoqBH,MADmB3mD,EAnqBuBnE,KAAK+qD,SAqqBnD,KAAN5mD,GACCA,GAAK,IAAMA,GAAK,IACX,KAANA,GACCA,GAAK,IAAMA,GAAK,KAChBA,GAAK,IAAMA,GAAK,IACZ,KAALA,GACCA,GAAK,KAAQA,GAAK,KAClBA,GAAK,KAAQA,GAAK,KAClBA,GAAK,KAAQA,GAAK,KAClBA,GAAK,KAASA,GAAK,MACnBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAWA,GAAK,SArrBlBnE,KAAKurD,OAET,OAAOvrD,KAAK0E,QAAQjB,MAAM2oD,EAAapsD,KAAKgD,WAEhDmnD,EAAOxqD,UAAU2rD,aAAe,SAAUX,EAAcC,GAGpD,IAFA,IAAIvM,EAAQr+C,KAAKmrD,gBACb5oD,EAAQ,KACC,CACT,IAAI8pD,EAAmBrsD,KAAKssD,cAAc1B,GAC1C,GAAIyB,EACA9pD,GAAS8pD,MADb,CAIA,IAAIE,EAAsBvsD,KAAKwsD,iBAAiB7B,EAAcC,GAC9D,GAAI2B,EACAhqD,GAASgqD,MADb,CAIA,IAAIE,EAAuBzsD,KAAK0sD,2BAChC,IAAID,EAIJ,MAHIlqD,GAASkqD,IAKjB,IAAIjB,EAAW/C,GAAepK,EAAOr+C,KAAKmrD,iBAC1C,MAAO,CACH31C,IAAK,CAAEjW,KAAMokD,GAAKG,QAASvhD,MAAOA,EAAOipD,SAAUA,GACnDjmC,IAAK,OAGb4kC,EAAOxqD,UAAU+sD,yBAA2B,WACxC,OAAK1sD,KAAK8qD,SACU,KAAhB9qD,KAAK+qD,SACJ/qD,KAAKsqD,YA6nBPc,GADcuB,EA1nBQ3sD,KAAKirD,QAAU,IA2nBA,KAAd0B,GAvnBnB,MAHH3sD,KAAKurD,OACE,KAwnBnB,IAAyBoB,GA/mBrBxC,EAAOxqD,UAAU2sD,cAAgB,SAAU1B,GACvC,GAAI5qD,KAAK8qD,SAA2B,KAAhB9qD,KAAK+qD,OACrB,OAAO,KAIX,OAAQ/qD,KAAKirD,QACT,KAAK,GAID,OAFAjrD,KAAKurD,OACLvrD,KAAKurD,OACE,IAEX,KAAK,IACL,KAAK,GACL,KAAK,GACL,KAAK,IACD,MACJ,KAAK,GACD,GAAsB,WAAlBX,GAAgD,kBAAlBA,EAC9B,MAEJ,OAAO,KACX,QACI,OAAO,KAEf5qD,KAAKurD,OACL,IAAI7B,EAAa,CAAC1pD,KAAK+qD,QAGvB,IAFA/qD,KAAKurD,QAEGvrD,KAAK8qD,SAAS,CAClB,IAAI8B,EAAK5sD,KAAK+qD,OACd,GAAW,KAAP6B,EAAqB,CACrB,GAAoB,KAAhB5sD,KAAKirD,OAKJ,CAEDjrD,KAAKurD,OACL,MAPA7B,EAAW7lD,KAAK,IAEhB7D,KAAKurD,YAST7B,EAAW7lD,KAAK+oD,GAEpB5sD,KAAKurD,OAET,OAAO3C,GAAcvF,WAAM,EAAQqG,IAEvCS,EAAOxqD,UAAU6sD,iBAAmB,SAAU7B,EAAcC,GACxD,GAAI5qD,KAAK8qD,QACL,OAAO,KAEX,IAAI8B,EAAK5sD,KAAK+qD,OACd,OAAW,KAAP6B,GACO,MAAPA,GACQ,KAAPA,IACsB,WAAlBhC,GAAgD,kBAAlBA,IAC3B,MAAPgC,GAAwBjC,EAAe,EACjC,MAGP3qD,KAAKurD,OACE3C,GAAcgE,KAG7BzC,EAAOxqD,UAAUqrD,cAAgB,SAAUL,EAAcE,GACrD,IAAIgC,EAAuB7sD,KAAKmrD,gBAGhC,GAFAnrD,KAAKurD,OACLvrD,KAAK4rD,YACD5rD,KAAK8qD,QACL,OAAO9qD,KAAK0K,MAAMg5C,GAAUoJ,8BAA+BrE,GAAeoE,EAAsB7sD,KAAKmrD,kBAEzG,GAAoB,MAAhBnrD,KAAK+qD,OAEL,OADA/qD,KAAKurD,OACEvrD,KAAK0K,MAAMg5C,GAAUqJ,eAAgBtE,GAAeoE,EAAsB7sD,KAAKmrD,kBAG1F,IAAI5oD,EAAQvC,KAAKgtD,4BAA4BzqD,MAC7C,IAAKA,EACD,OAAOvC,KAAK0K,MAAMg5C,GAAUuJ,mBAAoBxE,GAAeoE,EAAsB7sD,KAAKmrD,kBAG9F,GADAnrD,KAAK4rD,YACD5rD,KAAK8qD,QACL,OAAO9qD,KAAK0K,MAAMg5C,GAAUoJ,8BAA+BrE,GAAeoE,EAAsB7sD,KAAKmrD,kBAEzG,OAAQnrD,KAAK+qD,QAET,KAAK,IAED,OADA/qD,KAAKurD,OACE,CACH/1C,IAAK,CACDjW,KAAMokD,GAAKK,SAEXzhD,MAAOA,EACPipD,SAAU/C,GAAeoE,EAAsB7sD,KAAKmrD,kBAExD5lC,IAAK,MAIb,KAAK,GAGD,OAFAvlB,KAAKurD,OACLvrD,KAAK4rD,YACD5rD,KAAK8qD,QACE9qD,KAAK0K,MAAMg5C,GAAUoJ,8BAA+BrE,GAAeoE,EAAsB7sD,KAAKmrD,kBAElGnrD,KAAKktD,qBAAqBvC,EAAcE,EAAmBtoD,EAAOsqD,GAE7E,QACI,OAAO7sD,KAAK0K,MAAMg5C,GAAUuJ,mBAAoBxE,GAAeoE,EAAsB7sD,KAAKmrD,oBAOtGhB,EAAOxqD,UAAUqtD,0BAA4B,WACzC,IAAIG,EAAmBntD,KAAKmrD,gBACxBiB,EAAcpsD,KAAKgD,SACnBT,EAAQknD,GAAuBzpD,KAAK0E,QAAS0nD,GAC7CgB,EAAYhB,EAAc7pD,EAAMlC,OAIpC,OAHAL,KAAKqtD,OAAOD,GAGL,CAAE7qD,MAAOA,EAAOipD,SADR/C,GAAe0E,EADZntD,KAAKmrD,mBAI3BhB,EAAOxqD,UAAUutD,qBAAuB,SAAUvC,EAAcE,EAAmBtoD,EAAOsqD,GACtF,IAAIphD,EAIA6hD,EAAoBttD,KAAKmrD,gBACzBoC,EAAUvtD,KAAKgtD,4BAA4BzqD,MAC3CirD,EAAkBxtD,KAAKmrD,gBAC3B,OAAQoC,GACJ,IAAK,GAED,OAAOvtD,KAAK0K,MAAMg5C,GAAU+J,qBAAsBhF,GAAe6E,EAAmBE,IACxF,IAAK,SACL,IAAK,OACL,IAAK,OAIDxtD,KAAK4rD,YACL,IAAI8B,EAAmB,KACvB,GAAI1tD,KAAK6rD,OAAO,KAAM,CAClB7rD,KAAK4rD,YACL,IAAI+B,EAAqB3tD,KAAKmrD,gBAE9B,IADI3pD,EAASxB,KAAK4tD,iCACProC,IACP,OAAO/jB,EAGX,GAAqB,KADjB2xB,EAAQi2B,GAAQ5nD,EAAOgU,MACjBnV,OACN,OAAOL,KAAK0K,MAAMg5C,GAAUmK,sBAAuBpF,GAAezoD,KAAKmrD,gBAAiBnrD,KAAKmrD,kBAGjGuC,EAAmB,CAAEv6B,MAAOA,EAAO26B,cADfrF,GAAekF,EAAoB3tD,KAAKmrD,kBAIhE,IADI4C,EAAiB/tD,KAAKguD,sBAAsBnB,IAC7BtnC,IACf,OAAOwoC,EAEX,IAAIE,EAAaxF,GAAeoE,EAAsB7sD,KAAKmrD,iBAE3D,GAAIuC,GAAoBp1B,GAAWo1B,MAAAA,OAA2D,EAASA,EAAiBv6B,MAAO,KAAM,GAAI,CAErI,IAAIgyB,EAAW+D,GAAUwE,EAAiBv6B,MAAM1vB,MAAM,IACtD,GAAgB,WAAZ8pD,EAEA,OADI/rD,EAASxB,KAAKkuD,8BAA8B/I,EAAUuI,EAAiBI,gBAChEvoC,IACA/jB,EAEJ,CACHgU,IAAK,CAAEjW,KAAMokD,GAAKO,OAAQ3hD,MAAOA,EAAOipD,SAAUyC,EAAY96B,MAAO3xB,EAAOgU,KAC5E+P,IAAK,MAIT,GAAwB,IAApB4/B,EAAS9kD,OACT,OAAOL,KAAK0K,MAAMg5C,GAAUyK,0BAA2BF,GAE3D,IAAI96B,EAAQ,CACR5zB,KAAMqkD,GAAcmB,SACpBqJ,QAASjJ,EACTqG,SAAUkC,EAAiBI,cAC3BO,cAAeruD,KAAKwqD,qBACdtF,GAAsBC,GACtB,IAGV,MAAO,CACH3vC,IAAK,CAAEjW,KAFY,SAAZguD,EAAqB5J,GAAKxqC,KAAOwqC,GAAKU,KAE1B9hD,MAAOA,EAAOipD,SAAUyC,EAAY96B,MAAOA,GAC9D5N,IAAK,MAKjB,MAAO,CACH/P,IAAK,CACDjW,KAAkB,WAAZguD,EACA5J,GAAKO,OACO,SAAZqJ,EACI5J,GAAKxqC,KACLwqC,GAAKU,KACf9hD,MAAOA,EACPipD,SAAUyC,EACV96B,MAA6G,QAArG1nB,EAAKiiD,MAAAA,OAA2D,EAASA,EAAiBv6B,aAA0B,IAAP1nB,EAAgBA,EAAK,MAE9I8Z,IAAK,MAGb,IAAK,SACL,IAAK,gBACL,IAAK,SAID,IAAI+oC,EAAoBtuD,KAAKmrD,gBAE7B,GADAnrD,KAAK4rD,aACA5rD,KAAK6rD,OAAO,KACb,OAAO7rD,KAAK0K,MAAMg5C,GAAU6K,+BAAgC9F,GAAe6F,EAAmBrL,GAAS,GAAIqL,KAE/GtuD,KAAK4rD,YASL,IAAI4C,EAAwBxuD,KAAKgtD,4BAC7ByB,EAAe,EACnB,GAAgB,WAAZlB,GAAwD,WAAhCiB,EAAsBjsD,MAAoB,CAClE,IAAKvC,KAAK6rD,OAAO,KACb,OAAO7rD,KAAK0K,MAAMg5C,GAAUgL,oCAAqCjG,GAAezoD,KAAKmrD,gBAAiBnrD,KAAKmrD,kBAG/G,IAAI3pD,EACJ,GAFAxB,KAAK4rD,aACDpqD,EAASxB,KAAK2uD,uBAAuBjL,GAAUgL,oCAAqChL,GAAUkL,uCACvFrpC,IACP,OAAO/jB,EAGXxB,KAAK4rD,YACL4C,EAAwBxuD,KAAKgtD,4BAC7ByB,EAAejtD,EAAOgU,IAE1B,IAIIu4C,EAJAc,EAAgB7uD,KAAK8uD,8BAA8BnE,EAAc4C,EAAS1C,EAAmB2D,GACjG,GAAIK,EAActpC,IACd,OAAOspC,EAGX,IADId,EAAiB/tD,KAAKguD,sBAAsBnB,IAC7BtnC,IACf,OAAOwoC,EAEX,IAAIgB,EAAatG,GAAeoE,EAAsB7sD,KAAKmrD,iBAC3D,MAAgB,WAAZoC,EACO,CACH/3C,IAAK,CACDjW,KAAMokD,GAAKY,OACXhiD,MAAOA,EACPxB,QAAS+nD,GAAY+F,EAAcr5C,KACnCg2C,SAAUuD,GAEdxpC,IAAK,MAIF,CACH/P,IAAK,CACDjW,KAAMokD,GAAKc,OACXliD,MAAOA,EACPxB,QAAS+nD,GAAY+F,EAAcr5C,KACnCxS,OAAQyrD,EACRO,WAAwB,WAAZzB,EAAuB,WAAa,UAChD/B,SAAUuD,GAEdxpC,IAAK,MAIjB,QACI,OAAOvlB,KAAK0K,MAAMg5C,GAAUuL,sBAAuBxG,GAAe6E,EAAmBE,MAGjGrD,EAAOxqD,UAAUquD,sBAAwB,SAAUnB,GAG/C,OAAI7sD,KAAK8qD,SAA2B,MAAhB9qD,KAAK+qD,OACd/qD,KAAK0K,MAAMg5C,GAAUoJ,8BAA+BrE,GAAeoE,EAAsB7sD,KAAKmrD,mBAEzGnrD,KAAKurD,OACE,CAAE/1C,KAAK,EAAM+P,IAAK,QAK7B4kC,EAAOxqD,UAAUiuD,8BAAgC,WAG7C,IAFA,IAAIsB,EAAe,EACfzD,EAAgBzrD,KAAKmrD,iBACjBnrD,KAAK8qD,SAAS,CAElB,OADS9qD,KAAK+qD,QAEV,KAAK,GAGD/qD,KAAKurD,OACL,IAAI4D,EAAqBnvD,KAAKmrD,gBAC9B,IAAKnrD,KAAKovD,UAAU,KAChB,OAAOpvD,KAAK0K,MAAMg5C,GAAU2L,iCAAkC5G,GAAe0G,EAAoBnvD,KAAKmrD,kBAE1GnrD,KAAKurD,OACL,MAEJ,KAAK,IACD2D,GAAgB,EAChBlvD,KAAKurD,OACL,MAEJ,KAAK,IACD,KAAI2D,EAAe,GAIf,MAAO,CACH15C,IAAKxV,KAAK0E,QAAQjB,MAAMgoD,EAAczoD,OAAQhD,KAAKgD,UACnDuiB,IAAK,MALT2pC,GAAgB,EAQpB,MAEJ,QACIlvD,KAAKurD,QAIjB,MAAO,CACH/1C,IAAKxV,KAAK0E,QAAQjB,MAAMgoD,EAAczoD,OAAQhD,KAAKgD,UACnDuiB,IAAK,OAGb4kC,EAAOxqD,UAAUuuD,8BAAgC,SAAU/I,EAAUqG,GACjE,IAAInE,EAAS,GACb,IACIA,ED5rBL,SAAuClC,GAC1C,GAAwB,IAApBA,EAAS9kD,OACT,MAAM,IAAIgI,MAAM,mCAOpB,IAJA,IAGIg/C,EAAS,GACJC,EAAK,EAAGgI,EAJEnK,EACdvqB,MAAM,IACNvoB,QAAO,SAAUrO,GAAK,OAAOA,EAAE3D,OAAS,KAEGinD,EAAKgI,EAAejvD,OAAQinD,IAAM,CAC9E,IACIiI,EADcD,EAAehI,GACA1sB,MAAM,KACvC,GAA8B,IAA1B20B,EAAelvD,OACf,MAAM,IAAIgI,MAAM,2BAGpB,IADA,IAAIy+C,EAAOyI,EAAe,GAAIxuD,EAAUwuD,EAAe9rD,MAAM,GACpDgI,EAAK,EAAG+jD,EAAYzuD,EAAS0K,EAAK+jD,EAAUnvD,OAAQoL,IAEzD,GAAsB,IADT+jD,EAAU/jD,GACZpL,OACP,MAAM,IAAIgI,MAAM,2BAGxBg/C,EAAOxjD,KAAK,CAAEijD,KAAMA,EAAM/lD,QAASA,IAEvC,OAAOsmD,ECoqBU6G,CAA8B/I,GAE3C,MAAO1+C,GACH,OAAOzG,KAAK0K,MAAMg5C,GAAU+L,wBAAyBjE,GAEzD,MAAO,CACHh2C,IAAK,CACDjW,KAAMqkD,GAAcM,OACpBmD,OAAQA,EACRmE,SAAUA,EACV6C,cAAeruD,KAAKwqD,qBACdpD,GAAoBC,GACpB,IAEV9hC,IAAK,OAab4kC,EAAOxqD,UAAUmvD,8BAAgC,SAAUnE,EAAcC,EAAe8E,EAAgBC,GASpG,IARA,IAAIlkD,EACAmkD,GAAiB,EACjB7uD,EAAU,GACV8uD,EAAkB,IAAI98C,IACtB+8C,EAAWH,EAAsBptD,MAAOwtD,EAAmBJ,EAAsBnE,WAIxE,CACT,GAAwB,IAApBsE,EAASzvD,OAAc,CACvB,IAAIorD,EAAgBzrD,KAAKmrD,gBACzB,GAAsB,WAAlBP,IAA8B5qD,KAAK6rD,OAAO,KAU1C,MARA,IAAIrqD,EAASxB,KAAK2uD,uBAAuBjL,GAAUsM,gCAAiCtM,GAAUuM,kCAC9F,GAAIzuD,EAAO+jB,IACP,OAAO/jB,EAEXuuD,EAAmBtH,GAAegD,EAAezrD,KAAKmrD,iBACtD2E,EAAW9vD,KAAK0E,QAAQjB,MAAMgoD,EAAczoD,OAAQhD,KAAKgD,UAOjE,GAAI6sD,EAAgB3+C,IAAI4+C,GACpB,OAAO9vD,KAAK0K,MAAwB,WAAlBkgD,EACZlH,GAAUwM,mCACVxM,GAAUyM,mCAAoCJ,GAEvC,UAAbD,IACAF,GAAiB,GAKrB5vD,KAAK4rD,YACL,IAAIiB,EAAuB7sD,KAAKmrD,gBAChC,IAAKnrD,KAAK6rD,OAAO,KACb,OAAO7rD,KAAK0K,MAAwB,WAAlBkgD,EACZlH,GAAU0M,yCACV1M,GAAU2M,yCAA0C5H,GAAezoD,KAAKmrD,gBAAiBnrD,KAAKmrD,kBAExG,IAAImF,EAAiBtwD,KAAK0qD,aAAaC,EAAe,EAAGC,EAAe8E,GACxE,GAAIY,EAAe/qC,IACf,OAAO+qC,EAEX,IAAIvC,EAAiB/tD,KAAKguD,sBAAsBnB,GAChD,GAAIkB,EAAexoC,IACf,OAAOwoC,EAEXhtD,EAAQ8C,KAAK,CACTisD,EACA,CACIvtD,MAAO+tD,EAAe96C,IACtBg2C,SAAU/C,GAAeoE,EAAsB7sD,KAAKmrD,oBAI5D0E,EAAgB78C,IAAI88C,GAEpB9vD,KAAK4rD,YACmCkE,GAAvCrkD,EAAKzL,KAAKgtD,6BAA2CzqD,MAAOwtD,EAAmBtkD,EAAG+/C,SAEvF,OAAuB,IAAnBzqD,EAAQV,OACDL,KAAK0K,MAAwB,WAAlBkgD,EACZlH,GAAU6M,gCACV7M,GAAUsM,gCAAiCvH,GAAezoD,KAAKmrD,gBAAiBnrD,KAAKmrD,kBAE3FnrD,KAAKuqD,sBAAwBqF,EACtB5vD,KAAK0K,MAAMg5C,GAAU8M,qBAAsB/H,GAAezoD,KAAKmrD,gBAAiBnrD,KAAKmrD,kBAEzF,CAAE31C,IAAKzU,EAASwkB,IAAK,OAEhC4kC,EAAOxqD,UAAUgvD,uBAAyB,SAAU8B,EAAmBC,GACnE,IAAIC,EAAO,EACPxD,EAAmBntD,KAAKmrD,gBACxBnrD,KAAK6rD,OAAO,MAEP7rD,KAAK6rD,OAAO,OACjB8E,GAAQ,GAIZ,IAFA,IAAIC,GAAY,EACZC,EAAU,GACN7wD,KAAK8qD,SAAS,CAClB,IAAI8B,EAAK5sD,KAAK+qD,OACd,KAAI6B,GAAM,IAAgBA,GAAM,IAM5B,MALAgE,GAAY,EACZC,EAAoB,GAAVA,GAAgBjE,EAAK,IAC/B5sD,KAAKurD,OAMb,IAAIC,EAAW/C,GAAe0E,EAAkBntD,KAAKmrD,iBACrD,OAAKyF,EAIAvH,GADLwH,GAAWF,GAIJ,CAAEn7C,IAAKq7C,EAAStrC,IAAK,MAFjBvlB,KAAK0K,MAAMgmD,EAAoBlF,GAJ/BxrD,KAAK0K,MAAM+lD,EAAmBjF,IAQ7CrB,EAAOxqD,UAAUqD,OAAS,WACtB,OAAOhD,KAAK2yB,SAAS3vB,QAEzBmnD,EAAOxqD,UAAUmrD,MAAQ,WACrB,OAAO9qD,KAAKgD,WAAahD,KAAK0E,QAAQrE,QAE1C8pD,EAAOxqD,UAAUwrD,cAAgB,WAE7B,MAAO,CACHnoD,OAAQhD,KAAK2yB,SAAS3vB,OACtBonD,KAAMpqD,KAAK2yB,SAASy3B,KACpBC,OAAQrqD,KAAK2yB,SAAS03B,SAO9BF,EAAOxqD,UAAUorD,KAAO,WACpB,IAAI/nD,EAAShD,KAAK2yB,SAAS3vB,OAC3B,GAAIA,GAAUhD,KAAK0E,QAAQrE,OACvB,MAAMgI,MAAM,gBAEhB,IAAIsD,EAAOq9C,GAAYhpD,KAAK0E,QAAS1B,GACrC,QAAahC,IAAT2K,EACA,MAAMtD,MAAM,UAAUu4B,OAAO59B,EAAQ,6CAEzC,OAAO2I,GAEXw+C,EAAOxqD,UAAU+K,MAAQ,SAAUm1C,EAAM2L,GACrC,MAAO,CACHh2C,IAAK,KACL+P,IAAK,CACDs6B,KAAMA,EACNn7C,QAAS1E,KAAK0E,QACd8mD,SAAUA,KAKtBrB,EAAOxqD,UAAU4rD,KAAO,WACpB,IAAIvrD,KAAK8qD,QAAT,CAGA,IAAIn/C,EAAO3L,KAAK+qD,OACH,KAATp/C,GACA3L,KAAK2yB,SAASy3B,MAAQ,EACtBpqD,KAAK2yB,SAAS03B,OAAS,EACvBrqD,KAAK2yB,SAAS3vB,QAAU,IAGxBhD,KAAK2yB,SAAS03B,QAAU,EAExBrqD,KAAK2yB,SAAS3vB,QAAU2I,EAAO,MAAU,EAAI,KASrDw+C,EAAOxqD,UAAUksD,OAAS,SAAUiF,GAChC,GAAIx4B,GAAWt4B,KAAK0E,QAASosD,EAAQ9wD,KAAKgD,UAAW,CACjD,IAAK,IAAIf,EAAI,EAAGA,EAAI6uD,EAAOzwD,OAAQ4B,IAC/BjC,KAAKurD,OAET,OAAO,EAEX,OAAO,GAMXpB,EAAOxqD,UAAUyvD,UAAY,SAAUhB,GACnC,IAAI2C,EAAgB/wD,KAAKgD,SACrB2L,EAAQ3O,KAAK0E,QAAQ0xB,QAAQg4B,EAAS2C,GAC1C,OAAIpiD,GAAS,GACT3O,KAAKqtD,OAAO1+C,IACL,IAGP3O,KAAKqtD,OAAOrtD,KAAK0E,QAAQrE,SAClB,IAOf8pD,EAAOxqD,UAAU0tD,OAAS,SAAU2D,GAChC,GAAIhxD,KAAKgD,SAAWguD,EAChB,MAAM3oD,MAAM,gBAAgBu4B,OAAOowB,EAAc,yDAAyDpwB,OAAO5gC,KAAKgD,WAG1H,IADAguD,EAAeztD,KAAKC,IAAIwtD,EAAchxD,KAAK0E,QAAQrE,UACtC,CACT,IAAI2C,EAAShD,KAAKgD,SAClB,GAAIA,IAAWguD,EACX,MAEJ,GAAIhuD,EAASguD,EACT,MAAM3oD,MAAM,gBAAgBu4B,OAAOowB,EAAc,6CAGrD,GADAhxD,KAAKurD,OACDvrD,KAAK8qD,QACL,QAKZX,EAAOxqD,UAAUisD,UAAY,WACzB,MAAQ5rD,KAAK8qD,SAAWb,GAAcjqD,KAAK+qD,SACvC/qD,KAAKurD,QAObpB,EAAOxqD,UAAUsrD,KAAO,WACpB,GAAIjrD,KAAK8qD,QACL,OAAO,KAEX,IAAIn/C,EAAO3L,KAAK+qD,OACZ/nD,EAAShD,KAAKgD,SACdiuD,EAAWjxD,KAAK0E,QAAQ2C,WAAWrE,GAAU2I,GAAQ,MAAU,EAAI,IACvE,OAAOslD,MAAAA,EAA2CA,EAAW,MAE1D9G,EAtyBgB,GA8yB3B,SAASiB,GAASuB,GACd,OAASA,GAAa,IAAMA,GAAa,KACpCA,GAAa,IAAMA,GAAa,GA+BzC,SAAS1C,GAAc9lD,GACnB,OAASA,GAAK,GAAUA,GAAK,IACnB,KAANA,GACM,MAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,EAMR,SAAS+lD,GAAiB/lD,GACtB,OAASA,GAAK,IAAUA,GAAK,IACnB,KAANA,GACCA,GAAK,IAAUA,GAAK,IACf,KAANA,GACM,KAANA,GACM,KAANA,GACM,KAANA,GACM,KAANA,GACM,KAANA,GACCA,GAAK,IAAUA,GAAK,IACpBA,GAAK,IAAUA,GAAK,IACpBA,GAAK,IAAUA,GAAK,IACpBA,GAAK,IAAUA,GAAK,IACf,KAANA,GACM,KAANA,GACM,KAANA,GACM,KAANA,GACM,KAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACCA,GAAK,KAAUA,GAAK,KACf,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACM,MAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACM,OAANA,GACM,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,KACf,OAANA,GACM,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACpBA,GAAK,MAAUA,GAAK,MACf,OAANA,GACCA,GAAK,MAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACCA,GAAK,OAAUA,GAAK,OACpBA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,OACf,QAANA,GACM,QAANA,GACM,QAANA,GACM,QAANA,GACCA,GAAK,OAAUA,GAAK,MC7uC7B,SAAS+sD,GAAcC,GACnBA,EAAIl2B,SAAQ,SAAU4E,GAElB,UADOA,EAAG2rB,SACNlH,GAAgBzkB,IAAO2kB,GAAgB3kB,GACvC,IAAK,IAAI9yB,KAAK8yB,EAAG9+B,eACN8+B,EAAG9+B,QAAQgM,GAAGy+C,SACrB0F,GAAcrxB,EAAG9+B,QAAQgM,GAAGxK,YAG3B0hD,GAAgBpkB,IAAOglB,GAAiBhlB,EAAG1M,SAG1CgxB,GAActkB,IAAOukB,GAAcvkB,KACzCilB,GAAmBjlB,EAAG1M,cAHf0M,EAAG1M,MAAMq4B,SAMX5G,GAAa/kB,IAClBqxB,GAAcrxB,EAAGksB,aAItB,SAAStB,GAAM/lD,EAASkO,QACd,IAATA,IAAmBA,EAAO,IAC9BA,EAAOqwC,GAAS,CAAEuH,sBAAsB,EAAMD,qBAAqB,GAAQ33C,GAC3E,IAAIpR,EAAS,IAAI2oD,GAAOzlD,EAASkO,GAAM63C,QACvC,GAAIjpD,EAAO+jB,IAAK,CACZ,IAAI7a,EAAQ0mD,YAAY1N,GAAUliD,EAAO+jB,IAAIs6B,OAK7C,MAHAn1C,EAAM8gD,SAAWhqD,EAAO+jB,IAAIimC,SAE5B9gD,EAAM2mD,gBAAkB7vD,EAAO+jB,IAAI7gB,QAC7BgG,EAKV,OAHMkI,MAAAA,OAAmC,EAASA,EAAK0+C,kBACnDJ,GAAc1vD,EAAOgU,KAElBhU,EAAOgU,ICrCH,SAAS+7C,GAAQr0C,EAAInc,GAChC,IAAIywD,EAAQzwD,GAAWA,EAAQywD,MAAQzwD,EAAQywD,MAAQC,GACnDC,EAAa3wD,GAAWA,EAAQ2wD,WAAa3wD,EAAQ2wD,WAAaC,GAEtE,OADe5wD,GAAWA,EAAQ6wD,SAAW7wD,EAAQ6wD,SAAWC,IAChD30C,EAAI,CAChBs0C,MAAOA,EACPE,WAAYA,IASpB,SAASI,GAAQ50C,EAAIs0C,EAAOE,EAAYK,GACpC,IAJiBxvD,EAIbyvD,EAHa,OADAzvD,EAIUwvD,IAHe,iBAAVxvD,GAAuC,kBAAVA,EAG3BwvD,EAAML,EAAWK,GAC/CE,EAAgBT,EAAMnrD,IAAI2rD,GAK9B,YAJ6B,IAAlBC,IACPA,EAAgB/0C,EAAGhd,KAAKF,KAAM+xD,GAC9BP,EAAMjtD,IAAIytD,EAAUC,IAEjBA,EAEX,SAASC,GAASh1C,EAAIs0C,EAAOE,GACzB,IAAIn9C,EAAOpM,MAAMxI,UAAU8D,MAAMvD,KAAKkjD,UAAW,GAC7C4O,EAAWN,EAAWn9C,GACtB09C,EAAgBT,EAAMnrD,IAAI2rD,GAK9B,YAJ6B,IAAlBC,IACPA,EAAgB/0C,EAAGmmC,MAAMrjD,KAAMuU,GAC/Bi9C,EAAMjtD,IAAIytD,EAAUC,IAEjBA,EAEX,SAASE,GAASj1C,EAAIk1C,EAASR,EAAUJ,EAAOa,GAC5C,OAAOT,EAASriC,KAAK6iC,EAASl1C,EAAIs0C,EAAOa,GAE7C,SAASR,GAAgB30C,EAAInc,GAEzB,OAAOoxD,GAASj1C,EAAIld,KADS,IAAdkd,EAAG7c,OAAeyxD,GAAUI,GACPnxD,EAAQywD,MAAM3xD,SAAUkB,EAAQ2wD,YAWxE,IAAIC,GAAoB,WACpB,OAAOn3C,KAAKC,UAAU2oC,YAK1B,SAASkP,KACLtyD,KAAKwxD,MAAQ5xD,OAAOC,OAAO,MAE/ByyD,GAA4B3yD,UAAU0G,IAAM,SAAUJ,GAClD,OAAOjG,KAAKwxD,MAAMvrD,IAEtBqsD,GAA4B3yD,UAAU4E,IAAM,SAAU0B,EAAK1D,GACvDvC,KAAKwxD,MAAMvrD,GAAO1D,GAEtB,ICnEWgwD,GDmEPd,GAAe,CACf5xD,OAAQ,WAEJ,OAAO,IAAIyyD,KAGRE,GAAa,CACpBN,SA/BJ,SAA0Bh1C,EAAInc,GAC1B,OAAOoxD,GAASj1C,EAAIld,KAAMkyD,GAAUnxD,EAAQywD,MAAM3xD,SAAUkB,EAAQ2wD,aA+BpEI,QA7BJ,SAAyB50C,EAAInc,GACzB,OAAOoxD,GAASj1C,EAAIld,KAAM8xD,GAAS/wD,EAAQywD,MAAM3xD,SAAUkB,EAAQ2wD,eC9CvE,SAAWa,GAEPA,EAAyB,cAAI,gBAE7BA,EAAyB,cAAI,gBAE7BA,EAA4B,iBAAI,mBANpC,CAOGA,KAAcA,GAAY,KAC7B,ICRWE,GDQPC,GAA6B,SAAUC,GAEvC,SAASD,EAAYzgC,EAAKtmB,EAAM0lD,GAC5B,IAAIuB,EAAQD,EAAOzyD,KAAKF,KAAMiyB,IAAQjyB,KAGtC,OAFA4yD,EAAMjnD,KAAOA,EACbinD,EAAMvB,gBAAkBA,EACjBuB,EAKX,OAVA7P,GAAU2P,EAAaC,GAOvBD,EAAY/yD,UAAUuC,SAAW,WAC7B,MAAO,oBAAoB0+B,OAAO5gC,KAAK2L,KAAM,MAAMi1B,OAAO5gC,KAAK0E,UAE5DguD,EAXqB,CAY9BrqD,OAEEwqD,GAAmC,SAAUF,GAE7C,SAASE,EAAkBC,EAAYvwD,EAAOxB,EAASswD,GACnD,OAAOsB,EAAOzyD,KAAKF,KAAM,uBAAwB4gC,OAAOkyB,EAAY,QAAUlyB,OAAOr+B,EAAO,oBAAsBq+B,OAAOhhC,OAAOiN,KAAK9L,GAASmI,KAAK,QAAS,KAAOqpD,GAAUQ,cAAe1B,IAAoBrxD,KAEpN,OAJA+iD,GAAU8P,EAAmBF,GAItBE,EAL2B,CAMpCH,IAEEM,GAAuC,SAAUL,GAEjD,SAASK,EAAsBzwD,EAAOhD,EAAM8xD,GACxC,OAAOsB,EAAOzyD,KAAKF,KAAM,cAAe4gC,OAAOr+B,EAAO,sBAAuBq+B,OAAOrhC,GAAOgzD,GAAUQ,cAAe1B,IAAoBrxD,KAE5I,OAJA+iD,GAAUiQ,EAAuBL,GAI1BK,EAL+B,CAMxCN,IAEEO,GAAmC,SAAUN,GAE7C,SAASM,EAAkBH,EAAYzB,GACnC,OAAOsB,EAAOzyD,KAAKF,KAAM,qCAAsC4gC,OAAOkyB,EAAY,sCAAwClyB,OAAOywB,EAAiB,KAAOkB,GAAUW,cAAe7B,IAAoBrxD,KAE1M,OAJA+iD,GAAUkQ,EAAmBN,GAItBM,EAL2B,CAMpCP,ICtBK,SAASS,GAAqBtzB,GACjC,MAAqB,mBAAPA,EAGX,SAASuzB,GAAcjC,EAAKkC,EAASC,EAAYC,EAASphD,EAAQqhD,EAEzEnC,GAEI,GAAmB,IAAfF,EAAI9wD,QAAgBwjD,GAAiBsN,EAAI,IACzC,MAAO,CACH,CACI5xD,KAAMkzD,GAAU3O,QAChBvhD,MAAO4uD,EAAI,GAAG5uD,QAK1B,IADA,IAAIf,EAAS,GACJ8lD,EAAK,EAAGmM,EAAQtC,EAAK7J,EAAKmM,EAAMpzD,OAAQinD,IAAM,CACnD,IAAIznB,EAAK4zB,EAAMnM,GAEf,GAAIzD,GAAiBhkB,GACjBr+B,EAAOqC,KAAK,CACRtE,KAAMkzD,GAAU3O,QAChBvhD,MAAOs9B,EAAGt9B,aAMlB,GAAImiD,GAAe7kB,GACmB,iBAAvB2zB,GACPhyD,EAAOqC,KAAK,CACRtE,KAAMkzD,GAAU3O,QAChBvhD,MAAO+wD,EAAWI,gBAAgBL,GAASM,OAAOH,SAJ9D,CASA,IAAII,EAAU/zB,EAAGt9B,MAEjB,IAAM4P,KAAUyhD,KAAWzhD,GACvB,MAAM,IAAI8gD,GAAkBW,EAASvC,GAEzC,IAAI9uD,EAAQ4P,EAAOyhD,GACnB,GAAI7P,GAAkBlkB,GACbt9B,GAA0B,iBAAVA,GAAuC,iBAAVA,IAC9CA,EACqB,iBAAVA,GAAuC,iBAAVA,EAC9BiH,OAAOjH,GACP,IAEdf,EAAOqC,KAAK,CACRtE,KAAuB,iBAAVgD,EAAqBkwD,GAAU3O,QAAU2O,GAAUoB,OAChEtxD,MAAOA,SAOf,GAAI4hD,GAActkB,GAAlB,CACI,IAAI1M,EAA4B,iBAAb0M,EAAG1M,MAChBogC,EAAQp6C,KAAK0mB,EAAG1M,OAChB2xB,GAAmBjlB,EAAG1M,OAClB0M,EAAG1M,MAAMk7B,mBACTrtD,EACVQ,EAAOqC,KAAK,CACRtE,KAAMkzD,GAAU3O,QAChBvhD,MAAO+wD,EACFQ,kBAAkBT,EAASlgC,GAC3BwgC,OAAOpxD,UAIpB,GAAI6hD,GAAcvkB,GAAlB,CACQ1M,EAA4B,iBAAb0M,EAAG1M,MAChBogC,EAAQlP,KAAKxkB,EAAG1M,OAChB2xB,GAAmBjlB,EAAG1M,OAClB0M,EAAG1M,MAAMk7B,cACTkF,EAAQlP,KAAK0P,OACvBvyD,EAAOqC,KAAK,CACRtE,KAAMkzD,GAAU3O,QAChBvhD,MAAO+wD,EACFQ,kBAAkBT,EAASlgC,GAC3BwgC,OAAOpxD,UAIpB,GAAI0hD,GAAgBpkB,GAApB,EACQ1M,EAA4B,iBAAb0M,EAAG1M,MAChBogC,EAAQrP,OAAOrkB,EAAG1M,OAClB0xB,GAAiBhlB,EAAG1M,OAChB0M,EAAG1M,MAAMk7B,mBACTrtD,IACGmyB,EAAM0F,QACft2B,GAES4wB,EAAM0F,OAAS,GAE5Br3B,EAAOqC,KAAK,CACRtE,KAAMkzD,GAAU3O,QAChBvhD,MAAO+wD,EACFI,gBAAgBL,EAASlgC,GACzBwgC,OAAOpxD,SAfpB,CAmBA,GAAIqiD,GAAa/kB,GAAK,CAClB,IAAIksB,EAAWlsB,EAAGksB,SAAUiI,EAAUn0B,EAAGt9B,MACrC0xD,EAAW9hD,EAAO6hD,GACtB,IAAKb,GAAqBc,GACtB,MAAM,IAAIjB,GAAsBgB,EAAS,WAAY3C,GAEzD,IACI6C,EAASD,EADDb,GAAcrH,EAAUsH,EAASC,EAAYC,EAASphD,EAAQqhD,GAC9ClhD,KAAI,SAAUlL,GAAK,OAAOA,EAAE7E,UACnD4F,MAAMC,QAAQ8rD,KACfA,EAAS,CAACA,IAEd1yD,EAAOqC,KAAKw/C,MAAM7hD,EAAQ0yD,EAAO5hD,KAAI,SAAUnO,GAC3C,MAAO,CACH5E,KAAmB,iBAAN4E,EAAiBsuD,GAAU3O,QAAU2O,GAAUoB,OAC5DtxD,MAAO4B,OAInB,GAAImgD,GAAgBzkB,GAApB,CAEI,KADIqnB,EAAMrnB,EAAG9+B,QAAQwB,IAAUs9B,EAAG9+B,QAAQozD,OAEtC,MAAM,IAAItB,GAAkBhzB,EAAGt9B,MAAOA,EAAO3C,OAAOiN,KAAKgzB,EAAG9+B,SAAUswD,GAE1E7vD,EAAOqC,KAAKw/C,MAAM7hD,EAAQ4xD,GAAclM,EAAI3kD,MAAO8wD,EAASC,EAAYC,EAASphD,SAGrF,GAAIqyC,GAAgB3kB,GAApB,CACI,IAAIqnB,EACJ,KADIA,EAAMrnB,EAAG9+B,QAAQ,IAAI6/B,OAAOr+B,KACtB,CACN,IAAK6xD,KAAKC,YACN,MAAM,IAAI3B,GAAY,kHAAqHH,GAAU+B,iBAAkBjD,GAE3K,IAAIkD,EAAOjB,EACNkB,eAAenB,EAAS,CAAE9zD,KAAMsgC,EAAGmvB,aACnCzK,OAAOhiD,GAASs9B,EAAG78B,QAAU,IAClCkkD,EAAMrnB,EAAG9+B,QAAQwzD,IAAS10B,EAAG9+B,QAAQozD,MAEzC,IAAKjN,EACD,MAAM,IAAI2L,GAAkBhzB,EAAGt9B,MAAOA,EAAO3C,OAAOiN,KAAKgzB,EAAG9+B,SAAUswD,GAE1E7vD,EAAOqC,KAAKw/C,MAAM7hD,EAAQ4xD,GAAclM,EAAI3kD,MAAO8wD,EAASC,EAAYC,EAASphD,EAAQ5P,GAASs9B,EAAG78B,QAAU,aAIvH,OAxKJ,SAAsByxD,GAClB,OAAIA,EAAMp0D,OAAS,EACRo0D,EAEJA,EAAM5M,QAAO,SAAUz1C,EAAKsiD,GAC/B,IAAIC,EAAWviD,EAAIA,EAAI/R,OAAS,GAShC,OARKs0D,GACDA,EAASp1D,OAASkzD,GAAU3O,SAC5B4Q,EAAKn1D,OAASkzD,GAAU3O,QAIxB6Q,EAASpyD,OAASmyD,EAAKnyD,MAHvB6P,EAAIvO,KAAK6wD,GAKNtiD,IACR,IAyJIwiD,CAAapzD,GC5JxB,SAASqzD,GAAaC,EAAeC,GACjC,OAAKA,EAGEn1D,OAAOiN,KAAKioD,GAAejN,QAAO,SAAUz1C,EAAKrF,GAb5D,IAAqBxD,EAAIG,EAejB,OADA0I,EAAIrF,IAdSxD,EAcQurD,EAAc/nD,IAdlBrD,EAcsBqrD,EAAQhoD,IAV5Ck2C,GAASA,GAASA,GAAS,GAAK15C,GAAM,IAAOG,GAAM,IAAM9J,OAAOiN,KAAKtD,GAAIs+C,QAAO,SAAUz1C,EAAKrF,GAElG,OADAqF,EAAIrF,GAAKk2C,GAASA,GAAS,GAAI15C,EAAGwD,IAAMrD,EAAGqD,IAAM,IAC1CqF,IACR,KALQ7I,GAaA6I,IACR6wC,GAAS,GAAI6R,IALLA,EAOf,SAASE,GAAuB91C,GAC5B,MAAO,CACHrf,OAAQ,WACJ,MAAO,CACHwG,IAAK,SAAUJ,GACX,OAAOiZ,EAAMjZ,IAEjB1B,IAAK,SAAU0B,EAAK1D,GAChB2c,EAAMjZ,GAAO1D,ODjCjC,SAAWkwD,GACPA,EAAUA,EAAmB,QAAI,GAAK,UACtCA,EAAUA,EAAkB,OAAI,GAAK,SAFzC,CAGGA,KAAcA,GAAY,KC8E7B,IAAIwC,GAAmC,WACnC,SAASA,EAAkBvwD,EAAS2uD,EAAS6B,EAAiBtiD,GAC1D,IA5CyB4+C,EA4CrBoB,EAAQ5yD,KAoCZ,QAnCgB,IAAZqzD,IAAsBA,EAAU4B,EAAkBE,eACtDn1D,KAAKo1D,eAAiB,CAClBlR,OAAQ,GACRa,SAAU,GACVsQ,YAAa,IAEjBr1D,KAAK2zD,OAAS,SAAUxhD,GACpB,IAAIsiD,EAAQ7B,EAAMQ,cAAcjhD,GAEhC,GAAqB,IAAjBsiD,EAAMp0D,OACN,OAAOo0D,EAAM,GAAGlyD,MAEpB,IAAIf,EAASizD,EAAM5M,QAAO,SAAUz1C,EAAKsiD,GASrC,OARKtiD,EAAI/R,QACLq0D,EAAKn1D,OAASkzD,GAAU3O,SACO,iBAAxB1xC,EAAIA,EAAI/R,OAAS,GAIxB+R,EAAIA,EAAI/R,OAAS,IAAMq0D,EAAKnyD,MAH5B6P,EAAIvO,KAAK6wD,EAAKnyD,OAKX6P,IACR,IACH,OAAI5Q,EAAOnB,QAAU,EACVmB,EAAO,IAAM,GAEjBA,GAEXxB,KAAKozD,cAAgB,SAAUjhD,GAC3B,OAAOihD,GAAcR,EAAM0C,IAAK1C,EAAMS,QAAST,EAAMU,WAAYV,EAAMW,QAASphD,OAAQnR,EAAW4xD,EAAMluD,UAE7G1E,KAAKu1D,gBAAkB,WAAc,MAAO,CACxCC,OAAQpB,KAAKqB,aAAaC,mBAAmB9C,EAAMS,SAAS,KAEhErzD,KAAK21D,OAAS,WAAc,OAAO/C,EAAM0C,KAClB,iBAAZ5wD,EAAsB,CAE7B,GADA1E,KAAK0E,QAAUA,GACVuwD,EAAkBW,QACnB,MAAM,IAAIngD,UAAU,+EAGxBzV,KAAKs1D,IAAML,EAAkBW,QAAQlxD,EAAS,CAC1C4lD,UAAW13C,MAAAA,OAAmC,EAASA,EAAK03C,iBAIhEtqD,KAAKs1D,IAAM5wD,EAEf,IAAKyD,MAAMC,QAAQpI,KAAKs1D,KACpB,MAAM,IAAI7/C,UAAU,kDAIxBzV,KAAKuzD,QAAUsB,GAAaI,EAAkB1B,QAAS2B,GAEvDl1D,KAAKqzD,QAAUA,EACfrzD,KAAKszD,WACA1gD,GAAQA,EAAK0gD,kBArGR,KADe9B,EAsGgCxxD,KAAKo1D,kBArG1C5D,EAAQ,CAC5BtN,OAAQ,GACRa,SAAU,GACVsQ,YAAa,KAEV,CACH3B,gBAAiBnC,IAAQ,WAGrB,IAFA,IAAI9lD,EACA8I,EAAO,GACF+yC,EAAK,EAAGA,EAAKlE,UAAU/iD,OAAQinD,IACpC/yC,EAAK+yC,GAAMlE,UAAUkE,GAEzB,OAAO,KAAM77C,EAAK2oD,KAAKqB,cAAclmC,KAAK8zB,MAAM53C,EAAI63C,GAAc,MAAC,GAAS/uC,GAAM,OACnF,CACCi9C,MAAOwD,GAAuBxD,EAAMtN,QACpC0N,SAAUY,GAAWN,WAEzB4B,kBAAmBvC,IAAQ,WAGvB,IAFA,IAAI9lD,EACA8I,EAAO,GACF+yC,EAAK,EAAGA,EAAKlE,UAAU/iD,OAAQinD,IACpC/yC,EAAK+yC,GAAMlE,UAAUkE,GAEzB,OAAO,KAAM77C,EAAK2oD,KAAKyB,gBAAgBtmC,KAAK8zB,MAAM53C,EAAI63C,GAAc,MAAC,GAAS/uC,GAAM,OACrF,CACCi9C,MAAOwD,GAAuBxD,EAAMzM,UACpC6M,SAAUY,GAAWN,WAEzBsC,eAAgBjD,IAAQ,WAGpB,IAFA,IAAI9lD,EACA8I,EAAO,GACF+yC,EAAK,EAAGA,EAAKlE,UAAU/iD,OAAQinD,IACpC/yC,EAAK+yC,GAAMlE,UAAUkE,GAEzB,OAAO,KAAM77C,EAAK2oD,KAAKC,aAAa9kC,KAAK8zB,MAAM53C,EAAI63C,GAAc,MAAC,GAAS/uC,GAAM,OAClF,CACCi9C,MAAOwD,GAAuBxD,EAAM6D,aACpCzD,SAAUY,GAAWN,aA6I7B,OA3EAtyD,OAAOuG,eAAe8uD,EAAmB,gBAAiB,CACtD5uD,IAAK,WAKD,OAJK4uD,EAAkBa,wBACnBb,EAAkBa,uBACd,IAAI1B,KAAKqB,cAAeF,kBAAkBC,QAE3CP,EAAkBa,uBAE7B1vD,YAAY,EACZ2vD,cAAc,IAElBd,EAAkBa,sBAAwB,KAC1Cb,EAAkBW,QAAUnL,GAI5BwK,EAAkB1B,QAAU,CACxBrP,OAAQ,CACJ8R,QAAS,CACLtO,sBAAuB,GAE3BF,SAAU,CACNr0B,MAAO,YAEX8iC,QAAS,CACL9iC,MAAO,YAGfha,KAAM,CACF4lB,MAAO,CACHwmB,MAAO,UACPC,IAAK,UACLH,KAAM,WAEV0O,OAAQ,CACJxO,MAAO,QACPC,IAAK,UACLH,KAAM,WAEV6Q,KAAM,CACF3Q,MAAO,OACPC,IAAK,UACLH,KAAM,WAEV8Q,KAAM,CACF1Q,QAAS,OACTF,MAAO,OACPC,IAAK,UACLH,KAAM,YAGdhB,KAAM,CACFtlB,MAAO,CACH6mB,KAAM,UACNC,OAAQ,WAEZkO,OAAQ,CACJnO,KAAM,UACNC,OAAQ,UACRC,OAAQ,WAEZoQ,KAAM,CACFtQ,KAAM,UACNC,OAAQ,UACRC,OAAQ,UACRC,aAAc,SAElBoQ,KAAM,CACFvQ,KAAM,UACNC,OAAQ,UACRC,OAAQ,UACRC,aAAc,WAInBkP,EAzI2B,GChFtC,SAASmB,GAAgBzvD,EAAKV,EAAK1D,GAYjC,OAXI0D,KAAOU,EACT/G,OAAOuG,eAAeQ,EAAKV,EAAK,CAC9B1D,MAAOA,EACP6D,YAAY,EACZ2vD,cAAc,EACdM,UAAU,IAGZ1vD,EAAIV,GAAO1D,EAGNoE,EAkBT,SAAS2vD,GAAyB71D,EAAQ81D,GACxC,GAAc,MAAV91D,EAAgB,MAAO,GAE3B,IAEIwF,EAAKhE,EAFLyL,EAlBN,SAAuCjN,EAAQ81D,GAC7C,GAAc,MAAV91D,EAAgB,MAAO,GAC3B,IAEIwF,EAAKhE,EAFLyL,EAAS,GACT8oD,EAAa52D,OAAOiN,KAAKpM,GAG7B,IAAKwB,EAAI,EAAGA,EAAIu0D,EAAWn2D,OAAQ4B,IACjCgE,EAAMuwD,EAAWv0D,GACbs0D,EAASngC,QAAQnwB,IAAQ,IAC7ByH,EAAOzH,GAAOxF,EAAOwF,IAGvB,OAAOyH,EAMM+oD,CAA8Bh2D,EAAQ81D,GAInD,GAAI32D,OAAO82D,sBAAuB,CAChC,IAAIC,EAAmB/2D,OAAO82D,sBAAsBj2D,GAEpD,IAAKwB,EAAI,EAAGA,EAAI00D,EAAiBt2D,OAAQ4B,IACvCgE,EAAM0wD,EAAiB10D,GACnBs0D,EAASngC,QAAQnwB,IAAQ,GACxBrG,OAAOD,UAAUi3D,qBAAqB12D,KAAKO,EAAQwF,KACxDyH,EAAOzH,GAAOxF,EAAOwF,IAIzB,OAAOyH,EAOT,IAJyB/L,GAIrB,IAJqBA,GC9CzB,KD+C6B,iBAAPA,IAAmB,YAAaA,GAAKA,GAAY,QAAIA,GAK3E,MAAMk1D,GAAe,KAErB,SAASC,GAASrC,GAChB,IAAIsC,GAAgB,EACpB,OAAOtC,EAAMpiD,QAAOoJ,GACC,YAAfA,EAAMlc,MAAuBkc,EAAMlZ,MAAMyzB,QAK3C+gC,GAAgB,GAGX,IAPDA,IACJA,GAAgB,GACT,KAoBb,SAASC,GAAmB3D,EAAStyD,EAAUk2D,IAC7Cj3D,KAAKqzD,QAAUA,EAEfrzD,KAAK2nD,KAAO,SAEZ3nD,KAAKmzB,MAAQpyB,EAAQoyB,OAAS6jC,GAAmBE,OAAOC,KAExDn3D,KAAKo3D,QAAUp3D,KAAKmzB,QAAU6jC,GAAmBE,OAAOG,MAExDr3D,KAAK2zD,OAAS5yD,EAAQ4yD,SAAW3zD,KAAKo3D,QAAU,sBAAwB,aAExEp3D,KAAKs3D,YAAcv2D,EAAQu2D,aAAeL,GAAeK,YAEzDt3D,KAAKu3D,eAAiBx2D,EAAQw2D,gBAAkBN,GAAeM,eAC/Dv3D,KAAKw3D,aAAgC,IAAlBz2D,EAAQqzB,MAG7B4iC,GAAmBS,MAAQ,CACzBC,IAAK,MACLC,KAAM,OACNC,OAAQ,SACRC,OAAQ,UAEVb,GAAmBE,OAAS,CAC1BY,OAAQ,SACRT,MAAO,QAEPF,KAAM,OACNY,MAAO,QACPC,OAAQ,UAGVhB,GAAmBr3D,UAAUyzD,cAAgB,SAAU7wD,GAErD,MAAMkyD,EAAQ,IAAI,GAAkBz0D,KAAK2zD,OAAQ3zD,KAAKqzD,SAASD,cAAc,CAC3EtN,OAAQ,CACN6B,KAAMqP,GAAmBS,MAAMI,QAEjCjkC,QAAS,CACP+zB,KAAMqP,GAAmBS,MAAMI,QAEjChS,OAAQ,CACN8B,KAAMqP,GAAmBS,MAAMG,QAEjCK,QAAS,CACPtQ,KAAMqP,GAAmBS,MAAMG,QAEjChS,KAAM,CACJ+B,KAAMqP,GAAmBS,MAAME,MAEjCO,MAAO,CACLvQ,KAAMqP,GAAmBS,MAAME,MAEjCnS,IAAK,CACHmC,KAAMqP,GAAmBS,MAAMC,KAEjCS,KAAM,CACJxQ,KAAMqP,GAAmBS,MAAMC,OAI7BU,EAmHR,SAA+B71D,EAAO81D,EAAW5D,EAAO+C,GACtD,IAAI5jC,EAAUrxB,EAAQ+1D,GAAWD,GAGjC,GAAIb,EAAa,CACf,MAAMe,EAAa,CAACvB,GAAmBS,MAAMI,OAAQb,GAAmBS,MAAMG,OAAQZ,GAAmBS,MAAME,KAAMX,GAAmBS,MAAMC,KAAKz9C,MAAK0tC,GAAQz2C,GAAIujD,EAAO9M,KAErK6Q,EAAY5kC,EAAU0kC,GAAWC,GAEnC,EAAIC,GAAaF,GAAWC,KAE9B3kC,GAAW0kC,GAAWC,GAAcC,GAIxC,MAAMJ,EAAU,GAOhB,MANA,CAACpB,GAAmBS,MAAMC,IAAKV,GAAmBS,MAAME,KAAMX,GAAmBS,MAAMG,OAAQZ,GAAmBS,MAAMI,QAAQ58B,SAAQ0sB,IAClIz2C,GAAIujD,EAAO9M,KACbyQ,EAAQzQ,GAAQpkD,KAAKunB,MAAM8I,EAAU0kC,GAAW3Q,IAChD/zB,GAAWwkC,EAAQzQ,GAAQ2Q,GAAW3Q,OAGnCyQ,EAzISK,CAAsBl2D,EAAOvC,KAAK2nD,KAAM8M,EAAOz0D,KAAKw3D,aAE9Dh2D,EAASizD,EAAM5M,QAAO,CAACz1C,EAAKqJ,IAAUrJ,EAAIwuB,OAAO5gC,KAAK04D,aAAaj9C,EAAO28C,KAAW,IAC3F,OAAOp4D,KAAK24D,YAAYn3D,EAAQizD,IAGlCuC,GAAmBr3D,UAAU+4D,aAAe,SAAUj9C,EAAO28C,GAC3D,MAAM,MACJ71D,GACEkZ,EAEJ,GAAIlZ,EAAMolD,KAAM,CACd,MAAMzD,EAASkU,EAAQ71D,EAAMolD,MAC7B,OAAOzD,GAAUlkD,KAAKo3D,QAAUp3D,KAAK44D,uBAAuBr2D,EAAMolD,KAAMzD,GAAU,GAC7E,OAAI3hD,EAEF,CAAC,CACNhD,KAAM,UACNgD,MAAAA,IAIG,IAGTy0D,GAAmBr3D,UAAUi5D,uBAAyB,SAAUjR,EAAMzD,GACpE,OAAIlkD,KAAKo3D,QAEA,CAAC,CACN73D,KAAMooD,EACNplD,MAAOvC,KAAK64D,aAAa3U,MA8GP/wB,EA5GInzB,KAAKmzB,MA6GxB,CAAC6jC,GAAmBE,OAAOC,KAAMH,GAAmBE,OAAOa,MAAOf,GAAmBE,OAAOc,QAAQhrD,SAASmmB,GA5G3G,IAAIihC,KAAKqB,aAAaz1D,KAAKqzD,QAAS,CACzClgC,MAAO,OACPw0B,KAAMA,EACNI,YAAa/nD,KAAKmzB,QACjBigC,cAAclP,GAAQ5xC,KAAI/F,IAAK,CAGhChN,KAAiB,YAAXgN,EAAEhN,KAAqBooD,EAAOp7C,EAAEhN,KACtCgD,MAAOgK,EAAEhK,UAKNvC,KAAKu3D,eAAe38B,MAAMk+B,IAAcxmD,KAAIi2B,IACjD,GAAa,YAATA,EACF,MAAO,CACLhpC,KAAMooD,EACNplD,MAAOvC,KAAK64D,aAAa3U,IAI7B,GAAa,WAAT3b,EAAmB,CACrB,MAAM7jC,EAAU1E,KAAKs3D,YAAY3P,IAAS,UAI1C,MAAO,CACLpoD,KAAM,OACNgD,MALoB,IAAI,GAAkBmC,EAAS1E,KAAKqzD,SAASM,OAAO,CACxEpxD,MAAO2hD,KAQX,OAAI3b,EACK,CACLhpC,KAAM,UACNgD,MAAOgmC,QAHX,KAMCl2B,OAAO0mD,UAqEZ,IAAwB5lC,GAlExB6jC,GAAmBr3D,UAAUk5D,aAAe,SAAU3U,GACpD,OAAOlkD,KAAKo3D,QAAUlT,EAAOhiD,WAAW82D,SAAS,EAAG,KAAO9U,EAAOhiD,YAGpE80D,GAAmBr3D,UAAUg5D,YAAc,SAAUn3D,EAAQizD,GAC3D,MAAMwE,EAvJR,SAAcxE,EAAOyE,GAAuB,GAC1C,MAAMD,EAAUnC,GAASA,GAASrC,GAAO7xD,WAAWA,UAEpD,GAAIs2D,EAAsB,CACxB,MAAMpP,EAAQmP,EAAQh/C,MAAKwB,GAAwB,YAAfA,EAAMlc,OAC1CuqD,EAAMvnD,MAAQunD,EAAMvnD,MAAM8H,QAAQwsD,GAAc,IAGlD,OAAOoC,EA+ISjjC,CAAKx0B,EAAQxB,KAAKo3D,SAElC,IAAK6B,EAAQh/C,MAAK1N,GAAgB,YAAXA,EAAEhN,OAAqB,CAG5C,MAAM45D,EAAU,CAACnC,GAAmBS,MAAMI,OAAQb,GAAmBS,MAAMG,OAAQZ,GAAmBS,MAAME,KAAMX,GAAmBS,MAAMC,KAAKz9C,MAAK0tC,GAAQz2C,GAAIujD,EAAO9M,KACxK,OAAO3nD,KAAK44D,uBAAuBO,EAAS,GAG9C,OAAOF,GAGT,MAAMhC,GAAiB,CAErBM,eAAgB,iBAChBD,YAAa,CAEX,CAACN,GAAmBS,MAAMC,KAAM,0CAChC,CAACV,GAAmBS,MAAME,MAAO,4CACjC,CAACX,GAAmBS,MAAMG,QAAS,gDACnC,CAACZ,GAAmBS,MAAMI,QAAS,iDAErC1kC,MAAO6jC,GAAmBE,OAAOC,MAE7B2B,GAAe,uBACfR,GAAa,CACjB9S,IAAK,MACLI,KAAM,KACNC,OAAQ,GACRC,OAAQ,GAGV,SAAS50C,GAAIujD,EAAO9M,GAClB,QAAS8M,EAAMx6C,MAAK1N,GAAKA,EAAEhK,MAAMolD,OAASA,IAgC5C,IAAIyR,GAAyBpC,GAGzBqC,GAAe,eAiDnB,UAFY,IAAAhmC,aA7CZ,SAAyBimC,GACvB,IAAIC,EAEAlqC,EAAOiqC,EAAKjqC,KACZuE,EAAU0lC,EAAK1lC,QACf+/B,EAAS2F,EAAK3F,OACd6F,EAAgBF,EAAKE,cACrBzR,EAAcuR,EAAKvR,YACnB0R,EAAiBH,EAAKG,eACtBC,EAAapD,GAAyBgD,EAAM,CAAC,OAAQ,UAAW,SAAU,gBAAiB,cAAe,mBAE1GK,EAAetqC,EAAKxB,SAAS,+CAA+C+S,OAAO+yB,GAAU,MAAQA,EAEpGA,GAhBe,oBAgBLA,IACbgG,EAAetqC,EAAKxB,SAAS,iDAAmD,uBAG9E8lC,IAAW0F,KACbM,EAAetqC,EAAKxB,SAAS,kDAAoD,uBAGnF,IAAI+rC,EAAc7R,EAEb6R,IACHA,EAAcjG,IAAW0F,GAAeD,GAAuBlC,OAAOG,MAAQ+B,GAAuBlC,OAAOY,QAG9G,IAAIrD,EAAQ,IAAI2E,GAAuB/pC,EAAKmmC,OAAQ,CAClD7B,OAAQgG,EACRrC,aAAciC,EAAe,GAAInD,GAAgBmD,EAAcH,GAAuB3B,MAAMC,IAAKroC,EAAKxB,SAAS,2CAA6C,2CAA4CuoC,GAAgBmD,EAAcH,GAAuB3B,MAAME,KAAMtoC,EAAKxB,SAAS,4CAA8C,6CAA8CuoC,GAAgBmD,EAAcH,GAAuB3B,MAAMG,OAAQvoC,EAAKxB,SAAS,8CAAgD,iDAAkDuoC,GAAgBmD,EAAcH,GAAuB3B,MAAMI,OAAQxoC,EAAKxB,SAAS,8CAAgD,iDAAkD0rC,GACztBhC,eAAgBloC,EAAKxB,SAAS,2CAA6C,iBAC3EuG,OAAO,EAEPjB,MAAOymC,IACNxG,cAAcx/B,GACbimC,EAAOL,GAAiBnqC,EAAKmqC,cAC7BM,EAAQL,GAAkBD,GAAiBnqC,EAAKmqC,cACpD,OAAO,kBAAoBK,EAAMH,EAAYjF,EAAMniD,KAAI,SAAUmJ,GAC/D,MAAmB,YAAfA,EAAMlc,MAAqC,SAAfkc,EAAMlc,KAAwBkc,EAAMlZ,MAC7D,kBAAoBu3D,EAAO,CAChC7zD,IAAKwV,EAAMlc,MACVkc,EAAMlZ,cE7UE,MAAMw3D,WAAmBjzD,IAAAA,UACtChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXy+B,WAAY,KACZ56B,SAAU,GAGZp/B,KAAKi6D,aAAej6D,KAAKi6D,aAAa1qC,KAAKvvB,MAC3CA,KAAK2oC,aAAe3oC,KAAK2oC,aAAapZ,KAAKvvB,MAG7Ci6D,aAAaxjC,EAAKlC,EAAU2lC,GAC1B,IAAKzjC,EAEH,YADAz2B,KAAKoQ,MAAMshB,QAAQ,yBAA2B+E,EAAM,KAItD,MAAMujC,EAAah6D,KAAKoQ,MAAMmgB,OAAOujB,qBACrC9zC,KAAK48B,SAAS,CAACo9B,WAAYA,IAC3BA,EAAWG,SAAS1jC,EAAKlC,EAAU2lC,GAChCE,IACCp6D,KAAK48B,SAAS,CAACwC,SAAUg7B,EAASp6D,KAAKoQ,MAAMwO,UAE9C2G,IACCvlB,KAAKoQ,MAAMshB,QAAQnM,EAAK,UAE1BtM,MAAK,KACLjZ,KAAK48B,SAAS,CAACo9B,WAAY,KAAM56B,SAAU,OAC1Cz0B,OAAO4a,IACJA,GACFvlB,KAAKoQ,MAAMshB,QAAQ,2BAA6BnM,EAAI7gB,QAAS,OAE/D1E,KAAK48B,SAAS,CAACo9B,WAAY,KAAM56B,SAAU,OAI/CuJ,eACM3oC,KAAKoQ,MAAMs3B,UACb1nC,KAAKoQ,MAAMmvB,iBACFv/B,KAAKu7B,MAAMy+B,YACpBh6D,KAAKu7B,MAAMy+B,WAAW3iC,SAI1BpL,SACE,IAAIsI,EAAWv0B,KAAKoQ,MAAMmkB,UAAY,kBAClCA,EAASl0B,OAAS,KACpBk0B,EAAWA,EAASpyB,OAAO,EAAG,IAAM,MAAQoyB,EAASpyB,QAAQ,KAE/D,IAOIs0B,EAAK4jC,EAPLz7C,EAAO5e,KAAKoQ,MAAMwO,KAAO,EAC3B,0BAAMuN,UAAU,cAAhB,IAA+B4H,GAAiB/zB,KAAKoQ,MAAMwO,MAA3D,KACA,KAMG5e,KAAKoQ,MAAMs3B,WAAc1nC,KAAKu7B,MAAMy+B,alD6CtC,SAAuBvjC,GAC5B,OAAOA,IAAQ,kCAAkC1Y,KAAK0Y,GkD9CG6jC,CAAct6D,KAAKoQ,MAAMmqD,cAQ9E9jC,EAAMD,GAAYx2B,KAAKoQ,MAAMmqD,aAC7BF,EAAa,OAPb5jC,EAAM,IACN4jC,EAAc5zD,IACZA,EAAEwqB,iBACFjxB,KAAKi6D,aAAaj6D,KAAKoQ,MAAMmqD,YAAav6D,KAAKoQ,MAAMmkB,SAAUv0B,KAAKoQ,MAAM8pD,YAM9E,MAAMM,EAAiB,oCAAE,uBAAGruC,UAAU,kBAAb,iBAAF,IAAkD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAC3FkpB,eAAc,2BAChB,OACE,yBAAKJ,UAAU,cACb,6BAAK,uBAAGA,UAAU,2BAAb,sBACL,yBAAKA,UAAU,eACb,6BAAMoI,EAAN,IAAiB3V,GAChB5e,KAAKoQ,MAAMs3B,WAAa1nC,KAAKu7B,MAAMy+B,WAClC,kBAAC76B,GAAD,CAAcC,SAAUp/B,KAAKoQ,MAAMs3B,UAAY1nC,KAAKoQ,MAAMgvB,SAAWp/B,KAAKu7B,MAAM6D,SAC9EC,SAAUr/B,KAAK2oC,eAEjB,6BAAMlS,EACJ,uBAAGjB,KAAMiB,EAAK0jC,SAAUn6D,KAAKoQ,MAAMmkB,SAAUlI,QAASguC,GAAaG,GAEnE,0BAAMruC,UAAU,cAAcquC,OCnF5C,MAAM3sC,IAAWC,EAAAA,EAAAA,gBAAe,CAC9B2sC,gBAAiB,CACfp3D,GAAI,kBACJkpB,eAAgB,CAAF,8BAGhBmuC,uBAAwB,CACtBr3D,GAAI,yBACJkpB,eAAgB,CAAF,4BAKlB,MAAMouC,WAAuB7zD,IAAAA,cAC3BmlB,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KACnC,IAAIurC,EAEFA,EADE56D,KAAKoQ,MAAM6mB,UAAYlL,GAAAA,OAAAA,uBACbqD,EAAcvB,GAAS4sC,iBAC1Bz6D,KAAKoQ,MAAM6mB,UAAYlL,GAAAA,OAAAA,sBACpBqD,EAAcvB,GAAS6sC,wBAEvB16D,KAAKoQ,MAAMwqD,UAAUC,mBAAmB76D,KAAKoQ,MAAMif,KAAKmmC,OAAQ,CAAEsF,UAAW,UAG3F,MAAMpnC,EAAOsD,GAAeh3B,KAAKoQ,MAAM6mB,UACjCyL,EAAShP,EAAO,uBAAGvH,UAAW,wBAA0BuH,EAAKD,OAAQC,EAAKp0B,MAAY,KAE5F,OACE,0BAAM6sB,UAAU,aACbyuC,EAAW,IAAUl4B,IAM9B,UAAerP,EAAAA,EAAAA,YAAWsnC,I,mNC9B1B,MAAMI,WAAwBj0D,IAAAA,cAC5BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX6D,SAAU,GAGRhvB,EAAMyjC,WACRzjC,EAAMyjC,SAASmnB,WAAah7D,KAAKi7D,eAAe1rC,KAAKvvB,OAGvDA,KAAKk7D,mBAAqBl7D,KAAKk7D,mBAAmB3rC,KAAKvvB,MACvDA,KAAKm7D,sBAAwBn7D,KAAKm7D,sBAAsB5rC,KAAKvvB,MAC7DA,KAAKyhC,mBAAqBzhC,KAAKyhC,mBAAmBlS,KAAKvvB,MACvDA,KAAKo7D,mBAAqBp7D,KAAKo7D,mBAAmB7rC,KAAKvvB,MACvDA,KAAKq7D,iBAAmBr7D,KAAKq7D,iBAAiB9rC,KAAKvvB,MAEnDA,KAAKs7D,iBAAmB,CACtBlsC,cAAehf,EAAMif,KAAKD,cAAcG,KAAKnf,EAAMif,MACnD0Q,cAAe3vB,EAAM2vB,cACrBhI,aAAc3nB,EAAMmgB,OAAOwH,aAAaxI,KAAKnf,EAAMmgB,QACnD4P,eAAgBngC,KAAKk7D,mBACrB16B,kBAAmBxgC,KAAKm7D,sBACxBx6B,aAAc3gC,KAAKq7D,kBAIvBH,mBAAmBz0D,GACjBA,EAAEwqB,iBACFjxB,KAAKoQ,MAAM+vB,eAAe,CACxB1J,IAAKhwB,EAAEiH,OAAOuqB,IACd1D,SAAU9tB,EAAEiH,OAAOwa,MACnBsQ,MAAO/xB,EAAEiH,OAAO8jB,QAAQgH,MACxBC,OAAQhyB,EAAEiH,OAAO8jB,QAAQiH,OACzB7Z,KAAMnY,EAAEiH,OAAO8jB,QAAQ5S,KACvBrf,KAAMkH,EAAEiH,OAAO8jB,QAAQ+F,OAI3B4jC,sBAAsB10D,GACpBA,EAAEwqB,iBACF,MAAMjvB,EAAO,CACX6vB,IAAK7xB,KAAKoQ,MAAMyhB,IAElB7vB,KAAY,IACRyE,EAAEiH,OAAO8jB,QAAQlyB,OACnB0C,EAAKu5D,KAAK90D,EAAEiH,OAAO8jB,QAAQlyB,MAAQmH,EAAEiH,OAAO8jB,QAAQhc,IAAM/O,EAAEiH,OAAO8jB,QAAQhc,SAChDxU,IAAzByF,EAAEiH,OAAO8jB,QAAQhc,IAAoB,EAAI,GAAK/O,EAAEiH,OAAO8jB,QAAQhc,KAEvC,OAAxB/O,EAAEiH,OAAO8jB,QAAQgqC,MACnBx5D,EAAKoxB,IAAMoD,GAAY/vB,EAAEiH,OAAO8jB,QAAQ4B,MAAQ,eAElD,MAAMmV,EAAO9hC,EAAEiH,OAAO8jB,QAAQtJ,OAAS,UACvCloB,KAAKoQ,MAAMqrD,eAAeh1D,EAAEiH,OAAO8jB,QAAQgqC,IAAKjzB,EAAMvmC,GAGxDy/B,mBAAmBh7B,GACjBA,EAAEwqB,iBACFxqB,EAAEyqB,kBACF,MAAMqrB,EAAY,GACdv8C,KAAKoQ,MAAM6mB,UAAYlL,GAAAA,OAAAA,uBACzBwwB,EAAU14C,KAAK,wBAEb7D,KAAKoQ,MAAMsrD,cACX17D,KAAKoQ,MAAM6mB,SAAWlL,GAAAA,OAAAA,uBACtB/rB,KAAKoQ,MAAM6mB,SAAWlL,GAAAA,OAAAA,0BACxBwwB,EAAU14C,KAAK,mBAEjB04C,EAAU14C,KAAK,qBAEf7D,KAAKoQ,MAAMuxB,gBAAgB,CACzB9P,IAAK7xB,KAAKoQ,MAAMyhB,IAChBxtB,QAASrE,KAAKoQ,MAAM/L,QACpBiuB,SAAUtyB,KAAKoQ,MAAMkiB,SACrBC,SAAUvyB,KAAKoQ,MAAMmiB,SACrBW,EAAGzsB,EAAEm7B,MACL59B,EAAGyC,EAAEo7B,MACLxP,UAAWryB,KAAKoQ,MAAMiiB,WACrBkqB,GAGL0e,eAAeU,GACb37D,KAAK48B,SAAS,CAACwC,SAAUu8B,IAG3BP,qBACEp7D,KAAKoQ,MAAMmvB,eAAev/B,KAAKoQ,MAAMyhB,IAAK7xB,KAAKoQ,MAAMyjC,UAGvDwnB,iBAAiB50D,GACfA,EAAEwqB,iBACFxqB,EAAEyqB,kBACF,MAAM0qC,EAAa57D,KAAKoQ,MAAMwrD,WAC1BA,GACF57D,KAAKoQ,MAAMuwB,aAAai7B,GAI5B3vC,SACE,MAAM4vC,EAAY77D,KAAKoQ,MAAM0rD,SAAW,KAAO97D,KAAKoQ,MAAMoL,SAAW,OAAS,SACxEugD,EAAsC,UAAvB/7D,KAAKoQ,MAAM0rD,UAA+C,QAAvB97D,KAAKoQ,MAAM0rD,SAAsB,aAAe,SAClGpkC,EAAS13B,KAAKoQ,MAAMu8B,aAAc,EAClCqvB,EAAeh8D,KAAKoQ,MAAMunB,SAAW33B,KAAKoQ,MAAMoL,WAC5B,UAAvBxb,KAAKoQ,MAAM0rD,UAA+C,QAAvB97D,KAAKoQ,MAAM0rD,UAEjD,IAAIz3D,EAAUrE,KAAKoQ,MAAM/L,QACzB,MAAM43D,EAAc,GACpB,GAAIj8D,KAAKoQ,MAAMnL,UAAYi7B,GAAAA,OAAAA,kBAA2BA,GAAAA,OAAAA,QAAe77B,GAAU,CAC7E67B,GAAAA,OAAAA,YAAmB77B,GAAS,CAAC63D,EAAKj6D,KAChB,oBAAZi6D,EAAI3kC,MAKR0kC,EAAYp4D,KAAK,kBAACk2D,GAAD,CACfxpC,OAAQvwB,KAAKoQ,MAAMmgB,OACnBgqC,YAAar6B,GAAAA,OAAAA,eAAsBg8B,GACnC3nC,SAAU2nC,EAAI58D,KACdooC,UAAWxH,GAAAA,OAAAA,aAAoBg8B,GAC/BhC,SAAUgC,EAAI3kC,KACd3Y,KAAMshB,GAAAA,OAAAA,cAAqBg8B,GAC3B98B,SAAUp/B,KAAKu7B,MAAM6D,SACrBG,eAAgBv/B,KAAKo7D,mBACrB1pC,QAAS1xB,KAAKoQ,MAAMshB,QACpBzrB,IAAKhE,OACNjC,MACH,MAAMm8D,EAAOj8B,GAAAA,OAAAA,OAAc77B,EAASg8B,GAAergC,KAAKs7D,kBACxDj3D,EAAUyC,IAAAA,cAAoBA,IAAAA,SAAgB,KAAMq1D,QAC/C,GAAIn8D,KAAKoQ,MAAM0nB,QAEpBzzB,EAAU,oCAAE,uBAAG8nB,UAAU,uBAAb,SAAF,IAA+C,uBAAGA,UAAU,QACpE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClBkpB,eAAc,4CAEb,GAAI+K,GAAYt3B,KAAKoQ,MAAMnL,UAAW,CAE3C,MAAMm3D,EAAYp8D,KAAKoQ,MAAMoL,SAAW,gBAAkB,YACpD+sB,EAAOvoC,KAAKoQ,MAAMoL,SACtB,kBAAC,EAAA8Q,iBAAD,CAAkBjpB,GAAE,iBAClBkpB,eAAc,mCAChB,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,iBAClBkpB,eAAc,mCACZ8vC,EAAsC,gBAAtBr8D,KAAKoQ,MAAM/L,QACjCA,EAAU,oCAAE,uBAAG8nB,UAAU,iBAAiBgH,MAAO,CAACM,MAAO4oC,EAAgB,MAAQ,UAAWD,GAAe7zB,EACtG8zB,EAED,KADA,CAAC,KAAM,kBAAC,GAAD,CAAmBzoC,QAAS5zB,KAAKoQ,MAAMvP,SAAW,IAAM8yD,OAAO,gCAAkC,UAGjF,iBAAXtvD,IAChBA,EAAU,oCAAE,uBAAG8nB,UAAU,uBAAb,iBAAF,IAAuD,uBAAGA,UAAU,QAC5E,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClBkpB,eAAc,wCAGpB,OACE,wBAAI6G,IAAKpzB,KAAKoQ,MAAMksD,SAAUnwC,UAAW0vC,GACtC77D,KAAKoQ,MAAMunB,SAAW33B,KAAKoQ,MAAMoL,SAChC,yBAAK2Q,UAAU,cACZ6vC,EACC,kBAACvkC,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBD,MAAOtwB,KAAKoQ,MAAMkiB,SAClBpK,MAAOloB,KAAKoQ,MAAMmiB,SAClBmF,OAAQA,IACV,MAEJ,KACF,6BACE,yBAAKvL,UAAW4vC,GACd,yBAAK5vC,UAAU,gBACb,yBAAKA,UAAU,mBACZ9nB,EACA43D,GAEFj8D,KAAKoQ,MAAMwqD,UACV,kBAAC,GAAD,CACEA,UAAW56D,KAAKoQ,MAAMwqD,UACtB3jC,SAAUj3B,KAAKoQ,MAAM6mB,WACrB,MAELj3B,KAAKoQ,MAAMuxB,gBACV,0BAAMxV,UAAU,eACd,uBAAGqJ,KAAK,IAAInJ,QAASrsB,KAAKyhC,oBACxB,uBAAGtV,UAAU,kBAAb,iBAEM,MAGb6vC,EACC,yBAAK7vC,UAAU,UACZnsB,KAAKoQ,MAAMmiB,UACV,2BAAG,kBAAC,EAAAjG,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,iCAIzD,QAQd,MAAMgwC,IAAkBlpC,EAAAA,EAAAA,YAAW0nC,IAGnC,GAFoBj0D,IAAAA,YAAiB,CAACsJ,EAAOgjB,IAAQ,kBAACmpC,GAAD,IAAiBD,SAAYlpC,GAAShjB,M,wBC/M3F,MAQMosD,GAAiB,IAejBC,GAAkB,aAET,MAAMC,WAAsB51D,IAAAA,cACzChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX0mB,SAAS,EACT0a,YAAa,KACbC,WAAW,EACXC,QAAQ,EACRh8D,SAAU,OACVi8D,QAAS,KACTxhC,QAAS,MAGXt7B,KAAK+7B,UAAY/7B,KAAK+7B,UAAUxM,KAAKvvB,MACrCA,KAAK+8D,mBAAqB/8D,KAAK+8D,mBAAmBxtC,KAAKvvB,MACvDA,KAAK67B,WAAa77B,KAAK67B,WAAWtM,KAAKvvB,MACvCA,KAAKg9D,aAAeh9D,KAAKg9D,aAAaztC,KAAKvvB,MAC3CA,KAAKi9D,QAAUj9D,KAAKi9D,QAAQ1tC,KAAKvvB,MAEjCA,KAAKk9D,aAAel9D,KAAKk9D,aAAa3tC,KAAKvvB,MAC3CA,KAAKm9D,YAAcn9D,KAAKm9D,YAAY5tC,KAAKvvB,MACzCA,KAAKo9D,aAAep9D,KAAKo9D,aAAa7tC,KAAKvvB,MAC3CA,KAAKq9D,WAAar9D,KAAKq9D,WAAW9tC,KAAKvvB,MAEvCA,KAAKs9D,eAAiB,EACtBt9D,KAAKu9D,UAAY,KACjBv9D,KAAKo8B,WAAa,GAClBp8B,KAAKq8B,UAAYv1B,IAAAA,YAGnB8pB,oBACE5wB,KAAK0/C,OAAS,KACd1/C,KAAKw9D,cAAgB,KACrBx9D,KAAKy9D,aAAe,KACpBz9D,KAAK09D,WAAa,KAClB19D,KAAK29D,SAAW,KAEhB39D,KAAK49D,YAAc,GAGnB,IACE/9C,UAAUqgC,aAAaC,aAAa,CAACnC,OAAO,EAAMC,OAAO,IAAQhlC,KAAKjZ,KAAK+8D,mBAAoB/8D,KAAKoQ,MAAMshB,SAC1G,MAAOnM,GACPvlB,KAAKoQ,MAAMshB,QAAQnM,IAIvBuL,uBACE9wB,KAAKu9D,UAAY,KACbv9D,KAAK0/C,QACP1/C,KAAKi9D,UAKTlhC,YACE/7B,KAAK67B,aAEL,MAAMgiC,EAAU,IAAIt8D,WAAWvB,KAAK29D,SAASG,mBACvCtlC,EAAQx4B,KAAK+9D,YACbtlC,EAASz4B,KAAKg+D,aAEdC,EAAczlC,EAAQ,GAA0B,EAEhD0lC,EAAe1B,GAAiByB,EAEtCj+D,KAAKg9B,cAAcG,UAxFJ,EAyFfn9B,KAAKg9B,cAAcU,YAnFL,OAqFd,IAAIygC,EAAe,EACfC,EAAS,EACTC,EAAc,EAClB,MAAMjhC,EAAY,KAChB,IAAKp9B,KAAKu9D,UACR,OAEF72D,OAAO22B,sBAAsBD,GAE7B,MAAMv8B,EAAWb,KAAKs9D,gBAAkB5oD,KAAKD,MAAQzU,KAAKu9D,WAE1Dv9D,KAAK48B,SAAS,CAAC/7B,SAAU8yB,GAAc9yB,EAAW,OAG9CA,EA7FW,MA8Fbb,KAAKu9D,UAAY,KACjBv9D,KAAKw9D,cAAc/gC,QACnBz8B,KAAKs9D,gBAAkB5oD,KAAKD,MAAQzU,KAAKu9D,UACzCv9D,KAAK48B,SAAS,CAACqlB,SAAS,EAAO2a,WAAW,EAAO/7D,SAAU8yB,GAAc3zB,KAAKs9D,eAAiB,QAMjGt9D,KAAK29D,SAASW,sBAAsBT,GACpC,IAAIr/B,EAAM,EACV,IAAK,MAAM+/B,KAAaV,EACtBr/B,IAAQ+/B,EAAY,MAAQ,EAI9BH,GAAU76D,KAAKqsC,KAAKpR,EAAIq/B,EAAQx9D,QAChCg+D,IAEA,IAAIlgC,EAAYt9B,EAAW27D,GAAkB,EAE7C,MAAMgC,EAAKN,EAAer9D,EAAW,GAClCA,EAAW27D,GAAiBr+B,GAAYq+B,GAAzC,GAEE2B,GAAgBhgC,IAClBggC,EAAehgC,EAEfn+B,KAAKo8B,WAAWv4B,KAAKu6D,EAAOC,GAC5BD,EAAS,EACTC,EAAc,EACVr+D,KAAKo8B,WAAW/7B,OAAS49D,GAE3Bj+D,KAAKo8B,WAAWqgB,SAKpBz8C,KAAKg9B,cAAcxC,UAAU,EAAG,EAAGhC,EAAOC,GAG1Cz4B,KAAKg9B,cAAcS,YACnB,IAAK,IAAIx7B,EAAI,EAAGA,EAAIjC,KAAKo8B,WAAW/7B,OAAQ4B,IAAK,CAC/C,IAAI+B,EAAQ,GAAJ/B,EAA6Bu8D,EACjCtrC,EAAI3vB,KAAKC,IAAIxD,KAAKo8B,WAAWn6B,GA7IvB,GA6IuC,IAAOw2B,EAExDz4B,KAAKg9B,cAAcY,OAAO55B,EAAkB,IAAdy0B,EAASvF,IACvClzB,KAAKg9B,cAAca,OAAO75B,EAAY,GAATy0B,EAAmB,GAAJvF,GAG9ClzB,KAAKg9B,cAAcW,UAGrBP,IAGF+/B,YAAY12D,GACVA,EAAEwqB,iBACFjxB,KAAKw9D,cAAc/gC,QACnBz8B,KAAKw9D,cAAciB,cACnBz+D,KAAKs9D,gBAAkB5oD,KAAKD,MAAQzU,KAAKu9D,UACzCv9D,KAAKu9D,UAAY,KACjBv9D,KAAK48B,SAAS,CAACggC,WAAW,IAG5BM,aAAaz2D,GACXA,EAAEwqB,iBACEjxB,KAAKu7B,MAAM0mB,UACbjiD,KAAKu9D,UAAY7oD,KAAKD,MACtBzU,KAAKw9D,cAAckB,SACnB1+D,KAAK48B,SAAS,CAACggC,WAAW,GAAO58D,KAAK+7B,YAI1CqhC,aAAa32D,GACXA,EAAEwqB,iBACFjxB,KAAKs9D,eAAiB,EACtBt9D,KAAKu9D,UAAY,KACjBv9D,KAAKw9D,cAActe,OACnBl/C,KAAKi9D,UACLj9D,KAAK48B,SAAS,CAACggC,WAAW,IAG5BS,WAAW52D,GACTA,EAAEwqB,iBACFjxB,KAAK48B,SAAS,CAACggC,WAAW,IACtB58D,KAAKu9D,YACPv9D,KAAKs9D,gBAAkB5oD,KAAKD,MAAQzU,KAAKu9D,UACzCv9D,KAAKu9D,UAAY,MAGfv9D,KAAKw9D,eACPx9D,KAAKw9D,cAActe,OAIvBrjB,aACE77B,KAAKq8B,UAAUrL,QAAQwH,MA5MF,EA4MUx4B,KAAKq8B,UAAUrL,QAAQ8L,YACtD98B,KAAKq8B,UAAUrL,QAAQyH,OA7MF,EA6MWz4B,KAAKq8B,UAAUrL,QAAQ+L,aAEvD/8B,KAAKg9B,cAAgBh9B,KAAKq8B,UAAUrL,QAAQqJ,WAAW,MACvDr6B,KAAKg9B,cAAcC,QAAU,QAE7Bj9B,KAAKg9B,cAAcwR,UAAU,GAAK,IAClCxuC,KAAK+9D,YAAc/9D,KAAKq8B,UAAUrL,QAAQwH,MAC1Cx4B,KAAKg+D,aAAeh+D,KAAKq8B,UAAUrL,QAAQyH,OAG7CskC,mBAAmBrd,GACjB1/C,KAAK0/C,OAASA,EACd1/C,KAAKw9D,cAAgB,IAAImB,cAAcjf,EAAQ,CAACz6C,SAAUw3D,KAG1Dz8D,KAAKy9D,aAAe,IAAImB,aACxB5+D,KAAK09D,WAAa19D,KAAKy9D,aAAaoB,wBAAwBnf,GAC5D1/C,KAAK29D,SAAW39D,KAAKy9D,aAAaqB,iBAClC9+D,KAAK29D,SAASoB,QAjOE,IAkOhB/+D,KAAK09D,WAAWsB,QAAQh/D,KAAK29D,UAE7B39D,KAAKw9D,cAAcyB,OAAS1yD,IACtBvM,KAAKs9D,eAvNM,IAwNbt9D,KAAKg9D,aAAah9D,KAAKw9D,cAAcv4D,SAAUjF,KAAKs9D,gBACjDrkD,MAAKzX,GAAUxB,KAAKoQ,MAAMqgC,WAAWjvC,EAAOi1B,IAAKj1B,EAAO85B,QAASt7B,KAAKs9D,kBAEzEt9D,KAAKoQ,MAAM8uD,YAEbl/D,KAAKi9D,WAGPj9D,KAAKw9D,cAAc2B,gBAAmB14D,IAChCA,EAAEzE,KAAK4c,KAAO,GAChB5e,KAAK49D,YAAY/5D,KAAK4C,EAAEzE,MAGM,YAA5BhC,KAAKw9D,cAAcjiC,OACrBv7B,KAAKg9D,aAAah9D,KAAKw9D,cAAcv4D,UAAUgU,MAAKzX,IAClDxB,KAAK48B,SAAS,CACZkgC,QAASt7D,EAAOi1B,IAChB6E,QAAS95B,EAAO85B,cAMxBt7B,KAAKs9D,eAAiB,EACtBt9D,KAAKu9D,UAAY7oD,KAAKD,MACtBzU,KAAKw9D,cAAcnf,QACnBr+C,KAAK+7B,YAKPihC,aAAa/3D,EAAUpE,GACrB,IAAID,EAAO,IAAIsE,KAAKlF,KAAK49D,YAAa,CAACr+D,KAAM0F,GAAYw3D,KACzD,OAAQ57D,EAAW,EAAIF,IAAAA,CAAgBC,EAAMC,EAAU,CAAC4D,QAAQ,IAAUxD,QAAQC,QAAQN,IACvFqY,MAAKmmD,IAAex+D,EAAOw+D,EAAkBA,EAAUC,iBACvDpmD,MAAKqmD,GAAat/D,KAAKy9D,aAAa8B,gBAAgBD,KACpDrmD,MAAKumD,GAAWx/D,KAAKy/D,cAAcD,KACnCvmD,MAAKqiB,IAAW,CAAE7E,IAAK/vB,OAAOszB,IAAIS,gBAAgB75B,GAAO06B,QAASR,GAAiBQ,OAIxFmkC,cAAczhB,GACZ,MAAMh8C,EAAOg8C,EAAM0hB,eAAe,GAE5BzB,EAAa16D,KAAKC,IAAIxB,EAAK3B,OAhQV,IAkQjBs/D,EAAY39D,EAAK3B,OAAS49D,EAAc,EAExC2B,EAAer8D,KAAKg6B,IAAI,EAAIoiC,EAlQV,GAkQ4C,GAEpE,IAAI78D,EAAS,GACTy6B,GAAO,EACX,IAAK,IAAIt7B,EAAI,EAAGA,EAAIg8D,EAAYh8D,IAAK,CACnC,IAAIs8D,EAAY,EACZ9rC,EAAQ,EACZ,IAAK,IAAIgM,EAAI,EAAGA,EAAIkhC,EAAUlhC,GAAKmhC,EACjCrB,GAAav8D,EAAK29D,EAAW19D,EAAIw8B,IAAM,EACvChM,IAEF,MAAMjd,EAAMjS,KAAKqsC,KAAK2uB,EAAY9rC,GAClC3vB,EAAOe,KAAK2R,GACZ+nB,EAAMh6B,KAAKg6B,IAAIA,EAAK/nB,GAMtB,OAHI+nB,EAAM,IACRz6B,EAASA,EAAOwP,KAAIvM,GAAM,IAAMA,EAAIw3B,EAAO,KAEtCz6B,EAGTm6D,UACEj9D,KAAK09D,WAAWmC,aAChB7/D,KAAK0/C,OAAOC,YAAY1kB,SAAQ2kB,GAASA,EAAMV,SAGjDjzB,SACE,MAAM6zC,EAAc,mBAAqB9/D,KAAKu7B,MAAM0mB,QAAU,MAAQ,QACtE,OACE,yBAAK91B,UAAU,SACb,uBAAGqJ,KAAK,IAAInJ,QAASrsB,KAAKo9D,aAAcl1C,MAAM,UAC5C,uBAAGiE,UAAU,uBAAb,mBAEDnsB,KAAKu7B,MAAMqhC,UACV,4BAAQxpC,IAAKpzB,KAAKq8B,YAElB,kBAAChB,GAAD,CACEpD,IAAKj4B,KAAKu7B,MAAMuhC,QAChBxhC,QAASt7B,KAAKu7B,MAAMD,QACpBz6B,SAAUb,KAAKs9D,eACfv+B,OAAO,IAEX,yBAAK5S,UAAU,YAAYnsB,KAAKu7B,MAAM16B,UACrCb,KAAKu7B,MAAMqhC,UACV,uBAAGpnC,KAAK,IAAInJ,QAASrsB,KAAKm9D,YAAaj1C,MAAM,SAC3C,uBAAGiE,UAAU,kBAAb,yBAEF,uBAAGqJ,KAAK,IAAInJ,QAASrsB,KAAKk9D,aAAch1C,MAAM,UAC5C,uBAAGiE,UAAW2zC,GAAd,yBAGJ,uBAAGtqC,KAAK,IAAInJ,QAASrsB,KAAKq9D,WAAYn1C,MAAM,QAC1C,uBAAGiE,UAAU,kBAAb,WC5UV,MAAM0B,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BiyC,mBAAoB,CAClB18D,GAAI,4BACJkpB,eAAgB,CAAF,sCAGhByzC,iBAAkB,CAChB38D,GAAI,qBACJkpB,eAAgB,CAAF,+BAGhB0zC,kBAAmB,CACjB58D,GAAI,uBACJkpB,eAAgB,CAAF,iCAGhB2zC,0BAA2B,CACzB78D,GAAI,4BACJkpB,eAAgB,CAAF,uIAGhB4zC,uBAAwB,CACtB98D,GAAI,8BACJkpB,eAAgB,CAAF,kDAKlB,MAAM6zC,WAAoBt5D,IAAAA,cACxBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX8kC,MAAO,KACP37D,QAAS,GACT47D,UAAU,EACVC,iBAAkB1gD,UAAUqgC,aAAaC,aAEzCqgB,mBAAmB,IAAI9rD,MAAO+rD,UAAY1zC,GAAiB,GAG7D/sB,KAAK0gE,iBAAmB1gE,KAAK0gE,iBAAiBnxC,KAAKvvB,MACnDA,KAAK2gE,kBAAoB3gE,KAAK2gE,kBAAkBpxC,KAAKvvB,MACrDA,KAAK4gE,iBAAmB5gE,KAAK4gE,iBAAiBrxC,KAAKvvB,MACnDA,KAAK6gE,kBAAoB7gE,KAAK6gE,kBAAkBtxC,KAAKvvB,MACrDA,KAAK8gE,WAAa9gE,KAAK8gE,WAAWvxC,KAAKvvB,MACvCA,KAAK+gE,eAAiB/gE,KAAK+gE,eAAexxC,KAAKvvB,MAC/CA,KAAKghE,oBAAsBhhE,KAAKghE,oBAAoBzxC,KAAKvvB,MAEzDA,KAAKq7D,iBAAmBr7D,KAAKq7D,iBAAiB9rC,KAAKvvB,MAEnDA,KAAKihE,YAAcjhE,KAAKihE,YAAY1xC,KAAKvvB,MAG3C4wB,oBACM5wB,KAAKkhE,iBACPlhE,KAAKkhE,gBAAgBp1C,iBAAiB,QAAS9rB,KAAK0gE,kBAAkB,GAGxE1gE,KAAK48B,SAAS,CAACyjC,MAAOrgE,KAAKihE,gBAG7BnwC,uBACM9wB,KAAKkhE,iBACPlhE,KAAKkhE,gBAAgBnwC,oBAAoB,QAAS/wB,KAAK0gE,kBAAkB,GAI7EhkC,mBAAmBC,GACb38B,KAAKkhE,iBACPlhE,KAAKkhE,gBAAgBjwB,QAGnBtU,EAAUtM,WAAarwB,KAAKoQ,MAAMigB,UACpCrwB,KAAK48B,SAAS,CAACl4B,QAAS,GAAI47D,UAAU,EAAOD,MAAO,OAC3C1jC,EAAUtO,OAASruB,KAAKoQ,MAAMie,OACvCruB,KAAK48B,SAAS,CAACyjC,MAAOrgE,KAAKihE,gBAI/BA,cACE,OAAOjhE,KAAKoQ,MAAMie,MAChB6R,GAAAA,OAAAA,OAAclgC,KAAKoQ,MAAMie,MAAMhqB,QAASi9B,GAAgB,CACtDlS,cAAepvB,KAAKoQ,MAAMif,KAAKD,cAAcG,KAAKvvB,KAAKoQ,MAAMif,MAC7D0I,aAAc/3B,KAAKoQ,MAAMmgB,OAAOwH,aAAaxI,KAAKvvB,KAAKoQ,MAAMmgB,UAC1D,KAGTmwC,iBAAiBj6D,GACXzG,KAAKoQ,MAAM+wD,UnDmGZ,SAAoB1zD,EAAO2zD,EAAgBC,EAAqB3vC,GACrE,MAAMJ,GAAS7jB,EAAM6zD,eAAiB7zD,EAAM8zD,cAAcD,eAAiB,IAAIhwC,MAC/E,IAAKnpB,MAAMC,QAAQkpB,GACjB,OAAO,EAGT,IAAK,IAAIrvB,KAAKqvB,EAAO,CACnB,MAAMD,EAAOC,EAAMrvB,GACnB,GAAkB,SAAdovB,EAAKwuB,KAAiB,CACxB,MAAMv+C,EAAO+vB,EAAKmwC,YAClB,IAAKlgE,EAAM,CACTqD,QAAQ+F,MAAM,kDAAmD2mB,EAAKwuB,KAAMxuB,EAAK9xB,MACjFmyB,EAAQ,mDACR,SAQF,OANIpwB,EAAK/B,MAAmC,SAA3B+B,EAAK/B,KAAKq7B,MAAM,KAAK,GACpCwmC,EAAe9/D,GAEf+/D,EAAoB//D,IAGf,GAIX,OAAO,EmDxHDmgE,CAAWh7D,GACb,CAACk0B,EAAMpD,EAAMiB,EAAOC,EAAQY,KAC1Br5B,KAAKoQ,MAAMsxD,cAAcnqC,EAAMoD,EAAMnC,EAAOC,EAAQY,MAEtD,CAAC9B,EAAMoD,EAAMtB,KACXr5B,KAAKoQ,MAAMuxD,aAAapqC,EAAMoD,EAAMtB,KAEtCr5B,KAAKoQ,MAAMshB,UAGXjrB,EAAEwqB,iBAIN0vC,kBAAkBl6D,GACZA,EAAEiH,OAAOy5B,OAAS1gC,EAAEiH,OAAOy5B,MAAM9mC,OAAS,GAC5CL,KAAKoQ,MAAMsxD,cAAcj7D,EAAEiH,OAAOy5B,MAAM,IAG1C1gC,EAAEiH,OAAOnL,MAAQ,GAGnBq+D,iBAAiBn6D,GACXA,EAAEiH,OAAOy5B,OAAS1gC,EAAEiH,OAAOy5B,MAAM9mC,OAAS,GAC5CL,KAAKoQ,MAAMuxD,aAAal7D,EAAEiH,OAAOy5B,MAAM,IAGzC1gC,EAAEiH,OAAOnL,MAAQ,GAGnBs+D,kBAAkBpqC,EAAK6E,EAASz6B,GAC9Bb,KAAK48B,SAAS,CAAC0jC,UAAU,IACzBtgE,KAAKoQ,MAAMwxD,cAAcnrC,EAAK6E,EAASz6B,GAGzCigE,WAAWr6D,GACTA,EAAEwqB,iBACF,MAAMvsB,EAAU1E,KAAKu7B,MAAM72B,QAAQsxB,QAC/BtxB,GAAW1E,KAAKoQ,MAAMyxD,aAAe7hE,KAAKoQ,MAAM0xD,WAClD9hE,KAAKoQ,MAAM2xD,cAAcr9D,GACzB1E,KAAK48B,SAAS,CAACl4B,QAAS,MAK5Bq8D,eAAet6D,GACb,GAAIzG,KAAKu7B,MAAM+kC,SAIb,OAFA75D,EAAEwqB,sBACFxqB,EAAEyqB,kBAKU,UAAVzqB,EAAER,MAECQ,EAAEu7D,WACLv7D,EAAEwqB,iBACFxqB,EAAEyqB,kBAEFlxB,KAAK8gE,WAAWr6D,KAKtBu6D,oBAAoBv6D,GAClB,MAAMgzC,EAAW,CAAC/0C,QAAS+B,EAAEiH,OAAOnL,OACpC,GAAIvC,KAAKoQ,MAAM6xD,WAAY,CACzB,MAAMxtD,GAAM,IAAIC,MAAO+rD,UACnBhsD,EAAMzU,KAAKu7B,MAAMilC,kBAAoBzzC,KACvC/sB,KAAKoQ,MAAM6xD,aACXxoB,EAAS+mB,kBAAoB/rD,GAGjCzU,KAAK48B,SAAS6c,GAGhB4hB,iBAAiB50D,GAGf,GAFAA,EAAEwqB,iBACFxqB,EAAEyqB,kBACElxB,KAAKoQ,MAAMie,OAASruB,KAAKoQ,MAAMuwB,aAAc,CAC/C,MAAMi7B,EAAa57D,KAAKoQ,MAAMie,MAAMwD,IACpC7xB,KAAKoQ,MAAMuwB,aAAai7B,IAI5B3vC,SACE,MAAM,cAAEmD,GAAkBpvB,KAAKoQ,MAAMif,KAC/Bka,EAASvpC,KAAKoQ,MAAM+wD,SACxB/xC,EAAcvB,GAASkyC,oBACtB//D,KAAKoQ,MAAM8xD,cACV9yC,EAAcvB,GAAS7tB,KAAKoQ,MAAM8xD,gBAClC9yC,EAAcvB,GAASmyC,kBAErBK,EACH,yBAAKh9D,GAAG,uBACP,yBAAK8oB,UAAU,UACb,uBAAGqJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM+xD,kBAAmB,uBAAGh2C,UAAU,uBAAb,WAEhFnsB,KAAKu7B,MAAM8kC,OAEV+B,EAAepiE,KAAKu7B,MAAMglC,gBAAkBvgE,KAAKoQ,MAAMwxD,cAC7D,OACE,yBAAKv+D,GAAG,wBACLrD,KAAKu7B,MAAM8kC,QAAUrgE,KAAKoQ,MAAM0xD,QAAUzB,EAAQ,KACnD,yBAAKh9D,GAAG,sBACJrD,KAAKoQ,MAAM+wD,SAwCX,yBAAK99D,GAAG,oBAAoBkmC,GAvC5B,oCACGvpC,KAAKoQ,MAAMuxD,eAAiB3hE,KAAKu7B,MAAM+kC,SACtC,oCACE,uBAAG9qC,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKqiE,YAAYC,SAAWp6C,MAAM,aACjF,uBAAGiE,UAAU,4BAAb,UAEF,uBAAGqJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKuiE,WAAWD,SAAWp6C,MAAM,eAChF,uBAAGiE,UAAU,4BAAb,iBAIJ,KACDnsB,KAAKoQ,MAAM0xD,QACT9hE,KAAKu7B,MAAM8kC,MAAQA,EAAQ,yBAAKl0C,UAAU,YAC1CnsB,KAAKu7B,MAAM+kC,SACV,kBAAC5D,GAAD,CACEwC,UAAW3yD,GAAKvM,KAAK48B,SAAS,CAAC0jC,UAAU,IACzC7vB,WAAYzwC,KAAK6gE,oBACnB,8BAAUx9D,GAAG,cAAcwiC,YAAa0D,EACtChnC,MAAOvC,KAAKu7B,MAAM72B,QAASohC,SAAU9lC,KAAKghE,oBAC1CiB,WAAYjiE,KAAK+gE,eACjB3tC,IAAMA,IAASpzB,KAAKkhE,gBAAkB9tC,GACtC6S,WAAS,IACdjmC,KAAKu7B,MAAM72B,UAAY09D,EACtB,uBAAG5sC,KAAK,IAAInJ,QAASrsB,KAAK8gE,WAAY54C,MAAM,QAC1C,uBAAGiE,UAAU,kBAAb,SAEDnsB,KAAKu7B,MAAM+kC,SAIV,KAHA,uBAAG9qC,KAAK,IAAInJ,QAAS5lB,IAAMA,EAAEwqB,iBAAkBjxB,KAAK48B,SAAS,CAAC0jC,UAAU,KAASp4C,MAAM,SACrF,uBAAGiE,UAAU,kBAAb,QAIN,2BAAO5sB,KAAK,OAAO6zB,IAAMA,IAASpzB,KAAKuiE,WAAanvC,GAClD0S,SAAU9lC,KAAK4gE,iBAAkBztC,MAAO,CAACqvC,QAAS,UACpD,2BAAOjjE,KAAK,OAAO6zB,IAAMA,IAASpzB,KAAKqiE,YAAcjvC,GAAOoU,OAAO,UACjE1B,SAAU9lC,KAAK2gE,kBAAmBxtC,MAAO,CAACqvC,QAAS,cAWnE,UAAenvC,EAAAA,EAAAA,YAAW+sC,ICpPX,MAAMqC,WAAmB37D,IAAAA,cACtChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAK0iE,cAAgB1iE,KAAK0iE,cAAcnzC,KAAKvvB,MAG/C0iE,cAAcC,GACZ3iE,KAAKoQ,MAAMstC,UACX19C,KAAKoQ,MAAM2xD,cAAc/hE,KAAKoQ,MAAM/L,QAAQ/C,MAG9C2qB,SACE,OAAKjsB,KAAKoQ,MAAM/L,QAId,yBAAKhB,GAAG,iBACN,yBAAKA,GAAG,+BACN,8BAAOrD,KAAKoQ,MAAM/L,QAAQ/E,MAC1B,uBAAGk2B,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMstC,YAAa,uBAAGvxB,UAAU,uBAAb,WAE3E,yBAAK9oB,GAAG,2BACN,yBAAK8oB,UAAU,sBACb,uBAAGA,UAAU,uBA/BzB,SAAsBoL,GAEpB,MAAMqrC,EAAa,CAACz9D,QAAS,oBAAqBgjB,MAAO,QAASogB,KAAM,cAAe0V,MAAO,YAE9F,OAAO2kB,EAAWrrC,IAASqrC,GAAYrrC,GAAQ,IAAIqD,MAAM,KAAK,KAAOgoC,EAAU,QA2BjCC,CAAa7iE,KAAKoQ,MAAM/L,QAAQ9E,OACpE,6BAAK,2BAAG,kBAAC,EAAA+sB,iBAAD,CAAkBjpB,GAAE,kBAAmBkpB,eAAc,iCAA7D,IAC8C+H,GAAgBt0B,KAAKoQ,MAAM/L,QAAQ/E,KAAM,KAAO,KAC9F,6BAAK,2BAAG,kBAAC,EAAAgtB,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,oCAAhE,IAC2DvsB,KAAKoQ,MAAM/L,QAAQ9E,MAAQ,4BACtF,6BAAK,2BAAG,kBAAC,EAAA+sB,iBAAD,CAAkBjpB,GAAE,aAAckpB,eAAc,4BAAxD,IAC4CwH,GAAiB/zB,KAAKoQ,MAAM/L,QAAQua,SAGpF,kBAAC,GAAD,CACEkjD,SAAS,EACTvxC,OAAQvwB,KAAKoQ,MAAMmgB,OACnBlC,MAAOruB,KAAKoQ,MAAMie,MAClB8zC,cAAeniE,KAAKoQ,MAAM+xD,cAC1BJ,cAAe/hE,KAAK0iE,cACpBhxC,QAAS1xB,KAAKoQ,MAAMshB,WAzBjB,MClBE,MAAMoxC,WAAkBh8D,IAAAA,UACrChH,YAAYsQ,GACVvE,MAAMuE,GAGR6b,SACE,MAAM82C,EAAc,GACdC,GAAchjE,KAAKoQ,MAAM0pC,aAAe,IAAIz5C,OAC5C4iE,EAAc1/D,KAAKC,I5DmEM,E4DnEmBw/D,GAelD,OAbChjE,KAAKoQ,MAAM0pC,aAAe,IAAIvgC,MAAMwgC,IACnCgpB,EAAYl/D,KACV,yBAAKsoB,UAAU,aAAalmB,IAAK8zC,EAAIrpB,MACnC,kBAAC+G,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBD,MAAOypB,EAAIrpB,KACXgH,OAAQW,GAAa0hB,EAAI/V,OAAS+V,EAAI/V,OAAO7N,MAAQ,QAAS,EAC9DjO,MAAO6xB,EAAI/V,OAAS+V,EAAI/V,OAAO9mB,GAAK,SAGnC6lD,EAAY1iE,QAAU4iE,KAI7B,yBAAK5/D,GAAG,eAAe0/D,EAAvB,IAAqCC,EAAaC,EAChD,8BACE,kBAAC,EAAA32C,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,sEAErDpa,OAAQ,CAAE+wD,SAAWF,EAAaC,MAC9B,OC/BH,MAAME,WAAqBr8D,IAAAA,cACxChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX/C,MAAO,EACPC,OAAQ,GAGVz4B,KAAKojE,gBAAkBpjE,KAAKojE,gBAAgB7zC,KAAKvvB,MAGnDqjE,YAAYC,GACV,GAAIA,IAAStjE,KAAKu7B,MAAM/C,MAAO,CAC7B,MAAM3F,EAASywC,EAAK1kC,wBACpB5+B,KAAK48B,SAAS,CACZpE,MAAsB,EAAf3F,EAAO2F,MACdC,OAAwB,EAAhB5F,EAAO4F,UAKrB2qC,gBAAgBT,GACd3iE,KAAKoQ,MAAMstC,UACX19C,KAAKoQ,MAAM2xD,cAAcY,EAAS3iE,KAAKoQ,MAAM/L,QAAQzD,MAGvDqrB,SACE,IAAKjsB,KAAKoQ,MAAM/L,QACd,OAAO,KAGT,MAAM61B,EAAM3B,GAAav4B,KAAKoQ,MAAM/L,QAAQm0B,MAAOx4B,KAAKoQ,MAAM/L,QAAQo0B,OACpEz4B,KAAKu7B,MAAM/C,MAAOx4B,KAAKu7B,MAAM9C,QAAQ,GACjC7Z,EAAOsb,EAAM,CAAE1B,MAAO0B,EAAIpB,SAAW,KAAML,OAAQyB,EAAInB,UAAY,MACrE/4B,KAAKoQ,MAAM/L,QAAQm0B,MAAQx4B,KAAKoQ,MAAM/L,QAAQo0B,OAAU,CAACD,MAAO,QAAU,CAACC,OAAQ,QACvF7Z,EAAK8Z,SAAW,OAChB9Z,EAAK+Z,UAAY,OAGjB,MAAM4qC,EAAYhgE,KAAKg6B,KAAMv9B,KAAKu7B,MAAM/C,MAAQvL,GAAW,IAAO,GAAK,EAAG,IACpEoM,EAAQ/E,GAAgBt0B,KAAKoQ,MAAM/L,QAAQ/E,KAAMikE,IAAc,IAE/D/qC,EAAQx4B,KAAKoQ,MAAM/L,QAAQm0B,OAAS,IACpCC,EAASz4B,KAAKoQ,MAAM/L,QAAQo0B,QAAU,IAC5C,OACE,yBAAKp1B,GAAG,iBACN,yBAAKA,GAAG,+BACJrD,KAAKoQ,MAAM2xD,cAMX,8BAAO1oC,GALP,uBAAG7D,KAAMx1B,KAAKoQ,MAAM/L,QAAQoyB,IAAK0jC,UAAU,GACzC,uBAAGhuC,UAAU,kBAAb,iBADF,IACkD,kBAAC,EAAAG,iBAAD,CAC9CjpB,GAAE,kBAAmBkpB,eAAc,+BAKzC,uBAAGiJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMstC,YAAa,uBAAGvxB,UAAU,uBAAb,WAE3E,yBAAK9oB,GAAG,0BAA0B+vB,IAAMkwC,GAAStjE,KAAKqjE,YAAYC,IAChE,yBAAKrrC,IAAKj4B,KAAKoQ,MAAM/L,QAAQoyB,IAAKtD,MAAOvU,EAAMuN,UAAU,gBAAgB6L,IAAKh4B,KAAKoQ,MAAM/L,QAAQ/E,QAElGU,KAAKoQ,MAAM2xD,cACV,kBAAC,GAAD,CACEG,cAAc,oBACdL,aAAa,EACbtxC,OAAQvwB,KAAKoQ,MAAMmgB,OACnBlC,MAAOruB,KAAKoQ,MAAMie,MAClB8zC,cAAeniE,KAAKoQ,MAAM+xD,cAC1BJ,cAAe/hE,KAAKojE,gBACpB1xC,QAAS1xB,KAAKoQ,MAAMshB,UAEtB,yBAAKruB,GAAG,wBACN,6BACE,6BAAK,2BAAG,kBAAC,EAAAipB,iBAAD,CAAkBjpB,GAAE,kBAAmBkpB,eAAc,kCAE7D,6BAAK,0BAAMrE,MAAOloB,KAAKoQ,MAAM/L,QAAQ/E,MAAO+5B,KAE9C,6BACE,6BAAK,2BAAG,kBAAC,EAAA/M,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,qCAEhE,6BAAMvsB,KAAKoQ,MAAM/L,QAAQ9E,OAE3B,6BACE,6BAAK,2BAAG,kBAAC,EAAA+sB,iBAAD,CAAkBjpB,GAAE,aAAckpB,eAAc,6BAExD,6BAAMiM,EAAN,MAAsBC,EAAtB,QAAmC1E,GAAiB/zB,KAAKoQ,MAAM/L,QAAQua,WCzFtE,MAAM4kD,WAAmB18D,IAAAA,cACtChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKyjE,mBAAqBzjE,KAAKyjE,mBAAmBl0C,KAAKvvB,MAGzDyjE,mBAAmBtiC,EAAKn/B,GACtBm/B,EAAIlQ,iBACJjxB,KAAKoQ,MAAMqhB,SAASzvB,GAGtBiqB,SACE,OACE,yBAAKE,UAAU,uBACb,yBAAKA,UAAU,SACb,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClBkpB,eAAc,sFAGlB,yBAAKJ,UAAU,UACb,4BAAQA,UAAU,UAAUE,QAAS5e,IAAWzN,KAAKyjE,mBAAmBh2D,EAAO,YAC7E,kBAAC,EAAA6e,iBAAD,CAAkBjpB,GAAE,yBAClBkpB,eAAc,6BAElB,4BAAQJ,UAAU,YAAYE,QAAS5e,IAAWzN,KAAKyjE,mBAAmBh2D,EAAO,YAC/E,kBAAC,EAAA6e,iBAAD,CAAkBjpB,GAAE,yBAClBkpB,eAAc,6BAElB,4BAAQJ,UAAU,YAAYE,QAAS5e,IAAWzN,KAAKyjE,mBAAmBh2D,EAAO,WAC/E,kBAAC,EAAA6e,iBAAD,CAAkBjpB,GAAE,wBAClBkpB,eAAc,+BC3Bb,MAAMm3C,WAAiB58D,IAAAA,cACpCmlB,SACE,MAAMhX,EAAUyX,GAAW,KAAOX,GAAAA,OAAAA,aAAsB,IACxD,OACE,yBAAK1oB,GAAG,cACN,6BACE,uBAAGmyB,KAAK,mCACN,yBAAKnyB,GAAG,OAAO20B,IAAI,OAAOC,IAAI,iBAC9B,2CAEF,2BAAG,kBAAC,EAAA3L,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,6BAArD,IAC+CtX,GAC/C,2BAAG,kBAAC,EAAAqX,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,6BAArD,IAC+CvsB,KAAKoQ,MAAMuzD,cAD1D,KAC2E3jE,KAAKoQ,MAAMwzD,cADtF,QCfK,MAAMC,WAAoB/8D,IAAAA,cACvChH,YAAYsQ,GACVvE,MAAMuE,GAGR6b,SACE,IAAI5nB,EAAU,KACV03D,EAAc,SAclB,OAbI/7D,KAAKoQ,MAAM0nB,SAEbzzB,EAAU,oCAAE,uBAAG8nB,UAAU,uBAAb,SAAF,IAA+C,uBAAGA,UAAU,QACpE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClBkpB,eAAc,uCAElBwvC,GAAe,YACN/7D,KAAKoQ,MAAM+I,OAEpB9U,EAAU,oCAAGrE,KAAKoQ,MAAM+I,MACxB4iD,GAAe,SAGZ13D,EAKH,wBAAI8nB,UAAU,QACZ,yBAAKA,UAAW4vC,GACd,yBAAK5vC,UAAU,mBACZ9nB,KAPA,oCAAG,OCvBD,MAAMy/D,GACA,oBAAChvC,GAElB,MAAM2/B,EAAQ3/B,EAAK8F,MAAM,IAAK,GACxBhL,EAAS,GACf,IAAIm0C,EAAO,GAYX,OAXItP,EAAM,KACRsP,EAAOtP,EAAM,GAAGpqD,QAAQ,IAAK,IAAIuwB,MAAM,MAErC65B,EAAM,IACRA,EAAM,GAAG75B,MAAM,KAAKK,SAAQ,SAASy5B,GACnC,MAAMrjC,EAAOqjC,EAAK95B,MAAM,KACpBvJ,EAAK,KACPzB,EAAOo0C,mBAAmB3yC,EAAK,KAAO2yC,mBAAmB3yC,EAAK,QAI7D,CAAC0yC,KAAMA,EAAMn0C,OAAQA,GAGb,kBAAC6G,GAChB/vB,OAAO8kD,SAAS12B,KAAO2B,EAGJ,sBAACstC,EAAMn0C,GAC1B,IAAI6G,EAAMstC,EAAK76D,KAAK,KACpB,MAAMqL,EAAO,GACb,IAAK,MAAMtO,KAAO2pB,EACZA,EAAO/oB,eAAeZ,IACxBsO,EAAK1Q,KAAKoC,EAAM,IAAM2pB,EAAO3pB,IAMjC,OAHIsO,EAAKlU,OAAS,IAChBo2B,GAAO,IAAMliB,EAAKrL,KAAK,MAElButB,EAGS,mBAAC3B,EAAM7uB,EAAK1D,GAC5B,MAAM0hE,EAASjkE,KAAKkkE,aAAapvC,GAEjC,OADAmvC,EAAOr0C,OAAO3pB,GAAO1D,EACdvC,KAAKmkE,eAAeF,EAAOF,KAAME,EAAOr0C,QAG5B,sBAACkF,EAAM7uB,GAC1B,MAAMg+D,EAASjkE,KAAKkkE,aAAapvC,GAEjC,cADOmvC,EAAOr0C,OAAO3pB,GACdjG,KAAKmkE,eAAeF,EAAOF,KAAME,EAAOr0C,QAG3B,uBAACkF,EAAMsvC,GAC3B,MAAMH,EAASjkE,KAAKkkE,aAAapvC,GAEjC,OADAmvC,EAAOF,KAAK,GAAKK,EACVpkE,KAAKmkE,eAAeF,EAAOF,KAAME,EAAOr0C,QAG3B,uBAACkF,EAAMuvC,GAC3B,MAAMJ,EAASjkE,KAAKkkE,aAAapvC,GAMjC,OALIuvC,EACFJ,EAAOr0C,OAAOlsB,KAAO2gE,SAEdJ,EAAOr0C,OAAOlsB,KAEhB1D,KAAKmkE,eAAeF,EAAOF,KAAME,EAAOr0C,QAG/B,mBAACkF,EAAMxE,GACvB,MAAM2zC,EAASjkE,KAAKkkE,aAAapvC,GAIjC,OAHAmvC,EAAOF,KAAK,GAAKzzC,SAEV2zC,EAAOr0C,OAAOlsB,KACd1D,KAAKmkE,eAAeF,EAAOF,KAAME,EAAOr0C,SC9CnD,MAIM/B,IAAWC,EAAAA,EAAAA,gBAAe,CAC9Bw2C,WAAY,CACVjhE,GAAI,aACJkpB,eAAgB,CAAF,8BAGhBg4C,UAAW,CACTlhE,GAAI,sBACJkpB,eAAgB,CAAF,6BAGhBi4C,UAAW,CACTnhE,GAAI,kBACJkpB,eAAgB,CAAF,6BAGhBnO,QAAS,CACP/a,GAAI,UACJkpB,eAAgB,CAAF,2BAGhB2zC,0BAA2B,CACzB78D,GAAI,4BACJkpB,eAAgB,CAAF,uIAGhBk4C,gBAAiB,CACfphE,GAAI,kBACJkpB,eAAgB,CAAF,qCAMlB,SAASm4C,GAAcviC,GACrB,GAAIA,EAAK,CACP,MAAMxgC,EAAKwgC,EAAIwiC,gBAAkB,GACjC,OAAOxiC,EAAII,SAAS,WAAa5gC,EAAGqL,SAAS,MAAQrL,EAAGqL,SAAS,MAEnE,OAAO,EAGT,SAAS43D,GAAiBziC,GACxB,GAAIA,EAAK,CACP,MAAM/kB,EAAK+kB,EAAI0iC,cAAgB,GAC/B,OAAO1iC,EAAII,SAAS,UAAYnlB,EAAGpQ,SAAS,MAAQoQ,EAAGpQ,SAAS,MAElE,OAAO,EAGT,SAAS83D,GAAuBznB,GAI9B,OlEwB0C,GkExBnCA,GlE0B6B,GkE1BgBA,EAGtD,MAAM0nB,WAAqBj+D,IAAAA,UACzBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQwpC,GAAaC,yBAAyB50D,EAAO,IAE1DpQ,KAAKilE,MAAQjlE,KAAKilE,MAAM11C,KAAKvvB,MAC7BA,KAAKklE,YAAcllE,KAAKklE,YAAY31C,KAAKvvB,MACzCA,KAAKmlE,UAAYnlE,KAAKmlE,UAAU51C,KAAKvvB,MACrCA,KAAKolE,oBAAsBplE,KAAKolE,oBAAoB71C,KAAKvvB,MACzDA,KAAKqlE,mBAAqBrlE,KAAKqlE,mBAAmB91C,KAAKvvB,MACvDA,KAAKslE,oBAAsBtlE,KAAKslE,oBAAoB/1C,KAAKvvB,MACzDA,KAAKulE,aAAevlE,KAAKulE,aAAah2C,KAAKvvB,MAC3CA,KAAKkmB,UAAYlmB,KAAKkmB,UAAUqJ,KAAKvvB,MACrCA,KAAKwlE,sBAAwBxlE,KAAKwlE,sBAAsBj2C,KAAKvvB,MAC7DA,KAAKylE,kBAAoBzlE,KAAKylE,kBAAkBl2C,KAAKvvB,MACrDA,KAAK0lE,iBAAmB1lE,KAAK0lE,iBAAiBn2C,KAAKvvB,MACnDA,KAAK2lE,kBAAoB3lE,KAAK2lE,kBAAkBp2C,KAAKvvB,MACrDA,KAAK4lE,oBAAsB5lE,KAAK4lE,oBAAoBr2C,KAAKvvB,MACzDA,KAAK6lE,0BAA4B7lE,KAAK6lE,0BAA0Bt2C,KAAKvvB,MACrEA,KAAK8lE,kBAAoB9lE,KAAK8lE,kBAAkBv2C,KAAKvvB,MACrDA,KAAK+lE,oBAAsB/lE,KAAK+lE,oBAAoBx2C,KAAKvvB,MACzDA,KAAKgmE,mBAAqBhmE,KAAKgmE,mBAAmBz2C,KAAKvvB,MACvDA,KAAKimE,mBAAqBjmE,KAAKimE,mBAAmB12C,KAAKvvB,MACvDA,KAAKyhC,mBAAqBzhC,KAAKyhC,mBAAmBlS,KAAKvvB,MACvDA,KAAKkmE,6BAA+BlmE,KAAKkmE,6BAA6B32C,KAAKvvB,MAC3EA,KAAKmmE,wBAA0BnmE,KAAKmmE,wBAAwB52C,KAAKvvB,MACjEA,KAAKomE,iBAAmBpmE,KAAKomE,iBAAiB72C,KAAKvvB,MACnDA,KAAK4gE,iBAAmB5gE,KAAK4gE,iBAAiBrxC,KAAKvvB,MACnDA,KAAK2gE,kBAAoB3gE,KAAK2gE,kBAAkBpxC,KAAKvvB,MACrDA,KAAKo7D,mBAAqBp7D,KAAKo7D,mBAAmB7rC,KAAKvvB,MACvDA,KAAKqmE,qBAAuBrmE,KAAKqmE,qBAAqB92C,KAAKvvB,MAC3DA,KAAKsmE,uBAAyBtmE,KAAKsmE,uBAAuB/2C,KAAKvvB,MAC/DA,KAAKumE,kBAAoBvmE,KAAKumE,kBAAkBh3C,KAAKvvB,MAErDA,KAAKwmE,gBAAkBxmE,KAAKwmE,gBAAgBj3C,KAAKvvB,MACjDA,KAAKymE,kBAAoBzmE,KAAKymE,kBAAkBl3C,KAAKvvB,MACrDA,KAAKq7D,iBAAmBr7D,KAAKq7D,iBAAiB9rC,KAAKvvB,MACnDA,KAAK0mE,iBAAmB1mE,KAAK0mE,iBAAiBn3C,KAAKvvB,MAEnDA,KAAK2mE,gBAAkB,GACvB3mE,KAAK4mE,sBAAwB5mE,KAAK4mE,sBAAsBr3C,KAAKvvB,MAE7DA,KAAK6mE,sBAAwB,GAC7B7mE,KAAK8mE,sBAAwB,KAG/BF,sBAAsBG,GACpB,GAAI/mE,KAAK2mE,gBAAgB9/D,eAAekgE,GACtC,OAAO/mE,KAAK2mE,gBAAgBI,GAE9B,MAAM3zC,EAAMtsB,IAAAA,YAEZ,OADA9G,KAAK2mE,gBAAgBI,GAAS3zC,EACvBA,EAGTxC,oBACM5wB,KAAKgnE,kBACPhnE,KAAKgnE,iBAAiBl7C,iBAAiB,SAAU9rB,KAAKylE,mBAI1D30C,uBACM9wB,KAAKgnE,kBACPhnE,KAAKgnE,iBAAiBj2C,oBAAoB,SAAU/wB,KAAKylE,mBAI3DzlE,KAAKsmE,yBAKP5pC,mBAAmBC,EAAWkN,IACxB7pC,KAAKgnE,kBACNn9B,EAAUvZ,OAAStwB,KAAKu7B,MAAMjL,OAASuZ,EAAUo9B,cAAgBjnE,KAAKu7B,MAAM0rC,cAEzEjnE,KAAKu7B,MAAM2rC,eAxIQ,MAyIrBlnE,KAAKgnE,iBAAiBG,UAAYnnE,KAAKgnE,iBAAiBI,aACtDpnE,KAAKu7B,MAAM2rC,eACXlnE,KAAKgnE,iBAAiBjqC,cAI5B,MAAMzM,EAAQtwB,KAAKoQ,MAAMmgB,OAASvwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,YAAStvB,EAC7EhB,KAAKu7B,MAAMjL,OAASuZ,EAAUvZ,QAC5BuZ,EAAUvZ,QAAUvE,GAAAA,OAAAA,oBAA2B8d,EAAUvZ,SAC3DtwB,KAAKilE,MAAMp7B,EAAUvZ,OACjBuZ,EAAUw9B,WACZ1iE,QAAQC,IAAI,WAAYilC,EAAUvZ,OAClCtwB,KAAK0mE,iBAAiB78B,EAAUvZ,MAAOqM,EAAU2qC,WAIjDh3C,IACFA,EAAMi3C,OAASvnE,KAAK4lE,oBACpBt1C,EAAMk3C,sBAAwBxnE,KAAK6lE,0BACnCv1C,EAAM8tB,OAASp+C,KAAK8lE,kBACpBx1C,EAAMuoB,WAAa74C,KAAK0lE,iBACxBp1C,EAAMwoB,cAAgB94C,KAAK2lE,kBAC3Br1C,EAAMm3C,OAASznE,KAAK2lE,oBAInB3lE,KAAKoQ,MAAMs3D,mBAKd1nE,KAAKqmE,qBAAqB,GAH1BrmE,KAAKsmE,0BAMHh2C,GAAWtwB,KAAKu7B,MAAMjL,OAASuZ,EAAUvZ,OAAWqM,EAAUgrC,QAE5Dr3C,EAAMs3C,MAAQt3C,EAAMu3C,YACtBv3C,EAAMoqB,QAAQpqB,EAAMqqB,iBAAiBmtB,WAAWjtB,SAEhD76C,KAAKkmB,UAAUoK,IAKU,gCAACyhB,EAAWlI,GACzC,IAAIk+B,EAAY,GAChB,GAAKh2B,EAAUzhB,MAyBR,GAAIyhB,EAAUzhB,OAASuZ,EAAUvZ,MAAO,CAC7C,MAAMA,EAAQyhB,EAAUxhB,OAAOC,SAASuhB,EAAUzhB,OAElD,IAAIjC,EAAQ,KACZ,GAAI0jB,EAAUi2B,eAAgB,CAG5B35C,EAAQ,CACNhqB,QAFc0tC,EAAUi2B,eAAe1sC,QAGvCzJ,IAAK,MAkBT,GAdAk2C,EAAY,CACVz3C,MAAOyhB,EAAUzhB,MACjB23C,WAAY,KACZC,aAAc,KACdC,cAAe,KACfd,SAAU,KACVe,iBAAiB,EACjBlB,eAAgB,EAChBmB,kBAAkB,EAClBh6C,MAAOA,EACPi6C,oBAAoB,EACpBxwC,QAASxH,EAAMyU,UAGbzU,EAAO,CAET,MAAMwqB,EAAO,GAET/I,EAAUtN,WACZnU,EAAMwpB,aAAaC,IACbA,EAAIjY,QAAUiY,EAAIrpB,MAAQqhB,EAAU9N,UACtC6W,EAAKj3C,KAAKk2C,MAKhBn6C,OAAOiX,OAAOkxD,EAAW,CACvBQ,WAAYztB,IAGVxqB,EAAM0T,OACRpkC,OAAOiX,OAAOkxD,EAAW,CACvB7/C,MAAOoI,EAAM0T,OAAO9mB,GACpBwa,OAAQW,GAAa/H,EAAM0T,OAAO7N,SAGpCv2B,OAAOiX,OAAOkxD,EAAW,CACvB7/C,MAAO,GACPwP,OAAQ,OAIZ,MAAM8wC,EAAOl4C,EAAMm4C,cACfD,EACF5oE,OAAOiX,OAAOkxD,EAAW,CACvBW,sBAAuB9D,GAAiB4D,EAAKrmC,OAEtC0H,EAAU6+B,uBACnB9oE,OAAOiX,OAAOkxD,EAAW,CACvBW,uBAAuB,IAG3B9oE,OAAOiX,OAAOkxD,EAAW,CACvBd,aAAc32C,EAAM22C,eACpB0B,cAAer4C,EAAMs4C,aACrBxqD,QAASkS,EAAMkqB,kBAGbzI,EAAU82B,WAAav4C,EAAMhxB,MAAQwlE,GAAuB/yB,EAAUsL,YACxEz9C,OAAOiX,OAAOkxD,EAAW,CACvBV,SAAUt1B,EAAU82B,iBAKxBjpE,OAAOiX,OAAOkxD,EAAW,CACvBd,aAAc,EACd0B,eAAgB,EAChBJ,WAAY,GACZrgD,MAAO,GACPwP,OAAQ,KACRgxC,uBAAuB,EACvBtqD,SAAS,SAKT2zB,EAAU82B,WAAah/B,EAAUvZ,QAAUuZ,EAAUw9B,UACrDvC,GAAuB/yB,EAAUsL,YACnCz9C,OAAOiX,OAAOkxD,EAAW,CACvBV,SAAUt1B,EAAU82B,iBApHxBd,EAAY,CACVd,aAAc,EACd0B,eAAgB,EAChBJ,WAAY,GACZj4C,MAAO,KACPpI,MAAO,GACPwP,OAAQ,KACRsK,YAAY,EACZC,SAAS,EACTC,aAAa,EACbpK,SAAS,EACTmwC,WAAY,KACZC,aAAc,KACdC,cAAe,KACfd,SAAU,KACVe,iBAAiB,EACjBlB,eAAgB,EAChBmB,kBAAkB,EAClBK,uBAAuB,EACvBtqD,SAAS,EACTiQ,MAAO,KACPi6C,oBAAoB,GAyIxB,OArCIv2B,EAAU5P,KACR4P,EAAU5P,IAAIsE,YAAcoD,EAAUpD,WACxCshC,EAAUthC,UAAYoD,EAAUpD,UAE9BsL,EAAU5P,IAAI2mC,YAAcj/B,EAAUi/B,WACxCf,EAAUe,UAAYj/B,EAAUi/B,WAE7B/2B,EAAU5P,IAAI2mC,SAAS,UAAYj/B,EAAUk/B,iBAChDhB,EAAUgB,gBAAkBl/B,EAAUk/B,gBAEpCh3B,EAAU5P,IAAIgY,YAActQ,EAAUsQ,WACxC4tB,EAAU5tB,UAAYtQ,EAAUsQ,YAG9BtQ,EAAUpD,WACZshC,EAAUthC,UAAW,GAEnBoD,EAAUi/B,WACZf,EAAUe,UAAW,GAElBj/B,EAAUk/B,iBACbl/B,EAAUk/B,gBAAiB,GAEzBl/B,EAAUsQ,WACZ4tB,EAAU5tB,UAAW,IAIrBuqB,GAAc3yB,EAAU5P,OAAS0H,EAAUm/B,cAC7CjB,EAAUkB,aAAep/B,EAAUm/B,cAIhCj3B,EAAUtN,WAAaoF,EAAU0+B,YAAc1+B,EAAU0+B,WAAWloE,OAAS,IAChF0nE,EAAUQ,WAAa,IAGlBR,EAGT7hD,UAAUoK,GACR,GAAIA,EAAM44C,iBAAmBlpE,KAAKoQ,MAAMu3D,MACtC,OAIF,MAAMwB,EAAYnpE,KAAKoQ,MAAMg5D,gBAAkBppE,KAAKoQ,MAAMg5D,eAAeC,YAAcrpE,KAAKoQ,MAAMkgB,MAIlG,IAAIg5C,EAAWh5C,EAAMqqB,iBAAiB4uB,gBAAgBC,gBAClDxpE,KAAKu7B,MAAMutC,UAAYK,KAEzBG,EAAWA,EAASG,clE5UG,IkE6UnBzpE,KAAKu7B,MAAMutC,WACbQ,EAAWA,EAASI,gBAGtB1pE,KAAK48B,SAAS,CAAEyrC,kBAAkB,KAGpC,MAAMsB,EAAWR,EAAWnpE,KAAKoQ,MAAMg5D,oBAAiBpoE,EACxDsvB,EAAMpK,UAAUojD,EAASzuB,QAAS8uB,GAC/B1wD,MAAMkX,IACY,KAAbA,EAAKxkB,MAKL3L,KAAKu7B,MAAMjL,OAASH,EAAKG,OAC3BtwB,KAAK48B,SAAS,CAACtM,MAAOH,EAAKG,QAE7BtwB,KAAKoQ,MAAMw5D,kBAAkB5pE,KAAKoQ,MAAMkgB,MAAOH,EAAKG,OAEpDA,EAAMu5C,gBAAgBC,IAChBA,EAAIC,UAGJz5C,EAAM44C,gBACRlpE,KAAKmlE,UAAU2E,OAbjBhG,GAAekG,WAAWlG,GAAemG,YAAY,GAAI95C,EAAKP,OAAOU,WAiBxE3lB,OAAO4a,IACN5gB,QAAQ+F,MAAM,yBAA0B1K,KAAKu7B,MAAMjL,MAAO/K,GAC1DvlB,KAAKoQ,MAAMshB,QAAQnM,EAAI7gB,QAAS,OAChC,MAAMwlE,EAAanF,GAAaC,yBAAyB,GAAI,IAC7DkF,EAAWhiD,MAAQloB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAAS22C,WAC1DxkE,KAAK48B,SAASstC,MAIpBjF,MAAMkF,GACJ,IAAKA,IAAiBnqE,KAAKoQ,MAAMmgB,OAAO65C,cAAcD,GACpD,OAGF,MAAME,EAAWrqE,KAAKoQ,MAAMmgB,OAAOC,SAAS25C,GACxCE,GAAYA,EAASnB,gBACvBmB,EAASpF,OAAM,GACZt6D,OAAM,SACNqpC,SAAQ,KAGPh0C,KAAK48B,SAAS,CAACyrC,kBAAkB,IACjCgC,EAAS9C,YAASvmE,EAClBqpE,EAAS7C,2BAAwBxmE,EACjCqpE,EAASjsB,YAASp9C,EAClBqpE,EAASxxB,gBAAa73C,EACtBqpE,EAASvxB,mBAAgB93C,EACzBqpE,EAAS5C,YAASzmE,KAM1BwkE,sBAAsBlC,GAChBA,IACFA,EAAKx3C,iBAAiB,SAAU9rB,KAAKylE,mBACrCzlE,KAAKgnE,iBAAmB1D,EACxBtjE,KAAKgnE,iBAAiBG,UAAYnnE,KAAKgnE,iBAAiBI,aAAepnE,KAAKu7B,MAAM2rC,gBAKtFzB,kBAAkBh4D,GAChB,MAAMnE,EAAMmE,EAAMC,OAAO05D,aAAe35D,EAAMC,OAAOy5D,UAAY15D,EAAMC,OAAOqvB,aAM9E,GALA/8B,KAAK48B,SAAS,CACZsqC,eAAgB59D,EAChBg/D,mBAAoBh/D,EAnbG,OAsbrBtJ,KAAKu7B,MAAM8sC,kBAIX56D,EAAMC,OAAOy5D,WAAa,EAAG,CAC/B,MAAM72C,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OAChDA,GAASA,EAAM44C,gBAAkB54C,EAAMg6C,sBACzCtqE,KAAK48B,SAAS,CAACyrC,kBAAkB,IAAO,KACtC/3C,EAAMi6C,gBlEnaa,IkEoahB5/D,OAAO4a,GAAQvlB,KAAKoQ,MAAMshB,QAAQnM,EAAI7gB,QAAS,SAC/CsvC,SAAQ,IAAMh0C,KAAK48B,SAAS,CAACyrC,kBAAkB,UAM1D9B,oBACEvmE,KAAK48B,SAAS,CAACsqC,eAAgB,IAC3BlnE,KAAKgnE,mBACPhnE,KAAKgnE,iBAAiBG,UAAYnnE,KAAKgnE,iBAAiBI,cAI5D1B,iBAAiB/xB,GACXA,EAAK3P,OACPhkC,KAAK48B,SAAS,CACZ1U,MAAOyrB,EAAK3P,OAAO9mB,GACnBwa,OAAQW,GAAasb,EAAK3P,OAAO7N,SAGnCn2B,KAAK48B,SAAS,CACZ1U,MAAO,GACPwP,OAAQ,OAIRic,EAAKxR,KACPniC,KAAK48B,SAAS,CACZ6J,SAAUkN,EAAKxR,IAAIsE,WACnBqiC,SAAUn1B,EAAKxR,IAAI2mC,WACnBC,gBAAiBp1B,EAAKxR,IAAI2mC,SAAS,SACnCG,YAAavE,GAAc/wB,EAAKxR,OAKtCkkC,qBAAqBx0C,GAEnB,IAAK7xB,KAAKoQ,MAAMs3D,mBACd,OAIG1nE,KAAK8mE,wBACR9mE,KAAK8mE,sBAAwBxpB,aAAY,KACvC,GAAyC,GAArCt9C,KAAK6mE,sBAAsBxmE,OAI7B,OAFAm9C,cAAcx9C,KAAK8mE,4BACnB9mE,KAAK8mE,sBAAwB,MAI/B,IAAIj1C,GAAO,EACX,KAAO7xB,KAAK6mE,sBAAsBxmE,OAAS,GAAG,CAC5C,MAAMsF,EAAI3F,KAAK6mE,sBAAsB,GACrC,GAAIlhE,EAAE0qB,WAAarwB,KAAKu7B,MAAMjL,MAAO,CAEnCtwB,KAAK6mE,sBAAsBpqB,QAC3B,SAGF,MAAMhoC,EAAM,IAAIC,KAChB,KAAI/O,EAAE6kE,QAAU/1D,GAKd,MAHAzU,KAAK6mE,sBAAsBpqB,QAC3B5qB,EAAMtuB,KAAKg6B,IAAI1L,EAAKlsB,EAAEksB,KAO1B,GAAIA,GAAO,EAAG,CACZ,MAAMvB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OAChDA,GACFA,EAAMm6C,SAAS54C,MA7gBQ,MAmhB/B,MAAMpd,EAAM,IAAIC,KAChB1U,KAAK6mE,sBAAsBhjE,KAAK,CAC9BwsB,UAAWrwB,KAAKu7B,MAAMjL,MACtBuB,IAAKA,EACL24C,OAAQ/1D,EAAIi2D,gBAAgBj2D,EAAIk2D,kBlE9hBZ,OkEmiBxBrE,yBACEtmE,KAAK6mE,sBAAwB,GACzB7mE,KAAK8mE,wBACPtpB,cAAcx9C,KAAK8mE,uBACnB9mE,KAAK8mE,sBAAwB,MAIjCnB,oBACE,GAAI3lE,KAAKu7B,MAAMjL,MAAO,CACpB,MAAMwqB,EAAO,GACPxqB,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OACpDA,EAAMwpB,aAAaC,IACbA,EAAIjY,QAAUiY,EAAIrpB,MAAQ1wB,KAAKoQ,MAAM6zB,UACvC6W,EAAKj3C,KAAKk2C,MAGd,MAAMN,EAAW,CAAC8uB,WAAYztB,GACxB0tB,EAAOl4C,EAAMm4C,cACfD,EACF5oE,OAAOiX,OAAO4iC,EAAU,CACtBivB,sBAAuB9D,GAAiB4D,EAAKrmC,OAEtCniC,KAAKu7B,MAAMmtC,uBACpB9oE,OAAOiX,OAAO4iC,EAAU,CACtBivB,uBAAuB,IAG3B1oE,KAAK48B,SAAS6c,IAKlBmsB,oBAAoB3zC,GAClB,MAAM3B,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OACpD,IAAK2B,EAIH,YADAjyB,KAAK48B,SAAS,CAAC+rC,cAAer4C,EAAMs4C,eAItCgC,aAAa5qE,KAAK6qE,eAClB7qE,KAAK48B,SAAS,CAACqqC,aAAc32C,EAAM22C,eAAgBmB,iBAAiB,IAIhE93C,EAAMw6C,aAAa74C,EAAIJ,OACrB7xB,KAAKu7B,MAAM2rC,eA1kBQ,IA2kBrBlnE,KAAK48B,SAAS,CAAC0rC,oBAAoB,IAEnCtoE,KAAK48B,SAAS,CAACsqC,eAAgB,KAMpB52C,EAAMiU,UAAUtS,GAAK,IACtBlG,GAAAA,OAAAA,qBAA8BkG,EAAI/f,MAAQlS,KAAKoQ,MAAM6zB,UACjEjkC,KAAKqmE,qBAAqBp0C,EAAIJ,KAGhC7xB,KAAKoQ,MAAMm3D,OAAOt1C,GAGpB4zC,0BAA0BpzC,GACxBzyB,KAAK48B,SAAS,CAACyrC,kBAAkB,IAC7B51C,EAAQ,GAEVzyB,KAAKqmE,qBAAqB,GAI9BP,kBAAkBpiE,GAChB,OAAQA,EAAKs8C,MACX,IAAK,KACH4qB,aAAa5qE,KAAK6qE,eAClB7qE,KAAK6qE,cAAgBxtD,YAAW,KAC9Brd,KAAK48B,SAAS,CAACwrC,iBAAiB,MAC/Br7C,KACE/sB,KAAKu7B,MAAM6sC,iBACdpoE,KAAK48B,SAAS,CAACwrC,iBAAiB,IAElC,MAEF,IAAK,OACL,IAAK,OAEHpoE,KAAK4hD,cACL,MACF,QACEj9C,QAAQjB,KAAK,0BAA2BA,EAAKs8C,OAInD+lB,oBAAoB1hE,GAClBrE,KAAK48B,SAAS,CAAEurC,cAAe9jE,IAGjC2hE,qBACMhmE,KAAKu7B,MAAM2sC,cAAgBloE,KAAKu7B,MAAM2sC,aAAazxC,KACrDuD,IAAIC,gBAAgBj6B,KAAKu7B,MAAM2sC,aAAazxC,KAE9Cz2B,KAAK48B,SAAS,CAAEurC,cAAe,KAAMD,aAAc,KAAMD,WAAY,OAGvEhC,mBAAmB7iC,EAAQmF,EAAMvmC,GAC/B,GAAc,OAAVohC,EACFpjC,KAAKklE,YAAYhlC,GAAAA,OAAAA,WAAkBA,GAAAA,OAAAA,MAAaqI,GAAOvmC,SAClD,GAAc,OAAVohC,EAAiB,CAC1B,MAAM3M,EAAM,IAAIuD,IAAIh4B,EAAKoxB,KACnBxD,EAAS6G,EAAIs0C,aACnB,IAAK,IAAI9kE,KAAOjE,EAAKu5D,KACfv5D,EAAKu5D,KAAK10D,eAAeZ,IAC3B2pB,EAAOrrB,IAAI0B,EAAKjE,EAAKu5D,KAAKt1D,IAG9B,CAAC,OAAQ,OAAOqM,KAAKrM,IACfjE,EAAKiE,IACP2pB,EAAOrrB,IAAI0B,EAAKjE,EAAKiE,OAGzB2pB,EAAOrrB,IAAI,MAAOvE,KAAKoQ,MAAM6zB,UAC7BrU,EAAOrrB,IAAI,QAASvE,KAAKu7B,MAAMjL,OAC/BmG,EAAI6O,OAAS1V,EACblpB,OAAOyE,KAAKsrB,EAAK,eAEjB9xB,QAAQjB,KAAK,yBAA0B0/B,GAI3C3B,mBAAmBh7B,GACjBA,EAAEwqB,iBACFxqB,EAAEyqB,kBACFlxB,KAAKoQ,MAAMuxB,gBAAgB,CAAEtR,UAAWrwB,KAAKu7B,MAAMjL,MAAO4C,EAAGzsB,EAAEm7B,MAAO59B,EAAGyC,EAAEo7B,QAG7EqkC,6BAA6Bt2C,EAAQo7C,GACZ,QAAnBp7C,EAAO0C,WACT1C,EAAO0C,SAAWtyB,KAAKu7B,MAAMjL,MAC7BV,EAAO2C,SAAWvyB,KAAKu7B,MAAMrT,OAE/B0H,EAAOS,UAAYrwB,KAAKu7B,MAAMjL,MAC9B,MAAMisB,EAAYyuB,GAA4B,GACxC16C,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASZ,EAAOS,WAChD,GAAIC,EAAO,CACJA,EAAMkqB,iBACT+B,EAAU14C,KAAK,kBAEjB,MAAMs+B,EAAM7R,EAAMmiB,gBACdtQ,GAAOA,EAAIiY,aACbmC,EAAU14C,KAAK,uBAGnB7D,KAAKoQ,MAAMuxB,gBAAgB/R,EAAQ2sB,GAGrC4pB,wBAAwB/iC,GACtBpjC,KAAKoQ,MAAM66D,UAAUjrE,KAAKu7B,MAAMjL,MAAO8S,GAGzCgjC,iBAAiB3/D,GACfA,EAAEwqB,iBACFjxB,KAAKoQ,MAAM6qC,oBAAoBj7C,KAAKu7B,MAAMjL,MAAOtD,GAAyBhtB,KAAKu7B,MAAMjL,OAGvFi1C,eACE,MAAMj1C,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OAChDA,EAAM44C,gBACR54C,EAAM46C,eAKVhG,YAAYjzC,EAAKk5C,EAAyBt3B,GACxC,IAAI1e,EACAn1B,KAAKoQ,MAAM43D,gBAEb/1C,EAAMjyB,KAAKoQ,MAAM43D,eAAe/1C,IAChCkD,EAAOn1B,KAAKoQ,MAAM43D,eAAe7yC,KACjCn1B,KAAKymE,qBACIzmE,KAAKu7B,MAAMlN,OAASruB,KAAKu7B,MAAMlN,MAAMhqB,UAE9C8wB,EAAO,CAAC9G,MAAO,GAAKruB,KAAKu7B,MAAMlN,MAAMwD,KAEnB,iBAAPI,IACTA,EAAMiO,GAAAA,OAAAA,MAAajO,IAErBA,EAAMiO,GAAAA,OAAAA,OAAcA,GAAAA,OAAAA,iBAAwBlgC,KAAKu7B,MAAMlN,MAAMhqB,SAAU4tB,GACvEjyB,KAAKymE,qBAEPzmE,KAAKoQ,MAAM80D,YAAYjzC,EAAKk5C,EAAyBt3B,EAAU1e,GAIjEgwC,UAAU2E,GACR9pE,KAAKoQ,MAAM80D,YAAY4E,EAAIzlE,aAASrD,OAAWA,EAAW8oE,EAAI30C,MAMhEkwC,mBAAmB/jE,GAEjB,MAAM8pE,EAC0B,IADCprE,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,iBAChEhlB,IAAqC,KAAQ,EAE/C,GAAI7rB,EAAKsd,KAAOwsD,EAAyB,CAEvC,MAAMv3B,EAAW7zC,KAAKoQ,MAAMmgB,OAAOujB,qBACnC,IAAKD,EAEH,YADA7zC,KAAKoQ,MAAMshB,QAAQ1xB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAASsyC,yBAG5D,MAAMgL,EAA0Bt3B,EAASE,OAAOzyC,GAC1C2wB,EAAMiO,GAAAA,OAAAA,WAAkB,KAAM,CAClC3I,KAAMj2B,EAAK/B,KACXg1B,SAAUjzB,EAAKhC,KACfsf,KAAMtd,EAAKsd,KACXysD,WAAYF,IAGdnrE,KAAKklE,YAAYjzC,EAAKk5C,EAAyBt3B,Q3D5mB9C,SAAsBvyC,GAC3B,OAAO,IAAIL,SAAQ,CAACC,EAASqJ,KAC3B,MAAMpJ,EAAS,IAAIC,WACnBD,EAAOqK,QAAW21B,IAChB52B,EAAOpJ,EAAOuJ,QAEhBvJ,EAAO44B,OAAS,KACd74B,EAAQ,CAACq2B,KAAMj2B,EAAK/B,KAAMo7B,KAAMx5B,EAAOK,OAAOo5B,MAAM,KAAK,GAAIt7B,KAAMgC,EAAKhC,QAE1E6B,EAAO05B,cAAcv5B,O2DsmBnBgqE,CAAahqE,GACV2X,MAAKkiB,GAAOn7B,KAAKklE,YAAYhlC,GAAAA,OAAAA,WAAkB,KAAM,CAAC3I,KAAM4D,EAAI5D,KAAMv1B,KAAMm5B,EAAIR,KAAMpG,SAAU4G,EAAI77B,UACpGqL,OAAM4a,GAAOvlB,KAAKoQ,MAAMshB,QAAQnM,KAKvCq7C,iBAAiBt/D,GACf,MAAMiqE,EAA0BvrE,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,oBAAqB/kB,IAElF9rB,EAAKsd,KAAO2sD,EAEdvrE,KAAKoQ,MAAMshB,QAAQ1xB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAASqyC,0BACxD,CAACthD,KAAMmV,GAAiBzyB,EAAKsd,MAAO4sD,MAAOz3C,GAAiBw3C,KAA4B,OAE1FvrE,KAAK48B,SAAS,CACZqrC,WAAY,CACV3mE,KAAMA,EACNhC,KAAMgC,EAAKhC,KACXsf,KAAMtd,EAAKsd,KACXrf,KAAM+B,EAAK/B,QAMnBmnE,iBAAiBp2C,EAAOuB,GACtB7xB,KAAKoQ,MAAMq7D,oBACXzrE,KAAK48B,SAAS,CACZyqC,SAAU,OAEZrnE,KAAKoQ,MAAMs7D,aAAap7C,EAAOuB,GAIjCuzC,oBAAoBzC,EAAS/hE,GAC3B,MAAM22B,EAAOv3B,KAAKu7B,MAAM2sC,aAAa3wC,KAC/BiB,EAAQx4B,KAAKu7B,MAAM2sC,aAAa1vC,MAChCC,EAASz4B,KAAKu7B,MAAM2sC,aAAazvC,OACjCY,EAAQr5B,KAAKu7B,MAAM2sC,aAAa5oE,KAGhC8rE,EAC0B,IADCprE,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,iBAChEhlB,IAAqC,KAAQ,EAE/C,GAAIvsB,EAAKge,KAAOwsD,EAAhB,CAEE,MAAMv3B,EAAW7zC,KAAKoQ,MAAMmgB,OAAOujB,qBACnC,IAAKD,EAEH,YADA7zC,KAAKoQ,MAAMshB,QAAQ1xB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAASsyC,yBAG5D,MAAMgL,EAA0Bt3B,EAASE,OAAOnzC,GAGhD84B,GAAY94B,ElEnwBe,OkEmwB8B,GAAG,GAEzDqY,MAAKooB,GAAU3G,GAAa2G,EAAOzgC,QACnCqY,MAAKkiB,IACF,IAAIlJ,EAAMiO,GAAAA,OAAAA,YAAmB,KAAM,EAAG,CACpC3I,KAAMA,EACNo0C,aAAcxwC,EAAIR,KAClBnC,MAAOA,EACPC,OAAQA,EACRlE,SAAU8E,EACVza,KAAMhe,EAAKge,KACXysD,WAAYF,IAEVxI,IACF1wC,EAAMiO,GAAAA,OAAAA,gBAAuBjO,GAC7BA,EAAMiO,GAAAA,OAAAA,OAAcjO,EAAKiO,GAAAA,OAAAA,MAAayiC,KAGxC3iE,KAAKklE,YAAYjzC,EAAKk5C,EAAyBt3B,MAChDlpC,OAAO4a,IACRvlB,KAAKoQ,MAAMshB,QAAQnM,EAAK,eAM9BmV,GAAa95B,GACVqY,MAAKkiB,IACJ,IAAIlJ,EAAMiO,GAAAA,OAAAA,YAAmB,KAAM,EAAG,CACpC3I,KAAM4D,EAAI5D,KACV+D,QAASH,EAAIR,KACbnC,MAAOA,EACPC,OAAQA,EACRlE,SAAU8E,EACVza,KAAMhe,EAAKge,OAET+jD,IACF1wC,EAAMiO,GAAAA,OAAAA,gBAAuBjO,GAC7BA,EAAMiO,GAAAA,OAAAA,OAAcjO,EAAKiO,GAAAA,OAAAA,MAAayiC,KAExC3iE,KAAKklE,YAAYjzC,MAKvB0uC,kBAAkBr/D,GAIhBo4B,GAAYp4B,ElEvzBa,UkEozBOtB,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,oBAAqB/kB,KAGb,GACtEnU,MAAKooB,IACJrhC,KAAK48B,SAAS,CAACsrC,aAAc,CAC3BzxC,IAAKuD,IAAIS,gBAAgB4G,EAAOzgC,MAChCA,KAAMygC,EAAOzgC,KACbtB,KAAM+hC,EAAO/hC,KACbk5B,MAAO6I,EAAO7I,MACdC,OAAQ4I,EAAO5I,OACf7Z,KAAMyiB,EAAOzgC,KAAKge,KAClB2Y,KAAM8J,EAAO9J,WAEd5sB,OAAM4a,IACPvlB,KAAKoQ,MAAMshB,QAAQnM,EAAK,UAK9B+/C,oBAAoB7uC,EAAK6E,EAASz6B,GAChC6f,MAAM+V,GACHxd,MAAKzX,GAAUA,EAAOZ,SACtBqY,MAAKrY,IAEJ,MAAMwqE,EAA2G,IAAjFprE,KAAKoQ,MAAMmgB,OAAO4hB,eAAe,iBAAkBhlB,IAAqC,KACxH,GAAIvsB,EAAKge,KAAOwsD,EAAyB,CAEvC,MAAMv3B,EAAW7zC,KAAKoQ,MAAMmgB,OAAOujB,qBACnC,IAAKD,EAEH,YADA7zC,KAAKoQ,MAAMshB,QAAQ1xB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAASsyC,yBAG5D,MAAMgL,EAA0Bt3B,EAASE,OAAOnzC,GAC1CqxB,EAAMiO,GAAAA,OAAAA,YAAmB,KAAM,CACnC3I,KAAM32B,EAAKrB,KACXqf,KAAMhe,EAAKge,KACX/d,SAAUA,EACVy6B,QAASA,EACT+vC,WAAYF,IAGdnrE,KAAKklE,YAAYjzC,EAAKk5C,EAAyBt3B,QAG/CnZ,GAAa95B,GACVqY,MAAKkiB,IACJn7B,KAAKklE,YAAYhlC,GAAAA,OAAAA,YAAmB,KAAM,CACxC3I,KAAM4D,EAAI5D,KACV3Y,KAAMhe,EAAKge,KACX5c,KAAMm5B,EAAIR,KACV95B,SAAUA,EACVy6B,QAASA,WAKlB3wB,OAAM4a,IAAQvlB,KAAKoQ,MAAMshB,QAAQnM,MAGtC61C,mBAAmBvpC,EAAKgiB,GACtB,MACM+3B,EADQ5rE,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OAChCu7C,YAAYh6C,GAC5B+5C,IACFA,EAAME,YAAa,GAErBj4B,EAASxc,SAQXmvC,gBAAgB30C,EAAKxtB,EAAS6f,EAAU6nD,GACtC/rE,KAAK48B,SAAS,CAACvO,MAAO,OAEjBwD,GAAQxtB,IAIbA,EAA4B,iBAAXA,EAAsB67B,GAAAA,OAAAA,KAAY77B,GAAWA,EAE5DA,EADE67B,GAAAA,OAAAA,QAAe77B,GACP67B,GAAAA,OAAAA,aAAoB77B,ElEl3BD,IkEq3BnB67B,GAAAA,OAAAA,OAAcA,GAAAA,OAAAA,KAAY,MAClCA,GAAAA,OAAAA,SAAgBlgC,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAAS42C,iBAAkB,OAG7EzkE,KAAK48B,SAAS,CACZvO,MAAO,CACLhqB,QAAS67B,GAAAA,OAAAA,MAAa6rC,EAAY7nD,EAAU7f,GAC5CwtB,IAAKA,KAGT7xB,KAAKoQ,MAAM47D,0BAGbvF,oBACEzmE,KAAK48B,SAAS,CAACvO,MAAO,OACtBruB,KAAKoQ,MAAM47D,yBAGb3Q,iBAAiBO,GACf,MAAMxoC,EAAMpzB,KAAK4mE,sBAAsBhL,GACnCxoC,GAAOA,EAAIpC,SACboC,EAAIpC,QAAQi7C,eAAe,CAACt9C,MAAO,SAAUu9C,SAAU,WACvD94C,EAAIpC,QAAQm7C,UAAUn5D,IAAI,SAC1BqK,YAAW,KAAQ+V,EAAIpC,QAAQm7C,UAAUptD,OAAO,WAAa,MAE7Dpa,QAAQ+F,MAAM,yBAA0BkxD,GAI5C3vC,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KAEnC,IAAI5e,EACJ,GAAIzQ,KAAKoQ,MAAMg8D,SACb37D,EAAY,UACP,GAAKzQ,KAAKu7B,MAAMjL,MAMhB,CACL,IAAI+7C,EACJ,GAAIrsE,KAAKu7B,MAAM2sC,aAEbmE,EACE,kBAAClJ,GAAD,CACE9+D,QAASrE,KAAKu7B,MAAM2sC,aACpB33C,OAAQvwB,KAAKoQ,MAAMmgB,OACnBlC,MAAOruB,KAAKu7B,MAAMlN,MAClB8zC,cAAeniE,KAAKymE,kBACpB/oB,QAAS19C,KAAKgmE,mBACdjE,cAAe/hE,KAAKolE,2BAEnB,GAAIplE,KAAKu7B,MAAM4sC,cAEpBkE,EACE,kBAAClJ,GAAD,CACE9+D,QAASrE,KAAKu7B,MAAM4sC,cACpBzqB,QAAS19C,KAAKgmE,0BAEb,GAAIhmE,KAAKu7B,MAAM0sC,WAEpBoE,EACE,kBAAC5J,GAAD,CACEp+D,QAASrE,KAAKu7B,MAAM0sC,WACpB13C,OAAQvwB,KAAKoQ,MAAMmgB,OACnBlC,MAAOruB,KAAKu7B,MAAMlN,MAClB8zC,cAAeniE,KAAKymE,kBACpB/oB,QAAS19C,KAAKgmE,mBACdjE,cAAe/hE,KAAKqlE,0BAEnB,GAAIrlE,KAAKu7B,MAAM8rC,SAAU,CAC9B,MAAM/2C,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OACpD+7C,EACE,kBAAC1uB,GAAD,CACErtB,MAAOA,EACPuB,IAAK7xB,KAAKoQ,MAAMk3D,QAChBjqB,UAAWr9C,KAAKoQ,MAAMitC,UACtBV,cAAe38C,KAAKoQ,MAAMusC,cAC1BpsB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBrI,MAAOloB,KAAKu7B,MAAMrT,MAClBwP,OAAQ13B,KAAKu7B,MAAM7D,SAAU,EAE7BhG,QAAS1xB,KAAKoQ,MAAMshB,QACpB0wB,SAAUpiD,KAAK0mE,iBACfzmB,SAAUjgD,KAAKoQ,MAAMk8D,aACrBprB,YAAalhD,KAAKoQ,MAAMm8D,gBACxBjrB,eAAgBthD,KAAKoQ,MAAMo8D,mBAC3BzqB,aAAc/hD,KAAKoQ,MAAMq8D,uBAGxB,CACL,MAAMn8C,EAAQtwB,KAAKoQ,MAAMmgB,OAAOC,SAASxwB,KAAKu7B,MAAMjL,OAC9CyS,EAAYzS,EAAMkqB,gBAClBtD,EAAa5mB,EAAMiqB,gBAAkBxX,EACrChB,EAAc,GAChBzR,EAAMqU,UACJrU,EAAMqU,QAAQC,UAChB7C,EAAYl+B,KAAK,CAAC6vB,KAAM,WAAYD,MAAO,cAEzCnD,EAAMqU,QAAQE,OAChB9C,EAAYl+B,KAAK,CAAC6vB,KAAM,QAASD,MAAO,cAEtCnD,EAAMqU,QAAQG,QAChB/C,EAAYl+B,KAAK,CAAC6vB,KAAM,YAAaD,MAAO,eAIhD,MAAMi5C,EAAe,GACrB,IAAIC,EAAe,KACfC,EAAW,KACXC,EAAe,KACnB,MAAMC,EAAU,IAAI1Y,KAAKyB,eAAe71D,KAAKoQ,MAAMif,KAAKmmC,QACxDllC,EAAMzC,UAAS,CAACoE,EAAK86C,EAAM9hD,EAAMhpB,KAC/B,IAAI+qE,EAAW/hD,EAAQA,EAAK/Y,MAAQ,OAAU,KAE1C4pD,EAAW,SACXmR,EAAWh7C,EAAI/f,MAAQ,OACvB+6D,GAAYN,EAEZ7Q,EADEmR,GAAYD,EACH,SAEA,OAEJC,GAAYD,IACrBlR,EAAW,SAEb6Q,EAAeM,EAEf,MAAMC,IAAYD,GAAYjtE,KAAKoQ,MAAM6zB,UACnCG,EAAiB9T,EAAMiU,UAAUtS,GAAK,GAE5C,IAAyBM,EAAUoa,EAA/Bra,EAAW26C,EACf,MAAMv8C,EAAOJ,EAAM68C,SAASF,GACxBv8C,GAAQA,EAAKsT,SACfzR,EAAW7B,EAAKsT,OAAO9mB,GACvByvB,EAAatU,GAAa3H,EAAKsT,OAAO7N,QAExC02C,EAAe31B,EAAa,iBAAmB,WAG/C,MAAM9jB,EAAMpzB,KAAK4mE,sBAAsB30C,EAAIJ,KAC3C,IAAI+pC,EAAa3pC,EAAIkD,KAAO/yB,SAAS6vB,EAAIkD,KAAK9G,OAAS,KAKvD,GAJKutC,IAAcwR,MAAMxR,KACvBA,EAAa,MAGX3pC,EAAIsM,GAENmuC,EAAa7oE,KACX,kBAACggE,GAAD,CACE/rC,SAAS,EACT7xB,IAAKgsB,EAAIJ,WAER,CACL,MAAMw7C,EAAW,IAAI34D,KAAKud,EAAIq7C,IAEzBV,GAAYA,EAASW,gBAAkBF,EAASE,iBACnDb,EAAa7oE,KACX,kBAACggE,GAAD,CACE1qD,KAAM2zD,EAAQnZ,OAAO1hC,EAAIq7C,IACzB9X,OAAQx1D,KAAKoQ,MAAMif,KAAKmmC,OACxBvvD,IAAK,QAAUgsB,EAAIJ,OAEvB+6C,EAAWS,GAEbX,EAAa7oE,KACX,kBAAC,GAAD,CACE0sB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBlsB,QAAS4tB,EAAI5tB,QACbY,SAAUgtB,EAAIkD,KAAOlD,EAAIkD,KAAKoC,KAAO,KACrCqjC,UAAW3oC,EAAIq7C,GACfzsE,SAAUoxB,EAAIu7C,OAASv7C,EAAIq7C,GAAKr7C,EAAIu7C,OAAS,KAC7ChyD,SAAU0xD,EACVr7C,IAAKI,EAAIJ,IACT8F,QAASuf,EACTu2B,OAAQztE,KAAKu7B,MAAMnd,QACnBkU,SAAUA,EACVC,SAAUA,EACVoa,WAAYA,EACZmvB,SAAUA,EACV7kC,SAAUmN,EACVyP,SAAU5hB,EAAIy7C,UACd3tC,cAAe//B,KAAKoQ,MAAM2vB,cAC1B4B,gBAAiB3hC,KAAKkmE,6BACtB/lC,eAAgBngC,KAAK+lE,oBACrBtK,eAAgBz7D,KAAKimE,mBACrBv0C,QAAS1xB,KAAKoQ,MAAMshB,QACpB6N,eAAgBv/B,KAAKo7D,mBACrB/oC,UAAWryB,KAAKwmE,gBAChB5K,WAAYA,EACZj7B,aAAc3gC,KAAKq7D,iBACnBjoC,IAAKA,EACLsoC,aAAc17D,KAAKu7B,MAAMkL,SACzBxgC,IAAKgsB,EAAIJ,WAKjB,IAAI87C,EAAW,KACf,GAAI5qC,EACF4qC,EAAWv+C,EAAcvB,GAASzP,aAC7B,CACL,MAAMwvD,EAAO5tE,KAAKoQ,MAAMmgB,OAAOs9C,aAAaC,WAAW9tE,KAAKu7B,MAAMjL,OAC9Ds9C,GAAQ7hD,GAAAA,OAAAA,eAAsB6hD,EAAKt9C,SACjCs9C,EAAK9rC,OACP6rC,EAAWv+C,EAAcvB,GAASy2C,YACzBsJ,EAAKG,OACdJ,EAAWv+C,EAAcvB,GAAS02C,WAAa,K/DrqCtD,SAAyBtrD,EAAMu8C,GACpCA,EAASA,GAAU9uD,OAAOmZ,UAAUmuD,cAAgBtnE,OAAOmZ,UAAUouD,SACrE,MAAMx5D,EAAM,IAAIC,KAChB,OAAIuE,EAAKi1D,eAAiBz5D,EAAIy5D,cAExBj1D,EAAKk1D,YAAc15D,EAAI05D,YAAcl1D,EAAKm1D,WAAa35D,EAAI25D,UAEtDn1D,EAAK4hD,mBAAmBrF,EAAQ,CAAC9P,QAAQ,EAAOE,KAAM,UAAWC,OAAQ,YAG3E5sC,EAAKo1D,mBAAmB7Y,EAC7B,CAAC9P,QAAQ,EAAOH,MAAO,QAASC,IAAK,UAAWI,KAAM,UAAWC,OAAQ,YAGtE5sC,EAAKo1D,mBAAmB7Y,EAAQ,CAACnQ,KAAM,UAAWE,MAAO,QAASC,IAAK,Y+DwpChE8oB,CAAgBV,EAAKG,KAAKQ,KAAMvuE,KAAKoQ,MAAMif,KAAKmmC,UAKxD,MAAM99B,EAAS13B,KAAKu7B,MAAM7D,SAAU,EAC9BoK,EAAS9hC,KAAKu7B,MAAMzD,QAAU,KAClC93B,KAAKoQ,MAAM0xB,OAAS,UAAY9hC,KAAKu7B,MAAM6sC,gBAAkB,UAAY,IAAM,UAE3EzlC,EAAa,eAAiB3iC,KAAKu7B,MAAMzD,QAAU,WAAa,IAEtEu0C,EACE,oCACE,yBAAKhpE,GAAG,sBAAsB8oB,UAAU,iBACrCnsB,KAAKoQ,MAAMusC,cACV,uBAAGnnB,KAAK,IAAInyB,GAAG,oBAAoBgpB,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMsyC,uBACjF,uBAAGv2B,UAAU,kBAAb,eAGF,KACF,yBAAKA,UAAU,cACb,kBAACsL,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQA,EACRpH,MAAOtwB,KAAKu7B,MAAMjL,MAClBpI,MAAOloB,KAAKu7B,MAAMrT,MAClB4P,QAAS93B,KAAKu7B,MAAMzD,UACpBiL,EAA0C,KAA9B,0BAAM5W,UAAW2V,KAEjC,yBAAKz+B,GAAG,qBACN,yBAAKA,GAAG,cAAc8oB,UAAWwW,GAC/B3iC,KAAKu7B,MAAMrT,OACX,2BAAG,kBAAC,EAAAoE,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,8BAEvD,kBAACgH,GAAD,CAAeC,OAAQuO,KACxB,yBAAK1+B,GAAG,mBAAmBsqE,IAE5Bz2B,EACC,kBAAC4rB,GAAD,CACEvyC,OAAQvwB,KAAKoQ,MAAMmgB,OACnBupB,YAAa95C,KAAKu7B,MAAMgtC,aAC1B,yBAAKllE,GAAG,gBAEV,6BACE,uBAAGmyB,KAAK,IAAInJ,QAASrsB,KAAKyhC,oBACxB,uBAAGtV,UAAU,kBAAb,gBAILnsB,KAAKoQ,MAAMusC,cACV,kBAACvU,GAAD,CACEC,MAAOroC,KAAKoQ,MAAMwsC,WAClBrU,KAAMvoC,KAAKoQ,MAAMysC,UACjBvU,aAActoC,KAAKoQ,MAAMshB,UACzB,KACJ,kBAACmV,GAAD,CAAaG,KAAMhnC,KAAKu7B,MAAM8sC,mBAC9B,yBAAKhlE,GAAG,sBACN,4BAAQ8oB,UAAW,iBAAmBnsB,KAAKu7B,MAAM+sC,mBAAqB,GAAK,WACzEj8C,QAASrsB,KAAKumE,mBACd,uBAAGp6C,UAAU,kBAAb,mBAEF,yBAAK9oB,GAAG,iBAAiB+vB,IAAKpzB,KAAKwlE,uBACjC,wBAAIniE,GAAG,WAAW8oB,UAAW0gD,GAC1BH,IAGH1sE,KAAKu7B,MAAMutC,SASX,KARF,yBAAKzlE,GAAG,yBACLrD,KAAKu7B,MAAMwtC,eACZ,yBAAK1lE,GAAG,mBACN,kBAAC,EAAAipB,iBAAD,CAAkBjpB,GAAE,wBAAyBkpB,eAAc,4CAG3D,OAILvsB,KAAKu7B,MAAMmtC,wBAA0B1oE,KAAKu7B,MAAM0tC,YAC/C,yBAAK5lE,GAAG,gCACN,uBAAG8oB,UAAU,4BAAb,SADF,IACoD,kBAAC,EAAAG,iBAAD,CAChDjpB,GAAE,2BAA4BkpB,eAAc,mDAFhD,IAGqE,uBAAGiJ,KAAK,IACvEnJ,QAASrsB,KAAKomE,kBAAkB,kBAAC,EAAA95C,iBAAD,CAAkBjpB,GAAE,yBACpDkpB,eAAc,6BALpB,KAMS,KACVvsB,KAAKu7B,MAAM0tC,YACV,kBAACzF,GAAD,CAAY/xC,SAAUzxB,KAAKmmE,0BAE3B,kBAAC,GAAD,CACE51C,OAAQvwB,KAAKoQ,MAAMmgB,OACnBF,UAAWrwB,KAAKu7B,MAAMjL,MACtBwxC,UAAW9hE,KAAKoQ,MAAM43D,eACtB7G,UAAWnhE,KAAKu7B,MAAMkL,UAAYzmC,KAAKu7B,MAAMzD,QAC7CmqC,WAAYjiE,KAAKulE,aACjBxD,cAAe/hE,KAAKklE,YACpBvD,aAAc3hE,KAAKoQ,MAAM43D,eAAiB,KAAOhoE,KAAK4gE,iBACtDc,cAAe1hE,KAAKoQ,MAAM43D,eAAiB,KAAOhoE,KAAK2gE,kBACvDiB,cAAe5hE,KAAKoQ,MAAM43D,eAAiB,KAAOhoE,KAAKslE,oBACvD5zC,QAAS1xB,KAAKoQ,MAAMshB,QACpBrD,MAAOruB,KAAKu7B,MAAMlN,MAClBsS,aAAc3gC,KAAKq7D,iBACnB8G,cAAeniE,KAAKymE,qBAI9Bh2D,EAAY,yBAAKpN,GAAG,cAAcgpE,QAvRlC57D,EACE,kBAACizD,GAAD,CACEC,cAAe3jE,KAAKoQ,MAAMuzD,cAC1BC,cAAe5jE,KAAKoQ,MAAMwzD,gBAsRhC,OAAOnzD,GAIX,UAAe4iB,EAAAA,EAAAA,YAAW0xC,ICnxCX,MAAMyJ,WAAmB1nE,IAAAA,cACtCmlB,SACE,OACE,uBAAGuJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMq+D,WAC1D,uBAAGtiD,UAAU,kBAAb,gBCLO,MAAMuiD,WAAqB5nE,IAAAA,cACxCmlB,SACE,OACE,6BACE,uBAAGuJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMu+D,eAAgB,uBAAGxiD,UAAU,kBAAb,SAD9E,IAGE,uBAAGqJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMw+D,eAAgB,uBAAGziD,UAAU,kBAAb,eCNrE,MAAM0iD,WAAkB/nE,IAAAA,cACrCmlB,SACE,OACI,6BACE,uBAAGuJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM0+D,aAAc,uBAAG3iD,UAAU,kBAAb,eAD5E,IAGE,uBAAGqJ,KAAK,IAAInJ,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMw+D,eAAgB,uBAAGziD,UAAU,kBAAb,eCEvE,MAAM4iD,WAAmBjoE,IAAAA,cACtCmlB,SACE,MAAM8V,EAAc,GAChB/hC,KAAKoQ,MAAM23B,eACb/nC,KAAKoQ,MAAM23B,cAAcz1B,KAAK3F,IAC5Bo1B,EAAYl+B,KAAK,CAAC6vB,KAAM/mB,EAAG8mB,MAAO,iBAGtC,IAAIiE,EAAS,KAIb,OAHI13B,KAAKoQ,MAAMmgB,SACbmH,EAAS13B,KAAKoQ,MAAMmgB,OAAOwH,aAAalB,GAAmB72B,KAAKoQ,MAAMsnB,OAAQ,WAG9E,yBAAKr0B,GAAG,qBAAqB8oB,UAAU,iBACpCnsB,KAAKoQ,MAAMivB,SAAW,kBAACmvC,GAAD,CAAYC,OAAQzuE,KAAKoQ,MAAMivB,WAAe,KACpE3H,EACC,yBAAKr0B,GAAG,cAAc8oB,UAAU,cAC9B,kBAACsL,GAAD,CACElH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQA,EACRpH,MAAOtwB,KAAKoQ,MAAM6zB,SAClB/b,MAAOloB,KAAKoQ,MAAM8X,SAGtB,KACF,yBAAK7kB,GAAG,kBAAkB8oB,UAAU,eAAensB,KAAKoQ,MAAM8X,MAAM,kBAACqL,GAAD,CAAeC,OAAQuO,KACrE,UAArB/hC,KAAKoQ,MAAMmrB,MACR,kBAACszC,GAAD,CAAWC,SAAU9uE,KAAKoQ,MAAM0+D,SAAUF,WAAY5uE,KAAKoQ,MAAMw+D,aAC9C,aAArB5uE,KAAKoQ,MAAMmrB,MACT,kBAACmzC,GAAD,CAAcC,WAAY3uE,KAAKoQ,MAAMu+D,WAAYC,WAAY5uE,KAAKoQ,MAAMw+D,aAC1E,OC9BV,SAASI,GAAM9nE,EAAK7G,GAClB,OAAO6G,GAAOA,EAAIwT,UAAU,EAAGra,GAGlB,MAAM4uE,WAA4BnoE,IAAAA,UAC/ChH,YAAYsQ,GACVvE,MAAMuE,GAEN,MAAM8+D,EAAKlvE,KAAKoQ,MAAMmgB,OAAOs9C,aAC7B7tE,KAAKu7B,MAAQ,CACXoX,SAAUq8B,GAAME,EAAGlrC,OAASkrC,EAAGlrC,OAAO9mB,QAAKlc,EAAWssB,IACtDslB,YAAao8B,GAAME,EAAGlrC,OAASkrC,EAAGlrC,OAAOlO,UAAO90B,EAAWusB,IAC3DmK,OAAQW,GAAa62C,EAAGlrC,OAASkrC,EAAGlrC,OAAO7N,MAAQ,OAIvDlK,SACE,OACE,yBAAKE,UAAU,oBACb,yBAAKA,UAAU,qBACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,0BAA0BE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgsC,WAAW,aACzG,uBAAGjwB,UAAU,kBAAb,QADF,IAEE,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,cAAekpB,eAAc,2BAEnD,gCACE,kBAAC0a,GAAD,CACE1W,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmH,OAAQ13B,KAAKu7B,MAAM7D,OACnB6P,UAAU,EACVhB,IAAKvmC,KAAKoQ,MAAM6zB,SAChB/b,MAAOloB,KAAKu7B,MAAMoX,YAEtB,yBAAKxmB,UAAU,SACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAAmBkpB,eAAc,gCAGvD,yBAAKJ,UAAU,oBAAoBnsB,KAAKu7B,MAAMoX,WAEhD,yBAAKxmB,UAAU,SACb,2BAAOA,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,0BAD9E,IAGE,4BAAKvsB,KAAKoQ,MAAM6zB,WAElB,yBAAK9X,UAAU,SACb,kBAAC,GAAD,CAAW4b,cAAe/nC,KAAKoQ,MAAM23B,iBAEtC/nC,KAAKu7B,MAAMqX,YACV,yBAAKzmB,UAAU,SACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,kCAGzD,6BAAMvsB,KAAKu7B,MAAMqX,cACV,MAEb,yBAAKzmB,UAAU,OACf,yBAAKA,UAAU,qBACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,cAAcE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgsC,WAAW,WAC7F,uBAAGjwB,UAAU,kBAAb,iBADF,IACuD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,oCACvEkpB,eAAc,oCAElB,uBAAGiJ,KAAK,IAAIrJ,UAAU,cAAcE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgsC,WAAW,cAC7F,uBAAGjwB,UAAU,kBAAb,YADF,IACkD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAClEkpB,eAAc,+BAElB,uBAAGiJ,KAAK,IAAIrJ,UAAU,cAAcE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAMgsC,WAAW,aAC7F,uBAAGjwB,UAAU,kBAAb,mBADF,IACyD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,8BACzEkpB,eAAc,iCCtE5B,MAAMsB,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BqhD,wBAAyB,CACvB9rE,GAAI,oBACJkpB,eAAgB,CAAF,mFAKH,MAAM6iD,WAAqBtoE,IAAAA,UACxChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKqvE,aAAervE,KAAKqvE,aAAa9/C,KAAKvvB,MAE3CA,KAAKu7B,MAAQ6zC,GAAarmC,qBAAqB34B,GAGtB,4BAACA,GAC1B,MAAMuzB,EAAW,GACjB,IAAI2rC,EAAgB,EAChBC,EAAgB,EAmCpB,OAlCAn/D,EAAMo/D,SAASl9D,KAAKnO,IAClB,MAAMsrE,EAAUtrE,EAAEg+B,MAAQh+B,EAAEg+B,IAAII,WAE5BktC,GAAWr/D,EAAMq/D,SACnB9rC,EAAS9/B,KAAKM,GAEZsrE,GAAWr/D,EAAMq/D,UAIjBtrE,EAAE2/B,SAAW3/B,EAAE2/B,QAAQ4rC,KACrBt/D,EAAM0e,QACR6U,EAAS9/B,KAAKM,GAEdorE,IAEQn/D,EAAM0e,UAChB6U,EAAS9/B,KAAKM,GACdmrE,GAAiBnrE,EAAE6+B,OAAS,EAAI,EAAI,OAIxCW,EAASrN,MAAK,CAACvwB,EAAG4G,KACRA,EAAEgjE,SAAW,IAAM5pE,EAAE4pE,SAAW,KAGtCJ,EAAgB,GAClB5rC,EAAS9/B,KAAK,CACZu/B,OAAQ,UACRlb,MAAO2F,GAASshD,wBAChBh9D,OAAQ,CAACsgB,MAAO88C,KAIb,CACLh3B,YAAa5U,EACb2rC,cAAeA,GAInB5yC,mBAAmBC,EAAWkN,GAC5B,GAAIlN,EAAU6yC,UAAYxvE,KAAKoQ,MAAMo/D,UACjC7yC,EAAU7N,SAAW9uB,KAAKoQ,MAAM0e,SAChC6N,EAAU8yC,SAAWzvE,KAAKoQ,MAAMq/D,QAAS,CAC3C,MAAMh2B,EAAW21B,GAAarmC,qBAAqB/oC,KAAKoQ,OACxDpQ,KAAK48B,SAAS6c,GACVA,EAAS61B,eAAiBzlC,EAAUylC,eACtCt6C,GAAcykB,EAAS61B,gBAK7BD,aAAaO,GACX5vE,KAAKoQ,MAAMy/D,gBAGb5jD,SACE,OACE,kBAAC,EAAAK,iBAAD,CAAkBjpB,GAAE,qBAClBkpB,eAAc,yFAEbie,GAAgB,kBAAC,GAAD,CACfja,OAAQvwB,KAAKoQ,MAAMmgB,OACnBkU,UAAWzkC,KAAKoQ,MAAMq0B,UACtBd,SAAU3jC,KAAKu7B,MAAMgd,YACrBpT,iBAAkBqF,EAClBhH,cAAexjC,KAAKoQ,MAAMozB,cAC1BS,SAAUjkC,KAAKoQ,MAAM6zB,SACrBnB,YAAY,EACZ0B,YAAY,EACZE,gBAAiB1kC,KAAKoQ,MAAMs0B,gBAC5B/C,gBAAiB3hC,KAAKoQ,MAAMuxB,gBAC5BlQ,SAAUzxB,KAAKqvE,kBClGV,MAAMS,GAEH,iBAAC7pE,EAAK1D,GACpBwtE,aAAaC,QAAQ/pE,EAAKuU,KAAKC,UAAUlY,IAI3B,iBAAC0D,GACf,MAAM1D,EAAQwtE,aAAaE,QAAQhqE,GACnC,OAAO1D,GAASiY,KAAKiwC,MAAMloD,GAIV,oBAAC0D,EAAK1D,GACvB,MAAM2tE,EAASlwE,KAAKmwE,UAAUlqE,GAC9BjG,KAAKowE,UAAUnqE,EAAKrG,OAAOiX,OAAOq5D,GAAU,GAAI3tE,IAIjC,kBAAC0D,GAChB8pE,aAAaM,WAAWpqE,ICVb,MAAMqqE,WAA0BxpE,IAAAA,cAC7ChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXg1C,MAAO,GACPC,SAAU,GACVC,MAAO,GACPvzD,GAAI,GACJwzD,aAAc,KACdC,cAAc,EACdC,UAAWd,GAAiBK,UAAU,mBAGxCnwE,KAAK6wE,kBAAoB7wE,KAAK6wE,kBAAkBthD,KAAKvvB,MACrDA,KAAK8wE,qBAAuB9wE,KAAK8wE,qBAAqBvhD,KAAKvvB,MAC3DA,KAAK+wE,kBAAoB/wE,KAAK+wE,kBAAkBxhD,KAAKvvB,MACrDA,KAAKgxE,eAAiBhxE,KAAKgxE,eAAezhD,KAAKvvB,MAC/CA,KAAK+4C,mBAAqB/4C,KAAK+4C,mBAAmBxpB,KAAKvvB,MACvDA,KAAKixE,sBAAwBjxE,KAAKixE,sBAAsB1hD,KAAKvvB,MAC7DA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAG7C6wE,kBAAkBpqE,GAChBzG,KAAK48B,SAAS,CAAC2zC,MAAO9pE,EAAEiH,OAAOnL,QAGjCuuE,qBAAqBN,GACnBxwE,KAAK48B,SAAS,CAAC4zC,SAAUA,IAG3BO,kBAAkBtqE,GAChBzG,KAAK48B,SAAS,CAAC6zC,MAAOhqE,EAAEiH,OAAOnL,QAGjCyuE,eAAevqE,GACbzG,KAAK48B,SAAS,CAAC1f,GAAIzW,EAAEiH,OAAOnL,QAG9Bw2C,mBAAmBnf,GACjB55B,KAAK48B,SAAS,CAAC8zC,aAAc92C,IAG/Bq3C,wBACEnB,GAAiBM,UAAU,kBAAmBpwE,KAAKu7B,MAAMq1C,WACzD5wE,KAAK48B,SAAS,CAACg0C,WAAY5wE,KAAKu7B,MAAMq1C,YAGxCxlC,aAAa3kC,GACXA,EAAEwqB,iBACFjxB,KAAK48B,SAAS,CAAC+zC,cAAc,IAC7B3wE,KAAKoQ,MAAM8gE,gBACTlxE,KAAKu7B,MAAMg1C,MAAMv6C,OACjBh2B,KAAKu7B,MAAMi1C,SAASx6C,OACpBL,GAAQ31B,KAAKu7B,MAAMre,GAAG8Y,OAAOtb,UAAU,EAAG4S,IAAmBttB,KAAKu7B,MAAMm1C,cACxE,CAAC,KAAQ,QAAS,IAAO1wE,KAAKu7B,MAAMk1C,QAGxCxkD,SACE,IAAIklD,EAAgB,UAKpB,OAJInxE,KAAKoQ,MAAM+wD,WACbgQ,GAAiB,aAIjB,0BAAMhlD,UAAU,oBAAoB0f,SAAU7rC,KAAKorC,cACjD,yBAAKjf,UAAU,kBACb,yBAAKA,UAAU,qBACb,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,2BAE/C6kD,GAAiB,2BAAO7xE,KAAK,OAAOsmC,YAAaurC,EAAczgC,aAAa,YAC3EpuC,MAAOvC,KAAKu7B,MAAMg1C,MAAOzqC,SAAU9lC,KAAK6wE,kBAAmB7qC,UAAQ,EAACC,WAAS,MAEjF,kBAAC,EAAA3Z,iBAAD,CAAkBjpB,GAAE,kBAAmBkpB,eAAc,8BAElD8kD,GAAoB,kBAAChhC,GAAD,CAAiBxK,YAAawrC,EAAiB1gC,aAAa,eAC/EpuC,MAAOvC,KAAKu7B,MAAMi1C,SAAU//B,WAAYzwC,KAAK8wE,qBAC7C9qC,UAAU,OAGhB,kBAACiB,GAAD,CACE1W,OAAQvwB,KAAKoQ,MAAMmgB,OACnB+gD,eAAgBtxE,KAAK+4C,mBACrBrnB,QAAS1xB,KAAKoQ,MAAMshB,WAExB,yBAAMvF,UAAU,kBACd,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,8CAEnDglD,GAAqB,2BAAOhyE,KAAK,OAAOsmC,YAAa0rC,EAAkB5gC,aAAa,OACnFpuC,MAAOvC,KAAKu7B,MAAMre,GAAI4oB,SAAU9lC,KAAKgxE,eAAgBhrC,UAAQ,OAGnE,yBAAK7Z,UAAU,kBACb,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,kDAE/CilD,GAAiB,2BAAOjyE,KAAK,QAAQsmC,YAAa2rC,EAAc7gC,aAAa,QAC5EpuC,MAAOvC,KAAKu7B,MAAMk1C,MAAO3qC,SAAU9lC,KAAK+wE,kBAAmB/qC,UAAQ,OAGzE,yBAAK7Z,UAAU,kBACb,kBAAC6b,GAAD,CAAU3kC,GAAG,aAAa/D,KAAK,aAAa4oC,QAASloC,KAAKu7B,MAAMq1C,UAC9D9qC,SAAU9lC,KAAKixE,wBACjB,kBAAC,EAAA3kD,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,oCAEjDklD,GAAmB,2BAAOhqC,QAAQ,cAAf,IAAmCgqC,MAG3D,yBAAKtlD,UAAU,kBACb,4BAAQA,UAAWglD,EAAe5xE,KAAK,UACrC,kBAAC,EAAA+sB,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,iCCpHjD,MAAMmlD,WAAwB5qE,IAAAA,cAC3ChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAK2xE,oBAAsB3xE,KAAK2xE,oBAAoBpiD,KAAKvvB,MAG3D2xE,oBAAoB3xB,EAAM9X,GACZ,SAAR8X,EACFhgD,KAAKoQ,MAAMwhE,sBAAsB1pC,GAChB,SAAR8X,EACThgD,KAAKoQ,MAAMyhE,0BAA0B3pC,GACpB,aAAR8X,GACThgD,KAAKoQ,MAAM0hE,sBAAsB5pC,GAIrCjc,SACE,OACI,yBAAKE,UAAU,oBACb,yBAAKA,UAAU,kBACb,2BAAOsb,QAAQ,iBACb,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,qCAG3D,kBAACyb,GAAD,CAAU1oC,KAAK,QAAQ+D,GAAG,gBACxB6kC,QAASloC,KAAKoQ,MAAM2hE,cAAejsC,SAAU9lC,KAAK2xE,uBAEtD,yBAAKxlD,UAAU,kBACb,2BAAOsb,QAAQ,kBACdznC,KAAKoQ,MAAM4hE,qBACV,kBAAC,EAAA1lD,iBAAD,CAAkBjpB,GAAE,2BAA4BkpB,eAAc,0CAG9D,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,oCAClBkpB,eAAc,4DAIlB,kBAACyb,GAAD,CAAU1oC,KAAK,QAAQ+D,GAAG,iBACxB6kC,QAASloC,KAAKoQ,MAAM6hE,cACpBnsC,SAAU9lC,KAAKoQ,MAAM4hE,qBAAuBhyE,KAAK2xE,oBAAsB,QAE3E,yBAAKxlD,UAAU,kBACb,2BAAOsb,QAAQ,kBACb,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,sCAG5D,kBAACyb,GAAD,CAAU1oC,KAAK,YAAY+D,GAAG,iBAC5B6kC,QAASloC,KAAKoQ,MAAM8hE,cAAepsC,SAAU9lC,KAAK2xE,yBChDhE,MAAM9jD,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BqkD,eAAgB,CACd9uE,GAAI,iBACJkpB,eAAgB,CAAF,kCAGhB6lD,uBAAwB,CACtB/uE,GAAI,yBACJkpB,eAAgB,CAAF,wFAKlB,MAAM8lD,WAAwBvrE,IAAAA,UAC5BhH,YAAYsQ,GACVvE,MAAMuE,GAEN,MAAM8+D,EAAKlvE,KAAKoQ,MAAMmgB,OAAOs9C,aAC7B,IAAIyE,EAAe,EACnBpD,EAAGvrC,UAAUx/B,IACPA,EAAEg+B,MAAQh+B,EAAEg+B,IAAII,YAClB+vC,OAGJ,MAAMt4B,EAASk1B,EAAGj1B,mBAClBj6C,KAAKu7B,MAAQ,CACX/W,KAAMw1B,EAASA,EAAOx1B,KAAO,KAC7B6yB,KAAM2C,EAASA,EAAO3C,KAAO,KAC7Bk7B,6BAAyBvxE,EACzBsxE,aAAcA,GAGhBtyE,KAAKwyE,qBAAuBxyE,KAAKwyE,qBAAqBjjD,KAAKvvB,MAC3DA,KAAKm5C,8BAAgCn5C,KAAKm5C,8BAA8B5pB,KAAKvvB,MAC7EA,KAAKyyE,4BAA8BzyE,KAAKyyE,4BAA4BljD,KAAKvvB,MACzEA,KAAKk5C,yBAA2Bl5C,KAAKk5C,yBAAyB3pB,KAAKvvB,MACnEA,KAAK0yE,oBAAsB1yE,KAAK0yE,oBAAoBnjD,KAAKvvB,MAG3DwyE,qBAAqBG,GACnB3yE,KAAK48B,SAAS,CAAC4zC,SAAUmC,IACzB3yE,KAAKoQ,MAAMwiE,iBAAiBD,GAG9Bx5B,8BAA8BiC,GAC5Bp7C,KAAK48B,SAAS,CACZ21C,wBAAyBn3B,EACzBW,kBAAmB/7C,KAAKu7B,MAAM6f,KAIlCq3B,8BACEzyE,KAAK48B,SAAS,CAAC21C,6BAAyBvxE,IAG1Ck4C,yBAAyBmC,GACvB,IAAIrB,EAAS,GACbA,EAAOh6C,KAAKu7B,MAAMg3C,yBAA2Bl3B,EAC7Cr7C,KAAKoQ,MAAMyiE,oBAAoB,UAAM7xE,OAAWA,EAAWg5C,GAE3D,IAAIP,EAAW,CAAC84B,6BAAyBvxE,GACzCy4C,EAASz5C,KAAKu7B,MAAMg3C,yBAA2Bl3B,EAC/Cr7C,KAAK48B,SAAS6c,GAGhBi5B,oBAAoBjsE,GAClBA,EAAEwqB,iBACF,MAAM,cAAC7B,GAAiBpvB,KAAKoQ,MAAMif,KACnCrvB,KAAKoQ,MAAM0f,YACTV,EAAcvB,GAASskD,gBACvB/iD,EAAcvB,GAASukD,yBACtB,KAAQpyE,KAAKoQ,MAAM0iE,oBACpB,MACA,EACA,MAIJ7mD,SACE,OACE,oCAAGjsB,KAAKu7B,MAAMg3C,wBACZ,kBAAC,GAAD,CACEvkE,KAAMhO,KAAKu7B,MAAMwgB,kBACjBvP,KAAK,IACLX,SAAU7rC,KAAKk5C,yBACf7Z,SAAUr/B,KAAKyyE,8BAEjB,yBAAKtmD,UAAU,oBACb,yBAAKA,UAAU,qBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,+BAGtD,6BACE,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,4BAA6BkpB,eAAc,+BAE5DwmD,GAAuB,kBAACniC,GAAD,CACtB/K,YAAaktC,EACbxzE,KAAK,WACLkxC,WAAYzwC,KAAKwyE,2BAIzB,yBAAKrmD,UAAU,OACf,yBAAKA,UAAU,qBACb,uBAAGqJ,KAAK,IAAIrJ,UAAU,qBAAqBE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM4iE,aACzF,uBAAG7mD,UAAU,kBAAb,eADF,KACsD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBACtEkpB,eAAc,6BAElB,uBAAGiJ,KAAK,IAAIrJ,UAAU,qBAAqBE,QAAU5lB,IAAOzG,KAAK0yE,oBAAoBjsE,KACnF,uBAAG0lB,UAAU,kBAAb,UADF,KACiD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,wBACjEkpB,eAAc,sCAGpB,yBAAKJ,UAAU,OACf,yBAAKA,UAAU,qBACb,6BACE,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,4BAA6BkpB,eAAc,4CAInE,yBAAKJ,UAAU,UACb,sCAAW,wBAAIA,UAAU,YACvBE,QAASrsB,KAAKm5C,8BAA8B5pB,KAAKvvB,KAAM,SAAUA,KAAKu7B,MAAM/W,OAC9E,sCAAW,wBAAI2H,UAAU,YACvBE,QAASrsB,KAAKm5C,8BAA8B5pB,KAAKvvB,KAAM,SAAUA,KAAKu7B,MAAM8b,SAGjFr3C,KAAKu7B,MAAM+2C,aAAe,EACzB,oCACE,yBAAKnmD,UAAU,OACf,yBAAKA,UAAU,kBACb,uBAAGA,UAAU,kBAAb,SADF,IAEE,uBAAGqJ,KAAK,IAAIrJ,UAAU,OAAOE,QAAU5lB,IAAOA,EAAEwqB,iBAAkBjxB,KAAKoQ,MAAM6iE,kBAC3E,kBAAC,EAAA3mD,iBAAD,CAAkBjpB,GAAE,wBAAyBkpB,eAAc,gFACzDpa,OAAQ,CAAEsgB,MAAOzyB,KAAKu7B,MAAM+2C,mBAIlC,QAOd,UAAej/C,EAAAA,EAAAA,YAAWg/C,IClJX,MAAMa,WAAuBpsE,IAAAA,cAC1CmlB,SACE,OACE,yBAAKE,UAAU,oBACb,yBAAKA,UAAU,qBACb,uBAAGqJ,K7EwFkB,0B6ExFKrJ,UAAU,cAAcze,OAAO,UACvD,uBAAGye,UAAU,kBAAb,SADF,KACgD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,kBAChEkpB,eAAc,iCAElB,uBAAGiJ,K7E0FwB,+B6E1FKrJ,UAAU,cAAcze,OAAO,UAC7D,uBAAGye,UAAU,kBAAb,eADF,KACsD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,wBACtEkpB,eAAc,uCAElB,uBAAGiJ,K7EmFsB,iC6EnFKrJ,UAAU,cAAcze,OAAO,UAC3D,uBAAGye,UAAU,kBAAb,UADF,KACiD,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,sBACjEkpB,eAAc,sCAGpB,yBAAKJ,UAAU,OACf,yBAAKA,UAAU,qBACb,yBAAKA,UAAU,kBACb,2BAAOA,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,8BAE1EG,IAEH,yBAAKP,UAAU,kBACb,2BAAOA,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,2BACvER,GAAAA,OAAAA,cAEH,yBAAKI,UAAU,kBACb,2BAAOA,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,8BAE1EvsB,KAAKoQ,MAAMuzD,eAEd,yBAAKx3C,UAAU,kBACb,2BAAOA,UAAU,SAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,sCAClFvsB,KAAKoQ,MAAMwzD,kBCnCT,MAAMuP,WAAkBrsE,IAAAA,UACrChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXg1C,MAAOngE,EAAMmgE,MACbC,SAAU,GACV4C,SAAUhjE,EAAMwzD,cAChBgN,UAAWxgE,EAAMijE,SAEnBrzE,KAAK6wE,kBAAoB7wE,KAAK6wE,kBAAkBthD,KAAKvvB,MACrDA,KAAK8wE,qBAAuB9wE,KAAK8wE,qBAAqBvhD,KAAKvvB,MAC3DA,KAAKixE,sBAAwBjxE,KAAKixE,sBAAsB1hD,KAAKvvB,MAC7DA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAG7C6wE,kBAAkBpqE,GAChBzG,KAAK48B,SAAS,CAAC2zC,MAAO9pE,EAAEiH,OAAOnL,QAGjCuuE,qBAAqBrqE,GACnBzG,KAAK48B,SAAS,CAAC4zC,SAAU/pE,EAAEiH,OAAOnL,QAGpC0uE,wBACEjxE,KAAKoQ,MAAMkjE,qBAAqBtzE,KAAKu7B,MAAMq1C,WAC3C5wE,KAAK48B,SAAS,CAACg0C,WAAY5wE,KAAKu7B,MAAMq1C,YAGxCxlC,aAAa3kC,GACXA,EAAEwqB,iBACFjxB,KAAKoQ,MAAMmjE,QAAQvzE,KAAKu7B,MAAMg1C,MAAMv6C,OAAQh2B,KAAKu7B,MAAMi1C,SAASx6C,QAGlE/J,SACE,IAAIklD,EAAgB,UAKpB,OAJInxE,KAAKoQ,MAAM+wD,WACbgQ,GAAiB,aAIjB,0BAAM9tE,GAAG,aAAawoC,SAAU7rC,KAAKorC,cACnC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,2BAG/C6kD,GAAiB,2BAAO7xE,KAAK,OAAO8D,GAAG,aACtCwiC,YAAaurC,EACbzgC,aAAa,WACb6iC,YAAY,MACZC,eAAe,OACflxE,MAAOvC,KAAKu7B,MAAMg1C,MAClBzqC,SAAU9lC,KAAK6wE,kBACf7qC,UAAQ,EAACC,WAAS,MAGtB,kBAAC,EAAA3Z,iBAAD,CAAkBjpB,GAAE,kBAAmBkpB,eAAc,8BAGlD8kD,GAAoB,kBAAChhC,GAAD,CAAiB9wC,KAAK,WAAW8D,GAAG,gBACvDwiC,YAAawrC,EACb1gC,aAAa,mBACbpuC,MAAOvC,KAAKu7B,MAAMi1C,SAClB1qC,SAAU9lC,KAAK8wE,qBACf9qC,UAAU,MAGd,yBAAK7Z,UAAU,kBACb,kBAAC6b,GAAD,CAAU3kC,GAAG,aAAa/D,KAAK,aAAa4oC,QAASloC,KAAKu7B,MAAMq1C,UAC9D9qC,SAAU9lC,KAAKixE,wBACjB,2BAAOxpC,QAAQ,cAAf,IACE,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,qCAGtD,uBAAGiJ,KAAK,UACN,kBAAC,EAAAlJ,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,wCAI9D,yBAAKJ,UAAU,kBACb,4BAAQA,UAAWglD,EAAe5xE,KAAK,UACrC,kBAAC,EAAA+sB,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,iCCtFhE,MAAMsB,IAAWC,EAAAA,EAAAA,gBAAe,CAC9B4lD,WAAY,CACVrwE,GAAI,mBACJkpB,eAAgB,CAAF,gCAKlB,MAAMonD,WAAqB7sE,IAAAA,cACzBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXq4C,QAAS,IAGX5zE,KAAKioC,aAAejoC,KAAKioC,aAAa1Y,KAAKvvB,MAC3CA,KAAK+gE,eAAiB/gE,KAAK+gE,eAAexxC,KAAKvvB,MAC/CA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAG7CioC,aAAaxhC,GACXzG,KAAK48B,SAAS,CAACg3C,QAASntE,EAAEiH,OAAOnL,QAGnCw+D,eAAet6D,GACC,UAAVA,EAAER,KACJjG,KAAKorC,aAAa3kC,GAItB2kC,aAAa3kC,GAEX,GADAA,EAAEwqB,iBACEjxB,KAAKu7B,MAAMq4C,QAAS,CACtB,MAAMt0E,EAAOU,KAAKu7B,MAAMq4C,QAAQ59C,OAC1B86B,EAASxxD,EAAK6C,OAAO,EAAG,GAC1B7C,EAAKe,OAAS,GAAK,CAAC,MAAO,MAAO,OAAO2M,SAAS8jD,GACpD9wD,KAAKoQ,MAAMy7B,SAASvsC,GAEpBU,KAAKoQ,MAAMshB,QAAQ1xB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAAS6lD,YAAa,QAK7EznD,SACE,OACE,yBAAKE,UAAU,cACb,yBAAKA,UAAU,kBACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,sCAEvDgd,GAAW,2BAAOhqC,KAAK,OAAOsmC,YAAa0D,EAC1ChnC,MAAOvC,KAAKu7B,MAAMq4C,QAAS9tC,SAAU9lC,KAAKioC,aAC1Cg6B,WAAYjiE,KAAK+gE,eAAgB/6B,UAAQ,EAACC,WAAS,OAGvD,yBAAK9Z,UAAU,kBACb,4BAAQA,UAAU,UAAUE,QAASrsB,KAAKorC,cACxC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,mCASlE,UAAe8G,EAAAA,EAAAA,YAAWsgD,IC5DX,MAAME,WAAsB/sE,IAAAA,cACzChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAK2yC,SAAW7rC,IAAAA,YAEhB9G,KAAKu7B,MAAQ,CACXoX,SAAU,GACV7O,QAAS,GACT8O,YAAa,GACb89B,aAAc,KACdj/B,KAAM,GACN1O,WAAW,GAGb/iC,KAAK8zE,gBAAkB9zE,KAAK8zE,gBAAgBvkD,KAAKvvB,MACjDA,KAAK+4C,mBAAqB/4C,KAAK+4C,mBAAmBxpB,KAAKvvB,MACvDA,KAAK+zE,kBAAoB/zE,KAAK+zE,kBAAkBxkD,KAAKvvB,MACrDA,KAAKg0E,oBAAsBh0E,KAAKg0E,oBAAoBzkD,KAAKvvB,MACzDA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAG7C4wB,qBAIAkjD,gBAAgBx0E,EAAMmH,GACpBzG,KAAK48B,SAAS,CAAC,CAACt9B,GAAOmH,EAAEiH,OAAOnL,OAAS,KAG3Cw2C,mBAAmBnf,GACjB55B,KAAK48B,SAAS,CAAC8zC,aAAc92C,IAG/Bm6C,kBAAkBtiC,GAChBzxC,KAAK48B,SAAS,CAAC6U,KAAMA,IAGvBuiC,sBACEh0E,KAAK48B,SAAS,CAACmG,WAAY/iC,KAAKu7B,MAAMwH,YAGxCqI,aAAa3kC,GACXA,EAAEwqB,iBAEF,MAAM/T,EAAKld,KAAKu7B,MAAMoX,SAAS3c,OAAOtb,UAAU,EAAG4S,IAC7C4V,EAAUljC,KAAKu7B,MAAMuI,QAAQ9N,OAAOtb,UAAU,EAAG4S,IACjDslB,EAAc5yC,KAAKu7B,MAAMqX,YAAY5c,OAAOtb,UAAU,EAAG6S,IAC3DrQ,GACFld,KAAKoQ,MAAMy7B,SAAS3uB,EAAI01B,EAAa5yC,KAAKu7B,MAAMm1C,aAAcxtC,EAASljC,KAAKu7B,MAAMkW,KAAMzxC,KAAKu7B,MAAMwH,WAIvG9W,SACE,IAAIklD,EAAgB,UAIpB,OAHInxE,KAAKoQ,MAAM+wD,WACbgQ,GAAiB,aAGjB,0BAAMhlD,UAAU,aAAa0f,SAAU7rC,KAAKorC,cAC1C,yBAAKjf,UAAU,qBACb,gCACE,kBAAC8a,GAAD,CACE1W,OAAQvwB,KAAKoQ,MAAMmgB,OACnBmB,QAAS1xB,KAAKoQ,MAAMshB,QACpB4/C,eAAgBtxE,KAAK+4C,sBAEzB,yBAAK5sB,UAAU,SACb,2BAAOA,UAAU,QAAQsb,QAAQ,gBAC/B,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,mBAAoBkpB,eAAc,2BAGxD,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,iCAAkCkpB,eAAc,gDAEjEsZ,GAAgB,2BAAOtmC,KAAK,OAAO8D,GAAG,eAAewiC,YAAaA,EACjEzS,IAAKpzB,KAAK2yC,SAAUpwC,MAAOvC,KAAKu7B,MAAMoX,SAAU7M,SAAU9lC,KAAK8zE,gBAAgBvkD,KAAKvvB,KAAM,YAC1FimC,WAAS,EAACD,UAAQ,EAACqE,SAAU,OAGnC,yBAAKle,UAAU,SACb,2BAAOA,UAAU,QAAQsb,QAAQ,kBAC/B,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,sCAGrD,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,8BAA+BkpB,eAAc,yCAE9DsZ,GAAgB,2BAAOtmC,KAAK,OAAO8D,GAAG,iBAAiBwiC,YAAaA,EACnEtjC,MAAOvC,KAAKu7B,MAAMuI,QAASgC,SAAU9lC,KAAK8zE,gBAAgBvkD,KAAKvvB,KAAM,WAAYqqC,SAAU,OAGjG,yBAAKle,UAAU,SACb,2BAAOA,UAAU,QAAQsb,QAAQ,kBAC/B,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,kCAGzD,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,kCAAmCkpB,eAAc,4CAElEsZ,GAAgB,2BAAOtmC,KAAK,OAAO8D,GAAG,iBAAiBwiC,YAAaA,EACnEtjC,MAAOvC,KAAKu7B,MAAMqX,YAAa9M,SAAU9lC,KAAK8zE,gBAAgBvkD,KAAKvvB,KAAM,eAAgBqqC,SAAU,QAI3G,yBAAKle,UAAU,kBACb,kBAAC6b,GAAD,CAAUE,QAASloC,KAAKu7B,MAAMwH,UAAWsH,SAAU,EAAGvE,SAAU9lC,KAAKg0E,sBADvE,IAEE,2BAAO3nD,QAASrsB,KAAKg0E,qBAAqB,kBAAC,EAAA1nD,iBAAD,CAAkBjpB,GAAE,iBAC5DkpB,eAAc,yCAGlB,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,oBAAqBkpB,eAAc,+CAEpDrE,GAAU,kBAACspB,GAAD,CACTjhB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBkhB,KAAMzxC,KAAKu7B,MAAMkW,KACjBE,WAAW,EACXS,cAAepyC,KAAK+zE,kBACpB1pC,SAAU,EACVniB,MAAOA,MAEX,yBAAKiE,UAAU,kBACb,4BAAQA,UAAWglD,GACjB,kBAAC,EAAA7kD,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,gCCnH/D,MAAMsB,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BmmD,oBAAqB,CACnB5wE,GAAI,sBACJkpB,eAAgB,CAAF,+CAGhB2nD,kBAAmB,CACjB7wE,GAAI,oBACJkpB,eAAgB,CAAF,8CAGhBoa,mBAAoB,CAClBtjC,GAAI,qBACJkpB,eAAgB,CAAF,2EAKlB,MAAM4nD,WAAqBrtE,IAAAA,UACzBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX64C,YAAa,OACbC,YAAa,MAGfr0E,KAAKs0E,eAAiBt0E,KAAKs0E,eAAe/kD,KAAKvvB,MAC/CA,KAAKomC,qBAAuBpmC,KAAKomC,qBAAqB7W,KAAKvvB,MAC3DA,KAAKu0E,2BAA6Bv0E,KAAKu0E,2BAA2BhlD,KAAKvvB,MACvEA,KAAKw0E,qBAAuBx0E,KAAKw0E,qBAAqBjlD,KAAKvvB,MAC3DA,KAAKy0E,gBAAkBz0E,KAAKy0E,gBAAgBllD,KAAKvvB,MAGnD4wB,oBACE5wB,KAAKoQ,MAAMk2B,aAGbguC,eAAe7tE,GACbA,EAAEwqB,iBACF6yC,GAAekG,WAAWlG,GAAe4Q,YAAYhuE,OAAO8kD,SAAS12B,KAAM,MAAOruB,EAAE8qB,cAAcC,QAAQnuB,KAC1GrD,KAAK48B,SAAS,CAACw3C,YAAa3tE,EAAE8qB,cAAcC,QAAQnuB,KAGtD+iC,qBAAqBR,GACnB5lC,KAAKoQ,MAAMu1B,iBAAiBC,GAC5B5lC,KAAK48B,SAAS,CAACy3C,YAAatoD,GAAAA,OAAAA,YAAmB6Z,GAAS,KAAOA,IAGjE2uC,2BAA2Bj1E,GACK,QAA1BU,KAAKu7B,MAAM64C,cACbtQ,GAAekG,WAAWlG,GAAe6Q,eAAejuE,OAAO8kD,SAAS12B,KAAM,QAC9E90B,KAAKoQ,MAAMwkE,cAAct1E,IAI7Bk1E,qBAAqBl1E,EAAMszC,EAAaiiC,EAASC,EAAMrjC,EAAM1O,GAC3D+gC,GAAekG,WAAWlG,GAAe6Q,eAAejuE,OAAO8kD,SAAS12B,KAAM,QAC9E90B,KAAKoQ,MAAMwkE,mBAAc5zE,EACvB,CAACgjC,OAAQrO,GAAQr2B,EAAMu1E,EAAS,KAAMjiC,GAAc9O,QAASgxC,EAAMrjC,KAAMA,GAAO1O,GAGpF0xC,gBAAgBpkD,GACdyzC,GAAekG,WAAWlG,GAAe6Q,eAAejuE,OAAO8kD,SAAS12B,KAAM,QAC9E90B,KAAKoQ,MAAMwkE,cAAcvkD,GAG3BpE,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KAC7B0lD,EAA0B3lD,EAAcpvB,KAAKu7B,MAAM84C,YACvDxmD,GAASqmD,kBAAoBrmD,GAASomD,qBAClCttC,EAAqBvX,EAAcvB,GAAS8Y,oBAClD,OACE,yBAAKxa,UAAU,eACb,wBAAIA,UAAU,UACZ,wBAAIA,UAAsC,SAA3BnsB,KAAKu7B,MAAM64C,YAAyB,SAAW,MAC5D,uBAAG5+C,KAAK,IAAI,UAAQ,OAAOnJ,QAASrsB,KAAKs0E,gBACvC,kBAAC,EAAAhoD,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,4BAI5D,wBAAIJ,UAAsC,QAA3BnsB,KAAKu7B,MAAM64C,YAAwB,SAAW,MAC3D,uBAAG5+C,KAAK,IAAI,UAAQ,MAAMnJ,QAASrsB,KAAKs0E,gBACtC,kBAAC,EAAAhoD,iBAAD,CAAkBjpB,GAAE,qBAAsBkpB,eAAc,iCAI5D,wBAAIJ,UAAsC,SAA3BnsB,KAAKu7B,MAAM64C,YAAyB,SAAW,MAC5D,uBAAG5+C,KAAK,IAAI,UAAQ,OAAOnJ,QAASrsB,KAAKs0E,gBACvC,kBAAC,EAAAhoD,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,8BAKpC,QAA3BvsB,KAAKu7B,MAAM64C,YACV,kBAACP,GAAD,CACEtjD,OAAQvwB,KAAKoQ,MAAMmgB,OACnBsb,SAAU7rC,KAAKw0E,uBACU,SAA3Bx0E,KAAKu7B,MAAM64C,YACT,kBAAC,GAAD,CACEvoC,SAAU7rC,KAAKy0E,gBACf/iD,QAAS1xB,KAAKoQ,MAAMshB,UACtB,yBAAKvF,UAAU,eACb,kBAACiZ,GAAD,CACES,YAAac,EACbhB,iBAAkB3lC,KAAKomC,uBACzB,kBAAC,GAAD,CACE7V,OAAQvwB,KAAKoQ,MAAMmgB,OACnBoT,SAAU3jC,KAAKoQ,MAAMo2B,cACrBvC,SAAUjkC,KAAKoQ,MAAM6zB,SACrBkB,iBAAkB4vC,EAClBjyC,YAAY,EACZ0B,YAAY,EACZ7C,iBAAiB,EACjB+C,gBAAiB1kC,KAAKu0E,gCAOtC,UAAelhD,EAAAA,EAAAA,YAAW8gD,IC/HX,MAAMa,WAA0BluE,IAAAA,cAC7ChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXk1C,MAAO,GACPD,SAAU,GACVyE,MAAM,GAGRj1E,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAK+wE,kBAAoB/wE,KAAK+wE,kBAAkBxhD,KAAKvvB,MACrDA,KAAK8wE,qBAAuB9wE,KAAK8wE,qBAAqBvhD,KAAKvvB,MAG7D4wB,oBACE,MAAMqzC,EAASH,GAAeI,aAAax9D,OAAO8kD,SAAS12B,MAC3D90B,KAAK48B,SAAS,CAACnhB,MAAOwoD,EAAOr0C,OAAOnU,MAAOy5D,OAAQjR,EAAOr0C,OAAOslD,SAGnE9pC,aAAa3kC,GAEX,GADAA,EAAEwqB,iBACEjxB,KAAKu7B,MAAM9f,MACbzb,KAAKoQ,MAAM+kE,QAAQn1E,KAAKu7B,MAAM25C,OAAQl1E,KAAKu7B,MAAMi1C,SAASx6C,OAAQh2B,KAAKu7B,MAAM9f,YACxE,GAAIzb,KAAKu7B,MAAM05C,KACpBj1E,KAAKoQ,MAAMivB,eACN,CACL,MAAMoxC,EAAQzwE,KAAKu7B,MAAMk1C,MAAMz6C,OAC/Bh2B,KAAK48B,SAAS,CAAC6zC,MAAOA,IACtBzwE,KAAKoQ,MAAMglE,UAAU,QAAS3E,GAAOx3D,MAAK,KACxCjZ,KAAK48B,SAAS,CAACq4C,MAAM,QAK3BlE,kBAAkBtqE,GAChBzG,KAAK48B,SAAS,CAAC6zC,MAAOhqE,EAAEiH,OAAOnL,QAGjCuuE,qBAAqBrqE,GACnBzG,KAAK48B,SAAS,CAAC4zC,SAAU/pE,EAAEiH,OAAOnL,QAGpC0pB,SACE,OACE,0BAAM5oB,GAAG,sBAAsBwoC,SAAU7rC,KAAKorC,cAC1CprC,KAAKu7B,MAAM9f,OAASzb,KAAKu7B,MAAM25C,OAC/B,oCAAE,2BAAOztC,QAAQ,gBACf,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,qBAClBkpB,eAAc,mCAGlB,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,2BAA4BkpB,eAAc,wCAE3DsZ,GAAgB,kBAACwK,GAAD,CACfhtC,GAAG,eACHwiC,YAAaA,EACb8K,aAAa,eACbpuC,MAAOvC,KAAKu7B,MAAMi1C,SAClBxqC,UAAU,EAAMC,WAAW,EAC3BH,SAAU9lC,KAAK8wE,0BAEnB9wE,KAAKu7B,MAAM05C,KACX,oCACE,6BACA,gCAAQ,uBAAG9oD,UAAU,6BAAb,aACR,6BACA,gCAAQ,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,4BAC1BkpB,eAAc,mJACdpa,OAAQ,CAAEs+D,MAAO,4BAAKzwE,KAAKu7B,MAAMk1C,YAIrC,oCACE,2BAAOhpC,QAAQ,cACb,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,uBAClBkpB,eAAc,mDAGlB,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,0BAA2BkpB,eAAc,6CAE1DsZ,GAAgB,2BAAOtmC,KAAK,QAAQ8D,GAAG,aACtCwiC,YAAaA,EACb8K,aAAa,QACbpuC,MAAOvC,KAAKu7B,MAAMk1C,MAClB3qC,SAAU9lC,KAAK+wE,kBACf/qC,UAAQ,EAACC,WAAS,OAI1B,yBAAK9Z,UAAU,kBACb,4BAAQA,UAAU,UAAU5sB,KAAK,UAC9BS,KAAKu7B,MAAM9f,OAASzb,KAAKu7B,MAAM25C,OAChC,kBAAC,EAAA5oD,iBAAD,CAAkBjpB,GAAE,eAAgBkpB,eAAc,2BAChDvsB,KAAKu7B,MAAM05C,KACb,kBAAC,EAAA3oD,iBAAD,CAAkBjpB,GAAE,YAAakpB,eAAc,wBAG/C,kBAAC,EAAAD,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,sCCpGtD,MAAM8oD,WAAqBvuE,IAAAA,cACxChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX63C,SAAUhjE,EAAMwzD,cAChB0R,SAAS,GAGXt1E,KAAKu1E,qBAAuBv1E,KAAKu1E,qBAAqBhmD,KAAKvvB,MAC3DA,KAAKwwC,sBAAwBxwC,KAAKwwC,sBAAsBjhB,KAAKvvB,MAG/Du1E,qBAAqB9uE,GACnBzG,KAAK48B,SAAS,CAACw2C,SAAU3sE,EAAEiH,OAAOnL,MAAO+yE,SAAS,IAGpD9kC,wBACMxwC,KAAKu7B,MAAM+5C,UACbt1E,KAAK48B,SAAS,CAAC04C,SAAS,IACxBt1E,KAAKoQ,MAAMolE,sBAAsBx1E,KAAKu7B,MAAM63C,SAASp9C,SAIzD/J,SACE,IAAIwpD,EAAc,GAClB,IAAK,IAAIxvE,KAAO0mB,GAAa,CAC3B,IAAI0E,EAAO1E,GAAY1mB,GACvBwvE,EAAY5xE,KACV,4BAAQoC,IAAKorB,EAAM9uB,MAAO8uB,KAG9B,OACE,yBAAKlF,UAAU,kBACb,2BAAO5sB,KAAK,SAAS8D,GAAG,YAAYwiC,YAAa7lC,KAAKoQ,MAAMgjE,SAAUsC,KAAK,cACzEvpD,UAAU,SAAS5pB,MAAOvC,KAAKu7B,MAAM63C,SAAUttC,SAAU9lC,KAAKu1E,qBAC9DhrC,OAAQvqC,KAAKwwC,sBAAuBxK,UAAQ,IAC9C,8BAAU3iC,GAAG,eACVoyE,KCtCI,MAAME,WAAqB7uE,IAAAA,cACxChH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACXq6C,UAAWxlE,EAAMwlE,WAAa,MAC9BhS,cAAexzD,EAAMwzD,eAGvB5jE,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAK61E,wBAA0B71E,KAAK61E,wBAAwBtmD,KAAKvvB,MACjEA,KAAK81E,0BAA4B91E,KAAK81E,0BAA0BvmD,KAAKvvB,MAGvEorC,aAAa3kC,GACXA,EAAEwqB,iBACFjxB,KAAKoQ,MAAM2lE,SAAS,CAClBH,UAAW51E,KAAKu7B,MAAMq6C,UACtBhS,cAAe5jE,KAAKu7B,MAAMqoC,gBAI9BiS,wBAAwBpvE,GACtBzG,KAAK48B,SAAS,CAACg5C,UAAWnvE,EAAE8qB,cAAchvB,QAG5CuzE,0BAA0Bx2E,GACxBU,KAAK48B,SAAS,CAACgnC,cAAetkE,IAGhC2sB,SACE,MAAMsgB,EAAQ,CAACypC,IAAK,UAAWC,GAAI,YAAaC,GAAI,gBAC9CC,EAAmB,GAczB,MAbA,CAAC,MAAO,KAAM,MAAM7jE,KAAK+e,IACvB,MAAMhuB,EAAK,aAAeguB,EACpB/xB,EAAOitC,EAAMlb,GACnB8kD,EAAiBtyE,KACf,wBAAIoC,IAAKorB,GACP,2BAAO9xB,KAAK,QAAQ8D,GAAIA,EAAI/D,KAAK,mBAAmBiD,MAAO8uB,EACzD6W,QAASloC,KAAKu7B,MAAMq6C,YAAcvkD,EAClCyU,SAAU9lC,KAAK61E,0BACjB,2BAAOpuC,QAASpkC,GAAK/D,QAMzB,0BAAM+D,GAAG,gBAAgB8oB,UAAU,aAAa0f,SAAU7rC,KAAKorC,cAC7D,yBAAKjf,UAAU,kBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,sBAAuBkpB,eAAc,sCAI7D,kBAAC8oD,GAAD,CAAczR,cAAe5jE,KAAKu7B,MAAMqoC,cACtC4R,sBAAuBx1E,KAAK81E,4BAC9B,yBAAK3pD,UAAU,kBACb,2BAAOA,UAAU,SACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,uBAAwBkpB,eAAc,uCAI9D,yBAAKJ,UAAU,kBACb,wBAAIA,UAAU,UACXgqD,IAGL,yBAAKhqD,UAAU,kBACb,4BAAQ5sB,KAAK,SAAS4sB,UAAU,WAC9B,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,gCCvE/D,MAAMsB,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BsoD,MAAO,CACL/yE,GAAI,eACJkpB,eAAgB,CAAF,yBAGhBkkD,MAAO,CACLptE,GAAI,eACJkpB,eAAgB,CAAF,2BAKlB,MAAM8pD,WAAuBvvE,IAAAA,cAC3BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKu7B,MAAQ,CACX5vB,KAAMyE,EAAMkmE,UAAY,IAG1Bt2E,KAAKioC,aAAejoC,KAAKioC,aAAa1Y,KAAKvvB,MAC3CA,KAAK+gE,eAAiB/gE,KAAK+gE,eAAexxC,KAAKvvB,MAC/CA,KAAKorC,aAAeprC,KAAKorC,aAAa7b,KAAKvvB,MAC3CA,KAAK2oC,aAAe3oC,KAAK2oC,aAAapZ,KAAKvvB,MAG7CioC,aAAaxhC,GACXzG,KAAK48B,SAAS,CAACjxB,KAAMlF,EAAEiH,OAAOnL,QAGhCw+D,eAAet6D,GACC,UAAVA,EAAER,IACJjG,KAAKorC,aAAa3kC,GACA,UAATA,EAAER,KACXjG,KAAK2oC,aAAaliC,GAItB2kC,aAAa3kC,GACXA,EAAEwqB,iBACEjxB,KAAKu7B,MAAM5vB,MAAQ3L,KAAKu7B,MAAM5vB,KAAKqqB,QACrCh2B,KAAKoQ,MAAMy7B,SAAS7rC,KAAKoQ,MAAMmmE,WAAYv2E,KAAKu7B,MAAM5vB,KAAKqqB,QAI/D2S,aAAaliC,GACXA,EAAEwqB,iBACFjxB,KAAKoQ,MAAMivB,WAIbpT,SACE,MAAM,cAAEmD,GAAkBpvB,KAAKoQ,MAAMif,KAErC,IAAIza,EADY,CAAC,MAASwa,EAAcvB,GAAS4iD,OAAQ,IAAOrhD,EAAcvB,GAASuoD,QAClEp2E,KAAKoQ,MAAMmmE,aAAev2E,KAAKoQ,MAAMmmE,WAC1D,OACE,yBAAKpqD,UAAU,cACb,yBAAKA,UAAU,kBACb,2BAAOA,UAAU,QAAQsb,QAAQ,2BAC/B,kBAAC,EAAAnb,iBAAD,CAAkBjpB,GAAE,iCAClBkpB,eAAc,sGAEdpa,OAAQ,CAACyC,OAAQA,OAGvB,yBAAKuX,UAAU,kBACf,kBAAC,EAAAG,iBAAD,CAAkBjpB,GAAE,mCAClBkpB,eAAc,kCACbiqD,GAAiB,2BAAOj3E,KAAK,OAAO8D,GAAG,0BACtCwiC,YAAa2wC,EACbj0E,MAAOvC,KAAKu7B,MAAM5vB,KAAMm6B,SAAU9lC,KAAKioC,aACvCg6B,WAAYjiE,KAAK+gE,eAAgB/6B,UAAQ,OAG7C,yBAAK7Z,UAAU,kBACb,4BAAQA,UAAU,YAAYE,QAASrsB,KAAK2oC,cAC1C,kBAAC,EAAArc,iBAAD,CAAkBjpB,GAAE,gBAAiBkpB,eAAc,6BAErD,4BAAQJ,UAAU,UAAUE,QAASrsB,KAAKorC,cACxC,kBAAC,EAAA9e,iBAAD,CAAkBjpB,GAAE,iBAAkBkpB,eAAc,iCAQhE,UAAe8G,EAAAA,EAAAA,YAAWgjD,ICvEpBxoD,IAAWC,EAAAA,EAAAA,gBAAe,CAC9ByiD,MAAO,CACLltE,GAAI,wBAEJkpB,eAAgB,CAAF,2BAEhB9C,SAAU,CACRpmB,GAAI,2BAEJkpB,eAAgB,CAAF,kCAEhBkqD,SAAU,CACRpzE,GAAI,2BAEJkpB,eAAgB,CAAF,4BAEhBmqD,KAAM,CACJrzE,GAAI,mCAEJkpB,eAAgB,CAAF,oCAEhBgrB,QAAS,CACPl0C,GAAI,sBAEJkpB,eAAgB,CAAF,2BAEhBirB,SAAU,CACRn0C,GAAI,uBAEJkpB,eAAgB,CAAF,4BAEhBkrB,KAAM,CACJp0C,GAAI,mBAEJkpB,eAAgB,CAAF,kCAEhBoqD,MAAO,CACLtzE,GAAI,oCAEJkpB,eAAgB,CAAF,iCAEhBqqD,QAAS,CACPvzE,GAAI,8BAEJkpB,eAAgB,CAAF,2BAEhBsqD,OAAQ,CACNxzE,GAAI,yBAEJkpB,eAAgB,CAAF,kCAEhBmpB,KAAM,CACJryC,GAAI,uBAEJkpB,eAAgB,CAAF,uCAEhBuqD,MAAO,CACLzzE,GAAI,wBAEJkpB,eAAgB,CAAF,kCAEhBuC,QAAS,CACPzrB,GAAI,0BAEJkpB,eAAgB,CAAF,kCAEhBkjD,QAAS,CACPpsE,GAAI,0BAEJkpB,eAAgB,CAAF,mCAIlB,MAAMwqD,WAAsBjwE,IAAAA,UAC1BhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKg3E,eAAiBh3E,KAAKg3E,eAAeznD,KAAKvvB,MAGjDg3E,iBACEh3E,KAAKoQ,MAAMgsC,WAAW,UAGxBnwB,SACE,MAAM,cAACmD,GAAiBpvB,KAAKoQ,MAAMif,KAC7BmtB,EAAOx8C,KAAKoQ,MAAMmrB,QAAUv7B,KAAKoQ,MAAM6zB,SAAW,WAAa,SAErE,IAAI/b,EAAOwP,EAAQlE,EAWf6L,EAKJ,MAfY,YAARmd,GACFt0B,EAAQloB,KAAKoQ,MAAM8X,MACnBwP,GAAS13B,KAAKoQ,MAAMsnB,QAAS13B,KAAKoQ,MAAMsnB,OACxClE,EAASxzB,KAAKoQ,MAAM23B,gBAEpB7f,EAAQkH,EAAcvB,GAAS2uB,IAC/B9kB,GAAS,EACTlE,EAAS,OAIiC,GAAxC,CAAC,QAAS,YAAY4C,QAAQomB,KAChCnd,EAAWr/B,KAAKoQ,MAAMivB,UAItB,yBAAKh8B,GAAG,YAAY8oB,UAAWnsB,KAAKoQ,MAAMg8D,SAAW,YAAc,MACjE,kBAAC2C,GAAD,CACExzC,MAAOihB,EACPt0B,MAAOA,EACPwP,OAAQA,EACRnH,OAAQvwB,KAAKoQ,MAAMmgB,OACnBwX,cAAevU,EACfyQ,SAAUjkC,KAAKoQ,MAAM6zB,SACrB6qC,SAAU9uE,KAAKoQ,MAAM0+D,SACrBF,WAAY5uE,KAAKoQ,MAAMw+D,WACvBD,WAAY3uE,KAAKg3E,eACjB33C,SAAUA,IAEZ,kBAAC+I,GAAD,CACEC,MAAOroC,KAAKoQ,MAAMwsC,WAClBrU,KAAMvoC,KAAKoQ,MAAMysC,UACjBzZ,OAAQpjC,KAAKoQ,MAAM6mE,YACnBxuC,WAAYzoC,KAAKoQ,MAAM8mE,gBACvB5uC,aAActoC,KAAKoQ,MAAMshB,UAE3B,kBAACmV,GAAD,CAAaG,KAAMhnC,KAAKoQ,MAAM+mE,qBAEpB,UAAT36B,EACC,kBAAC22B,GAAD,CACE5C,MAAOvwE,KAAKoQ,MAAMmgE,MAClBpP,SAAUnhE,KAAKoQ,MAAMgnE,cACrB/D,QAASrzE,KAAKoQ,MAAMijE,QACpBE,QAASvzE,KAAKoQ,MAAMinE,eACpB/D,oBAAqBtzE,KAAKoQ,MAAMkjE,sBAEzB,aAAT92B,EACA,kBAAC8zB,GAAD,CACE//C,OAAQvwB,KAAKoQ,MAAMmgB,OACnB2gD,gBAAiBlxE,KAAKoQ,MAAM8gE,gBAC5B7xC,SAAUr/B,KAAKoQ,MAAMivB,SACrB3N,QAAS1xB,KAAKoQ,MAAMshB,UAEb,aAAT8qB,EACA,kBAACm5B,GAAD,CACEC,UAAW51E,KAAKoQ,MAAMwlE,UACtBhS,cAAe5jE,KAAKoQ,MAAMwzD,cAC1BvkC,SAAUr/B,KAAKoQ,MAAMivB,SACrB02C,SAAU/1E,KAAKoQ,MAAMknE,mBAEd,SAAT96B,EACA,kBAACyyB,GAAD,CACE1+C,OAAQvwB,KAAKoQ,MAAMmgB,OACnB0T,SAAUjkC,KAAKoQ,MAAM6zB,SACrB8D,cAAe/nC,KAAKoQ,MAAM23B,cAC1BqU,WAAYp8C,KAAKoQ,MAAMgsC,aAEf,YAATI,GAA+B,SAATA,EACvB,kBAAChI,GAAD,CACElkB,MAAM,KACNC,OAAQvwB,KAAKoQ,MAAMmgB,OACnB0T,SAAUjkC,KAAKoQ,MAAM6zB,SACrByP,kBAAmB1zC,KAAKoQ,MAAMyiE,oBAC9B3+B,aAAcl0C,KAAKoQ,MAAMmnE,oBACzB/hC,UAAWx1C,KAAKoQ,MAAMolC,UACtBM,aAAc91C,KAAKoQ,MAAM0lC,aACzBD,cAAe71C,KAAKoQ,MAAMylC,cAC1BnkB,QAAS1xB,KAAKoQ,MAAMshB,UAEb,UAAT8qB,EACA,kBAAC,GAAD,CACEu1B,cAAe/xE,KAAKoQ,MAAM2hE,cAC1BE,cAAejyE,KAAKoQ,MAAM6hE,cAC1BD,qBAAsBhyE,KAAKoQ,MAAM4hE,qBACjCE,cAAelyE,KAAKoQ,MAAM8hE,cAC1BL,0BAA2B7xE,KAAKoQ,MAAMyhE,0BACtCD,sBAAuB5xE,KAAKoQ,MAAMwhE,sBAClCE,sBAAuB9xE,KAAKoQ,MAAM0hE,wBAE3B,aAATt1B,EACA,kBAAC,GAAD,CACEjsB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBsiD,oBAAqB7yE,KAAKoQ,MAAMyiE,oBAChCD,iBAAkB5yE,KAAKoQ,MAAMwiE,iBAC7BI,SAAUhzE,KAAKoQ,MAAM4iE,SACrBF,gBAAiB9yE,KAAKoQ,MAAM0iE,gBAC5BhjD,YAAa9vB,KAAKoQ,MAAM0f,YACxBmjD,cAAejzE,KAAKoQ,MAAM6iE,gBAEnB,YAATz2B,EACA,kBAAC02B,GAAD,CACEtP,cAAe5jE,KAAKoQ,MAAMwzD,cAC1BD,cAAe3jE,KAAKoQ,MAAMuzD,gBAElB,aAATnnB,GAA+B,WAARA,GAA6B,WAARA,EAC7C,kBAAC4yB,GAAD,CACE7+C,OAAQvwB,KAAKoQ,MAAMmgB,OACnB0T,SAAUjkC,KAAKoQ,MAAM6zB,SACrBQ,UAAWzkC,KAAKoQ,MAAMq0B,UACtBjB,cAAexjC,KAAKoQ,MAAMozB,cAC1B1U,QAAiB,WAAR0tB,EACTizB,QAAiB,WAARjzB,EACTgzB,SAAUxvE,KAAKoQ,MAAMo/D,SACrB7tC,gBAAiB3hC,KAAKoQ,MAAMuxB,gBAC5B+C,gBAAiB1kC,KAAKoQ,MAAMs0B,gBAC5BmrC,cAAe7vE,KAAKoQ,MAAMy/D,gBAEnB,WAATrzB,EACA,kBAAC,GAAD,CACEjsB,OAAQvwB,KAAKoQ,MAAMmgB,OACnBiW,cAAexmC,KAAKoQ,MAAMo2B,cAC1BF,WAAYtmC,KAAKoQ,MAAMk2B,WACvBX,iBAAkB3lC,KAAKoQ,MAAMu1B,iBAC7BivC,cAAe50E,KAAKoQ,MAAMwkE,cAC1BljD,QAAS1xB,KAAKoQ,MAAMshB,UAEb,SAAT8qB,EACA,kBAAC,GAAD,CACE85B,SAAUt2E,KAAKoQ,MAAMkmE,SACrBC,WAAYv2E,KAAKoQ,MAAMmmE,WACvB1qC,SAAU7rC,KAAKoQ,MAAMonE,sBACrBn4C,SAAUr/B,KAAKoQ,MAAMivB,SACrB3N,QAAS1xB,KAAKoQ,MAAMshB,UAEb,UAAT8qB,EACA,kBAACw4B,GAAD,CACEI,UAAWp1E,KAAKoQ,MAAMqnE,uBACtBtC,QAASn1E,KAAKoQ,MAAMsnE,gBACpBr4C,SAAUr/B,KAAKoQ,MAAMivB,WACvB,OAMV,UAAehM,EAAAA,EAAAA,YAAW0jD,IC5PnB,SAASY,KACd,IAAIC,EAAO9qD,GAQX,MAP8B,iBAAnBpmB,OAAO8kD,WACgB,SAA5B9kD,OAAO8kD,SAASqsB,UAAmD,aAA5BnxE,OAAO8kD,SAASssB,SACzDF,EAAOjrD,GAAYE,MACVnmB,OAAO8kD,SAASssB,WACzBF,EAAOlxE,OAAO8kD,SAASssB,UAAYpxE,OAAO8kD,SAASusB,KAAO,IAAMrxE,OAAO8kD,SAASusB,KAAO,MAGpFH,EAIF,SAASI,KACd,MAA8B,iBAAnBtxE,OAAO8kD,UACmB,UAA5B9kD,OAAO8kD,SAASqsB,SCc3B,MAAMI,GAAY,IAAIp7C,MAAM,iBAEtBhP,IAAWC,EAAAA,EAAAA,gBAAe,CAC9BoqD,oBAAqB,CACnB70E,GAAI,sBACJkpB,eAAgB,CAAF,8FAGhB4rD,cAAe,CACb90E,GAAI,gBACJkpB,eAAgB,CAAF,2BAGhB6rD,iBAAkB,CAChB/0E,GAAI,mBACJkpB,eAAgB,CAAF,2DAGhB8rD,uBAAwB,CACtBh1E,GAAI,yBACJkpB,eAAgB,CAAF,0CAGhB+rD,cAAe,CACbj1E,GAAI,gBACJkpB,eAAgB,CAAF,iCAGhBgsD,mBAAoB,CAClBl1E,GAAI,qBACJkpB,eAAgB,CAAF,uCAGhBisD,eAAgB,CACdn1E,GAAI,iBACJkpB,eAAgB,CAAF,wBAGhBksD,qBAAsB,CACpBp1E,GAAI,uBACJkpB,eAAgB,CAAF,gCAKlB,MAAMmsD,WAAkB5xE,IAAAA,UACtBhH,YAAYsQ,GACVvE,MAAMuE,GAENpQ,KAAKmvB,QAAUroB,IAAAA,YAEf9G,KAAKu7B,MAAQv7B,KAAK24E,gBAElB34E,KAAK44E,aAAe54E,KAAK44E,aAAarpD,KAAKvvB,MAC3CA,KAAK64E,gBAAkB74E,KAAK64E,gBAAgBtpD,KAAKvvB,MACjDA,KAAK84E,aAAe94E,KAAK84E,aAAavpD,KAAKvvB,MAC3CA,KAAK+4E,kBAAoB/4E,KAAK+4E,kBAAkBxpD,KAAKvvB,MACrDA,KAAKg5E,sBAAwBh5E,KAAKg5E,sBAAsBzpD,KAAKvvB,MAC7DA,KAAKk8B,YAAcl8B,KAAKk8B,YAAY3M,KAAKvvB,MACzCA,KAAKi5E,mBAAqBj5E,KAAKi5E,mBAAmB1pD,KAAKvvB,MACvDA,KAAKk5E,wBAA0Bl5E,KAAKk5E,wBAAwB3pD,KAAKvvB,MACjEA,KAAKm5E,gBAAkBn5E,KAAKm5E,gBAAgB5pD,KAAKvvB,MACjDA,KAAKo5E,6BAA+Bp5E,KAAKo5E,6BAA6B7pD,KAAKvvB,MAC3EA,KAAKq5E,QAAUr5E,KAAKq5E,QAAQ9pD,KAAKvvB,MACjCA,KAAKs5E,yBAA2Bt5E,KAAKs5E,yBAAyB/pD,KAAKvvB,MACnEA,KAAKu5E,sBAAwBv5E,KAAKu5E,sBAAsBhqD,KAAKvvB,MAC7DA,KAAKw5E,iBAAmBx5E,KAAKw5E,iBAAiBjqD,KAAKvvB,MACnDA,KAAKy5E,aAAez5E,KAAKy5E,aAAalqD,KAAKvvB,MAC3CA,KAAK05E,kBAAoB15E,KAAK05E,kBAAkBnqD,KAAKvvB,MACrDA,KAAK25E,gBAAkB35E,KAAK25E,gBAAgBpqD,KAAKvvB,MACjDA,KAAK45E,iBAAmB55E,KAAK45E,iBAAiBrqD,KAAKvvB,MACnDA,KAAK65E,OAAS75E,KAAK65E,OAAOtqD,KAAKvvB,MAC/BA,KAAK85E,WAAa95E,KAAK85E,WAAWvqD,KAAKvvB,MACvCA,KAAK+5E,iBAAmB/5E,KAAK+5E,iBAAiBxqD,KAAKvvB,MACnDA,KAAKomC,qBAAuBpmC,KAAKomC,qBAAqB7W,KAAKvvB,MAC3DA,KAAKg6E,oBAAsBh6E,KAAKg6E,oBAAoBzqD,KAAKvvB,MACzDA,KAAKi6E,uBAAyBj6E,KAAKi6E,uBAAuB1qD,KAAKvvB,MAC/DA,KAAKk6E,kBAAoBl6E,KAAKk6E,kBAAkB3qD,KAAKvvB,MACrDA,KAAKm6E,wBAA0Bn6E,KAAKm6E,wBAAwB5qD,KAAKvvB,MACjEA,KAAKo6E,iBAAmBp6E,KAAKo6E,iBAAiB7qD,KAAKvvB,MACnDA,KAAKq6E,wBAA0Br6E,KAAKq6E,wBAAwB9qD,KAAKvvB,MACjEA,KAAKs6E,4BAA8Bt6E,KAAKs6E,4BAA4B/qD,KAAKvvB,MACzEA,KAAKu6E,+BAAiCv6E,KAAKu6E,+BAA+BhrD,KAAKvvB,MAC/EA,KAAKw6E,0BAA4Bx6E,KAAKw6E,0BAA0BjrD,KAAKvvB,MACrEA,KAAKy6E,eAAiBz6E,KAAKy6E,eAAelrD,KAAKvvB,MAC/CA,KAAK06E,qBAAuB16E,KAAK06E,qBAAqBnrD,KAAKvvB,MAC3DA,KAAK26E,kBAAoB36E,KAAK26E,kBAAkBprD,KAAKvvB,MACrDA,KAAK46E,kBAAoB56E,KAAK46E,kBAAkBrrD,KAAKvvB,MACrDA,KAAK66E,0BAA4B76E,KAAK66E,0BAA0BtrD,KAAKvvB,MACrEA,KAAK86E,cAAgB96E,KAAK86E,cAAcvrD,KAAKvvB,MAC7CA,KAAK+6E,iBAAmB/6E,KAAK+6E,iBAAiBxrD,KAAKvvB,MACnDA,KAAKg7E,kBAAoBh7E,KAAKg7E,kBAAkBzrD,KAAKvvB,MACrDA,KAAKi7E,gBAAkBj7E,KAAKi7E,gBAAgB1rD,KAAKvvB,MACjDA,KAAKk7E,eAAiBl7E,KAAKk7E,eAAe3rD,KAAKvvB,MAC/CA,KAAKm7E,kBAAoBn7E,KAAKm7E,kBAAkB5rD,KAAKvvB,MACrDA,KAAKo7E,sBAAwBp7E,KAAKo7E,sBAAsB7rD,KAAKvvB,MAC7DA,KAAKq7E,wBAA0Br7E,KAAKq7E,wBAAwB9rD,KAAKvvB,MACjEA,KAAKs7E,sBAAwBt7E,KAAKs7E,sBAAsB/rD,KAAKvvB,MAC7DA,KAAKu7E,yBAA2Bv7E,KAAKu7E,yBAAyBhsD,KAAKvvB,MACnEA,KAAKi5C,gBAAkBj5C,KAAKi5C,gBAAgB1pB,KAAKvvB,MACjDA,KAAKw7E,wBAA0Bx7E,KAAKw7E,wBAAwBjsD,KAAKvvB,MACjEA,KAAKy7E,wBAA0Bz7E,KAAKy7E,wBAAwBlsD,KAAKvvB,MACjEA,KAAK07E,aAAe17E,KAAK07E,aAAansD,KAAKvvB,MAC3CA,KAAK0yE,oBAAsB1yE,KAAK0yE,oBAAoBnjD,KAAKvvB,MACzDA,KAAK27E,yBAA2B37E,KAAK27E,yBAAyBpsD,KAAKvvB,MACnEA,KAAK47E,4BAA8B57E,KAAK47E,4BAA4BrsD,KAAKvvB,MACzEA,KAAK67E,wBAA0B77E,KAAK67E,wBAAwBtsD,KAAKvvB,MACjEA,KAAK87E,wBAA0B97E,KAAK87E,wBAAwBvsD,KAAKvvB,MACjEA,KAAK+7E,kBAAoB/7E,KAAK+7E,kBAAkBxsD,KAAKvvB,MACrDA,KAAKg8E,sBAAwBh8E,KAAKg8E,sBAAsBzsD,KAAKvvB,MAC7DA,KAAKi8E,wBAA0Bj8E,KAAKi8E,wBAAwB1sD,KAAKvvB,MACjEA,KAAKk8E,sBAAwBl8E,KAAKk8E,sBAAsB3sD,KAAKvvB,MAC7DA,KAAKm8E,gBAAkBn8E,KAAKm8E,gBAAgB5sD,KAAKvvB,MACjDA,KAAKo8E,mBAAqBp8E,KAAKo8E,mBAAmB7sD,KAAKvvB,MACvDA,KAAKq5C,0BAA4Br5C,KAAKq5C,0BAA0B9pB,KAAKvvB,MACrEA,KAAKq8E,iCAAmCr8E,KAAKq8E,iCAAiC9sD,KAAKvvB,MACnFA,KAAKs8E,2BAA6Bt8E,KAAKs8E,2BAA2B/sD,KAAKvvB,MACvEA,KAAKu8E,oBAAsBv8E,KAAKu8E,oBAAoBhtD,KAAKvvB,MACzDA,KAAKw8E,wBAA0Bx8E,KAAKw8E,wBAAwBjtD,KAAKvvB,MAEjEA,KAAKy8E,wBAA0Bz8E,KAAKy8E,wBAAwBltD,KAAKvvB,MACjEA,KAAK08E,wBAA0B18E,KAAK08E,wBAAwBntD,KAAKvvB,MAEjEA,KAAK28E,qBAAuB38E,KAAK28E,qBAAqBptD,KAAKvvB,MAC3DA,KAAK48E,kBAAoB58E,KAAK48E,kBAAkBrtD,KAAKvvB,MACrDA,KAAK68E,gBAAkB78E,KAAK68E,gBAAgBttD,KAAKvvB,MAEjDA,KAAK88E,iBAAmB98E,KAAK88E,iBAAiBvtD,KAAKvvB,MACnDA,KAAK+8E,kBAAoB/8E,KAAK+8E,kBAAkBxtD,KAAKvvB,MACrDA,KAAK0mE,iBAAmB1mE,KAAK0mE,iBAAiBn3C,KAAKvvB,MACnDA,KAAKg9E,oBAAsBh9E,KAAKg9E,oBAAoBztD,KAAKvvB,MACzDA,KAAKi9E,uBAAyBj9E,KAAKi9E,uBAAuB1tD,KAAKvvB,MAC/DA,KAAKk9E,qBAAuBl9E,KAAKk9E,qBAAqB3tD,KAAKvvB,MAE3DA,KAAKm9E,qBAAuBn9E,KAAKm9E,qBAAqB5tD,KAAKvvB,MAE3DA,KAAKo9E,mBAAqBp9E,KAAKo9E,mBAAmB7tD,KAAKvvB,MAGzD24E,gBACE,MAAMlC,EAAW3G,GAAiBK,UAAU,aAAe,GACrDkD,IAAYvD,GAAiBK,UAAU,kBAE7C,MAAO,CACL1rC,WAAW,EAEXkjC,OAAO,EAEP0V,WAAW,EACXzH,UAAWa,EAASb,WAAa,KACjChS,cAAe6S,EAAS7S,eAAiB+T,KACzChU,cAAe,gBAEfoO,eAAgB0E,EAAS6G,iBACzBpL,eAAe,EAEfD,cAAeoB,KAAaoD,EAASxE,cAErCD,sBAAuBgG,MDtKG,iBAAnBtxE,OAAO8kD,UACmB,aAA5B9kD,OAAO8kD,SAASssB,WCsK6C,oBAAbj4D,WAC1B,oBAAjB09D,cACVC,cAAenK,EAAUvD,GAAiBK,UAAU,kBAAoB,KAExEzI,oBAAqB72C,SAAS4sD,OAE9B5gC,UAAW,GACXD,WAAY,KACZq6B,iBAAaj2E,EACbk2E,gBAAiB,KAEjBwG,kBAAmB,QACnBC,eAAgB,KAChBC,gBAAiB,KACjBC,gBAAiB,GACjB1G,oBAAoB,EAEpB5G,MAAO,GACPC,SAAU,GACV6C,QAASA,EACTpvC,SAAU,KACV65C,eAAgBj+D,UAAUC,OAC1B0jB,cAAe,GACfu6C,qBAAqB,EACrBC,iBAAkB,KAClB5U,eAAgB,KAChBgO,eAAe,EACfz6B,cAAgBj2C,OAAOu3E,YxF/KG,IwFgL1BC,eAAWl9E,EACXm9E,YAAa,YAGbtV,eAAW7nE,EACXq8C,UxFlHyB,EwFqHzB+gC,iBAAiB,EAEjBC,oBAAoB,EACpBC,kBAAmB,KACnBC,mBAAoB,KACpBC,kBAAmB,KACnBC,iBAAkB,GAElBC,sBAAsB,EACtB1W,eAAgB,KAGhB2W,cAAc,EACdC,YAAa,GAGbpP,SAAU,GAEVhpC,cAAe,GAEfsW,mBAAoB,GACpBy5B,gBAAYv1E,EACZs1E,cAAUt1E,EAEV69E,oBAAgB79E,GAIpB4vB,oBAOE,GANAlqB,OAAOolB,iBAAiB,SAAU9rB,KAAK44E,cACvClyE,OAAOolB,iBAAiB,UAAWrlB,IAAQzG,KAAK84E,cAAa,MAC7DpyE,OAAOolB,iBAAiB,WAAYrlB,IAAQzG,KAAK84E,cAAa,MAC9DpyE,OAAOolB,iBAAiB,aAAc9rB,KAAK64E,iBAGZ,mBAApBn6D,iBAAgC,CACZ,IAAIA,iBAAiB,aAC7BoN,iBAAiB,UAAW9rB,KAAKm7E,wBAGtDx2E,QAAQmR,KAAK,uFAIf+a,SAAS/E,iBAAiB,mBAAoB9rB,KAAKg5E,uBAEnDh5E,KAAK48B,SAAS,CACZmD,cAAelP,SAASiuD,gBAAgBC,YACxCC,eAAgBnuD,SAASiuD,gBAAgBG,eAG3C,IAAIh+E,SAAQ,CAACC,EAASqJ,KACpBvK,KAAKuwB,OAASmoD,GAAUwG,QAAQl/E,KAAKu7B,MAAMqoC,cAAe5jE,KAAKu7B,MAAMq6C,UACnE51E,KAAKoQ,MAAMif,KAAKmmC,OAAQx1D,KAAKu7B,MAAM83C,QAASnyE,GAC9ClB,KAAKuwB,OAAO4uD,UAAYn/E,KAAKm5E,gBAC7Bn5E,KAAKuwB,OAAO6uD,aAAep/E,KAAKw5E,iBAChCx5E,KAAKuwB,OAAO8uD,yBAA2Br/E,KAAKo5E,6BAC5Cp5E,KAAKuwB,OAAO+uD,cAAgBt/E,KAAK48E,qBAChC3jE,MAAK,KAEFjZ,KAAKu7B,MAAMy2C,sBACbhyE,KAAKi7E,kBAAkBhiE,MAAK,KACtBjZ,KAAKu7B,MAAM02C,eACbjyE,KAAKuwB,OAAOgvD,eAAev/E,KAAKu7B,MAAMiiD,kBAEvC7yE,OAAM,SAOX,MAAM60E,EAAY1b,GAAeI,aAAax9D,OAAO8kD,SAAS12B,MAG9D90B,KAAK45E,mBAEL,MAAMn+D,EAAQzb,KAAKu7B,MAAM83C,QAAUvD,GAAiBK,UAAU,mBAAgBnvE,EAC1Eya,IACFzb,KAAK48B,SAAS,CAACygD,WAAW,IAG1B5hE,EAAMgkE,QAAU,IAAI/qE,KAAK+G,EAAMgkE,SAC/Bz/E,KAAKuwB,OAAOmvD,aAAajkE,GACzBzb,KAAKuwB,OAAOyuC,UAAUr0D,OAAO4a,IAE3BvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,WAK7B,CAAC,OAAQ,QAAS,YAAYsI,SAASwyE,EAAUzb,KAAK,MAEzD/jE,KAAK48B,SAAS,CAACiiD,eAAgBW,EAAUzb,KAAK,KAC9CD,GAAekG,WAAW,KAG5BhqE,KAAK2/E,UAAY,KACjB3/E,KAAK4/E,kBAAoB,KAEzB5/E,KAAK64E,qBAIT/nD,uBACEpqB,OAAOqqB,oBAAoB,SAAU/wB,KAAK44E,cAC1ClyE,OAAOqqB,oBAAoB,aAAc/wB,KAAK64E,iBAC9ChoD,SAASE,oBAAoB,mBAAoB/wB,KAAKg5E,uBAI1C,eAACpV,EAAegS,EAAWpgB,EAAQqqB,EAAiBC,GAChE,MAAMvvD,EAAS,IAAIxE,GAAAA,OAAO,CAAC1U,QAASqV,GAAUkrD,KAAMhU,EAAepnD,OxF7UhD,mCwF6UiEo5D,UAAWA,EAC7FmK,OAAQ/H,KAAsB3E,QAASwM,GAAkBC,GAG3D,OAFAvvD,EAAOyvD,iBAAiBxqB,GACxBjlC,EAAO0vD,cxFvUoB,MwFuUW,GAC/B1vD,EAIT4qD,kBAAkBxzD,GAChB,MAAM3lB,EAAO2lB,EAAQ3lB,MAAQ,GAC7B,OAAQA,EAAKg+C,MACb,IAAK,MACCj0B,GAAAA,OAAAA,mBAA0B/pB,EAAKsuB,QAEjCtwB,KAAKuwB,OAAO2vD,gBAAgB,MAAOl+E,EAAKsuB,MAAOtuB,EAAK6vB,IAAK,YAE3D,MACF,IAAK,OAEH7xB,KAAKuwB,OAAO2vD,gBAAgB,OAAQl+E,EAAKsuB,MAAOtuB,EAAK6vB,KACrD,MACF,QACEltB,QAAQmR,KAAK,4BAA6B9T,EAAKg+C,KAAMh+C,IAIzDi5E,kBACE,MAAM,cAAC7rD,EAAD,OAAgBomC,GAAUx1D,KAAKoQ,MAAMif,KACrCqC,EAAU,CAACO,EAAK1M,KACpB5gB,QAAQ+F,MAAMunB,EAAK1M,GACnBvlB,KAAKk8B,YAAY9M,EAAcvB,GAASuqD,kBAAmB,OAC3Dp4E,KAAK48B,SAAS,CAACo1C,sBAAsB,EAAOwL,cAAe,OAC3D1N,GAAiBqQ,aAAa,WAAY,CAAClO,eAAe,KAG5D,IAEE,OADAjyE,KAAKogF,IAAMC,GAAqBC,EAAgB/C,cAAe7wD,KACxD7M,UAAU2J,cAAcC,SAAS,sBAAsBxQ,MAAMsnE,IAClEvgF,KAAK+4E,kBAAkBwH,GACvBA,EAAI1vC,OAAOvyB,YAAY9D,KAAKC,UAAU,CAAC+6C,OAAQA,EAAQvgD,QAASgG,MACzDslE,KACNtnE,MAAMsnE,GAEA7H,GAAU8H,gBAAgBxgF,KAAKogF,IAAKG,KAC1CtnE,MAAMwC,IACP,MAAM43D,EAAUvD,GAAiBK,UAAU,kBACvC10D,GAASzb,KAAKu7B,MAAMiiD,gBACtBx9E,KAAKuwB,OAAOgvD,eAAe9jE,GACvB43D,GACFvD,GAAiBM,UAAU,iBAAkB30D,IAGjDzb,KAAK48B,SAAS,CAAC4gD,cAAe/hE,EAAOw2D,eAAe,IAChDoB,GACFvD,GAAiBqQ,aAAa,WAAY,CAAClO,eAAe,IAM5DwO,GAAkBzgF,KAAKogF,KAAMz4D,IAAc3nB,KAAKm7E,kBAAkBxzD,SACjEhd,OAAO4a,IAGR,MADAmM,EAAQnM,GACFA,KAER,MAAOA,GAEP,OADAmM,EAAQnM,GACDtkB,QAAQsJ,OAAOgb,IAKJ,uBAAC66D,EAAKM,GAC1B,OAAOC,GAAiBP,EAAK,CAC3Bl2D,0BAA2Bw2D,EAC3B57D,SAAUy4D,cAAcqD,oBACvB3nE,MAAMwC,GACHA,GAIKmO,aAAaE,oBAAoB7Q,MAAM4Q,IAC5C,GAAmB,YAAfA,EACF,OAAO82D,GAAiBP,EAAK,CAC3Bl2D,0BAA2Bq2D,IAC3Bz7D,SAAUy4D,cAAcqD,oBACvB3nE,MAAMwC,IACP,GAAIA,EACF,OAAOA,EAEP,MAAM,IAAIpT,MAAM,yCAIpB,MAAM,IAAIA,MAAM,wCAA0CwhB,QAOpE+uD,eACE,MAAMiI,EAAShwD,SAASiuD,gBAAgBC,axF/YZ,IwFgZ5B/+E,KAAK48B,SAAS,CACZmD,cAAelP,SAASiuD,gBAAgBC,YACxCC,eAAgBnuD,SAASiuD,gBAAgBG,eAEvCj/E,KAAKu7B,MAAMohB,eAAiBkkC,GAC9B7gF,KAAK48B,SAAS,CAAC+f,cAAekkC,IAKlC9H,kBAAkBwH,GAChBA,EAAIO,cAAgB,KAClB,MAAMC,EAAmBR,EAAIS,WAC7BD,EAAiBE,cAAgB,KAC/B,GAA8B,aAA1BF,EAAiBxlD,OAAwB1b,UAAU2J,cAAc03D,WAAY,CAC/E,MAAMjvD,EAAM,oCACV,kBAAC,EAAA3F,iBAAD,CAAkBjpB,GAAE,mBAClBkpB,eAAc,uCAFN,IAGwD,uBAAGiJ,KAAK,IACxE,kBAAC,EAAAlJ,iBAAD,CAAkBjpB,GAAE,gBAClBkpB,eAAc,6BALR,KAQZvsB,KAAKk8B,YAAYjK,EAAK,WAO9B4mD,kBACE,MAAM/jD,EAAOgvC,GAAeI,aAAax9D,OAAO8kD,SAAS12B,MACzD,GAAIA,EAAKivC,MAAQjvC,EAAKivC,KAAK1jE,OAAS,EAAG,CAEjC,CAAC,WAAW,WAAW,OAAO,QAAQ,WAAW,UAAU,UAAU,OACrE,OAAO,QAAQ,SAAS,UAAU,UAAU,WAAW,IAAI2M,SAAS8nB,EAAKivC,KAAK,IAChF/jE,KAAK48B,SAAS,CAAC8gD,kBAAmB5oD,EAAKivC,KAAK,KAE5Cp/D,QAAQmR,KAAK,yBAA0Bgf,EAAKivC,KAAK,IAInD,IAAI1zC,EAAYyE,EAAKivC,KAAK,IAAM,KAC5B1zC,GAAarwB,KAAKu7B,MAAMiI,gBACrBzX,GAAAA,OAAAA,UAAiBsE,KAEpBA,EAAY,MAEdrwB,KAAK48B,SAAS,CACZ4G,cAAenT,EACf2tD,iBAAkBh+E,KAAKuwB,OAAO4wD,mBAAmB9wD,WAKrDrwB,KAAK48B,SAAS,CAAC8gD,kBAAmB,GAAIl6C,cAAe,OAInD1O,EAAKlF,OAAOhb,QACd5U,KAAK48B,SAAS,CAAE25C,WAAYzhD,EAAKlF,OAAOhb,SAEtCkgB,EAAKlF,OAAOjkB,MACd3L,KAAK48B,SAAS,CAAE05C,SAAUxhD,EAAKlF,OAAOjkB,OAIxC3L,KAAK48B,SAAS,CACZshD,UAAWppD,EAAKlF,OAAOlsB,KACvB09E,oBAAqBtsD,EAAKlF,OAAOyxD,MAIrCvI,aAAah3C,GACPA,GACF9hC,KAAKk8B,cACLshB,cAAcx9C,KAAKshF,oBACnBthF,KAAKuwB,OAAOgxD,aAEZvhF,KAAKk8B,YAAYl8B,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAASyqD,eAAgB,QAE1Et4E,KAAK48B,SAAS,CAACkhD,eAAgBh8C,IAGjCk3C,wBACEh5E,KAAK48B,SAAS,CAAC8qC,oBAAqB72C,SAAS4sD,SAG/CvhD,YAAY3W,EAAK8iB,EAAOjF,EAAQqF,GAC9BzoC,KAAK48B,SAAS,CACZigB,UAAWt3B,EACXq3B,WAAYvU,EACZ4uC,YAAa7zC,EACb8zC,gBAAiBzuC,EACjB21C,iBAAiB,IAKrBnF,mBAAmB1I,EAAOC,GACxBxwE,KAAK48B,SAAS,CACZw6C,eAAe,EACf7G,MAAOA,EACPC,SAAUA,EACV2G,oBAAoB,EACpBkG,WAAW,IAEbr9E,KAAKk8B,YAAY,GAAI,MAEjBl8B,KAAKuwB,OAAOixD,cACdxhF,KAAKq5E,QAAQ9I,EAAOC,EAAU,CAAC76B,KAAM31C,KAAKu7B,MAAMg7C,WAAYhb,KAAMv7D,KAAKu7B,MAAM+6C,WAE7Et2E,KAAKuwB,OAAOyuC,UAAUr0D,OAAO4a,IAE3BvlB,KAAK48B,SAAS,CAACw6C,eAAe,EAAOiG,WAAW,EAAOlG,oBAAoB,IAC3En3E,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAMpCw0E,wBAAwB7F,GAClBA,EACFrzE,KAAKuwB,OAAOkxD,cAAcxoE,MAAK,KAC7B62D,GAAiBM,UAAU,kBAAkB,GAC7CpwE,KAAK48B,SAAS,CAACy2C,SAAS,OAG1BrzE,KAAKuwB,OAAOmxD,eAAezoE,MAAK,KAC9B62D,GAAiBM,UAAU,kBAAkB,GAC7CpwE,KAAK48B,SAAS,CAACy2C,SAAS,OAM9B8F,kBAEE37B,cAAcx9C,KAAKshF,oBACnBthF,KAAKk8B,cAEL,MAAMtM,EAAS5vB,KAAKuwB,OAAOoxD,gBAC3B3hF,KAAK48B,SAAS,CACZ+mC,cAAe/zC,EAAOgyD,IAAM,KAAOhyD,EAAOirB,MAAQjrB,EAAOirB,MAAQ,UAG/D76C,KAAKu7B,MAAM8hD,WACbr9E,KAAKq5E,QAAQr5E,KAAKu7B,MAAMg1C,MAAOvwE,KAAKu7B,MAAMi1C,SAAU,CAAC76B,KAAM31C,KAAKu7B,MAAMg7C,WAAYhb,KAAMv7D,KAAKu7B,MAAM+6C,WAKvG8C,6BAA6BtlD,EAAK+tD,GAGhC,GAFArkC,cAAcx9C,KAAKshF,oBAEfxtD,EAAM,EAGR,YADA9zB,KAAKk8B,cAIP,GAAI2lD,EAQF,YANAA,EAAK5oE,MAAK,KAERjZ,KAAKk8B,iBACJvxB,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAKlC,MAAM,cAAC0qB,GAAiBpvB,KAAKoQ,MAAMif,KACnC,IAAIoD,EAAQqB,EAAM,IAClBrB,GAAgBA,EAChBzyB,KAAKshF,mBAAqBhkC,aAAY,KACpC,MAAMwkC,EAAYrvD,EAAQ,GAAMkB,GAAclB,GAASA,EACvDzyB,KAAKk8B,YACH9M,EAAcvB,GAASqqD,oBAAqB,CAACtkD,QAASkuD,IACtD,QACA,KACEtkC,cAAcx9C,KAAKshF,oBACnBthF,KAAKuwB,OAAOgxD,cAEdnyD,EAAcvB,GAASsqD,gBAEzB1lD,GAAS,IACR,KAIL+mD,iBAAiBj0D,GACfvlB,KAAK48B,SAAS,CACZ6H,WAAW,EACXkjC,OAAO,EACPoW,qBAAqB,EACrBlhC,UAAWt3B,GAAOA,EAAI7gB,QAAU6gB,EAAI7gB,QAAU,eAC9Ck4C,WAAYr3B,GAAOA,EAAI7gB,QAAU,MAAQ,OACzC0yE,eAAe,EACfiH,oBAAoB,EACpBK,sBAAsB,EACtB/a,cAAe,kBAInB0V,QAAQ9I,EAAOC,EAAU96B,GACvB,GAAI11C,KAAKuwB,OAAOwxD,kBAGd,YADAje,GAAekG,WAAW,IAI5Bt0B,EAAO3pB,GAAAA,OAAAA,WAAkB2pB,GAEzB,IAAIlrC,EAAU,KACViR,EAAQzb,KAAKuwB,OAAOyxD,eACpBzR,GAASC,GACX/0D,EAAQ,KACRzb,KAAK48B,SAAS,CAAC4zC,SAAU,OACzBhmE,EAAUxK,KAAKuwB,OAAO0xD,WAAW1R,EAAOC,EAAU96B,IACzCj6B,IACTjR,EAAUxK,KAAKuwB,OAAO2xD,WAAWzmE,EAAMA,MAAOi6B,IAG5ClrC,EACFA,EAAQyO,MAAMkX,IACRA,EAAKxkB,MAAQ,KAAqB,yBAAdwkB,EAAKoY,MAC3BvoC,KAAK48B,SAAS,CAACu6C,oBAAoB,IAC/BzhC,GACF11C,KAAKk8B,YAAYl8B,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAAS0qD,oBAAqB,QAE/Ev4E,KAAKs5E,yBAAyBnpD,EAAKP,SAEnC5vB,KAAKu5E,2BAEN5uE,OAAO4a,IAERvlB,KAAK48B,SAAS,CACZw6C,eAAe,EACfb,gBAAYv1E,EACZs1E,cAAUt1E,EACVm2E,oBAAoB,EACpBkG,WAAW,IAEbr9E,KAAKk8B,YAAY3W,EAAI7gB,QAAS,OAC1B+W,GACFzb,KAAK07E,eAEP5X,GAAekG,WAAW,QAK5BlG,GAAekG,WAAW,IAC1BhqE,KAAK48B,SAAS,CAACw6C,eAAe,KAIlCkC,yBAAyB1pD,GACvB,MAAMq0C,EAASH,GAAeI,aAAax9D,OAAO8kD,SAAS12B,MAC3DmvC,EAAOF,KAAK,GAAK,OACjBE,EAAOr0C,OAAP,OAA0BA,EAAO8lB,KAAK,GACtCouB,GAAekG,WAAWlG,GAAeK,eAAeF,EAAOF,KAAME,EAAOr0C,SAG9E2pD,wBACEv5E,KAAKk8B,cAGD4zC,GAAiBK,UAAU,mBAC7BL,GAAiBM,UAAU,aAAcpwE,KAAKuwB,OAAOyxD,gBAGvD,MAAMG,EAAYniF,KAAKu7B,MAAMsjD,eAEvB3P,EAAKlvE,KAAKuwB,OAAOs9C,aACvBqB,EAAGr2B,WAAa74C,KAAKy5E,aACrBvK,EAAGkT,gBAAkBpiF,KAAK05E,kBAC1BxK,EAAGp2B,cAAgB94C,KAAK25E,gBACxB35E,KAAK48B,SAAS,CACZ6H,WAAW,EACX8xC,gBAAYv1E,EACZs1E,cAAUt1E,EACVijC,SAAUjkC,KAAKuwB,OAAO8xD,mBACtBhF,WAAW,EACXwB,oBAAgB79E,IAGlBkuE,EAAGhpD,UACDgpD,EAAGv0B,iBACD6uB,eACA1B,WACAltB,WACA0nC,WACAznC,SACAlwC,OAAO4a,IACPvlB,KAAKuwB,OAAOsvC,aACZkQ,aAAaM,WAAW,cACxBrwE,KAAKk8B,YAAY3W,EAAI7gB,QAAS,OAC9Bo/D,GAAekG,WAAW,OACzBh2B,SAAQ,KACTh0C,KAAK48B,SAAS,CAACu6C,oBAAoB,OAEvC,IAAIoL,EAAUze,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KAAM,YAC/DqtD,IACFI,EAAUze,GAAemG,YAAYsY,EAASJ,IAEhDre,GAAekG,WAAWuY,GAG5B9I,aAAa9lC,GACX,GAAIA,EAAM,CAOR,GANIA,EAAK3P,QACPhkC,KAAK48B,SAAS,CACZ+gD,eAAgBhqC,EAAK3P,OAAO9mB,GAC5B0gE,gBAAiBvlD,GAAasb,EAAK3P,OAAO7N,SAG1Cwd,EAAKhP,QAAS,CAChB,MAAMnR,EAAS,GACf,IAAK,MAAOvtB,EAAKuP,KAAQ5V,OAAOmS,QAAQ4hC,EAAKhP,SACvCnvB,GACFge,EAAO3vB,KAAKoC,GAGhBjG,KAAK48B,SAAS,CACZihD,gBAAiBrqD,IAGjBmgB,EAAKxR,KACPniC,KAAK48B,SAAS,CACZs1C,eAAgBv+B,EAAKxR,IAAIsgD,iBAOjC/I,kBAAkB15B,EAAM4tB,GACtB,GAAY,MAAR5tB,GAAwB,OAARA,EAClBhgD,KAAK45E,mBACD55E,KAAKu7B,MAAMiI,eAAiBoqC,EAAKt9C,OACnCtwB,KAAK48B,SAAS,CAACmhD,oBAA8B,MAAR/9B,SAElC,GAAY,QAARA,EACThgD,KAAK45E,wBACA,GAAY,OAAR55B,EAAe,CAExB,MAAM1vB,EAAQtwB,KAAKuwB,OAAOC,SAASo9C,EAAKt9C,OAClC+pB,EAAW/pB,GAASA,EAAMgqB,aAG5BszB,EAAK5qC,OAAS,GAAKhjC,KAAKu7B,MAAMw2C,gBAAkB13B,IAE9CxpB,SAAS4sD,QAAUz9E,KAAKu7B,MAAMiI,eAAiBoqC,EAAKt9C,QACtD2nD,GAAUv5C,OAId1+B,KAAK45E,uBACY,QAAR55B,IAEQ,QAARA,GAA0B,SAARA,GAGvBhgD,KAAKu7B,MAAMiI,eAAiBoqC,EAAKt9C,OACnCtwB,KAAKg6E,oBAAoB,MAG3Bh6E,KAAK45E,oBACY,OAAR55B,EAGLhgD,KAAKu7B,MAAMiI,eAAiBoqC,EAAKt9C,OACnCtwB,KAAK48B,SAAS,CAACohD,iBAAkBpQ,EAAKzrC,MAEvB,OAAR6d,GAEQ,OAARA,GAKTr7C,QAAQjB,KAAK,qCAAuCs8C,EAAO,QAAU4tB,EAAKt9C,QAI9EqpD,gBAAgB+I,GACd1iF,KAAK45E,mBAKyB,iCAACpK,EAAUmT,GACzC,MAAMC,EAAS,GAIf,IAAK,MAAMz+E,KAAKqrE,EACVzjD,GAAAA,OAAAA,eAAsB5nB,EAAEmsB,SACxBsyD,EAAOz+E,EAAEmsB,OAAS,CAChBI,KAAMvsB,EAAEmsB,MACRuyD,QAAS1+E,EAAE0+E,QACX7+C,OAAQ7/B,EAAE6/B,OACVF,QAAS3/B,EAAE2/B,QACX3B,IAAKh+B,EAAEg+B,MAMf,IAAK,MAAMh+B,KAAKw+E,EACTC,EAAOz+E,EAAEusB,QACZkyD,EAAOz+E,EAAEusB,MAAQvsB,GAIrB,OAAOvE,OAAOuS,OAAOywE,GAGvBhJ,mBACE,MAAMngC,EAAW,CACf+1B,SAAU,IAGPxvE,KAAKu7B,MAAMosC,QACdluB,EAASkuB,OAAQ,GAGnB3nE,KAAKuwB,OAAOs9C,aAAalqC,UAAUx/B,IAC5BA,EAAEmsB,OAAUnsB,EAAEusB,OAEjBvsB,EAAEmsB,MAAQnsB,EAAE7E,MAGdm6C,EAAS+1B,SAAS3rE,KAAKM,GACnBnE,KAAKu7B,MAAMiI,eAAiBr/B,EAAEmsB,QAChCmpB,EAASskC,oBAAsB55E,EAAE29B,OACjC2X,EAASukC,iBAAmB75E,EAAEg+B,QAIlC,MAAM2gD,EAAO,IAAIpuE,KAAK,GACtB+kC,EAAS+1B,SAASl5C,MAAK,CAACvwB,EAAG4G,KACjB5G,EAAE4pE,SAAWmT,GAAMriB,WAAa9zD,EAAEgjE,SAAWmT,GAAMriB,YAI7DhnB,EAASqD,mBAAqB47B,GAAUqK,0BAA0BtpC,EAAS+1B,SAAUxvE,KAAKu7B,MAAMiL,eAChGxmC,KAAK48B,SAAS6c,GAIhBogC,OAAO73E,GACL,MAAMsuB,EAAQtwB,KAAKuwB,OAAOC,SAASxuB,EAAKsuB,OACpCA,EAAMiU,UAAUviC,GAAM,IAAS+pB,GAAAA,OAAAA,qBAA8B/pB,EAAKkQ,MAAQlS,KAAKu7B,MAAM0I,WACvF2mC,aAAa5qE,KAAKgjF,eAClBhjF,KAAKgjF,cAAgB3lE,YAAW,KAC9Brd,KAAKgjF,mBAAgBhiF,EACrBsvB,EAAM2yD,SAASjhF,EAAK6vB,OxFl3BE,MwFw3B5BioD,aACE,MAAMoJ,EAAMljF,KAAKuwB,OAAO4yD,cACxBD,EAAIpqC,cAAgB94C,KAAK+5E,iBACrBmJ,EAAIha,eACNlpE,KAAK+5E,mBAELmJ,EAAIh9D,UAAUg9D,EAAIvoC,iBAAiByoC,UAAUvoC,SAASlwC,OAAO4a,IAC3DvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAKpCq1E,mBACE,MAAM4I,EAAgB,GAEtB3iF,KAAKuwB,OAAO4yD,cAAcx/C,UAAUwf,IAClCw/B,EAAc9+E,KAAKs/C,MAErBnjD,KAAK48B,SAAS,CACZ4J,cAAem8C,EACf7lC,mBAAoB47B,GAAUqK,0BAA0B/iF,KAAKu7B,MAAMi0C,SAAUmT,KAOjFv8C,qBAAqBR,GACnB,MAAMs9C,EAAMljF,KAAKuwB,OAAO4yD,cACxBD,EAAIG,QAAQ,CAAC1vC,KAAM,CAAC3P,OAAQ4B,KAAS3sB,MAAMkX,GAClC+yD,EAAIxoC,QAAQwoC,EAAIvoC,iBAAiByoC,UAAUvoC,WACjDlwC,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAKlCs1E,oBAAoB3pD,GAEdrwB,KAAKu7B,MAAM6tC,gBAAkBppE,KAAKu7B,MAAM6tC,eAAeC,YAAch5C,GACvErwB,KAAK48B,SAAS,CACZwsC,eAAgB,OAIhB/4C,GACFrwB,KAAK48B,SAAS,CACZigB,UAAW,GACXD,WAAY,KACZuhC,YAAa,aACbD,eAAWl9E,IAGThB,KAAKu7B,MAAMiI,eAAiBnT,IAC9BrwB,KAAK48B,SAAS,CACZmhD,oBAAqB/9E,KAAKuwB,OAAO+yD,cAAcjzD,GAC/C2tD,iBAAkBh+E,KAAKuwB,OAAO4wD,mBAAmB9wD,GACjD23C,eAAgB,OAElBlE,GAAekG,WAAWlG,GAAemG,YAAY,GAAI55C,OAI3DrwB,KAAK48B,SAAS,CACZigB,UAAW,GACXD,WAAY,KACZuhC,YAAa,YACbJ,qBAAqB,EACrBC,iBAAkB,KAClBE,eAAWl9E,EACXgnE,eAAgB,OAGlBlE,GAAekG,WAAWlG,GAAemG,YAAY,GAAI,QAK7DgQ,yBACEj6E,KAAK48B,SAAS,CACZuhD,YAAa,cAEfra,GAAekG,WAAWlG,GAAemG,YAAYvjE,OAAO8kD,SAAS12B,KAAM,OAS7EolD,kBAAkBjoD,EAAKk5C,EAAyBt3B,EAAU1e,GACxD,MAAM7E,EAAQtwB,KAAKuwB,OAAOC,SAASxwB,KAAKu7B,MAAMiI,eAE9C,OAAOxjC,KAAKo9E,mBAAmB9sD,EAAO2B,EAAKk5C,EAAyBt3B,EAAU1e,GAGhFioD,mBAAmB9sD,EAAO2B,EAAKk5C,EAAyBt3B,EAAU1e,IAChElD,EAAM3B,EAAM4B,cAAcD,GAAK,IAE3By7C,UAAY75B,EAEZ1e,IACFlD,EAAIkD,KAAOv1B,OAAOiX,OAAOob,EAAIkD,MAAQ,GAAIA,IAG3C,MAAMouD,EAAa,GAKnB,GAJIpY,GACFoY,EAAW1/E,KAAKsnE,IAGb76C,EAAM44C,eAAgB,CAEzB,MAAMsa,EACJlzD,EAAMpK,YACHjN,MAAK,KAEJqX,EAAMu5C,gBAAeC,IACfA,EAAIC,UAAYD,EAAIj4C,KAAOI,EAAIJ,KAG/BvB,EAAM44C,gBACR54C,EAAMmzD,eAAe3Z,SAI/ByZ,EAAW1/E,KAAK2/E,GAIlB,OAAOlzD,EAAM6B,aAAaF,EAAKhxB,QAAQmR,IAAImxE,IACxCtqE,MAAK1M,IACA+jB,EAAMgqB,cACRhqB,EAAMxB,SAAQ,GAETqB,QAERxlB,OAAO4a,IACNvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIpCy1E,wBAAwB9pD,EAAW+S,GACjC,MAAM9S,EAAQtwB,KAAKuwB,OAAOC,SAASH,GACnC,IAAI7U,EAAW,KACf,OAAQ4nB,GACN,IAAK,SAEH,MAAMp1B,EAAOsiB,EAAMmiB,gBAAgBmH,WACnCp+B,EAAW8U,EAAM+yD,QAAQ,CAACtpC,IAAK,CAAC/rC,KAAMA,KAClCsiB,EAAMu3C,cAGRrsD,EAAWA,EAASvC,MAAMkX,IACxBG,EAAM+yD,QAAQ,CAACtpC,IAAK,CAACrpB,KAAML,EAAWriB,KAAMA,SAGhD,MACF,IAAK,SAEHwN,EAAW8U,EAAMG,UAAS,GAC1B,MACF,IAAK,QAGH,MAAMizD,EAAKpzD,EAAMmiB,gBAAgBkxC,WAAW,OAAO9pC,UACnDr+B,EAAW8U,EAAM+yD,QAAQ,CAACtpC,IAAK,CAAC/rC,KAAM01E,KAAMzqE,MAAMkX,GACzCnwB,KAAKg6E,oBAAoB,QAElC,MACF,QACEr1E,QAAQmR,KAAK,4BAA6B,IAAMstB,EAAS,MAG7C,MAAZ5nB,GACFA,EAAS7Q,OAAO4a,IACdvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAMpC01E,mBACEp6E,KAAKk8B,cAEL4nC,GAAekG,WAAWlG,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KAAM,aAIjFulD,wBAAwBuJ,EAAQC,EAAWC,EAASC,EAAOC,GAEzDhkF,KAAKk8B,cAELl8B,KAAKuwB,OAAOyuC,QAAQh/D,KAAKu7B,MAAMqoC,eAC5B3qD,MAAK,IACGjZ,KAAKuwB,OAAO0zD,mBAAmBL,EAAQC,EAC5C,CAAC7/C,OAAQ8/C,EAASryC,KAAMuyC,EAAOtuC,KAAM3pB,GAAAA,OAAAA,WAAkBg4D,OACxD9qE,MAAMkX,IACHA,EAAKxkB,MAAQ,KAAoB,wBAAbwkB,EAAKoY,KAC3BvoC,KAAKs5E,yBAAyBnpD,EAAKP,QAEnC5vB,KAAKu5E,sBAAsBv5E,SAE5B2K,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIpC81E,0BAA0B0J,GAExBlkF,KAAK48B,SAAS,CAACs1C,cAAe,OAE9B,MAAMhD,EAAKlvE,KAAKuwB,OAAOs9C,aACjB6V,EAAKxU,EAAGz8B,gBAAgBkxC,WAAWO,EAAK,KAAO,MAAMrqC,UAC3Dq1B,EAAGmU,QAAQ,CAACtpC,IAAK,CAAC/rC,KAAM01E,KAAM/4E,OAAO4a,IAEnCvlB,KAAK48B,SAAS,CAACs1C,eAAgBgS,IAC/BlkF,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlC61E,+BAA+B9oC,GAC7BzxC,KAAKuwB,OAAOs9C,aAAawV,QAAQ,CAAC5xC,KAAMA,IACrC9mC,OAAO4a,IACNvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAKpC+1E,iBACEz6E,KAAKk8B,cAEL4nC,GAAekG,WAAWlG,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KACvE90B,KAAKu7B,MAAM0I,SAAW,OAAS,aAInCy2C,qBAAqBjE,GACnB,MAAM7S,EAAgB6S,EAAS7S,eAAiB5jE,KAAKu7B,MAAMqoC,cACrDgS,EAAYa,EAASb,WAAa51E,KAAKu7B,MAAMq6C,UAC/C51E,KAAKuwB,SACPvwB,KAAKuwB,OAAOmxD,eACZ1hF,KAAKuwB,OAAO6uD,kBAAep+E,EAC3BhB,KAAKuwB,OAAOsvC,cAEd7/D,KAAKuwB,OAASmoD,GAAUwG,QAAQtb,EAAegS,EAAW51E,KAAKoQ,MAAMif,KAAKmmC,OACxEsa,GAAiBK,UAAU,mBAC7BnwE,KAAKuwB,OAAO4uD,UAAYn/E,KAAKm5E,gBAC7Bn5E,KAAKuwB,OAAO6uD,aAAep/E,KAAKw5E,iBAChCx5E,KAAKuwB,OAAO8uD,yBAA2Br/E,KAAKo5E,6BAE5Cp5E,KAAK48B,SAAS,CACZgnC,cAAeA,EACfgS,UAAWA,IAEb9F,GAAiBM,UAAU,WAAY,CACrCxM,cAAeA,EACfgS,UAAWA,IAGb9R,GAAekG,WAAWlG,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KAAM,KAIjF6lD,oBACE7W,GAAekG,WAAWlG,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KACvE90B,KAAKu7B,MAAM0I,SAAW,UAAY,KAItC22C,oBACE9W,GAAekG,WAAWlG,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KACvE90B,KAAKu7B,MAAM0I,SAAW,UAAY,KAGtCi3C,eAAej5B,GACTA,GACFjiD,KAAK48B,SAAS,CAACq1C,cAAe,OACzBjyE,KAAKu7B,MAAMiiD,eAGdx9E,KAAK48B,SAAS,CAACq1C,eAAe,IAC1BnC,GAAiBK,UAAU,mBAC7BL,GAAiBqQ,aAAa,WAAY,CAAClO,eAAe,KAJ5DjyE,KAAKi7E,mBAOEj7E,KAAKu7B,MAAMiiD,eAAiBx9E,KAAKogF,IAC1C+D,GAAiBnkF,KAAKogF,KAAKz1E,OAAO4a,IAChC5gB,QAAQ+F,MAAM,0BAA2B6a,MACxCyuB,SAAQ,KACT87B,GAAiBqQ,aAAa,WAAY,CAAClO,eAAe,IAC1DlC,aAAaM,WAAW,kBACxBrwE,KAAK48B,SAAS,CAACq1C,eAAe,EAAOuL,cAAe,OAEpDx9E,KAAKuwB,OAAOgvD,eAAe,UAG7Bv/E,KAAK48B,SAAS,CAACq1C,eAAe,EAAOuL,cAAe,OACpD1N,GAAiBqQ,aAAa,WAAY,CAAClO,eAAe,KAI9D4I,0BAA0B54B,GACxBjiD,KAAK48B,SAAS,CAACm1C,cAAe9vB,IAC9B6tB,GAAiBqQ,aAAa,WAAY,CACxC7C,kBAAmBr7B,IAIvB64B,cAAclmE,EAAQrS,GACTvC,KAAKuwB,OAAOs9C,aACpBwV,QAAQ,CAAC3tC,KAAM,CAACC,KAAM/gC,EAAQY,IAAKjT,KAASoI,OAAO4a,IACpDvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlCq2E,iBAAiBnmE,EAAQrS,GACZvC,KAAKuwB,OAAOs9C,aACpBuW,cAAcxvE,EAAQrS,GAAOoI,OAAO4a,IACrCvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlCs2E,kBAAkBpmE,EAAQ4G,GACxBxb,KAAKs5E,yBAAyB,CAAC5jC,KAAM,CAAC9gC,KAIxCwmE,wBACE,MAAMnX,EAASH,GAAeI,aAAax9D,OAAO8kD,SAAS12B,MAC3D,IAAIivC,EAAO,GACP,CAAC,WAAW,UAAU,UAAU,SAAS/2D,SAASi3D,EAAOF,KAAK,IAChEA,EAAO,OACE,QAAUE,EAAOF,KAAK,GAC/BA,EAAO,UACE,WAAaE,EAAOF,KAAK,GAClCA,EAAO,WACE/jE,KAAKu7B,MAAM0I,WACpB8/B,EAAO,YAETE,EAAOF,KAAK,GAAKA,EACbE,EAAOr0C,gBACFq0C,EAAOr0C,OAAOjkB,YACds4D,EAAOr0C,OAAOhb,cACdqvD,EAAOr0C,OAAOyxD,WACdpd,EAAOr0C,OAAOslD,cACdjR,EAAOr0C,OAAOnU,OAEvBqoD,GAAekG,WAAWlG,GAAeK,eAAeF,EAAOF,KAAME,EAAOr0C,SAC5E5vB,KAAK48B,SAAS,CAACigB,UAAW,GAAID,WAAY,OAI5CynC,eAAevvD,GACbgvC,GAAekG,WAAWlG,GAAe0e,gBAAgB97E,OAAO8kD,SAAS12B,KAAMA,IAIjFwvD,cAAcxvD,GACZgvC,GAAekG,WAAWlG,GAAeygB,gBAAgB79E,OAAO8kD,SAAS12B,KAAMA,IAIjFumD,wBAAwBhrD,EAAW+4C,EAAgBrmC,GAEjD,GAAI1S,GAAarwB,KAAKuwB,OAAO65C,cAAc/5C,GAEzC,YADArwB,KAAKg6E,oBAAoB3pD,GAI3B,MAAMT,EAAS,GACX7D,GAAAA,OAAAA,eAAsBsE,IAExBT,EAAOmqB,IAAM,CAAC/rC,KAAMgf,IAEpB4C,EAAO+jB,KAAO,CAACqG,OAAQ,CAACx1B,KAAMwI,OAE9BqD,EAAYA,GAAarwB,KAAKuwB,OAAOi0D,kBAAkBzhD,GACnDqmC,IACFx5C,EAAO+jB,KAAO,CAAC3P,OAAQolC,EAAeplC,OAAQF,QAAS,CAACZ,QAASkmC,EAAetlC,UAChFlU,EAAO6hB,KAAO23B,EAAe33B,OAGjC7hB,EAAOy5C,WAAah5C,EACpBrwB,KAAK48B,SAAS,CAACwsC,eAAgBx5C,IAAS,KAAO5vB,KAAKg6E,oBAAoB3pD,MAI1EirD,sBAAsBmJ,EAASC,GAC7B,IAAI3c,EAAY,GAIhB,GAHI/nE,KAAKu7B,MAAM6iD,kBACbrW,EAAY,CAAC1qB,UxFlqCmB,EwFkqCgB+gC,iBAAiB,IAE/Dp+E,KAAKu7B,MAAMiI,eAAiBihD,GAAWA,GAAWC,EAAS,CAI7D,MAAMvb,EAAW,CAAC3lC,cAAekhD,GACjC1kF,KAAK48B,YAAYmrC,KAAcoB,GAAU,KACvCrF,GAAekG,WAAWlG,GAAemG,YAAY,GAAIya,YAG3D1kF,KAAK48B,SAASmrC,GAAW,KACvBjE,GAAekG,WAAWlG,GAAemG,YAAY,GAAIya,OAK/DnJ,yBAAyBlrD,EAAWy5C,EAAKgL,EAAM96B,GAC7Ch6C,KAAKk8B,cAEL,MAAM5L,EAAQtwB,KAAKuwB,OAAOC,SAASH,GACnC,GAAIC,EAAO,CACT,MAAMV,EAAS,GACf,IAAIqsC,EACA6N,IACEA,EAAI3zC,QACF2zC,EAAI3zC,MAAM/C,KAAO02C,EAAI3zC,MAAM/C,KAAOrH,GAAAA,OAAAA,SACpCkwC,EAAc,CAAC6N,EAAI3zC,MAAM/C,KACf02C,EAAI3zC,MAAMn0B,MAAQ8nE,EAAI3zC,MAAMn0B,MAAQ+pB,GAAAA,OAAAA,WAC9C+9C,EAAI3zC,MAAQpK,GAAAA,OAAAA,WAGhB6D,EAAOoU,OAAS8lC,GAGC,iBAARgL,IACTllD,EAAOkU,QAAWgxC,IAAS/oD,GAAAA,OAAAA,SACzBA,GAAAA,OAAAA,SAAkB,CAACmX,QAAS4xC,IAE5B96B,IACFpqB,EAAOoqB,OAASA,GAElB1pB,EAAM+yD,QAAQ,CAAC1vC,KAAM/jB,EAAQqsC,YAAaA,IAActxD,OAAO4a,IAC7DvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,WAKpCu0C,gBAAgB5oB,GACd,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC/BC,GACFA,EAAMxB,SAAQ,GAIlBwrD,4BAA4B9J,GAC1BxwE,KAAKk8B,cAEDs0C,GACFxwE,KAAKuwB,OAAOo0D,mBAAmB,KAAM3kF,KAAKuwB,OAAOq0D,kBAAmBpU,GAAU7lE,OAAO4a,IACnFvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAKpC82E,wBAAwBnrD,EAAWriB,EAAMu4B,GACvC,MAAMjW,EAAQtwB,KAAKuwB,OAAOC,SAASH,GACnC,GAAIC,EAAO,CACT,MAAMozD,EAAKpzD,EAAMmiB,gBACblM,GACFm9C,EAAGmB,YAAY72E,GACfA,EAAO01E,EAAG9pC,aAEV8pC,EAAGC,WAAW31E,GACdA,EAAO01E,EAAG7pC,WAEZvpB,EAAM+yD,QAAQ,CAACtpC,IAAK,CAACrpB,KAAM6V,EAAKv4B,KAAMA,KAAQrD,OAAO4a,IACnDvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,WAKpC+2E,wBAAwBprD,EAAWohB,GACjC,MAAMnhB,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC/BC,GACFA,EAAM+yD,QAAQ,CAAC5xC,KAAMA,IAAO9mC,OAAO4a,IACjCvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAKpCg3E,eAaE,IAAIoJ,EAZJ9vD,GAAc,GAGd+6C,aAAaM,WAAW,cACxBN,aAAaM,WAAW,kBACxBN,aAAaM,WAAW,YACpBrwE,KAAKu7B,MAAMiiD,eACb2G,GAAiBnkF,KAAKogF,KAGxB5iC,cAAcx9C,KAAKshF,oBAGfthF,KAAKuwB,QACPu0D,EAAU9kF,KAAKuwB,OAAOmxD,eACtB1hF,KAAKuwB,OAAO6uD,kBAAep+E,EAC3BhB,KAAKuwB,OAAOsvC,cAEZilB,EAAUC,QAAQ7jF,UAEpBlB,KAAK48B,SAAS58B,KAAK24E,iBAEnBmM,EAAQ7rE,MAAK,KACXjZ,KAAKuwB,OAASmoD,GAAUwG,QAAQl/E,KAAKu7B,MAAMqoC,cACzC5jE,KAAKu7B,MAAMq6C,UAAW51E,KAAKoQ,MAAMif,KAAKmmC,OAAQsa,GAAiBK,UAAU,mBAAmB,KAC1FnwE,KAAKuwB,OAAO4uD,UAAYn/E,KAAKm5E,gBAC7Bn5E,KAAKuwB,OAAO6uD,aAAep/E,KAAKw5E,iBAChCx5E,KAAKuwB,OAAO8uD,yBAA2Br/E,KAAKo5E,6BAC5CtV,GAAekG,WAAW,UAKlC0I,sBACE1yE,KAAKuwB,OAAOy0D,gBAAe,GAAM/rE,MAAK1M,IACpCvM,KAAK07E,kBAITC,yBAAyBtrD,GACvB,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,GAKLA,EAAMG,UAAS,GAAMxX,MAAMkX,IAEzB2zC,GAAekG,WAAWlG,GAAemG,YAAYvjE,OAAO8kD,SAAS12B,KAAM,QAC1EnqB,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlCk3E,4BAA4BvrD,GAC1B,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,GAKLA,EAAMwB,gBAAe,GAAMnnB,OAAO4a,IAChCvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlCm3E,wBAAwBxrD,GACtB,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,GAILA,EAAM20C,OAAM,GAAMhsD,MAAMkX,IAEtB2zC,GAAekG,WAAWlG,GAAemG,YAAYvjE,OAAO8kD,SAAS12B,KAAM,QAC1EnqB,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlCo3E,wBAAwBzrD,GACtB,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,GAILA,EAAM8B,WAAW,KAAM,OAAOnZ,MAAK1M,IAEjCu3D,GAAekG,WAAWlG,GAAemG,YAAYvjE,OAAO8kD,SAAS12B,KAAM,QAC1EnqB,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIlCq3E,kBAAkB1rD,GAChB,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,IAKLtwB,KAAKuwB,OAAO00D,OAAO,SAAU50D,GAG7BC,EAAM8B,WAAW,KAAM,OAAOnZ,MAAMkX,IAElC2zC,GAAekG,WAAWlG,GAAemG,YAAYvjE,OAAO8kD,SAAS12B,KAAM,QAC1EnqB,OAAO4a,IACRvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,WAIlCs3E,sBAAsBpsD,EAAQ2sB,GAC5Bv8C,KAAK48B,SAAS,CACZyhD,oBAAoB,EACpBE,mBAAoB,CAACv6E,EAAG4rB,EAAO5rB,EAAGkvB,EAAGtD,EAAOsD,GAC5CsrD,kBAAmB5uD,EACnB6uD,iBAAkBliC,GAAav8C,KAAKi8E,wBAAwBrsD,EAAOS,WACnEiuD,kBAAmBt+E,KAAKmvB,QAAQ6B,QAAQ4N,0BAK5C69C,wBAAwB7sD,GACc,UAAhC5vB,KAAKu7B,MAAMmiD,mBAEb19E,KAAKo7E,wBAEP,MAAM8J,EAAS,KAAOt1D,EAAO2C,SACvBluB,EAAmC,iBAAlBurB,EAAOvrB,QAAsB67B,GAAAA,OAAAA,KAAYtQ,EAAOvrB,SAAW67B,GAAAA,OAAAA,iBAAwBtQ,EAAOvrB,SAC3Gi3B,EAAU4E,GAAAA,OAAAA,QAAe77B,ExF/4CK,IwF+4C8B,GAC5D4tB,EAAMiO,GAAAA,OAAAA,OAAcA,GAAAA,OAAAA,gBAAuBA,GAAAA,OAAAA,QAAeglD,EAAQt1D,EAAO0C,WAAYjuB,GACrF8gF,EAAajlD,GAAAA,OAAAA,MAAaglD,EAAQt1D,EAAO0C,SAAUgJ,GAEnDnG,EAAO,CACXgP,UAAWvU,EAAOS,UAAY,IAAMT,EAAOiC,KAE7C7xB,KAAK48B,SAAS,CACZ8hD,sBAAsB,EACtB1W,eAAgB,CAAE7yC,KAAMA,EAAMlD,IAAKA,EAAKqJ,QAAS6pD,KAIrDlJ,wBAAwB5rD,GACtB,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAEnC,IAAI4nB,GAAQ,EAAOw3B,GAAU,EAAO2V,GAAe,EAAOC,GAAa,EAAOj5C,GAAU,EAAOiO,GAAW,EAC1G,GAAI/pB,EAAO,CACT+0D,EAAa/0D,EAAM44C,eACnB7uB,EAAW/pB,EAAMgqB,aAEjB,MAAMnY,EAAM7R,EAAMmiB,gBACdtQ,IACF8V,EAAQ9V,EAAIG,UACZmtC,GAAWttC,EAAII,WACf6iD,GAAgBjjD,EAAII,SAAS,QAC7B6J,EAAUjK,EAAIiY,aAIlB,MAAO,CACLirC,EAAa,CACXn9D,MAAOloB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAAS2qD,gBAC9C7oD,QAAS3vB,KAAKo8E,oBACZ,KACJiJ,GAAct5D,GAAAA,OAAAA,eAAsBsE,GAAa,CAC/CnI,MAAOloB,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAAS4qD,sBAC9C9oD,QAAS3vB,KAAK28E,sBACZ,KACJ0I,EAAa,iBAAmB,KAChCA,GAAcj5C,EAAU,sBAAwB,KAChD6L,EAASw3B,EAAU,KAAO,eAAkB,aAC5C2V,EAAe,gBAAkB,cACjC/qC,EAAW,gBAAkB,gBAC7B,gBAIJ6hC,wBACEl8E,KAAK48B,SAAS,CACZyhD,oBAAoB,EACpBE,mBAAoB,KACpBC,kBAAmB,KACnBF,kBAAmB,OAIvB5B,wBAAwB4I,GACtBtlF,KAAK48B,SAAS,CACZ8hD,sBAAsB,EACtB1W,eAAgBsd,EAAuBtlF,KAAKu7B,MAAMysC,eAAiB,OAIvEwU,wBAAwBp5C,EAAQ54B,EAASolB,GACzB,iBAAVwT,EACE54B,GAAWolB,EAAOS,WAAaT,EAAOS,WAAarwB,KAAKu7B,MAAMiI,eAChEh5B,EAAQyO,MAAK,KACXjZ,KAAKg6E,oBAAoB,SAGV,qBAAV52C,GACTpjC,KAAKy8E,wBAAwB7sD,GAIjCusD,gBAAgBj0D,EAAO7jB,EAASmoB,EAAW+4D,EAAan5D,EAAUo5D,GAChExlF,KAAK48B,SAAS,CACZ+hD,cAAc,EACdC,YAAa,CACX12D,MAAOA,EACP7jB,QAASA,EACTmoB,UAAWA,EACXC,QAAS84D,EACTn5D,SAAUA,EACV7hB,OAAQi7E,KAKdpJ,qBACEtY,GAAekG,WAAWlG,GAAe4Q,YAAYhuE,OAAO8kD,SAAS12B,KAAM,OAAQ,SACnF90B,KAAK48B,SAAS,CAACshD,UAAW,SAG5B7kC,0BAA0BhpB,EAAWub,EAAO5B,GAC1C,IAAK3Z,EACH,OAGF,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,IAIDsb,GAASA,EAAMvrC,OAAS,GAC1BurC,EAAMt5B,KAAKi0B,IACTjW,EAAMm1D,OAAOl/C,EAAK,MAAM57B,OAAO4a,IAC7BvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,aAKhCslC,GAAWA,EAAQ3pC,OAAS,GAC9B2pC,EAAQ13B,KAAKi0B,IACXjW,EAAMK,gBAAgB4V,GAAK57B,OAAO4a,IAChCvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,cAMtC23E,iCAAiC3mC,EAAM/pC,GACrC,GAAI3L,KAAKuwB,OAAOwxD,kBAAmB,CACtB/hF,KAAKuwB,OAAOs9C,aACpBwV,QAAQ,CAAC3tC,KAAM,CAACC,KAAMD,EAAM6lB,KAAM5vD,KAClCsN,MAAK,KACJ6qD,GAAekG,WAAW,OAE3Br/D,OAAO4a,IACNvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,eAGlC1E,KAAK48B,SAAS,CAAC25C,WAAY7gC,EAAM4gC,SAAU3qE,IAC3C3L,KAAKq5E,QAAQ,KAAM,KAAM,CAAC1jC,KAAMD,EAAM6lB,KAAM5vD,IAIhD2wE,2BAA2B1nE,EAAQrS,GAEjC,OAAOvC,KAAKuwB,OAAOyuC,UAChB/lD,MAAK,IACGjZ,KAAKuwB,OAAOm1D,uBAAuB,QAAS9wE,EAAQrS,KAE5DoI,OAAO4a,IAENvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAIpC63E,oBAAoBrH,EAAQyQ,EAAalqE,IACvCA,EjFj5CG,SAAwBvU,GAC7B,GAAIA,EAAK,CACPA,EAAMA,EAAImD,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAC3C,IACEnD,EAAMkC,KAAKrB,KAAKb,IAChB,MAAMqe,GACN5gB,QAAQ+F,MAAM,qCAAsC6a,GACpDre,EAAM,MAGV,OAAOA,EiFu4CG0+E,CAAenqE,IAIrBzb,KAAKuwB,OAAOyuC,UACT/lD,MAAK,IACGjZ,KAAKuwB,OAAOo0D,mBAAmB,KAAM,KAAMgB,EAAa,CAAClqE,MAAOA,MAExExC,MAAK,KACJ6qD,GAAekG,WAAW,OAE3Br/D,OAAO4a,IAENvlB,KAAKk8B,YAAY3W,EAAI7gB,QAAS,UAXlC1E,KAAKk8B,YAAYl8B,KAAKoQ,MAAMif,KAAKD,cAAcvB,GAASwqD,wBAAyB,OAgBrFsE,uBACE38E,KAAK48B,SAAS,CACZisC,UAAW7oE,KAAKu7B,MAAMiI,cACtB6Z,UxF9iDsC,IwFkjD1Cy/B,iBAAiBjU,EAAWvB,EAASjqB,GACnC,OAAQA,GACN,KxFpjDsC,EwFqjDpC,IAAIloB,EAAO,CAACoC,KAAM,iCAClBv3B,KAAKk6E,kBAAkB,eAAWl5E,OAAWA,EAAWm0B,GACrDlc,MAAMkX,IACDA,EAAKxkB,KAAO,KAAOwkB,EAAKxkB,MAAQ,UACV,IAAfwkB,EAAKP,aAAsD,IAAtBO,EAAKP,OAAL,IAC9C5vB,KAAK68E,kBAGP78E,KAAK48B,SAAS,CAAC0qC,QAASn3C,EAAKP,OAAL,SAE5B,MACF,KxF9jDgC,EwF+jD9B,MAAMU,EAAQtwB,KAAKuwB,OAAOC,SAASq4C,GACnC,IAAKv4C,EACH,OAGFA,EAAMpwB,KAAK,SAAUonE,GAAS38D,OAAO4a,IACnCvlB,KAAK68E,kBACL78E,KAAKk8B,YAAY3W,EAAI7gB,QAAS,WAMtCq4E,kBAAkBlU,EAAWvB,GAC3B,MAAMh3C,EAAQtwB,KAAKuwB,OAAOC,SAASq4C,GAC9Bv4C,GAILA,EAAMpwB,KAAK,UAAWonE,GAGxBZ,iBAAiBmC,EAAWvB,GAC1B,MAAMh3C,EAAQtwB,KAAKuwB,OAAOC,SAASq4C,GAC9Bv4C,GAILA,EAAMpwB,KAAK,UAAWonE,GAGxB0V,oBAAoBnU,EAAWvB,EAASue,GACtC,MAAMv1D,EAAQtwB,KAAKuwB,OAAOC,SAASq4C,GAC9Bv4C,GAILA,EAAMpwB,KAAK,QAASonE,EAASue,GAG/B5I,uBAAuBpU,EAAWvB,EAASjmB,GACzC,MAAM/wB,EAAQtwB,KAAKuwB,OAAOC,SAASq4C,GAC9Bv4C,GAILA,EAAMpwB,KAAK,gBAAiBonE,EAASjmB,GAEvC67B,qBAAqBrU,EAAWvB,EAASue,GACvC,MAAMv1D,EAAQtwB,KAAKuwB,OAAOC,SAASq4C,GAC9Bv4C,GAILA,EAAMpwB,KAAK,SAAUonE,EAASue,GAGhChJ,kBACM78E,KAAKu7B,MAAMuqD,cACbnhF,QAAQC,IAAI,wBAAyB5E,KAAKu7B,MAAMuqD,aAChDlb,aAAa5qE,KAAKu7B,MAAMuqD,cAE1B9lF,KAAK48B,SAAS,CACZisC,eAAW7nE,EACXq8C,UxFloDyB,IwFsoD7B8/B,qBAAqB9sD,GACnB,MAAMC,EAAQtwB,KAAKuwB,OAAOC,SAASH,GAC9BC,IAGDA,EAAM44C,gBACRlpE,KAAKg6E,oBAAoBh6E,KAAKu7B,MAAMstC,WACpC7oE,KAAK48B,SAAS,CACZygB,UxF3oD8B,KwF+oDhCr9C,KAAK48B,SAAS,CACZwhD,iBAAiB,IAChB,IAAMp+E,KAAKg6E,oBAAoBh6E,KAAKu7B,MAAMstC,cAIjD+T,kBAAkBl5E,GAChB,GAAiB,QAAbA,EAAKs8C,KAGT,OAAQt8C,EAAK+J,OACX,IAAK,SACH9I,QAAQC,IAAI,WAAYlB,GACpBA,EAAKwO,MAAQlS,KAAKu7B,MAAM0I,UAE1BjkC,KAAK48B,SAAS,CACZisC,UAAWnlE,EAAKu0B,IAChBolB,UxFjqDgC,EwFkqDhCiqB,QAAS5jE,EAAKmuB,MAGlB,MACF,IAAK,SAGH,GAFAltB,QAAQC,IAAI,kCAAmClB,GAE7B,MAAdA,EAAK4sB,OAAiB5sB,EAAKwO,MAAQlS,KAAKu7B,MAAM0I,SAMhD,YALAjkC,KAAK48B,SAAS,CACZisC,UAAW,KACXxrB,UxF9qDmB,EwF+qDnBiqB,QAAS,OAIT5jE,EAAK4sB,OAAStwB,KAAKu7B,MAAMstC,WAE3B7oE,KAAK48B,SAAS,CAACygB,UxFlrDa,IwForD9B,MACF,IAAK,UAEHr9C,KAAK68E,mBAKX5wD,SACE,OACE,yBAAK5oB,GAAG,gBAAgB+vB,IAAKpzB,KAAKmvB,SAC/BnvB,KAAKu7B,MAAM8iD,mBACV,kBAAC,GAAD,CACE9tD,OAAQvwB,KAAKuwB,OACbsC,OAAQ7yB,KAAKu7B,MAAM+iD,kBACnBvrD,QAAS/yB,KAAKu7B,MAAMgjD,mBACpB3uD,OAAQ5vB,KAAKu7B,MAAMijD,kBACnBltD,MAAOtxB,KAAKu7B,MAAMkjD,iBAClBttD,KAAMnxB,KAAKk8E,sBACXpsD,YAAa9vB,KAAKm8E,gBAClB1qD,SAAUzxB,KAAKw8E,wBACfpsD,eAAiBC,IACXA,GAAarwB,KAAKu7B,MAAMiI,eAC1BxjC,KAAKg6E,oBAAoB,OAG7BtoD,QAAS1xB,KAAKk8B,cAEhB,KAEDl8B,KAAKu7B,MAAMmjD,qBACV,kBAACx4C,GAAD,CACE3V,OAAQvwB,KAAKuwB,OACboT,SAAU3jC,KAAKu7B,MAAMi0C,SACrBhsC,cAAexjC,KAAKu7B,MAAMiI,cAC1BS,SAAUjkC,KAAKu7B,MAAM0I,SAErB9S,KAAMnxB,KAAK08E,wBACXp2C,WAAYtmC,KAAK85E,WACjBtzC,cAAexmC,KAAKu7B,MAAMiL,cAC1Bb,iBAAkB3lC,KAAKomC,qBACvB1B,gBAAiB1kC,KAAKq7E,0BAGxB,KAEF,kBAACrvD,GAAD,CACEE,QAASlsB,KAAKu7B,MAAMojD,aACpBz2D,MAAOloB,KAAKu7B,MAAMqjD,YAAY12D,MAC9B7jB,QAASrE,KAAKu7B,MAAMqjD,YAAYv6E,QAChC+nB,SAAUpsB,KAAKu7B,MAAMqjD,YAAYxyD,SAAY,KAAQpsB,KAAK48B,SAAS,CAAC+hD,cAAc,KAAc,KAChGp0E,OAAQvK,KAAKu7B,MAAMqjD,YAAYr0E,OAC/BiiB,UAAW,KAAQxsB,KAAK48B,SAAS,CAAC+hD,cAAc,IAAS3+E,KAAKu7B,MAAMqjD,YAAYpyD,aAChFC,QAASzsB,KAAKu7B,MAAMqjD,YAAYnyD,UAElC,kBAAC,GAAD,CACE8D,OAAQvwB,KAAKuwB,OACbkU,UAAWzkC,KAAKu7B,MAAMkJ,UACtBkY,cAAe38C,KAAKu7B,MAAMohB,cAC1ByvB,SAAUpsE,KAAKu7B,MAAMohB,eAA4C,cAA3B38C,KAAKu7B,MAAM4iD,YACjD5iD,MAAOv7B,KAAKu7B,MAAMmiD,kBAClBx1D,MAAOloB,KAAKu7B,MAAMoiD,eAClBjmD,OAAQ13B,KAAKu7B,MAAMqiD,gBACnB71C,cAAe/nC,KAAKu7B,MAAMsiD,gBAC1BtN,MAAOvwE,KAAKu7B,MAAMg1C,MAClB8C,QAASrzE,KAAKu7B,MAAM83C,QACpBpvC,SAAUjkC,KAAKu7B,MAAM0I,SACrBmzC,cAAep3E,KAAKu7B,MAAM67C,cAC1BD,mBAAoBn3E,KAAKu7B,MAAM47C,mBAE/Bt6B,UAAW78C,KAAKu7B,MAAMshB,UACtBD,WAAY58C,KAAKu7B,MAAMqhB,WACvBq6B,YAAaj3E,KAAKu7B,MAAM07C,YACxBC,gBAAiBl3E,KAAKu7B,MAAM27C,gBAE5B1zC,cAAexjC,KAAKu7B,MAAMiI,cAC1BgsC,SAAUxvE,KAAKu7B,MAAMi0C,SACrB+G,WAAYv2E,KAAKu7B,MAAMg7C,WACvBD,SAAUt2E,KAAKu7B,MAAM+6C,SAErBV,UAAW51E,KAAKu7B,MAAMq6C,UACtB7D,cAAe/xE,KAAKu7B,MAAMw2C,cAC1BE,cAAejyE,KAAKu7B,MAAM02C,cAC1BD,qBAAsBhyE,KAAKu7B,MAAMy2C,qBACjCE,cAAelyE,KAAKu7B,MAAM22C,cAC1BtO,cAAe5jE,KAAKu7B,MAAMqoC,cAC1BD,cAAe3jE,KAAKu7B,MAAMooC,cAE1B2T,iBAAkBt3E,KAAK06E,qBACvB5L,SAAU9uE,KAAKo6E,iBACfxL,WAAY5uE,KAAKy6E,eACjBr+B,WAAYp8C,KAAKqkF,eACjBhN,eAAgBr3E,KAAKi5E,mBACrB3F,oBAAqBtzE,KAAKk5E,wBAC1BhI,gBAAiBlxE,KAAKq6E,wBACtBxH,oBAAqB7yE,KAAKu7E,yBAC1B3I,iBAAkB5yE,KAAKs6E,4BACvB/C,oBAAqBv3E,KAAKu6E,+BAC1B1I,0BAA2B7xE,KAAKk7E,eAChCtJ,sBAAuB5xE,KAAK66E,0BAC5B/I,sBAAuB9xE,KAAKw6E,0BAC5BhlC,UAAWx1C,KAAK86E,cAChBhlC,aAAc91C,KAAK+6E,iBACnBllC,cAAe71C,KAAKg7E,kBACpBt2C,gBAAiB1kC,KAAKg6E,oBACtBpF,cAAe50E,KAAKq7E,wBACpBrI,SAAUhzE,KAAK07E,aACf5I,gBAAiB9yE,KAAK0yE,oBACtB5iD,YAAa9vB,KAAKm8E,gBAClB98C,SAAUr/B,KAAKo7E,sBACf1pD,QAAS1xB,KAAKk8B,YACds7C,sBAAuBx3E,KAAKq8E,iCAC5B5E,uBAAwBz3E,KAAKs8E,2BAC7B5E,gBAAiB13E,KAAKu8E,oBACtB1M,cAAe7vE,KAAK26E,kBACpB1H,cAAejzE,KAAK46E,kBAEpBt0C,WAAYtmC,KAAK85E,WACjBtzC,cAAexmC,KAAKu7B,MAAMiL,cAC1Bb,iBAAkB3lC,KAAKomC,qBAEvBzE,gBAAiB3hC,KAAKg8E,wBAExB,kBAAC,GAAD,CACEzrD,OAAQvwB,KAAKuwB,OACbkU,UAAWzkC,KAAKu7B,MAAMkJ,UACtBkjC,MAAO3nE,KAAKu7B,MAAMosC,MAClB7lC,OAAQ9hC,KAAKu7B,MAAMwiD,oBACnB57C,IAAKniC,KAAKu7B,MAAMyiD,iBAChBrhC,cAAe38C,KAAKu7B,MAAMohB,cAC1B5c,cAAe//B,KAAKu7B,MAAMwE,cAC1Bi/C,eAAgBh/E,KAAKu7B,MAAMyjD,eAC3B5S,SAAUpsE,KAAKu7B,MAAMohB,gBACS,eAA3B38C,KAAKu7B,MAAM4iD,aAAgCn+E,KAAKu7B,MAAM2iD,WACzD5tD,MAAOtwB,KAAKu7B,MAAMiI,cAClBS,SAAUjkC,KAAKu7B,MAAM0I,SAErB8hD,WAAY/lF,KAAKu7B,MAAMoiD,eACvBha,cAAe3jE,KAAKu7B,MAAMooC,cAC1BC,cAAe5jE,KAAKu7B,MAAMqoC,cAC1B8D,mBAAoB1nE,KAAKu7B,MAAMmsC,mBAE/BM,eAAgBhoE,KAAKu7B,MAAMysC,eAC3BgE,uBAAwBhsE,KAAK08E,wBAE7B7T,UAAW7oE,KAAKu7B,MAAMstC,UACtBvB,QAAStnE,KAAKu7B,MAAM+rC,QACpBjqB,UAAWr9C,KAAKu7B,MAAM8hB,UACtBquB,aAAc1rE,KAAK0mE,iBAEnB4F,aAActsE,KAAK88E,iBACnBvQ,gBAAiBvsE,KAAKg9E,oBACtBxQ,mBAAoBxsE,KAAKi9E,uBACzBxQ,iBAAkBzsE,KAAKk9E,qBAEvBrgC,UAAW78C,KAAKu7B,MAAMshB,UACtBD,WAAY58C,KAAKu7B,MAAMqhB,WACvBq6B,YAAaj3E,KAAKu7B,MAAM07C,YACxBC,gBAAiBl3E,KAAKu7B,MAAM27C,gBAE5B9N,eAAgBppE,KAAKu7B,MAAM6tC,eAE3B1mB,mBAAoB1iD,KAAKi6E,uBACzB1S,OAAQvnE,KAAK65E,OACbnoD,QAAS1xB,KAAKk8B,YACd0tC,kBAAmB5pE,KAAKs7E,sBACxB35C,gBAAiB3hC,KAAKg8E,sBACtB/gC,oBAAqBj7C,KAAKw7E,wBAC1BvQ,UAAWjrE,KAAKm6E,wBAChBjV,YAAallE,KAAKk6E,kBAClBzO,kBAAmBzrE,KAAK68E,kBAEzB78E,KAAKu7B,MAAM2iD,UACV,kBAAC,GAAD,CACE3tD,OAAQvwB,KAAKuwB,OACbkU,UAAWzkC,KAAKu7B,MAAMkJ,UACtBkY,cAAe38C,KAAKu7B,MAAMohB,cAC1BrsB,MAAOtwB,KAAKu7B,MAAMiI,cAClBsZ,mBAAoB98C,KAAKu7B,MAAMuhB,mBAC/B7Y,SAAUjkC,KAAKu7B,MAAM0I,SACrBqY,MAAOt8C,KAAKu7B,MAAM2iD,UAElBrhC,UAAW78C,KAAKu7B,MAAMshB,UACtBD,WAAY58C,KAAKu7B,MAAMqhB,WACvBq6B,YAAaj3E,KAAKu7B,MAAM07C,YACxBC,gBAAiBl3E,KAAKu7B,MAAM27C,gBAE5B96B,WAAYp8C,KAAKskF,cACjBhpC,yBAA0Bt7C,KAAKu7E,yBAC/BzrD,YAAa9vB,KAAKm8E,gBAClBlhC,oBAAqBj7C,KAAKw7E,wBAC1Bn/B,sBAAuBr8C,KAAKq5C,0BAC5BxC,cAAe72C,KAAK27E,yBACpB7kC,iBAAkB92C,KAAK47E,4BACvB7kC,aAAc/2C,KAAK67E,wBACnB7kC,aAAch3C,KAAK87E,wBACnB7kC,cAAej3C,KAAK+7E,kBACpBiK,YAAahmF,KAAKimF,yBAClBxwC,yBAA0Bz1C,KAAKy7E,wBAC/BtgC,iBAAkBn7C,KAAKi5C,gBACvB3S,WAAYtmC,KAAK85E,WACjBpoD,QAAS1xB,KAAKk8B,YAEdyF,gBAAiB3hC,KAAKg8E,wBAGxB,KAGDh8E,KAAKu7B,MAAMstC,WxFt4DwB,GwFs4DX7oE,KAAKu7B,MAAM8hB,UAClC,kBAAC,GAAD,CACE9sB,OAAQvwB,KAAKuwB,OACbmtB,QAAS19C,KAAK68E,gBACdvsD,MAAOtwB,KAAKu7B,MAAMstC,UAClBh3C,IAAK7xB,KAAKu7B,MAAM+rC,QAChBjqB,UAAWr9C,KAAKu7B,MAAM8hB,UACtBE,UAAWv9C,KAAK+8E,kBAChBt/B,aAAcz9C,KAAKm9E,qBACnB/wD,SAAUpsB,KAAK0mE,mBAGjB,OAOV,UAAerzC,EAAAA,EAAAA,YAAWqlD,KC3/DpB,OAAE9oD,IAAWk0C,GAAeI,aAAax9D,OAAO8kD,SAAS12B,MACzDm5C,GAAYr+C,IAAUA,GAAOs2D,IAChCrmE,UAAUsmE,WAAatmE,UAAUsmE,UAAU,IAC5CtmE,UAAUouD,UACVpuD,UAAUmuD,cACV,KAGIoY,GAAenY,GAASlqC,cAAcnJ,MAAM,QAAQ,GAGpDyrD,GAAWC,EAAYrY,IAAYA,GAAWqY,EAAYF,IAAgBA,GAAe,KACzFv4D,GAAWy4D,EAAYD,IAG7Bx1D,SAASuE,qBAAqB,QAAQ,GAAGmxD,aAAa,OAAQF,IAE9Dt/E,IAAAA,OACE,kBAAC,eAAD,KACE,kBAAC,EAAAy/E,aAAD,CAAchxB,OAAQyY,GAAUpgD,SAAUA,GAAU2rC,cAAe1yD,IAAAA,UACjE,kBAAC,GAAD,QAGJ+pB,SAASqE,eAAe,gB","sources":["webpack://tinode-webapp/./node_modules/fix-webm-duration/fix-webm-duration.js","webpack://tinode-webapp/webpack/bootstrap","webpack://tinode-webapp/webpack/runtime/compat get default export","webpack://tinode-webapp/webpack/runtime/define property getters","webpack://tinode-webapp/webpack/runtime/global","webpack://tinode-webapp/webpack/runtime/hasOwnProperty shorthand","webpack://tinode-webapp/external var \"React\"","webpack://tinode-webapp/external var \"ReactDOM\"","webpack://tinode-webapp/external var \"ReactIntl\"","webpack://tinode-webapp/./node_modules/@firebase/util/dist/index.esm2017.js","webpack://tinode-webapp/./node_modules/@firebase/component/dist/esm/index.esm2017.js","webpack://tinode-webapp/./node_modules/@firebase/logger/dist/esm/index.esm2017.js","webpack://tinode-webapp/./node_modules/@firebase/app/dist/esm/index.esm2017.js","webpack://tinode-webapp/./node_modules/firebase/app/dist/index.esm.js","webpack://tinode-webapp/./node_modules/@firebase/installations/dist/esm/index.esm2017.js","webpack://tinode-webapp/./node_modules/@firebase/messaging/dist/esm/index.esm2017.js","webpack://tinode-webapp/external var \"Tinode\"","webpack://tinode-webapp/./src/widgets/alert.jsx","webpack://tinode-webapp/./src/version.js","webpack://tinode-webapp/./src/config.js","webpack://tinode-webapp/./src/widgets/context-menu.jsx","webpack://tinode-webapp/./src/widgets/contact-badges.jsx","webpack://tinode-webapp/./src/lib/strformat.js","webpack://tinode-webapp/./src/lib/utils.js","webpack://tinode-webapp/./src/widgets/letter-tile.jsx","webpack://tinode-webapp/./src/widgets/unread-badge.jsx","webpack://tinode-webapp/./src/lib/blob-helpers.js","webpack://tinode-webapp/./src/widgets/audio-player.jsx","webpack://tinode-webapp/./src/widgets/lazy-image.jsx","webpack://tinode-webapp/./src/widgets/file-progress.jsx","webpack://tinode-webapp/./src/widgets/uploading-image.jsx","webpack://tinode-webapp/./src/lib/formatters.js","webpack://tinode-webapp/./src/widgets/contact.jsx","webpack://tinode-webapp/./src/widgets/contact-action.jsx","webpack://tinode-webapp/./src/widgets/contact-list.jsx","webpack://tinode-webapp/./src/widgets/search-contacts.jsx","webpack://tinode-webapp/./src/widgets/forward-dialog.jsx","webpack://tinode-webapp/./src/widgets/load-spinner.jsx","webpack://tinode-webapp/./src/widgets/avatar-upload.jsx","webpack://tinode-webapp/./src/widgets/badge-list.jsx","webpack://tinode-webapp/./src/widgets/checkbox.jsx","webpack://tinode-webapp/./src/widgets/menu-cancel.jsx","webpack://tinode-webapp/./src/widgets/error-panel.jsx","webpack://tinode-webapp/./src/widgets/chip.jsx","webpack://tinode-webapp/./src/widgets/chip-input.jsx","webpack://tinode-webapp/./src/widgets/group-manager.jsx","webpack://tinode-webapp/./src/widgets/permissions-editor.jsx","webpack://tinode-webapp/./src/widgets/cropper.jsx","webpack://tinode-webapp/./src/widgets/avatar-crop.jsx","webpack://tinode-webapp/./src/widgets/visible-password.jsx","webpack://tinode-webapp/./src/widgets/in-place-edit.jsx","webpack://tinode-webapp/./src/widgets/tag-manager.jsx","webpack://tinode-webapp/./src/widgets/topic-desc-edit.jsx","webpack://tinode-webapp/./src/widgets/topic-common.jsx","webpack://tinode-webapp/./src/widgets/topic-security.jsx","webpack://tinode-webapp/./src/views/info-view.jsx","webpack://tinode-webapp/./src/views/incoming-call-view.jsx","webpack://tinode-webapp/./src/widgets/call-panel.jsx","webpack://tinode-webapp/./node_modules/tslib/tslib.es6.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-messageformat-parser/lib/error.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-messageformat-parser/lib/types.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-messageformat-parser/lib/regex.generated.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-skeleton-parser/lib/date-time.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-skeleton-parser/lib/regex.generated.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-skeleton-parser/lib/number.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-messageformat-parser/lib/parser.js","webpack://tinode-webapp/./node_modules/@formatjs/icu-messageformat-parser/lib/index.js","webpack://tinode-webapp/./node_modules/@formatjs/fast-memoize/lib/index.js","webpack://tinode-webapp/./node_modules/intl-messageformat/lib/src/error.js","webpack://tinode-webapp/./node_modules/intl-messageformat/lib/src/formatters.js","webpack://tinode-webapp/./node_modules/intl-messageformat/lib/src/core.js","webpack://tinode-webapp/./node_modules/react-intl-formatted-duration/dist/module.js","webpack://tinode-webapp/./node_modules/intl-messageformat/lib/index.js","webpack://tinode-webapp/./src/widgets/attachment.jsx","webpack://tinode-webapp/./src/widgets/received-marker.jsx","webpack://tinode-webapp/./src/widgets/chat-message.jsx","webpack://tinode-webapp/./src/widgets/audio-recorder.jsx","webpack://tinode-webapp/./src/widgets/send-message.jsx","webpack://tinode-webapp/./src/widgets/doc-preview.jsx","webpack://tinode-webapp/./src/widgets/group-subs.jsx","webpack://tinode-webapp/./src/widgets/image-preview.jsx","webpack://tinode-webapp/./src/widgets/invitation.jsx","webpack://tinode-webapp/./src/views/logo-view.jsx","webpack://tinode-webapp/./src/widgets/meta-message.jsx","webpack://tinode-webapp/./src/lib/navigation.js","webpack://tinode-webapp/./src/views/messages-view.jsx","webpack://tinode-webapp/./src/widgets/button-back.jsx","webpack://tinode-webapp/./src/widgets/menu-contacts.jsx","webpack://tinode-webapp/./src/widgets/menu-start.jsx","webpack://tinode-webapp/./src/widgets/side-navbar.jsx","webpack://tinode-webapp/./src/views/account-settings-view.jsx","webpack://tinode-webapp/./src/views/contacts-view.jsx","webpack://tinode-webapp/./src/lib/local-storage.js","webpack://tinode-webapp/./src/views/create-account-view.jsx","webpack://tinode-webapp/./src/views/acc-notifications-view.jsx","webpack://tinode-webapp/./src/views/acc-security-view.jsx","webpack://tinode-webapp/./src/views/acc-support-view.jsx","webpack://tinode-webapp/./src/views/login-view.jsx","webpack://tinode-webapp/./src/widgets/new-topic-by-id.jsx","webpack://tinode-webapp/./src/widgets/new-topic-group.jsx","webpack://tinode-webapp/./src/views/new-topic-view.jsx","webpack://tinode-webapp/./src/views/password-reset-view.jsx","webpack://tinode-webapp/./src/widgets/host-selector.jsx","webpack://tinode-webapp/./src/views/settings-view.jsx","webpack://tinode-webapp/./src/views/validation-view.jsx","webpack://tinode-webapp/./src/views/sidepanel-view.jsx","webpack://tinode-webapp/./src/lib/host-name.js","webpack://tinode-webapp/./src/views/tinode-web.jsx","webpack://tinode-webapp/./src/index.js"],"sourcesContent":["(function (name, definition) {\r\n    if (typeof define === 'function' && define.amd) { // RequireJS / AMD\r\n        define(definition);\r\n    } else if (typeof module !== 'undefined' && module.exports) { // CommonJS / Node.js\r\n        module.exports = definition();\r\n    } else { // Direct include\r\n        window.ysFixWebmDuration = definition();\r\n    }\r\n})('fix-webm-duration', function () {\r\n    /*\r\n     * This is the list of possible WEBM file sections by their IDs.\r\n     * Possible types: Container, Binary, Uint, Int, String, Float, Date\r\n     */\r\n    var sections = {\r\n        0xa45dfa3: { name: 'EBML', type: 'Container' },\r\n        0x286: { name: 'EBMLVersion', type: 'Uint' },\r\n        0x2f7: { name: 'EBMLReadVersion', type: 'Uint' },\r\n        0x2f2: { name: 'EBMLMaxIDLength', type: 'Uint' },\r\n        0x2f3: { name: 'EBMLMaxSizeLength', type: 'Uint' },\r\n        0x282: { name: 'DocType', type: 'String' },\r\n        0x287: { name: 'DocTypeVersion', type: 'Uint' },\r\n        0x285: { name: 'DocTypeReadVersion', type: 'Uint' },\r\n        0x6c: { name: 'Void', type: 'Binary' },\r\n        0x3f: { name: 'CRC-32', type: 'Binary' },\r\n        0xb538667: { name: 'SignatureSlot', type: 'Container' },\r\n        0x3e8a: { name: 'SignatureAlgo', type: 'Uint' },\r\n        0x3e9a: { name: 'SignatureHash', type: 'Uint' },\r\n        0x3ea5: { name: 'SignaturePublicKey', type: 'Binary' },\r\n        0x3eb5: { name: 'Signature', type: 'Binary' },\r\n        0x3e5b: { name: 'SignatureElements', type: 'Container' },\r\n        0x3e7b: { name: 'SignatureElementList', type: 'Container' },\r\n        0x2532: { name: 'SignedElement', type: 'Binary' },\r\n        0x8538067: { name: 'Segment', type: 'Container' },\r\n        0x14d9b74: { name: 'SeekHead', type: 'Container' },\r\n        0xdbb: { name: 'Seek', type: 'Container' },\r\n        0x13ab: { name: 'SeekID', type: 'Binary' },\r\n        0x13ac: { name: 'SeekPosition', type: 'Uint' },\r\n        0x549a966: { name: 'Info', type: 'Container' },\r\n        0x33a4: { name: 'SegmentUID', type: 'Binary' },\r\n        0x3384: { name: 'SegmentFilename', type: 'String' },\r\n        0x1cb923: { name: 'PrevUID', type: 'Binary' },\r\n        0x1c83ab: { name: 'PrevFilename', type: 'String' },\r\n        0x1eb923: { name: 'NextUID', type: 'Binary' },\r\n        0x1e83bb: { name: 'NextFilename', type: 'String' },\r\n        0x444: { name: 'SegmentFamily', type: 'Binary' },\r\n        0x2924: { name: 'ChapterTranslate', type: 'Container' },\r\n        0x29fc: { name: 'ChapterTranslateEditionUID', type: 'Uint' },\r\n        0x29bf: { name: 'ChapterTranslateCodec', type: 'Uint' },\r\n        0x29a5: { name: 'ChapterTranslateID', type: 'Binary' },\r\n        0xad7b1: { name: 'TimecodeScale', type: 'Uint' },\r\n        0x489: { name: 'Duration', type: 'Float' },\r\n        0x461: { name: 'DateUTC', type: 'Date' },\r\n        0x3ba9: { name: 'Title', type: 'String' },\r\n        0xd80: { name: 'MuxingApp', type: 'String' },\r\n        0x1741: { name: 'WritingApp', type: 'String' },\r\n        // 0xf43b675: { name: 'Cluster', type: 'Container' },\r\n        0x67: { name: 'Timecode', type: 'Uint' },\r\n        0x1854: { name: 'SilentTracks', type: 'Container' },\r\n        0x18d7: { name: 'SilentTrackNumber', type: 'Uint' },\r\n        0x27: { name: 'Position', type: 'Uint' },\r\n        0x2b: { name: 'PrevSize', type: 'Uint' },\r\n        0x23: { name: 'SimpleBlock', type: 'Binary' },\r\n        0x20: { name: 'BlockGroup', type: 'Container' },\r\n        0x21: { name: 'Block', type: 'Binary' },\r\n        0x22: { name: 'BlockVirtual', type: 'Binary' },\r\n        0x35a1: { name: 'BlockAdditions', type: 'Container' },\r\n        0x26: { name: 'BlockMore', type: 'Container' },\r\n        0x6e: { name: 'BlockAddID', type: 'Uint' },\r\n        0x25: { name: 'BlockAdditional', type: 'Binary' },\r\n        0x1b: { name: 'BlockDuration', type: 'Uint' },\r\n        0x7a: { name: 'ReferencePriority', type: 'Uint' },\r\n        0x7b: { name: 'ReferenceBlock', type: 'Int' },\r\n        0x7d: { name: 'ReferenceVirtual', type: 'Int' },\r\n        0x24: { name: 'CodecState', type: 'Binary' },\r\n        0x35a2: { name: 'DiscardPadding', type: 'Int' },\r\n        0xe: { name: 'Slices', type: 'Container' },\r\n        0x68: { name: 'TimeSlice', type: 'Container' },\r\n        0x4c: { name: 'LaceNumber', type: 'Uint' },\r\n        0x4d: { name: 'FrameNumber', type: 'Uint' },\r\n        0x4b: { name: 'BlockAdditionID', type: 'Uint' },\r\n        0x4e: { name: 'Delay', type: 'Uint' },\r\n        0x4f: { name: 'SliceDuration', type: 'Uint' },\r\n        0x48: { name: 'ReferenceFrame', type: 'Container' },\r\n        0x49: { name: 'ReferenceOffset', type: 'Uint' },\r\n        0x4a: { name: 'ReferenceTimeCode', type: 'Uint' },\r\n        0x2f: { name: 'EncryptedBlock', type: 'Binary' },\r\n        0x654ae6b: { name: 'Tracks', type: 'Container' },\r\n        0x2e: { name: 'TrackEntry', type: 'Container' },\r\n        0x57: { name: 'TrackNumber', type: 'Uint' },\r\n        0x33c5: { name: 'TrackUID', type: 'Uint' },\r\n        0x3: { name: 'TrackType', type: 'Uint' },\r\n        0x39: { name: 'FlagEnabled', type: 'Uint' },\r\n        0x8: { name: 'FlagDefault', type: 'Uint' },\r\n        0x15aa: { name: 'FlagForced', type: 'Uint' },\r\n        0x1c: { name: 'FlagLacing', type: 'Uint' },\r\n        0x2de7: { name: 'MinCache', type: 'Uint' },\r\n        0x2df8: { name: 'MaxCache', type: 'Uint' },\r\n        0x3e383: { name: 'DefaultDuration', type: 'Uint' },\r\n        0x34e7a: { name: 'DefaultDecodedFieldDuration', type: 'Uint' },\r\n        0x3314f: { name: 'TrackTimecodeScale', type: 'Float' },\r\n        0x137f: { name: 'TrackOffset', type: 'Int' },\r\n        0x15ee: { name: 'MaxBlockAdditionID', type: 'Uint' },\r\n        0x136e: { name: 'Name', type: 'String' },\r\n        0x2b59c: { name: 'Language', type: 'String' },\r\n        0x6: { name: 'CodecID', type: 'String' },\r\n        0x23a2: { name: 'CodecPrivate', type: 'Binary' },\r\n        0x58688: { name: 'CodecName', type: 'String' },\r\n        0x3446: { name: 'AttachmentLink', type: 'Uint' },\r\n        0x1a9697: { name: 'CodecSettings', type: 'String' },\r\n        0x1b4040: { name: 'CodecInfoURL', type: 'String' },\r\n        0x6b240: { name: 'CodecDownloadURL', type: 'String' },\r\n        0x2a: { name: 'CodecDecodeAll', type: 'Uint' },\r\n        0x2fab: { name: 'TrackOverlay', type: 'Uint' },\r\n        0x16aa: { name: 'CodecDelay', type: 'Uint' },\r\n        0x16bb: { name: 'SeekPreRoll', type: 'Uint' },\r\n        0x2624: { name: 'TrackTranslate', type: 'Container' },\r\n        0x26fc: { name: 'TrackTranslateEditionUID', type: 'Uint' },\r\n        0x26bf: { name: 'TrackTranslateCodec', type: 'Uint' },\r\n        0x26a5: { name: 'TrackTranslateTrackID', type: 'Binary' },\r\n        0x60: { name: 'Video', type: 'Container' },\r\n        0x1a: { name: 'FlagInterlaced', type: 'Uint' },\r\n        0x13b8: { name: 'StereoMode', type: 'Uint' },\r\n        0x13c0: { name: 'AlphaMode', type: 'Uint' },\r\n        0x13b9: { name: 'OldStereoMode', type: 'Uint' },\r\n        0x30: { name: 'PixelWidth', type: 'Uint' },\r\n        0x3a: { name: 'PixelHeight', type: 'Uint' },\r\n        0x14aa: { name: 'PixelCropBottom', type: 'Uint' },\r\n        0x14bb: { name: 'PixelCropTop', type: 'Uint' },\r\n        0x14cc: { name: 'PixelCropLeft', type: 'Uint' },\r\n        0x14dd: { name: 'PixelCropRight', type: 'Uint' },\r\n        0x14b0: { name: 'DisplayWidth', type: 'Uint' },\r\n        0x14ba: { name: 'DisplayHeight', type: 'Uint' },\r\n        0x14b2: { name: 'DisplayUnit', type: 'Uint' },\r\n        0x14b3: { name: 'AspectRatioType', type: 'Uint' },\r\n        0xeb524: { name: 'ColourSpace', type: 'Binary' },\r\n        0xfb523: { name: 'GammaValue', type: 'Float' },\r\n        0x383e3: { name: 'FrameRate', type: 'Float' },\r\n        0x61: { name: 'Audio', type: 'Container' },\r\n        0x35: { name: 'SamplingFrequency', type: 'Float' },\r\n        0x38b5: { name: 'OutputSamplingFrequency', type: 'Float' },\r\n        0x1f: { name: 'Channels', type: 'Uint' },\r\n        0x3d7b: { name: 'ChannelPositions', type: 'Binary' },\r\n        0x2264: { name: 'BitDepth', type: 'Uint' },\r\n        0x62: { name: 'TrackOperation', type: 'Container' },\r\n        0x63: { name: 'TrackCombinePlanes', type: 'Container' },\r\n        0x64: { name: 'TrackPlane', type: 'Container' },\r\n        0x65: { name: 'TrackPlaneUID', type: 'Uint' },\r\n        0x66: { name: 'TrackPlaneType', type: 'Uint' },\r\n        0x69: { name: 'TrackJoinBlocks', type: 'Container' },\r\n        0x6d: { name: 'TrackJoinUID', type: 'Uint' },\r\n        0x40: { name: 'TrickTrackUID', type: 'Uint' },\r\n        0x41: { name: 'TrickTrackSegmentUID', type: 'Binary' },\r\n        0x46: { name: 'TrickTrackFlag', type: 'Uint' },\r\n        0x47: { name: 'TrickMasterTrackUID', type: 'Uint' },\r\n        0x44: { name: 'TrickMasterTrackSegmentUID', type: 'Binary' },\r\n        0x2d80: { name: 'ContentEncodings', type: 'Container' },\r\n        0x2240: { name: 'ContentEncoding', type: 'Container' },\r\n        0x1031: { name: 'ContentEncodingOrder', type: 'Uint' },\r\n        0x1032: { name: 'ContentEncodingScope', type: 'Uint' },\r\n        0x1033: { name: 'ContentEncodingType', type: 'Uint' },\r\n        0x1034: { name: 'ContentCompression', type: 'Container' },\r\n        0x254: { name: 'ContentCompAlgo', type: 'Uint' },\r\n        0x255: { name: 'ContentCompSettings', type: 'Binary' },\r\n        0x1035: { name: 'ContentEncryption', type: 'Container' },\r\n        0x7e1: { name: 'ContentEncAlgo', type: 'Uint' },\r\n        0x7e2: { name: 'ContentEncKeyID', type: 'Binary' },\r\n        0x7e3: { name: 'ContentSignature', type: 'Binary' },\r\n        0x7e4: { name: 'ContentSigKeyID', type: 'Binary' },\r\n        0x7e5: { name: 'ContentSigAlgo', type: 'Uint' },\r\n        0x7e6: { name: 'ContentSigHashAlgo', type: 'Uint' },\r\n        0xc53bb6b: { name: 'Cues', type: 'Container' },\r\n        0x3b: { name: 'CuePoint', type: 'Container' },\r\n        0x33: { name: 'CueTime', type: 'Uint' },\r\n        0x37: { name: 'CueTrackPositions', type: 'Container' },\r\n        0x77: { name: 'CueTrack', type: 'Uint' },\r\n        0x71: { name: 'CueClusterPosition', type: 'Uint' },\r\n        0x70: { name: 'CueRelativePosition', type: 'Uint' },\r\n        0x32: { name: 'CueDuration', type: 'Uint' },\r\n        0x1378: { name: 'CueBlockNumber', type: 'Uint' },\r\n        0x6a: { name: 'CueCodecState', type: 'Uint' },\r\n        0x5b: { name: 'CueReference', type: 'Container' },\r\n        0x16: { name: 'CueRefTime', type: 'Uint' },\r\n        0x17: { name: 'CueRefCluster', type: 'Uint' },\r\n        0x135f: { name: 'CueRefNumber', type: 'Uint' },\r\n        0x6b: { name: 'CueRefCodecState', type: 'Uint' },\r\n        0x941a469: { name: 'Attachments', type: 'Container' },\r\n        0x21a7: { name: 'AttachedFile', type: 'Container' },\r\n        0x67e: { name: 'FileDescription', type: 'String' },\r\n        0x66e: { name: 'FileName', type: 'String' },\r\n        0x660: { name: 'FileMimeType', type: 'String' },\r\n        0x65c: { name: 'FileData', type: 'Binary' },\r\n        0x6ae: { name: 'FileUID', type: 'Uint' },\r\n        0x675: { name: 'FileReferral', type: 'Binary' },\r\n        0x661: { name: 'FileUsedStartTime', type: 'Uint' },\r\n        0x662: { name: 'FileUsedEndTime', type: 'Uint' },\r\n        0x43a770: { name: 'Chapters', type: 'Container' },\r\n        0x5b9: { name: 'EditionEntry', type: 'Container' },\r\n        0x5bc: { name: 'EditionUID', type: 'Uint' },\r\n        0x5bd: { name: 'EditionFlagHidden', type: 'Uint' },\r\n        0x5db: { name: 'EditionFlagDefault', type: 'Uint' },\r\n        0x5dd: { name: 'EditionFlagOrdered', type: 'Uint' },\r\n        0x36: { name: 'ChapterAtom', type: 'Container' },\r\n        0x33c4: { name: 'ChapterUID', type: 'Uint' },\r\n        0x1654: { name: 'ChapterStringUID', type: 'String' },\r\n        0x11: { name: 'ChapterTimeStart', type: 'Uint' },\r\n        0x12: { name: 'ChapterTimeEnd', type: 'Uint' },\r\n        0x18: { name: 'ChapterFlagHidden', type: 'Uint' },\r\n        0x598: { name: 'ChapterFlagEnabled', type: 'Uint' },\r\n        0x2e67: { name: 'ChapterSegmentUID', type: 'Binary' },\r\n        0x2ebc: { name: 'ChapterSegmentEditionUID', type: 'Uint' },\r\n        0x23c3: { name: 'ChapterPhysicalEquiv', type: 'Uint' },\r\n        0xf: { name: 'ChapterTrack', type: 'Container' },\r\n        0x9: { name: 'ChapterTrackNumber', type: 'Uint' },\r\n        0x0: { name: 'ChapterDisplay', type: 'Container' },\r\n        0x5: { name: 'ChapString', type: 'String' },\r\n        0x37c: { name: 'ChapLanguage', type: 'String' },\r\n        0x37e: { name: 'ChapCountry', type: 'String' },\r\n        0x2944: { name: 'ChapProcess', type: 'Container' },\r\n        0x2955: { name: 'ChapProcessCodecID', type: 'Uint' },\r\n        0x50d: { name: 'ChapProcessPrivate', type: 'Binary' },\r\n        0x2911: { name: 'ChapProcessCommand', type: 'Container' },\r\n        0x2922: { name: 'ChapProcessTime', type: 'Uint' },\r\n        0x2933: { name: 'ChapProcessData', type: 'Binary' },\r\n        0x254c367: { name: 'Tags', type: 'Container' },\r\n        0x3373: { name: 'Tag', type: 'Container' },\r\n        0x23c0: { name: 'Targets', type: 'Container' },\r\n        0x28ca: { name: 'TargetTypeValue', type: 'Uint' },\r\n        0x23ca: { name: 'TargetType', type: 'String' },\r\n        0x23c5: { name: 'TagTrackUID', type: 'Uint' },\r\n        0x23c9: { name: 'TagEditionUID', type: 'Uint' },\r\n        0x23c4: { name: 'TagChapterUID', type: 'Uint' },\r\n        0x23c6: { name: 'TagAttachmentUID', type: 'Uint' },\r\n        0x27c8: { name: 'SimpleTag', type: 'Container' },\r\n        0x5a3: { name: 'TagName', type: 'String' },\r\n        0x47a: { name: 'TagLanguage', type: 'String' },\r\n        0x484: { name: 'TagDefault', type: 'Uint' },\r\n        0x487: { name: 'TagString', type: 'String' },\r\n        0x485: { name: 'TagBinary', type: 'Binary' }\r\n    };\r\n\r\n    function doInherit(newClass, baseClass) {\r\n        newClass.prototype = Object.create(baseClass.prototype);\r\n        newClass.prototype.constructor = newClass;\r\n    }\r\n\r\n    function WebmBase(name, type) {\r\n        this.name = name || 'Unknown';\r\n        this.type = type || 'Unknown';\r\n    }\r\n    WebmBase.prototype.updateBySource = function() { };\r\n    WebmBase.prototype.setSource = function(source) {\r\n        this.source = source;\r\n        this.updateBySource();\r\n    };\r\n    WebmBase.prototype.updateByData = function() { };\r\n    WebmBase.prototype.setData = function(data) {\r\n        this.data = data;\r\n        this.updateByData();\r\n    };\r\n\r\n    function WebmUint(name, type) {\r\n        WebmBase.call(this, name, type || 'Uint');\r\n    }\r\n    doInherit(WebmUint, WebmBase);\r\n    function padHex(hex) {\r\n        return hex.length % 2 === 1 ? '0' + hex : hex;\r\n    }\r\n    WebmUint.prototype.updateBySource = function() {\r\n        // use hex representation of a number instead of number value\r\n        this.data = '';\r\n        for (var i = 0; i < this.source.length; i++) {\r\n            var hex = this.source[i].toString(16);\r\n            this.data += padHex(hex);\r\n        }\r\n    };\r\n    WebmUint.prototype.updateByData = function() {\r\n        var length = this.data.length / 2;\r\n        this.source = new Uint8Array(length);\r\n        for (var i = 0; i < length; i++) {\r\n            var hex = this.data.substr(i * 2, 2);\r\n            this.source[i] = parseInt(hex, 16);\r\n        }\r\n    };\r\n    WebmUint.prototype.getValue = function() {\r\n        return parseInt(this.data, 16);\r\n    };\r\n    WebmUint.prototype.setValue = function(value) {\r\n        this.setData(padHex(value.toString(16)));\r\n    };\r\n\r\n    function WebmFloat(name, type) {\r\n        WebmBase.call(this, name, type || 'Float');\r\n    }\r\n    doInherit(WebmFloat, WebmBase);\r\n    WebmFloat.prototype.getFloatArrayType = function() {\r\n        return this.source && this.source.length === 4 ? Float32Array : Float64Array;\r\n    };\r\n    WebmFloat.prototype.updateBySource = function() {\r\n        var byteArray = this.source.reverse();\r\n        var floatArrayType = this.getFloatArrayType();\r\n        var floatArray = new floatArrayType(byteArray.buffer);\r\n        this.data = floatArray[0];\r\n    };\r\n    WebmFloat.prototype.updateByData = function() {\r\n        var floatArrayType = this.getFloatArrayType();\r\n        var floatArray = new floatArrayType([ this.data ]);\r\n        var byteArray = new Uint8Array(floatArray.buffer);\r\n        this.source = byteArray.reverse();\r\n    };\r\n    WebmFloat.prototype.getValue = function() {\r\n        return this.data;\r\n    };\r\n    WebmFloat.prototype.setValue = function(value) {\r\n        this.setData(value);\r\n    };\r\n\r\n    function WebmContainer(name, type) {\r\n        WebmBase.call(this, name, type || 'Container');\r\n    }\r\n    doInherit(WebmContainer, WebmBase);\r\n    WebmContainer.prototype.readByte = function() {\r\n        return this.source[this.offset++];\r\n    };\r\n    WebmContainer.prototype.readUint = function() {\r\n        var firstByte = this.readByte();\r\n        var bytes = 8 - firstByte.toString(2).length;\r\n        var value = firstByte - (1 << (7 - bytes));\r\n        for (var i = 0; i < bytes; i++) {\r\n            // don't use bit operators to support x86\r\n            value *= 256;\r\n            value += this.readByte();\r\n        }\r\n        return value;\r\n    };\r\n    WebmContainer.prototype.updateBySource = function() {\r\n        this.data = [];\r\n        for (this.offset = 0; this.offset < this.source.length; this.offset = end) {\r\n            var id = this.readUint();\r\n            var len = this.readUint();\r\n            var end = Math.min(this.offset + len, this.source.length);\r\n            var data = this.source.slice(this.offset, end);\r\n\r\n            var info = sections[id] || { name: 'Unknown', type: 'Unknown' };\r\n            var ctr = WebmBase;\r\n            switch (info.type) {\r\n                case 'Container':\r\n                    ctr = WebmContainer;\r\n                    break;\r\n                case 'Uint':\r\n                    ctr = WebmUint;\r\n                    break;\r\n                case 'Float':\r\n                    ctr = WebmFloat;\r\n                    break;\r\n            }\r\n            var section = new ctr(info.name, info.type);\r\n            section.setSource(data);\r\n            this.data.push({\r\n                id: id,\r\n                idHex: id.toString(16),\r\n                data: section\r\n            });\r\n        }\r\n    };\r\n    WebmContainer.prototype.writeUint = function(x, draft) {\r\n        for (var bytes = 1, flag = 0x80; x >= flag && bytes < 8; bytes++, flag *= 0x80) { }\r\n\r\n        if (!draft) {\r\n            var value = flag + x;\r\n            for (var i = bytes - 1; i >= 0; i--) {\r\n                // don't use bit operators to support x86\r\n                var c = value % 256;\r\n                this.source[this.offset + i] = c;\r\n                value = (value - c) / 256;\r\n            }\r\n        }\r\n\r\n        this.offset += bytes;\r\n    };\r\n    WebmContainer.prototype.writeSections = function(draft) {\r\n        this.offset = 0;\r\n        for (var i = 0; i < this.data.length; i++) {\r\n            var section = this.data[i],\r\n                content = section.data.source,\r\n                contentLength = content.length;\r\n            this.writeUint(section.id, draft);\r\n            this.writeUint(contentLength, draft);\r\n            if (!draft) {\r\n                this.source.set(content, this.offset);\r\n            }\r\n            this.offset += contentLength;\r\n        }\r\n        return this.offset;\r\n    };\r\n    WebmContainer.prototype.updateByData = function() {\r\n        // run without accessing this.source to determine total length - need to know it to create Uint8Array\r\n        var length = this.writeSections('draft');\r\n        this.source = new Uint8Array(length);\r\n        // now really write data\r\n        this.writeSections();\r\n    };\r\n    WebmContainer.prototype.getSectionById = function(id) {\r\n        for (var i = 0; i < this.data.length; i++) {\r\n            var section = this.data[i];\r\n            if (section.id === id) {\r\n                return section.data;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    function WebmFile(source) {\r\n        WebmContainer.call(this, 'File', 'File');\r\n        this.setSource(source);\r\n    }\r\n    doInherit(WebmFile, WebmContainer);\r\n    WebmFile.prototype.fixDuration = function(duration, options) {\r\n        var logger = options && options.logger;\r\n        if (logger === undefined) {\r\n            logger = function(message) {\r\n                console.log(message);\r\n            };\r\n        } else if (!logger) {\r\n            logger = function() { };\r\n        }\r\n\r\n        var segmentSection = this.getSectionById(0x8538067);\r\n        if (!segmentSection) {\r\n            logger('[fix-webm-duration] Segment section is missing');\r\n            return false;\r\n        }\r\n\r\n        var infoSection = segmentSection.getSectionById(0x549a966);\r\n        if (!infoSection) {\r\n            logger('[fix-webm-duration] Info section is missing');\r\n            return false;\r\n        }\r\n\r\n        var timeScaleSection = infoSection.getSectionById(0xad7b1);\r\n        if (!timeScaleSection) {\r\n            logger('[fix-webm-duration] TimecodeScale section is missing');\r\n            return false;\r\n        }\r\n\r\n        var durationSection = infoSection.getSectionById(0x489);\r\n        if (durationSection) {\r\n            if (durationSection.getValue() <= 0) {\r\n                logger('[fix-webm-duration] Duration section is present, but the value is empty');\r\n                durationSection.setValue(duration);\r\n            } else {\r\n                logger('[fix-webm-duration] Duration section is present');\r\n                return false;\r\n            }\r\n        } else {\r\n            logger('[fix-webm-duration] Duration section is missing');\r\n            // append Duration section\r\n            durationSection = new WebmFloat('Duration', 'Float');\r\n            durationSection.setValue(duration);\r\n            infoSection.data.push({\r\n                id: 0x489,\r\n                data: durationSection\r\n            });\r\n        }\r\n\r\n        // set default time scale to 1 millisecond (1000000 nanoseconds)\r\n        timeScaleSection.setValue(1000000);\r\n        infoSection.updateByData();\r\n        segmentSection.updateByData();\r\n        this.updateByData();\r\n\r\n        return true;\r\n    };\r\n    WebmFile.prototype.toBlob = function(mimeType) {\r\n        return new Blob([ this.source.buffer ], { type: mimeType || 'video/webm' });\r\n    };\r\n\r\n    function fixWebmDuration(blob, duration, callback, options) {\r\n        // The callback may be omitted - then the third argument is options\r\n        if (typeof callback === \"object\") {\r\n            options = callback;\r\n            callback = undefined;\r\n        }\r\n\r\n        if (!callback) {\r\n            return new Promise(function(resolve) {\r\n                fixWebmDuration(blob, duration, resolve, options);\r\n            });\r\n        }\r\n\r\n        try {\r\n            var reader = new FileReader();\r\n            reader.onloadend = function() {\r\n                try {\r\n                    var file = new WebmFile(new Uint8Array(reader.result));\r\n                    if (file.fixDuration(duration, options)) {\r\n                        blob = file.toBlob(blob.type);\r\n                    }\r\n                } catch (ex) {\r\n                    // ignore\r\n                }\r\n                callback(blob);\r\n            };\r\n            reader.readAsArrayBuffer(blob);\r\n        } catch (ex) {\r\n            callback(blob);\r\n        }\r\n    }\r\n\r\n    // Support AMD import default\r\n    fixWebmDuration.default = fixWebmDuration;\r\n\r\n    return fixWebmDuration;\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = React;","const __WEBPACK_NAMESPACE_OBJECT__ = ReactDOM;","const __WEBPACK_NAMESPACE_OBJECT__ = ReactIntl;","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Firebase constants.  Some of these (@defines) can be overridden at compile-time.\r\n */\r\nconst CONSTANTS = {\r\n    /**\r\n     * @define {boolean} Whether this is the client Node.js SDK.\r\n     */\r\n    NODE_CLIENT: false,\r\n    /**\r\n     * @define {boolean} Whether this is the Admin Node.js SDK.\r\n     */\r\n    NODE_ADMIN: false,\r\n    /**\r\n     * Firebase SDK Version\r\n     */\r\n    SDK_VERSION: '${JSCORE_VERSION}'\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws an error if the provided assertion is falsy\r\n */\r\nconst assert = function (assertion, message) {\r\n    if (!assertion) {\r\n        throw assertionError(message);\r\n    }\r\n};\r\n/**\r\n * Returns an Error object suitable for throwing.\r\n */\r\nconst assertionError = function (message) {\r\n    return new Error('Firebase Database (' +\r\n        CONSTANTS.SDK_VERSION +\r\n        ') INTERNAL ASSERT FAILED: ' +\r\n        message);\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst stringToByteArray$1 = function (str) {\r\n    // TODO(user): Use native implementations if/when available\r\n    const out = [];\r\n    let p = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        let c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if ((c & 0xfc00) === 0xd800 &&\r\n            i + 1 < str.length &&\r\n            (str.charCodeAt(i + 1) & 0xfc00) === 0xdc00) {\r\n            // Surrogate Pair\r\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Turns an array of numbers into the string given by the concatenation of the\r\n * characters to which the numbers correspond.\r\n * @param bytes Array of numbers representing characters.\r\n * @return Stringification of the array.\r\n */\r\nconst byteArrayToString = function (bytes) {\r\n    // TODO(user): Use native implementations if/when available\r\n    const out = [];\r\n    let pos = 0, c = 0;\r\n    while (pos < bytes.length) {\r\n        const c1 = bytes[pos++];\r\n        if (c1 < 128) {\r\n            out[c++] = String.fromCharCode(c1);\r\n        }\r\n        else if (c1 > 191 && c1 < 224) {\r\n            const c2 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 31) << 6) | (c2 & 63));\r\n        }\r\n        else if (c1 > 239 && c1 < 365) {\r\n            // Surrogate Pair\r\n            const c2 = bytes[pos++];\r\n            const c3 = bytes[pos++];\r\n            const c4 = bytes[pos++];\r\n            const u = (((c1 & 7) << 18) | ((c2 & 63) << 12) | ((c3 & 63) << 6) | (c4 & 63)) -\r\n                0x10000;\r\n            out[c++] = String.fromCharCode(0xd800 + (u >> 10));\r\n            out[c++] = String.fromCharCode(0xdc00 + (u & 1023));\r\n        }\r\n        else {\r\n            const c2 = bytes[pos++];\r\n            const c3 = bytes[pos++];\r\n            out[c++] = String.fromCharCode(((c1 & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n        }\r\n    }\r\n    return out.join('');\r\n};\r\n// We define it as an object literal instead of a class because a class compiled down to es5 can't\r\n// be treeshaked. https://github.com/rollup/rollup/issues/1691\r\n// Static lookup maps, lazily populated by init_()\r\nconst base64 = {\r\n    /**\r\n     * Maps bytes to characters.\r\n     */\r\n    byteToCharMap_: null,\r\n    /**\r\n     * Maps characters to bytes.\r\n     */\r\n    charToByteMap_: null,\r\n    /**\r\n     * Maps bytes to websafe characters.\r\n     * @private\r\n     */\r\n    byteToCharMapWebSafe_: null,\r\n    /**\r\n     * Maps websafe characters to bytes.\r\n     * @private\r\n     */\r\n    charToByteMapWebSafe_: null,\r\n    /**\r\n     * Our default alphabet, shared between\r\n     * ENCODED_VALS and ENCODED_VALS_WEBSAFE\r\n     */\r\n    ENCODED_VALS_BASE: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789',\r\n    /**\r\n     * Our default alphabet. Value 64 (=) is special; it means \"nothing.\"\r\n     */\r\n    get ENCODED_VALS() {\r\n        return this.ENCODED_VALS_BASE + '+/=';\r\n    },\r\n    /**\r\n     * Our websafe alphabet.\r\n     */\r\n    get ENCODED_VALS_WEBSAFE() {\r\n        return this.ENCODED_VALS_BASE + '-_.';\r\n    },\r\n    /**\r\n     * Whether this browser supports the atob and btoa functions. This extension\r\n     * started at Mozilla but is now implemented by many browsers. We use the\r\n     * ASSUME_* variables to avoid pulling in the full useragent detection library\r\n     * but still allowing the standard per-browser compilations.\r\n     *\r\n     */\r\n    HAS_NATIVE_SUPPORT: typeof atob === 'function',\r\n    /**\r\n     * Base64-encode an array of bytes.\r\n     *\r\n     * @param input An array of bytes (numbers with\r\n     *     value in [0, 255]) to encode.\r\n     * @param webSafe Boolean indicating we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeByteArray(input, webSafe) {\r\n        if (!Array.isArray(input)) {\r\n            throw Error('encodeByteArray takes an array as a parameter');\r\n        }\r\n        this.init_();\r\n        const byteToCharMap = webSafe\r\n            ? this.byteToCharMapWebSafe_\r\n            : this.byteToCharMap_;\r\n        const output = [];\r\n        for (let i = 0; i < input.length; i += 3) {\r\n            const byte1 = input[i];\r\n            const haveByte2 = i + 1 < input.length;\r\n            const byte2 = haveByte2 ? input[i + 1] : 0;\r\n            const haveByte3 = i + 2 < input.length;\r\n            const byte3 = haveByte3 ? input[i + 2] : 0;\r\n            const outByte1 = byte1 >> 2;\r\n            const outByte2 = ((byte1 & 0x03) << 4) | (byte2 >> 4);\r\n            let outByte3 = ((byte2 & 0x0f) << 2) | (byte3 >> 6);\r\n            let outByte4 = byte3 & 0x3f;\r\n            if (!haveByte3) {\r\n                outByte4 = 64;\r\n                if (!haveByte2) {\r\n                    outByte3 = 64;\r\n                }\r\n            }\r\n            output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);\r\n        }\r\n        return output.join('');\r\n    },\r\n    /**\r\n     * Base64-encode a string.\r\n     *\r\n     * @param input A string to encode.\r\n     * @param webSafe If true, we should use the\r\n     *     alternative alphabet.\r\n     * @return The base64 encoded string.\r\n     */\r\n    encodeString(input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return btoa(input);\r\n        }\r\n        return this.encodeByteArray(stringToByteArray$1(input), webSafe);\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * @param input to decode.\r\n     * @param webSafe True if we should use the\r\n     *     alternative alphabet.\r\n     * @return string representing the decoded value.\r\n     */\r\n    decodeString(input, webSafe) {\r\n        // Shortcut for Mozilla browsers that implement\r\n        // a native base64 encoder in the form of \"btoa/atob\"\r\n        if (this.HAS_NATIVE_SUPPORT && !webSafe) {\r\n            return atob(input);\r\n        }\r\n        return byteArrayToString(this.decodeStringToByteArray(input, webSafe));\r\n    },\r\n    /**\r\n     * Base64-decode a string.\r\n     *\r\n     * In base-64 decoding, groups of four characters are converted into three\r\n     * bytes.  If the encoder did not apply padding, the input length may not\r\n     * be a multiple of 4.\r\n     *\r\n     * In this case, the last group will have fewer than 4 characters, and\r\n     * padding will be inferred.  If the group has one or two characters, it decodes\r\n     * to one byte.  If the group has three characters, it decodes to two bytes.\r\n     *\r\n     * @param input Input to decode.\r\n     * @param webSafe True if we should use the web-safe alphabet.\r\n     * @return bytes representing the decoded value.\r\n     */\r\n    decodeStringToByteArray(input, webSafe) {\r\n        this.init_();\r\n        const charToByteMap = webSafe\r\n            ? this.charToByteMapWebSafe_\r\n            : this.charToByteMap_;\r\n        const output = [];\r\n        for (let i = 0; i < input.length;) {\r\n            const byte1 = charToByteMap[input.charAt(i++)];\r\n            const haveByte2 = i < input.length;\r\n            const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;\r\n            ++i;\r\n            const haveByte3 = i < input.length;\r\n            const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            const haveByte4 = i < input.length;\r\n            const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;\r\n            ++i;\r\n            if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {\r\n                throw Error();\r\n            }\r\n            const outByte1 = (byte1 << 2) | (byte2 >> 4);\r\n            output.push(outByte1);\r\n            if (byte3 !== 64) {\r\n                const outByte2 = ((byte2 << 4) & 0xf0) | (byte3 >> 2);\r\n                output.push(outByte2);\r\n                if (byte4 !== 64) {\r\n                    const outByte3 = ((byte3 << 6) & 0xc0) | byte4;\r\n                    output.push(outByte3);\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    },\r\n    /**\r\n     * Lazy static initialization function. Called before\r\n     * accessing any of the static map variables.\r\n     * @private\r\n     */\r\n    init_() {\r\n        if (!this.byteToCharMap_) {\r\n            this.byteToCharMap_ = {};\r\n            this.charToByteMap_ = {};\r\n            this.byteToCharMapWebSafe_ = {};\r\n            this.charToByteMapWebSafe_ = {};\r\n            // We want quick mappings back and forth, so we precompute two maps.\r\n            for (let i = 0; i < this.ENCODED_VALS.length; i++) {\r\n                this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);\r\n                this.charToByteMap_[this.byteToCharMap_[i]] = i;\r\n                this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);\r\n                this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;\r\n                // Be forgiving when decoding and correctly decode both encodings.\r\n                if (i >= this.ENCODED_VALS_BASE.length) {\r\n                    this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;\r\n                    this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n/**\r\n * URL-safe base64 encoding\r\n */\r\nconst base64Encode = function (str) {\r\n    const utf8Bytes = stringToByteArray$1(str);\r\n    return base64.encodeByteArray(utf8Bytes, true);\r\n};\r\n/**\r\n * URL-safe base64 encoding (without \".\" padding in the end).\r\n * e.g. Used in JSON Web Token (JWT) parts.\r\n */\r\nconst base64urlEncodeWithoutPadding = function (str) {\r\n    // Use base64url encoding and remove padding in the end (dot characters).\r\n    return base64Encode(str).replace(/\\./g, '');\r\n};\r\n/**\r\n * URL-safe base64 decoding\r\n *\r\n * NOTE: DO NOT use the global atob() function - it does NOT support the\r\n * base64Url variant encoding.\r\n *\r\n * @param str To be decoded\r\n * @return Decoded result, if possible\r\n */\r\nconst base64Decode = function (str) {\r\n    try {\r\n        return base64.decodeString(str, true);\r\n    }\r\n    catch (e) {\r\n        console.error('base64Decode failed: ', e);\r\n    }\r\n    return null;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Do a deep-copy of basic JavaScript Objects or Arrays.\r\n */\r\nfunction deepCopy(value) {\r\n    return deepExtend(undefined, value);\r\n}\r\n/**\r\n * Copy properties from source to target (recursively allows extension\r\n * of Objects and Arrays).  Scalar values in the target are over-written.\r\n * If target is undefined, an object of the appropriate type will be created\r\n * (and returned).\r\n *\r\n * We recursively copy all child properties of plain Objects in the source- so\r\n * that namespace- like dictionaries are merged.\r\n *\r\n * Note that the target can be a function, in which case the properties in\r\n * the source Object are copied onto it as static properties of the Function.\r\n *\r\n * Note: we don't merge __proto__ to prevent prototype pollution\r\n */\r\nfunction deepExtend(target, source) {\r\n    if (!(source instanceof Object)) {\r\n        return source;\r\n    }\r\n    switch (source.constructor) {\r\n        case Date:\r\n            // Treat Dates like scalars; if the target date object had any child\r\n            // properties - they will be lost!\r\n            const dateValue = source;\r\n            return new Date(dateValue.getTime());\r\n        case Object:\r\n            if (target === undefined) {\r\n                target = {};\r\n            }\r\n            break;\r\n        case Array:\r\n            // Always copy the array source and overwrite the target.\r\n            target = [];\r\n            break;\r\n        default:\r\n            // Not a plain Object - treat it as a scalar.\r\n            return source;\r\n    }\r\n    for (const prop in source) {\r\n        // use isValidKey to guard against prototype pollution. See https://snyk.io/vuln/SNYK-JS-LODASH-450202\r\n        if (!source.hasOwnProperty(prop) || !isValidKey(prop)) {\r\n            continue;\r\n        }\r\n        target[prop] = deepExtend(target[prop], source[prop]);\r\n    }\r\n    return target;\r\n}\r\nfunction isValidKey(key) {\r\n    return key !== '__proto__';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass Deferred {\r\n    constructor() {\r\n        this.reject = () => { };\r\n        this.resolve = () => { };\r\n        this.promise = new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n    /**\r\n     * Our API internals are not promiseified and cannot because our callback APIs have subtle expectations around\r\n     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback\r\n     * and returns a node-style callback which will resolve or reject the Deferred's promise.\r\n     */\r\n    wrapCallback(callback) {\r\n        return (error, value) => {\r\n            if (error) {\r\n                this.reject(error);\r\n            }\r\n            else {\r\n                this.resolve(value);\r\n            }\r\n            if (typeof callback === 'function') {\r\n                // Attaching noop handler just in case developer wasn't expecting\r\n                // promises\r\n                this.promise.catch(() => { });\r\n                // Some of our callbacks don't expect a value and our own tests\r\n                // assert that the parameter length is 1\r\n                if (callback.length === 1) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    callback(error, value);\r\n                }\r\n            }\r\n        };\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createMockUserToken(token, projectId) {\r\n    if (token.uid) {\r\n        throw new Error('The \"uid\" field is no longer supported by mockUserToken. Please use \"sub\" instead for Firebase Auth User ID.');\r\n    }\r\n    // Unsecured JWTs use \"none\" as the algorithm.\r\n    const header = {\r\n        alg: 'none',\r\n        type: 'JWT'\r\n    };\r\n    const project = projectId || 'demo-project';\r\n    const iat = token.iat || 0;\r\n    const sub = token.sub || token.user_id;\r\n    if (!sub) {\r\n        throw new Error(\"mockUserToken must contain 'sub' or 'user_id' field!\");\r\n    }\r\n    const payload = Object.assign({ \r\n        // Set all required fields to decent defaults\r\n        iss: `https://securetoken.google.com/${project}`, aud: project, iat, exp: iat + 3600, auth_time: iat, sub, user_id: sub, firebase: {\r\n            sign_in_provider: 'custom',\r\n            identities: {}\r\n        } }, token);\r\n    // Unsecured JWTs use the empty string as a signature.\r\n    const signature = '';\r\n    return [\r\n        base64urlEncodeWithoutPadding(JSON.stringify(header)),\r\n        base64urlEncodeWithoutPadding(JSON.stringify(payload)),\r\n        signature\r\n    ].join('.');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns navigator.userAgent string or '' if it's not defined.\r\n * @return user agent string\r\n */\r\nfunction getUA() {\r\n    if (typeof navigator !== 'undefined' &&\r\n        typeof navigator['userAgent'] === 'string') {\r\n        return navigator['userAgent'];\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n}\r\n/**\r\n * Detect Cordova / PhoneGap / Ionic frameworks on a mobile device.\r\n *\r\n * Deliberately does not rely on checking `file://` URLs (as this fails PhoneGap\r\n * in the Ripple emulator) nor Cordova `onDeviceReady`, which would normally\r\n * wait for a callback.\r\n */\r\nfunction isMobileCordova() {\r\n    return (typeof window !== 'undefined' &&\r\n        // @ts-ignore Setting up an broadly applicable index signature for Window\r\n        // just to deal with this case would probably be a bad idea.\r\n        !!(window['cordova'] || window['phonegap'] || window['PhoneGap']) &&\r\n        /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA()));\r\n}\r\n/**\r\n * Detect Node.js.\r\n *\r\n * @return true if Node.js environment is detected.\r\n */\r\n// Node detection logic from: https://github.com/iliakan/detect-node/\r\nfunction isNode() {\r\n    try {\r\n        return (Object.prototype.toString.call(global.process) === '[object process]');\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n}\r\n/**\r\n * Detect Browser Environment\r\n */\r\nfunction isBrowser() {\r\n    return typeof self === 'object' && self.self === self;\r\n}\r\nfunction isBrowserExtension() {\r\n    const runtime = typeof chrome === 'object'\r\n        ? chrome.runtime\r\n        : typeof browser === 'object'\r\n            ? browser.runtime\r\n            : undefined;\r\n    return typeof runtime === 'object' && runtime.id !== undefined;\r\n}\r\n/**\r\n * Detect React Native.\r\n *\r\n * @return true if ReactNative environment is detected.\r\n */\r\nfunction isReactNative() {\r\n    return (typeof navigator === 'object' && navigator['product'] === 'ReactNative');\r\n}\r\n/** Detects Electron apps. */\r\nfunction isElectron() {\r\n    return getUA().indexOf('Electron/') >= 0;\r\n}\r\n/** Detects Internet Explorer. */\r\nfunction isIE() {\r\n    const ua = getUA();\r\n    return ua.indexOf('MSIE ') >= 0 || ua.indexOf('Trident/') >= 0;\r\n}\r\n/** Detects Universal Windows Platform apps. */\r\nfunction isUWP() {\r\n    return getUA().indexOf('MSAppHost/') >= 0;\r\n}\r\n/**\r\n * Detect whether the current SDK build is the Node version.\r\n *\r\n * @return true if it's the Node SDK build.\r\n */\r\nfunction isNodeSdk() {\r\n    return CONSTANTS.NODE_CLIENT === true || CONSTANTS.NODE_ADMIN === true;\r\n}\r\n/** Returns true if we are running in Safari. */\r\nfunction isSafari() {\r\n    return (!isNode() &&\r\n        navigator.userAgent.includes('Safari') &&\r\n        !navigator.userAgent.includes('Chrome'));\r\n}\r\n/**\r\n * This method checks if indexedDB is supported by current browser/service worker context\r\n * @return true if indexedDB is supported by current browser/service worker context\r\n */\r\nfunction isIndexedDBAvailable() {\r\n    return typeof indexedDB === 'object';\r\n}\r\n/**\r\n * This method validates browser/sw context for indexedDB by opening a dummy indexedDB database and reject\r\n * if errors occur during the database open operation.\r\n *\r\n * @throws exception if current browser/sw context can't run idb.open (ex: Safari iframe, Firefox\r\n * private browsing)\r\n */\r\nfunction validateIndexedDBOpenable() {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            let preExist = true;\r\n            const DB_CHECK_NAME = 'validate-browser-context-for-indexeddb-analytics-module';\r\n            const request = self.indexedDB.open(DB_CHECK_NAME);\r\n            request.onsuccess = () => {\r\n                request.result.close();\r\n                // delete database only when it doesn't pre-exist\r\n                if (!preExist) {\r\n                    self.indexedDB.deleteDatabase(DB_CHECK_NAME);\r\n                }\r\n                resolve(true);\r\n            };\r\n            request.onupgradeneeded = () => {\r\n                preExist = false;\r\n            };\r\n            request.onerror = () => {\r\n                var _a;\r\n                reject(((_a = request.error) === null || _a === void 0 ? void 0 : _a.message) || '');\r\n            };\r\n        }\r\n        catch (error) {\r\n            reject(error);\r\n        }\r\n    });\r\n}\r\n/**\r\n *\r\n * This method checks whether cookie is enabled within current browser\r\n * @return true if cookie is enabled within current browser\r\n */\r\nfunction areCookiesEnabled() {\r\n    if (typeof navigator === 'undefined' || !navigator.cookieEnabled) {\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n/**\r\n * Polyfill for `globalThis` object.\r\n * @returns the `globalThis` object for the given environment.\r\n */\r\nfunction getGlobal() {\r\n    if (typeof self !== 'undefined') {\r\n        return self;\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n        return window;\r\n    }\r\n    if (typeof global !== 'undefined') {\r\n        return global;\r\n    }\r\n    throw new Error('Unable to locate global object.');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Standardized Firebase Error.\r\n *\r\n * Usage:\r\n *\r\n *   // Typescript string literals for type-safe codes\r\n *   type Err =\r\n *     'unknown' |\r\n *     'object-not-found'\r\n *     ;\r\n *\r\n *   // Closure enum for type-safe error codes\r\n *   // at-enum {string}\r\n *   var Err = {\r\n *     UNKNOWN: 'unknown',\r\n *     OBJECT_NOT_FOUND: 'object-not-found',\r\n *   }\r\n *\r\n *   let errors: Map<Err, string> = {\r\n *     'generic-error': \"Unknown error\",\r\n *     'file-not-found': \"Could not find file: {$file}\",\r\n *   };\r\n *\r\n *   // Type-safe function - must pass a valid error code as param.\r\n *   let error = new ErrorFactory<Err>('service', 'Service', errors);\r\n *\r\n *   ...\r\n *   throw error.create(Err.GENERIC);\r\n *   ...\r\n *   throw error.create(Err.FILE_NOT_FOUND, {'file': fileName});\r\n *   ...\r\n *   // Service: Could not file file: foo.txt (service/file-not-found).\r\n *\r\n *   catch (e) {\r\n *     assert(e.message === \"Could not find file: foo.txt.\");\r\n *     if (e.code === 'service/file-not-found') {\r\n *       console.log(\"Could not read file: \" + e['file']);\r\n *     }\r\n *   }\r\n */\r\nconst ERROR_NAME = 'FirebaseError';\r\n// Based on code from:\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\r\nclass FirebaseError extends Error {\r\n    constructor(\r\n    /** The error code for this error. */\r\n    code, message, \r\n    /** Custom data for this error. */\r\n    customData) {\r\n        super(message);\r\n        this.code = code;\r\n        this.customData = customData;\r\n        /** The custom name for all FirebaseErrors. */\r\n        this.name = ERROR_NAME;\r\n        // Fix For ES5\r\n        // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n        Object.setPrototypeOf(this, FirebaseError.prototype);\r\n        // Maintains proper stack trace for where our error was thrown.\r\n        // Only available on V8.\r\n        if (Error.captureStackTrace) {\r\n            Error.captureStackTrace(this, ErrorFactory.prototype.create);\r\n        }\r\n    }\r\n}\r\nclass ErrorFactory {\r\n    constructor(service, serviceName, errors) {\r\n        this.service = service;\r\n        this.serviceName = serviceName;\r\n        this.errors = errors;\r\n    }\r\n    create(code, ...data) {\r\n        const customData = data[0] || {};\r\n        const fullCode = `${this.service}/${code}`;\r\n        const template = this.errors[code];\r\n        const message = template ? replaceTemplate(template, customData) : 'Error';\r\n        // Service Name: Error message (service/code).\r\n        const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;\r\n        const error = new FirebaseError(fullCode, fullMessage, customData);\r\n        return error;\r\n    }\r\n}\r\nfunction replaceTemplate(template, data) {\r\n    return template.replace(PATTERN, (_, key) => {\r\n        const value = data[key];\r\n        return value != null ? String(value) : `<${key}?>`;\r\n    });\r\n}\r\nconst PATTERN = /\\{\\$([^}]+)}/g;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Evaluates a JSON string into a javascript object.\r\n *\r\n * @param {string} str A string containing JSON.\r\n * @return {*} The javascript object representing the specified JSON.\r\n */\r\nfunction jsonEval(str) {\r\n    return JSON.parse(str);\r\n}\r\n/**\r\n * Returns JSON representing a javascript object.\r\n * @param {*} data Javascript object to be stringified.\r\n * @return {string} The JSON contents of the object.\r\n */\r\nfunction stringify(data) {\r\n    return JSON.stringify(data);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Decodes a Firebase auth. token into constituent parts.\r\n *\r\n * Notes:\r\n * - May return with invalid / incomplete claims if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst decode = function (token) {\r\n    let header = {}, claims = {}, data = {}, signature = '';\r\n    try {\r\n        const parts = token.split('.');\r\n        header = jsonEval(base64Decode(parts[0]) || '');\r\n        claims = jsonEval(base64Decode(parts[1]) || '');\r\n        signature = parts[2];\r\n        data = claims['d'] || {};\r\n        delete claims['d'];\r\n    }\r\n    catch (e) { }\r\n    return {\r\n        header,\r\n        claims,\r\n        data,\r\n        signature\r\n    };\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its time-based claims. Will return true if the\r\n * token is within the time window authorized by the 'nbf' (not-before) and 'iat' (issued-at) claims.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst isValidTimestamp = function (token) {\r\n    const claims = decode(token).claims;\r\n    const now = Math.floor(new Date().getTime() / 1000);\r\n    let validSince = 0, validUntil = 0;\r\n    if (typeof claims === 'object') {\r\n        if (claims.hasOwnProperty('nbf')) {\r\n            validSince = claims['nbf'];\r\n        }\r\n        else if (claims.hasOwnProperty('iat')) {\r\n            validSince = claims['iat'];\r\n        }\r\n        if (claims.hasOwnProperty('exp')) {\r\n            validUntil = claims['exp'];\r\n        }\r\n        else {\r\n            // token will expire after 24h by default\r\n            validUntil = validSince + 86400;\r\n        }\r\n    }\r\n    return (!!now &&\r\n        !!validSince &&\r\n        !!validUntil &&\r\n        now >= validSince &&\r\n        now <= validUntil);\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and returns its issued at time if valid, null otherwise.\r\n *\r\n * Notes:\r\n * - May return null if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst issuedAtTime = function (token) {\r\n    const claims = decode(token).claims;\r\n    if (typeof claims === 'object' && claims.hasOwnProperty('iat')) {\r\n        return claims['iat'];\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Decodes a Firebase auth. token and checks the validity of its format. Expects a valid issued-at time.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst isValidFormat = function (token) {\r\n    const decoded = decode(token), claims = decoded.claims;\r\n    return !!claims && typeof claims === 'object' && claims.hasOwnProperty('iat');\r\n};\r\n/**\r\n * Attempts to peer into an auth token and determine if it's an admin auth token by looking at the claims portion.\r\n *\r\n * Notes:\r\n * - May return a false negative if there's no native base64 decoding support.\r\n * - Doesn't check if the token is actually valid.\r\n */\r\nconst isAdmin = function (token) {\r\n    const claims = decode(token).claims;\r\n    return typeof claims === 'object' && claims['admin'] === true;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction contains(obj, key) {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n}\r\nfunction safeGet(obj, key) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n        return obj[key];\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\nfunction isEmpty(obj) {\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction map(obj, fn, contextObj) {\r\n    const res = {};\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            res[key] = fn.call(contextObj, obj[key], key, obj);\r\n        }\r\n    }\r\n    return res;\r\n}\r\n/**\r\n * Deep equal two objects. Support Arrays and Objects.\r\n */\r\nfunction deepEqual(a, b) {\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    const aKeys = Object.keys(a);\r\n    const bKeys = Object.keys(b);\r\n    for (const k of aKeys) {\r\n        if (!bKeys.includes(k)) {\r\n            return false;\r\n        }\r\n        const aProp = a[k];\r\n        const bProp = b[k];\r\n        if (isObject(aProp) && isObject(bProp)) {\r\n            if (!deepEqual(aProp, bProp)) {\r\n                return false;\r\n            }\r\n        }\r\n        else if (aProp !== bProp) {\r\n            return false;\r\n        }\r\n    }\r\n    for (const k of bKeys) {\r\n        if (!aKeys.includes(k)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nfunction isObject(thing) {\r\n    return thing !== null && typeof thing === 'object';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a querystring-formatted string (e.g. &arg=val&arg2=val2) from a\r\n * params object (e.g. {arg: 'val', arg2: 'val2'})\r\n * Note: You must prepend it with ? when adding it to a URL.\r\n */\r\nfunction querystring(querystringParams) {\r\n    const params = [];\r\n    for (const [key, value] of Object.entries(querystringParams)) {\r\n        if (Array.isArray(value)) {\r\n            value.forEach(arrayVal => {\r\n                params.push(encodeURIComponent(key) + '=' + encodeURIComponent(arrayVal));\r\n            });\r\n        }\r\n        else {\r\n            params.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n        }\r\n    }\r\n    return params.length ? '&' + params.join('&') : '';\r\n}\r\n/**\r\n * Decodes a querystring (e.g. ?arg=val&arg2=val2) into a params object\r\n * (e.g. {arg: 'val', arg2: 'val2'})\r\n */\r\nfunction querystringDecode(querystring) {\r\n    const obj = {};\r\n    const tokens = querystring.replace(/^\\?/, '').split('&');\r\n    tokens.forEach(token => {\r\n        if (token) {\r\n            const [key, value] = token.split('=');\r\n            obj[decodeURIComponent(key)] = decodeURIComponent(value);\r\n        }\r\n    });\r\n    return obj;\r\n}\r\n/**\r\n * Extract the query string part of a URL, including the leading question mark (if present).\r\n */\r\nfunction extractQuerystring(url) {\r\n    const queryStart = url.indexOf('?');\r\n    if (!queryStart) {\r\n        return '';\r\n    }\r\n    const fragmentStart = url.indexOf('#', queryStart);\r\n    return url.substring(queryStart, fragmentStart > 0 ? fragmentStart : undefined);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview SHA-1 cryptographic hash.\r\n * Variable names follow the notation in FIPS PUB 180-3:\r\n * http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf.\r\n *\r\n * Usage:\r\n *   var sha1 = new sha1();\r\n *   sha1.update(bytes);\r\n *   var hash = sha1.digest();\r\n *\r\n * Performance:\r\n *   Chrome 23:   ~400 Mbit/s\r\n *   Firefox 16:  ~250 Mbit/s\r\n *\r\n */\r\n/**\r\n * SHA-1 cryptographic hash constructor.\r\n *\r\n * The properties declared here are discussed in the above algorithm document.\r\n * @constructor\r\n * @final\r\n * @struct\r\n */\r\nclass Sha1 {\r\n    constructor() {\r\n        /**\r\n         * Holds the previous values of accumulated variables a-e in the compress_\r\n         * function.\r\n         * @private\r\n         */\r\n        this.chain_ = [];\r\n        /**\r\n         * A buffer holding the partially computed hash result.\r\n         * @private\r\n         */\r\n        this.buf_ = [];\r\n        /**\r\n         * An array of 80 bytes, each a part of the message to be hashed.  Referred to\r\n         * as the message schedule in the docs.\r\n         * @private\r\n         */\r\n        this.W_ = [];\r\n        /**\r\n         * Contains data needed to pad messages less than 64 bytes.\r\n         * @private\r\n         */\r\n        this.pad_ = [];\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.inbuf_ = 0;\r\n        /**\r\n         * @private {number}\r\n         */\r\n        this.total_ = 0;\r\n        this.blockSize = 512 / 8;\r\n        this.pad_[0] = 128;\r\n        for (let i = 1; i < this.blockSize; ++i) {\r\n            this.pad_[i] = 0;\r\n        }\r\n        this.reset();\r\n    }\r\n    reset() {\r\n        this.chain_[0] = 0x67452301;\r\n        this.chain_[1] = 0xefcdab89;\r\n        this.chain_[2] = 0x98badcfe;\r\n        this.chain_[3] = 0x10325476;\r\n        this.chain_[4] = 0xc3d2e1f0;\r\n        this.inbuf_ = 0;\r\n        this.total_ = 0;\r\n    }\r\n    /**\r\n     * Internal compress helper function.\r\n     * @param buf Block to compress.\r\n     * @param offset Offset of the block in the buffer.\r\n     * @private\r\n     */\r\n    compress_(buf, offset) {\r\n        if (!offset) {\r\n            offset = 0;\r\n        }\r\n        const W = this.W_;\r\n        // get 16 big endian words\r\n        if (typeof buf === 'string') {\r\n            for (let i = 0; i < 16; i++) {\r\n                // TODO(user): [bug 8140122] Recent versions of Safari for Mac OS and iOS\r\n                // have a bug that turns the post-increment ++ operator into pre-increment\r\n                // during JIT compilation.  We have code that depends heavily on SHA-1 for\r\n                // correctness and which is affected by this bug, so I've removed all uses\r\n                // of post-increment ++ in which the result value is used.  We can revert\r\n                // this change once the Safari bug\r\n                // (https://bugs.webkit.org/show_bug.cgi?id=109036) has been fixed and\r\n                // most clients have been updated.\r\n                W[i] =\r\n                    (buf.charCodeAt(offset) << 24) |\r\n                        (buf.charCodeAt(offset + 1) << 16) |\r\n                        (buf.charCodeAt(offset + 2) << 8) |\r\n                        buf.charCodeAt(offset + 3);\r\n                offset += 4;\r\n            }\r\n        }\r\n        else {\r\n            for (let i = 0; i < 16; i++) {\r\n                W[i] =\r\n                    (buf[offset] << 24) |\r\n                        (buf[offset + 1] << 16) |\r\n                        (buf[offset + 2] << 8) |\r\n                        buf[offset + 3];\r\n                offset += 4;\r\n            }\r\n        }\r\n        // expand to 80 words\r\n        for (let i = 16; i < 80; i++) {\r\n            const t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];\r\n            W[i] = ((t << 1) | (t >>> 31)) & 0xffffffff;\r\n        }\r\n        let a = this.chain_[0];\r\n        let b = this.chain_[1];\r\n        let c = this.chain_[2];\r\n        let d = this.chain_[3];\r\n        let e = this.chain_[4];\r\n        let f, k;\r\n        // TODO(user): Try to unroll this loop to speed up the computation.\r\n        for (let i = 0; i < 80; i++) {\r\n            if (i < 40) {\r\n                if (i < 20) {\r\n                    f = d ^ (b & (c ^ d));\r\n                    k = 0x5a827999;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0x6ed9eba1;\r\n                }\r\n            }\r\n            else {\r\n                if (i < 60) {\r\n                    f = (b & c) | (d & (b | c));\r\n                    k = 0x8f1bbcdc;\r\n                }\r\n                else {\r\n                    f = b ^ c ^ d;\r\n                    k = 0xca62c1d6;\r\n                }\r\n            }\r\n            const t = (((a << 5) | (a >>> 27)) + f + e + k + W[i]) & 0xffffffff;\r\n            e = d;\r\n            d = c;\r\n            c = ((b << 30) | (b >>> 2)) & 0xffffffff;\r\n            b = a;\r\n            a = t;\r\n        }\r\n        this.chain_[0] = (this.chain_[0] + a) & 0xffffffff;\r\n        this.chain_[1] = (this.chain_[1] + b) & 0xffffffff;\r\n        this.chain_[2] = (this.chain_[2] + c) & 0xffffffff;\r\n        this.chain_[3] = (this.chain_[3] + d) & 0xffffffff;\r\n        this.chain_[4] = (this.chain_[4] + e) & 0xffffffff;\r\n    }\r\n    update(bytes, length) {\r\n        // TODO(johnlenz): tighten the function signature and remove this check\r\n        if (bytes == null) {\r\n            return;\r\n        }\r\n        if (length === undefined) {\r\n            length = bytes.length;\r\n        }\r\n        const lengthMinusBlock = length - this.blockSize;\r\n        let n = 0;\r\n        // Using local instead of member variables gives ~5% speedup on Firefox 16.\r\n        const buf = this.buf_;\r\n        let inbuf = this.inbuf_;\r\n        // The outer while loop should execute at most twice.\r\n        while (n < length) {\r\n            // When we have no data in the block to top up, we can directly process the\r\n            // input buffer (assuming it contains sufficient data). This gives ~25%\r\n            // speedup on Chrome 23 and ~15% speedup on Firefox 16, but requires that\r\n            // the data is provided in large chunks (or in multiples of 64 bytes).\r\n            if (inbuf === 0) {\r\n                while (n <= lengthMinusBlock) {\r\n                    this.compress_(bytes, n);\r\n                    n += this.blockSize;\r\n                }\r\n            }\r\n            if (typeof bytes === 'string') {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes.charCodeAt(n);\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                while (n < length) {\r\n                    buf[inbuf] = bytes[n];\r\n                    ++inbuf;\r\n                    ++n;\r\n                    if (inbuf === this.blockSize) {\r\n                        this.compress_(buf);\r\n                        inbuf = 0;\r\n                        // Jump to the outer loop so we use the full-block optimization.\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.inbuf_ = inbuf;\r\n        this.total_ += length;\r\n    }\r\n    /** @override */\r\n    digest() {\r\n        const digest = [];\r\n        let totalBits = this.total_ * 8;\r\n        // Add pad 0x80 0x00*.\r\n        if (this.inbuf_ < 56) {\r\n            this.update(this.pad_, 56 - this.inbuf_);\r\n        }\r\n        else {\r\n            this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));\r\n        }\r\n        // Add # bits.\r\n        for (let i = this.blockSize - 1; i >= 56; i--) {\r\n            this.buf_[i] = totalBits & 255;\r\n            totalBits /= 256; // Don't use bit-shifting here!\r\n        }\r\n        this.compress_(this.buf_);\r\n        let n = 0;\r\n        for (let i = 0; i < 5; i++) {\r\n            for (let j = 24; j >= 0; j -= 8) {\r\n                digest[n] = (this.chain_[i] >> j) & 255;\r\n                ++n;\r\n            }\r\n        }\r\n        return digest;\r\n    }\r\n}\n\n/**\r\n * Helper to make a Subscribe function (just like Promise helps make a\r\n * Thenable).\r\n *\r\n * @param executor Function which can make calls to a single Observer\r\n *     as a proxy.\r\n * @param onNoObservers Callback when count of Observers goes to zero.\r\n */\r\nfunction createSubscribe(executor, onNoObservers) {\r\n    const proxy = new ObserverProxy(executor, onNoObservers);\r\n    return proxy.subscribe.bind(proxy);\r\n}\r\n/**\r\n * Implement fan-out for any number of Observers attached via a subscribe\r\n * function.\r\n */\r\nclass ObserverProxy {\r\n    /**\r\n     * @param executor Function which can make calls to a single Observer\r\n     *     as a proxy.\r\n     * @param onNoObservers Callback when count of Observers goes to zero.\r\n     */\r\n    constructor(executor, onNoObservers) {\r\n        this.observers = [];\r\n        this.unsubscribes = [];\r\n        this.observerCount = 0;\r\n        // Micro-task scheduling by calling task.then().\r\n        this.task = Promise.resolve();\r\n        this.finalized = false;\r\n        this.onNoObservers = onNoObservers;\r\n        // Call the executor asynchronously so subscribers that are called\r\n        // synchronously after the creation of the subscribe function\r\n        // can still receive the very first value generated in the executor.\r\n        this.task\r\n            .then(() => {\r\n            executor(this);\r\n        })\r\n            .catch(e => {\r\n            this.error(e);\r\n        });\r\n    }\r\n    next(value) {\r\n        this.forEachObserver((observer) => {\r\n            observer.next(value);\r\n        });\r\n    }\r\n    error(error) {\r\n        this.forEachObserver((observer) => {\r\n            observer.error(error);\r\n        });\r\n        this.close(error);\r\n    }\r\n    complete() {\r\n        this.forEachObserver((observer) => {\r\n            observer.complete();\r\n        });\r\n        this.close();\r\n    }\r\n    /**\r\n     * Subscribe function that can be used to add an Observer to the fan-out list.\r\n     *\r\n     * - We require that no event is sent to a subscriber sychronously to their\r\n     *   call to subscribe().\r\n     */\r\n    subscribe(nextOrObserver, error, complete) {\r\n        let observer;\r\n        if (nextOrObserver === undefined &&\r\n            error === undefined &&\r\n            complete === undefined) {\r\n            throw new Error('Missing Observer.');\r\n        }\r\n        // Assemble an Observer object when passed as callback functions.\r\n        if (implementsAnyMethods(nextOrObserver, [\r\n            'next',\r\n            'error',\r\n            'complete'\r\n        ])) {\r\n            observer = nextOrObserver;\r\n        }\r\n        else {\r\n            observer = {\r\n                next: nextOrObserver,\r\n                error,\r\n                complete\r\n            };\r\n        }\r\n        if (observer.next === undefined) {\r\n            observer.next = noop;\r\n        }\r\n        if (observer.error === undefined) {\r\n            observer.error = noop;\r\n        }\r\n        if (observer.complete === undefined) {\r\n            observer.complete = noop;\r\n        }\r\n        const unsub = this.unsubscribeOne.bind(this, this.observers.length);\r\n        // Attempt to subscribe to a terminated Observable - we\r\n        // just respond to the Observer with the final error or complete\r\n        // event.\r\n        if (this.finalized) {\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            this.task.then(() => {\r\n                try {\r\n                    if (this.finalError) {\r\n                        observer.error(this.finalError);\r\n                    }\r\n                    else {\r\n                        observer.complete();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // nothing\r\n                }\r\n                return;\r\n            });\r\n        }\r\n        this.observers.push(observer);\r\n        return unsub;\r\n    }\r\n    // Unsubscribe is synchronous - we guarantee that no events are sent to\r\n    // any unsubscribed Observer.\r\n    unsubscribeOne(i) {\r\n        if (this.observers === undefined || this.observers[i] === undefined) {\r\n            return;\r\n        }\r\n        delete this.observers[i];\r\n        this.observerCount -= 1;\r\n        if (this.observerCount === 0 && this.onNoObservers !== undefined) {\r\n            this.onNoObservers(this);\r\n        }\r\n    }\r\n    forEachObserver(fn) {\r\n        if (this.finalized) {\r\n            // Already closed by previous event....just eat the additional values.\r\n            return;\r\n        }\r\n        // Since sendOne calls asynchronously - there is no chance that\r\n        // this.observers will become undefined.\r\n        for (let i = 0; i < this.observers.length; i++) {\r\n            this.sendOne(i, fn);\r\n        }\r\n    }\r\n    // Call the Observer via one of it's callback function. We are careful to\r\n    // confirm that the observe has not been unsubscribed since this asynchronous\r\n    // function had been queued.\r\n    sendOne(i, fn) {\r\n        // Execute the callback asynchronously\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(() => {\r\n            if (this.observers !== undefined && this.observers[i] !== undefined) {\r\n                try {\r\n                    fn(this.observers[i]);\r\n                }\r\n                catch (e) {\r\n                    // Ignore exceptions raised in Observers or missing methods of an\r\n                    // Observer.\r\n                    // Log error to console. b/31404806\r\n                    if (typeof console !== 'undefined' && console.error) {\r\n                        console.error(e);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    close(err) {\r\n        if (this.finalized) {\r\n            return;\r\n        }\r\n        this.finalized = true;\r\n        if (err !== undefined) {\r\n            this.finalError = err;\r\n        }\r\n        // Proxy is no longer needed - garbage collect references\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.task.then(() => {\r\n            this.observers = undefined;\r\n            this.onNoObservers = undefined;\r\n        });\r\n    }\r\n}\r\n/** Turn synchronous function into one called asynchronously. */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction async(fn, onError) {\r\n    return (...args) => {\r\n        Promise.resolve(true)\r\n            .then(() => {\r\n            fn(...args);\r\n        })\r\n            .catch((error) => {\r\n            if (onError) {\r\n                onError(error);\r\n            }\r\n        });\r\n    };\r\n}\r\n/**\r\n * Return true if the object passed in implements any of the named methods.\r\n */\r\nfunction implementsAnyMethods(obj, methods) {\r\n    if (typeof obj !== 'object' || obj === null) {\r\n        return false;\r\n    }\r\n    for (const method of methods) {\r\n        if (method in obj && typeof obj[method] === 'function') {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nfunction noop() {\r\n    // do nothing\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Check to make sure the appropriate number of arguments are provided for a public function.\r\n * Throws an error if it fails.\r\n *\r\n * @param fnName The function name\r\n * @param minCount The minimum number of arguments to allow for the function call\r\n * @param maxCount The maximum number of argument to allow for the function call\r\n * @param argCount The actual number of arguments provided.\r\n */\r\nconst validateArgCount = function (fnName, minCount, maxCount, argCount) {\r\n    let argError;\r\n    if (argCount < minCount) {\r\n        argError = 'at least ' + minCount;\r\n    }\r\n    else if (argCount > maxCount) {\r\n        argError = maxCount === 0 ? 'none' : 'no more than ' + maxCount;\r\n    }\r\n    if (argError) {\r\n        const error = fnName +\r\n            ' failed: Was called with ' +\r\n            argCount +\r\n            (argCount === 1 ? ' argument.' : ' arguments.') +\r\n            ' Expects ' +\r\n            argError +\r\n            '.';\r\n        throw new Error(error);\r\n    }\r\n};\r\n/**\r\n * Generates a string to prefix an error message about failed argument validation\r\n *\r\n * @param fnName The function name\r\n * @param argName The name of the argument\r\n * @return The prefix to add to the error thrown for validation.\r\n */\r\nfunction errorPrefix(fnName, argName) {\r\n    return `${fnName} failed: ${argName} argument `;\r\n}\r\n/**\r\n * @param fnName\r\n * @param argumentNumber\r\n * @param namespace\r\n * @param optional\r\n */\r\nfunction validateNamespace(fnName, namespace, optional) {\r\n    if (optional && !namespace) {\r\n        return;\r\n    }\r\n    if (typeof namespace !== 'string') {\r\n        //TODO: I should do more validation here. We only allow certain chars in namespaces.\r\n        throw new Error(errorPrefix(fnName, 'namespace') + 'must be a valid firebase namespace.');\r\n    }\r\n}\r\nfunction validateCallback(fnName, argumentName, \r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\ncallback, optional) {\r\n    if (optional && !callback) {\r\n        return;\r\n    }\r\n    if (typeof callback !== 'function') {\r\n        throw new Error(errorPrefix(fnName, argumentName) + 'must be a valid function.');\r\n    }\r\n}\r\nfunction validateContextObject(fnName, argumentName, context, optional) {\r\n    if (optional && !context) {\r\n        return;\r\n    }\r\n    if (typeof context !== 'object' || context === null) {\r\n        throw new Error(errorPrefix(fnName, argumentName) + 'must be a valid context object.');\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Code originally came from goog.crypt.stringToUtf8ByteArray, but for some reason they\r\n// automatically replaced '\\r\\n' with '\\n', and they didn't handle surrogate pairs,\r\n// so it's been modified.\r\n// Note that not all Unicode characters appear as single characters in JavaScript strings.\r\n// fromCharCode returns the UTF-16 encoding of a character - so some Unicode characters\r\n// use 2 characters in Javascript.  All 4-byte UTF-8 characters begin with a first\r\n// character in the range 0xD800 - 0xDBFF (the first character of a so-called surrogate\r\n// pair).\r\n// See http://www.ecma-international.org/ecma-262/5.1/#sec-15.1.3\r\n/**\r\n * @param {string} str\r\n * @return {Array}\r\n */\r\nconst stringToByteArray = function (str) {\r\n    const out = [];\r\n    let p = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        let c = str.charCodeAt(i);\r\n        // Is this the lead surrogate in a surrogate pair?\r\n        if (c >= 0xd800 && c <= 0xdbff) {\r\n            const high = c - 0xd800; // the high 10 bits.\r\n            i++;\r\n            assert(i < str.length, 'Surrogate pair missing trail surrogate.');\r\n            const low = str.charCodeAt(i) - 0xdc00; // the low 10 bits.\r\n            c = 0x10000 + (high << 10) + low;\r\n        }\r\n        if (c < 128) {\r\n            out[p++] = c;\r\n        }\r\n        else if (c < 2048) {\r\n            out[p++] = (c >> 6) | 192;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else if (c < 65536) {\r\n            out[p++] = (c >> 12) | 224;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n        else {\r\n            out[p++] = (c >> 18) | 240;\r\n            out[p++] = ((c >> 12) & 63) | 128;\r\n            out[p++] = ((c >> 6) & 63) | 128;\r\n            out[p++] = (c & 63) | 128;\r\n        }\r\n    }\r\n    return out;\r\n};\r\n/**\r\n * Calculate length without actually converting; useful for doing cheaper validation.\r\n * @param {string} str\r\n * @return {number}\r\n */\r\nconst stringLength = function (str) {\r\n    let p = 0;\r\n    for (let i = 0; i < str.length; i++) {\r\n        const c = str.charCodeAt(i);\r\n        if (c < 128) {\r\n            p++;\r\n        }\r\n        else if (c < 2048) {\r\n            p += 2;\r\n        }\r\n        else if (c >= 0xd800 && c <= 0xdbff) {\r\n            // Lead surrogate of a surrogate pair.  The pair together will take 4 bytes to represent.\r\n            p += 4;\r\n            i++; // skip trail surrogate.\r\n        }\r\n        else {\r\n            p += 3;\r\n        }\r\n    }\r\n    return p;\r\n};\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The amount of milliseconds to exponentially increase.\r\n */\r\nconst DEFAULT_INTERVAL_MILLIS = 1000;\r\n/**\r\n * The factor to backoff by.\r\n * Should be a number greater than 1.\r\n */\r\nconst DEFAULT_BACKOFF_FACTOR = 2;\r\n/**\r\n * The maximum milliseconds to increase to.\r\n *\r\n * <p>Visible for testing\r\n */\r\nconst MAX_VALUE_MILLIS = 4 * 60 * 60 * 1000; // Four hours, like iOS and Android.\r\n/**\r\n * The percentage of backoff time to randomize by.\r\n * See\r\n * http://go/safe-client-behavior#step-1-determine-the-appropriate-retry-interval-to-handle-spike-traffic\r\n * for context.\r\n *\r\n * <p>Visible for testing\r\n */\r\nconst RANDOM_FACTOR = 0.5;\r\n/**\r\n * Based on the backoff method from\r\n * https://github.com/google/closure-library/blob/master/closure/goog/math/exponentialbackoff.js.\r\n * Extracted here so we don't need to pass metadata and a stateful ExponentialBackoff object around.\r\n */\r\nfunction calculateBackoffMillis(backoffCount, intervalMillis = DEFAULT_INTERVAL_MILLIS, backoffFactor = DEFAULT_BACKOFF_FACTOR) {\r\n    // Calculates an exponentially increasing value.\r\n    // Deviation: calculates value from count and a constant interval, so we only need to save value\r\n    // and count to restore state.\r\n    const currBaseValue = intervalMillis * Math.pow(backoffFactor, backoffCount);\r\n    // A random \"fuzz\" to avoid waves of retries.\r\n    // Deviation: randomFactor is required.\r\n    const randomWait = Math.round(\r\n    // A fraction of the backoff value to add/subtract.\r\n    // Deviation: changes multiplication order to improve readability.\r\n    RANDOM_FACTOR *\r\n        currBaseValue *\r\n        // A random float (rounded to int by Math.round above) in the range [-1, 1]. Determines\r\n        // if we add or subtract.\r\n        (Math.random() - 0.5) *\r\n        2);\r\n    // Limits backoff to max to avoid effectively permanent backoff.\r\n    return Math.min(MAX_VALUE_MILLIS, currBaseValue + randomWait);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provide English ordinal letters after a number\r\n */\r\nfunction ordinal(i) {\r\n    if (!Number.isFinite(i)) {\r\n        return `${i}`;\r\n    }\r\n    return i + indicator(i);\r\n}\r\nfunction indicator(i) {\r\n    i = Math.abs(i);\r\n    const cent = i % 100;\r\n    if (cent >= 10 && cent <= 20) {\r\n        return 'th';\r\n    }\r\n    const dec = i % 10;\r\n    if (dec === 1) {\r\n        return 'st';\r\n    }\r\n    if (dec === 2) {\r\n        return 'nd';\r\n    }\r\n    if (dec === 3) {\r\n        return 'rd';\r\n    }\r\n    return 'th';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getModularInstance(service) {\r\n    if (service && service._delegate) {\r\n        return service._delegate;\r\n    }\r\n    else {\r\n        return service;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2022 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @internal\r\n */\r\nfunction promisifyRequest(request, errorMessage) {\r\n    return new Promise((resolve, reject) => {\r\n        request.onsuccess = event => {\r\n            resolve(event.target.result);\r\n        };\r\n        request.onerror = event => {\r\n            var _a;\r\n            reject(`${errorMessage}: ${(_a = event.target.error) === null || _a === void 0 ? void 0 : _a.message}`);\r\n        };\r\n    });\r\n}\r\n/**\r\n * @internal\r\n */\r\nclass DBWrapper {\r\n    constructor(_db) {\r\n        this._db = _db;\r\n        this.objectStoreNames = this._db.objectStoreNames;\r\n    }\r\n    transaction(storeNames, mode = 'readonly') {\r\n        return new TransactionWrapper(this._db.transaction.call(this._db, storeNames, mode));\r\n    }\r\n    createObjectStore(storeName, options) {\r\n        return new ObjectStoreWrapper(this._db.createObjectStore(storeName, options));\r\n    }\r\n    close() {\r\n        this._db.close();\r\n    }\r\n}\r\n/**\r\n * @internal\r\n */\r\nclass TransactionWrapper {\r\n    constructor(_transaction) {\r\n        this._transaction = _transaction;\r\n        this.complete = new Promise((resolve, reject) => {\r\n            this._transaction.oncomplete = function () {\r\n                resolve();\r\n            };\r\n            this._transaction.onerror = () => {\r\n                reject(this._transaction.error);\r\n            };\r\n            this._transaction.onabort = () => {\r\n                reject(this._transaction.error);\r\n            };\r\n        });\r\n    }\r\n    objectStore(storeName) {\r\n        return new ObjectStoreWrapper(this._transaction.objectStore(storeName));\r\n    }\r\n}\r\n/**\r\n * @internal\r\n */\r\nclass ObjectStoreWrapper {\r\n    constructor(_store) {\r\n        this._store = _store;\r\n    }\r\n    index(name) {\r\n        return new IndexWrapper(this._store.index(name));\r\n    }\r\n    createIndex(name, keypath, options) {\r\n        return new IndexWrapper(this._store.createIndex(name, keypath, options));\r\n    }\r\n    get(key) {\r\n        const request = this._store.get(key);\r\n        return promisifyRequest(request, 'Error reading from IndexedDB');\r\n    }\r\n    put(value, key) {\r\n        const request = this._store.put(value, key);\r\n        return promisifyRequest(request, 'Error writing to IndexedDB');\r\n    }\r\n    delete(key) {\r\n        const request = this._store.delete(key);\r\n        return promisifyRequest(request, 'Error deleting from IndexedDB');\r\n    }\r\n    clear() {\r\n        const request = this._store.clear();\r\n        return promisifyRequest(request, 'Error clearing IndexedDB object store');\r\n    }\r\n}\r\n/**\r\n * @internal\r\n */\r\nclass IndexWrapper {\r\n    constructor(_index) {\r\n        this._index = _index;\r\n    }\r\n    get(key) {\r\n        const request = this._index.get(key);\r\n        return promisifyRequest(request, 'Error reading from IndexedDB');\r\n    }\r\n}\r\n/**\r\n * @internal\r\n */\r\nfunction openDB(dbName, dbVersion, upgradeCallback) {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            const request = indexedDB.open(dbName, dbVersion);\r\n            request.onsuccess = event => {\r\n                resolve(new DBWrapper(event.target.result));\r\n            };\r\n            request.onerror = event => {\r\n                var _a;\r\n                reject(`Error opening indexedDB: ${(_a = event.target.error) === null || _a === void 0 ? void 0 : _a.message}`);\r\n            };\r\n            request.onupgradeneeded = event => {\r\n                upgradeCallback(new DBWrapper(request.result), event.oldVersion, event.newVersion, new TransactionWrapper(request.transaction));\r\n            };\r\n        }\r\n        catch (e) {\r\n            reject(`Error opening indexedDB: ${e.message}`);\r\n        }\r\n    });\r\n}\r\n/**\r\n * @internal\r\n */\r\nasync function deleteDB(dbName) {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            const request = indexedDB.deleteDatabase(dbName);\r\n            request.onsuccess = () => {\r\n                resolve();\r\n            };\r\n            request.onerror = event => {\r\n                var _a;\r\n                reject(`Error deleting indexedDB database \"${dbName}\": ${(_a = event.target.error) === null || _a === void 0 ? void 0 : _a.message}`);\r\n            };\r\n        }\r\n        catch (e) {\r\n            reject(`Error deleting indexedDB database \"${dbName}\": ${e.message}`);\r\n        }\r\n    });\r\n}\n\nexport { CONSTANTS, DBWrapper, Deferred, ErrorFactory, FirebaseError, MAX_VALUE_MILLIS, RANDOM_FACTOR, Sha1, areCookiesEnabled, assert, assertionError, async, base64, base64Decode, base64Encode, base64urlEncodeWithoutPadding, calculateBackoffMillis, contains, createMockUserToken, createSubscribe, decode, deepCopy, deepEqual, deepExtend, deleteDB, errorPrefix, extractQuerystring, getGlobal, getModularInstance, getUA, isAdmin, isBrowser, isBrowserExtension, isElectron, isEmpty, isIE, isIndexedDBAvailable, isMobileCordova, isNode, isNodeSdk, isReactNative, isSafari, isUWP, isValidFormat, isValidTimestamp, issuedAtTime, jsonEval, map, openDB, ordinal, querystring, querystringDecode, safeGet, stringLength, stringToByteArray, stringify, validateArgCount, validateCallback, validateContextObject, validateIndexedDBOpenable, validateNamespace };\n//# sourceMappingURL=index.esm2017.js.map\n","import { Deferred } from '@firebase/util';\n\n/**\r\n * Component for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nclass Component {\r\n    /**\r\n     *\r\n     * @param name The public service name, e.g. app, auth, firestore, database\r\n     * @param instanceFactory Service factory responsible for creating the public interface\r\n     * @param type whether the service provided by the component is public or private\r\n     */\r\n    constructor(name, instanceFactory, type) {\r\n        this.name = name;\r\n        this.instanceFactory = instanceFactory;\r\n        this.type = type;\r\n        this.multipleInstances = false;\r\n        /**\r\n         * Properties to be added to the service namespace\r\n         */\r\n        this.serviceProps = {};\r\n        this.instantiationMode = \"LAZY\" /* LAZY */;\r\n        this.onInstanceCreated = null;\r\n    }\r\n    setInstantiationMode(mode) {\r\n        this.instantiationMode = mode;\r\n        return this;\r\n    }\r\n    setMultipleInstances(multipleInstances) {\r\n        this.multipleInstances = multipleInstances;\r\n        return this;\r\n    }\r\n    setServiceProps(props) {\r\n        this.serviceProps = props;\r\n        return this;\r\n    }\r\n    setInstanceCreatedCallback(callback) {\r\n        this.onInstanceCreated = callback;\r\n        return this;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provider for instance for service name T, e.g. 'auth', 'auth-internal'\r\n * NameServiceMapping[T] is an alias for the type of the instance\r\n */\r\nclass Provider {\r\n    constructor(name, container) {\r\n        this.name = name;\r\n        this.container = container;\r\n        this.component = null;\r\n        this.instances = new Map();\r\n        this.instancesDeferred = new Map();\r\n        this.instancesOptions = new Map();\r\n        this.onInitCallbacks = new Map();\r\n    }\r\n    /**\r\n     * @param identifier A provider can provide mulitple instances of a service\r\n     * if this.component.multipleInstances is true.\r\n     */\r\n    get(identifier) {\r\n        // if multipleInstances is not supported, use the default name\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        if (!this.instancesDeferred.has(normalizedIdentifier)) {\r\n            const deferred = new Deferred();\r\n            this.instancesDeferred.set(normalizedIdentifier, deferred);\r\n            if (this.isInitialized(normalizedIdentifier) ||\r\n                this.shouldAutoInitialize()) {\r\n                // initialize the service if it can be auto-initialized\r\n                try {\r\n                    const instance = this.getOrInitializeService({\r\n                        instanceIdentifier: normalizedIdentifier\r\n                    });\r\n                    if (instance) {\r\n                        deferred.resolve(instance);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    // when the instance factory throws an exception during get(), it should not cause\r\n                    // a fatal error. We just return the unresolved promise in this case.\r\n                }\r\n            }\r\n        }\r\n        return this.instancesDeferred.get(normalizedIdentifier).promise;\r\n    }\r\n    getImmediate(options) {\r\n        var _a;\r\n        // if multipleInstances is not supported, use the default name\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(options === null || options === void 0 ? void 0 : options.identifier);\r\n        const optional = (_a = options === null || options === void 0 ? void 0 : options.optional) !== null && _a !== void 0 ? _a : false;\r\n        if (this.isInitialized(normalizedIdentifier) ||\r\n            this.shouldAutoInitialize()) {\r\n            try {\r\n                return this.getOrInitializeService({\r\n                    instanceIdentifier: normalizedIdentifier\r\n                });\r\n            }\r\n            catch (e) {\r\n                if (optional) {\r\n                    return null;\r\n                }\r\n                else {\r\n                    throw e;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // In case a component is not initialized and should/can not be auto-initialized at the moment, return null if the optional flag is set, or throw\r\n            if (optional) {\r\n                return null;\r\n            }\r\n            else {\r\n                throw Error(`Service ${this.name} is not available`);\r\n            }\r\n        }\r\n    }\r\n    getComponent() {\r\n        return this.component;\r\n    }\r\n    setComponent(component) {\r\n        if (component.name !== this.name) {\r\n            throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);\r\n        }\r\n        if (this.component) {\r\n            throw Error(`Component for ${this.name} has already been provided`);\r\n        }\r\n        this.component = component;\r\n        // return early without attempting to initialize the component if the component requires explicit initialization (calling `Provider.initialize()`)\r\n        if (!this.shouldAutoInitialize()) {\r\n            return;\r\n        }\r\n        // if the service is eager, initialize the default instance\r\n        if (isComponentEager(component)) {\r\n            try {\r\n                this.getOrInitializeService({ instanceIdentifier: DEFAULT_ENTRY_NAME });\r\n            }\r\n            catch (e) {\r\n                // when the instance factory for an eager Component throws an exception during the eager\r\n                // initialization, it should not cause a fatal error.\r\n                // TODO: Investigate if we need to make it configurable, because some component may want to cause\r\n                // a fatal error in this case?\r\n            }\r\n        }\r\n        // Create service instances for the pending promises and resolve them\r\n        // NOTE: if this.multipleInstances is false, only the default instance will be created\r\n        // and all promises with resolve with it regardless of the identifier.\r\n        for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {\r\n            const normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n            try {\r\n                // `getOrInitializeService()` should always return a valid instance since a component is guaranteed. use ! to make typescript happy.\r\n                const instance = this.getOrInitializeService({\r\n                    instanceIdentifier: normalizedIdentifier\r\n                });\r\n                instanceDeferred.resolve(instance);\r\n            }\r\n            catch (e) {\r\n                // when the instance factory throws an exception, it should not cause\r\n                // a fatal error. We just leave the promise unresolved.\r\n            }\r\n        }\r\n    }\r\n    clearInstance(identifier = DEFAULT_ENTRY_NAME) {\r\n        this.instancesDeferred.delete(identifier);\r\n        this.instancesOptions.delete(identifier);\r\n        this.instances.delete(identifier);\r\n    }\r\n    // app.delete() will call this method on every provider to delete the services\r\n    // TODO: should we mark the provider as deleted?\r\n    async delete() {\r\n        const services = Array.from(this.instances.values());\r\n        await Promise.all([\r\n            ...services\r\n                .filter(service => 'INTERNAL' in service) // legacy services\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                .map(service => service.INTERNAL.delete()),\r\n            ...services\r\n                .filter(service => '_delete' in service) // modularized services\r\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n                .map(service => service._delete())\r\n        ]);\r\n    }\r\n    isComponentSet() {\r\n        return this.component != null;\r\n    }\r\n    isInitialized(identifier = DEFAULT_ENTRY_NAME) {\r\n        return this.instances.has(identifier);\r\n    }\r\n    getOptions(identifier = DEFAULT_ENTRY_NAME) {\r\n        return this.instancesOptions.get(identifier) || {};\r\n    }\r\n    initialize(opts = {}) {\r\n        const { options = {} } = opts;\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(opts.instanceIdentifier);\r\n        if (this.isInitialized(normalizedIdentifier)) {\r\n            throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);\r\n        }\r\n        if (!this.isComponentSet()) {\r\n            throw Error(`Component ${this.name} has not been registered yet`);\r\n        }\r\n        const instance = this.getOrInitializeService({\r\n            instanceIdentifier: normalizedIdentifier,\r\n            options\r\n        });\r\n        // resolve any pending promise waiting for the service instance\r\n        for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {\r\n            const normalizedDeferredIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);\r\n            if (normalizedIdentifier === normalizedDeferredIdentifier) {\r\n                instanceDeferred.resolve(instance);\r\n            }\r\n        }\r\n        return instance;\r\n    }\r\n    /**\r\n     *\r\n     * @param callback - a function that will be invoked  after the provider has been initialized by calling provider.initialize().\r\n     * The function is invoked SYNCHRONOUSLY, so it should not execute any longrunning tasks in order to not block the program.\r\n     *\r\n     * @param identifier An optional instance identifier\r\n     * @returns a function to unregister the callback\r\n     */\r\n    onInit(callback, identifier) {\r\n        var _a;\r\n        const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);\r\n        const existingCallbacks = (_a = this.onInitCallbacks.get(normalizedIdentifier)) !== null && _a !== void 0 ? _a : new Set();\r\n        existingCallbacks.add(callback);\r\n        this.onInitCallbacks.set(normalizedIdentifier, existingCallbacks);\r\n        const existingInstance = this.instances.get(normalizedIdentifier);\r\n        if (existingInstance) {\r\n            callback(existingInstance, normalizedIdentifier);\r\n        }\r\n        return () => {\r\n            existingCallbacks.delete(callback);\r\n        };\r\n    }\r\n    /**\r\n     * Invoke onInit callbacks synchronously\r\n     * @param instance the service instance`\r\n     */\r\n    invokeOnInitCallbacks(instance, identifier) {\r\n        const callbacks = this.onInitCallbacks.get(identifier);\r\n        if (!callbacks) {\r\n            return;\r\n        }\r\n        for (const callback of callbacks) {\r\n            try {\r\n                callback(instance, identifier);\r\n            }\r\n            catch (_a) {\r\n                // ignore errors in the onInit callback\r\n            }\r\n        }\r\n    }\r\n    getOrInitializeService({ instanceIdentifier, options = {} }) {\r\n        let instance = this.instances.get(instanceIdentifier);\r\n        if (!instance && this.component) {\r\n            instance = this.component.instanceFactory(this.container, {\r\n                instanceIdentifier: normalizeIdentifierForFactory(instanceIdentifier),\r\n                options\r\n            });\r\n            this.instances.set(instanceIdentifier, instance);\r\n            this.instancesOptions.set(instanceIdentifier, options);\r\n            /**\r\n             * Invoke onInit listeners.\r\n             * Note this.component.onInstanceCreated is different, which is used by the component creator,\r\n             * while onInit listeners are registered by consumers of the provider.\r\n             */\r\n            this.invokeOnInitCallbacks(instance, instanceIdentifier);\r\n            /**\r\n             * Order is important\r\n             * onInstanceCreated() should be called after this.instances.set(instanceIdentifier, instance); which\r\n             * makes `isInitialized()` return true.\r\n             */\r\n            if (this.component.onInstanceCreated) {\r\n                try {\r\n                    this.component.onInstanceCreated(this.container, instanceIdentifier, instance);\r\n                }\r\n                catch (_a) {\r\n                    // ignore errors in the onInstanceCreatedCallback\r\n                }\r\n            }\r\n        }\r\n        return instance || null;\r\n    }\r\n    normalizeInstanceIdentifier(identifier = DEFAULT_ENTRY_NAME) {\r\n        if (this.component) {\r\n            return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME;\r\n        }\r\n        else {\r\n            return identifier; // assume multiple instances are supported before the component is provided.\r\n        }\r\n    }\r\n    shouldAutoInitialize() {\r\n        return (!!this.component &&\r\n            this.component.instantiationMode !== \"EXPLICIT\" /* EXPLICIT */);\r\n    }\r\n}\r\n// undefined should be passed to the service factory for the default instance\r\nfunction normalizeIdentifierForFactory(identifier) {\r\n    return identifier === DEFAULT_ENTRY_NAME ? undefined : identifier;\r\n}\r\nfunction isComponentEager(component) {\r\n    return component.instantiationMode === \"EAGER\" /* EAGER */;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * ComponentContainer that provides Providers for service name T, e.g. `auth`, `auth-internal`\r\n */\r\nclass ComponentContainer {\r\n    constructor(name) {\r\n        this.name = name;\r\n        this.providers = new Map();\r\n    }\r\n    /**\r\n     *\r\n     * @param component Component being added\r\n     * @param overwrite When a component with the same name has already been registered,\r\n     * if overwrite is true: overwrite the existing component with the new component and create a new\r\n     * provider with the new component. It can be useful in tests where you want to use different mocks\r\n     * for different tests.\r\n     * if overwrite is false: throw an exception\r\n     */\r\n    addComponent(component) {\r\n        const provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            throw new Error(`Component ${component.name} has already been registered with ${this.name}`);\r\n        }\r\n        provider.setComponent(component);\r\n    }\r\n    addOrOverwriteComponent(component) {\r\n        const provider = this.getProvider(component.name);\r\n        if (provider.isComponentSet()) {\r\n            // delete the existing provider from the container, so we can register the new component\r\n            this.providers.delete(component.name);\r\n        }\r\n        this.addComponent(component);\r\n    }\r\n    /**\r\n     * getProvider provides a type safe interface where it can only be called with a field name\r\n     * present in NameServiceMapping interface.\r\n     *\r\n     * Firebase SDKs providing services should extend NameServiceMapping interface to register\r\n     * themselves.\r\n     */\r\n    getProvider(name) {\r\n        if (this.providers.has(name)) {\r\n            return this.providers.get(name);\r\n        }\r\n        // create a Provider for a service that hasn't registered with Firebase\r\n        const provider = new Provider(name, this);\r\n        this.providers.set(name, provider);\r\n        return provider;\r\n    }\r\n    getProviders() {\r\n        return Array.from(this.providers.values());\r\n    }\r\n}\n\nexport { Component, ComponentContainer, Provider };\n//# sourceMappingURL=index.esm2017.js.map\n","/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A container for all of the Logger instances\r\n */\r\nconst instances = [];\r\n/**\r\n * The JS SDK supports 5 log levels and also allows a user the ability to\r\n * silence the logs altogether.\r\n *\r\n * The order is a follows:\r\n * DEBUG < VERBOSE < INFO < WARN < ERROR\r\n *\r\n * All of the log types above the current log level will be captured (i.e. if\r\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\r\n * `VERBOSE` logs will not)\r\n */\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\r\n    LogLevel[LogLevel[\"VERBOSE\"] = 1] = \"VERBOSE\";\r\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\r\n    LogLevel[LogLevel[\"WARN\"] = 3] = \"WARN\";\r\n    LogLevel[LogLevel[\"ERROR\"] = 4] = \"ERROR\";\r\n    LogLevel[LogLevel[\"SILENT\"] = 5] = \"SILENT\";\r\n})(LogLevel || (LogLevel = {}));\r\nconst levelStringToEnum = {\r\n    'debug': LogLevel.DEBUG,\r\n    'verbose': LogLevel.VERBOSE,\r\n    'info': LogLevel.INFO,\r\n    'warn': LogLevel.WARN,\r\n    'error': LogLevel.ERROR,\r\n    'silent': LogLevel.SILENT\r\n};\r\n/**\r\n * The default log level\r\n */\r\nconst defaultLogLevel = LogLevel.INFO;\r\n/**\r\n * By default, `console.debug` is not displayed in the developer console (in\r\n * chrome). To avoid forcing users to have to opt-in to these logs twice\r\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\r\n * logs to the `console.log` function.\r\n */\r\nconst ConsoleMethod = {\r\n    [LogLevel.DEBUG]: 'log',\r\n    [LogLevel.VERBOSE]: 'log',\r\n    [LogLevel.INFO]: 'info',\r\n    [LogLevel.WARN]: 'warn',\r\n    [LogLevel.ERROR]: 'error'\r\n};\r\n/**\r\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\r\n * messages on to their corresponding console counterparts (if the log method\r\n * is supported by the current log level)\r\n */\r\nconst defaultLogHandler = (instance, logType, ...args) => {\r\n    if (logType < instance.logLevel) {\r\n        return;\r\n    }\r\n    const now = new Date().toISOString();\r\n    const method = ConsoleMethod[logType];\r\n    if (method) {\r\n        console[method](`[${now}]  ${instance.name}:`, ...args);\r\n    }\r\n    else {\r\n        throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);\r\n    }\r\n};\r\nclass Logger {\r\n    /**\r\n     * Gives you an instance of a Logger to capture messages according to\r\n     * Firebase's logging scheme.\r\n     *\r\n     * @param name The name that the logs will be associated with\r\n     */\r\n    constructor(name) {\r\n        this.name = name;\r\n        /**\r\n         * The log level of the given Logger instance.\r\n         */\r\n        this._logLevel = defaultLogLevel;\r\n        /**\r\n         * The main (internal) log handler for the Logger instance.\r\n         * Can be set to a new function in internal package code but not by user.\r\n         */\r\n        this._logHandler = defaultLogHandler;\r\n        /**\r\n         * The optional, additional, user-defined log handler for the Logger instance.\r\n         */\r\n        this._userLogHandler = null;\r\n        /**\r\n         * Capture the current instance for later use\r\n         */\r\n        instances.push(this);\r\n    }\r\n    get logLevel() {\r\n        return this._logLevel;\r\n    }\r\n    set logLevel(val) {\r\n        if (!(val in LogLevel)) {\r\n            throw new TypeError(`Invalid value \"${val}\" assigned to \\`logLevel\\``);\r\n        }\r\n        this._logLevel = val;\r\n    }\r\n    // Workaround for setter/getter having to be the same type.\r\n    setLogLevel(val) {\r\n        this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\r\n    }\r\n    get logHandler() {\r\n        return this._logHandler;\r\n    }\r\n    set logHandler(val) {\r\n        if (typeof val !== 'function') {\r\n            throw new TypeError('Value assigned to `logHandler` must be a function');\r\n        }\r\n        this._logHandler = val;\r\n    }\r\n    get userLogHandler() {\r\n        return this._userLogHandler;\r\n    }\r\n    set userLogHandler(val) {\r\n        this._userLogHandler = val;\r\n    }\r\n    /**\r\n     * The functions below are all based on the `console` interface\r\n     */\r\n    debug(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);\r\n        this._logHandler(this, LogLevel.DEBUG, ...args);\r\n    }\r\n    log(...args) {\r\n        this._userLogHandler &&\r\n            this._userLogHandler(this, LogLevel.VERBOSE, ...args);\r\n        this._logHandler(this, LogLevel.VERBOSE, ...args);\r\n    }\r\n    info(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);\r\n        this._logHandler(this, LogLevel.INFO, ...args);\r\n    }\r\n    warn(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);\r\n        this._logHandler(this, LogLevel.WARN, ...args);\r\n    }\r\n    error(...args) {\r\n        this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);\r\n        this._logHandler(this, LogLevel.ERROR, ...args);\r\n    }\r\n}\r\nfunction setLogLevel(level) {\r\n    instances.forEach(inst => {\r\n        inst.setLogLevel(level);\r\n    });\r\n}\r\nfunction setUserLogHandler(logCallback, options) {\r\n    for (const instance of instances) {\r\n        let customLogLevel = null;\r\n        if (options && options.level) {\r\n            customLogLevel = levelStringToEnum[options.level];\r\n        }\r\n        if (logCallback === null) {\r\n            instance.userLogHandler = null;\r\n        }\r\n        else {\r\n            instance.userLogHandler = (instance, level, ...args) => {\r\n                const message = args\r\n                    .map(arg => {\r\n                    if (arg == null) {\r\n                        return null;\r\n                    }\r\n                    else if (typeof arg === 'string') {\r\n                        return arg;\r\n                    }\r\n                    else if (typeof arg === 'number' || typeof arg === 'boolean') {\r\n                        return arg.toString();\r\n                    }\r\n                    else if (arg instanceof Error) {\r\n                        return arg.message;\r\n                    }\r\n                    else {\r\n                        try {\r\n                            return JSON.stringify(arg);\r\n                        }\r\n                        catch (ignored) {\r\n                            return null;\r\n                        }\r\n                    }\r\n                })\r\n                    .filter(arg => arg)\r\n                    .join(' ');\r\n                if (level >= (customLogLevel !== null && customLogLevel !== void 0 ? customLogLevel : instance.logLevel)) {\r\n                    logCallback({\r\n                        level: LogLevel[level].toLowerCase(),\r\n                        message,\r\n                        args,\r\n                        type: instance.name\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    }\r\n}\n\nexport { LogLevel, Logger, setLogLevel, setUserLogHandler };\n//# sourceMappingURL=index.esm2017.js.map\n","import { Component, ComponentContainer } from '@firebase/component';\nimport { Logger, setUserLogHandler, setLogLevel as setLogLevel$1 } from '@firebase/logger';\nimport { ErrorFactory, deepEqual, openDB, base64urlEncodeWithoutPadding, isIndexedDBAvailable, validateIndexedDBOpenable } from '@firebase/util';\nexport { FirebaseError } from '@firebase/util';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass PlatformLoggerServiceImpl {\r\n    constructor(container) {\r\n        this.container = container;\r\n    }\r\n    // In initial implementation, this will be called by installations on\r\n    // auth token refresh, and installations will send this string.\r\n    getPlatformInfoString() {\r\n        const providers = this.container.getProviders();\r\n        // Loop through providers and get library/version pairs from any that are\r\n        // version components.\r\n        return providers\r\n            .map(provider => {\r\n            if (isVersionServiceProvider(provider)) {\r\n                const service = provider.getImmediate();\r\n                return `${service.library}/${service.version}`;\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        })\r\n            .filter(logString => logString)\r\n            .join(' ');\r\n    }\r\n}\r\n/**\r\n *\r\n * @param provider check if this provider provides a VersionService\r\n *\r\n * NOTE: Using Provider<'app-version'> is a hack to indicate that the provider\r\n * provides VersionService. The provider is not necessarily a 'app-version'\r\n * provider.\r\n */\r\nfunction isVersionServiceProvider(provider) {\r\n    const component = provider.getComponent();\r\n    return (component === null || component === void 0 ? void 0 : component.type) === \"VERSION\" /* VERSION */;\r\n}\n\nconst name$o = \"@firebase/app\";\nconst version$1 = \"0.7.21\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst logger = new Logger('@firebase/app');\n\nconst name$n = \"@firebase/app-compat\";\n\nconst name$m = \"@firebase/analytics-compat\";\n\nconst name$l = \"@firebase/analytics\";\n\nconst name$k = \"@firebase/app-check-compat\";\n\nconst name$j = \"@firebase/app-check\";\n\nconst name$i = \"@firebase/auth\";\n\nconst name$h = \"@firebase/auth-compat\";\n\nconst name$g = \"@firebase/database\";\n\nconst name$f = \"@firebase/database-compat\";\n\nconst name$e = \"@firebase/functions\";\n\nconst name$d = \"@firebase/functions-compat\";\n\nconst name$c = \"@firebase/installations\";\n\nconst name$b = \"@firebase/installations-compat\";\n\nconst name$a = \"@firebase/messaging\";\n\nconst name$9 = \"@firebase/messaging-compat\";\n\nconst name$8 = \"@firebase/performance\";\n\nconst name$7 = \"@firebase/performance-compat\";\n\nconst name$6 = \"@firebase/remote-config\";\n\nconst name$5 = \"@firebase/remote-config-compat\";\n\nconst name$4 = \"@firebase/storage\";\n\nconst name$3 = \"@firebase/storage-compat\";\n\nconst name$2 = \"@firebase/firestore\";\n\nconst name$1 = \"@firebase/firestore-compat\";\n\nconst name = \"firebase\";\nconst version = \"9.6.11\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The default app name\r\n *\r\n * @internal\r\n */\r\nconst DEFAULT_ENTRY_NAME = '[DEFAULT]';\r\nconst PLATFORM_LOG_STRING = {\r\n    [name$o]: 'fire-core',\r\n    [name$n]: 'fire-core-compat',\r\n    [name$l]: 'fire-analytics',\r\n    [name$m]: 'fire-analytics-compat',\r\n    [name$j]: 'fire-app-check',\r\n    [name$k]: 'fire-app-check-compat',\r\n    [name$i]: 'fire-auth',\r\n    [name$h]: 'fire-auth-compat',\r\n    [name$g]: 'fire-rtdb',\r\n    [name$f]: 'fire-rtdb-compat',\r\n    [name$e]: 'fire-fn',\r\n    [name$d]: 'fire-fn-compat',\r\n    [name$c]: 'fire-iid',\r\n    [name$b]: 'fire-iid-compat',\r\n    [name$a]: 'fire-fcm',\r\n    [name$9]: 'fire-fcm-compat',\r\n    [name$8]: 'fire-perf',\r\n    [name$7]: 'fire-perf-compat',\r\n    [name$6]: 'fire-rc',\r\n    [name$5]: 'fire-rc-compat',\r\n    [name$4]: 'fire-gcs',\r\n    [name$3]: 'fire-gcs-compat',\r\n    [name$2]: 'fire-fst',\r\n    [name$1]: 'fire-fst-compat',\r\n    'fire-js': 'fire-js',\r\n    [name]: 'fire-js-all'\r\n};\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @internal\r\n */\r\nconst _apps = new Map();\r\n/**\r\n * Registered components.\r\n *\r\n * @internal\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nconst _components = new Map();\r\n/**\r\n * @param component - the component being added to this app's container\r\n *\r\n * @internal\r\n */\r\nfunction _addComponent(app, component) {\r\n    try {\r\n        app.container.addComponent(component);\r\n    }\r\n    catch (e) {\r\n        logger.debug(`Component ${component.name} failed to register with FirebaseApp ${app.name}`, e);\r\n    }\r\n}\r\n/**\r\n *\r\n * @internal\r\n */\r\nfunction _addOrOverwriteComponent(app, component) {\r\n    app.container.addOrOverwriteComponent(component);\r\n}\r\n/**\r\n *\r\n * @param component - the component to register\r\n * @returns whether or not the component is registered successfully\r\n *\r\n * @internal\r\n */\r\nfunction _registerComponent(component) {\r\n    const componentName = component.name;\r\n    if (_components.has(componentName)) {\r\n        logger.debug(`There were multiple attempts to register component ${componentName}.`);\r\n        return false;\r\n    }\r\n    _components.set(componentName, component);\r\n    // add the component to existing app instances\r\n    for (const app of _apps.values()) {\r\n        _addComponent(app, component);\r\n    }\r\n    return true;\r\n}\r\n/**\r\n *\r\n * @param app - FirebaseApp instance\r\n * @param name - service name\r\n *\r\n * @returns the provider for the service with the matching name\r\n *\r\n * @internal\r\n */\r\nfunction _getProvider(app, name) {\r\n    const heartbeatController = app.container\r\n        .getProvider('heartbeat')\r\n        .getImmediate({ optional: true });\r\n    if (heartbeatController) {\r\n        void heartbeatController.triggerHeartbeat();\r\n    }\r\n    return app.container.getProvider(name);\r\n}\r\n/**\r\n *\r\n * @param app - FirebaseApp instance\r\n * @param name - service name\r\n * @param instanceIdentifier - service instance identifier in case the service supports multiple instances\r\n *\r\n * @internal\r\n */\r\nfunction _removeServiceInstance(app, name, instanceIdentifier = DEFAULT_ENTRY_NAME) {\r\n    _getProvider(app, name).clearInstance(instanceIdentifier);\r\n}\r\n/**\r\n * Test only\r\n *\r\n * @internal\r\n */\r\nfunction _clearComponents() {\r\n    _components.clear();\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERRORS = {\r\n    [\"no-app\" /* NO_APP */]: \"No Firebase App '{$appName}' has been created - \" +\r\n        'call Firebase App.initializeApp()',\r\n    [\"bad-app-name\" /* BAD_APP_NAME */]: \"Illegal App name: '{$appName}\",\r\n    [\"duplicate-app\" /* DUPLICATE_APP */]: \"Firebase App named '{$appName}' already exists with different options or config\",\r\n    [\"app-deleted\" /* APP_DELETED */]: \"Firebase App named '{$appName}' already deleted\",\r\n    [\"invalid-app-argument\" /* INVALID_APP_ARGUMENT */]: 'firebase.{$appName}() takes either no argument or a ' +\r\n        'Firebase App instance.',\r\n    [\"invalid-log-argument\" /* INVALID_LOG_ARGUMENT */]: 'First argument to `onLog` must be null or a function.',\r\n    [\"storage-open\" /* STORAGE_OPEN */]: 'Error thrown when opening storage. Original error: {$originalErrorMessage}.',\r\n    [\"storage-get\" /* STORAGE_GET */]: 'Error thrown when reading from storage. Original error: {$originalErrorMessage}.',\r\n    [\"storage-set\" /* STORAGE_WRITE */]: 'Error thrown when writing to storage. Original error: {$originalErrorMessage}.',\r\n    [\"storage-delete\" /* STORAGE_DELETE */]: 'Error thrown when deleting from storage. Original error: {$originalErrorMessage}.'\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory('app', 'Firebase', ERRORS);\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass FirebaseAppImpl {\r\n    constructor(options, config, container) {\r\n        this._isDeleted = false;\r\n        this._options = Object.assign({}, options);\r\n        this._config = Object.assign({}, config);\r\n        this._name = config.name;\r\n        this._automaticDataCollectionEnabled =\r\n            config.automaticDataCollectionEnabled;\r\n        this._container = container;\r\n        this.container.addComponent(new Component('app', () => this, \"PUBLIC\" /* PUBLIC */));\r\n    }\r\n    get automaticDataCollectionEnabled() {\r\n        this.checkDestroyed();\r\n        return this._automaticDataCollectionEnabled;\r\n    }\r\n    set automaticDataCollectionEnabled(val) {\r\n        this.checkDestroyed();\r\n        this._automaticDataCollectionEnabled = val;\r\n    }\r\n    get name() {\r\n        this.checkDestroyed();\r\n        return this._name;\r\n    }\r\n    get options() {\r\n        this.checkDestroyed();\r\n        return this._options;\r\n    }\r\n    get config() {\r\n        this.checkDestroyed();\r\n        return this._config;\r\n    }\r\n    get container() {\r\n        return this._container;\r\n    }\r\n    get isDeleted() {\r\n        return this._isDeleted;\r\n    }\r\n    set isDeleted(val) {\r\n        this._isDeleted = val;\r\n    }\r\n    /**\r\n     * This function will throw an Error if the App has already been deleted -\r\n     * use before performing API actions on the App.\r\n     */\r\n    checkDestroyed() {\r\n        if (this.isDeleted) {\r\n            throw ERROR_FACTORY.create(\"app-deleted\" /* APP_DELETED */, { appName: this._name });\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * The current SDK version.\r\n *\r\n * @public\r\n */\r\nconst SDK_VERSION = version;\r\nfunction initializeApp(options, rawConfig = {}) {\r\n    if (typeof rawConfig !== 'object') {\r\n        const name = rawConfig;\r\n        rawConfig = { name };\r\n    }\r\n    const config = Object.assign({ name: DEFAULT_ENTRY_NAME, automaticDataCollectionEnabled: false }, rawConfig);\r\n    const name = config.name;\r\n    if (typeof name !== 'string' || !name) {\r\n        throw ERROR_FACTORY.create(\"bad-app-name\" /* BAD_APP_NAME */, {\r\n            appName: String(name)\r\n        });\r\n    }\r\n    const existingApp = _apps.get(name);\r\n    if (existingApp) {\r\n        // return the existing app if options and config deep equal the ones in the existing app.\r\n        if (deepEqual(options, existingApp.options) &&\r\n            deepEqual(config, existingApp.config)) {\r\n            return existingApp;\r\n        }\r\n        else {\r\n            throw ERROR_FACTORY.create(\"duplicate-app\" /* DUPLICATE_APP */, { appName: name });\r\n        }\r\n    }\r\n    const container = new ComponentContainer(name);\r\n    for (const component of _components.values()) {\r\n        container.addComponent(component);\r\n    }\r\n    const newApp = new FirebaseAppImpl(options, config, container);\r\n    _apps.set(name, newApp);\r\n    return newApp;\r\n}\r\n/**\r\n * Retrieves a {@link @firebase/app#FirebaseApp} instance.\r\n *\r\n * When called with no arguments, the default app is returned. When an app name\r\n * is provided, the app corresponding to that name is returned.\r\n *\r\n * An exception is thrown if the app being retrieved has not yet been\r\n * initialized.\r\n *\r\n * @example\r\n * ```javascript\r\n * // Return the default app\r\n * const app = getApp();\r\n * ```\r\n *\r\n * @example\r\n * ```javascript\r\n * // Return a named app\r\n * const otherApp = getApp(\"otherApp\");\r\n * ```\r\n *\r\n * @param name - Optional name of the app to return. If no name is\r\n *   provided, the default is `\"[DEFAULT]\"`.\r\n *\r\n * @returns The app corresponding to the provided app name.\r\n *   If no app name is provided, the default app is returned.\r\n *\r\n * @public\r\n */\r\nfunction getApp(name = DEFAULT_ENTRY_NAME) {\r\n    const app = _apps.get(name);\r\n    if (!app) {\r\n        throw ERROR_FACTORY.create(\"no-app\" /* NO_APP */, { appName: name });\r\n    }\r\n    return app;\r\n}\r\n/**\r\n * A (read-only) array of all initialized apps.\r\n * @public\r\n */\r\nfunction getApps() {\r\n    return Array.from(_apps.values());\r\n}\r\n/**\r\n * Renders this app unusable and frees the resources of all associated\r\n * services.\r\n *\r\n * @example\r\n * ```javascript\r\n * deleteApp(app)\r\n *   .then(function() {\r\n *     console.log(\"App deleted successfully\");\r\n *   })\r\n *   .catch(function(error) {\r\n *     console.log(\"Error deleting app:\", error);\r\n *   });\r\n * ```\r\n *\r\n * @public\r\n */\r\nasync function deleteApp(app) {\r\n    const name = app.name;\r\n    if (_apps.has(name)) {\r\n        _apps.delete(name);\r\n        await Promise.all(app.container\r\n            .getProviders()\r\n            .map(provider => provider.delete()));\r\n        app.isDeleted = true;\r\n    }\r\n}\r\n/**\r\n * Registers a library's name and version for platform logging purposes.\r\n * @param library - Name of 1p or 3p library (e.g. firestore, angularfire)\r\n * @param version - Current version of that library.\r\n * @param variant - Bundle variant, e.g., node, rn, etc.\r\n *\r\n * @public\r\n */\r\nfunction registerVersion(libraryKeyOrName, version, variant) {\r\n    var _a;\r\n    // TODO: We can use this check to whitelist strings when/if we set up\r\n    // a good whitelist system.\r\n    let library = (_a = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a !== void 0 ? _a : libraryKeyOrName;\r\n    if (variant) {\r\n        library += `-${variant}`;\r\n    }\r\n    const libraryMismatch = library.match(/\\s|\\//);\r\n    const versionMismatch = version.match(/\\s|\\//);\r\n    if (libraryMismatch || versionMismatch) {\r\n        const warning = [\r\n            `Unable to register library \"${library}\" with version \"${version}\":`\r\n        ];\r\n        if (libraryMismatch) {\r\n            warning.push(`library name \"${library}\" contains illegal characters (whitespace or \"/\")`);\r\n        }\r\n        if (libraryMismatch && versionMismatch) {\r\n            warning.push('and');\r\n        }\r\n        if (versionMismatch) {\r\n            warning.push(`version name \"${version}\" contains illegal characters (whitespace or \"/\")`);\r\n        }\r\n        logger.warn(warning.join(' '));\r\n        return;\r\n    }\r\n    _registerComponent(new Component(`${library}-version`, () => ({ library, version }), \"VERSION\" /* VERSION */));\r\n}\r\n/**\r\n * Sets log handler for all Firebase SDKs.\r\n * @param logCallback - An optional custom log handler that executes user code whenever\r\n * the Firebase SDK makes a logging call.\r\n *\r\n * @public\r\n */\r\nfunction onLog(logCallback, options) {\r\n    if (logCallback !== null && typeof logCallback !== 'function') {\r\n        throw ERROR_FACTORY.create(\"invalid-log-argument\" /* INVALID_LOG_ARGUMENT */);\r\n    }\r\n    setUserLogHandler(logCallback, options);\r\n}\r\n/**\r\n * Sets log level for all Firebase SDKs.\r\n *\r\n * All of the log types above the current log level are captured (i.e. if\r\n * you set the log level to `info`, errors are logged, but `debug` and\r\n * `verbose` logs are not).\r\n *\r\n * @public\r\n */\r\nfunction setLogLevel(logLevel) {\r\n    setLogLevel$1(logLevel);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DB_NAME = 'firebase-heartbeat-database';\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'firebase-heartbeat-store';\r\nlet dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB(DB_NAME, DB_VERSION, (db, oldVersion) => {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (oldVersion) {\r\n                case 0:\r\n                    db.createObjectStore(STORE_NAME);\r\n            }\r\n        }).catch(e => {\r\n            throw ERROR_FACTORY.create(\"storage-open\" /* STORAGE_OPEN */, {\r\n                originalErrorMessage: e.message\r\n            });\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\nasync function readHeartbeatsFromIndexedDB(app) {\r\n    try {\r\n        const db = await getDbPromise();\r\n        return db\r\n            .transaction(STORE_NAME)\r\n            .objectStore(STORE_NAME)\r\n            .get(computeKey(app));\r\n    }\r\n    catch (e) {\r\n        throw ERROR_FACTORY.create(\"storage-get\" /* STORAGE_GET */, {\r\n            originalErrorMessage: e.message\r\n        });\r\n    }\r\n}\r\nasync function writeHeartbeatsToIndexedDB(app, heartbeatObject) {\r\n    try {\r\n        const db = await getDbPromise();\r\n        const tx = db.transaction(STORE_NAME, 'readwrite');\r\n        const objectStore = tx.objectStore(STORE_NAME);\r\n        await objectStore.put(heartbeatObject, computeKey(app));\r\n        return tx.complete;\r\n    }\r\n    catch (e) {\r\n        throw ERROR_FACTORY.create(\"storage-set\" /* STORAGE_WRITE */, {\r\n            originalErrorMessage: e.message\r\n        });\r\n    }\r\n}\r\nfunction computeKey(app) {\r\n    return `${app.name}!${app.options.appId}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2021 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst MAX_HEADER_BYTES = 1024;\r\n// 30 days\r\nconst STORED_HEARTBEAT_RETENTION_MAX_MILLIS = 30 * 24 * 60 * 60 * 1000;\r\nclass HeartbeatServiceImpl {\r\n    constructor(container) {\r\n        this.container = container;\r\n        /**\r\n         * In-memory cache for heartbeats, used by getHeartbeatsHeader() to generate\r\n         * the header string.\r\n         * Stores one record per date. This will be consolidated into the standard\r\n         * format of one record per user agent string before being sent as a header.\r\n         * Populated from indexedDB when the controller is instantiated and should\r\n         * be kept in sync with indexedDB.\r\n         * Leave public for easier testing.\r\n         */\r\n        this._heartbeatsCache = null;\r\n        const app = this.container.getProvider('app').getImmediate();\r\n        this._storage = new HeartbeatStorageImpl(app);\r\n        this._heartbeatsCachePromise = this._storage.read().then(result => {\r\n            this._heartbeatsCache = result;\r\n            return result;\r\n        });\r\n    }\r\n    /**\r\n     * Called to report a heartbeat. The function will generate\r\n     * a HeartbeatsByUserAgent object, update heartbeatsCache, and persist it\r\n     * to IndexedDB.\r\n     * Note that we only store one heartbeat per day. So if a heartbeat for today is\r\n     * already logged, subsequent calls to this function in the same day will be ignored.\r\n     */\r\n    async triggerHeartbeat() {\r\n        const platformLogger = this.container\r\n            .getProvider('platform-logger')\r\n            .getImmediate();\r\n        // This is the \"Firebase user agent\" string from the platform logger\r\n        // service, not the browser user agent.\r\n        const agent = platformLogger.getPlatformInfoString();\r\n        const date = getUTCDateString();\r\n        if (this._heartbeatsCache === null) {\r\n            this._heartbeatsCache = await this._heartbeatsCachePromise;\r\n        }\r\n        // Do not store a heartbeat if one is already stored for this day\r\n        // or if a header has already been sent today.\r\n        if (this._heartbeatsCache.lastSentHeartbeatDate === date ||\r\n            this._heartbeatsCache.heartbeats.some(singleDateHeartbeat => singleDateHeartbeat.date === date)) {\r\n            return;\r\n        }\r\n        else {\r\n            // There is no entry for this date. Create one.\r\n            this._heartbeatsCache.heartbeats.push({ date, agent });\r\n        }\r\n        // Remove entries older than 30 days.\r\n        this._heartbeatsCache.heartbeats = this._heartbeatsCache.heartbeats.filter(singleDateHeartbeat => {\r\n            const hbTimestamp = new Date(singleDateHeartbeat.date).valueOf();\r\n            const now = Date.now();\r\n            return now - hbTimestamp <= STORED_HEARTBEAT_RETENTION_MAX_MILLIS;\r\n        });\r\n        return this._storage.overwrite(this._heartbeatsCache);\r\n    }\r\n    /**\r\n     * Returns a base64 encoded string which can be attached to the heartbeat-specific header directly.\r\n     * It also clears all heartbeats from memory as well as in IndexedDB.\r\n     *\r\n     * NOTE: Consuming product SDKs should not send the header if this method\r\n     * returns an empty string.\r\n     */\r\n    async getHeartbeatsHeader() {\r\n        if (this._heartbeatsCache === null) {\r\n            await this._heartbeatsCachePromise;\r\n        }\r\n        // If it's still null or the array is empty, there is no data to send.\r\n        if (this._heartbeatsCache === null ||\r\n            this._heartbeatsCache.heartbeats.length === 0) {\r\n            return '';\r\n        }\r\n        const date = getUTCDateString();\r\n        // Extract as many heartbeats from the cache as will fit under the size limit.\r\n        const { heartbeatsToSend, unsentEntries } = extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats);\r\n        const headerString = base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsToSend }));\r\n        // Store last sent date to prevent another being logged/sent for the same day.\r\n        this._heartbeatsCache.lastSentHeartbeatDate = date;\r\n        if (unsentEntries.length > 0) {\r\n            // Store any unsent entries if they exist.\r\n            this._heartbeatsCache.heartbeats = unsentEntries;\r\n            // This seems more likely than emptying the array (below) to lead to some odd state\r\n            // since the cache isn't empty and this will be called again on the next request,\r\n            // and is probably safest if we await it.\r\n            await this._storage.overwrite(this._heartbeatsCache);\r\n        }\r\n        else {\r\n            this._heartbeatsCache.heartbeats = [];\r\n            // Do not wait for this, to reduce latency.\r\n            void this._storage.overwrite(this._heartbeatsCache);\r\n        }\r\n        return headerString;\r\n    }\r\n}\r\nfunction getUTCDateString() {\r\n    const today = new Date();\r\n    // Returns date format 'YYYY-MM-DD'\r\n    return today.toISOString().substring(0, 10);\r\n}\r\nfunction extractHeartbeatsForHeader(heartbeatsCache, maxSize = MAX_HEADER_BYTES) {\r\n    // Heartbeats grouped by user agent in the standard format to be sent in\r\n    // the header.\r\n    const heartbeatsToSend = [];\r\n    // Single date format heartbeats that are not sent.\r\n    let unsentEntries = heartbeatsCache.slice();\r\n    for (const singleDateHeartbeat of heartbeatsCache) {\r\n        // Look for an existing entry with the same user agent.\r\n        const heartbeatEntry = heartbeatsToSend.find(hb => hb.agent === singleDateHeartbeat.agent);\r\n        if (!heartbeatEntry) {\r\n            // If no entry for this user agent exists, create one.\r\n            heartbeatsToSend.push({\r\n                agent: singleDateHeartbeat.agent,\r\n                dates: [singleDateHeartbeat.date]\r\n            });\r\n            if (countBytes(heartbeatsToSend) > maxSize) {\r\n                // If the header would exceed max size, remove the added heartbeat\r\n                // entry and stop adding to the header.\r\n                heartbeatsToSend.pop();\r\n                break;\r\n            }\r\n        }\r\n        else {\r\n            heartbeatEntry.dates.push(singleDateHeartbeat.date);\r\n            // If the header would exceed max size, remove the added date\r\n            // and stop adding to the header.\r\n            if (countBytes(heartbeatsToSend) > maxSize) {\r\n                heartbeatEntry.dates.pop();\r\n                break;\r\n            }\r\n        }\r\n        // Pop unsent entry from queue. (Skipped if adding the entry exceeded\r\n        // quota and the loop breaks early.)\r\n        unsentEntries = unsentEntries.slice(1);\r\n    }\r\n    return {\r\n        heartbeatsToSend,\r\n        unsentEntries\r\n    };\r\n}\r\nclass HeartbeatStorageImpl {\r\n    constructor(app) {\r\n        this.app = app;\r\n        this._canUseIndexedDBPromise = this.runIndexedDBEnvironmentCheck();\r\n    }\r\n    async runIndexedDBEnvironmentCheck() {\r\n        if (!isIndexedDBAvailable()) {\r\n            return false;\r\n        }\r\n        else {\r\n            return validateIndexedDBOpenable()\r\n                .then(() => true)\r\n                .catch(() => false);\r\n        }\r\n    }\r\n    /**\r\n     * Read all heartbeats.\r\n     */\r\n    async read() {\r\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\r\n        if (!canUseIndexedDB) {\r\n            return { heartbeats: [] };\r\n        }\r\n        else {\r\n            const idbHeartbeatObject = await readHeartbeatsFromIndexedDB(this.app);\r\n            return idbHeartbeatObject || { heartbeats: [] };\r\n        }\r\n    }\r\n    // overwrite the storage with the provided heartbeats\r\n    async overwrite(heartbeatsObject) {\r\n        var _a;\r\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\r\n        if (!canUseIndexedDB) {\r\n            return;\r\n        }\r\n        else {\r\n            const existingHeartbeatsObject = await this.read();\r\n            return writeHeartbeatsToIndexedDB(this.app, {\r\n                lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,\r\n                heartbeats: heartbeatsObject.heartbeats\r\n            });\r\n        }\r\n    }\r\n    // add heartbeats\r\n    async add(heartbeatsObject) {\r\n        var _a;\r\n        const canUseIndexedDB = await this._canUseIndexedDBPromise;\r\n        if (!canUseIndexedDB) {\r\n            return;\r\n        }\r\n        else {\r\n            const existingHeartbeatsObject = await this.read();\r\n            return writeHeartbeatsToIndexedDB(this.app, {\r\n                lastSentHeartbeatDate: (_a = heartbeatsObject.lastSentHeartbeatDate) !== null && _a !== void 0 ? _a : existingHeartbeatsObject.lastSentHeartbeatDate,\r\n                heartbeats: [\r\n                    ...existingHeartbeatsObject.heartbeats,\r\n                    ...heartbeatsObject.heartbeats\r\n                ]\r\n            });\r\n        }\r\n    }\r\n}\r\n/**\r\n * Calculate bytes of a HeartbeatsByUserAgent array after being wrapped\r\n * in a platform logging header JSON object, stringified, and converted\r\n * to base 64.\r\n */\r\nfunction countBytes(heartbeatsCache) {\r\n    // base64 has a restricted set of characters, all of which should be 1 byte.\r\n    return base64urlEncodeWithoutPadding(\r\n    // heartbeatsCache wrapper properties\r\n    JSON.stringify({ version: 2, heartbeats: heartbeatsCache })).length;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerCoreComponents(variant) {\r\n    _registerComponent(new Component('platform-logger', container => new PlatformLoggerServiceImpl(container), \"PRIVATE\" /* PRIVATE */));\r\n    _registerComponent(new Component('heartbeat', container => new HeartbeatServiceImpl(container), \"PRIVATE\" /* PRIVATE */));\r\n    // Register `app` package.\r\n    registerVersion(name$o, version$1, variant);\r\n    // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\n    registerVersion(name$o, version$1, 'esm2017');\r\n    // Register platform SDK identifier (no version).\r\n    registerVersion('fire-js', '');\r\n}\n\n/**\r\n * Firebase App\r\n *\r\n * @remarks This package coordinates the communication between the different Firebase components\r\n * @packageDocumentation\r\n */\r\nregisterCoreComponents('');\n\nexport { SDK_VERSION, DEFAULT_ENTRY_NAME as _DEFAULT_ENTRY_NAME, _addComponent, _addOrOverwriteComponent, _apps, _clearComponents, _components, _getProvider, _registerComponent, _removeServiceInstance, deleteApp, getApp, getApps, initializeApp, onLog, registerVersion, setLogLevel };\n//# sourceMappingURL=index.esm2017.js.map\n","import { registerVersion } from '@firebase/app';\nexport * from '@firebase/app';\n\nvar name = \"firebase\";\nvar version = \"9.6.11\";\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nregisterVersion(name, version, 'app');\n//# sourceMappingURL=index.esm.js.map\n","import { getApp, _getProvider, _registerComponent, registerVersion } from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { ErrorFactory, FirebaseError, openDB } from '@firebase/util';\n\nconst name = \"@firebase/installations\";\nconst version = \"0.5.8\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst PENDING_TIMEOUT_MS = 10000;\r\nconst PACKAGE_VERSION = `w:${version}`;\r\nconst INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nconst INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nconst TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nconst SERVICE = 'installations';\r\nconst SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERROR_DESCRIPTION_MAP = {\r\n    [\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */]: 'Missing App configuration value: \"{$valueName}\"',\r\n    [\"not-registered\" /* NOT_REGISTERED */]: 'Firebase Installation is not registered.',\r\n    [\"installation-not-found\" /* INSTALLATION_NOT_FOUND */]: 'Firebase Installation not found.',\r\n    [\"request-failed\" /* REQUEST_FAILED */]: '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    [\"app-offline\" /* APP_OFFLINE */]: 'Could not process request. Application offline.',\r\n    [\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */]: \"Can't delete installation while there is a pending registration request.\"\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint({ projectId }) {\r\n    return `${INSTALLATIONS_API_URL}/projects/${projectId}/installations`;\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nasync function getErrorFromResponse(requestName, response) {\r\n    const responseJson = await response.json();\r\n    const errorData = responseJson.error;\r\n    return ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n        requestName,\r\n        serverCode: errorData.code,\r\n        serverMessage: errorData.message,\r\n        serverStatus: errorData.status\r\n    });\r\n}\r\nfunction getHeaders({ apiKey }) {\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, { refreshToken }) {\r\n    const headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nasync function retryIfServerError(fn) {\r\n    const result = await fn();\r\n    if (result.status >= 500 && result.status < 600) {\r\n        // Internal Server Error. Retry request.\r\n        return fn();\r\n    }\r\n    return result;\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return `${INTERNAL_AUTH_VERSION} ${refreshToken}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function createInstallationRequest({ appConfig, heartbeatServiceProvider }, { fid }) {\r\n    const endpoint = getInstallationsEndpoint(appConfig);\r\n    const headers = getHeaders(appConfig);\r\n    // If heartbeat service exists, add the heartbeat string to the header.\r\n    const heartbeatService = heartbeatServiceProvider.getImmediate({\r\n        optional: true\r\n    });\r\n    if (heartbeatService) {\r\n        const heartbeatsHeader = await heartbeatService.getHeartbeatsHeader();\r\n        if (heartbeatsHeader) {\r\n            headers.append('x-firebase-client', heartbeatsHeader);\r\n        }\r\n    }\r\n    const body = {\r\n        fid,\r\n        authVersion: INTERNAL_AUTH_VERSION,\r\n        appId: appConfig.appId,\r\n        sdkVersion: PACKAGE_VERSION\r\n    };\r\n    const request = {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    const response = await retryIfServerError(() => fetch(endpoint, request));\r\n    if (response.ok) {\r\n        const responseValue = await response.json();\r\n        const registeredInstallationEntry = {\r\n            fid: responseValue.fid || fid,\r\n            registrationStatus: 2 /* COMPLETED */,\r\n            refreshToken: responseValue.refreshToken,\r\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n        };\r\n        return registeredInstallationEntry;\r\n    }\r\n    else {\r\n        throw await getErrorFromResponse('Create Installation', response);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(resolve => {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    const b64 = btoa(String.fromCharCode(...array));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nconst INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        const fidByteArray = new Uint8Array(17);\r\n        const crypto = self.crypto || self.msCrypto;\r\n        crypto.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 0b01110000 + (fidByteArray[0] % 0b00010000);\r\n        const fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    const b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return `${appConfig.appName}!${appConfig.appId}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    const key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    const key = getKey(appConfig);\r\n    let callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    const key = getKey(appConfig);\r\n    const callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    const callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    for (const callback of callbacks) {\r\n        callback(fid);\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    const channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key, fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nlet broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = e => {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DATABASE_NAME = 'firebase-installations-database';\r\nconst DATABASE_VERSION = 1;\r\nconst OBJECT_STORE_NAME = 'firebase-installations-store';\r\nlet dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB(DATABASE_NAME, DATABASE_VERSION, (db, oldVersion) => {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (oldVersion) {\r\n                case 0:\r\n                    db.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nasync function set(appConfig, value) {\r\n    const key = getKey(appConfig);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    const objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n    const oldValue = (await objectStore.get(key));\r\n    await objectStore.put(value, key);\r\n    await tx.complete;\r\n    if (!oldValue || oldValue.fid !== value.fid) {\r\n        fidChanged(appConfig, value.fid);\r\n    }\r\n    return value;\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nasync function remove(appConfig) {\r\n    const key = getKey(appConfig);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    await tx.objectStore(OBJECT_STORE_NAME).delete(key);\r\n    await tx.complete;\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nasync function update(appConfig, updateFn) {\r\n    const key = getKey(appConfig);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    const store = tx.objectStore(OBJECT_STORE_NAME);\r\n    const oldValue = (await store.get(key));\r\n    const newValue = updateFn(oldValue);\r\n    if (newValue === undefined) {\r\n        await store.delete(key);\r\n    }\r\n    else {\r\n        await store.put(newValue, key);\r\n    }\r\n    await tx.complete;\r\n    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n        fidChanged(appConfig, newValue.fid);\r\n    }\r\n    return newValue;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nasync function getInstallationEntry(installations) {\r\n    let registrationPromise;\r\n    const installationEntry = await update(installations.appConfig, oldEntry => {\r\n        const installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n        const entryWithPromise = triggerRegistrationIfNecessary(installations, installationEntry);\r\n        registrationPromise = entryWithPromise.registrationPromise;\r\n        return entryWithPromise.installationEntry;\r\n    });\r\n    if (installationEntry.fid === INVALID_FID) {\r\n        // FID generation failed. Waiting for the FID from the server.\r\n        return { installationEntry: await registrationPromise };\r\n    }\r\n    return {\r\n        installationEntry,\r\n        registrationPromise\r\n    };\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    const entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(installations, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            const registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        const inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        const registrationPromise = registerInstallation(installations, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(installations)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nasync function registerInstallation(installations, installationEntry) {\r\n    try {\r\n        const registeredInstallationEntry = await createInstallationRequest(installations, installationEntry);\r\n        return set(installations.appConfig, registeredInstallationEntry);\r\n    }\r\n    catch (e) {\r\n        if (isServerError(e) && e.customData.serverCode === 409) {\r\n            // Server returned a \"FID can not be used\" error.\r\n            // Generate a new ID next time.\r\n            await remove(installations.appConfig);\r\n        }\r\n        else {\r\n            // Registration failed. Set FID as not registered.\r\n            await set(installations.appConfig, {\r\n                fid: installationEntry.fid,\r\n                registrationStatus: 0 /* NOT_STARTED */\r\n            });\r\n        }\r\n        throw e;\r\n    }\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nasync function waitUntilFidRegistration(installations) {\r\n    // Unfortunately, there is no way of reliably observing when a value in\r\n    // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\r\n    // so we need to poll.\r\n    let entry = await updateInstallationRequest(installations.appConfig);\r\n    while (entry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        // createInstallation request still in progress.\r\n        await sleep(100);\r\n        entry = await updateInstallationRequest(installations.appConfig);\r\n    }\r\n    if (entry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        // The request timed out or failed in a different call. Try again.\r\n        const { installationEntry, registrationPromise } = await getInstallationEntry(installations);\r\n        if (registrationPromise) {\r\n            return registrationPromise;\r\n        }\r\n        else {\r\n            // if there is no registrationPromise, entry is registered.\r\n            return installationEntry;\r\n        }\r\n    }\r\n    return entry;\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, oldEntry => {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function generateAuthTokenRequest({ appConfig, heartbeatServiceProvider }, installationEntry) {\r\n    const endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n    const headers = getHeadersWithAuth(appConfig, installationEntry);\r\n    // If heartbeat service exists, add the heartbeat string to the header.\r\n    const heartbeatService = heartbeatServiceProvider.getImmediate({\r\n        optional: true\r\n    });\r\n    if (heartbeatService) {\r\n        const heartbeatsHeader = await heartbeatService.getHeartbeatsHeader();\r\n        if (heartbeatsHeader) {\r\n            headers.append('x-firebase-client', heartbeatsHeader);\r\n        }\r\n    }\r\n    const body = {\r\n        installation: {\r\n            sdkVersion: PACKAGE_VERSION,\r\n            appId: appConfig.appId\r\n        }\r\n    };\r\n    const request = {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    const response = await retryIfServerError(() => fetch(endpoint, request));\r\n    if (response.ok) {\r\n        const responseValue = await response.json();\r\n        const completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n        return completedAuthToken;\r\n    }\r\n    else {\r\n        throw await getErrorFromResponse('Generate Auth Token', response);\r\n    }\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, { fid }) {\r\n    return `${getInstallationsEndpoint(appConfig)}/${fid}/authTokens:generate`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nasync function refreshAuthToken(installations, forceRefresh = false) {\r\n    let tokenPromise;\r\n    const entry = await update(installations.appConfig, oldEntry => {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        const oldAuthToken = oldEntry.authToken;\r\n        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n            // There is a valid token in the DB.\r\n            return oldEntry;\r\n        }\r\n        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n            // There already is a token request in progress.\r\n            tokenPromise = waitUntilAuthTokenRequest(installations, forceRefresh);\r\n            return oldEntry;\r\n        }\r\n        else {\r\n            // No token or token expired.\r\n            if (!navigator.onLine) {\r\n                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n            }\r\n            const inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n            tokenPromise = fetchAuthTokenFromServer(installations, inProgressEntry);\r\n            return inProgressEntry;\r\n        }\r\n    });\r\n    const authToken = tokenPromise\r\n        ? await tokenPromise\r\n        : entry.authToken;\r\n    return authToken;\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nasync function waitUntilAuthTokenRequest(installations, forceRefresh) {\r\n    // Unfortunately, there is no way of reliably observing when a value in\r\n    // IndexedDB changes (yet, see https://github.com/WICG/indexed-db-observers),\r\n    // so we need to poll.\r\n    let entry = await updateAuthTokenRequest(installations.appConfig);\r\n    while (entry.authToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n        // generateAuthToken still in progress.\r\n        await sleep(100);\r\n        entry = await updateAuthTokenRequest(installations.appConfig);\r\n    }\r\n    const authToken = entry.authToken;\r\n    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n        // The request timed out or failed in a different call. Try again.\r\n        return refreshAuthToken(installations, forceRefresh);\r\n    }\r\n    else {\r\n        return authToken;\r\n    }\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, oldEntry => {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        const oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return Object.assign(Object.assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nasync function fetchAuthTokenFromServer(installations, installationEntry) {\r\n    try {\r\n        const authToken = await generateAuthTokenRequest(installations, installationEntry);\r\n        const updatedInstallationEntry = Object.assign(Object.assign({}, installationEntry), { authToken });\r\n        await set(installations.appConfig, updatedInstallationEntry);\r\n        return authToken;\r\n    }\r\n    catch (e) {\r\n        if (isServerError(e) &&\r\n            (e.customData.serverCode === 401 || e.customData.serverCode === 404)) {\r\n            // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n            // Generate a new ID next time.\r\n            await remove(installations.appConfig);\r\n        }\r\n        else {\r\n            const updatedInstallationEntry = Object.assign(Object.assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n            await set(installations.appConfig, updatedInstallationEntry);\r\n        }\r\n        throw e;\r\n    }\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    const now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    const inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return Object.assign(Object.assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Creates a Firebase Installation if there isn't one for the app and\r\n * returns the Installation ID.\r\n * @param installations - The `Installations` instance.\r\n *\r\n * @public\r\n */\r\nasync function getId(installations) {\r\n    const installationsImpl = installations;\r\n    const { installationEntry, registrationPromise } = await getInstallationEntry(installationsImpl);\r\n    if (registrationPromise) {\r\n        registrationPromise.catch(console.error);\r\n    }\r\n    else {\r\n        // If the installation is already registered, update the authentication\r\n        // token if needed.\r\n        refreshAuthToken(installationsImpl).catch(console.error);\r\n    }\r\n    return installationEntry.fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a Firebase Installations auth token, identifying the current\r\n * Firebase Installation.\r\n * @param installations - The `Installations` instance.\r\n * @param forceRefresh - Force refresh regardless of token expiration.\r\n *\r\n * @public\r\n */\r\nasync function getToken(installations, forceRefresh = false) {\r\n    const installationsImpl = installations;\r\n    await completeInstallationRegistration(installationsImpl);\r\n    // At this point we either have a Registered Installation in the DB, or we've\r\n    // already thrown an error.\r\n    const authToken = await refreshAuthToken(installationsImpl, forceRefresh);\r\n    return authToken.token;\r\n}\r\nasync function completeInstallationRegistration(installations) {\r\n    const { registrationPromise } = await getInstallationEntry(installations);\r\n    if (registrationPromise) {\r\n        // A createInstallation request is in progress. Wait until it finishes.\r\n        await registrationPromise;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function deleteInstallationRequest(appConfig, installationEntry) {\r\n    const endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n    const headers = getHeadersWithAuth(appConfig, installationEntry);\r\n    const request = {\r\n        method: 'DELETE',\r\n        headers\r\n    };\r\n    const response = await retryIfServerError(() => fetch(endpoint, request));\r\n    if (!response.ok) {\r\n        throw await getErrorFromResponse('Delete Installation', response);\r\n    }\r\n}\r\nfunction getDeleteEndpoint(appConfig, { fid }) {\r\n    return `${getInstallationsEndpoint(appConfig)}/${fid}`;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Deletes the Firebase Installation and all associated data.\r\n * @param installations - The `Installations` instance.\r\n *\r\n * @public\r\n */\r\nasync function deleteInstallations(installations) {\r\n    const { appConfig } = installations;\r\n    const entry = await update(appConfig, oldEntry => {\r\n        if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n            // Delete the unregistered entry without sending a deleteInstallation request.\r\n            return undefined;\r\n        }\r\n        return oldEntry;\r\n    });\r\n    if (entry) {\r\n        if (entry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n            // Can't delete while trying to register.\r\n            throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n        }\r\n        else if (entry.registrationStatus === 2 /* COMPLETED */) {\r\n            if (!navigator.onLine) {\r\n                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n            }\r\n            else {\r\n                await deleteInstallationRequest(appConfig, entry);\r\n                await remove(appConfig);\r\n            }\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n * @param installations - The `Installations` instance.\r\n * @param callback - The callback function that is invoked when FID changes.\r\n * @returns A function that can be called to unsubscribe.\r\n *\r\n * @public\r\n */\r\nfunction onIdChange(installations, callback) {\r\n    const { appConfig } = installations;\r\n    addCallback(appConfig, callback);\r\n    return () => {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns an instance of {@link Installations} associated with the given\r\n * {@link @firebase/app#FirebaseApp} instance.\r\n * @param app - The {@link @firebase/app#FirebaseApp} instance.\r\n *\r\n * @public\r\n */\r\nfunction getInstallations(app = getApp()) {\r\n    const installationsImpl = _getProvider(app, 'installations').getImmediate();\r\n    return installationsImpl;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    const configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    for (const keyName of configKeys) {\r\n        if (!app.options[keyName]) {\r\n            throw getMissingValueError(keyName);\r\n        }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst INSTALLATIONS_NAME = 'installations';\r\nconst INSTALLATIONS_NAME_INTERNAL = 'installations-internal';\r\nconst publicFactory = (container) => {\r\n    const app = container.getProvider('app').getImmediate();\r\n    // Throws if app isn't configured properly.\r\n    const appConfig = extractAppConfig(app);\r\n    const heartbeatServiceProvider = _getProvider(app, 'heartbeat');\r\n    const installationsImpl = {\r\n        app,\r\n        appConfig,\r\n        heartbeatServiceProvider,\r\n        _delete: () => Promise.resolve()\r\n    };\r\n    return installationsImpl;\r\n};\r\nconst internalFactory = (container) => {\r\n    const app = container.getProvider('app').getImmediate();\r\n    // Internal FIS instance relies on public FIS instance.\r\n    const installations = _getProvider(app, INSTALLATIONS_NAME).getImmediate();\r\n    const installationsInternal = {\r\n        getId: () => getId(installations),\r\n        getToken: (forceRefresh) => getToken(installations, forceRefresh)\r\n    };\r\n    return installationsInternal;\r\n};\r\nfunction registerInstallations() {\r\n    _registerComponent(new Component(INSTALLATIONS_NAME, publicFactory, \"PUBLIC\" /* PUBLIC */));\r\n    _registerComponent(new Component(INSTALLATIONS_NAME_INTERNAL, internalFactory, \"PRIVATE\" /* PRIVATE */));\r\n}\n\n/**\r\n * Firebase Installations\r\n *\r\n * @packageDocumentation\r\n */\r\nregisterInstallations();\r\nregisterVersion(name, version);\r\n// BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\nregisterVersion(name, version, 'esm2017');\n\nexport { deleteInstallations, getId, getInstallations, getToken, onIdChange };\n//# sourceMappingURL=index.esm2017.js.map\n","import '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { openDB, deleteDB, ErrorFactory, validateIndexedDBOpenable, isIndexedDBAvailable, areCookiesEnabled, getModularInstance } from '@firebase/util';\nimport { _registerComponent, registerVersion, getApp, _getProvider } from '@firebase/app';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nconst DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\r\nconst DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\r\nconst ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\nconst CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\r\nconst CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nconst CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nconst CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\r\nvar MessageType$1;\r\n(function (MessageType) {\r\n    MessageType[MessageType[\"DATA_MESSAGE\"] = 1] = \"DATA_MESSAGE\";\r\n    MessageType[MessageType[\"DISPLAY_NOTIFICATION\"] = 3] = \"DISPLAY_NOTIFICATION\";\r\n})(MessageType$1 || (MessageType$1 = {}));\n\n/**\r\n * @license\r\n * Copyright 2018 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\r\n * in compliance with the License. You may obtain a copy of the License at\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software distributed under the License\r\n * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\r\n * or implied. See the License for the specific language governing permissions and limitations under\r\n * the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction arrayToBase64(array) {\r\n    const uint8Array = new Uint8Array(array);\r\n    const base64String = btoa(String.fromCharCode(...uint8Array));\r\n    return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\r\nfunction base64ToArray(base64String) {\r\n    const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    const base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    const rawData = atob(base64);\r\n    const outputArray = new Uint8Array(rawData.length);\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst OLD_DB_NAME = 'fcm_token_details_db';\r\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher, so that the upgrade\r\n * callback is called for all versions of the old DB.\r\n */\r\nconst OLD_DB_VERSION = 5;\r\nconst OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nasync function migrateOldDatabase(senderId) {\r\n    if ('databases' in indexedDB) {\r\n        // indexedDb.databases() is an IndexedDB v3 API and does not exist in all browsers. TODO: Remove\r\n        // typecast when it lands in TS types.\r\n        const databases = await indexedDB.databases();\r\n        const dbNames = databases.map(db => db.name);\r\n        if (!dbNames.includes(OLD_DB_NAME)) {\r\n            // old DB didn't exist, no need to open.\r\n            return null;\r\n        }\r\n    }\r\n    let tokenDetails = null;\r\n    const db = await openDB(OLD_DB_NAME, OLD_DB_VERSION, async (db, oldVersion, newVersion, upgradeTransaction) => {\r\n        var _a;\r\n        if (oldVersion < 2) {\r\n            // Database too old, skip migration.\r\n            return;\r\n        }\r\n        if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n            // Database did not exist. Nothing to do.\r\n            return;\r\n        }\r\n        const objectStore = upgradeTransaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n        const value = await objectStore.index('fcmSenderId').get(senderId);\r\n        await objectStore.clear();\r\n        if (!value) {\r\n            // No entry in the database, nothing to migrate.\r\n            return;\r\n        }\r\n        if (oldVersion === 2) {\r\n            const oldDetails = value;\r\n            if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\r\n                return;\r\n            }\r\n            tokenDetails = {\r\n                token: oldDetails.fcmToken,\r\n                createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\r\n                subscriptionOptions: {\r\n                    auth: oldDetails.auth,\r\n                    p256dh: oldDetails.p256dh,\r\n                    endpoint: oldDetails.endpoint,\r\n                    swScope: oldDetails.swScope,\r\n                    vapidKey: typeof oldDetails.vapidKey === 'string'\r\n                        ? oldDetails.vapidKey\r\n                        : arrayToBase64(oldDetails.vapidKey)\r\n                }\r\n            };\r\n        }\r\n        else if (oldVersion === 3) {\r\n            const oldDetails = value;\r\n            tokenDetails = {\r\n                token: oldDetails.fcmToken,\r\n                createTime: oldDetails.createTime,\r\n                subscriptionOptions: {\r\n                    auth: arrayToBase64(oldDetails.auth),\r\n                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                    endpoint: oldDetails.endpoint,\r\n                    swScope: oldDetails.swScope,\r\n                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                }\r\n            };\r\n        }\r\n        else if (oldVersion === 4) {\r\n            const oldDetails = value;\r\n            tokenDetails = {\r\n                token: oldDetails.fcmToken,\r\n                createTime: oldDetails.createTime,\r\n                subscriptionOptions: {\r\n                    auth: arrayToBase64(oldDetails.auth),\r\n                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                    endpoint: oldDetails.endpoint,\r\n                    swScope: oldDetails.swScope,\r\n                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                }\r\n            };\r\n        }\r\n    });\r\n    db.close();\r\n    // Delete all old databases.\r\n    await deleteDB(OLD_DB_NAME);\r\n    await deleteDB('fcm_vapid_details_db');\r\n    await deleteDB('undefined');\r\n    return checkTokenDetails(tokenDetails) ? tokenDetails : null;\r\n}\r\nfunction checkTokenDetails(tokenDetails) {\r\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\r\n        return false;\r\n    }\r\n    const { subscriptionOptions } = tokenDetails;\r\n    return (typeof tokenDetails.createTime === 'number' &&\r\n        tokenDetails.createTime > 0 &&\r\n        typeof tokenDetails.token === 'string' &&\r\n        tokenDetails.token.length > 0 &&\r\n        typeof subscriptionOptions.auth === 'string' &&\r\n        subscriptionOptions.auth.length > 0 &&\r\n        typeof subscriptionOptions.p256dh === 'string' &&\r\n        subscriptionOptions.p256dh.length > 0 &&\r\n        typeof subscriptionOptions.endpoint === 'string' &&\r\n        subscriptionOptions.endpoint.length > 0 &&\r\n        typeof subscriptionOptions.swScope === 'string' &&\r\n        subscriptionOptions.swScope.length > 0 &&\r\n        typeof subscriptionOptions.vapidKey === 'string' &&\r\n        subscriptionOptions.vapidKey.length > 0);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Exported for tests.\r\nconst DATABASE_NAME = 'firebase-messaging-database';\r\nconst DATABASE_VERSION = 1;\r\nconst OBJECT_STORE_NAME = 'firebase-messaging-store';\r\nlet dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDB(DATABASE_NAME, DATABASE_VERSION, (upgradeDb, oldVersion) => {\r\n            // We don't use 'break' in this switch statement, the fall-through behavior is what we want,\r\n            // because if there are multiple versions between the old version and the current version, we\r\n            // want ALL the migrations that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (oldVersion) {\r\n                case 0:\r\n                    upgradeDb.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Gets record(s) from the objectStore that match the given key. */\r\nasync function dbGet(firebaseDependencies) {\r\n    const key = getKey(firebaseDependencies);\r\n    const db = await getDbPromise();\r\n    const tokenDetails = (await db\r\n        .transaction(OBJECT_STORE_NAME)\r\n        .objectStore(OBJECT_STORE_NAME)\r\n        .get(key));\r\n    if (tokenDetails) {\r\n        return tokenDetails;\r\n    }\r\n    else {\r\n        // Check if there is a tokenDetails object in the old DB.\r\n        const oldTokenDetails = await migrateOldDatabase(firebaseDependencies.appConfig.senderId);\r\n        if (oldTokenDetails) {\r\n            await dbSet(firebaseDependencies, oldTokenDetails);\r\n            return oldTokenDetails;\r\n        }\r\n    }\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nasync function dbSet(firebaseDependencies, tokenDetails) {\r\n    const key = getKey(firebaseDependencies);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    await tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key);\r\n    await tx.complete;\r\n    return tokenDetails;\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nasync function dbRemove(firebaseDependencies) {\r\n    const key = getKey(firebaseDependencies);\r\n    const db = await getDbPromise();\r\n    const tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n    await tx.objectStore(OBJECT_STORE_NAME).delete(key);\r\n    await tx.complete;\r\n}\r\nfunction getKey({ appConfig }) {\r\n    return appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst ERROR_MAP = {\r\n    [\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */]: 'Missing App configuration value: \"{$valueName}\"',\r\n    [\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */]: 'This method is available in a Window context.',\r\n    [\"only-available-in-sw\" /* AVAILABLE_IN_SW */]: 'This method is available in a service worker context.',\r\n    [\"permission-default\" /* PERMISSION_DEFAULT */]: 'The notification permission was not granted and dismissed instead.',\r\n    [\"permission-blocked\" /* PERMISSION_BLOCKED */]: 'The notification permission was not granted and blocked instead.',\r\n    [\"unsupported-browser\" /* UNSUPPORTED_BROWSER */]: \"This browser doesn't support the API's required to use the Firebase SDK.\",\r\n    [\"indexed-db-unsupported\" /* INDEXED_DB_UNSUPPORTED */]: \"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)\",\r\n    [\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */]: 'We are unable to register the default service worker. {$browserErrorMessage}',\r\n    [\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */]: 'A problem occurred while subscribing the user to FCM: {$errorInfo}',\r\n    [\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */]: 'FCM returned no token when subscribing the user to push.',\r\n    [\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */]: 'A problem occurred while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    [\"token-update-failed\" /* TOKEN_UPDATE_FAILED */]: 'A problem occurred while updating the user from FCM: {$errorInfo}',\r\n    [\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */]: 'FCM returned no token when updating the user to push.',\r\n    [\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */]: 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    [\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */]: 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\r\n    [\"invalid-bg-handler\" /* INVALID_BG_HANDLER */]: 'The input to setBackgroundMessageHandler() must be a function.',\r\n    [\"invalid-vapid-key\" /* INVALID_VAPID_KEY */]: 'The public VAPID key must be a string.',\r\n    [\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */]: 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.'\r\n};\r\nconst ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function requestGetToken(firebaseDependencies, subscriptionOptions) {\r\n    const headers = await getHeaders(firebaseDependencies);\r\n    const body = getBody(subscriptionOptions);\r\n    const subscribeOptions = {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    let responseData;\r\n    try {\r\n        const response = await fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions);\r\n        responseData = await response.json();\r\n    }\r\n    catch (err) {\r\n        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n            errorInfo: err\r\n        });\r\n    }\r\n    if (responseData.error) {\r\n        const message = responseData.error.message;\r\n        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n            errorInfo: message\r\n        });\r\n    }\r\n    if (!responseData.token) {\r\n        throw ERROR_FACTORY.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n    }\r\n    return responseData.token;\r\n}\r\nasync function requestUpdateToken(firebaseDependencies, tokenDetails) {\r\n    const headers = await getHeaders(firebaseDependencies);\r\n    const body = getBody(tokenDetails.subscriptionOptions);\r\n    const updateOptions = {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: JSON.stringify(body)\r\n    };\r\n    let responseData;\r\n    try {\r\n        const response = await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${tokenDetails.token}`, updateOptions);\r\n        responseData = await response.json();\r\n    }\r\n    catch (err) {\r\n        throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n            errorInfo: err\r\n        });\r\n    }\r\n    if (responseData.error) {\r\n        const message = responseData.error.message;\r\n        throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n            errorInfo: message\r\n        });\r\n    }\r\n    if (!responseData.token) {\r\n        throw ERROR_FACTORY.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n    }\r\n    return responseData.token;\r\n}\r\nasync function requestDeleteToken(firebaseDependencies, token) {\r\n    const headers = await getHeaders(firebaseDependencies);\r\n    const unsubscribeOptions = {\r\n        method: 'DELETE',\r\n        headers\r\n    };\r\n    try {\r\n        const response = await fetch(`${getEndpoint(firebaseDependencies.appConfig)}/${token}`, unsubscribeOptions);\r\n        const responseData = await response.json();\r\n        if (responseData.error) {\r\n            const message = responseData.error.message;\r\n            throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                errorInfo: message\r\n            });\r\n        }\r\n    }\r\n    catch (err) {\r\n        throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n            errorInfo: err\r\n        });\r\n    }\r\n}\r\nfunction getEndpoint({ projectId }) {\r\n    return `${ENDPOINT}/projects/${projectId}/registrations`;\r\n}\r\nasync function getHeaders({ appConfig, installations }) {\r\n    const authToken = await installations.getToken();\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': appConfig.apiKey,\r\n        'x-goog-firebase-installations-auth': `FIS ${authToken}`\r\n    });\r\n}\r\nfunction getBody({ p256dh, auth, endpoint, vapidKey }) {\r\n    const body = {\r\n        web: {\r\n            endpoint,\r\n            auth,\r\n            p256dh\r\n        }\r\n    };\r\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\r\n        body.web.applicationPubKey = vapidKey;\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// UpdateRegistration will be called once every week.\r\nconst TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nasync function getTokenInternal(messaging) {\r\n    const pushSubscription = await getPushSubscription(messaging.swRegistration, messaging.vapidKey);\r\n    const subscriptionOptions = {\r\n        vapidKey: messaging.vapidKey,\r\n        swScope: messaging.swRegistration.scope,\r\n        endpoint: pushSubscription.endpoint,\r\n        auth: arrayToBase64(pushSubscription.getKey('auth')),\r\n        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\r\n    };\r\n    const tokenDetails = await dbGet(messaging.firebaseDependencies);\r\n    if (!tokenDetails) {\r\n        // No token, get a new one.\r\n        return getNewToken(messaging.firebaseDependencies, subscriptionOptions);\r\n    }\r\n    else if (!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) {\r\n        // Invalid token, get a new one.\r\n        try {\r\n            await requestDeleteToken(messaging.firebaseDependencies, tokenDetails.token);\r\n        }\r\n        catch (e) {\r\n            // Suppress errors because of #2364\r\n            console.warn(e);\r\n        }\r\n        return getNewToken(messaging.firebaseDependencies, subscriptionOptions);\r\n    }\r\n    else if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\r\n        // Weekly token refresh\r\n        return updateToken(messaging, {\r\n            token: tokenDetails.token,\r\n            createTime: Date.now(),\r\n            subscriptionOptions\r\n        });\r\n    }\r\n    else {\r\n        // Valid token, nothing to do.\r\n        return tokenDetails.token;\r\n    }\r\n}\r\n/**\r\n * This method deletes the token from the database, unsubscribes the token from FCM, and unregisters\r\n * the push subscription if it exists.\r\n */\r\nasync function deleteTokenInternal(messaging) {\r\n    const tokenDetails = await dbGet(messaging.firebaseDependencies);\r\n    if (tokenDetails) {\r\n        await requestDeleteToken(messaging.firebaseDependencies, tokenDetails.token);\r\n        await dbRemove(messaging.firebaseDependencies);\r\n    }\r\n    // Unsubscribe from the push subscription.\r\n    const pushSubscription = await messaging.swRegistration.pushManager.getSubscription();\r\n    if (pushSubscription) {\r\n        return pushSubscription.unsubscribe();\r\n    }\r\n    // If there's no SW, consider it a success.\r\n    return true;\r\n}\r\nasync function updateToken(messaging, tokenDetails) {\r\n    try {\r\n        const updatedToken = await requestUpdateToken(messaging.firebaseDependencies, tokenDetails);\r\n        const updatedTokenDetails = Object.assign(Object.assign({}, tokenDetails), { token: updatedToken, createTime: Date.now() });\r\n        await dbSet(messaging.firebaseDependencies, updatedTokenDetails);\r\n        return updatedToken;\r\n    }\r\n    catch (e) {\r\n        await deleteTokenInternal(messaging);\r\n        throw e;\r\n    }\r\n}\r\nasync function getNewToken(firebaseDependencies, subscriptionOptions) {\r\n    const token = await requestGetToken(firebaseDependencies, subscriptionOptions);\r\n    const tokenDetails = {\r\n        token,\r\n        createTime: Date.now(),\r\n        subscriptionOptions\r\n    };\r\n    await dbSet(firebaseDependencies, tokenDetails);\r\n    return tokenDetails.token;\r\n}\r\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\r\nasync function getPushSubscription(swRegistration, vapidKey) {\r\n    const subscription = await swRegistration.pushManager.getSubscription();\r\n    if (subscription) {\r\n        return subscription;\r\n    }\r\n    return swRegistration.pushManager.subscribe({\r\n        userVisibleOnly: true,\r\n        // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\r\n        // submitted to pushManager#subscribe must be of type Uint8Array.\r\n        applicationServerKey: base64ToArray(vapidKey)\r\n    });\r\n}\r\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\r\nfunction isTokenValid(dbOptions, currentOptions) {\r\n    const isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\r\n    const isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\r\n    const isAuthEqual = currentOptions.auth === dbOptions.auth;\r\n    const isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\r\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction externalizePayload(internalPayload) {\r\n    const payload = {\r\n        from: internalPayload.from,\r\n        // eslint-disable-next-line camelcase\r\n        collapseKey: internalPayload.collapse_key,\r\n        // eslint-disable-next-line camelcase\r\n        messageId: internalPayload.fcmMessageId\r\n    };\r\n    propagateNotificationPayload(payload, internalPayload);\r\n    propagateDataPayload(payload, internalPayload);\r\n    propagateFcmOptions(payload, internalPayload);\r\n    return payload;\r\n}\r\nfunction propagateNotificationPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.notification) {\r\n        return;\r\n    }\r\n    payload.notification = {};\r\n    const title = messagePayloadInternal.notification.title;\r\n    if (!!title) {\r\n        payload.notification.title = title;\r\n    }\r\n    const body = messagePayloadInternal.notification.body;\r\n    if (!!body) {\r\n        payload.notification.body = body;\r\n    }\r\n    const image = messagePayloadInternal.notification.image;\r\n    if (!!image) {\r\n        payload.notification.image = image;\r\n    }\r\n}\r\nfunction propagateDataPayload(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.data) {\r\n        return;\r\n    }\r\n    payload.data = messagePayloadInternal.data;\r\n}\r\nfunction propagateFcmOptions(payload, messagePayloadInternal) {\r\n    if (!messagePayloadInternal.fcmOptions) {\r\n        return;\r\n    }\r\n    payload.fcmOptions = {};\r\n    const link = messagePayloadInternal.fcmOptions.link;\r\n    if (!!link) {\r\n        payload.fcmOptions.link = link;\r\n    }\r\n    // eslint-disable-next-line camelcase\r\n    const analyticsLabel = messagePayloadInternal.fcmOptions.analytics_label;\r\n    if (!!analyticsLabel) {\r\n        payload.fcmOptions.analyticsLabel = analyticsLabel;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isConsoleMessage(data) {\r\n    // This message has a campaign ID, meaning it was sent using the Firebase Console.\r\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n_mergeStrings('hts/frbslgigp.ogepscmv/ieo/eaylg', 'tp:/ieaeogn-agolai.o/1frlglgc/o');\r\n_mergeStrings('AzSCbw63g1R0nCw85jG8', 'Iaya3yLKwmgvh7cF0q4');\r\nfunction _mergeStrings(s1, s2) {\r\n    const resultArray = [];\r\n    for (let i = 0; i < s1.length; i++) {\r\n        resultArray.push(s1.charAt(i));\r\n        if (i < s2.length) {\r\n            resultArray.push(s2.charAt(i));\r\n        }\r\n    }\r\n    return resultArray.join('');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration Object');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    const configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId',\r\n        'messagingSenderId'\r\n    ];\r\n    const { options } = app;\r\n    for (const keyName of configKeys) {\r\n        if (!options[keyName]) {\r\n            throw getMissingValueError(keyName);\r\n        }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: options.projectId,\r\n        apiKey: options.apiKey,\r\n        appId: options.appId,\r\n        senderId: options.messagingSenderId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nclass MessagingService {\r\n    constructor(app, installations, analyticsProvider) {\r\n        // logging is only done with end user consent. Default to false.\r\n        this.deliveryMetricsExportedToBigQueryEnabled = false;\r\n        this.onBackgroundMessageHandler = null;\r\n        this.onMessageHandler = null;\r\n        this.logEvents = [];\r\n        this.isLogServiceStarted = false;\r\n        const appConfig = extractAppConfig(app);\r\n        this.firebaseDependencies = {\r\n            app,\r\n            appConfig,\r\n            installations,\r\n            analyticsProvider\r\n        };\r\n    }\r\n    _delete() {\r\n        return Promise.resolve();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function registerDefaultSw(messaging) {\r\n    try {\r\n        messaging.swRegistration = await navigator.serviceWorker.register(DEFAULT_SW_PATH, {\r\n            scope: DEFAULT_SW_SCOPE\r\n        });\r\n        // The timing when browser updates sw when sw has an update is unreliable from experiment. It\r\n        // leads to version conflict when the SDK upgrades to a newer version in the main page, but sw\r\n        // is stuck with the old version. For example,\r\n        // https://github.com/firebase/firebase-js-sdk/issues/2590 The following line reliably updates\r\n        // sw if there was an update.\r\n        messaging.swRegistration.update().catch(() => {\r\n            /* it is non blocking and we don't care if it failed */\r\n        });\r\n    }\r\n    catch (e) {\r\n        throw ERROR_FACTORY.create(\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n            browserErrorMessage: e.message\r\n        });\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function updateSwReg(messaging, swRegistration) {\r\n    if (!swRegistration && !messaging.swRegistration) {\r\n        await registerDefaultSw(messaging);\r\n    }\r\n    if (!swRegistration && !!messaging.swRegistration) {\r\n        return;\r\n    }\r\n    if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n        throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */);\r\n    }\r\n    messaging.swRegistration = swRegistration;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function updateVapidKey(messaging, vapidKey) {\r\n    if (!!vapidKey) {\r\n        messaging.vapidKey = vapidKey;\r\n    }\r\n    else if (!messaging.vapidKey) {\r\n        messaging.vapidKey = DEFAULT_VAPID_KEY;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function getToken$1(messaging, options) {\r\n    if (!navigator) {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    }\r\n    if (Notification.permission === 'default') {\r\n        await Notification.requestPermission();\r\n    }\r\n    if (Notification.permission !== 'granted') {\r\n        throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n    }\r\n    await updateVapidKey(messaging, options === null || options === void 0 ? void 0 : options.vapidKey);\r\n    await updateSwReg(messaging, options === null || options === void 0 ? void 0 : options.serviceWorkerRegistration);\r\n    return getTokenInternal(messaging);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function logToScion(messaging, messageType, data) {\r\n    const eventType = getEventType(messageType);\r\n    const analytics = await messaging.firebaseDependencies.analyticsProvider.get();\r\n    analytics.logEvent(eventType, {\r\n        /* eslint-disable camelcase */\r\n        message_id: data[CONSOLE_CAMPAIGN_ID],\r\n        message_name: data[CONSOLE_CAMPAIGN_NAME],\r\n        message_time: data[CONSOLE_CAMPAIGN_TIME],\r\n        message_device_time: Math.floor(Date.now() / 1000)\r\n        /* eslint-enable camelcase */\r\n    });\r\n}\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function messageEventListener(messaging, event) {\r\n    const internalPayload = event.data;\r\n    if (!internalPayload.isFirebaseMessaging) {\r\n        return;\r\n    }\r\n    if (messaging.onMessageHandler &&\r\n        internalPayload.messageType === MessageType.PUSH_RECEIVED) {\r\n        if (typeof messaging.onMessageHandler === 'function') {\r\n            messaging.onMessageHandler(externalizePayload(internalPayload));\r\n        }\r\n        else {\r\n            messaging.onMessageHandler.next(externalizePayload(internalPayload));\r\n        }\r\n    }\r\n    // Log to Scion if applicable\r\n    const dataPayload = internalPayload.data;\r\n    if (isConsoleMessage(dataPayload) &&\r\n        dataPayload[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1') {\r\n        await logToScion(messaging, internalPayload.messageType, dataPayload);\r\n    }\r\n}\n\nconst name = \"@firebase/messaging\";\nconst version = \"0.9.12\";\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst WindowMessagingFactory = (container) => {\r\n    const messaging = new MessagingService(container.getProvider('app').getImmediate(), container.getProvider('installations-internal').getImmediate(), container.getProvider('analytics-internal'));\r\n    navigator.serviceWorker.addEventListener('message', e => messageEventListener(messaging, e));\r\n    return messaging;\r\n};\r\nconst WindowMessagingInternalFactory = (container) => {\r\n    const messaging = container\r\n        .getProvider('messaging')\r\n        .getImmediate();\r\n    const messagingInternal = {\r\n        getToken: (options) => getToken$1(messaging, options)\r\n    };\r\n    return messagingInternal;\r\n};\r\nfunction registerMessagingInWindow() {\r\n    _registerComponent(new Component('messaging', WindowMessagingFactory, \"PUBLIC\" /* PUBLIC */));\r\n    _registerComponent(new Component('messaging-internal', WindowMessagingInternalFactory, \"PRIVATE\" /* PRIVATE */));\r\n    registerVersion(name, version);\r\n    // BUILD_TARGET will be replaced by values like esm5, esm2017, cjs5, etc during the compilation\r\n    registerVersion(name, version, 'esm2017');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Checks if all required APIs exist in the browser.\r\n * @returns a Promise that resolves to a boolean.\r\n *\r\n * @public\r\n */\r\nasync function isWindowSupported() {\r\n    try {\r\n        // This throws if open() is unsupported, so adding it to the conditional\r\n        // statement below can cause an uncaught error.\r\n        await validateIndexedDBOpenable();\r\n    }\r\n    catch (e) {\r\n        return false;\r\n    }\r\n    // firebase-js-sdk/issues/2393 reveals that idb#open in Safari iframe and Firefox private browsing\r\n    // might be prohibited to run. In these contexts, an error would be thrown during the messaging\r\n    // instantiating phase, informing the developers to import/call isSupported for special handling.\r\n    return (typeof window !== 'undefined' &&\r\n        isIndexedDBAvailable() &&\r\n        areCookiesEnabled() &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nasync function deleteToken$1(messaging) {\r\n    if (!navigator) {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    }\r\n    if (!messaging.swRegistration) {\r\n        await registerDefaultSw(messaging);\r\n    }\r\n    return deleteTokenInternal(messaging);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction onMessage$1(messaging, nextOrObserver) {\r\n    if (!navigator) {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    }\r\n    messaging.onMessageHandler = nextOrObserver;\r\n    return () => {\r\n        messaging.onMessageHandler = null;\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Retrieves a Firebase Cloud Messaging instance.\r\n *\r\n * @returns The Firebase Cloud Messaging instance associated with the provided firebase app.\r\n *\r\n * @public\r\n */\r\nfunction getMessagingInWindow(app = getApp()) {\r\n    // Conscious decision to make this async check non-blocking during the messaging instance\r\n    // initialization phase for performance consideration. An error would be thrown latter for\r\n    // developer's information. Developers can then choose to import and call `isSupported` for\r\n    // special handling.\r\n    isWindowSupported().then(isSupported => {\r\n        // If `isWindowSupported()` resolved, but returned false.\r\n        if (!isSupported) {\r\n            throw ERROR_FACTORY.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n        }\r\n    }, _ => {\r\n        // If `isWindowSupported()` rejected.\r\n        throw ERROR_FACTORY.create(\"indexed-db-unsupported\" /* INDEXED_DB_UNSUPPORTED */);\r\n    });\r\n    return _getProvider(getModularInstance(app), 'messaging').getImmediate();\r\n}\r\n/**\r\n * Subscribes the {@link Messaging} instance to push notifications. Returns an Firebase Cloud\r\n * Messaging registration token that can be used to send push messages to that {@link Messaging}\r\n * instance.\r\n *\r\n * If a notification permission isn't already granted, this method asks the user for permission. The\r\n * returned promise rejects if the user does not allow the app to show notifications.\r\n *\r\n * @param messaging - The {@link Messaging} instance.\r\n * @param options - Provides an optional vapid key and an optinoal service worker registration\r\n *\r\n * @returns The promise resolves with an FCM registration token.\r\n *\r\n * @public\r\n */\r\nasync function getToken(messaging, options) {\r\n    messaging = getModularInstance(messaging);\r\n    return getToken$1(messaging, options);\r\n}\r\n/**\r\n * Deletes the registration token associated with this {@link Messaging} instance and unsubscribes\r\n * the {@link Messaging} instance from the push subscription.\r\n *\r\n * @param messaging - The {@link Messaging} instance.\r\n *\r\n * @returns The promise resolves when the token has been successfully deleted.\r\n *\r\n * @public\r\n */\r\nfunction deleteToken(messaging) {\r\n    messaging = getModularInstance(messaging);\r\n    return deleteToken$1(messaging);\r\n}\r\n/**\r\n * When a push message is received and the user is currently on a page for your origin, the\r\n * message is passed to the page and an `onMessage()` event is dispatched with the payload of\r\n * the push message.\r\n *\r\n *\r\n * @param messaging - The {@link Messaging} instance.\r\n * @param nextOrObserver - This function, or observer object with `next` defined,\r\n *     is called when a message is received and the user is currently viewing your page.\r\n * @returns To stop listening for messages execute this returned function.\r\n *\r\n * @public\r\n */\r\nfunction onMessage(messaging, nextOrObserver) {\r\n    messaging = getModularInstance(messaging);\r\n    return onMessage$1(messaging, nextOrObserver);\r\n}\n\n/**\r\n * Firebase Cloud Messaging\r\n *\r\n * @packageDocumentation\r\n */\r\nregisterMessagingInWindow();\n\nexport { deleteToken, getMessagingInWindow as getMessaging, getToken, isWindowSupported as isSupported, onMessage };\n//# sourceMappingURL=index.esm2017.js.map\n","const __WEBPACK_NAMESPACE_OBJECT__ = Tinode;","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport default class Alert extends React.PureComponent {\n  render() {\n    return this.props.visible ?\n      <div className=\"alert-container\">\n        <div className=\"alert\">\n          <div className=\"title\">{this.props.title}</div>\n          <div className=\"content\">{this.props.content}</div>\n          <div className=\"dialog-buttons\">\n            {this.props.onReject ?\n              <button className=\"outline\" onClick={this.props.onReject}>\n                {this.props.reject || <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />}\n              </button>\n              :\n              null\n            }\n            <button className=\"primary\" onClick={this.props.onConfirm}>\n              {this.props.confirm || <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\"  />}\n            </button>\n          </div>\n        </div>\n      </div>\n    :\n    null;\n  }\n};\n","// This is a generated file. Don't edit.\n\nexport const PACKAGE_VERSION = \"0.20.0-alpha1\";\n","import { PACKAGE_VERSION } from './version.js';\n\n// Name of this application, used in the User-Agent.\nexport const APP_NAME = 'TinodeWeb/' + (PACKAGE_VERSION || '0.17');\n\n// API key. Use https://github.com/tinode/chat/tree/master/keygen to generate your own\nexport const API_KEY = 'AQEAAAABAAD_rAp4DJh05a1HAwFT3A6K';\n\n// The array of possible hosts to connect to.\nexport const KNOWN_HOSTS = {hosted: 'web.tinode.co', local: 'localhost:6060'};\n\n// Default host name and port to connect to.\nexport const DEFAULT_HOST = KNOWN_HOSTS.hosted;\n\n// Enable console logging.\nexport const LOGGING_ENABLED = true;\n\n// Minimum time between two keypress notifications, milliseconds.\nexport const KEYPRESS_DELAY = 3*1000;\n// Delay before sending a {note} for reciving a message, milliseconds.\nexport const RECEIVED_DELAY = 500;\n// Delay before sending a read notification, milliseconds.\nexport const READ_DELAY = 1000;\n\n// The default shortest allowed tag length. Matches the value on the server.\nexport const MIN_TAG_LENGTH = 2;\n// The default greatest allowed tag length. Matches the value on the server.\nexport const MAX_TAG_LENGTH = 96;\n// The default maximum number of tags allowed. Matches the value on the server.\nexport const MAX_TAG_COUNT = 16;\n\n// Access mode for P2P subscriptions initiated by the current user.\nexport const DEFAULT_P2P_ACCESS_MODE = 'JRWPS';\n// Access mode for new group topics created by the current user.\nexport const NEW_GRP_ACCESS_MODE = 'JRWPSAO';\n// Access mode for a channel.\nexport const CHANNEL_ACCESS_MODE = 'JR';\n\n// Access mode for no access.\nexport const NO_ACCESS_MODE = 'N';\n\n// Mediaquery breakpoint between desktop and mobile, in px. Should match the value\n// in @media (max-size: 640px) in base.css\nexport const MEDIA_BREAKPOINT = 640;\n// Size of css 'rem' unit in pixels. Default 1rem = 10pt = 13px.\nexport const REM_SIZE = 13;\n\n// Size of the avatar image: when image dimensions are greater or the image is not square, it's resized to\n// a square of this size or less.\nexport const AVATAR_SIZE = 384;\n\n// Maximum size of an avatar in bytes for sending in-band. Bigger avatars will be sent out of band (as uploads).\nexport const MAX_AVATAR_BYTES = 4096;\n\n// Size of the broken_image shown in MessagesView\nexport const BROKEN_IMAGE_SIZE = 32;\n\n// Number of chat messages to fetch in one call.\nexport const MESSAGES_PAGE = 24;\n\n// Default maximum in-band (included directly into the message) attachment size which fits into\n// a message of 256K in size. Used when the server-provided value is unavailable. The actual\n// binary size of the attachment should be smaller due to base64 encoding expansion and some overhead,\n// for instance 1024 bytes.\n// Increase this limit to a greater value in production, if desired. Also increase\n// max_message_size in the server config.\nexport const MAX_INBAND_ATTACHMENT_SIZE = 262144;\n\n// Default absolute maximum attachment size to be used with the server = 8MB.\n// Used when the server-provided value is unavailable. Increase to something like 100MB in production.\nexport const MAX_EXTERN_ATTACHMENT_SIZE = 1 << 23;\n\n// Maximum allowed linear dimension (pixels) of an image sent inline. Larger images will be shrunk\n// to make the larger dimension fit under this size. You may want to adjust it to 1600 or\n// 2400 for production.\nexport const MAX_IMAGE_DIM = 1024;\n\n// Linear dimensions of image preview: shrink image under this size for previews.\nexport const IMAGE_PREVIEW_DIM = 64;\n\n// Linear dimensions of image thumbnail: shrink image under this size for thumbnails in reply quote previews.\nexport const IMAGE_THUMBNAIL_DIM = 36;\n\n// Maximum number of online users to be shown in a topic title bar. Others will be\n// hidden under \"+X more\"\nexport const MAX_ONLINE_IN_TOPIC = 4;\n\n// Maximum length of user name, topic title, and private comment.\nexport const MAX_TITLE_LENGTH = 60;\n// Maximum length of topic description.\nexport const MAX_TOPIC_DESCRIPTION_LENGTH = 360;\n\n// Length of message previews in chat list, in characters.\nexport const MESSAGE_PREVIEW_LENGTH = 80;\n\n// Length of a quote in quoted reply (for outgoing messages).\nexport const QUOTED_REPLY_LENGTH = 30;\n// Length of a preview of a forwarded message.\nexport const FORWARDED_PREVIEW_LENGTH = 84;\n\n// Link for \"Contact Us\".\nexport const LINK_CONTACT_US = 'email:support@tinode.co';\n\n// Link to Privacy Policy.\nexport const LINK_PRIVACY_POLICY = 'https://tinode.co/privacy.html';\n\n// Link to Terms of Service.\nexport const LINK_TERMS_OF_SERVICE = 'https://tinode.co/terms.html';\n\n// Video call states.\nexport const CALL_STATE_NONE = 0;\nexport const CALL_STATE_OUTGOING_INITATED = 1;\nexport const CALL_STATE_INCOMING_RECEIVED = 2;\nexport const CALL_STATE_IN_PROGRESS = 3;\n// Video calls/WebRTC configuration.\nexport const CALL_WEBRTC_CONFIG = {\n  iceServers: [\n    { urls: [ \"stun:bn-turn1.xirsys.com\" ] },\n    {\n      username: \"0kYXFmQL9xojOrUy4VFemlTnNPVFZpp7jfPjpB3AjxahuRe4QWrCs6Ll1vDc7TTjAAAAAGAG2whXZWJUdXRzUGx1cw==\",\n      credential: \"285ff060-5a58-11eb-b269-0242ac140004\",\n      urls: [\n        \"turn:bn-turn1.xirsys.com:80?transport=udp\",\n        \"turn:bn-turn1.xirsys.com:3478?transport=udp\",\n        \"turn:bn-turn1.xirsys.com:80?transport=tcp\",\n        \"turn:bn-turn1.xirsys.com:3478?transport=tcp\",\n        \"turns:bn-turn1.xirsys.com:443?transport=tcp\",\n        \"turns:bn-turn1.xirsys.com:5349?transport=tcp\"\n       ]\n    }\n ]};\n","// Context Menu: popup/dropdown menu.\nimport React from 'react';\nimport { injectIntl, defineMessages } from 'react-intl';\n\nimport { REM_SIZE } from '../config.js';\n\nconst messages = defineMessages({\n  info: {\n    id: 'menu_item_info',\n    defaultMessage: 'Info',\n    description: 'Show extended topic information'\n  },\n  clear_messages: {\n    id: 'menu_item_clear_messages',\n    defaultMessage: 'Clear messages',\n    description: 'Delete all messages'\n  },\n  clear_for_all: {\n    id: 'menu_item_clear_messages_for_all',\n    defaultMessage: 'Clear for All',\n    description: 'Delete all message(s) for all members'\n  },\n  delete: {\n    id: 'menu_item_delete',\n    defaultMessage: 'Delete',\n    description: 'Delete selected messages'\n  },\n  delete_for_all: {\n    id: 'menu_item_delete_for_all',\n    defaultMessage: 'Delete for All',\n    description: 'Delete selected message(s) for all members'\n  },\n  send_retry: {\n    id: 'menu_item_send_retry',\n    defaultMessage: 'Retry',\n    description: 'Retry sending message'\n  },\n  mute: {\n    id: 'menu_item_mute',\n    defaultMessage: 'Mute',\n    description: 'Turn off notifications'\n  },\n  unmute: {\n    id: 'menu_item_unmute',\n    defaultMessage: 'Unmute',\n    description: 'Turn notifications on'\n  },\n  reply: {\n    id: 'menu_item_reply',\n    defaultMessage: 'Reply',\n    description: 'Reply to message'\n  },\n  forward: {\n    id: 'menu_item_forward',\n    defaultMessage: 'Forward',\n    description: 'Forward message'\n  },\n  topic_delete: {\n    id: 'menu_item_delete_topic',\n    defaultMessage: 'Delete',\n    description: 'Delete entire topic'\n  },\n  topic_delete_warning: {\n    id: 'topic_delete_warning',\n    defaultMessage: 'Are you sure you want to delete this conversation? It cannot be undone.',\n    description: 'Alert warning when deleting entire topic'\n  },\n  delete_messages_warning: {\n    id: 'delete_messages_warning',\n    defaultMessage: 'Are you sure you want to delete all messages for everyone? It cannot be undone.',\n    description: 'Alert dialog warning when hard-deleting all messages.'\n  },\n  unblock: {\n    id: 'menu_item_unblock',\n    defaultMessage: 'Unblock',\n    description: 'Unblock topic or user'\n  },\n  // Generic string suitable for either topic or user.\n  block: {\n    id: 'menu_item_block',\n    defaultMessage: 'Block',\n    description: 'Block topic or user'\n  },\n  topic_block_warning: {\n    id: 'topic_block_warning',\n    defaultMessage: 'Are you sure you want to block this conversation?',\n    description: 'Alert warning when blocking a topic.'\n  },\n  member_delete: {\n    id: 'menu_item_member_delete',\n    defaultMessage: 'Remove',\n    description: 'Remove user from topic'\n  },\n  archive: {\n    id: 'menu_item_archive_topic',\n    defaultMessage: 'Archive',\n    description: 'Move topic from the list of active chats to archive'\n  },\n  unarchive: {\n    id: 'menu_item_restore_topic',\n    defaultMessage: 'Restore',\n    description: 'Restore topic from archive'\n  },\n  edit_permissions: {\n    id: 'menu_item_edit_permissions',\n    defaultMessage: 'Edit permissions',\n    description: 'Menu item [Edit permissions]'\n  },\n  clear_messages_warning: {\n    id: 'clear_messages_warning',\n    defaultMessage: 'Are you sure you want to clear all messages? It cannot be undone.',\n    description: 'Alert dialog warning when deleting all messages.'\n  },\n});\n\nclass ContextMenu extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.selfRef = React.createRef();\n\n    const {formatMessage} = props.intl;\n\n    this.handlePageClick = this.handlePageClick.bind(this);\n    this.handleEscapeKey = this.handleEscapeKey.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n\n    // Preconfigured menu items.\n    this.MenuItems = {\n      'topic_info': {\n        id: 'topic_info',\n        title: formatMessage(messages.info),\n        handler: null\n      },\n      'messages_clear': {\n        id: 'messages_clear',\n        title: formatMessage(messages.clear_messages),\n        handler: (params, errorHandler) => {\n          return props.onShowAlert(\n            formatMessage(messages.clear_messages), // title\n            formatMessage(messages.clear_messages_warning), // content\n            (() => { this.deleteMessages(true, false, params, errorHandler); }), // onConfirm\n            null, // \"OK\"\n            true, // Show Reject button\n            null  // \"Cancel\"\n          );\n        }\n      },\n      'messages_clear_hard': {\n        id: 'messages_clear_hard',\n        title: formatMessage(messages.clear_for_all),\n        handler: (params, errorHandler) => {\n          return props.onShowAlert(\n            formatMessage(messages.clear_for_all), // title\n            formatMessage(message.delete_messages_warning), // content\n            (() => { return this.deleteMessages(true, true, params, errorHandler); }),\n            null, // \"OK\"\n            true, // Show Reject button\n            null  // \"Cancel\"\n          );\n        }\n      },\n      'message_delete': {\n        id: 'message_delete',\n        title: formatMessage(messages.delete),\n        handler: (params, errorHandler) => {\n          return this.deleteMessages(false, false, params, errorHandler);\n        }\n      },\n      'message_delete_hard': {\n        id: 'message_delete_hard',\n        title: formatMessage(messages.delete_for_all),\n        handler: (params, errorHandler) => {\n          return this.deleteMessages(false, true, params, errorHandler);\n        }\n      },\n      'menu_item_send_retry': {\n        id: 'menu_item_send_retry',\n        title: formatMessage(messages.send_retry),\n        handler: (params, errorHandler) => {\n          return this.retryMessage(params, errorHandler);\n        }\n      },\n      'menu_item_reply': {\n        id: 'menu_item_reply',\n        title: formatMessage(messages.reply),\n        handler: (params, errorHandler) => {\n          return this.replyToMessage(params, errorHandler);\n        }\n      },\n      'menu_item_forward': {\n        id: 'menu_item_forward',\n        title: formatMessage(messages.forward),\n        handler: () => {} /* the action is taken directly in tinode-web */\n      },\n      'topic_unmute': {\n        id: 'topic_unmute',\n        title: formatMessage(messages.unmute),\n        handler: this.topicPermissionSetter.bind(this, '+P')\n      },\n      'topic_mute': {\n        id: 'topic_mute',\n        title: formatMessage(messages.mute),\n        handler: this.topicPermissionSetter.bind(this, '-P')\n      },\n      'topic_unblock': {\n        id: 'topic_unblock',\n        title: formatMessage(messages.unblock),\n        handler: this.topicPermissionSetter.bind(this, '+JP')\n      },\n      'topic_block': {\n        id: 'topic_block',\n        title: formatMessage(messages.block),\n        handler: (params, errorHandler) => {\n          return props.onShowAlert(\n            formatMessage(messages.block), // title\n            formatMessage(messages.topic_block_warning), // content\n            (() => {\n              return this.topicPermissionSetter('-JP', params, errorHandler).then((ctrl) => {\n                this.props.onTopicRemoved(params.topicName);\n                return ctrl;\n              });\n            }),\n            null, // \"OK\"\n            true, // Show Reject button\n            null  // \"Cancel\"\n          );\n        }\n      },\n      'topic_delete': {\n        id: 'topic_delete',\n        title: formatMessage(messages.topic_delete),\n        handler: (params, errorHandler) => {\n          return props.onShowAlert(\n            formatMessage(messages.topic_delete), // title\n            formatMessage(messages.topic_delete_warning), // content\n            (() => {\n              const topic = this.props.tinode.getTopic(params.topicName);\n              if (!topic) {\n                console.warn(\"Topic not found: \", params.topicName);\n                return;\n              }\n              return topic.delTopic(true).catch((err) => {\n                if (errorHandler) {\n                  errorHandler(err.message, 'err');\n                }\n              });\n            }),\n            null, // \"OK\"\n            true, // Show Reject button\n            null  // \"Cancel\"\n          );\n        }\n      },\n      'topic_archive': {\n        id: 'topic_archive',\n        title: formatMessage(messages.archive),\n        handler: (params, errorHandler) => {\n          const topic = this.props.tinode.getTopic(params.topicName);\n          if (!topic) {\n            console.warn(\"Topic not found: \", params.topicName);\n            return;\n          }\n          return topic.archive(true).catch((err) => {\n            if (errorHandler) {\n              errorHandler(err.message, 'err');\n            }\n          });\n        }\n      },\n      'topic_restore': {\n        id: 'topic_restore',\n        title: formatMessage(messages.unarchive),\n        handler: (params, errorHandler) => {\n          const topic = this.props.tinode.getTopic(params.topicName);\n          if (!topic) {\n            console.warn(\"Topic not found: \", params.topicName);\n            return;\n          }\n          return topic.archive(false).catch((err) => {\n            if (errorHandler) {\n              errorHandler(err.message, 'err');\n            }\n          });\n        }\n      },\n      // menu_item_edit_permissions is defined elsewhere.\n      'permissions': {\n        id: 'permissions',\n        title: formatMessage(messages.edit_permissions),\n        handler: null\n      },\n      'member_delete': {\n        id: 'member_delete',\n        title: formatMessage(messages.member_delete),\n        handler: (params, errorHandler) => {\n          const topic = this.props.tinode.getTopic(params.topicName);\n          if (!topic || !params.user) {\n            console.warn(\"Topic or user not found: '\" + params.topicName + \"', '\" + params.user + \"'\");\n            return;\n          }\n          return topic.delSubscription(params.user).catch((err) => {\n            if (errorHandler) {\n              errorHandler(err.message, 'err');\n            }\n          });\n        }\n      },\n      'member_mute': {\n        id: 'member_mute',\n        title: formatMessage(messages.mute),\n        handler: this.topicPermissionSetter.bind(this, '-P')\n      },\n      'member_unmute': {\n        id: 'member_unmute',\n        title: formatMessage(messages.unmute),\n        handler: this.topicPermissionSetter.bind(this, '+P')\n      },\n      'member_block': {\n        id: 'member_block',\n        title: formatMessage(messages.block),\n        handler: this.topicPermissionSetter.bind(this, '-JP')\n      },\n      'member_unblock': {\n        id: 'member_unblock',\n        title: formatMessage(messages.unblock),\n        handler: this.topicPermissionSetter.bind(this, '+JP')\n      },\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.handlePageClick, false);\n    document.addEventListener('keyup', this.handleEscapeKey, false);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.handlePageClick, false);\n    document.removeEventListener('keyup', this.handleEscapeKey, false);\n  }\n\n  handlePageClick(e) {\n    if (this.selfRef.current.contains(e.target)) {\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    this.props.hide();\n  }\n\n  handleEscapeKey(e) {\n    if (e.keyCode === 27) {\n      this.props.hide();\n    }\n  }\n\n  handleClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.props.hide();\n    let item = this.props.items[e.currentTarget.dataset.id];\n    if (typeof item == 'string') {\n      item = this.MenuItems[item];\n    }\n\n    if (!item) {\n      console.error(\"Invalid menu item ID\", e.currentTarget.dataset.id);\n    } else {\n      this.props.onAction(\n        item.id,\n        item.handler(this.props.params, this.props.onError),\n        this.props.params);\n    }\n  }\n\n  // Menu Actions\n\n  deleteMessages(all, hard, params, errorHandler) {\n    const topic = this.props.tinode.getTopic(params.topicName);\n    if (!topic) {\n      console.warn(\"Topic not found: \", params.topicName);\n      return;\n    }\n\n    // We don't know if the message is still pending (e.g. attachment is being uploaded),\n    // so try cancelling first. No harm if we can't cancel.\n    // The message can be cancelled if transmission to the server has not\n    // started yet or if the message send has failed.\n    if (!all && topic.cancelSend(params.seq)) {\n      return;\n    }\n    // Can't cancel. Delete instead.\n    const promise = all ?\n      topic.delMessagesAll(hard) :\n      topic.delMessagesList([params.seq], hard);\n\n    return promise.catch((err) => {\n      if (errorHandler) {\n        errorHandler(err.message, 'err');\n      }\n    });\n  }\n\n  // Retries sending failed message.\n  retryMessage(params, errorHandler) {\n    const topic = this.props.tinode.getTopic(params.topicName);\n    // Remove the existing message entry.\n    if (!topic || !topic.flushMessage(params.seq)) {\n      return;\n    }\n    const msg = topic.createMessage(params.content, false);\n    return topic.publishDraft(msg).catch((err) => {\n      if (errorHandler) {\n        errorHandler(err.message, 'err');\n      }\n    });\n  }\n\n  // Function is used by context menu to set permissions.\n  topicPermissionSetter(mode, params, errorHandler) {\n    const topic = this.props.tinode.getTopic(params.topicName);\n    if (!topic) {\n      console.warn(\"Topic not found\", params.topicName);\n      return;\n    }\n\n    let result = topic.updateMode(params.user, mode);\n    if (errorHandler) {\n      result = result.catch((err) => {\n        errorHandler(err.message, 'err');\n      });\n    }\n    return result;\n  }\n\n  replyToMessage(params, errorHandler) {\n    params.pickReply(params.seq, params.content, params.userFrom, params.userName, errorHandler);\n  }\n\n  render() {\n    const menu = [];\n    let count = 0;\n    this.props.items.map((item) => {\n      if (typeof item == 'string') {\n        item = this.MenuItems[item];\n      }\n      if (item && item.title) {\n        menu.push(\n          item.title == '-' ?\n            <li className=\"separator\" key={count} />\n            :\n            <li onClick={this.handleClick} data-id={count} key={count}>{item.title}</li>\n        );\n      }\n      count++;\n    });\n\n    // Ensure that menu is inside the app-container.\n    const hSize = 12 * REM_SIZE;\n    const vSize = REM_SIZE * (0.7 + menu.length * 2.5);\n    const left = (this.props.bounds.right - this.props.clickAt.x < hSize) ?\n        (this.props.clickAt.x - this.props.bounds.left - hSize) :\n        (this.props.clickAt.x - this.props.bounds.left);\n    const top = (this.props.bounds.bottom - this.props.clickAt.y < vSize) ?\n        (this.props.clickAt.y - this.props.bounds.top - vSize) :\n        (this.props.clickAt.y - this.props.bounds.top);\n\n    const position = {\n      left: left + 'px',\n      top: top + 'px'\n    };\n\n    return (\n      <ul className=\"menu\" style={position} ref={this.selfRef}>\n        {menu}\n      </ul>\n    );\n  }\n}\n\nexport default injectIntl(ContextMenu);\n","import React from 'react';\n\nconst icon_mapping = {'muted': 'notifications_off', 'banned': 'block', 'staff': 'verified_user'};\n\n/* Contact's labels: [you], or icons [muted], [blocked] */\nexport default class ContactBadges extends React.PureComponent {\n  render() {\n    let badges = null;\n    if (this.props.badges && this.props.badges.length > 0) {\n      badges = [];\n      this.props.badges.map((b) => {\n        const color = (b.color ? ' ' + b.color : '');\n        if (b.icon) {\n          badges.push(<i className={'material-icons as-badge' + color} key={b.key || b.icon}>{icon_mapping[b.icon] || b.icon}</i>);\n        } else {\n          badges.push(<span className={'badge' + color} key={b.key || b.name}>{b.name}</span>);\n        }\n      });\n      return <>{badges}</>;\n    }\n    return null;\n  }\n};\n","// Short representation of time in the past.\nexport function shortDateFormat(then, locale) {\n  locale = locale || window.navigator.userLanguage || window.navigator.language;\n  const now = new Date();\n  if (then.getFullYear() == now.getFullYear()) {\n    // Same year.\n    if (then.getMonth() == now.getMonth() && then.getDate() == now.getDate()) {\n      // Same month and day, show time only.\n      return then.toLocaleTimeString(locale, {hour12: false, hour: '2-digit', minute: '2-digit'});\n    }\n    // Different month and/or day, show month day, time.\n    return then.toLocaleDateString(locale,\n      {hour12: false, month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'});\n  }\n  // Different year: just show the date.\n  return then.toLocaleDateString(locale, {year: 'numeric', month: 'short', day: 'numeric'});\n}\n\n// Convert seconds to minutes:seconds, i.e. 156 sec -> 2:36.\n// If <code>fixedMins</code> is true, then minutes are represented by at least two digits.\nexport function secondsToTime(seconds, fixedMin) {\n  let min = Math.floor(seconds / 60) | 0;\n  if (fixedMin) {\n    min = min < 10 ? `0${min}` : min;\n  }\n  let sec = (seconds % 60) | 0;\n  sec = sec < 10 ? `0${sec}` : sec;\n  return `${min}:${sec}`;\n}\n\n// Convert a number of bytes to human-readable format.\nexport function bytesToHumanSize(bytes) {\n  if (!bytes || bytes == 0) {\n    return '0 Bytes';\n  }\n\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];\n  const bucket = Math.min(Math.floor(Math.log2(bytes) / 10) | 0, sizes.length-1);\n  const count = bytes / Math.pow(1024, bucket);\n  const round = bucket > 0 ? (count < 3 ? 2 : (count < 30 ? 1 : 0)) : 0;\n  return count.toFixed(round) + ' ' + sizes[bucket];\n}\n\n// Shorten a file name to be under maxLength by clipping out the middle.\nexport function shortenFileName(filename, maxLength) {\n  if (typeof filename != 'string') {\n    return filename;\n  }\n  return filename.length > maxLength ?\n    filename.slice(0, maxLength/2 - 1) + '…' + filename.slice(1 - maxLength/2) : filename;\n}\n\n// Get 32 bit integer hash value for a string. Ideally it should produce the same value\n// as Java's String#hash().\nfunction stringToColorHash(value) {\n  let hash = 0;\n  value = '' + value;\n  for (let i = 0; i < value.length; i++) {\n    hash = ((hash << 5) - hash) + value.charCodeAt(i);\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  return hash;\n}\n\n// User avatar letter color id.\nexport function letterTileColorId(userId) {\n  return Math.abs(stringToColorHash(userId)) % 16;\n}\n\n// Converts user or topic ID to a CSS color class. Ideally it should produce the same color value as Java version.\n// params:\n// - {string} id: user or topic ID\n// - {boolean} light: light or dark version of the color.\n// - {boolean} fg: foreground (text) or background color.\nexport function idToColorClass(id, light, fg) {\n  return (light ? 'lt-' : 'dk-') + (fg ? 'fg-' : 'bg-') + letterTileColorId(id);\n}\n","// Odds and ends\n\nimport { Tinode } from 'tinode-sdk';\n\n// Make shortcut icon appear with a green dot + show unread count in title.\nexport function updateFavicon(count) {\n  const oldIcon = document.getElementById('shortcut-icon');\n  const head = document.head || document.getElementsByTagName('head')[0];\n  const newIcon = document.createElement('link');\n  newIcon.type = 'image/png';\n  newIcon.id = 'shortcut-icon';\n  newIcon.rel = 'shortcut icon';\n  newIcon.href = 'img/logo32x32' + (count > 0 ? 'a' : '') + '.png';\n  if (oldIcon) {\n    head.removeChild(oldIcon);\n  }\n  head.appendChild(newIcon);\n\n  document.title = (count > 0 ? '('+count+') ' : '') + 'Tinode';\n}\n\n// Create theCard which represents user's or topic's \"public\" info.\nexport function theCard(fn, imageUrl, imageMimeType, note) {\n  let card = null;\n  fn = fn && fn.trim();\n  note = note && note.trim();\n\n  if (fn) {\n    card = {\n      fn: fn\n    };\n  }\n\n  if (typeof note == 'string') {\n    card = card || {};\n    card.note = note ? note : Tinode.DEL_CHAR;\n  }\n\n  if (imageUrl) {\n    card = card || {};\n    let mimeType = imageMimeType;\n    // Is this a data URL \"data:[<mediatype>][;base64],<data>\"?\n    const matches = /^data:(image\\/[-a-z0-9+.]+)?(;base64)?,/i.exec(imageUrl);\n    if (matches) {\n      mimeType = matches[1];\n      card.photo = {\n        data: imageUrl.substring(imageUrl.indexOf(',') + 1),\n        ref: Tinode.DEL_CHAR\n      };\n    } else {\n      card.photo = {\n        data: Tinode.DEL_CHAR,\n        ref: imageUrl\n      };\n    }\n    card.photo.type = (mimeType || 'image/jpeg').substring('image/'.length);\n  }\n\n  return card;\n}\n\n// Deep-shallow compare two arrays: shallow compare each element.\nexport function arrayEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (!Array.isArray(a) || !Array.isArray(b)) {\n    return false;\n  }\n\n  // Compare lengths first.\n  if (a.length != b.length) {\n    return false;\n  }\n  // Order of elements is ignored.\n  a.sort();\n  b.sort();\n  for (let i = 0, l = a.length; i < l; i++) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// Checks (loosely) if the given string is a phone. If so, returns the phone number in a format\n// as close to E.164 as possible.\nexport function asPhone(val) {\n  val = val.trim();\n  if (/^(?:\\+?(\\d{1,3}))?[- (.]*(\\d{3})[- ).]*(\\d{3})[- .]*(\\d{2})[- .]*(\\d{2})?$/.test(val)) {\n    return val.replace(/[- ().]*/, '');\n  }\n  return null;\n}\n\n// Checks (loosely) if the given string is an email. If so returns the email.\nexport function asEmail(val) {\n  val = val.trim();\n  if (/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$/.test(val)) {\n    return val;\n  }\n  return null;\n}\n\n// Checks if URL is a relative url, i.e. has no 'scheme://', including the case of missing scheme '//'.\n// The scheme is expected to be RFC-compliant, e.g. [a-z][a-z0-9+.-]*\n// example.html - ok\n// https:example.com - not ok.\n// http:/example.com - not ok.\n// ' ↲ https://example.com' - not ok. (↲ means carriage return)\nexport function isUrlRelative(url) {\n  return url && !/^\\s*([a-z][a-z0-9+.-]*:|\\/\\/)/im.test(url);\n}\n\n// Ensure URL does not present an XSS risk. Optional allowedSchemes may contain an array of\n// strings with permitted URL schemes, such as ['ftp', 'ftps']; otherwise accept http and https only.\nexport function sanitizeUrl(url, allowedSchemes) {\n  if (typeof url != 'string') {\n    return url;\n  }\n\n  // Strip control characters and whitespace. They are not valid URL characters anyway.\n  url = url.replace(/[^\\x20-\\x7E]/gmi, '').trim();\n\n  // Relative URLs are safe.\n  // Relative URL does not start with ':', abcd123: or '//'.\n  if (!/^([a-z][a-z0-9+.-]*:|\\/\\/)/i.test(url)) {\n    return url;\n  }\n\n  // Blob URLs are safe.\n  if (/^blob:http/.test(url)) {\n    return url;\n  }\n\n  // Absolute URL. Accept only safe schemes, or no scheme.\n  const schemes = Array.isArray(allowedSchemes) ? allowedSchemes.join('|') : 'http|https';\n  const re = new RegExp('^((' + schemes + '):|//)', 'i');\n  if (!re.test(url)) {\n    return null;\n  }\n\n  return url;\n}\n\n// Ensure URL is suitable as a source like <img src=\"url\"> field: the URL must be a relative URL or\n// have http:, https:, blob: or data: scheme.\n// In case of data: scheme, the URL must must be of the right MIME type such as 'data:{mimeMajor}/XXXX;base64,'.\nexport function sanitizeUrlForMime(url, mimeMajor) {\n  if (!url) {\n    return null;\n  }\n\n  const sanitizedUrl = sanitizeUrl(url);\n  if (sanitizedUrl) {\n    return sanitizedUrl;\n  }\n\n  // Is this a data: URL of the appropriate mime type?\n  const re = new RegExp(`data:${mimeMajor}\\/[a-z0-9.-]+;base64,`, 'i');\n  if (re.test(url.trim())) {\n    return url;\n  }\n\n  return null;\n}\n\n// Given message's received status, return name and color of a delivery indicator icon.\nexport function deliveryMarker(received) {\n  switch (received) {\n    case Tinode.MESSAGE_STATUS_SENDING:\n      return { name: 'access_time' }; // watch face\n    case Tinode.MESSAGE_STATUS_FAILED:\n      return { name: 'warning', color: 'danger-color' }; // yellow icon /!\\\n    case Tinode.MESSAGE_STATUS_SENT:\n      return { name: 'done' }; // checkmark\n    case Tinode.MESSAGE_STATUS_RECEIVED:\n      return { name: 'done_all' }; // double checkmark\n    case Tinode.MESSAGE_STATUS_READ:\n      return { name: 'done_all', color: 'blue' }; // blue double checkmark\n  }\n  return null;\n}\n\n// Wraps a promise to make it cancelable.\n// The parameter can be either a promise or an error. If it's an error, the wrapped promise is\n// created in a rejected state.\nexport function cancelablePromise(promise) {\n  let hasCanceled = false;\n\n  const wrappedPromise = promise instanceof Error ?\n    Promise.reject(promise) :\n    new Promise((resolve, reject) => {\n      promise.then(\n        result => hasCanceled ? reject({isCanceled: true}) : resolve(result),\n        error => hasCanceled ? reject({isCanceled: true}) : reject(error)\n      );\n    });\n\n  return {\n    promise: wrappedPromise,\n    cancel() {\n      hasCanceled = true;\n    },\n  };\n};\n\n// Returns true if specified mime type represents a Tinode video call.\nexport function isVideoCall(mime) {\n  return mime == 'application/tinode-video-call';\n}\n\n// Clips string to the specified length.\nexport function clipStr(str, length) {\n  return str && str.substring(0, length);\n}\n","import React from 'react';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport { idToColorClass } from '../lib/strformat.js';\nimport { sanitizeUrlForMime } from '../lib/utils.js';\n\nexport default class LetterTile extends React.PureComponent {\n  render() {\n    let avatar;\n    if (this.props.avatar === true) {\n      const isGroup = Tinode.isGroupTopicName(this.props.topic);\n      const iconColor = idToColorClass(this.props.topic, isGroup);\n      if (this.props.topic && this.props.title && this.props.title.trim()) {\n        const letter = this.props.title.trim().charAt(0);\n        const className = 'lettertile ' + iconColor + (this.props.deleted ? ' disabled' : '');\n        avatar = (<div className={className}><div>{letter}</div></div>)\n      } else {\n        const className = 'material-icons ' + iconColor + (this.props.deleted ? ' disabled' : '');\n        avatar = isGroup ? <i className={className}>group</i> : <i className={className}>person</i>;\n      }\n    } else if (this.props.avatar) {\n      const url = this.props.tinode.authorizeURL(sanitizeUrlForMime(this.props.avatar, 'image'));\n      // If avatar image is invalid, show a placeholder.\n      const className = 'avatar' + (this.props.deleted ? ' deleted' : '');\n      avatar = <img className={className} alt=\"avatar\" src={url}\n        onError={(e)=>{e.target.onerror = null; e.target.src=\"../img/broken_image.png\"}} />;\n    } else {\n      avatar = null;\n    }\n    return avatar;\n  }\n}\n","// The counter of unread messages in the topic.\nimport React from 'react';\n\nexport default class UnreadBadge extends React.PureComponent {\n  render() {\n    return (this.props.count > 0 ?\n      <span className=\"unread\">{this.props.count > 9 ? \"9+\" : this.props.count}</span>\n      : null);\n  }\n};\n","// File and image helper functions.\n\n// Supported image MIME types and corresponding file extensions.\nexport const SUPPORTED_IMAGE_FORMATS = ['image/jpeg', 'image/gif', 'image/png', 'image/svg', 'image/svg+xml'];\nexport const MIME_EXTENSIONS         = ['jpg',        'gif',       'png',       'svg',       'svg'];\n\n// Get an URL from a theCard photo: either create a data: URL or return reference URL.\nexport function makeImageUrl(photo) {\n  if (photo && typeof photo == 'object') {\n    if (photo.ref) {\n      return photo.ref\n    }\n    if (photo.data && photo.type) {\n      const mime = photo.type.startsWith('image/') ? photo.type : ('image/' + photo.type);\n      return 'data:' + mime + ';base64,' + photo.data;\n    }\n  }\n  return null;\n}\n\n// Calculate linear dimensions for scaling image down to fit under a certain size.\n// Returns an object which contains destination sizes, source sizes, and offsets\n// into source (when making square images).\nexport function fitImageSize(width, height, maxWidth, maxHeight, forceSquare) {\n  // Sanitize input\n  width = width | 0;\n  height = height | 0;\n  maxWidth = maxWidth | 0;\n  maxHeight = maxHeight | 0;\n\n  if (width <= 0 || height <= 0 || maxWidth <= 0 || maxHeight <= 0) {\n    return null;\n  }\n\n  if (forceSquare) {\n    maxWidth = maxHeight = Math.min(maxWidth, maxHeight);\n  }\n\n  const scale = Math.min(\n    Math.min(width, maxWidth) / width,\n    Math.min(height, maxHeight) / height\n  );\n\n  const size = {\n    dstWidth: (width * scale) | 0,\n    dstHeight: (height * scale) | 0,\n  };\n\n  if (forceSquare) {\n    // Also calculate parameters for making the image square.\n    size.dstWidth = size.dstHeight = Math.min(size.dstWidth, size.dstHeight);\n    size.srcWidth = size.srcHeight = Math.min(width, height);\n    size.xoffset = ((width - size.srcWidth) / 2) | 0;\n    size.yoffset = ((height - size.srcWidth) / 2) | 0;\n  } else {\n    size.xoffset = size.yoffset = 0;\n    size.srcWidth = width;\n    size.srcHeight = height;\n  }\n  return size;\n}\n\n// Ensure file's extension matches mime content type\nexport function fileNameForMime(fname, mime) {\n  const idx = SUPPORTED_IMAGE_FORMATS.indexOf(mime);\n  if (idx < 0 || !fname) {\n    // Unknown mime or empty name.\n    return fname;\n  }\n  const ext = MIME_EXTENSIONS[idx];\n\n  const at = fname.lastIndexOf('.');\n  if (at >= 0) {\n    fname = fname.substring(0, at);\n  }\n  return fname + '.' + ext;\n}\n\n// Scale uploaded image to fit under certain dimensions and byte size, optionally constraining to a square.\n// Returns a promise which is resolven on success or rejected on failure.\nexport function imageScaled(fileOrBlob, maxWidth, maxHeight, maxSize, forceSquare) {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'Anonymous';\n    img.onerror = function(err) {\n      reject(new Error(\"Image format unrecognized\"));\n    }\n    img.onload = async function() {\n      // Once the image is loaded, the URL is no longer needed.\n      URL.revokeObjectURL(img.src);\n\n      // Calculate the desired image dimensions.\n      const dim = fitImageSize(img.width, img.height, maxWidth, maxHeight, forceSquare);\n      if (!dim) {\n        reject(new Error(\"Invalid image\"));\n        return;\n      }\n      let canvas = document.createElement('canvas');\n      canvas.width = dim.dstWidth;\n      canvas.height = dim.dstHeight;\n      let ctx = canvas.getContext('2d');\n      ctx.imageSmoothingEnabled = true;\n      ctx.drawImage(img, dim.xoffset, dim.yoffset, dim.srcWidth, dim.srcHeight,\n        0, 0, dim.dstWidth, dim.dstHeight);\n\n      const mime = SUPPORTED_IMAGE_FORMATS.includes(fileOrBlob.type) ? fileOrBlob.type : 'image/jpeg';\n      // Generate blob to check size of the image.\n      let blob = await new Promise(resolve => canvas.toBlob(resolve, mime));\n      if (!blob) {\n        reject(new Error(\"Unsupported image format\"));\n        return;\n      }\n      // Ensure the image is not too large. Shrink the image keeping the aspect ratio.\n      // Do nothing if maxsize is <= 0.\n      while (maxSize > 0 && blob.length > maxSize) {\n        dim.dstWidth = (dim.dstWidth * 0.70710678118) | 0;\n        dim.dstHeight = (dim.dstHeight * 0.70710678118) | 0;\n        canvas.width = dim.dstWidth;\n        canvas.height = dim.dstHeight;\n        ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.drawImage(img, dim.xoffset, dim.yoffset, dim.srcWidth, dim.srcHeight,\n          0, 0, dim.dstWidth, dim.dstHeight);\n        blob = await new Promise(resolve => canvas.toBlob(resolve, mime));\n      }\n\n      canvas = null;\n      resolve({mime: mime, blob: blob, width: dim.dstWidth, height: dim.dstHeight, name: fileNameForMime(fileOrBlob.name, mime)});\n    };\n    img.src = URL.createObjectURL(fileOrBlob);\n  });\n}\n\n// Scale and crop image according to specified dimensions.\n// The coordinates are in unscaled image pixels, i.e. cut the rectangle first then scale it.\n// returns a promise.\nexport function imageCrop(mime, objURL, left, top, width, height, scale) {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'Anonymous';\n    img.onerror = (err) => {\n      reject(new Error(\"Image format unrecognized\"));\n    };\n    img.onload = () => {\n      // Once the image is loaded, the URL is no longer needed.\n      URL.revokeObjectURL(img.src);\n\n      let canvas = document.createElement('canvas');\n      canvas.width = width * scale;\n      canvas.height = height * scale;\n      let ctx = canvas.getContext('2d');\n      ctx.imageSmoothingEnabled = true;\n      ctx.drawImage(img, left, top, width, height, 0, 0, canvas.width, canvas.height);\n\n      mime = SUPPORTED_IMAGE_FORMATS.includes(mime) ? mime : 'image/jpeg';\n      // Generate blob to check size of the image.\n      canvas.toBlob((blob) => {\n        // Allow GC.\n        canvas = null;\n        if (blob) {\n          resolve({mime: mime, blob: blob, width: width, height: height});\n        } else {\n          reject(new Error(\"Unsupported image format\"));\n        }\n      }, mime);\n    };\n    img.src = objURL;\n  });\n}\n\n// Convert file to base64 string.\nexport function fileToBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = (evt) => {\n      reject(reader.error);\n    };\n    reader.onload = () => {\n      resolve({mime: file.type, bits: reader.result.split(',')[1], name: file.name});\n    };\n    reader.readAsDataURL(file);\n  });\n}\n\n// Convert Blob to base64 string. Returns a promise resolved with the base64 string and mime.\nexport function blobToBase64(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onerror = _ => {\n      reject(reader.error);\n    };\n    reader.onload = () => {\n      resolve({mime: blob.type, bits: reader.result.split(',')[1]});\n    };\n    reader.readAsDataURL(blob);\n  });\n}\n\n// File pasted from the clipboard. It's either an inline image or a file attachment.\nexport function filePasted(event, onImageSuccess, onAttachmentSuccess, onError) {\n  const items = (event.clipboardData || event.originalEvent.clipboardData || {}).items;\n  if (!Array.isArray(items)) {\n    return false;\n  }\n\n  for (let i in items) {\n    const item = items[i];\n    if (item.kind === 'file') {\n      const file = item.getAsFile();\n      if (!file) {\n        console.error(\"Failed to get file object from pasted file item\", item.kind, item.type);\n        onError(\"Failed to get file object from pasted file item\");\n        continue;\n      }\n      if (file.type && file.type.split('/')[0] == 'image') {\n        onImageSuccess(file);\n      } else {\n        onAttachmentSuccess(file);\n      }\n      // Indicate that the pasted data contains a file.\n      return true;\n    }\n  }\n  // No file found.\n  return false;\n}\n\n// Get mime type from data URL header.\nexport function getMimeType(header) {\n  var mime = /^data:(image\\/[-+a-z0-9.]+);base64/.exec(header);\n  return (mime && mime.length > 1) ? mime[1] : null;\n}\n\n// Given length of a binary object in bytes, calculate the length after\n// base64 encoding.\nexport function base64EncodedLen(n) {\n  return Math.floor((n + 2) / 3) * 4;\n}\n\n// Given length of a base64-encoded object, calculate decoded size of the\n// pbject in bytes.\nexport function base64DecodedLen(n) {\n  return Math.floor(n / 4) * 3;\n}\n\n// Re-encode string to standard base64 encoding with padding.\n// The string may be base64-URL encoded without the padding.\nexport function base64ReEncode(str) {\n  if (str) {\n    str = str.replace(/-/g, '+').replace(/_/g, '/');\n    try {\n      str = btoa(atob(str));\n    } catch(err) {\n      console.error(\"Failed to base64 re-encode string.\", err);\n      str = null;\n    }\n  }\n  return str;\n}\n\n// Convert a base64 encoded string with the provided mime type into a Blob.\nexport function base64ToBlob(str, mime) {\n  if (!str) {\n    return null;\n  }\n\n  try {\n    // Make blob.\n    const bin = atob(str);\n    const length = bin.length;\n    const buf = new ArrayBuffer(length);\n    const arr = new Uint8Array(buf);\n    for (let i = 0; i < length; i++) {\n      arr[i] = bin.charCodeAt(i);\n    }\n\n    return new Blob([buf], { type: mime });\n  } catch(err) {\n    console.error(\"Failed to convert base64 to blob: \", err);\n  }\n\n  return null;\n}\n\nexport function intArrayToBase64(arr) {\n  if (!Array.isArray(arr)) {\n    return null;\n  }\n  try {\n    let bin = '';\n    new Uint8Array(arr).forEach(b => bin += String.fromCharCode(b));\n    return window.btoa(bin);\n  } catch (err) {}\n  return null;\n}\n\nexport function base64ToIntArray(b64) {\n  const arr = [];\n  try {\n    const bin =  window.atob(b64);\n    [...bin].forEach(c => {\n      arr.push(c.charCodeAt(0));\n    });\n    return arr;\n  } catch (err) {}\n  return null;\n}\n","// Audio recorder widget.\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { secondsToTime } from '../lib/strformat';\nimport { base64ToIntArray } from '../lib/blob-helpers';\n\n// Make canvas bigger than the element size to reduce blurring.\nconst CANVAS_UPSCALING = 2.0;\n// Thickness of a visualization bar.\nconst LINE_WIDTH = 3 * CANVAS_UPSCALING;\n// Spacing between two visualization bars.\nconst SPACING = 2 * CANVAS_UPSCALING;\n// Color of histogram bars.\nconst BAR_COLOR = '#bbb';\nconst BAR_COLOR_DARK = '#888';\nconst THUMB_COLOR = '#666';\n// Minimum number of amplitude bars to draw.\nconst MIN_PREVIEW_LENGTH = 16;\n\nexport default class AudioPlayer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    let preview = base64ToIntArray(this.props.preview);\n    if (Array.isArray(preview) && preview.length < MIN_PREVIEW_LENGTH) {\n      preview = null;\n    }\n\n    this.state = {\n      canPlay: false,\n      playing: false,\n      currentTime: '0:00',\n      duration: this.props.duration > 0 ? secondsToTime(this.props.duration / 1000) : '-:--',\n      longMin: this.props.duration >= 600000,\n      preview: preview\n    };\n\n    this.initAudio = this.initAudio.bind(this);\n    this.initCanvas = this.initCanvas.bind(this);\n    this.resampleBars = this.resampleBars.bind(this);\n    this.visualize = this.visualize.bind(this);\n\n    this.handlePlay = this.handlePlay.bind(this);\n    this.handleSeek = this.handleSeek.bind(this);\n    this.handleError = this.handleError.bind(this);\n\n    this.audioPlayer = null;\n\n    this.viewBuffer = [];\n    this.canvasRef = React.createRef();\n  }\n\n  componentDidMount() {\n    if (this.props.src) {\n      this.initAudio();\n    }\n\n    if (this.state.preview) {\n      this.initCanvas();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.audioPlayer) {\n      this.audioPlayer.oncanplay = null;\n      this.audioPlayer.ontimeupdate = null;\n      this.audioPlayer.onended = null;\n      this.audioPlayer.pause();\n      this.audioPlayer = null;\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.src != prevProps.src) {\n      this.initAudio();\n    }\n\n    if (this.props.preview != prevProps.preview) {\n      let preview = base64ToIntArray(this.props.preview);\n      if (Array.isArray(preview) && preview.length < MIN_PREVIEW_LENGTH) {\n        preview = null;\n      }\n      this.setState({preview: preview}, this.initCanvas);\n    }\n  }\n\n  initAudio() {\n    this.audioPlayer = new Audio(this.props.src);\n    this.audioPlayer.oncanplay = _ => this.setState({canPlay: true});\n    this.audioPlayer.ontimeupdate = _ => this.setState({\n      currentTime: secondsToTime(this.audioPlayer.currentTime, this.state.longMin)\n    });\n    this.audioPlayer.onended = _ => {\n      this.audioPlayer.currentTime = 0;\n      this.setState({playing: false, currentTime: secondsToTime(0, this.state.longMin)})\n    }\n  }\n\n  initCanvas() {\n    // Force canvas aspect ration to match one of the element + upscale canvas to reduce blurring.\n    this.canvasRef.current.width = this.canvasRef.current.offsetWidth * CANVAS_UPSCALING;\n    this.canvasRef.current.height = this.canvasRef.current.offsetHeight * CANVAS_UPSCALING;\n\n    this.canvasContext = this.canvasRef.current.getContext('2d');\n    this.canvasContext.lineCap = 'round';\n\n    this.viewBuffer = this.resampleBars(this.state.preview);\n    this.visualize();\n  }\n\n  // Draw amplitude of sound.\n  visualize() {\n    if (!this.canvasRef.current) {\n      return;\n    }\n\n    const width = this.effectiveWidth;\n    const height = this.canvasRef.current.height;\n\n    this.canvasContext.lineWidth = LINE_WIDTH;\n\n    const drawFrame = () => {\n      if (!this.canvasRef.current) {\n        // The component is unmounted.\n        return;\n      }\n\n      this.canvasContext.clearRect(0, 0, this.canvasRef.current.width, height);\n\n      if (this.viewBuffer) {\n        if (this.state.playing) {\n          window.requestAnimationFrame(drawFrame);\n        }\n\n        // Current pplayback position.\n        const thumbAt = this.props.duration ?\n          Math.max(0, Math.min(this.audioPlayer.currentTime * 1000 / this.props.duration, 1)) * (width - LINE_WIDTH * 2) : -1;\n\n        // Draw amplitude bars.\n        this.canvasContext.beginPath();\n        this.canvasContext.strokeStyle = BAR_COLOR_DARK;\n        for (let i = 0; i < this.viewBuffer.length; i++) {\n          let x = 1 + i * (LINE_WIDTH + SPACING) + LINE_WIDTH * 0.5;\n          let y = this.viewBuffer[i] * height * 0.9;\n\n          const color = x < thumbAt ? BAR_COLOR_DARK : BAR_COLOR;\n          if (this.canvasContext.strokeStyle != color) {\n            this.canvasContext.stroke();\n            this.canvasContext.beginPath();\n            this.canvasContext.strokeStyle = color;\n          }\n\n          this.canvasContext.moveTo(x, (height - y) * 0.5);\n          this.canvasContext.lineTo(x, height * 0.5 + y * 0.5);\n        }\n        // Actually draw the bars on canvas.\n        this.canvasContext.stroke();\n\n        // Draw thumb.\n        if (this.props.duration) {\n          this.canvasContext.beginPath();\n          this.canvasContext.arc(thumbAt + LINE_WIDTH * 2, height * 0.5, LINE_WIDTH * 2, 0, 2 * Math.PI);\n          this.canvasContext.fillStyle = THUMB_COLOR;\n          this.canvasContext.fill();\n        }\n      }\n    }\n\n    drawFrame();\n  }\n\n  // Quick and dirty downsampling of the original preview bars into a smaller (or equal) number of bars we can display here.\n  resampleBars(original) {\n    const barCount = Math.min(original.length, ((this.canvasRef.current.width - SPACING) / (LINE_WIDTH + SPACING)) | 0);\n    const factor = original.length / barCount;\n    let amps = [];\n    let max = -1;\n    for (let i=0;i<barCount;i++) {\n      let lo = (i * factor) | 0; // low bound;\n      let hi = ((i + 1) * factor) | 0; // high bound;\n      let amp = 0.0;\n      for (let j=lo; j<hi; j++) {\n        amp += original[j]\n      }\n      amps[i] = Math.max(0, amp / (hi - lo));\n      max = Math.max(amps[i], max);\n    }\n\n    if (max > 0) {\n      // Remove extra padding on the right due to fractional bar which is not drawn.\n      this.effectiveWidth = barCount * (LINE_WIDTH + SPACING) + SPACING;\n      return amps.map(a => a / max);\n    }\n    return null;\n  }\n\n  handlePlay(e) {\n    e.preventDefault();\n    if (!this.state.canPlay) {\n      return;\n    }\n    if (this.state.playing) {\n      this.audioPlayer.pause();\n      this.setState({playing: false});\n    } else {\n      this.audioPlayer.play();\n      this.setState({playing: true}, this.visualize);\n    }\n  }\n\n  handleError(err) {\n    console.log(err);\n  }\n\n  handleSeek(e) {\n    e.preventDefault();\n    if (e.target && this.props.duration) {\n      const rect = e.target.getBoundingClientRect();\n      const offset = (e.clientX - rect.left) / this.effectiveWidth * CANVAS_UPSCALING;\n      this.audioPlayer.currentTime = this.props.duration * offset / 1000;\n      this.setState({currentTime: secondsToTime(this.audioPlayer.currentTime, this.state.longMin)});\n      if (!this.state.playing && this.state.preview) {\n        this.visualize();\n      }\n    }\n  }\n\n  render() {\n    const playClass = 'material-icons' +\n      (this.props.short ? '' : ' large') +\n      (this.state.canPlay ? '' : ' disabled');\n    const play = (<a href=\"#\" onClick={this.handlePlay} title=\"Play\">\n        <i className={playClass}>{this.state.playing ? 'pause_circle' :\n          (this.state.canPlay ? 'play_circle' : 'not_interested')}</i>\n      </a>);\n    return (<div className=\"audio-player\">{this.props.short ?\n      <>\n        <div>\n          {this.state.preview ?\n            <canvas className=\"playback\" ref={this.canvasRef} onClick={this.handleSeek} /> :\n            <div className=\"playback\"> - </div>\n          }\n        </div>\n        {play}\n      </>\n    :\n      <>\n        {play}\n        <div>\n          {this.state.preview ?\n            <canvas className=\"playback\" ref={this.canvasRef} onClick={this.handleSeek} /> :\n            <div className=\"playback\">\n              <FormattedMessage\n                id=\"preview_unavailable\" defaultMessage=\"unavailable\" description=\"Message shown when media preview is not available\" />\n            </div>\n          }\n          <div className=\"timer\">{this.state.currentTime}/{this.state.duration}</div>\n        </div>\n      </>\n    }\n    </div>);\n  }\n}\n","// Image with a placeholder which is replaced when the promise is resolved.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport default class LazyImage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      src: 'img/placeholder.png',\n      style: Object.assign({padding: '4px'}, this.props.style),\n      className: this.props.className,\n      alt: this.props.alt,\n      onClick: this.props.onClick,\n    };\n  }\n\n  componentDidMount() {\n    // whenDone is a wrapper around an actual promise to be able to cancel it.\n    this.props.whenDone\n      .promise\n      .then(data => this.setState({src: data.src, style: {...this.state.style, padding: 0}}))\n      .catch(() => this.setState({src: 'img/broken_image.png'}));\n  }\n\n  componentWillUnmount() {\n    this.props.whenDone.cancel();\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.whenDone != this.props.whenDone) {\n      this.setState({src: 'img/placeholder.png', style: {...this.state.style, padding: '4px'}});\n      this.props.whenDone\n        .promise\n        .then(data => this.setState({src: data.src, style: {...this.state.style, padding: 0}}))\n        .catch(() => this.setState({src: 'img/broken_image.png'}));\n    }\n  }\n\n  render() {\n    return React.createElement('img', this.state);\n  }\n};\n","// File uload/download progress indicator with a cancel inside.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport default class FileProgress extends React.PureComponent {\n  render() {\n    return (\n      <div className=\"uploader\">\n        <div><span style={{width: (this.props.progress * 100) + \"%\"}}></span></div>\n        {this.props.progress < 0.999 ?\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCancel();}}>\n            <i className=\"material-icons\">close</i> <FormattedMessage id=\"action_cancel\"\n              defaultMessage=\"cancel\" description=\"Call to action [cancel]\" />\n          </a>\n          :\n          <FormattedMessage id=\"upload_finishing\" defaultMessage=\"finishing...\"\n            description=\"Notification that upload is finishing\" />\n        }\n      </div>\n    );\n  }\n}\n","// Image view with progress bar and a cancel button.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport FileProgress from './file-progress.jsx';\n\nexport default class UploadingImage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    return (\n      <div className=\"inline-image\">\n        {React.createElement('img', this.props)}\n        <div className=\"rounded-container\">\n          <FileProgress progress={this.props.progress} onCancel={this.props.onCancelUpload} />\n        </div>\n      </div>\n    );\n  }\n};\n","import React from 'react';\nimport { defineMessages } from 'react-intl';\n\nimport { Drafty } from 'tinode-sdk';\n\nimport AudioPlayer from '../widgets/audio-player.jsx'\nimport LazyImage from '../widgets/lazy-image.jsx'\nimport UploadingImage from '../widgets/uploading-image.jsx'\n\nimport { IMAGE_THUMBNAIL_DIM, BROKEN_IMAGE_SIZE, REM_SIZE } from '../config.js';\nimport { base64ToBlob, blobToBase64, fitImageSize, imageScaled } from './blob-helpers.js';\nimport { idToColorClass, secondsToTime, shortenFileName } from './strformat.js';\nimport { cancelablePromise, sanitizeUrlForMime } from './utils.js';\n\nconst messages = defineMessages({\n  drafty_form: {\n    id: 'drafty_form',\n    defaultMessage: 'Form: ',\n    description: 'Comment for form in drafty'\n  },\n  drafty_attachment: {\n    id: 'drafty_attachment',\n    defaultMessage: 'Attachment',\n    description: 'Comment for attachment in drafty'\n  },\n  drafty_image: {\n    id: 'drafty_image',\n    defaultMessage: 'Picture',\n    description: 'Comment for embedded images in drafty'\n  },\n  drafty_unknown: {\n    id: 'drafty_unknown',\n    defaultMessage: 'Unsupported',\n    description: 'Unsupported entity in drafty'\n  }\n});\n\n// Additional processing of image data.\nfunction handleImageData(el, data, attr) {\n  if (!data) {\n    attr.src = 'img/broken_image.png';\n    attr.style = {\n      width: IMAGE_THUMBNAIL_DIM + 'px',\n      height: IMAGE_THUMBNAIL_DIM + 'px',\n    };\n    return el;\n  }\n\n  attr.className = 'inline-image';\n  const dim = fitImageSize(data.width, data.height,\n    this.viewportWidth > 0 ? Math.min(this.viewportWidth - REM_SIZE * 6.5, REM_SIZE * 34.5) :\n      REM_SIZE * 34.5, REM_SIZE * 24, false) ||\n      {dstWidth: BROKEN_IMAGE_SIZE, dstHeight: BROKEN_IMAGE_SIZE};\n  attr.style = {\n    width: dim.dstWidth + 'px',\n    height: dim.dstHeight + 'px',\n    // Looks like a Chrome bug: broken image does not respect 'width' and 'height'.\n    minWidth: dim.dstWidth + 'px',\n    minHeight: dim.dstHeight + 'px'\n  };\n  if (!Drafty.isProcessing(data)) {\n    attr.src = this.authorizeURL(sanitizeUrlForMime(attr.src, 'image'));\n    attr.alt = data.name;\n    if (attr.src) {\n      if (Math.max(data.width || 0, data.height || 0) > IMAGE_THUMBNAIL_DIM) {\n        // Allow previews for large enough images.\n        attr.onClick = this.onImagePreview;\n        attr.className += ' image-clickable';\n      }\n      attr.loading = 'lazy';\n    } else {\n      attr.src = 'img/broken_image.png';\n    }\n  } else {\n    // Use custom element instead of <img>.\n    el = UploadingImage;\n  }\n\n  return el;\n}\n\n// The main Drafty formatter: converts Drafty elements into React classes. 'this' is set by the caller.\n// 'this' must contain:\n//    viewportWidth: this.props.viewportWidth;\n//    authorizeURL: this.props.tinode.authorizeURL\n//    onImagePreview: this.handleImagePreview\n//    onFormButtonClick: this.handleFormButtonClick\n//    onQuoteClick: this.handleQuoteClick (optional)\nexport function fullFormatter(style, data, values, key, stack) {\n  if (stack.includes('QQ')) {\n    return quoteFormatter.call(this, style, data, values, key);\n  }\n\n  if (!style) {\n    // Unformatted.\n    return values;\n  }\n\n  let el = Drafty.tagName(style);\n  let attr = Drafty.attrValue(style, data) || {};\n  attr.key = key;\n  switch (style) {\n    case 'AU':\n      // Show audio player.\n      if (attr.src) {\n        attr.src = this.authorizeURL(sanitizeUrlForMime(attr.src, 'audio'));\n        attr.duration = data.duration > 0 ? (data.duration | 0) : undefined;\n        attr.preview = data.preview;\n        attr.loading = 'lazy';\n      }\n      el = AudioPlayer;\n      // Audio element cannot have content.\n      values = null;\n      break;\n    case 'BR':\n      values = null;\n      break;\n    case 'EX':\n      // Ignore.\n      break;\n    case 'HL':\n      // Highlighted text. Assign class name.\n      attr.className = 'highlight';\n      break;\n    case 'HD':\n      el = null;\n      values = null;\n      break;\n    case 'IM':\n      // Additional processing for images\n      el = handleImageData.call(this, el, data, attr);\n      // Image element cannot have content.\n      values = null;\n      break;\n    case 'BN':\n      // Button\n      attr.onClick = this.onFormButtonClick;\n      let inner = React.Children.map(values, (child) => {\n        return typeof child == 'string' ? child : undefined;\n      });\n      if (!inner || inner.length == 0) {\n        inner = [attr.name]\n      }\n      // Get text which will be sent back when the button is clicked.\n      attr['data-title'] = inner.join('');\n      break;\n    case 'MN':\n      // Mention\n      attr.className = 'mention'\n      if (data) {\n        attr.className += ' ' + idToColorClass(data.val, false, true);\n      }\n      break;\n    case 'FM':\n      // Form\n      attr.className = 'bot-form';\n      break;\n    case 'RW':\n      // Form element formatting is dependent on element content.\n      break;\n    case 'QQ':\n      // Quote/citation.\n      attr.className = 'reply-quote'\n      attr.onClick = this.onQuoteClick;\n      break;\n    default:\n      if (!el) {\n        // Unknown element.\n        el = React.Fragment;\n        attr = {key: key};\n        // Generate comment for unknown element.\n        let body = values;\n        if (!Array.isArray(values) || !values.join('').trim()) {\n          body = [<span key=\"x1\" className=\"gray\">{this.formatMessage(messages.drafty_unknown)}</span>];\n        }\n        values = [<i key=\"x0\" className=\"material-icons gray\">extension</i>, ' '].concat(body);\n      }\n      break;\n  }\n  if (!el) {\n    return values;\n  }\n  return React.createElement(el, attr, values);\n}\n\n// Converts Drafty object into a one-line preview. 'this' is set by the caller.\n// 'this' must contain:\n//    formatMessage: this.props.intl.formatMessage\n//    messages: formatjs messages defined with defineMessages.\nexport function previewFormatter(style, data, values, key) {\n  if (!style) {\n    // Unformatted.\n    return values;\n  }\n\n  let el = Drafty.tagName(style);\n  const attr = { key: key };\n  switch (style) {\n    case 'AU':\n      // Voicemail as '[mic] 0:00'.\n      el = React.Fragment;\n      values = [<i key=\"au\" className=\"material-icons\">mic</i>, ' ', secondsToTime(data.duration/1000)];\n      break;\n    case 'BR':\n      // Replace new line with a space.\n      el = React.Fragment;\n      values = [' '];\n      break;\n    case 'HL':\n      // Make highlight less prominent in preview.\n      attr.className = 'highlight preview';\n      break;\n    case 'LN':\n    case 'MN':\n      // Disable links in previews.\n      el = 'span';\n      break;\n    case 'IM':\n      // Replace image with '[icon] Image'.\n      el = React.Fragment;\n      values = [<i key=\"im\" className=\"material-icons\">photo</i>, ' ', this.formatMessage(messages.drafty_image)];\n      break;\n    case 'BN':\n      el = 'span';\n      attr.className = 'flat-button faux';\n      break;\n    case 'FM':\n      el = React.Fragment;\n      values = [<i key=\"fm\" className=\"material-icons\">dashboard</i>,\n        this.formatMessage(messages.drafty_form)].concat(' ', values || []);\n      break;\n    case 'RW':\n      el = React.Fragment;\n      break;\n    case 'EX':\n      if (data) {\n        if (data.mime == 'application/json') {\n          // Ignore JSON attachments: they are form response payloads.\n          return null;\n        }\n        // Clear payload.\n        delete data.val;\n        delete data.ref;\n      }\n      el = React.Fragment;\n      values = [<i key=\"ex\" className=\"material-icons\">attachment</i>, ' ', this.formatMessage(messages.drafty_attachment)];\n      break;\n    case 'QQ':\n    case 'HD':\n      el = null;\n      values = null;\n      break;\n    default:\n      if (!el) {\n        // Unknown element.\n        el = React.Fragment;\n        values = [<i key=\"x0\" className=\"material-icons gray\">extension</i>, ' ', this.formatMessage(messages.drafty_unknown)];\n      }\n      break;\n  }\n  if (!el) {\n    return values;\n  }\n  return React.createElement(el, attr, values);\n};\n\n// Converts Drafty object into a quoted reply. 'this' is set by the caller.\nfunction inlineImageAttr(attr, data) {\n  attr.style = {\n    width: IMAGE_THUMBNAIL_DIM + 'px',\n    height: IMAGE_THUMBNAIL_DIM + 'px',\n    maxWidth: IMAGE_THUMBNAIL_DIM + 'px',\n    maxHeight: IMAGE_THUMBNAIL_DIM + 'px',\n  }\n  attr.className = 'inline-image';\n  attr.alt = this.formatMessage(messages.drafty_image);\n  if (!data) {\n    attr.src = 'img/broken_image.png';\n  }\n  attr.title = attr.alt;\n  return attr;\n}\n\n// Displays a portion of Drafty within 'QQ' quotes. 'this' is set by the caller.\n// 'this' must contain:\n//    formatMessage: this.props.intl.formatMessage\n//    messages: formatjs messages defined with defineMessages.\n//    authorizeURL: this.props.tinode.authorizeURL\n//    onQuoteClick: this.handleQuoteClick (optional)\nfunction quoteFormatter(style, data, values, key) {\n  if (['BR', 'EX', 'IM', 'MN'].includes(style)) {\n    let el = Drafty.tagName(style);\n    let attr = Drafty.attrValue(style, data) || {};\n    attr.key = key;\n    switch(style) {\n      case 'BR':\n        values = null;\n        break;\n      case 'IM':\n        attr = inlineImageAttr.call(this, attr, data);\n        values = [React.createElement('img', attr, null), ' ', attr.alt];\n        el = React.Fragment;\n        // Fragment attributes.\n        attr = {key: key};\n        break;\n      case 'MN':\n        el = 'span';\n        attr.className = 'mention'\n        if (data) {\n          attr.className += ' ' + idToColorClass(data.val, false, true);\n        }\n        break;\n      case 'EX':\n        let fname;\n        if (data) {\n          if (data.mime == 'application/json') {\n            // Ignore JSON attachments: they are form response payloads.\n            return null;\n          }\n          fname = data.name;\n          // Clear payload.\n          delete data.val;\n          delete data.ref;\n        }\n        el = React.Fragment;\n        values = [<i key=\"ex\" className=\"material-icons\">attachment</i>,\n          shortenFileName(fname, 16) || this.formatMessage(messages.drafty_attachment)];\n        break;\n    }\n    return React.createElement(el, attr, values);\n  }\n  return previewFormatter.call(this, style, data, values, key);\n}\n\n// Create image thumbnail suitable for inclusion in a quote.\nfunction quoteImage(data) {\n  let promise;\n  // Get the blob from the image data.\n  if (data.val) {\n    const blob = base64ToBlob(data.val, data.mime);\n    if (!blob) {\n      throw new Error(\"Invalid image\");\n    }\n    promise = Promise.resolve(blob);\n  } else if (data.ref) {\n    promise = fetch(this.authorizeURL(sanitizeUrlForMime(data.ref, 'image')))\n      .then(evt => {\n        if (evt.ok) {\n          return evt.blob();\n        } else {\n          throw new Error(`Image fetch unsuccessful: ${evt.status} ${evt.statusText}`);\n        }\n      });\n  } else {\n    throw new Error(\"Missing image data\");\n  }\n\n  // Scale the blob.\n  return promise\n    .then(blob => {\n      // Cut the square from the center of the image and shrink it.\n      return imageScaled(blob, IMAGE_THUMBNAIL_DIM, IMAGE_THUMBNAIL_DIM, -1, true)\n    }).then(scaled => {\n      data.mime = scaled.mime;\n      data.size = scaled.blob.size;\n      data.width = scaled.width;\n      data.height = scaled.height;\n      delete data.ref;\n      // Keeping the original file name, if provided: ex.data.name;\n\n      data.src = URL.createObjectURL(scaled.blob);\n      return blobToBase64(scaled.blob);\n    }).then(b64 => {\n      data.val = b64.bits;\n      return data;\n    }).catch(err => {\n      delete data.val;\n      delete data.src;\n      data.width = IMAGE_THUMBNAIL_DIM;\n      data.height = IMAGE_THUMBNAIL_DIM;\n      // Rethrow.\n      throw err;\n    });\n}\n\n// Create a preview of a reply.\nexport function replyFormatter(style, data, values, key, stack) {\n  if (style == 'IM') {\n    const attr = inlineImageAttr.call(this, {key: key}, data);\n    let loadedPromise;\n    try {\n      loadedPromise = cancelablePromise(quoteImage.call(this, data));\n    } catch (error) {\n      loadedPromise = cancelablePromise(error);\n    }\n    attr.whenDone = loadedPromise;\n    values = [React.createElement(LazyImage, attr, null), ' ', attr.alt];\n    return React.createElement(React.Fragment, {key: key}, values);\n  } else if (style == 'QQ') {\n    if (stack.includes('QQ')) {\n      // Quote inside quote when forwarding a message.\n      return React.createElement('span', {key: key},\n        [<i key=\"qq\" className=\"material-icons\">format_quote</i>, ' ']);\n    }\n\n    const attr = Drafty.attrValue('QQ', data) || {};\n    attr.key = key;\n    attr.className = 'reply-quote'\n    return React.createElement(Drafty.tagName('QQ'), attr, values);\n  }\n  return quoteFormatter.call(this, style, data, values, key);\n}\n","// A single topic or user.\nimport React from 'react';\nimport { FormattedMessage, injectIntl } from 'react-intl';\n\nimport ContactBadges from './contact-badges.jsx';\nimport LetterTile from './letter-tile.jsx';\nimport UnreadBadge from './unread-badge.jsx';\n\nimport { Drafty } from 'tinode-sdk';\n\nimport { previewFormatter } from '../lib/formatters.js';\nimport { deliveryMarker } from '../lib/utils.js';\n\nclass Contact extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleClick = this.handleClick.bind(this);\n    this.handleContextClick = this.handleContextClick.bind(this);\n  }\n\n  handleClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.props.onSelected) {\n      // Index this.props.index is used by GroupManager.\n      this.props.onSelected(this.props.item, this.props.index);\n    }\n  }\n\n  handleContextClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.props.showContextMenu({ topicName: this.props.item, y: e.pageY, x: e.pageX });\n  }\n\n  render() {\n    let title = this.props.title;\n    if (!title) {\n      title = <i><FormattedMessage id=\"unnamed_topic\" defaultMessage=\"Unnamed\"\n        description=\"Title shown when the topic has no name\" /></i>;\n    } else if (title.length > 30) {\n      // FIXME: this is probably wrong for RTL languages.\n      title = title.substring(0, 28) + '…';\n    }\n    const online = this.props.now ? 'online' : 'offline';\n    const avatar = this.props.avatar ? this.props.avatar : true;\n    const badges = this.props.badges ? this.props.badges.slice() : [];\n    const icon_badges = [];\n    if (this.props.isVerified) {\n      icon_badges.push({icon: 'verified', color: 'verified-color'});\n    }\n    if (this.props.isStaff) {\n      icon_badges.push({icon: 'staff', color: 'staff-color'});\n    }\n    if (this.props.isDangerous) {\n      icon_badges.push({icon: 'dangerous', color: 'danger-color'});\n    }\n    if (this.props.acs) {\n      if (this.props.showMode) {\n        badges.push({name: this.props.acs.getMode(), key: 'mode'});\n      }\n      if (this.props.acs.isMuted()) {\n        icon_badges.push({icon: 'muted'});\n      }\n      if (!this.props.acs.isJoiner()) {\n        icon_badges.push({icon: 'banned'});\n      }\n    }\n\n    // The this.props.preview contains alreay shortened Drafty or string.\n    let preview;\n    if (this.props.previewIsVideoCall) {\n      preview = <><i className='material-icons'>{this.props.previewIsResponse ? 'call_received' : 'call_made'}</i>\n                  <i className='material-icons'>video_call</i></>;\n    } else if (typeof this.props.preview == 'string') {\n      preview = this.props.preview;\n    } else if (Drafty.isValid(this.props.preview)) {\n      preview = React.createElement(React.Fragment, null, Drafty.format(this.props.preview, previewFormatter,\n        {formatMessage: this.props.intl.formatMessage}));\n    } else if (this.props.preview) {\n      preview =\n        <><i className=\"material-icons gray\">warning_amber</i> <i className=\"gray\">\n          <FormattedMessage id=\"invalid_content\"\n            defaultMessage=\"invalid content\" description=\"Shown when the message is unreadable\" /></i>\n        </>;\n    }\n\n    const icon = deliveryMarker(this.props.received);\n    const marker = icon ? <i className={'material-icons small space-right' +\n      (icon.color ? ' ' + icon.color : '')}>{icon.name}</i> : null;\n    const titleClass = 'contact-title' + (this.props.deleted ? ' deleted' : '');\n\n    return (\n      <li className={!this.props.showCheckmark && this.props.selected ? 'selected' : null} onClick={this.handleClick}>\n        <div className=\"avatar-box\">\n          <LetterTile\n            tinode={this.props.tinode}\n            avatar={avatar}\n            title={this.props.title}\n            topic={this.props.item}\n            deleted={this.props.deleted} />\n          {this.props.deleted ? <i className=\"deleted material-icons\">cancel</i> :\n            this.props.showOnline ? <span className={online} /> :\n            (this.props.showCheckmark && this.props.selected) ?\n            <i className=\"checkmark material-icons\">check_circle</i>\n            : null}\n        </div>\n        <div className=\"text-box\">\n          <div><span className={titleClass}>{title}</span>\n            {this.props.isChannel ? <img src=\"/img/channel.png\" className=\"channel\" alt=\"channel\" /> : null}\n            <ContactBadges badges={icon_badges} />\n            {!this.props.deleted ? <UnreadBadge count={this.props.unread} /> : null}\n          </div>\n          {this.props.showMode ?\n            <span><ContactBadges badges={badges} /></span> :\n            this.props.small ? null : <div className=\"contact-comment\">{marker}<span>{preview || this.props.comment || '\\u00A0'}</span></div>}\n        </div>\n        {this.props.showContextMenu ?\n          <span className=\"menuTrigger\">\n            <a href=\"#\" onClick={this.handleContextClick}>\n              <i className=\"material-icons\">expand_more</i>\n            </a>\n          </span> : null}\n      </li>\n    );\n  }\n};\n\nexport default injectIntl(Contact);\n","// A panel included into a list of contacts with an action text.\nimport React from 'react';\nimport { injectIntl } from 'react-intl';\n\nclass ContactAction extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  handleClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.props.onAction(this.props.action);\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    return (\n      <li onClick={this.handleClick} className=\"action\">\n        <div className=\"action-text\">{formatMessage(this.props.title, this.props.values)}</div>\n      </li>\n    );\n  }\n};\n\nexport default injectIntl(ContactAction);\n","// ContactList: component for showing a list of contacts,\n// such as a list of group members in a group chat.\nimport React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\n\nimport { Drafty, Tinode } from 'tinode-sdk';\n\nimport Contact from './contact.jsx';\nimport ContactAction from './contact-action.jsx';\n\nimport { makeImageUrl } from '../lib/blob-helpers.js';\nimport { isVideoCall } from '../lib/utils.js'\n\nimport { MESSAGE_PREVIEW_LENGTH } from '../config.js';\n\nconst messages = defineMessages({\n  badge_you: {\n    id: 'badge_you',\n    defaultMessage: 'you',\n    description: 'Badge for indicating the current user'\n  },\n  badge_owner: {\n    id: 'badge_owner',\n    defaultMessage: 'owner',\n    description: 'Badge for indicating the owner'\n  }\n});\n\nclass ContactList extends React.Component {\n  render() {\n    const { formatMessage } = this.props.intl;\n    const showCheckmark = Array.isArray(this.props.topicSelected);\n    const contactNodes = [];\n    let contactsCount = 0;\n    if (this.props.contacts && this.props.contacts.length > 0) {\n      this.props.contacts.map((c) => {\n        if (c.action) {\n          // Action item\n          contactNodes.push(\n            <ContactAction\n              title={c.title} action={c.action} values={c.values}\n              key={c.action}\n              onAction={this.props.onAction}\n              />);\n        } else {\n          // Normal contact\n          const key = this.props.showMode ? c.user : (c.topic || c.user);\n          // If filter function is provided, filter out the items\n          // which don't satisfy the condition.\n          if (this.props.filterFunc && this.props.filter) {\n            const filterOn = [key];\n            if (c.private && c.private.comment) {\n              filterOn.push(('' + c.private.comment).toLowerCase());\n            }\n            if (c.public && c.public.fn) {\n              filterOn.push(('' + c.public.fn).toLowerCase());\n            }\n            if (!this.props.filterFunc(this.props.filter, filterOn)) {\n              return;\n            }\n          }\n\n          const isChannel = Tinode.isChannelTopicName(key);\n          const selected = showCheckmark ?\n            (this.props.topicSelected.indexOf(key) > -1) :\n            (this.props.topicSelected === key);\n          const badges = [];\n          if (this.props.showMode) {\n            if (key == this.props.myUserId) {\n              badges.push({name: formatMessage(messages.badge_you), color: 'green'});\n            }\n            if (c.acs && c.acs.isOwner()) {\n              badges.push({name: formatMessage(messages.badge_owner), color: 'blue'});\n            }\n          }\n\n          const comment = Array.isArray(c.private) ?\n            c.private.join(',') : (c.private ? c.private.comment : null);\n          let preview;\n          let forwarded;\n          let previewIsVideoCall;\n          let previewIsResponse;\n          let deliveryStatus;\n          if (!this.props.showMode && c.latestMessage) {\n            const msg = c.latestMessage(true);\n            if (msg) {\n              forwarded = msg.head ? msg.head.forwarded : null;\n              deliveryStatus = msg._status || c.msgStatus(msg, true);\n              previewIsVideoCall = msg.head ? isVideoCall(msg.head.mime) : null;\n              previewIsResponse = msg.from != this.props.myUserId;\n              if (msg.content) {\n                preview = typeof msg.content == 'string' ?\n                  msg.content.substr(0, MESSAGE_PREVIEW_LENGTH) :\n                  Drafty.preview(msg.content, MESSAGE_PREVIEW_LENGTH);\n              }\n            }\n          }\n\n          contactNodes.push(\n            <Contact\n              tinode={this.props.tinode}\n              title={c.public ? c.public.fn : null}\n              avatar={makeImageUrl(c.public ? c.public.photo : null)}\n              comment={comment}\n              preview={preview}\n              previewIsVideoCall={previewIsVideoCall}\n              previewIsResponse={previewIsResponse}\n              forwarded={forwarded}\n              received={deliveryStatus}\n              unread={this.props.showUnread ? c.unread : 0}\n              now={c.online && this.props.connected}\n              acs={c.acs}\n              showMode={this.props.showMode}\n              badges={badges}\n              showCheckmark={showCheckmark}\n              selected={selected}\n              showOnline={this.props.showOnline && !isChannel}\n              isChannel={isChannel}\n              onSelected={this.props.onTopicSelected}\n              showContextMenu={this.props.showContextMenu}\n              isVerified={c.trusted && c.trusted.verified}\n              isStaff={c.trusted && c.trusted.staff}\n              isDangerous={c.trusted && c.trusted.danger}\n              deleted={c._deleted}\n              item={key}\n              index={contactNodes.length}\n              key={key} />\n          );\n          contactsCount ++;\n        }\n      }, this);\n    }\n\n    return (\n      <div className={this.props.noScroll ? null : \"scrollable-panel\"}>\n        {contactsCount == 0 ?\n          <div className=\"center-medium-text\"\n            dangerouslySetInnerHTML={{__html: this.props.emptyListMessage}} />\n          :\n          null\n        }\n        {contactNodes.length > 0 ?\n          <ul className=\"contact-box\">\n            {contactNodes}\n          </ul>\n          :\n          null\n        }\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(ContactList);\n","import React from 'react';\n\nimport { Tinode } from 'tinode-sdk';\n\nexport default class SearchContacts extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      edited: false,\n      search: ''\n    };\n\n    this.handleSearchChange = this.handleSearchChange.bind(this);\n    this.handleSearch = this.handleSearch.bind(this);\n    this.handleClear = this.handleClear.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentWillUnmount() {\n    if (this.state.edited) {\n      this.setState({search: '', edited: false});\n      this.props.onSearchContacts(Tinode.DEL_CHAR);\n    }\n  }\n\n  handleSearchChange(e) {\n    this.setState({search: e.target.value});\n  }\n\n  handleSearch(e) {\n    e.preventDefault();\n    var query = this.state.search.trim();\n    this.setState({edited: (query.length > 0)});\n    this.props.onSearchContacts(query.length > 0 ? query : Tinode.DEL_CHAR);\n  }\n\n  handleClear(e) {\n    e.preventDefault();\n    if (this.state.edited) {\n      this.props.onSearchContacts(Tinode.DEL_CHAR);\n    }\n    this.setState({search: '', edited: false});\n  }\n\n  handleKeyDown(e) {\n    if (e.key === 'Enter') {\n      this.handleSearch(e);\n    } else if (e.key === 'Escape') {\n      this.handleClear();\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"panel-form\">\n        <div className=\"panel-form-row\">\n          <i className=\"material-icons search\">search</i>\n          <input className=\"search\" type=\"text\"\n              placeholder={this.props.placeholder}\n              value={this.state.search} onChange={this.handleSearchChange}\n              onKeyDown={this.handleKeyDown} required autoFocus />\n          {this.state.search ?\n            <a href=\"#\" onClick={this.handleClear}><i className=\"material-icons\">highlight_off</i></a>\n            :\n            <span><i className=\"material-icons\">&nbsp;</i></span>}\n        </div>\n      </div>\n    );\n  }\n};\n","// Forward Menu: message forwarding popup/dropdown menu.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport ContactList from './contact-list.jsx';\nimport SearchContacts from './search-contacts.jsx';\n\nexport default class ForwardDialog extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      query: null\n    };\n\n    this.handleEscapeKey = this.handleEscapeKey.bind(this);\n    this.handleClose = this.handleClose.bind(this);\n\n    this.handleSearchContacts = this.handleSearchContacts.bind(this);\n    this.handleContactSelected = this.handleContactSelected.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.onInitFind();\n  }\n\n  handleEscapeKey(e) {\n    if (e.keyCode === 27) {\n      // Not forwarding the message.\n      this.props.hide(false);\n    }\n  }\n\n  handleClose(e) {\n    e.preventDefault();\n    this.props.hide(false);\n  }\n\n  handleSearchContacts(query) {\n    this.setState({ query: Tinode.isNullValue(query) ? null : query });\n    this.props.onSearchContacts(query);\n  }\n\n  handleContactSelected(uid) {\n    this.props.onTopicSelected(uid);\n    this.props.hide(true);\n  }\n\n  render() {\n    let contacts = this.state.query != null ? this.props.searchResults : this.props.contacts;\n    // Filter out contacts without a 'W' or 'J' permissions as well as the current topic.\n    contacts = contacts.filter((c) => {\n      return (c.name != this.props.topicSelected) && c.acs.isJoiner() && c.acs.isWriter();\n    });\n\n    return (\n      <div className=\"alert-container\">\n        <div className=\"forward-dialog\">\n          <div className=\"title with-control\">\n            <div><FormattedMessage id=\"forward_to\" defaultMessage=\"Forward to\"\n              desription=\"Title of the contact selector dialog when forwarding a message\" /></div>\n            <div><a href=\"#\" onClick={this.handleClose}><i className=\"material-icons\">close</i></a></div>\n          </div>\n          <FormattedMessage id=\"forward_to_search_placeholder\" defaultMessage=\"Search contacts\"\n            description=\"Contact search prompt when forwarding a message.\">{\n            (search_placeholder) => <SearchContacts\n              placeholder={search_placeholder}\n              onSearchContacts={this.handleSearchContacts} />\n          }</FormattedMessage>\n          <FormattedMessage id=\"search_no_results\" defaultMessage=\"Search returned no results\"\n              description=\"Text shown in contacts view when query returned no results.\">{\n            (not_found_placeholder) => <ContactList\n              tinode={this.props.tinode}\n              contacts={contacts}\n              myUserId={this.props.myUserId}\n              emptyListMessage={not_found_placeholder}\n              showOnline={false}\n              showUnread={false}\n              showContextMenu={false}\n              onTopicSelected={this.handleContactSelected} />\n          }</FormattedMessage>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\n\nexport default class LoadSpinner extends React.PureComponent {\n  render() {\n    const className = 'load-spinner-box' + (this.props.large ? ' large' : '')\n      + (this.props.clear ? ' clear' : '') + (this.props.centered ? ' centered' : '');\n    return (this.props.show ?\n      <div className={className}><div className=\"loader-spinner\"></div></div> : null);\n  }\n}\n","import React from 'react';\n\nimport LetterTile from './letter-tile.jsx';\nimport LoadSpinner from './load-spinner.jsx';\n\nimport { sanitizeUrlForMime } from '../lib/utils.js';\n\nimport { AVATAR_SIZE } from '../config.js';\n\nexport default class AvatarUpload extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      source: props.avatar\n    };\n\n    this.handleFileReceived = this.handleFileReceived.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.avatar != prevProps.avatar) {\n      this.setState({source: this.props.avatar});\n    }\n  }\n\n  handleFileReceived(e) {\n    const image = e.target.files[0];\n    this.props.onImageUpdated(image.type, URL.createObjectURL(image), image.name);\n    // Clear the value so the same file can be uploaded again.\n    e.target.value = '';\n  }\n\n  render() {\n    // Randomize id value in case more than one AvatarUpload is shown\n    // at the same time.\n    const randId = 'file-input-avatar-' + ('' + Math.random()).substring(0, 4);\n    const className = 'avatar-upload' + (this.props.readOnly ? ' read-only' : '');\n    return (\n      <div className={className}>\n        {this.props.readOnly || !this.state.source ?\n          null :\n          <a href=\"#\" className=\"clear-avatar\" onClick={(e) => {e.preventDefault(); this.props.onImageUpdated();}}>\n            <i className=\"material-icons\">clear</i>\n          </a>}\n        {this.state.source ?\n          <img src={this.props.tinode.authorizeURL(sanitizeUrlForMime(this.state.source, 'image'))} className=\"preview\" /> :\n          this.props.readOnly && this.props.uid ?\n            <div className=\"avatar-box\">\n              <LetterTile\n                tinode={this.props.tinode}\n                avatar={true}\n                topic={this.props.uid}\n                title={this.props.title} />\n            </div>\n            :\n            <div className=\"blank\">{AVATAR_SIZE}&times;{AVATAR_SIZE}</div>}\n        {this.props.readOnly ? null :\n          <input type=\"file\" id={randId} className=\"inputfile hidden\"\n            accept=\"image/*\" onChange={this.handleFileReceived} />}\n        {this.props.readOnly ? null :\n        <label htmlFor={randId} className=\"round\">\n          <i className=\"material-icons\">file_upload</i>\n        </label>}\n        <LoadSpinner show={this.props.uploading} large={true} clear={true} centered={true} />\n      </div>\n    );\n  }\n};\n","import React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\n\nconst icon_mapping = {'staff': 'verified_user'};\n\nconst messages = defineMessages({\n  badge_verified: {\n    id: 'badge_verified',\n    defaultMessage: 'Verified/official',\n    description: 'Explanation of a verified account or topic badge'\n  },\n  badge_staff: {\n    id: 'badge_staff',\n    defaultMessage: 'Staff-managed',\n    description: 'Explanation of a staff-managed account or topic badge'\n  },\n  badge_danger: {\n    id: 'badge_danger',\n    defaultMessage: 'Untrustworthy',\n    description: 'Suspicious or untrustworthy account or topic badge'\n  },\n});\n\n\n/* Trusted badges with labels: verified, staff, danger */\nclass BadgeList extends React.PureComponent {\n  render() {\n    const {formatMessage} = this.props.intl;\n    let badges = null;\n    if (this.props.trustedBadges && this.props.trustedBadges.length > 0) {\n      badges = [];\n      this.props.trustedBadges.map((b) => {\n        const comment = formatMessage(messages['badge_' + b]);\n        const style = 'material-icons ' + b + '-color';\n        badges.push(<div className=\"trusted-badge\" key={b}><i className={style}>{icon_mapping[b] || b}</i> {comment}</div>);\n      });\n      return <>{badges}</>;\n    }\n    return null;\n  }\n};\n\nexport default injectIntl(BadgeList);\n","import React from 'react';\n\n/* BEGIN CheckBox: styled checkbox */\nexport default class CheckBox extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange() {\n    this.props.onChange(this.props.name, !this.props.checked);\n  }\n\n  render() {\n    return (\n      this.props.onChange ? (\n        this.props.checked === true ?\n          <i className=\"material-icons blue clickable\" onClick={this.handleChange}>check_box</i> :\n        this.props.checked === false ?\n          <i className=\"material-icons blue clickable\" onClick={this.handleChange}>check_box_outline_blank</i> :\n          <i className=\"material-icons lt-blue\">indeterminate_check_box</i>\n        ) : (\n          this.props.checked ?\n            <i className=\"material-icons\">check_box</i> :\n            <i className=\"material-icons\">check_box_outline_blank</i>\n        )\n    );\n  }\n}\n/* END CheckBox */\n","// The X menu to be displayed in title bars.\nimport React from 'react';\n\nexport default class MenuCancel extends React.PureComponent {\n  render() {\n    return (\n      <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCancel();}}>\n        <i className=\"material-icons\">close</i>\n      </a>\n    );\n  }\n}\n","import React from 'react';\n\nimport MenuCancel from './menu-cancel.jsx';\n\nexport default class ErrorPanel extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      show: false,\n    };\n\n    this.hide = this.hide.bind(this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.level !== this.props.level) {\n      this.setState({\n        show: !(!this.props.level)\n      });\n    }\n  }\n\n  hide() {\n    this.setState({show: false});\n    if (this.props.onClearError) {\n      this.props.onClearError();\n    }\n  }\n\n  render() {\n    const icons = {err: 'error', warn: 'warning', info: 'info'}\n    const level = icons[this.props.level] || '';\n    const className = 'info-box ' + level;\n    return (\n      <div className={className}>\n        <div className=\"icon\"><i className=\"material-icons\">{level}</i></div>\n        <span>\n          {this.props.text}\n          {this.props.action ?\n            <>\n              &#32;<a href=\"#\"\n                style={{ whiteSpace: 'nowrap' }}\n                onClick={(e) => {e.preventDefault(); this.props.action();}}>\n                {this.props.actionText}\n              </a>\n            </>\n          : null}\n        </span>\n        <div className=\"cancel\"><MenuCancel onCancel={this.hide} /></div>\n      </div>\n    );\n  }\n};\n","import React from 'react';\n\nimport LetterTile from './letter-tile.jsx';\n\nexport default class Chip extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  handleCancel(e) {\n    e.preventDefault();\n    this.props.onCancel(this.props.topic, this.props.index);\n  }\n\n  render() {\n    const title = this.props.title || this.props.topic;\n    const className = this.props.invalid ? 'chip invalid' : 'chip';\n    return (\n      <div className={className}>\n        {this.props.noAvatar ?\n          <span className=\"spacer\" /> :\n          <div className=\"avatar-box\">\n            <LetterTile\n              tinode={this.props.tinode}\n              avatar={this.props.avatar || true}\n              topic={this.props.topic}\n              title={this.props.title} />\n          </div>\n        }\n        <span>{title}</span>\n        {this.props.onCancel && !this.props.required ?\n          <a href=\"#\" onClick={this.handleCancel} >&times;</a>\n          : <span className=\"spacer\" />}\n      </div>\n    );\n  }\n};\n","import React from 'react';\n\nimport Chip from './chip.jsx';\n\nimport { makeImageUrl } from '../lib/blob-helpers.js';\n\n/* BEGIN ChipInput: group membership widget */\nexport default class ChipInput extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = ChipInput.deriveStateFromProps(props);\n    this.state.input = '';\n    this.state.focused = false;\n\n    this.handleTextInput = this.handleTextInput.bind(this);\n    this.removeChipAt = this.removeChipAt.bind(this);\n    this.handleChipCancel = this.handleChipCancel.bind(this);\n    this.handleFocusGained = this.handleFocusGained.bind(this);\n    this.handleFocusLost = this.handleFocusLost.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  static deriveStateFromProps(props) {\n    return {\n      placeholder: props.chips ? '' : props.prompt,\n      sortedChips: ChipInput.sortChips(props.chips, props.staticMembers),\n      chipIndex: ChipInput.indexChips(props.chips)\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevProps.chips != this.props.chips ||\n      prevProps.staticMembers != this.props.staticMembers ||\n      prevProps.prompt != this.props.prompt) {\n      this.setState(ChipInput.deriveStateFromProps(this.props));\n    }\n    if (!prevState || this.props.chips.length > prevState.sortedChips.length) {\n      this.setState({input: ''});\n    }\n  }\n\n  // Map chip index to user name\n  static indexChips(chips) {\n    const index = {};\n    let count = 0;\n    chips.map((item) => {\n      index[item.user] = count;\n      count ++;\n    });\n    return index;\n  }\n\n  // Have non-removable chips appear before all other chips.\n  static sortChips(chips, keep) {\n    const required = [];\n    const normal = [];\n    chips.map((item) => {\n      if (keep && keep.includes(item.user)) {\n        required.push(item);\n      } else {\n        normal.push(item);\n      }\n    });\n    return required.concat(normal);\n  }\n\n  handleTextInput(e) {\n    this.setState({input: e.target.value});\n    if (this.props.filterFunc) {\n      this.props.filterFunc(e.target.value);\n    }\n  }\n\n  removeChipAt(idx) {\n    const removed = this.state.sortedChips[idx];\n    this.props.onChipRemoved(removed.user, this.state.chipIndex[removed.user]);\n  }\n\n  handleChipCancel(item, idx) {\n    this.removeChipAt(idx);\n  }\n\n  handleFocusGained() {\n    this.setState({focused: true});\n  }\n\n  handleFocusLost() {\n    this.setState({focused: false});\n    if (this.props.onFocusLost) {\n      this.props.onFocusLost(this.state.input);\n    }\n  }\n\n  handleKeyDown(e) {\n    if (e.key === 'Backspace') {\n      if (this.state.input.length == 0 && this.state.sortedChips.length > 0) {\n        const at = this.state.sortedChips.length - 1;\n        if (this.state.sortedChips[at].user !== this.props.staticMembers) {\n          this.removeChipAt(at);\n        }\n      }\n    } else if (e.key === 'Enter') {\n      if (this.props.onEnter) {\n        this.props.onEnter(this.state.input);\n      }\n    } else if (e.key === 'Escape') {\n      if (this.props.onCancel) {\n        this.props.onCancel();\n      }\n    }\n  }\n\n  render() {\n    const chips = [];\n    let count = 0;\n    const staticMembers = this.props.staticMembers || [];\n    this.state.sortedChips.map((item) => {\n      chips.push(\n        <Chip\n          tinode={this.props.tinode}\n          onCancel={this.handleChipCancel}\n          avatar={makeImageUrl(item.public ? item.public.photo : null)}\n          title={item.public ? item.public.fn : undefined}\n          noAvatar={this.props.avatarDisabled}\n          topic={item.user}\n          required={staticMembers.includes(item.user)}\n          invalid={item.invalid}\n          index={count}\n          key={item.user} />\n      );\n      count++;\n    });\n    const className = \"chip-input\" + (this.state.focused ? ' focused' : '');\n    const autoFocus = !(this.props.tabIndex > 0);\n    return (\n      <div className={className}>\n        {chips}\n        <input type=\"text\"\n          placeholder={this.state.placeholder}\n          onChange={this.handleTextInput}\n          onFocus={this.handleFocusGained}\n          onBlur={this.handleFocusLost}\n          onKeyDown={this.handleKeyDown}\n          value={this.state.input}\n          tabIndex={this.props.tabIndex}\n          autoFocus={autoFocus} />\n      </div>\n    );\n  }\n};\n","// GroupMembers: control for managing a list of group members.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport ChipInput from './chip-input.jsx';\nimport ContactList from './contact-list.jsx';\n\nconst messages = defineMessages({\n  no_contacts: {\n    id: 'no_contacts',\n    defaultMessage: 'You have no contacts :-(',\n    description: 'Shown in ContactsView when the user has no contacts'\n  },\n  contacts_not_found_short: {\n    id: 'contacts_not_found_short',\n    defaultMessage: \"No contacts match ''{query}''\",\n    description: 'Shown in ContactsView when search returned no results'\n  }\n});\n\nclass GroupManager extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      // Array of topic members\n      members: props.members,\n      index: GroupManager.indexMembers(props.members),\n      staticMembers: GroupManager.staticMembers(props.members, props.keepInitialMembers, props.requiredMember),\n      contactFilter: '',\n      noContactsMessage: props.intl.formatMessage(messages.no_contacts),\n      selectedContacts: GroupManager.selectedContacts(props.members)\n    };\n\n    this.handleContactSelected = this.handleContactSelected.bind(this);\n    this.handleMemberRemoved = this.handleMemberRemoved.bind(this);\n    this.handleContactFilter = this.handleContactFilter.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  static indexMembers(members) {\n    let index = {};\n    members.map((m) => {\n      index[m.user] = {delta: 0, present: true}; // Delta: 0 unchanged, +1 added, -1 removed\n    });\n    return index;\n  }\n\n  static staticMembers(members, keepInitial, requiredMember) {\n    let stat = [];\n    members.map((m) => {\n      if (keepInitial || m.user == requiredMember) {\n        stat.push(m.user);\n      }\n    });\n    return stat;\n  }\n\n  static selectedContacts(members) {\n    let sel = [];\n    members.map((m) => {\n      sel.push(m.user);\n    });\n    return sel;\n  }\n\n  handleContactSelected(userId, index) {\n    let status = this.state.index[userId];\n    if (status) {\n      if (status.present) {\n        // Prevent duplicate members\n        return;\n      }\n      status.delta += 1;\n      status.present = true;\n    } else {\n      status = {delta: 1, present: true};\n    }\n\n    let m = this.state.members.slice();\n    m.push(this.props.contacts[index]);\n\n    const sel = GroupManager.selectedContacts(m);\n\n    const i = this.state.index;\n    i[userId] = status;\n\n    this.setState({members: m, index: i, selectedContacts: sel});\n  }\n\n  handleMemberRemoved(userId, index) {\n    const status = this.state.index[userId];\n    if (!status || !status.present) {\n      return;\n    }\n    status.present = false;\n    status.delta -= 1;\n\n    let m = this.state.members.slice();\n    m.splice(index, 1);\n\n    const sel = GroupManager.selectedContacts(m);\n\n    const i = this.state.index;\n    i[userId] = status;\n\n    this.setState({members: m, index: i, selectedContacts: sel});\n  }\n\n  handleContactFilter(val) {\n    const {formatMessage} = this.props.intl;\n    const msg = !val ?\n      formatMessage(messages.no_contacts) :\n      formatMessage(messages.contacts_not_found_short, {query: val});\n\n    this.setState({contactFilter: val, noContactsMessage: msg});\n  }\n\n  static doContactFiltering(filter, values) {\n    if (filter) {\n      for (let i=0; i<values.length; i++) {\n        if (values[i].indexOf(filter) >= 0) {\n          return true;\n        }\n      }\n      return false;\n    }\n    return true;\n  }\n\n  handleSubmit() {\n    var instance = this;\n    var members = [];\n    var added = [];\n    var removed = [];\n\n    var keys = Object.keys(this.state.index);\n    keys.map(function(k) {\n      if (instance.state.index[k].present) {\n        members.push(k);\n      }\n\n      if (instance.state.index[k].delta > 0) {\n        added.push(k);\n      } else if (instance.state.index[k].delta < 0) {\n        removed.push(k);\n      }\n    });\n    this.props.onSubmit(members, added, removed);\n  }\n\n  handleCancel() {\n    this.props.onCancel();\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    return (\n      <div id=\"group-manager\">\n        <div className=\"panel-form-row\">\n          <label className=\"small\">\n            <FormattedMessage id=\"title_group_members\" defaultMessage=\"Group Members\" description=\"Section title\" />\n          </label>\n        </div>\n        <div className=\"panel-form-row\">\n          <ChipInput\n            tinode={this.props.tinode}\n            chips={this.state.members}\n            staticMembers={this.state.staticMembers}\n            prompt=\"add members\"\n            filterFunc={this.handleContactFilter}\n            onChipRemoved={this.handleMemberRemoved} />\n        </div>\n        <div className=\"panel-form-row\">\n          <label className=\"small\">\n            <FormattedMessage id=\"title_all_contacts\" defaultMessage=\"All Contacts\"\n              description=\"Section title [All Contacts]\" />\n          </label>\n        </div>\n        <ContactList\n          tinode={this.props.tinode}\n          contacts={this.props.contacts}\n          myUserId={this.props.myUserId}\n          topicSelected={this.state.selectedContacts}\n          filter={this.state.contactFilter}\n          filterFunc={GroupManager.doContactFiltering}\n          emptyListMessage={this.state.noContactsMessage}\n          showOnline={false}\n          showUnread={false}\n          onTopicSelected={this.handleContactSelected} />\n        <div id=\"group-manager-buttons\" className=\"panel-form-row\">\n          <button className=\"secondary\" onClick={this.handleCancel}>\n            <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\n          </button>\n          <button className=\"primary\" onClick={this.handleSubmit}>\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(GroupManager);\n","// PermissionsEditor: Component for editing permissions\n// <PermissionsEditor mode=\"JWROD\" skip=\"O\" onChange={this.handleCheckboxTest} />\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport CheckBox from './checkbox.jsx';\nimport Contact from './contact.jsx';\n\nimport { makeImageUrl } from '../lib/blob-helpers.js';\n\n// Translatable permission names.\nconst messages = defineMessages({\n  joiner: {\n    id: 'permission_join',\n    defaultMessage: \"Join ({val})\",\n    description: 'Name of J permission'\n  },\n  reader: {\n    id: 'permission_read',\n    defaultMessage: \"Read ({val})\",\n    description: 'Name of R permission'\n  },\n  writer: {\n    id: 'permission_write',\n    defaultMessage: \"Write ({val})\",\n    description: 'Name of W permission'\n  },\n  preser: {\n    id: 'permission_pres',\n    defaultMessage: \"Get notified ({val})\",\n    description: 'Name of P permission'\n  },\n  approver: {\n    id: 'permission_admin',\n    defaultMessage: \"Approve ({val})\",\n    description: 'Name of A permission'\n  },\n  sharer: {\n    id: 'permission_share',\n    defaultMessage: \"Share ({val})\",\n    description: 'Name of S permission'\n  },\n  deleter: {\n    id: 'permission_delete',\n    defaultMessage: \"Delete ({val})\",\n    description: 'Name of D permission'\n  },\n  owner: {\n    id: 'permission_owner',\n    defaultMessage: \"Owner ({val})\",\n    description: 'Name of O permission'\n  }\n});\n\nclass PermissionsEditor extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      mode: (props.mode || '').replace('N', '')\n    };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  handleChange(val) {\n    let mode = this.state.mode;\n    const idx = mode.indexOf(val);\n    if (idx == -1) {\n      mode += val;\n    } else {\n      mode = mode.replace(val, '');\n    }\n    this.setState({mode: mode});\n  }\n\n  handleSubmit() {\n    // Normalize string, otherwise cannot check if mode has changed.\n    const mode = (this.state.mode || 'N').split('').sort().join('');\n    const before = (this.props.mode || 'N').split('').sort().join('')\n    if (mode !== before) {\n      this.props.onSubmit(mode);\n    } else {\n      this.props.onCancel();\n    }\n  }\n\n  handleCancel() {\n    this.props.onCancel();\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    const all = 'JRWPASDO';\n    const names = {\n      'J': formatMessage(messages.joiner, {val: 'J'}),\n      'R': formatMessage(messages.reader, {val: 'R'}),\n      'W': formatMessage(messages.writer, {val: 'W'}),\n      'P': formatMessage(messages.preser, {val: 'P'}),\n      'A': formatMessage(messages.approver, {val: 'A'}),\n      'S': formatMessage(messages.sharer, {val: 'S'}),\n      'D': formatMessage(messages.deleter, {val: 'D'}),\n      'O': formatMessage(messages.owner, {val: 'O'})\n    };\n\n    let skip = this.props.skip || '';\n    let mode = this.state.mode;\n    let compare = (this.props.compare || '').replace('N', '');\n    let items = [];\n    for (let i=0; i<all.length; i++) {\n      let c = all.charAt(i);\n      if (skip.indexOf(c) >= 0 && mode.indexOf(c) < 0) {\n        // Permission is marked as inactive: hide unchecked permissions, disable checked permissions\n        continue;\n      }\n      items.push(\n        <tr key={c}>\n          <td>{names[c]}</td>\n          <td className=\"checkbox\">{skip.indexOf(c) < 0 ?\n            <CheckBox name={c} checked={(mode.indexOf(c) >= 0)} onChange={this.handleChange}/>\n            :\n            <CheckBox name={c} checked={(mode.indexOf(c) >= 0)} />\n          }</td>{this.props.compare ? <td className=\"checkbox\">\n            <CheckBox name={c} checked={(compare.indexOf(c) >= 0)}/>\n          </td> : null}\n        </tr>\n      );\n    }\n\n    return (\n      <div className=\"panel-form-column\">\n        {this.props.userTitle ?\n          <ul className=\"contact-box small\"><Contact\n            tinode={this.props.tinode}\n            item={this.props.item}\n            title={this.props.userTitle}\n            small={true}\n            avatar={makeImageUrl(this.props.userAvatar ? this.props.userAvatar : null)} /></ul> : null}\n        <label className=\"small\"><FormattedMessage id=\"title_permissions\"\n          defaultMessage=\"Permissions\" description=\"Section title\"/></label>\n        <table className=\"permission-editor\">\n        {this.props.compare ?\n          <thead><tr>\n            <th></th><th>{this.props.modeTitle}</th>\n            <th>{this.props.compareTitle}</th>\n          </tr></thead> :\n          null}\n        <tbody>\n          {items}\n        </tbody></table>\n        <br />\n        <div className=\"dialog-buttons\">\n          <button className=\"outline\" onClick={this.handleCancel}>\n            <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\n          </button>\n          <button className=\"primary\" onClick={this.handleSubmit}>\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(PermissionsEditor);\n","// Image zoom and crop widget.\n\nimport React from 'react';\n\nconst DEFAULT_MAX_ZOOM = 2.5;\n\nexport default class Cropper extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      // Coordinates of the top left corner of the image in container coordinates.\n      panX: 0,\n      panY: 0,\n      // Origin of the zoom in image coordinates.\n      originX: 0,\n      originY: 0,\n      // Zoom scale.\n      zoom: 1,\n      // Zoom min and max.\n      minZoom: 0,\n      maxZoom: DEFAULT_MAX_ZOOM,\n    };\n\n    // References to DOM elements for hooking up events and getting screen dimensions.\n    // The transparent element which captures mouse moves (moves with the image).\n    this.overlay = React.createRef();\n    // The image cutout window or view port (static).\n    this.cutout = React.createRef();\n    // Scaled and translated image preview.\n    this.preview = React.createRef();\n    // The main container (static).\n    this.boundingBox = React.createRef();\n\n    // The original image width and height before any scaling.\n    this.imageWidth = 0;\n    this.imageHeight = 0;\n\n    // Mouse position when dragging.\n    this.mouseX = 0\n    this.mouseY = 0;\n    // Length of the previous mouse move when dragging.\n    this.prevDistance = 0;\n\n    // Bounding rectangles of static elements.\n    this.cutoutRect = {};\n    this.bBoxRect = {};\n    // Center of the bounding box.\n    this.originX = 0;\n    this.originY = 0;\n\n    this.initScaling = this.initScaling.bind(this);\n    this.onZoom = this.onZoom.bind(this);\n    this.handleZoom = this.handleZoom.bind(this);\n    this.mouseDown = this.mouseDown.bind(this);\n    this.mouseUp = this.mouseUp.bind(this);\n    this.mouseMove = this.mouseMove.bind(this);\n    this.mouseTouch = this.mouseTouch.bind(this);\n    this.positionAll = this.positionAll.bind(this);\n    this.translate = this.translate.bind(this);\n  }\n\n  componentDidMount() {\n    this.overlay.current.addEventListener('mousedown', this.mouseDown, { passive: true });\n    this.overlay.current.addEventListener('touchstart', this.mouseDown, { passive: true });\n\n    // The rectangle position is in viewport coordinates.\n    this.bBoxRect = this.boundingBox.current.getBoundingClientRect();\n    // Center of the bounding box in container coordinates.\n    this.originX = this.bBoxRect.width / 2;\n    this.originY = this.bBoxRect.height / 2;\n\n    // The rectangle position is in viewport coordinates.\n    this.cutoutRect = this.cutout.current.getBoundingClientRect();\n  }\n\n  componentWillUnmount() {\n    this.overlay.current.removeEventListener('mousedown', this.mouseDown);\n    this.overlay.current.removeEventListener('touchstart', this.mouseDown);\n  }\n\n  // Position all elements.\n  positionAll(panX, panY, zoom) {\n    // Zoom origin in image preview coordinates.\n    this.setState({\n      panX: panX,\n      panY: panY,\n      zoom: zoom,\n      originX: this.originX - panX,\n      originY: this.originY - panY,\n    });\n\n    // Pass cut out coordinates to caller.\n    const left = (this.originX - panX) * zoom - this.originX;\n    const top = (this.originY - panY) * zoom - this.originY;\n    this.props.onChange(\n      (left + this.cutoutRect.left - this.bBoxRect.left) / zoom,\n      (top + this.cutoutRect.top - this.bBoxRect.top) / zoom,\n      this.cutoutRect.width / zoom,\n      this.cutoutRect.height / zoom,\n      zoom);\n  }\n\n  // Check if new location is within the limits.\n  static checkBound(currPan, img, cutout, delta) {\n    let nextDiff = Math.min(0, cutout[0] - img[0] - delta, img[1] - cutout[1] + delta);\n    if (nextDiff == 0) {\n      // Cutout is completely within the image.\n      currPan += delta;\n    } else if (Math.min(0, cutout[0] - img[0], img[1] - cutout[1]) < nextDiff) {\n      // Cutout is outside of the range but closer to the bound.\n      currPan += delta;\n    }\n    return currPan;\n  }\n\n  initScaling() {\n    // Initialize components.\n    const imgRect = this.preview.current.getBoundingClientRect();\n\n    this.imageWidth = imgRect.width;\n    this.imageHeight = imgRect.height;\n\n    // Set zoom slider's min and max values. Make sure the scaled image cannot be smaller than the cutout.\n    const minZoom = Math.max(this.cutoutRect.width / imgRect.width, this.cutoutRect.height / imgRect.height);\n    this.setState({\n      minZoom: minZoom,\n      maxZoom: Math.max(DEFAULT_MAX_ZOOM, minZoom + 1)\n    });\n\n    // Initial zoom level fills the bounding box at the smallest image dimension and overflows the largest, i.e. \"fill\" not \"fit\".\n    const zoom = Math.max(this.bBoxRect.width / imgRect.width, this.bBoxRect.height / imgRect.height);\n    // Converting from viewport coordinates to container, then panning.\n    const panX = this.cutoutRect.left - this.bBoxRect.left -\n      (imgRect.width - this.cutoutRect.width) / 2;\n    const panY = this.cutoutRect.top - this.bBoxRect.top -\n      (imgRect.height - this.cutoutRect.height) / 2;\n\n    this.positionAll(panX, panY, zoom);\n  }\n\n  onZoom(e) {\n    this.handleZoom(e.target.value);\n  }\n\n  handleZoom(zoom) {\n    let panX = this.state.panX;\n    let panY = this.state.panY;\n\n    // Ensure that the image at the new zoom is not outside of the cutout boundaries.\n    // Calculate image coordinates at the new zoom.\n    const imgLeft = this.originX - (this.originX - panX) * zoom;\n    const imgRight = imgLeft + this.imageWidth * zoom;\n    // Cutout in the same coordinates as the image.\n    const coLeft = this.cutoutRect.left - this.bBoxRect.left;\n    const coRight = coLeft + this.cutoutRect.width;\n    if (coLeft < imgLeft) {\n      panX -= imgLeft - coLeft;\n    } else if (coRight > imgRight) {\n      panX += coRight - imgRight;\n    }\n    const imgTop = this.originY - (this.originY - panY) * zoom;\n    const imgBottom = imgTop + this.imageHeight * zoom;\n    const coTop = this.cutoutRect.top - this.bBoxRect.top;\n    const coBottom = coTop + this.cutoutRect.height;\n    if (coTop < imgTop) {\n      panY -= imgTop - coTop;\n    } else if (coBottom > imgBottom) {\n      panY += coBottom - imgBottom;\n    }\n\n    this.positionAll(panX, panY, zoom);\n  }\n\n  mouseDown(e) {\n    if (e.touches) {\n      this.mouseX = e.touches[0].pageX;\n      this.mouseY = e.touches[0].pageY;\n    } else {\n      this.mouseX = e.pageX;\n      this.mouseY = e.pageY;\n    }\n\n    window.addEventListener('mousemove', this.mouseMove, { passive: false });\n    window.addEventListener('touchmove', this.mouseTouch, { passive: false });\n    window.addEventListener('mouseup', this.mouseUp, { passive: true });\n    window.addEventListener('touchend', this.mouseUp, { passive: true });\n    // Disable text selection in the entire document.\n    document.body.style['userSelect'] = 'none';\n  }\n\n  // Perform image panning.\n  translate(pageX, pageY) {\n    const dX = pageX - this.mouseX;\n    const dY = pageY - this.mouseY;\n\n    this.mouseX = pageX;\n    this.mouseY = pageY;\n\n    // Make sure the image is within the cutout window.\n    const imgRect = this.preview.current.getBoundingClientRect();\n\n    // Check if the new position is within the boundaries, and if not if it's closer to them.\n    let panX = Cropper.checkBound(this.state.panX, [imgRect.left, imgRect.right],\n      [this.cutoutRect.left, this.cutoutRect.right], dX);\n    let panY = Cropper.checkBound(this.state.panY, [imgRect.top, imgRect.bottom],\n      [this.cutoutRect.top, this.cutoutRect.bottom], dY);\n\n    this.positionAll(panX, panY, this.state.zoom);\n  }\n\n  // Image panning.\n  mouseMove(e) {\n    e.preventDefault();\n    this.translate(e.pageX, e.pageY);\n  }\n\n  mouseTouch(e) {\n    e.preventDefault();\n\n    if (e.touches.length == 1) {\n      this.translate(e.touches[0].pageX, e.touches[0].pageY);\n      return;\n    }\n\n    // Image zooming by pinching.\n    const [touch0, touch1] = e.touches;\n    const distance = Math.sqrt((touch0.pageX - touch1.pageX) * (touch0.pageX - touch1.pageX) +\n      (touch0.pageY - touch1.pageY) * (touch0.pageY - touch1.pageY));\n\n    if (!this.prevDistance) {\n        this.prevDistance = distance / this.state.zoom;\n    }\n\n    let scale = (distance / this.prevDistance);\n    this.handleZoom(Math.max(this.minZoom, Math.min(this.maxZoom, scale)));\n  }\n\n  mouseUp(e) {\n    window.removeEventListener('mousemove', this.mouseMove);\n    window.removeEventListener('touchmove', this.mouseTouch);\n    window.removeEventListener('mouseup', this.mouseUp);\n    window.removeEventListener('touchend', this.mouseUp);\n    // Re-enable text selection.\n    document.body.style['userSelect'] = '';\n\n    this.positionAll(this.state.panX, this.state.panY, this.state.zoom);\n  }\n\n  render() {\n    // transform3d: position and scale.\n    const t3d = `translate3d(${this.state.panX}px, ${this.state.panY}px, 0) scale(${this.state.zoom})`;\n    // transformOrigin: zoom origin.\n    const orig = `${this.state.originX}px ${this.state.originY}px`;\n\n    // Overlay position and size are exactly equal to the position and size of the transformed image\n    // except it uses different coordinates.\n    const overlay = {\n      top: `${this.originY - this.state.originY * this.state.zoom}px`,\n      left: `${this.originX - this.state.originX * this.state.zoom}px`,\n      width: `${this.imageWidth * this.state.zoom}px`,\n      height: `${this.imageHeight * this.state.zoom}px`\n    };\n    return (\n      <div className=\"cropper\">\n        <div className=\"bounding-box\" ref={this.boundingBox}>\n          <img src={this.props.source} className=\"preview\" alt=\"\"\n            style={{transform: t3d, transformOrigin: orig}} ref={this.preview} onLoad={this.initScaling} />\n          <div className=\"cutout circle\" ref={this.cutout} />\n          <div className=\"overlay\" style={overlay} ref={this.overlay} />\n        </div>\n        <div className=\"zoom-wrapper\">\n          <input type=\"range\" className=\"zoomer\"\n            step=\"0.001\" min={this.state.minZoom} max={this.state.maxZoom} value={this.state.zoom} onChange={this.onZoom} />\n        </div>\n      </div>\n    );\n  }\n}\n","// Edit account parameters.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport Cropper from './cropper.jsx';\nimport { imageCrop } from '../lib/blob-helpers.js';\n\nexport default class AvatarCrop extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      top: 0,\n      left: 0,\n      width: 0,\n      height: 0,\n      scale: 1\n    };\n\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  // Cut out in image coordinates and desired scale factor.\n  handleChange(left, top, width, height, scale) {\n    this.setState({\n      left: left,\n      top: top,\n      width: width,\n      height: height,\n      scale: scale\n    });\n  }\n\n  handleSubmit() {\n    imageCrop(this.props.mime, this.props.avatar,\n      this.state.left, this.state.top, this.state.width, this.state.height,\n      this.state.scale)\n      .then(img => {\n        this.props.onSubmit(img.mime, img.blob, img.width, img.height);\n      })\n      .catch(err => {\n        this.props.onError(err);\n      });\n  }\n\n  render() {\n    return (\n      <div className=\"panel-form\">\n        <div className=\"panel-form-row\">\n          <Cropper\n            source={this.props.avatar}\n            onChange={this.handleChange} />\n        </div>\n        <div className=\"dialog-buttons\">\n          {this.props.onCancel ?\n            <button className=\"secondary\" onClick={this.props.onCancel}>\n              <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\n            </button>\n            : null}\n          <button className=\"primary\" onClick={this.handleSubmit}>\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n","// Password with a visiblity toggle.\nimport React from 'react';\n\nexport default class VisiblePassword extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      value: this.props.value,\n      visible: false\n    };\n\n    this.handleVisibility = this.handleVisibility.bind(this);\n    this.handeTextChange = this.handeTextChange.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleEditingFinished = this.handleEditingFinished.bind(this);\n  }\n\n  handeTextChange(e) {\n    this.setState({value: e.target.value});\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  }\n\n  handleVisibility(e) {\n    e.preventDefault();\n    this.setState({visible: !this.state.visible});\n  }\n\n  handleKeyDown(e) {\n    if (e.keyCode == 27) {\n      // Escape pressed\n      this.setState({value: this.props.value, visible: false});\n      if (this.props.onFinished) {\n        this.props.onFinished();\n      }\n    } else if (e.keyCode == 13) {\n      // Enter pressed\n      this.handleEditingFinished();\n    }\n  }\n\n  handleEditingFinished(e) {\n    if (e) {\n      let currentTarget = e.currentTarget;\n      setTimeout(() => {\n        if (!currentTarget.contains(document.activeElement)) {\n          if (this.props.onFinished) {\n            this.props.onFinished(this.state.value);\n          }\n        }\n      }, 0);\n    } else if (this.props.onFinished) {\n      this.props.onFinished(this.state.value.trim());\n    }\n  }\n\n  render() {\n    return (\n      <div tabIndex=\"-1\" className=\"group-focus\"\n        onBlur={this.handleEditingFinished}>\n        <input className=\"with-visibility\"\n          type={this.state.visible ? \"text\" : \"password\"}\n          value={this.state.value}\n          placeholder={this.props.placeholder}\n          required={this.props.required ? 'required' : ''}\n          autoFocus={this.props.autoFocus ? 'autoFocus' : ''}\n          autoComplete={this.props.autoComplete}\n          onChange={this.handeTextChange}\n          onKeyDown={this.handleKeyDown} />\n        <span onClick={this.handleVisibility}>\n          <i className=\"material-icons clickable light-gray\">\n            {this.state.visible ? 'visibility' : 'visibility_off'}\n          </i>\n        </span>\n      </div>\n    );\n  }\n}\n","// In-place text editor. Shows text with an icon which toggles it into an input field.\nimport React from 'react';\n\nimport VisiblePassword from './visible-password.jsx';\n\nexport default class InPlaceEdit extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.selfRef = React.createRef();\n\n    this.state = {\n      active: props.active,\n      initialValue: props.value || '',\n      value: props.value || ''\n    };\n\n    this.handeTextChange = this.handeTextChange.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.handleStartEditing = this.handleStartEditing.bind(this);\n    this.handleEditingFinished = this.handleEditingFinished.bind(this);\n    this.handlePasswordFinished = this.handlePasswordFinished.bind(this);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    // If text has changed while in read mode, update text and discard changes.\n    // Ignore update if in edit mode.\n    const newValue = this.props.value || '';\n    if (prevState.initialValue != newValue && !prevState.active) {\n      this.setState({\n        initialValue: newValue,\n        value: newValue\n      });\n    }\n  }\n\n  handeTextChange(e) {\n    this.setState({value: e.target.value || ''});\n  }\n\n  handleKeyDown(e) {\n    if (e.keyCode === 27) {\n      // Escape pressed\n      this.setState({value: this.props.value, active: false});\n    } else if (e.keyCode === 13) {\n      // Enter pressed\n      this.handleEditingFinished(e);\n    }\n  }\n\n   handleStartEditing() {\n    if (!this.props.readOnly) {\n      this.setState({active: true}, () => {\n        if (this.selfRef.current) {\n          this.selfRef.current.focus();\n        }\n      });\n    }\n  }\n\n  handleEditingFinished(event) {\n    const value = this.state.value.trim();\n    if (this.props.required && (!event.target.checkValidity() || !value)) {\n      // Empty input\n      this.setState({value: this.props.value, active: false});\n      return;\n    }\n    this.setState({active: false});\n    if ((value || this.props.value) && (value !== this.props.value)) {\n      this.props.onFinished(value);\n    }\n  }\n\n  handlePasswordFinished(value) {\n    this.setState({active: false});\n    if (value && (value !== this.props.value)) {\n      this.props.onFinished(value);\n    }\n  }\n\n  render() {\n    if (!this.state.active) {\n      let spanText = this.props.type == 'password' ? '••••••••' : this.state.value;\n      let spanClass = 'in-place-edit' + (this.props.readOnly ? ' disabled' : '');\n      if (!spanText) {\n        spanText = this.props.placeholder;\n        spanClass += ' placeholder';\n      }\n      if (!this.props.multiline || this.props.multiline == 1) {\n        spanClass += ' short';\n      }\n\n      return (<span className={spanClass} onClick={this.handleStartEditing}>\n        <span>{spanText}</span>\n      </span>);\n    }\n\n    let element;\n    const attr = {};\n    if (this.props.type == 'password') {\n      element = VisiblePassword;\n      attr.onFinished = this.handlePasswordFinished;\n    } else {\n      if (this.props.multiline > 1) {\n        element = 'textarea';\n        attr.rows = this.props.multiline;\n        attr.className = 'inplace-edit';\n      } else {\n        element = 'input';\n        attr.type = this.props.type || 'text';\n      }\n      attr.value = this.state.value;\n      attr.onChange = this.handeTextChange;\n      attr.onKeyDown = this.handleKeyDown;\n      attr.onBlur = this.handleEditingFinished;\n    }\n    attr.placeholder = this.props.placeholder;\n    attr.required = this.props.required ? 'required' : '';\n    attr.autoComplete = this.props.autoComplete;\n    attr.autoFocus = true;\n    attr.ref = this.selfRef;\n\n    return React.createElement(element, attr, null);\n  }\n};\n","// TagManager: edit topic or user tags.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport ChipInput from './chip-input.jsx';\n\nimport { MAX_TAG_COUNT, MAX_TAG_LENGTH, MIN_TAG_LENGTH } from '../config.js';\nimport { arrayEqual } from '../lib/utils.js';\n\nexport default class TagManager extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      tags: this.props.tags || [],\n      tagInput: '',\n      activated: this.props.activated\n    };\n\n    this.handleTagInput = this.handleTagInput.bind(this);\n    this.handleAddTag = this.handleAddTag.bind(this);\n    this.handleRemoveTag = this.handleRemoveTag.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    const tags = nextProps.tags || [];\n    if (!arrayEqual(tags, prevState.tags) && !prevState.activated) {\n      return {tags: tags};\n    }\n    return null;\n  }\n\n  handleTagInput(text) {\n    this.setState({tagInput: text});\n    if (text.length > 0) {\n      const last = text[text.length-1];\n      if (text[0] == '\"') {\n        // This is a quoted string.\n        if (text.length > 1 && last == '\"') {\n          this.handleAddTag(text.substring(1, text.length-1));\n        }\n      } else if (last == ',' || last == ' ' || last == ';' || last == '\"') {\n        // User entered ',', ' ' or ';'\n        this.handleAddTag(text.substring(0, text.length-1).trim());\n      }\n    }\n  }\n\n  handleAddTag(tag) {\n    const maxTagCount = this.props.tinode.getServerLimit('maxTagCount', MAX_TAG_COUNT);\n\n    if (tag.length > 0 && this.state.tags.length < maxTagCount) {\n      const tags = this.state.tags.slice(0);\n      tags.push(tag);\n\n      this.setState({tags: tags, tagInput: ''});\n      if (this.props.onTagsChanged) {\n        this.props.onTagsChanged(tags);\n      }\n      return tags;\n    }\n    return this.state.tags;\n  }\n\n  handleRemoveTag(tag, index) {\n    const tags = this.state.tags.slice(0);\n    tags.splice(index, 1);\n    this.setState({tags: tags});\n    if (this.props.onTagsChanged) {\n      this.props.onTagsChanged(tags);\n    }\n  }\n\n  handleSubmit() {\n    // Add unprocessed input to tags, submit the list.\n    this.props.onSubmit(this.handleAddTag(this.state.tagInput.trim()));\n    this.setState({activated: false, tags: this.props.tags || []});\n  }\n\n  handleCancel() {\n    this.setState({activated: false, tagInput: '', tags: this.props.tags || []});\n    if (this.props.onCancel) {\n      this.props.onCancel();\n    }\n  }\n\n  render() {\n    const minTagLength = this.props.tinode.getServerLimit('minTagLength', MIN_TAG_LENGTH);\n    const maxTagLength = this.props.tinode.getServerLimit('maxTagLength', MAX_TAG_LENGTH);\n\n    let tags = [];\n    if (this.state.activated) {\n      this.state.tags.map((tag) => {\n        tags.push({user: tag, invalid: (tag.length < minTagLength || tag.length > maxTagLength)});\n      });\n    } else {\n      this.state.tags.map((tag) => {\n        tags.push(<span className=\"badge\" key={tags.length}>{tag}</span>);\n      });\n      if (tags.length == 0) {\n        tags = (\n          <i>\n            <FormattedMessage id=\"tags_not_found\" defaultMessage=\"No tags defined. Add some.\" description=\"\" />\n          </i>\n        );\n      }\n    }\n    return (\n      <div className=\"panel-form-column\">\n        <div className=\"panel-form-row\">\n          <label className=\"small\">{this.props.title}</label>\n        </div>\n        {this.state.activated ?\n        <div>\n          <FormattedMessage id=\"tags_editor_no_tags\" defaultMessage=\"Add some tags\"\n            description=\"Tag editor prompt when no tags are found.\">{\n            (add_tags_prompt) => <ChipInput\n              tinode={this.props.tinode}\n              chips={tags}\n              avatarDisabled={true}\n              prompt={add_tags_prompt}\n              tabIndex={this.props.tabIndex}\n              onEnter={this.handleAddTag}\n              onFocusLost={this.handleAddTag}\n              onCancel={this.handleCancel}\n              onChipRemoved={this.handleRemoveTag}\n              filterFunc={this.handleTagInput} />\n          }</FormattedMessage>\n          {this.props.onSubmit || this.props.onCancel ?\n            <div id=\"tag-manager-buttons\" className=\"dialog-buttons panel-form-row\">\n              <button className=\"outline\" onClick={this.handleCancel}>\n                <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\n              </button>\n              <button className=\"primary\" onClick={this.handleSubmit}>\n                <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\" description=\"Button [OK]\" />\n              </button>\n            </div>\n          : null}\n        </div>\n        :\n        <div className=\"quoted\">\n          <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.setState({activated: true});}}>\n            <i className=\"material-icons\">edit</i> &nbsp;<FormattedMessage id=\"title_manage_tags\" defaultMessage=\"Manage\"\n              description=\"Section title for the list of tags\" />\n          </a>\n          <>{tags}</>\n        </div>\n      }\n      </div>\n    );\n  }\n};\n","// Widget for editing topic description.\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport AvatarCrop from './avatar-crop.jsx';\nimport AvatarUpload from './avatar-upload.jsx';\nimport InPlaceEdit from './in-place-edit.jsx';\nimport TagManager from './tag-manager.jsx';\n\nimport { AVATAR_SIZE, MAX_AVATAR_BYTES, MAX_EXTERN_ATTACHMENT_SIZE, MAX_TITLE_LENGTH,\n  MAX_TOPIC_DESCRIPTION_LENGTH } from '../config.js';\nimport { imageScaled, blobToBase64, makeImageUrl } from '../lib/blob-helpers.js';\nimport { arrayEqual, theCard } from '../lib/utils.js';\n\nexport default class TopicDescEdit extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    const acs = topic.getAccessMode();\n    this.state = {\n      isMe: Tinode.isMeTopicName(this.props.topic),\n      owner: acs && acs.isOwner(),\n      fullName: topic.public ? topic.public.fn : undefined,\n      private: topic.private ? topic.private.comment : null,\n      description: topic.public ? topic.public.note : undefined,\n      avatar: makeImageUrl(topic.public ? topic.public.photo : null),\n      tags: topic.tags() || [],\n      newAvatar: null,\n      newAvatarMime: null\n    };\n\n    this.previousOnTags = null;\n\n    this.tnNewTags = this.tnNewTags.bind(this);\n    this.handleFullNameUpdate = this.handleFullNameUpdate.bind(this);\n    this.handleImageUpdated = this.handleImageUpdated.bind(this);\n    this.handleAvatarCropped = this.handleAvatarCropped.bind(this);\n    this.handlePrivateUpdate = this.handlePrivateUpdate.bind(this);\n    this.handleDescriptionUpdate = this.handleDescriptionUpdate.bind(this);\n    this.uploadAvatar = this.uploadAvatar.bind(this);\n    this.handleAvatarCropCancel = this.handleAvatarCropCancel.bind(this);\n    this.handleTagsUpdated = this.handleTagsUpdated.bind(this);\n  }\n\n  componentDidMount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    this.previousOnTags = topic.onTagsUpdated;\n    topic.onTagsUpdated = this.tnNewTags;\n  }\n\n  componentWillUnmount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    topic.onTagsUpdated = this.previousOnTags;\n  }\n\n  tnNewTags(tags) {\n    this.setState({tags: tags});\n  }\n\n  handleFullNameUpdate(fn) {\n    fn = fn.trim().substring(0, MAX_TITLE_LENGTH);\n    if (fn && this.state.fullName !== fn) {\n      this.setState({fullName: fn});\n      this.props.onUpdateTopicDesc(this.props.topic, theCard(fn, null));\n    }\n  }\n\n  handlePrivateUpdate(comment) {\n    comment = comment.trim().substring(0, MAX_TITLE_LENGTH);\n    if (this.state.private !== comment) {\n      this.setState({private: comment});\n      this.props.onUpdateTopicDesc(this.props.topic, null, comment || Tinode.DEL_CHAR);\n    }\n  }\n\n  handleDescriptionUpdate(desc) {\n    desc = desc.trim().substring(0, MAX_TOPIC_DESCRIPTION_LENGTH);\n    if (desc) {\n      this.setState({description: desc});\n      this.props.onUpdateTopicDesc(this.props.topic, theCard(null, null, null, desc));\n    }\n  }\n\n  // AvatarUpload widget has changed the avatar: received a new file or deleted the avatar.\n  handleImageUpdated(mime, img) {\n    // This will show the AvatarCropView is img is not null.\n    this.setState({newAvatar: img, newAvatarMime: mime});\n    if (!img) {\n      // Deleting the avatar.\n      this.setState({avatar: null});\n      this.props.onUpdateTopicDesc(this.props.topic, theCard(null, Tinode.DEL_CHAR));\n    }\n  }\n\n  // AvatarCropView calls this method when the user has cropped the image.\n  handleAvatarCropped(mime, blob, width, height) {\n    const url = blob ? URL.createObjectURL(blob) : null;\n    this.setState({avatar: url, newAvatar: null, newAvatarMime: null});\n    if (blob) {\n      this.uploadAvatar(mime, blob, width, height);\n    }\n  }\n\n  // Utility method for converting cropped avatar blob to bytes for sending inband or\n  // for uploading it to the server out of band.\n  uploadAvatar(mime, blob, width, height) {\n    const readyToUpload = (image) => {\n      let {mime, blob} = image;\n      if (blob.size > MAX_AVATAR_BYTES) {\n        // Too large to send inband - uploading out of band and sending as a link.\n        const uploader = this.props.tinode.getLargeFileHelper();\n\n        this.setState({uploading: true});\n        uploader.upload(blob)\n          .then((url) => {\n            this.props.onUpdateTopicDesc(this.props.topic, theCard(null, url));\n          })\n          .catch((err) => {\n            this.props.onError(err, 'err');\n          })\n          .finally(() => {\n            this.setState({uploading: false});\n          });\n      } else {\n        this.setState({uploading: true});\n        // Convert blob to base64-encoded bits.\n        blobToBase64(blob)\n          .then(b64 => {\n            const du = makeImageUrl({data: b64.bits, type: mime});\n            this.setState({source: du});\n            this.props.onUpdateTopicDesc(this.props.topic, theCard(null, du));\n            this.setState({uploading: false});\n          });\n      }\n    };\n\n    if (width > AVATAR_SIZE || height > AVATAR_SIZE || width != height) {\n      // Avatar is not square or too large even after cropping. Shrink it and make square.\n      imageScaled(blob, AVATAR_SIZE, AVATAR_SIZE, MAX_EXTERN_ATTACHMENT_SIZE, true)\n        .then(scaled => readyToUpload(scaled))\n        .catch(err => this.props.onError(err, 'err'));\n    } else {\n      readyToUpload({mime: mime, blob: blob, width: width, height: height});\n    }\n  }\n\n  handleAvatarCropCancel(img) {\n    this.setState({newAvatar: null, newAvatarMime: null});\n  }\n\n  handleTagsUpdated(tags) {\n    // Check if tags have actually changed.\n    if (arrayEqual(this.state.tags.slice(0), tags.slice(0))) {\n      return;\n    }\n    this.props.onUpdateTags(tags);\n  }\n\n  render() {\n    if (this.state.newAvatar) {\n      return (\n        <AvatarCrop\n          avatar={this.state.newAvatar}\n          mime={this.state.newAvatarMime}\n          onSubmit={this.handleAvatarCropped}\n          onCancel={this.handleAvatarCropCancel}\n          onError={this.props.onError} />\n      );\n    }\n\n    const editable = this.state.isMe || this.state.owner;\n\n    return (\n      <>\n      <div className=\"panel-form-column\">\n        <center>\n          <AvatarUpload\n            tinode={this.props.tinode}\n            avatar={this.state.avatar}\n            readOnly={!editable}\n            uid={this.props.topic}\n            title={this.state.fullName}\n            onImageUpdated={this.handleImageUpdated}\n            onError={this.props.onError} />\n        </center>\n        {this.state.isMe ?\n          <div className=\"group\">\n            <label className=\"small\">\n              <FormattedMessage id=\"label_your_name\" defaultMessage=\"Your name\"\n              description=\"Label for full name editing\" />\n            </label>\n            <div>\n              <FormattedMessage id=\"full_name_prompt\" defaultMessage=\"Full name, e.g. John Doe\"\n                description=\"Input placeholder for person's full name\">{\n                (full_name_placeholder) => <InPlaceEdit\n                  placeholder={full_name_placeholder}\n                  value={this.state.fullName}\n                  required={true}\n                  onFinished={this.handleFullNameUpdate} />\n              }</FormattedMessage>\n            </div>\n          </div>\n        :\n          <>\n            <div className=\"group\">\n              <div><label className=\"small\">\n                <FormattedMessage id=\"label_topic_name\" defaultMessage=\"Name\"\n                  description=\"Label for editing topic name\" />\n              </label></div>\n              <div>\n                <FormattedMessage id=\"topic_name_editing_placeholder\" defaultMessage=\"Freeform name of the group\"\n                  description=\"Prompt for entering topic name\">{\n                  (group_name_placeholder) => <InPlaceEdit\n                    placeholder={group_name_placeholder}\n                    readOnly={!editable}\n                    value={this.state.fullName}\n                    required={true}\n                    onFinished={this.handleFullNameUpdate} />\n                }</FormattedMessage>\n              </div>\n            </div>\n            <div className=\"group\">\n              <div>\n                <label className=\"small\">\n                  <FormattedMessage id=\"label_private\" defaultMessage=\"Private comment\"\n                    description=\"Label for editing 'private'\" />\n                </label>\n              </div>\n              <div>\n                <FormattedMessage id=\"private_editing_placeholder\" defaultMessage=\"Visible to you only\"\n                  description=\"Placeholder for editing 'private'\">{\n                  (private_placeholder) => <InPlaceEdit\n                    placeholder={private_placeholder}\n                    value={this.state.private}\n                    onFinished={this.handlePrivateUpdate} />\n                }</FormattedMessage>\n              </div>\n            </div>\n          </>\n        }\n        {editable || this.state.description ?\n          <div className=\"group\">\n            <div><label className=\"small\">\n              <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\n                description=\"Label for editing topic description\" />\n            </label></div>\n            <div>\n              <FormattedMessage id=\"description_editing_placeholder\"\n                defaultMessage=\"Description (optional)\"\n                description=\"Placeholder for editing topic description\">{\n                (private_placeholder) => <InPlaceEdit\n                  placeholder={private_placeholder}\n                  readOnly={!editable}\n                  value={this.state.description}\n                  multiline={2}\n                  onFinished={this.handleDescriptionUpdate} />\n              }</FormattedMessage>\n            </div>\n          </div>\n          : null\n        }\n      </div>\n      {editable ?\n        <>\n          <div className=\"hr\" />\n          <FormattedMessage id=\"title_tag_manager\" defaultMessage=\"Tags (search & discovery)\"\n            description=\"Section title for TagManager\">{\n              (title_tag_manager) => <TagManager\n                tinode={this.props.tinode}\n                title={title_tag_manager}\n                activated={false}\n                tags={this.state.tags}\n                onSubmit={this.handleTagsUpdated} />\n          }</FormattedMessage>\n        </>\n        : null\n      }\n      </>\n    );\n  }\n};\n","// View for editing topic (including 'me' topic) parameters.\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\nimport TopicDescEdit from '../widgets/topic-desc-edit.jsx';\n\nimport { arrayEqual, asEmail, asPhone } from '../lib/utils.js';\n\nexport default class TopicCommon extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    const acs = topic.getAccessMode();\n    this.state = {\n      isMe: this.props.topic == 'me',\n      owner: acs && acs.isOwner(),\n      credentials: (topic.getCredentials ? topic.getCredentials() : null) || [],\n      addCredActive: false,\n      addCredInvalid: false,\n      newCred: '',\n      tags: []\n    };\n\n    this.previousTagsUpdated = undefined;\n\n    this.onTagsUpdated = this.onTagsUpdated.bind(this);\n    this.handleTagsUpdated = this.handleTagsUpdated.bind(this);\n    this.tnCredsUpdated = this.tnCredsUpdated.bind(this);\n    this.handleCredChange = this.handleCredChange.bind(this);\n    this.handleCredKeyDown = this.handleCredKeyDown.bind(this);\n    this.handleCredEntered = this.handleCredEntered.bind(this);\n  }\n\n  // No need to separately handle component mount.\n  componentDidUpdate(props) {\n    const topic = this.props.tinode.getTopic(props.topic);\n    if (!topic) {\n      return;\n    }\n\n    topic.onCredsUpdated = this.tnCredsUpdated;\n\n    if (topic.onTagsUpdated != this.onTagsUpdated) {\n      if (topic.getType() == 'grp') {\n        this.previousTagsUpdated = topic.onTagsUpdated;\n        topic.onTagsUpdated = this.onTagsUpdated;\n      } else {\n        this.previousTagsUpdated = undefined;\n      }\n    }\n\n    if (this.state.topic != props.topic) {\n      this.setState({topic: props.topic});\n    }\n  }\n\n  componentWillUnmount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    topic.onCredsUpdated = undefined;\n    topic.onTagsUpdated = this.previousTagsUpdated;\n  }\n\n  tnCredsUpdated(creds) {\n    this.setState({credentials: creds || []});\n  }\n\n  handleCredChange(e) {\n    this.setState({newCred: e.target.value, addCredInvalid: false});\n  }\n\n  handleCredKeyDown(e) {\n    if (e.keyCode === 27) {\n      // Escape pressed\n      this.setState({newCred: '', addCredActive: false});\n    } else if (e.keyCode === 13) {\n      // Enter pressed\n      this.handleCredEntered(e);\n    }\n  }\n\n  handleCredEntered(e) {\n    const value = this.state.newCred.trim();\n    if (!value) {\n      this.setState({addCredActive: false, addCredInvalid: false});\n      return;\n    }\n\n    let val = asPhone(value);\n    let method;\n    if (val) {\n      method = 'tel';\n    } else {\n      val = asEmail(value);\n      if (val) {\n        method = 'email';\n      }\n    }\n    if (method) {\n      this.props.onCredAdd(method, val);\n      this.setState({addCredActive: false, newCred: ''});\n    } else {\n      this.setState({addCredInvalid: true});\n    }\n  }\n\n  // Server informs that the tags have been updated.\n  onTagsUpdated(tags) {\n    this.setState({tags: tags});\n\n    if (this.previousTagsUpdated && this.previousTagsUpdated != this.onTagsUpdated) {\n      this.previousTagsUpdated(tags);\n    }\n  }\n\n  // Request server to change tags.\n  handleTagsUpdated(tags) {\n    if (!arrayEqual(this.state.tags.slice(0), tags.slice(0))) {\n      this.props.onTopicTagsUpdateRequest(this.props.topic, tags);\n    }\n  }\n\n  render() {\n    const credentials = [];\n    if (this.state.isMe) {\n      this.state.credentials.map((cred) => {\n        credentials.push(\n          <div key={cred.meth + \":\" + cred.val + \":\" + cred.done}>{cred.meth}: <tt>{cred.val}</tt>\n            <span> {!cred.done ?\n              <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCredConfirm(cred.meth, cred.val);}}>\n                <FormattedMessage id=\"validate_credential_action\" defaultMessage=\"confirm\"\n                  description=\"Validate credentail call to action\" />\n              </a>\n            : null} <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCredDelete(cred.meth, cred.val);}}><i\n              className=\"material-icons gray\">delete_outline</i></a></span>\n          </div>\n        );\n      });\n    }\n\n    return (\n      <div className=\"scrollable-panel\">\n        <TopicDescEdit\n          tinode={this.props.tinode}\n          topic={this.props.topic}\n          onUpdateTopicDesc={this.props.onUpdateTopicDesc}\n          onUpdateTags={this.handleTagsUpdated}\n          onError={this.props.onError} />\n        {this.state.isMe ?\n          <>\n            <div className=\"hr\" />\n            <div className=\"panel-form-column\">\n              <label className=\"small\">\n                <FormattedMessage id=\"label_user_contacts\" defaultMessage=\"Contacts:\"\n                description=\"Label for user contacts\" />\n              </label>\n              <div className=\"quoted\">\n                {credentials}\n                {this.state.addCredActive ?\n                  <input type=\"text\" value={this.state.value}\n                    className={this.state.addCredInvalid ? 'invalid' : null}\n                    placeholder=\"Phone number or email\" required=\"required\" autoFocus\n                    onChange={this.handleCredChange} onKeyDown={this.handleCredKeyDown} onBlur={this.handleCredEntered} />\n                  : null}\n                <div>\n                  <a href=\"#\" onClick={(e) => {e.preventDefault(); this.setState({addCredActive: true});}}>\n                    <i className=\"material-icons\">add</i>\n                    <FormattedMessage id=\"button_add_another\" defaultMessage=\"Add another\" description=\"Call to action [+ add another]\" />\n                  </a></div>\n              </div>\n            </div>\n          </>\n        : null\n      }\n      </div>\n    );\n  }\n};\n","// Edit account parameters.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport InPlaceEdit from './in-place-edit.jsx';\n\nimport { NO_ACCESS_MODE } from '../config.js';\n\nconst messages = defineMessages({\n  clear_messages: {\n    id: 'action_clear_messages',\n    defaultMessage: 'Clear Messages',\n    description: 'Flat button [Clear Messages] (soft-delete messages)'\n  },\n  clear_messages_warning: {\n    id: 'clear_messages_warning',\n    defaultMessage: 'Are you sure you want to clear all messages? It cannot be undone.',\n    description: 'Alert dialog warning when deleting all messages.'\n  },\n  delete_messages: {\n    id: 'action_delete_messages',\n    defaultMessage: 'Clear Messages for All',\n    description: 'Flat button [Clear for All] (hard-delete all messages)'\n  },\n  delete_messages_warning: {\n    id: 'delete_messages_warning',\n    defaultMessage: 'Are you sure you want to delete all messages for everyone? It cannot be undone.',\n    description: 'Alert dialog warning when hard-deleting all messages.'\n  },\n  topic_delete: {\n    id: 'topic_delete',\n    defaultMessage: 'Delete Conversation',\n    description: 'Alert title when deleting the topic.'\n  },\n  topic_delete_warning: {\n    id: 'topic_delete_warning',\n    defaultMessage: 'Are you sure you want to delete this conversation? It cannot be undone.',\n    description: 'Alert warning when deleting entire topic'\n  },\n  leave_chat: {\n    id: 'action_leave_chat',\n    defaultMessage: 'Leave Conversation',\n    description: 'Flat button [Leave Conversation]'\n  },\n  leave_chat_warning: {\n    id: 'leave_chat_warning',\n    defaultMessage: 'Are you sure you want to leave this conversation?',\n    description: 'Alert dialog warning when unsubscribing from a chat.'\n  },\n  block_contact: {\n    id: 'action_block_contact',\n    defaultMessage: \"Block Contact\",\n    description: \"Flat button [Block Contact]\"\n  },\n  block_contact_warning: {\n    id: 'block_contact_warning',\n    defaultMessage: 'Are you sure you want to block this contact?',\n    description: 'Alert dialog warning when blocking a contact.'\n  },\n  report_chat: {\n    id: 'action_report_chat',\n    defaultMessage: 'Report Conversation',\n    description: 'Flat button [Report Group]'\n  },\n  report_chat_warning: {\n    id: 'report_chat_warning',\n    defaultMessage: 'Are you sure you want to block and report this conversation?',\n    description: 'Alert dialog warning when reporting a conversation for abuse'\n  },\n  other_user: {\n    id: 'label_other_user',\n    defaultMessage: 'Other',\n    description: 'Label for the other user when the user is unnamed'\n  },\n});\n\nclass TopicSecurity extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleDeleteTopic = this.handleDeleteTopic.bind(this);\n    this.handleDeleteMessages = this.handleDeleteMessages.bind(this);\n    this.handleLeave = this.handleLeave.bind(this);\n    this.handleBlock = this.handleBlock.bind(this);\n    this.handleReport = this.handleReport.bind(this);\n  }\n\n  handleDeleteTopic(e) {\n    e.preventDefault();\n    const {formatMessage} = this.props.intl;\n    this.props.onShowAlert(\n      formatMessage(messages.topic_delete), // title\n      formatMessage(messages.topic_delete_warning), // content\n      (() => { this.props.onDeleteTopic(this.props.topic); }), // onConfirm\n      null, // \"OK\"\n      true, // Show Reject button\n      null  // \"Cancel\"\n    );\n  }\n\n  handleDeleteMessages(e) {\n    e.preventDefault();\n    const {formatMessage} = this.props.intl;\n    this.props.onShowAlert(\n      formatMessage(this.props.deleter ? messages.delete_messages : messages.clear_messages), // title\n      formatMessage(this.props.deleter ? messages.delete_messages_warning : messages.clear_messages_warning), // content\n      (() => { this.props.onDeleteMessages(this.props.topic); }), // onConfirm\n      null, // \"OK\"\n      true, // Show Reject button\n      null  // \"Cancel\"\n    );\n  }\n\n  handleLeave(e) {\n    e.preventDefault();\n    const {formatMessage} = this.props.intl;\n    this.props.onShowAlert(\n      formatMessage(messages.leave_chat), // title\n      formatMessage(messages.leave_chat_warning), // content\n      (() => { this.props.onLeaveTopic(this.props.topic); }), // onConfirm\n      null, // \"OK\"\n      true, // Show Reject button\n      null  // \"Cancel\"\n    );\n  }\n\n  handleBlock(e) {\n    e.preventDefault();\n    const {formatMessage} = this.props.intl;\n    this.props.onShowAlert(\n      formatMessage(messages.block_contact), // title\n      formatMessage(messages.block_contact_warning), // content\n      (() => { this.props.onBlockTopic(this.props.topic); }), // onConfirm\n      null, // \"OK\"\n      true, // Show Reject button\n      null  // \"Cancel\"\n    );\n  }\n\n  handleReport(e) {\n    e.preventDefault();\n    const {formatMessage} = this.props.intl;\n    this.props.onShowAlert(\n      formatMessage(messages.report_chat), // title\n      formatMessage(messages.report_chat_warning), // content\n      (_ => { this.props.onReportTopic(this.props.topic); }), // onConfirm\n      null, // \"OK\"\n      true, // Show Reject button\n      null  // \"Cancel\"\n    );\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    return (\n      <div className=\"scrollable-panel\">\n        <div className=\"panel-form-column\">\n          {!this.props.channel ?\n            <a href=\"#\" className=\"flat-button\" onClick={this.handleDeleteMessages}>\n              <i className=\"material-icons\">delete_outline</i> &nbsp;{\n                formatMessage(this.props.deleter ? messages.delete_messages : messages.clear_messages)\n              }\n            </a>\n            :\n            null\n          }\n          {this.props.owner ?\n            <a href=\"#\" className=\"danger flat-button\" onClick={this.handleDeleteTopic}>\n              <i className=\"material-icons\">delete</i> &nbsp;{formatMessage(messages.topic_delete)}\n            </a>\n            :\n            <a href=\"#\" className=\"danger flat-button\" onClick={this.handleLeave}>\n              <i className=\"material-icons\">exit_to_app</i> &nbsp;{formatMessage(messages.leave_chat)}\n            </a>\n          }\n          {!this.props.groupTopic ?\n            <a href=\"#\" className=\"danger flat-button\" onClick={this.handleBlock}>\n              <i className=\"material-icons\">block</i> &nbsp;{formatMessage(messages.block_contact)}\n            </a>\n            :\n            null\n          }\n          {!this.props.owner ?\n            <a href=\"#\" className=\"danger flat-button\" onClick={this.handleReport}>\n              <i className=\"material-icons\">report</i> &nbsp;{formatMessage(messages.report_chat)}\n            </a>\n            :\n            null\n          }\n        </div>\n        <div className=\"hr\" />\n        <div className=\"panel-form-column\">\n          {this.props.groupTopic ?\n            <>\n              <div className=\"group\">\n                <label>\n                  <FormattedMessage id=\"label_your_permissions\" defaultMessage=\"Your permissions:\"\n                    description=\"Label for current user permissions\" />\n                </label> <tt className=\"clickable\"\n                  onClick={(e) => {e.preventDefault(); this.props.onLaunchPermissionsEditor('want')}}>\n                  {this.props.access}\n                </tt>\n              </div>\n              {!this.props.channel ?\n                <div className=\"group\">\n                  <div>\n                    <label className=\"small\">\n                      <FormattedMessage id=\"label_default_access_mode\" defaultMessage=\"Default access mode:\"\n                      description=\"Label for default access mode\" />\n                    </label>\n                  </div>\n                  <div className=\"quoted\">\n                    <div>Auth: <tt className={this.props.owner ? 'clickable' : null}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        if (this.props.owner) {\n                          this.props.onLaunchPermissionsEditor('auth');\n                        }\n                      }}>{this.props.auth}</tt>\n                    </div>\n                    <div>Anon: <tt className={this.props.owner ? 'clickable' : null}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        if (this.props.owner) {\n                          this.props.onLaunchPermissionsEditor('anon');\n                        }\n                      }}>{this.props.anon}</tt>\n                    </div>\n                  </div>\n                </div>\n              :\n                null\n              }\n            </>\n            :\n            <div className=\"group\">\n              <div>\n                <label className=\"small\">\n                  <FormattedMessage id=\"label_permissions\" defaultMessage=\"Permissions:\"\n                    description=\"Section title\" />\n                </label>\n              </div>\n              <div className=\"quoted\">\n                <div>\n                  <FormattedMessage id=\"label_you\" defaultMessage=\"You:\"\n                    description=\"Label for the current user\" /> <tt className=\"clickable\"\n                    onClick={(e) => {e.preventDefault(); this.props.onLaunchPermissionsEditor('want')}}>\n                    {this.props.access}\n                  </tt>\n                </div>\n                <div>{this.props.fullName ? this.props.fullName : formatMessage(messages.other_user)}:\n                  &nbsp;<tt className=\"clickable\"\n                    onClick={(e) => {e.preventDefault(); this.props.onLaunchPermissionsEditor('given')}}>\n                    {this.props.modeGiven2}\n                  </tt>\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(TopicSecurity);\n","// InfoView: panel with topic/user info.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\nimport BadgeList from '../widgets/badge-list.jsx';\nimport CheckBox from '../widgets/checkbox.jsx';\nimport ContactList from '../widgets/contact-list.jsx';\nimport ErrorPanel from '../widgets/error-panel.jsx';\nimport GroupManager from '../widgets/group-manager.jsx';\nimport MenuCancel from '../widgets/menu-cancel.jsx';\nimport PermissionsEditor from '../widgets/permissions-editor.jsx';\nimport TopicCommon from '../widgets/topic-common.jsx';\nimport TopicSecurity from '../widgets/topic-security.jsx';\n\nimport { MAX_TITLE_LENGTH, MAX_TOPIC_DESCRIPTION_LENGTH, NO_ACCESS_MODE } from '../config.js';\n\nimport { makeImageUrl } from '../lib/blob-helpers.js';\nimport { theCard, clipStr } from '../lib/utils.js';\n\nconst messages = defineMessages({\n  info: {\n    id: 'panel_title_info',\n    description: 'Title for InfoView',\n    defaultMessage: 'Info'\n  },\n  general: {\n    id: 'panel_title_general',\n    description: 'Title for TopicCommon.',\n    defaultMessage: 'General'\n  },\n  security: {\n    id: 'panel_title_security',\n    description: 'Title for TopicSecirity and AccSecurity.',\n    defaultMessage: 'Security'\n  },\n  members: {\n    id: 'panel_title_members',\n    description: 'Title for managing group members view.',\n    defaultMessage: 'Members'\n  },\n  crop: {\n    id: 'panel_title_crop',\n    description: 'Title for AvatarCropView.',\n    defaultMessage: 'Drag to Adjust'\n  },\n  perm_want: {\n    id: 'requested_permissions',\n    defaultMessage: 'Requested',\n    description: 'Title for permissions'\n  },\n  perm_given: {\n    id: 'granted_permissions',\n    defaultMessage: 'Granted',\n    description: 'Title for permissions'\n  },\n  perm_auth: {\n    id: 'permissions_authenticated',\n    defaultMessage: 'Authenticated',\n    description: 'Title for editing default authenticated permissions'\n  },\n  perm_anon: {\n    id: 'permissions_anonymous',\n    defaultMessage: 'Anonymous',\n    description: 'Title for editing default anonymous permissions'\n  },\n  perm_user: {\n    id: 'permissions_user',\n    defaultMessage: 'User\\'s Permissions',\n    description: 'Title for editing user\\'s permissions'\n  },\n  edit_permissions: {\n    id: 'menu_item_edit_permissions',\n    defaultMessage: 'Edit permissions',\n    description: 'Menu item [Edit permissions]'\n  },\n});\n\nclass InfoView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      topic: null,\n      owner: false,\n      admin: false,\n      sharer: false,\n      deleter: false,\n      muted: false,\n      address: null,\n      groupTopic: undefined,\n      channel: undefined,\n      fullName: undefined,\n      description: undefined,\n      avatar: null,\n      private: null,\n      selectedContact: null,\n      access: null,\n      modeGiven: null,\n      modeWant: null,\n      modeGiven2: null, // P2P topic, the other user mode given\n      modeWant2: null,  // P2P topic, the other user mode want\n      auth: null,\n      anon: null,\n      contactList: [],\n      trustedBadges: [],\n      previousMetaDesc: undefined,\n      previousSubsUpdated: undefined,\n    };\n\n    this.resetSubs = this.resetSubs.bind(this);\n    this.resetDesc = this.resetDesc.bind(this);\n    this.resetTags = this.resetTags.bind(this);\n    this.onMetaDesc = this.onMetaDesc.bind(this);\n    this.onSubsUpdated = this.onSubsUpdated.bind(this);\n    this.handleImageChanged = this.handleImageChanged.bind(this);\n    this.handleMuted = this.handleMuted.bind(this);\n    this.handleUnarchive = this.handleUnarchive.bind(this);\n    this.handlePermissionsChanged = this.handlePermissionsChanged.bind(this);\n    this.handleLaunchPermissionsEditor = this.handleLaunchPermissionsEditor.bind(this);\n    this.handleShowAddMembers = this.handleShowAddMembers.bind(this);\n    this.handleMemberUpdateRequest = this.handleMemberUpdateRequest.bind(this);\n    this.handleMemberSelected = this.handleMemberSelected.bind(this);\n    this.handleContextMenu = this.handleContextMenu.bind(this);\n    this.handleBackNavigate = this.handleBackNavigate.bind(this);\n  }\n\n  // No need to separately handle component mount.\n  componentDidUpdate(props) {\n    const topic = this.props.tinode.getTopic(props.topic);\n    if (!topic) {\n      return;\n    }\n\n    if (this.onMetaDesc != topic.onMetaDesc) {\n      this.previousMetaDesc = topic.onMetaDesc;\n      topic.onMetaDesc = this.onMetaDesc;\n\n      this.previousSubsUpdated = topic.onSubsUpdated;\n      topic.onSubsUpdated = this.onSubsUpdated;\n    }\n\n    if (this.state.topic != props.topic) {\n      this.setState({topic: props.topic});\n      this.resetDesc(topic, props);\n      this.resetSubs(topic, props);\n      this.resetTags(topic);\n    }\n  }\n\n  componentWillUnmount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    this.setState({topic: null});\n    topic.onMetaDesc = this.previousMetaDesc;\n    topic.onSubsUpdated = this.previousSubsUpdated;\n  }\n\n  resetSubs(topic, props) {\n    const newState = {contactList: []};\n    if (topic.getType() == 'p2p') {\n      // Fetch the other party in the p2p conversation.\n      // Topic may not be ready yet, so check if user is found.\n      const user2 = topic.subscriber(props.topic);\n      if (user2) {\n        newState.modeGiven2 = user2.acs.getGiven();\n        newState.modeWant2 = user2.acs.getWant();\n      } else {\n        newState.modeGiven2 = NO_ACCESS_MODE;\n        newState.modeWant2 = NO_ACCESS_MODE;\n      }\n    } else {\n      topic.subscribers((sub) => {\n        newState.contactList.push(sub);\n      }, this);\n    }\n\n    this.setState(newState);\n  }\n\n  resetDesc(topic, props) {\n    const defacs = topic.getDefaultAccess() || {};\n    const acs = topic.getAccessMode();\n\n    const badges = [];\n    if (topic.trusted) {\n      for (const [key, val] of Object.entries(topic.trusted)) {\n        if (val) {\n          badges.push(key);\n        }\n      }\n    }\n\n    this.setState({\n      owner: acs && acs.isOwner(),\n      admin: acs && acs.isAdmin(),\n      sharer: acs && acs.isSharer(),\n      deleter: acs && acs.isDeleter(),\n      muted: acs && acs.isMuted(),\n\n      fullName: clipStr(topic.public ? topic.public.fn : undefined, MAX_TITLE_LENGTH),\n      description: clipStr(topic.public ? topic.public.note : undefined, MAX_TOPIC_DESCRIPTION_LENGTH),\n      avatar: makeImageUrl(topic.public ? topic.public.photo : null),\n      trustedBadges: badges,\n      private: clipStr(topic.private ? topic.private.comment : null, MAX_TITLE_LENGTH),\n      archived: topic.isArchived(),\n      address: topic.name,\n      groupTopic: topic.isGroupType(),\n      channel: topic.isChannelType() || topic.chan,\n      access: acs ? acs.getMode() : undefined,\n      modeGiven: acs ? acs.getGiven() : undefined,\n      modeWant: acs ? acs.getWant() : undefined,\n      auth: defacs.auth,\n      anon: defacs.anon\n    });\n  }\n\n  resetTags(topic) {\n    if (topic.getType() != 'grp') {\n      return;\n    }\n\n    const acs = topic.getAccessMode();\n    if (acs && acs.isOwner()) {\n      // Requesting tags: owner is editing the topic.\n      topic.getMeta(topic.startMetaQuery().withTags().build());\n    }\n  }\n\n  onMetaDesc(desc) {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    this.resetDesc(topic, this.props);\n\n    if (this.previousMetaDesc && this.previousMetaDesc != this.onMetaDesc) {\n      this.previousMetaDesc(desc);\n    }\n  }\n\n  onSubsUpdated(subs) {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    this.resetSubs(topic, this.props);\n\n    if (this.previousSubsUpdated && this.previousSubsUpdated != this.onSubsUpdated) {\n      this.previousSubsUpdated(subs);\n    }\n  }\n\n  handleImageChanged(img) {\n    this.setState({avatar: img});\n    this.props.onTopicDescUpdate(this.props.topic, theCard(null, img || Tinode.DEL_CHAR), null);\n  }\n\n  handleMuted(ignored, checked) {\n    this.setState({muted: checked});\n    this.props.onChangePermissions(this.props.topic, checked ? '-P' : '+P');\n  }\n\n  handleUnarchive(ignored, ignored2) {\n    this.props.onTopicUnArchive(this.props.topic);\n  }\n\n  handlePermissionsChanged(which, perm) {\n    switch (which) {\n      case 'auth':\n        this.props.onTopicDescUpdateRequest(this.props.topic, null, null, {auth: perm});\n        break;\n      case 'anon':\n        this.props.onTopicDescUpdateRequest(this.props.topic, null, null, {anon: perm});\n        break;\n      case 'mode':\n      case 'want':\n        this.props.onChangePermissions(this.props.topic, perm);\n        break;\n      case 'given':\n        this.props.onChangePermissions(this.props.topic, perm, this.props.topic);\n        break;\n      case 'user':\n        this.props.onChangePermissions(this.props.topic, perm, this.state.userPermissionsEdited);\n        break;\n    }\n\n    this.handleBackNavigate();\n  }\n\n  handleLaunchPermissionsEditor(which, uid) {\n    const {formatMessage} = this.props.intl;\n    let toEdit, toCompare, toSkip, titleEdit, titleCompare, userTitle, userAvatar;\n    switch (which) {\n      case 'mode':\n        toEdit = this.state.access;\n        break;\n      case 'want':\n        toEdit = this.state.modeWant;\n        toCompare = this.state.modeGiven;\n        if (this.state.owner) {\n          // Don't allow owner to unset 'O' permission. All other permissions are OK.\n          toSkip = 'O';\n        } else {\n          // Allow accepting any of 'ASDO' permissions but don't allow asking for them.\n          toSkip = Tinode.AccessMode.encode(Tinode.AccessMode.diff('ASDO', this.state.modeGiven));\n          if (this.state.channel) {\n            // Channels are read-only.\n            toSkip += 'W';\n          }\n        }\n        titleEdit = formatMessage(messages.perm_want);\n        titleCompare = formatMessage(messages.perm_given);\n        break;\n      case 'given':\n        toEdit = this.state.modeGiven2;\n        toCompare = this.state.modeWant2;\n        toSkip = this.state.groupTopic ? (this.state.owner ? '' : 'O') : 'ASDO';\n        titleEdit = formatMessage(messages.perm_given);\n        titleCompare = formatMessage(messages.perm_want);\n        break;\n      case 'auth':\n        toEdit = this.state.auth;\n        toSkip = 'O';\n        break;\n      case 'anon':\n        toEdit = this.state.anon;\n        toSkip = 'O';\n        break;\n      case 'user': {\n        const topic = this.props.tinode.getTopic(this.props.topic);\n        if (!topic) {\n          return;\n        }\n        const user = topic.subscriber(uid);\n        if (!user || !user.acs) {\n          return;\n        }\n        toEdit = user.acs.getGiven();\n        toCompare = user.acs.getWant();\n        toSkip = this.state.owner ? '' : 'O';\n        titleEdit = formatMessage(messages.perm_given);\n        titleCompare = formatMessage(messages.perm_want);\n        if (user.public) {\n          userTitle = user.public.fn;\n          userAvatar = user.public.photo;\n        }\n        break;\n      }\n      default:\n        console.error(\"Unknown permission editing mode '\" + which + \"'\");\n        return;\n    }\n    this.setState({\n      userPermissionsEdited: uid,\n      userPermissionsTitle: userTitle,\n      userPermissionsAvatar: userAvatar,\n      editedPermissions: toEdit,\n      immutablePermissions: toCompare,\n      editedPermissionsTitle: titleEdit,\n      immutablePermissionsTitle: titleCompare,\n      editedPermissionsSkipped: toSkip,\n    });\n    this.props.onNavigate(`perm/${which}`);\n  }\n\n  handleShowAddMembers(e) {\n    e.preventDefault();\n    this.props.onInitFind();\n    this.props.onNavigate('members');\n  }\n\n  handleMemberUpdateRequest(members, added, removed) {\n    this.props.onMemberUpdateRequest(this.props.topic, added, removed);\n    this.props.onNavigate('info');\n  }\n\n  handleMemberSelected(uid) {\n    this.setState({selectedContact: uid});\n  }\n\n  handleBackNavigate() {\n    const args = (this.props.panel || 'info').split('/');\n    if (args[0] == 'info') {\n      this.props.onNavigate(null);\n    } else if (args[0] == 'perm') {\n      if (args[1] == 'user') {\n        this.props.onNavigate('info');\n      } else {\n        this.props.onNavigate('security');\n      }\n    } else {\n      this.props.onNavigate('info');\n    }\n  }\n\n  handleContextMenu(params) {\n    const {formatMessage} = this.props.intl;\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    const user = topic.subscriber(params.topicName);\n    if (!user || !user.acs) {\n      return;\n    }\n\n    const isMe = this.props.tinode.isMe(params.topicName);\n    const menuItems = [\n      {title: formatMessage(messages.edit_permissions), handler: () => {\n        this.handleLaunchPermissionsEditor(isMe ? 'want' : 'user', params.topicName);\n      }}\n    ];\n    if (!isMe) {\n      menuItems.push('member_delete');\n    }\n    menuItems.push(user.acs.isMuted() ? 'member_unmute' : 'member_mute');\n    if (!isMe) {\n      menuItems.push(user.acs.isJoiner() ? 'member_block' : 'member_unblock');\n    }\n    this.props.showContextMenu({\n      topicName: this.props.topic,\n      x: params.x,\n      y: params.y,\n      user: params.topicName}, menuItems);\n  }\n\n  render() {\n    const args = (this.props.panel || 'info').split('/');\n    const view = args[0];\n    args.shift();\n\n    const {formatMessage} = this.props.intl;\n    const panelTitle = formatMessage((view == 'perm' ? messages['perm_' + args[0]] : messages[view])\n      || messages['info']);\n\n    return (\n      <div id=\"info-view\">\n        <div className=\"caption-panel\" id=\"info-caption-panel\">\n          <div className=\"panel-title\" id=\"info-title\">{panelTitle}</div>\n          <div>\n            <MenuCancel onCancel={this.handleBackNavigate} />\n          </div>\n        </div>\n        {this.props.displayMobile ?\n          <ErrorPanel\n            level={this.props.errorLevel}\n            text={this.props.errorText}\n            onClearError={this.props.onError} /> : null}\n        {view == 'members' ?\n          <GroupManager\n            tinode={this.props.tinode}\n            members={this.state.contactList}\n            requiredMember={this.props.myUserId}\n            keepInitialMembers={!this.state.admin && !this.state.owner}\n            myUserId={this.props.myUserId}\n            contacts={this.props.searchableContacts}\n            onCancel={this.handleBackNavigate}\n            onSubmit={this.handleMemberUpdateRequest} />\n          :\n        view == 'perm' && args.length > 0 ?\n          <PermissionsEditor\n            tinode={this.props.tinode}\n            mode={this.state.editedPermissions}\n            compare={this.state.immutablePermissions}\n            skip={this.state.editedPermissionsSkipped}\n            modeTitle={this.state.editedPermissionsTitle}\n            compareTitle={this.state.immutablePermissionsTitle}\n            userTitle={this.state.userPermissionsTitle}\n            item={this.state.userPermissionsEdited}\n            userAvatar={this.state.userPermissionsAvatar}\n            onSubmit={(mode) => this.handlePermissionsChanged(args[0], mode)}\n            onCancel={this.handleBackNavigate} />\n          :\n        view == 'general' ?\n          <TopicCommon\n            tinode={this.props.tinode}\n            topic={this.props.topic}\n            onCredAdd={this.props.onCredAdd}\n            onTopicTagsUpdateRequest={this.props.onTopicTagsUpdateRequest}\n            onCredConfirm={this.props.onCredConfirm}\n            onCredDelete={this.props.onCredDelete}\n            onUpdateTopicDesc={this.props.onTopicDescUpdateRequest}\n            onError={this.props.onError} />\n          :\n        view == 'security' ?\n          <TopicSecurity\n            topic={this.props.topic}\n            owner={this.state.owner}\n            admin={this.state.admin}\n            sharer={this.state.sharer}\n            deleter={this.state.deleter}\n            muted={this.state.muted}\n\n            groupTopic={this.state.groupTopic}\n            channel={this.state.channel}\n            access={this.state.access}\n            modeGiven={this.state.modeGiven}\n            modeWant={this.state.modeWant}\n            modeGiven2={this.state.modeGiven2}\n            modeWant2={this.state.modeWant2}\n            auth={this.state.auth}\n            anon={this.state.anon}\n\n            onShowAlert={this.props.onShowAlert}\n            onDeleteMessages={this.props.onDeleteMessages}\n            onLeaveTopic={this.props.onLeaveTopic}\n            onBlockTopic={this.props.onBlockTopic}\n            onReportTopic={this.props.onReportTopic}\n            onLaunchPermissionsEditor={this.handleLaunchPermissionsEditor}\n            onNavigate={this.props.onNavigate} />\n          :\n          <div id=\"info-view-content\" className=\"scrollable-panel\">\n            <div className=\"panel-form-column\">\n              <a href=\"#\" className=\"flat-button float-right\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('general');}}>\n                <i className=\"material-icons\">edit</i>&nbsp;\n                <FormattedMessage id=\"button_edit\" defaultMessage=\"Edit\" description=\"Call to action [Edit]\" />\n              </a>\n              <center>\n                <AvatarUpload\n                  tinode={this.props.tinode}\n                  avatar={this.state.avatar}\n                  readOnly={true}\n                  uid={this.props.topic}\n                  title={this.state.fullName} />\n              </center>\n              <div className=\"group\">\n                <div><label className=\"small\">\n                  <FormattedMessage id=\"label_topic_name\" defaultMessage=\"Name\"\n                    description=\"Label for editing topic name\" />\n                </label></div>\n                <div className=\"large ellipsized\">{this.state.fullName}\n                {this.state.channel ? <img src=\"/img/channel.png\" className=\"channel\" alt=\"channel\" /> : null}</div>\n              </div>\n              {this.state.private ?\n                <div className=\"group\">\n                  <div><label className=\"small\">\n                    <FormattedMessage id=\"label_private\" defaultMessage=\"Private comment\"\n                      description=\"Label for editing 'private'\" />\n                  </label></div>\n                  <div className=\"large ellipsized\">{this.state.private}</div>\n                </div>\n                : null\n              }\n              <div className=\"group\">\n                <label className=\"small\"><FormattedMessage id=\"label_user_id\" defaultMessage=\"ID:\"\n                  description=\"Label for user address (ID)\" /></label>&nbsp;\n                <tt>{this.state.address}</tt>\n              </div>\n              <div className=\"group\">\n                <BadgeList trustedBadges={this.state.trustedBadges} />\n              </div>\n              {this.state.description ?\n                <div className=\"group\">\n                  <label className=\"small\">\n                    <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\n                      description=\"Label for editing topic description\" />\n                  </label>\n                  <div>{this.state.description}</div>\n                </div> : null}\n            </div>\n            <div className=\"hr\" />\n            <div className=\"panel-form-row\">\n              <label>\n                <FormattedMessage id=\"label_muting_topic\" defaultMessage=\"Muted:\"\n                  description=\"Label for Muting/unmuting the topic\" />\n              </label>\n              <CheckBox name=\"P\" checked={this.state.muted} onChange={this.handleMuted} />\n            </div>\n            {this.state.archived ?\n              <div className=\"panel-form-row\">\n                <label>\n                  <FormattedMessage id=\"label_unarchive_topic\" defaultMessage=\"Archived:\"\n                    description=\"Label for unarchiving the topic\" />\n                </label>\n                <CheckBox name=\"archived\" checked={true} onChange={this.handleUnarchive} />\n              </div>\n              :\n              null\n            }\n            <div className=\"hr\" />\n            <div className=\"panel-form-row\">\n              <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('security');}}>\n                <i className=\"material-icons\">security</i>&nbsp;<FormattedMessage id=\"button_security\"\n                  defaultMessage=\"Security\" description=\"Navigaton button for security panel.\" />\n              </a>\n            </div>\n            {this.state.groupTopic && this.state.sharer ?\n              <>\n                <div className=\"hr\" />\n                <div className=\"panel-form-row\">\n                  <label className=\"small\">\n                    <FormattedMessage id=\"label_group_members\" defaultMessage=\"Group members:\"\n                      description=\"Section title or label\" />\n                  </label>\n                </div>\n                <div className=\"panel-form-row\">\n                  <a href=\"#\" className=\"flat-button\" onClick={this.handleShowAddMembers}>\n                    <i className=\"material-icons\">person_add</i> &nbsp;<FormattedMessage id=\"button_add_members\"\n                      defaultMessage=\"Add members\" description=\"Flat button [Add members] (to topic)\" />\n                  </a>\n                </div>\n                <FormattedMessage id=\"group_has_no_members\" defaultMessage=\"No members\"\n                  description=\"Shown in place of group members\">{\n                  (no_members) => <ContactList\n                    tinode={this.props.tinode}\n                    contacts={this.state.contactList}\n                    myUserId={this.props.myUserId}\n                    emptyListMessage={no_members}\n                    topicSelected={this.state.selectedContact}\n                    showOnline={false}\n                    showUnread={false}\n                    showMode={true}\n                    noScroll={true}\n                    onTopicSelected={this.handleMemberSelected}\n                    showContextMenu={this.state.admin ? this.handleContextMenu : false}\n                  />\n                }</FormattedMessage>\n              </>\n              :\n              null\n            }\n          </div>\n        }\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(InfoView);\n","// IncomingCallView: displays Accept & Reject buttons for incoming calls.\nimport React from 'react';\nimport { FormattedMessage, injectIntl } from 'react-intl';\n\nimport Tinode from 'tinode-sdk';\n\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\nimport BadgeList from '../widgets/badge-list.jsx';\nimport MenuCancel from '../widgets/menu-cancel.jsx';\n\nimport { CALL_STATE_INCOMING_RECEIVED, MAX_TITLE_LENGTH } from '../config.js';\n\nimport { makeImageUrl } from '../lib/blob-helpers.js';\nimport { clipStr } from '../lib/utils.js'\n\nconst RING_SOUND = new Audio(\"audio/phone_ring.mp3\");\n\nclass IncomingCallView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      topic: null,\n      fullName: undefined,\n      avatar: null,\n      trustedBadges: [],\n      previousMetaDesc: undefined,\n    };\n\n    this.resetDesc = this.resetDesc.bind(this);\n    this.onMetaDesc = this.onMetaDesc.bind(this);\n    this.handleRejectCall = this.handleRejectCall.bind(this);\n    this.handleAcceptCall = this.handleAcceptCall.bind(this);\n    this.ringTimer = null;\n  }\n\n  componentDidMount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    this.resetDesc(topic, this.props);\n    if (this.props.callState == CALL_STATE_INCOMING_RECEIVED) {\n      RING_SOUND.play();\n      this.ringTimer = setInterval(() => RING_SOUND.play(), 2000);\n      this.props.onRinging(this.props.topic, this.props.seq);\n    }\n  }\n\n  // No need to separately handle component mount.\n  componentDidUpdate(props) {\n    const topic = this.props.tinode.getTopic(props.topic);\n    if (!topic) {\n      return;\n    }\n\n    if (this.onMetaDesc != topic.onMetaDesc) {\n      this.previousMetaDesc = topic.onMetaDesc;\n      topic.onMetaDesc = this.onMetaDesc;\n    }\n\n    if (this.state.topic != props.topic) {\n      this.setState({topic: props.topic});\n      this.resetDesc(topic, props);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.ringTimer != null) {\n      clearInterval(this.ringTimer);\n      RING_SOUND.pause();\n    }\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    this.setState({topic: null});\n    topic.onMetaDesc = this.previousMetaDesc;\n  }\n\n  resetDesc(topic, props) {\n    const defacs = topic.getDefaultAccess() || {};\n    const acs = topic.getAccessMode();\n    const badges = [];\n    if (topic.trusted) {\n      for (const [key, val] of Object.entries(topic.trusted)) {\n        if (val) {\n          badges.push(key);\n        }\n      }\n    }\n\n    this.setState({\n      fullName: clipStr(topic.public ? topic.public.fn : undefined, MAX_TITLE_LENGTH),\n      avatar: makeImageUrl(topic.public ? topic.public.photo : null),\n      trustedBadges: badges,\n    });\n  }\n\n  onMetaDesc(desc) {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    if (!topic) {\n      return;\n    }\n    this.resetDesc(topic, this.props);\n\n    if (this.previousMetaDesc && this.previousMetaDesc != this.onMetaDesc) {\n      this.previousMetaDesc(desc);\n    }\n  }\n\n  handleAcceptCall() {\n    this.props.onAcceptCall(this.props.topic);\n  }\n\n  handleRejectCall() {\n    this.props.onReject(this.props.topic, this.props.seq);\n    this.props.onClose();\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    let panelTitle = 'Unknown';\n    if (this.props.callState == CALL_STATE_INCOMING_RECEIVED) {\n      panelTitle = <FormattedMessage id=\"calls_incoming_title\"\n          defaultMessage=\"Incoming Call\" description=\"Incoming call title (Incoming call view)\" />;\n    }\n\n    return (\n      <div id=\"info-view\">\n        <div className=\"caption-panel\" id=\"info-caption-panel\">\n          <div className=\"panel-title\" id=\"info-title\">{panelTitle}</div>\n          <div>\n            <MenuCancel onCancel={this.handleRejectCall} />\n          </div>\n        </div>\n        <div id=\"info-view-content\" className=\"scrollable-panel\">\n          <div className=\"panel-form-column\">\n            <center>\n              <AvatarUpload\n                tinode={this.props.tinode}\n                avatar={this.state.avatar}\n                readOnly={true}\n                uid={this.props.topic}\n                title={this.state.fullName} />\n            </center>\n            <div className=\"group incoming-call-title\">\n              <div className=\"large ellipsized\">{clipStr(this.state.fullName)}</div>\n            </div>\n            <div className=\"group incoming-call-badges\">\n              <BadgeList trustedBadges={this.state.trustedBadges} />\n            </div>\n            <div id=\"actions\" className=\"group incoming-call-actions\">\n              {this.props.callState == CALL_STATE_INCOMING_RECEIVED ?\n                <>\n                  <button className=\"video-call-hangup\" onClick={this.handleRejectCall}>\n                    <i className=\"material-icons\">call_end</i>\n                  </button>\n                  <button className=\"video-call-accept\" onClick={this.handleAcceptCall}>\n                    <i className=\"material-icons\">call</i>\n                  </button>\n                </>\n                :\n                null\n              }\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(IncomingCallView);\n","// CallPanel: displays local and remote viewports and controls.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport LetterTile from '../widgets/letter-tile.jsx';\n\nimport { CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS, CALL_WEBRTC_CONFIG,\n         MAX_TITLE_LENGTH } from '../config.js';\n\nimport { clipStr } from '../lib/utils.js'\n\nexport default class CallPanel extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      localStream: undefined,\n      pc: undefined,\n\n      previousOnInfo: undefined\n    };\n\n    this.localStreamConstraints = {\n      audio: true,\n      video: true\n    };\n\n    this.localRef = React.createRef();\n    this.remoteRef = React.createRef();\n\n    this.onInfo = this.onInfo.bind(this);\n    this.start = this.start.bind(this);\n\n    this.createPeerConnection = this.createPeerConnection.bind(this);\n\n    this.handleNegotiationNeededEvent = this.handleNegotiationNeededEvent.bind(this);\n    this.handleICECandidateEvent = this.handleICECandidateEvent.bind(this);\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\n    this.handleICEConnectionStateChangeEvent = this.handleICEConnectionStateChangeEvent.bind(this);\n    this.handleSignalingStateChangeEvent = this.handleSignalingStateChangeEvent.bind(this);\n    this.handleICEGatheringStateChangeEvent = this.handleICEGatheringStateChangeEvent.bind(this);\n    this.handleTrackEvent = this.handleTrackEvent.bind(this);\n\n    this.handleVideoOfferMsg = this.handleVideoOfferMsg.bind(this);\n    this.handleVideoAnswerMsg = this.handleVideoAnswerMsg.bind(this);\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\n\n    this.reportError = this.reportError.bind(this);\n    this.handleGetUserMediaError = this.handleGetUserMediaError.bind(this);\n\n    this.stop = this.stop.bind(this);\n    this.stopTracks = this.stopTracks.bind(this);\n\n    this.handleCloseClick = this.handleCloseClick.bind(this);\n    this.handleToggleCameraClick = this.handleToggleCameraClick.bind(this);\n    this.handleToggleMicClick = this.handleToggleMicClick.bind(this);\n    this.toggleMedia = this.toggleMedia.bind(this);\n\n    this.handleRemoteHangup = this.handleRemoteHangup.bind(this);\n    this.handleVideoCallAccepted = this.handleVideoCallAccepted.bind(this);\n  }\n\n  handleVideoCallAccepted(info) { \n    const pc = this.createPeerConnection();\n    const stream = this.state.localStream;\n    stream.getTracks().forEach(track => {\n      console.log('local stream adding track ', track.id, track.kind, track.readyState);\n      pc.addTrack(track, stream);\n    });\n  }\n\n  onInfo(info) {\n    console.log('info --> ', info);\n    if (info.what != 'call') {\n      return;\n    }\n    switch (info.event) {\n      case 'accept':\n        // Call accepted.\n        this.handleVideoCallAccepted(info);\n        break;\n      case 'offer':\n        this.handleVideoOfferMsg(info);\n        break;\n      case 'answer':\n        this.handleVideoAnswerMsg(info);\n        break;\n      case 'ice-candidate':\n        this.handleNewICECandidateMsg(info);\n        break;\n      case 'hang-up':\n        this.handleRemoteHangup(info);\n        break;\n    }\n  }\n\n  componentDidMount() {\n    const topic = this.props.topic;\n    this.previousOnInfo = topic.onInfo;\n    topic.onInfo = this.onInfo;\n    if ((this.props.callState == CALL_STATE_OUTGOING_INITATED ||\n         this.props.callState == CALL_STATE_IN_PROGRESS) && this.localRef.current) {\n      this.start();\n    }\n  }\n\n  componentWillUnmount() {\n    this.props.topic.onInfo = this.previousOnInfo;\n    console.log('will unmount. stop');\n    this.stop();\n  }\n\n  start() {\n    if (this.state.localStream) {\n      console.log(\"You can't start a call because you already have one open!\");\n    } else {\n      if (this.props.callState == CALL_STATE_IN_PROGRESS) {\n        // We apparently just accepted the call.\n        this.props.onInvite(this.props.topic.name, this.props.seq, this.props.callState);\n        return;\n      }\n      // This is an outgoing call waiting for the other side to pick up.\n      // Start local video.\n      navigator.mediaDevices.getUserMedia(this.localStreamConstraints)\n        .then(stream => {\n          this.setState({localStream: stream});\n          this.localRef.current.srcObject = stream;\n          // Send call invitation.\n          this.props.onInvite(this.props.topic.name, this.props.seq, this.props.callState);\n        })\n        .catch(this.handleGetUserMediaError);\n    }\n  }\n\n  createPeerConnection() {\n    var pc = new RTCPeerConnection(CALL_WEBRTC_CONFIG);\n\n    pc.onicecandidate = this.handleICECandidateEvent;\n    pc.oniceconnectionstatechange = this.handleICEConnectionStateChangeEvent;\n    pc.onicegatheringstatechange = this.handleICEGatheringStateChangeEvent;\n    pc.onsignalingstatechange = this.handleSignalingStateChangeEvent;\n    pc.onnegotiationneeded = this.handleNegotiationNeededEvent;\n    pc.ontrack = this.handleTrackEvent;\n\n    this.setState({pc: pc});\n    console.log('Created RTCPeerConnnection');\n    return pc;\n  }\n\n  handleVideoAnswerMsg(info) {\n    console.log(\"*** Call recipient has accepted our call\");\n\n    // Configure the remote description, which is the SDP payload\n    // in our \"video-answer\" message.\n\n    var desc = new RTCSessionDescription(info.payload);\n    this.state.pc.setRemoteDescription(desc).catch(this.reportError);\n  }\n\n  reportError(errMessage) {\n    console.log(`Error ${errMessage.name}: ${errMessage.message}`);\n  }\n\n  handleNegotiationNeededEvent() {\n    this.state.pc.createOffer().then(offer => {\n      return this.state.pc.setLocalDescription(offer);\n    })\n    .then(() => {\n      this.props.onSendOffer(this.props.topic.name, this.props.seq, this.state.pc.localDescription.toJSON());\n    })\n    .catch(this.reportError);\n  }\n\n  handleICECandidateEvent(event) {\n    if (event.candidate) {\n      this.props.onIceCandidate(this.props.topic.name, this.props.seq, event.candidate.toJSON());\n    }\n  }\n\n  handleNewICECandidateMsg(info) {\n    var candidate = new RTCIceCandidate(info.payload);\n\n    this.state.pc.addIceCandidate(candidate)\n      .catch(this.reportError);\n  }\n\n  handleICEConnectionStateChangeEvent(event) {\n    switch (this.state.pc.iceConnectionState) {\n      case \"closed\":\n      case \"failed\":\n        this.handleCloseClick();\n        break;\n    }\n  }\n\n  handleSignalingStateChangeEvent(event) {\n    switch (this.state.pc.signalingState) {\n      case \"closed\":\n        this.handleCloseClick();\n        break;\n    }\n  }\n\n  handleICEGatheringStateChangeEvent(event) {\n    console.log('ICE gathering change state: ', event);\n  }\n\n  handleTrackEvent(event) {\n    this.remoteRef.current.srcObject = event.streams[0];\n    // Make sure we redraw the UI properly.\n    this.forceUpdate();\n  }\n\n  handleGetUserMediaError(e) {\n    console.log('-->', e);\n    switch(e.name) {\n      case \"NotFoundError\":\n        console.log(\"Unable to open your call because no camera and/or microphone\" +\n              \"were found.\");\n        break;\n      case \"SecurityError\":\n      case \"PermissionDeniedError\":\n        // Do nothing; this is the same as the user canceling the call.\n        break;\n      default:\n        console.log(\"Error opening your camera and/or microphone: \" + e.message);\n        break;\n    }\n\n    // Make sure we shut down our end of the RTCPeerConnection so we're\n    // ready to try again.\n    this.handleCloseClick();\n  }\n\n  handleVideoOfferMsg(info) {\n    var localStream = null;\n\n    const pc = this.createPeerConnection();\n\n    var desc = new RTCSessionDescription(info.payload);\n\n    pc.setRemoteDescription(desc).then(() => {\n      console.log('!!! handleVideoOffer/setRemoteDescription -> getUserMesia');\n      return navigator.mediaDevices.getUserMedia(this.localStreamConstraints);\n    })\n    .then(stream => {\n      localStream = stream;\n      this.localRef.current.srcObject = stream;\n      this.setState({localStream: stream});\n\n      localStream.getTracks().forEach(track => {\n        console.log('local stream A adding track ', track.id, track.kind, track.readyState);\n        pc.addTrack(track, localStream);\n      });\n    })\n    .then(() => {\n      return pc.createAnswer();\n    })\n    .then(answer => {\n      return pc.setLocalDescription(answer);\n    })\n    .then(() => {\n      this.props.onSendAnswer(this.props.topic.name, this.props.seq, pc.localDescription.toJSON());\n    })\n    .catch(this.handleGetUserMediaError);\n  }\n\n  handleRemoteHangup() {\n    this.handleCloseClick();\n  }\n\n  stopTracks(el) {\n    if (el == null) { return; }\n    let stream = el.srcObject;\n    if (stream == null) { return; }\n    let tracks = stream.getTracks();\n\n    if (tracks != null) {\n      tracks.forEach((track) => {\n        track.stop();\n        track.enabled = false;\n        console.log('stopped track ', track.id, track.kind, track.readyState);\n      });\n    }\n    el.srcObject = null;\n    el.src = '';\n  }\n\n  stop() {\n    this.stopTracks(this.localRef.current);\n    this.stopTracks(this.remoteRef.current);\n    if (this.state.pc != null) {\n      this.state.pc.ontrack = null;\n      this.state.pc.onremovetrack = null;\n      this.state.pc.onremovestream = null;\n      this.state.pc.onicecandidate = null;\n      this.state.pc.oniceconnectionstatechange = null;\n      this.state.pc.onsignalingstatechange = null;\n      this.state.pc.onicegatheringstatechange = null;\n      this.state.pc.onnegotiationneeded = null;\n\n      this.state.pc.close();\n    }\n    this.setState({pc: null});\n  }\n\n  handleCloseClick() {\n    this.stop();\n    this.props.onHangup(this.props.topic.name, this.props.seq);\n  }\n\n  // Mute/unmute audio/video (specified by kind).\n  toggleMedia(kind) {\n    const stream = this.state.localStream;\n    stream.getTracks().forEach(track => {\n      if (track.kind != kind) {\n        return;\n      }\n      console.log('local stream: toggling track ', track.id, track.kind, track.readyState);\n      track.enabled = !track.enabled;\n    });\n    // Make sure we redraw the UI properly.\n    this.forceUpdate();\n  }\n\n  handleToggleCameraClick() {\n    this.toggleMedia('video');\n  }\n\n  handleToggleMicClick() {\n    this.toggleMedia('audio');\n  }\n\n  render() {\n    if (!this.props.topic) {\n      return null;\n    }\n\n    const remoteActive = this.remoteRef.current != null && this.remoteRef.current.srcObject != null;\n    const audioIcon = this.state.localStream != null && this.state.localStream.getAudioTracks()[0].enabled ? 'mic' : 'mic_off';\n    const videoIcon = this.state.localStream != null && this.state.localStream.getVideoTracks()[0].enabled ? 'videocam' : 'videocam_off';\n\n    return (\n      <>\n        <div id=\"topic-caption-panel\" className=\"caption-panel\">\n          {this.props.displayMobile ?\n            <a href=\"#\" id=\"hide-message-view\" onClick={(e) => {e.preventDefault(); this.props.onHideMessagesView();}}>\n              <i className=\"material-icons\">arrow_back</i>\n            </a>\n            :\n            null}\n          <div className=\"avatar-box\">\n            <LetterTile\n              tinode={this.props.tinode}\n              avatar={this.props.avatar}\n              topic={this.props.topic}\n              title={this.props.title} />\n          </div>\n          <div id=\"topic-title-group\">\n            <div id=\"topic-title\" className=\"panel-title\">{\n              this.props.title ||\n              <i><FormattedMessage id=\"unnamed_topic\" defaultMessage=\"Unnamed\"\n                description=\"Title shown when the topic has no name\" /></i>\n            }</div>\n          </div>\n        </div>\n        <div id=\"video-container\">\n          <div className=\"video-container-panel\">\n            <div className=\"video-elem\">\n              <video id=\"localVideo\" ref={this.localRef} autoPlay muted playsInline></video>\n              <div className=\"video-title\">\n                <FormattedMessage id=\"calls_you_label\"\n                  defaultMessage=\"You\" description=\"Shown over the local video screen\" />\n              </div>\n            </div>\n            <div className=\"video-elem\">\n              <video id=\"remoteVideo\" ref={this.remoteRef} autoPlay playsInline></video>\n              {remoteActive ?\n                <div className=\"video-title\">{clipStr(this.props.title, MAX_TITLE_LENGTH)}</div>\n                :\n                null}\n            </div>\n          </div>\n          <div id=\"video-container-controls\">\n            <button className=\"video-call-hangup\" onClick={this.handleCloseClick}>\n              <i className=\"material-icons\">call_end</i>\n            </button>\n            <button className=\"video-call-toggle-media\" onClick={this.handleToggleCameraClick}><i className=\"material-icons\">{videoIcon}</i></button>\n            <button className=\"video-call-toggle-media\" onClick={this.handleToggleMicClick}><i className=\"material-icons\">{audioIcon}</i></button>\n          </div>\n          <script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"></script>\n        </div>\n      </>\n    );\n  }\n};\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","export var ErrorKind;\n(function (ErrorKind) {\n    /** Argument is unclosed (e.g. `{0`) */\n    ErrorKind[ErrorKind[\"EXPECT_ARGUMENT_CLOSING_BRACE\"] = 1] = \"EXPECT_ARGUMENT_CLOSING_BRACE\";\n    /** Argument is empty (e.g. `{}`). */\n    ErrorKind[ErrorKind[\"EMPTY_ARGUMENT\"] = 2] = \"EMPTY_ARGUMENT\";\n    /** Argument is malformed (e.g. `{foo!}``) */\n    ErrorKind[ErrorKind[\"MALFORMED_ARGUMENT\"] = 3] = \"MALFORMED_ARGUMENT\";\n    /** Expect an argument type (e.g. `{foo,}`) */\n    ErrorKind[ErrorKind[\"EXPECT_ARGUMENT_TYPE\"] = 4] = \"EXPECT_ARGUMENT_TYPE\";\n    /** Unsupported argument type (e.g. `{foo,foo}`) */\n    ErrorKind[ErrorKind[\"INVALID_ARGUMENT_TYPE\"] = 5] = \"INVALID_ARGUMENT_TYPE\";\n    /** Expect an argument style (e.g. `{foo, number, }`) */\n    ErrorKind[ErrorKind[\"EXPECT_ARGUMENT_STYLE\"] = 6] = \"EXPECT_ARGUMENT_STYLE\";\n    /** The number skeleton is invalid. */\n    ErrorKind[ErrorKind[\"INVALID_NUMBER_SKELETON\"] = 7] = \"INVALID_NUMBER_SKELETON\";\n    /** The date time skeleton is invalid. */\n    ErrorKind[ErrorKind[\"INVALID_DATE_TIME_SKELETON\"] = 8] = \"INVALID_DATE_TIME_SKELETON\";\n    /** Exepct a number skeleton following the `::` (e.g. `{foo, number, ::}`) */\n    ErrorKind[ErrorKind[\"EXPECT_NUMBER_SKELETON\"] = 9] = \"EXPECT_NUMBER_SKELETON\";\n    /** Exepct a date time skeleton following the `::` (e.g. `{foo, date, ::}`) */\n    ErrorKind[ErrorKind[\"EXPECT_DATE_TIME_SKELETON\"] = 10] = \"EXPECT_DATE_TIME_SKELETON\";\n    /** Unmatched apostrophes in the argument style (e.g. `{foo, number, 'test`) */\n    ErrorKind[ErrorKind[\"UNCLOSED_QUOTE_IN_ARGUMENT_STYLE\"] = 11] = \"UNCLOSED_QUOTE_IN_ARGUMENT_STYLE\";\n    /** Missing select argument options (e.g. `{foo, select}`) */\n    ErrorKind[ErrorKind[\"EXPECT_SELECT_ARGUMENT_OPTIONS\"] = 12] = \"EXPECT_SELECT_ARGUMENT_OPTIONS\";\n    /** Expecting an offset value in `plural` or `selectordinal` argument (e.g `{foo, plural, offset}`) */\n    ErrorKind[ErrorKind[\"EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE\"] = 13] = \"EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE\";\n    /** Offset value in `plural` or `selectordinal` is invalid (e.g. `{foo, plural, offset: x}`) */\n    ErrorKind[ErrorKind[\"INVALID_PLURAL_ARGUMENT_OFFSET_VALUE\"] = 14] = \"INVALID_PLURAL_ARGUMENT_OFFSET_VALUE\";\n    /** Expecting a selector in `select` argument (e.g `{foo, select}`) */\n    ErrorKind[ErrorKind[\"EXPECT_SELECT_ARGUMENT_SELECTOR\"] = 15] = \"EXPECT_SELECT_ARGUMENT_SELECTOR\";\n    /** Expecting a selector in `plural` or `selectordinal` argument (e.g `{foo, plural}`) */\n    ErrorKind[ErrorKind[\"EXPECT_PLURAL_ARGUMENT_SELECTOR\"] = 16] = \"EXPECT_PLURAL_ARGUMENT_SELECTOR\";\n    /** Expecting a message fragment after the `select` selector (e.g. `{foo, select, apple}`) */\n    ErrorKind[ErrorKind[\"EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT\"] = 17] = \"EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT\";\n    /**\n     * Expecting a message fragment after the `plural` or `selectordinal` selector\n     * (e.g. `{foo, plural, one}`)\n     */\n    ErrorKind[ErrorKind[\"EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT\"] = 18] = \"EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT\";\n    /** Selector in `plural` or `selectordinal` is malformed (e.g. `{foo, plural, =x {#}}`) */\n    ErrorKind[ErrorKind[\"INVALID_PLURAL_ARGUMENT_SELECTOR\"] = 19] = \"INVALID_PLURAL_ARGUMENT_SELECTOR\";\n    /**\n     * Duplicate selectors in `plural` or `selectordinal` argument.\n     * (e.g. {foo, plural, one {#} one {#}})\n     */\n    ErrorKind[ErrorKind[\"DUPLICATE_PLURAL_ARGUMENT_SELECTOR\"] = 20] = \"DUPLICATE_PLURAL_ARGUMENT_SELECTOR\";\n    /** Duplicate selectors in `select` argument.\n     * (e.g. {foo, select, apple {apple} apple {apple}})\n     */\n    ErrorKind[ErrorKind[\"DUPLICATE_SELECT_ARGUMENT_SELECTOR\"] = 21] = \"DUPLICATE_SELECT_ARGUMENT_SELECTOR\";\n    /** Plural or select argument option must have `other` clause. */\n    ErrorKind[ErrorKind[\"MISSING_OTHER_CLAUSE\"] = 22] = \"MISSING_OTHER_CLAUSE\";\n    /** The tag is malformed. (e.g. `<bold!>foo</bold!>) */\n    ErrorKind[ErrorKind[\"INVALID_TAG\"] = 23] = \"INVALID_TAG\";\n    /** The tag name is invalid. (e.g. `<123>foo</123>`) */\n    ErrorKind[ErrorKind[\"INVALID_TAG_NAME\"] = 25] = \"INVALID_TAG_NAME\";\n    /** The closing tag does not match the opening tag. (e.g. `<bold>foo</italic>`) */\n    ErrorKind[ErrorKind[\"UNMATCHED_CLOSING_TAG\"] = 26] = \"UNMATCHED_CLOSING_TAG\";\n    /** The opening tag has unmatched closing tag. (e.g. `<bold>foo`) */\n    ErrorKind[ErrorKind[\"UNCLOSED_TAG\"] = 27] = \"UNCLOSED_TAG\";\n})(ErrorKind || (ErrorKind = {}));\n","export var TYPE;\n(function (TYPE) {\n    /**\n     * Raw text\n     */\n    TYPE[TYPE[\"literal\"] = 0] = \"literal\";\n    /**\n     * Variable w/o any format, e.g `var` in `this is a {var}`\n     */\n    TYPE[TYPE[\"argument\"] = 1] = \"argument\";\n    /**\n     * Variable w/ number format\n     */\n    TYPE[TYPE[\"number\"] = 2] = \"number\";\n    /**\n     * Variable w/ date format\n     */\n    TYPE[TYPE[\"date\"] = 3] = \"date\";\n    /**\n     * Variable w/ time format\n     */\n    TYPE[TYPE[\"time\"] = 4] = \"time\";\n    /**\n     * Variable w/ select format\n     */\n    TYPE[TYPE[\"select\"] = 5] = \"select\";\n    /**\n     * Variable w/ plural format\n     */\n    TYPE[TYPE[\"plural\"] = 6] = \"plural\";\n    /**\n     * Only possible within plural argument.\n     * This is the `#` symbol that will be substituted with the count.\n     */\n    TYPE[TYPE[\"pound\"] = 7] = \"pound\";\n    /**\n     * XML-like tag\n     */\n    TYPE[TYPE[\"tag\"] = 8] = \"tag\";\n})(TYPE || (TYPE = {}));\nexport var SKELETON_TYPE;\n(function (SKELETON_TYPE) {\n    SKELETON_TYPE[SKELETON_TYPE[\"number\"] = 0] = \"number\";\n    SKELETON_TYPE[SKELETON_TYPE[\"dateTime\"] = 1] = \"dateTime\";\n})(SKELETON_TYPE || (SKELETON_TYPE = {}));\n/**\n * Type Guards\n */\nexport function isLiteralElement(el) {\n    return el.type === TYPE.literal;\n}\nexport function isArgumentElement(el) {\n    return el.type === TYPE.argument;\n}\nexport function isNumberElement(el) {\n    return el.type === TYPE.number;\n}\nexport function isDateElement(el) {\n    return el.type === TYPE.date;\n}\nexport function isTimeElement(el) {\n    return el.type === TYPE.time;\n}\nexport function isSelectElement(el) {\n    return el.type === TYPE.select;\n}\nexport function isPluralElement(el) {\n    return el.type === TYPE.plural;\n}\nexport function isPoundElement(el) {\n    return el.type === TYPE.pound;\n}\nexport function isTagElement(el) {\n    return el.type === TYPE.tag;\n}\nexport function isNumberSkeleton(el) {\n    return !!(el && typeof el === 'object' && el.type === SKELETON_TYPE.number);\n}\nexport function isDateTimeSkeleton(el) {\n    return !!(el && typeof el === 'object' && el.type === SKELETON_TYPE.dateTime);\n}\nexport function createLiteralElement(value) {\n    return {\n        type: TYPE.literal,\n        value: value,\n    };\n}\nexport function createNumberElement(value, style) {\n    return {\n        type: TYPE.number,\n        value: value,\n        style: style,\n    };\n}\n","// @generated from regex-gen.ts\nexport var SPACE_SEPARATOR_REGEX = /[ \\xA0\\u1680\\u2000-\\u200A\\u202F\\u205F\\u3000]/;\nexport var WHITE_SPACE_REGEX = /[\\t-\\r \\x85\\u200E\\u200F\\u2028\\u2029]/;\n","/**\n * https://unicode.org/reports/tr35/tr35-dates.html#Date_Field_Symbol_Table\n * Credit: https://github.com/caridy/intl-datetimeformat-pattern/blob/master/index.js\n * with some tweaks\n */\nvar DATE_TIME_REGEX = /(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;\n/**\n * Parse Date time skeleton into Intl.DateTimeFormatOptions\n * Ref: https://unicode.org/reports/tr35/tr35-dates.html#Date_Field_Symbol_Table\n * @public\n * @param skeleton skeleton string\n */\nexport function parseDateTimeSkeleton(skeleton) {\n    var result = {};\n    skeleton.replace(DATE_TIME_REGEX, function (match) {\n        var len = match.length;\n        switch (match[0]) {\n            // Era\n            case 'G':\n                result.era = len === 4 ? 'long' : len === 5 ? 'narrow' : 'short';\n                break;\n            // Year\n            case 'y':\n                result.year = len === 2 ? '2-digit' : 'numeric';\n                break;\n            case 'Y':\n            case 'u':\n            case 'U':\n            case 'r':\n                throw new RangeError('`Y/u/U/r` (year) patterns are not supported, use `y` instead');\n            // Quarter\n            case 'q':\n            case 'Q':\n                throw new RangeError('`q/Q` (quarter) patterns are not supported');\n            // Month\n            case 'M':\n            case 'L':\n                result.month = ['numeric', '2-digit', 'short', 'long', 'narrow'][len - 1];\n                break;\n            // Week\n            case 'w':\n            case 'W':\n                throw new RangeError('`w/W` (week) patterns are not supported');\n            case 'd':\n                result.day = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'D':\n            case 'F':\n            case 'g':\n                throw new RangeError('`D/F/g` (day) patterns are not supported, use `d` instead');\n            // Weekday\n            case 'E':\n                result.weekday = len === 4 ? 'short' : len === 5 ? 'narrow' : 'short';\n                break;\n            case 'e':\n                if (len < 4) {\n                    throw new RangeError('`e..eee` (weekday) patterns are not supported');\n                }\n                result.weekday = ['short', 'long', 'narrow', 'short'][len - 4];\n                break;\n            case 'c':\n                if (len < 4) {\n                    throw new RangeError('`c..ccc` (weekday) patterns are not supported');\n                }\n                result.weekday = ['short', 'long', 'narrow', 'short'][len - 4];\n                break;\n            // Period\n            case 'a': // AM, PM\n                result.hour12 = true;\n                break;\n            case 'b': // am, pm, noon, midnight\n            case 'B': // flexible day periods\n                throw new RangeError('`b/B` (period) patterns are not supported, use `a` instead');\n            // Hour\n            case 'h':\n                result.hourCycle = 'h12';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'H':\n                result.hourCycle = 'h23';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'K':\n                result.hourCycle = 'h11';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'k':\n                result.hourCycle = 'h24';\n                result.hour = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'j':\n            case 'J':\n            case 'C':\n                throw new RangeError('`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead');\n            // Minute\n            case 'm':\n                result.minute = ['numeric', '2-digit'][len - 1];\n                break;\n            // Second\n            case 's':\n                result.second = ['numeric', '2-digit'][len - 1];\n                break;\n            case 'S':\n            case 'A':\n                throw new RangeError('`S/A` (second) patterns are not supported, use `s` instead');\n            // Zone\n            case 'z': // 1..3, 4: specific non-location format\n                result.timeZoneName = len < 4 ? 'short' : 'long';\n                break;\n            case 'Z': // 1..3, 4, 5: The ISO8601 varios formats\n            case 'O': // 1, 4: miliseconds in day short, long\n            case 'v': // 1, 4: generic non-location format\n            case 'V': // 1, 2, 3, 4: time zone ID or city\n            case 'X': // 1, 2, 3, 4: The ISO8601 varios formats\n            case 'x': // 1, 2, 3, 4: The ISO8601 varios formats\n                throw new RangeError('`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead');\n        }\n        return '';\n    });\n    return result;\n}\n","// @generated from regex-gen.ts\nexport var WHITE_SPACE_REGEX = /[\\t-\\r \\x85\\u200E\\u200F\\u2028\\u2029]/i;\n","import { __assign } from \"tslib\";\nimport { WHITE_SPACE_REGEX } from './regex.generated';\nexport function parseNumberSkeletonFromString(skeleton) {\n    if (skeleton.length === 0) {\n        throw new Error('Number skeleton cannot be empty');\n    }\n    // Parse the skeleton\n    var stringTokens = skeleton\n        .split(WHITE_SPACE_REGEX)\n        .filter(function (x) { return x.length > 0; });\n    var tokens = [];\n    for (var _i = 0, stringTokens_1 = stringTokens; _i < stringTokens_1.length; _i++) {\n        var stringToken = stringTokens_1[_i];\n        var stemAndOptions = stringToken.split('/');\n        if (stemAndOptions.length === 0) {\n            throw new Error('Invalid number skeleton');\n        }\n        var stem = stemAndOptions[0], options = stemAndOptions.slice(1);\n        for (var _a = 0, options_1 = options; _a < options_1.length; _a++) {\n            var option = options_1[_a];\n            if (option.length === 0) {\n                throw new Error('Invalid number skeleton');\n            }\n        }\n        tokens.push({ stem: stem, options: options });\n    }\n    return tokens;\n}\nfunction icuUnitToEcma(unit) {\n    return unit.replace(/^(.*?)-/, '');\n}\nvar FRACTION_PRECISION_REGEX = /^\\.(?:(0+)(\\*)?|(#+)|(0+)(#+))$/g;\nvar SIGNIFICANT_PRECISION_REGEX = /^(@+)?(\\+|#+)?[rs]?$/g;\nvar INTEGER_WIDTH_REGEX = /(\\*)(0+)|(#+)(0+)|(0+)/g;\nvar CONCISE_INTEGER_WIDTH_REGEX = /^(0+)$/;\nfunction parseSignificantPrecision(str) {\n    var result = {};\n    if (str[str.length - 1] === 'r') {\n        result.roundingPriority = 'morePrecision';\n    }\n    else if (str[str.length - 1] === 's') {\n        result.roundingPriority = 'lessPrecision';\n    }\n    str.replace(SIGNIFICANT_PRECISION_REGEX, function (_, g1, g2) {\n        // @@@ case\n        if (typeof g2 !== 'string') {\n            result.minimumSignificantDigits = g1.length;\n            result.maximumSignificantDigits = g1.length;\n        }\n        // @@@+ case\n        else if (g2 === '+') {\n            result.minimumSignificantDigits = g1.length;\n        }\n        // .### case\n        else if (g1[0] === '#') {\n            result.maximumSignificantDigits = g1.length;\n        }\n        // .@@## or .@@@ case\n        else {\n            result.minimumSignificantDigits = g1.length;\n            result.maximumSignificantDigits =\n                g1.length + (typeof g2 === 'string' ? g2.length : 0);\n        }\n        return '';\n    });\n    return result;\n}\nfunction parseSign(str) {\n    switch (str) {\n        case 'sign-auto':\n            return {\n                signDisplay: 'auto',\n            };\n        case 'sign-accounting':\n        case '()':\n            return {\n                currencySign: 'accounting',\n            };\n        case 'sign-always':\n        case '+!':\n            return {\n                signDisplay: 'always',\n            };\n        case 'sign-accounting-always':\n        case '()!':\n            return {\n                signDisplay: 'always',\n                currencySign: 'accounting',\n            };\n        case 'sign-except-zero':\n        case '+?':\n            return {\n                signDisplay: 'exceptZero',\n            };\n        case 'sign-accounting-except-zero':\n        case '()?':\n            return {\n                signDisplay: 'exceptZero',\n                currencySign: 'accounting',\n            };\n        case 'sign-never':\n        case '+_':\n            return {\n                signDisplay: 'never',\n            };\n    }\n}\nfunction parseConciseScientificAndEngineeringStem(stem) {\n    // Engineering\n    var result;\n    if (stem[0] === 'E' && stem[1] === 'E') {\n        result = {\n            notation: 'engineering',\n        };\n        stem = stem.slice(2);\n    }\n    else if (stem[0] === 'E') {\n        result = {\n            notation: 'scientific',\n        };\n        stem = stem.slice(1);\n    }\n    if (result) {\n        var signDisplay = stem.slice(0, 2);\n        if (signDisplay === '+!') {\n            result.signDisplay = 'always';\n            stem = stem.slice(2);\n        }\n        else if (signDisplay === '+?') {\n            result.signDisplay = 'exceptZero';\n            stem = stem.slice(2);\n        }\n        if (!CONCISE_INTEGER_WIDTH_REGEX.test(stem)) {\n            throw new Error('Malformed concise eng/scientific notation');\n        }\n        result.minimumIntegerDigits = stem.length;\n    }\n    return result;\n}\nfunction parseNotationOptions(opt) {\n    var result = {};\n    var signOpts = parseSign(opt);\n    if (signOpts) {\n        return signOpts;\n    }\n    return result;\n}\n/**\n * https://github.com/unicode-org/icu/blob/master/docs/userguide/format_parse/numbers/skeletons.md#skeleton-stems-and-options\n */\nexport function parseNumberSkeleton(tokens) {\n    var result = {};\n    for (var _i = 0, tokens_1 = tokens; _i < tokens_1.length; _i++) {\n        var token = tokens_1[_i];\n        switch (token.stem) {\n            case 'percent':\n            case '%':\n                result.style = 'percent';\n                continue;\n            case '%x100':\n                result.style = 'percent';\n                result.scale = 100;\n                continue;\n            case 'currency':\n                result.style = 'currency';\n                result.currency = token.options[0];\n                continue;\n            case 'group-off':\n            case ',_':\n                result.useGrouping = false;\n                continue;\n            case 'precision-integer':\n            case '.':\n                result.maximumFractionDigits = 0;\n                continue;\n            case 'measure-unit':\n            case 'unit':\n                result.style = 'unit';\n                result.unit = icuUnitToEcma(token.options[0]);\n                continue;\n            case 'compact-short':\n            case 'K':\n                result.notation = 'compact';\n                result.compactDisplay = 'short';\n                continue;\n            case 'compact-long':\n            case 'KK':\n                result.notation = 'compact';\n                result.compactDisplay = 'long';\n                continue;\n            case 'scientific':\n                result = __assign(__assign(__assign({}, result), { notation: 'scientific' }), token.options.reduce(function (all, opt) { return (__assign(__assign({}, all), parseNotationOptions(opt))); }, {}));\n                continue;\n            case 'engineering':\n                result = __assign(__assign(__assign({}, result), { notation: 'engineering' }), token.options.reduce(function (all, opt) { return (__assign(__assign({}, all), parseNotationOptions(opt))); }, {}));\n                continue;\n            case 'notation-simple':\n                result.notation = 'standard';\n                continue;\n            // https://github.com/unicode-org/icu/blob/master/icu4c/source/i18n/unicode/unumberformatter.h\n            case 'unit-width-narrow':\n                result.currencyDisplay = 'narrowSymbol';\n                result.unitDisplay = 'narrow';\n                continue;\n            case 'unit-width-short':\n                result.currencyDisplay = 'code';\n                result.unitDisplay = 'short';\n                continue;\n            case 'unit-width-full-name':\n                result.currencyDisplay = 'name';\n                result.unitDisplay = 'long';\n                continue;\n            case 'unit-width-iso-code':\n                result.currencyDisplay = 'symbol';\n                continue;\n            case 'scale':\n                result.scale = parseFloat(token.options[0]);\n                continue;\n            // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#integer-width\n            case 'integer-width':\n                if (token.options.length > 1) {\n                    throw new RangeError('integer-width stems only accept a single optional option');\n                }\n                token.options[0].replace(INTEGER_WIDTH_REGEX, function (_, g1, g2, g3, g4, g5) {\n                    if (g1) {\n                        result.minimumIntegerDigits = g2.length;\n                    }\n                    else if (g3 && g4) {\n                        throw new Error('We currently do not support maximum integer digits');\n                    }\n                    else if (g5) {\n                        throw new Error('We currently do not support exact integer digits');\n                    }\n                    return '';\n                });\n                continue;\n        }\n        // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#integer-width\n        if (CONCISE_INTEGER_WIDTH_REGEX.test(token.stem)) {\n            result.minimumIntegerDigits = token.stem.length;\n            continue;\n        }\n        if (FRACTION_PRECISION_REGEX.test(token.stem)) {\n            // Precision\n            // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#fraction-precision\n            // precision-integer case\n            if (token.options.length > 1) {\n                throw new RangeError('Fraction-precision stems only accept a single optional option');\n            }\n            token.stem.replace(FRACTION_PRECISION_REGEX, function (_, g1, g2, g3, g4, g5) {\n                // .000* case (before ICU67 it was .000+)\n                if (g2 === '*') {\n                    result.minimumFractionDigits = g1.length;\n                }\n                // .### case\n                else if (g3 && g3[0] === '#') {\n                    result.maximumFractionDigits = g3.length;\n                }\n                // .00## case\n                else if (g4 && g5) {\n                    result.minimumFractionDigits = g4.length;\n                    result.maximumFractionDigits = g4.length + g5.length;\n                }\n                else {\n                    result.minimumFractionDigits = g1.length;\n                    result.maximumFractionDigits = g1.length;\n                }\n                return '';\n            });\n            var opt = token.options[0];\n            // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#trailing-zero-display\n            if (opt === 'w') {\n                result = __assign(__assign({}, result), { trailingZeroDisplay: 'stripIfInteger' });\n            }\n            else if (opt) {\n                result = __assign(__assign({}, result), parseSignificantPrecision(opt));\n            }\n            continue;\n        }\n        // https://unicode-org.github.io/icu/userguide/format_parse/numbers/skeletons.html#significant-digits-precision\n        if (SIGNIFICANT_PRECISION_REGEX.test(token.stem)) {\n            result = __assign(__assign({}, result), parseSignificantPrecision(token.stem));\n            continue;\n        }\n        var signOpts = parseSign(token.stem);\n        if (signOpts) {\n            result = __assign(__assign({}, result), signOpts);\n        }\n        var conciseScientificAndEngineeringOpts = parseConciseScientificAndEngineeringStem(token.stem);\n        if (conciseScientificAndEngineeringOpts) {\n            result = __assign(__assign({}, result), conciseScientificAndEngineeringOpts);\n        }\n    }\n    return result;\n}\n","var _a;\nimport { __assign } from \"tslib\";\nimport { ErrorKind } from './error';\nimport { SKELETON_TYPE, TYPE, } from './types';\nimport { SPACE_SEPARATOR_REGEX } from './regex.generated';\nimport { parseNumberSkeleton, parseNumberSkeletonFromString, parseDateTimeSkeleton, } from '@formatjs/icu-skeleton-parser';\nvar SPACE_SEPARATOR_START_REGEX = new RegExp(\"^\".concat(SPACE_SEPARATOR_REGEX.source, \"*\"));\nvar SPACE_SEPARATOR_END_REGEX = new RegExp(\"\".concat(SPACE_SEPARATOR_REGEX.source, \"*$\"));\nfunction createLocation(start, end) {\n    return { start: start, end: end };\n}\n// #region Ponyfills\n// Consolidate these variables up top for easier toggling during debugging\nvar hasNativeStartsWith = !!String.prototype.startsWith;\nvar hasNativeFromCodePoint = !!String.fromCodePoint;\nvar hasNativeFromEntries = !!Object.fromEntries;\nvar hasNativeCodePointAt = !!String.prototype.codePointAt;\nvar hasTrimStart = !!String.prototype.trimStart;\nvar hasTrimEnd = !!String.prototype.trimEnd;\nvar hasNativeIsSafeInteger = !!Number.isSafeInteger;\nvar isSafeInteger = hasNativeIsSafeInteger\n    ? Number.isSafeInteger\n    : function (n) {\n        return (typeof n === 'number' &&\n            isFinite(n) &&\n            Math.floor(n) === n &&\n            Math.abs(n) <= 0x1fffffffffffff);\n    };\n// IE11 does not support y and u.\nvar REGEX_SUPPORTS_U_AND_Y = true;\ntry {\n    var re = RE('([^\\\\p{White_Space}\\\\p{Pattern_Syntax}]*)', 'yu');\n    /**\n     * legacy Edge or Xbox One browser\n     * Unicode flag support: supported\n     * Pattern_Syntax support: not supported\n     * See https://github.com/formatjs/formatjs/issues/2822\n     */\n    REGEX_SUPPORTS_U_AND_Y = ((_a = re.exec('a')) === null || _a === void 0 ? void 0 : _a[0]) === 'a';\n}\ncatch (_) {\n    REGEX_SUPPORTS_U_AND_Y = false;\n}\nvar startsWith = hasNativeStartsWith\n    ? // Native\n        function startsWith(s, search, position) {\n            return s.startsWith(search, position);\n        }\n    : // For IE11\n        function startsWith(s, search, position) {\n            return s.slice(position, position + search.length) === search;\n        };\nvar fromCodePoint = hasNativeFromCodePoint\n    ? String.fromCodePoint\n    : // IE11\n        function fromCodePoint() {\n            var codePoints = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                codePoints[_i] = arguments[_i];\n            }\n            var elements = '';\n            var length = codePoints.length;\n            var i = 0;\n            var code;\n            while (length > i) {\n                code = codePoints[i++];\n                if (code > 0x10ffff)\n                    throw RangeError(code + ' is not a valid code point');\n                elements +=\n                    code < 0x10000\n                        ? String.fromCharCode(code)\n                        : String.fromCharCode(((code -= 0x10000) >> 10) + 0xd800, (code % 0x400) + 0xdc00);\n            }\n            return elements;\n        };\nvar fromEntries = \n// native\nhasNativeFromEntries\n    ? Object.fromEntries\n    : // Ponyfill\n        function fromEntries(entries) {\n            var obj = {};\n            for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {\n                var _a = entries_1[_i], k = _a[0], v = _a[1];\n                obj[k] = v;\n            }\n            return obj;\n        };\nvar codePointAt = hasNativeCodePointAt\n    ? // Native\n        function codePointAt(s, index) {\n            return s.codePointAt(index);\n        }\n    : // IE 11\n        function codePointAt(s, index) {\n            var size = s.length;\n            if (index < 0 || index >= size) {\n                return undefined;\n            }\n            var first = s.charCodeAt(index);\n            var second;\n            return first < 0xd800 ||\n                first > 0xdbff ||\n                index + 1 === size ||\n                (second = s.charCodeAt(index + 1)) < 0xdc00 ||\n                second > 0xdfff\n                ? first\n                : ((first - 0xd800) << 10) + (second - 0xdc00) + 0x10000;\n        };\nvar trimStart = hasTrimStart\n    ? // Native\n        function trimStart(s) {\n            return s.trimStart();\n        }\n    : // Ponyfill\n        function trimStart(s) {\n            return s.replace(SPACE_SEPARATOR_START_REGEX, '');\n        };\nvar trimEnd = hasTrimEnd\n    ? // Native\n        function trimEnd(s) {\n            return s.trimEnd();\n        }\n    : // Ponyfill\n        function trimEnd(s) {\n            return s.replace(SPACE_SEPARATOR_END_REGEX, '');\n        };\n// Prevent minifier to translate new RegExp to literal form that might cause syntax error on IE11.\nfunction RE(s, flag) {\n    return new RegExp(s, flag);\n}\n// #endregion\nvar matchIdentifierAtIndex;\nif (REGEX_SUPPORTS_U_AND_Y) {\n    // Native\n    var IDENTIFIER_PREFIX_RE_1 = RE('([^\\\\p{White_Space}\\\\p{Pattern_Syntax}]*)', 'yu');\n    matchIdentifierAtIndex = function matchIdentifierAtIndex(s, index) {\n        var _a;\n        IDENTIFIER_PREFIX_RE_1.lastIndex = index;\n        var match = IDENTIFIER_PREFIX_RE_1.exec(s);\n        return (_a = match[1]) !== null && _a !== void 0 ? _a : '';\n    };\n}\nelse {\n    // IE11\n    matchIdentifierAtIndex = function matchIdentifierAtIndex(s, index) {\n        var match = [];\n        while (true) {\n            var c = codePointAt(s, index);\n            if (c === undefined || _isWhiteSpace(c) || _isPatternSyntax(c)) {\n                break;\n            }\n            match.push(c);\n            index += c >= 0x10000 ? 2 : 1;\n        }\n        return fromCodePoint.apply(void 0, match);\n    };\n}\nvar Parser = /** @class */ (function () {\n    function Parser(message, options) {\n        if (options === void 0) { options = {}; }\n        this.message = message;\n        this.position = { offset: 0, line: 1, column: 1 };\n        this.ignoreTag = !!options.ignoreTag;\n        this.requiresOtherClause = !!options.requiresOtherClause;\n        this.shouldParseSkeletons = !!options.shouldParseSkeletons;\n    }\n    Parser.prototype.parse = function () {\n        if (this.offset() !== 0) {\n            throw Error('parser can only be used once');\n        }\n        return this.parseMessage(0, '', false);\n    };\n    Parser.prototype.parseMessage = function (nestingLevel, parentArgType, expectingCloseTag) {\n        var elements = [];\n        while (!this.isEOF()) {\n            var char = this.char();\n            if (char === 123 /* `{` */) {\n                var result = this.parseArgument(nestingLevel, expectingCloseTag);\n                if (result.err) {\n                    return result;\n                }\n                elements.push(result.val);\n            }\n            else if (char === 125 /* `}` */ && nestingLevel > 0) {\n                break;\n            }\n            else if (char === 35 /* `#` */ &&\n                (parentArgType === 'plural' || parentArgType === 'selectordinal')) {\n                var position = this.clonePosition();\n                this.bump();\n                elements.push({\n                    type: TYPE.pound,\n                    location: createLocation(position, this.clonePosition()),\n                });\n            }\n            else if (char === 60 /* `<` */ &&\n                !this.ignoreTag &&\n                this.peek() === 47 // char code for '/'\n            ) {\n                if (expectingCloseTag) {\n                    break;\n                }\n                else {\n                    return this.error(ErrorKind.UNMATCHED_CLOSING_TAG, createLocation(this.clonePosition(), this.clonePosition()));\n                }\n            }\n            else if (char === 60 /* `<` */ &&\n                !this.ignoreTag &&\n                _isAlpha(this.peek() || 0)) {\n                var result = this.parseTag(nestingLevel, parentArgType);\n                if (result.err) {\n                    return result;\n                }\n                elements.push(result.val);\n            }\n            else {\n                var result = this.parseLiteral(nestingLevel, parentArgType);\n                if (result.err) {\n                    return result;\n                }\n                elements.push(result.val);\n            }\n        }\n        return { val: elements, err: null };\n    };\n    /**\n     * A tag name must start with an ASCII lower/upper case letter. The grammar is based on the\n     * [custom element name][] except that a dash is NOT always mandatory and uppercase letters\n     * are accepted:\n     *\n     * ```\n     * tag ::= \"<\" tagName (whitespace)* \"/>\" | \"<\" tagName (whitespace)* \">\" message \"</\" tagName (whitespace)* \">\"\n     * tagName ::= [a-z] (PENChar)*\n     * PENChar ::=\n     *     \"-\" | \".\" | [0-9] | \"_\" | [a-z] | [A-Z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x37D] |\n     *     [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] | [#x2C00-#x2FEF] |\n     *     [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\n     * ```\n     *\n     * [custom element name]: https://html.spec.whatwg.org/multipage/custom-elements.html#valid-custom-element-name\n     * NOTE: We're a bit more lax here since HTML technically does not allow uppercase HTML element but we do\n     * since other tag-based engines like React allow it\n     */\n    Parser.prototype.parseTag = function (nestingLevel, parentArgType) {\n        var startPosition = this.clonePosition();\n        this.bump(); // `<`\n        var tagName = this.parseTagName();\n        this.bumpSpace();\n        if (this.bumpIf('/>')) {\n            // Self closing tag\n            return {\n                val: {\n                    type: TYPE.literal,\n                    value: \"<\".concat(tagName, \"/>\"),\n                    location: createLocation(startPosition, this.clonePosition()),\n                },\n                err: null,\n            };\n        }\n        else if (this.bumpIf('>')) {\n            var childrenResult = this.parseMessage(nestingLevel + 1, parentArgType, true);\n            if (childrenResult.err) {\n                return childrenResult;\n            }\n            var children = childrenResult.val;\n            // Expecting a close tag\n            var endTagStartPosition = this.clonePosition();\n            if (this.bumpIf('</')) {\n                if (this.isEOF() || !_isAlpha(this.char())) {\n                    return this.error(ErrorKind.INVALID_TAG, createLocation(endTagStartPosition, this.clonePosition()));\n                }\n                var closingTagNameStartPosition = this.clonePosition();\n                var closingTagName = this.parseTagName();\n                if (tagName !== closingTagName) {\n                    return this.error(ErrorKind.UNMATCHED_CLOSING_TAG, createLocation(closingTagNameStartPosition, this.clonePosition()));\n                }\n                this.bumpSpace();\n                if (!this.bumpIf('>')) {\n                    return this.error(ErrorKind.INVALID_TAG, createLocation(endTagStartPosition, this.clonePosition()));\n                }\n                return {\n                    val: {\n                        type: TYPE.tag,\n                        value: tagName,\n                        children: children,\n                        location: createLocation(startPosition, this.clonePosition()),\n                    },\n                    err: null,\n                };\n            }\n            else {\n                return this.error(ErrorKind.UNCLOSED_TAG, createLocation(startPosition, this.clonePosition()));\n            }\n        }\n        else {\n            return this.error(ErrorKind.INVALID_TAG, createLocation(startPosition, this.clonePosition()));\n        }\n    };\n    /**\n     * This method assumes that the caller has peeked ahead for the first tag character.\n     */\n    Parser.prototype.parseTagName = function () {\n        var startOffset = this.offset();\n        this.bump(); // the first tag name character\n        while (!this.isEOF() && _isPotentialElementNameChar(this.char())) {\n            this.bump();\n        }\n        return this.message.slice(startOffset, this.offset());\n    };\n    Parser.prototype.parseLiteral = function (nestingLevel, parentArgType) {\n        var start = this.clonePosition();\n        var value = '';\n        while (true) {\n            var parseQuoteResult = this.tryParseQuote(parentArgType);\n            if (parseQuoteResult) {\n                value += parseQuoteResult;\n                continue;\n            }\n            var parseUnquotedResult = this.tryParseUnquoted(nestingLevel, parentArgType);\n            if (parseUnquotedResult) {\n                value += parseUnquotedResult;\n                continue;\n            }\n            var parseLeftAngleResult = this.tryParseLeftAngleBracket();\n            if (parseLeftAngleResult) {\n                value += parseLeftAngleResult;\n                continue;\n            }\n            break;\n        }\n        var location = createLocation(start, this.clonePosition());\n        return {\n            val: { type: TYPE.literal, value: value, location: location },\n            err: null,\n        };\n    };\n    Parser.prototype.tryParseLeftAngleBracket = function () {\n        if (!this.isEOF() &&\n            this.char() === 60 /* `<` */ &&\n            (this.ignoreTag ||\n                // If at the opening tag or closing tag position, bail.\n                !_isAlphaOrSlash(this.peek() || 0))) {\n            this.bump(); // `<`\n            return '<';\n        }\n        return null;\n    };\n    /**\n     * Starting with ICU 4.8, an ASCII apostrophe only starts quoted text if it immediately precedes\n     * a character that requires quoting (that is, \"only where needed\"), and works the same in\n     * nested messages as on the top level of the pattern. The new behavior is otherwise compatible.\n     */\n    Parser.prototype.tryParseQuote = function (parentArgType) {\n        if (this.isEOF() || this.char() !== 39 /* `'` */) {\n            return null;\n        }\n        // Parse escaped char following the apostrophe, or early return if there is no escaped char.\n        // Check if is valid escaped character\n        switch (this.peek()) {\n            case 39 /* `'` */:\n                // double quote, should return as a single quote.\n                this.bump();\n                this.bump();\n                return \"'\";\n            // '{', '<', '>', '}'\n            case 123:\n            case 60:\n            case 62:\n            case 125:\n                break;\n            case 35: // '#'\n                if (parentArgType === 'plural' || parentArgType === 'selectordinal') {\n                    break;\n                }\n                return null;\n            default:\n                return null;\n        }\n        this.bump(); // apostrophe\n        var codePoints = [this.char()]; // escaped char\n        this.bump();\n        // read chars until the optional closing apostrophe is found\n        while (!this.isEOF()) {\n            var ch = this.char();\n            if (ch === 39 /* `'` */) {\n                if (this.peek() === 39 /* `'` */) {\n                    codePoints.push(39);\n                    // Bump one more time because we need to skip 2 characters.\n                    this.bump();\n                }\n                else {\n                    // Optional closing apostrophe.\n                    this.bump();\n                    break;\n                }\n            }\n            else {\n                codePoints.push(ch);\n            }\n            this.bump();\n        }\n        return fromCodePoint.apply(void 0, codePoints);\n    };\n    Parser.prototype.tryParseUnquoted = function (nestingLevel, parentArgType) {\n        if (this.isEOF()) {\n            return null;\n        }\n        var ch = this.char();\n        if (ch === 60 /* `<` */ ||\n            ch === 123 /* `{` */ ||\n            (ch === 35 /* `#` */ &&\n                (parentArgType === 'plural' || parentArgType === 'selectordinal')) ||\n            (ch === 125 /* `}` */ && nestingLevel > 0)) {\n            return null;\n        }\n        else {\n            this.bump();\n            return fromCodePoint(ch);\n        }\n    };\n    Parser.prototype.parseArgument = function (nestingLevel, expectingCloseTag) {\n        var openingBracePosition = this.clonePosition();\n        this.bump(); // `{`\n        this.bumpSpace();\n        if (this.isEOF()) {\n            return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        if (this.char() === 125 /* `}` */) {\n            this.bump();\n            return this.error(ErrorKind.EMPTY_ARGUMENT, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        // argument name\n        var value = this.parseIdentifierIfPossible().value;\n        if (!value) {\n            return this.error(ErrorKind.MALFORMED_ARGUMENT, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        this.bumpSpace();\n        if (this.isEOF()) {\n            return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        switch (this.char()) {\n            // Simple argument: `{name}`\n            case 125 /* `}` */: {\n                this.bump(); // `}`\n                return {\n                    val: {\n                        type: TYPE.argument,\n                        // value does not include the opening and closing braces.\n                        value: value,\n                        location: createLocation(openingBracePosition, this.clonePosition()),\n                    },\n                    err: null,\n                };\n            }\n            // Argument with options: `{name, format, ...}`\n            case 44 /* `,` */: {\n                this.bump(); // `,`\n                this.bumpSpace();\n                if (this.isEOF()) {\n                    return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n                }\n                return this.parseArgumentOptions(nestingLevel, expectingCloseTag, value, openingBracePosition);\n            }\n            default:\n                return this.error(ErrorKind.MALFORMED_ARGUMENT, createLocation(openingBracePosition, this.clonePosition()));\n        }\n    };\n    /**\n     * Advance the parser until the end of the identifier, if it is currently on\n     * an identifier character. Return an empty string otherwise.\n     */\n    Parser.prototype.parseIdentifierIfPossible = function () {\n        var startingPosition = this.clonePosition();\n        var startOffset = this.offset();\n        var value = matchIdentifierAtIndex(this.message, startOffset);\n        var endOffset = startOffset + value.length;\n        this.bumpTo(endOffset);\n        var endPosition = this.clonePosition();\n        var location = createLocation(startingPosition, endPosition);\n        return { value: value, location: location };\n    };\n    Parser.prototype.parseArgumentOptions = function (nestingLevel, expectingCloseTag, value, openingBracePosition) {\n        var _a;\n        // Parse this range:\n        // {name, type, style}\n        //        ^---^\n        var typeStartPosition = this.clonePosition();\n        var argType = this.parseIdentifierIfPossible().value;\n        var typeEndPosition = this.clonePosition();\n        switch (argType) {\n            case '':\n                // Expecting a style string number, date, time, plural, selectordinal, or select.\n                return this.error(ErrorKind.EXPECT_ARGUMENT_TYPE, createLocation(typeStartPosition, typeEndPosition));\n            case 'number':\n            case 'date':\n            case 'time': {\n                // Parse this range:\n                // {name, number, style}\n                //              ^-------^\n                this.bumpSpace();\n                var styleAndLocation = null;\n                if (this.bumpIf(',')) {\n                    this.bumpSpace();\n                    var styleStartPosition = this.clonePosition();\n                    var result = this.parseSimpleArgStyleIfPossible();\n                    if (result.err) {\n                        return result;\n                    }\n                    var style = trimEnd(result.val);\n                    if (style.length === 0) {\n                        return this.error(ErrorKind.EXPECT_ARGUMENT_STYLE, createLocation(this.clonePosition(), this.clonePosition()));\n                    }\n                    var styleLocation = createLocation(styleStartPosition, this.clonePosition());\n                    styleAndLocation = { style: style, styleLocation: styleLocation };\n                }\n                var argCloseResult = this.tryParseArgumentClose(openingBracePosition);\n                if (argCloseResult.err) {\n                    return argCloseResult;\n                }\n                var location_1 = createLocation(openingBracePosition, this.clonePosition());\n                // Extract style or skeleton\n                if (styleAndLocation && startsWith(styleAndLocation === null || styleAndLocation === void 0 ? void 0 : styleAndLocation.style, '::', 0)) {\n                    // Skeleton starts with `::`.\n                    var skeleton = trimStart(styleAndLocation.style.slice(2));\n                    if (argType === 'number') {\n                        var result = this.parseNumberSkeletonFromString(skeleton, styleAndLocation.styleLocation);\n                        if (result.err) {\n                            return result;\n                        }\n                        return {\n                            val: { type: TYPE.number, value: value, location: location_1, style: result.val },\n                            err: null,\n                        };\n                    }\n                    else {\n                        if (skeleton.length === 0) {\n                            return this.error(ErrorKind.EXPECT_DATE_TIME_SKELETON, location_1);\n                        }\n                        var style = {\n                            type: SKELETON_TYPE.dateTime,\n                            pattern: skeleton,\n                            location: styleAndLocation.styleLocation,\n                            parsedOptions: this.shouldParseSkeletons\n                                ? parseDateTimeSkeleton(skeleton)\n                                : {},\n                        };\n                        var type = argType === 'date' ? TYPE.date : TYPE.time;\n                        return {\n                            val: { type: type, value: value, location: location_1, style: style },\n                            err: null,\n                        };\n                    }\n                }\n                // Regular style or no style.\n                return {\n                    val: {\n                        type: argType === 'number'\n                            ? TYPE.number\n                            : argType === 'date'\n                                ? TYPE.date\n                                : TYPE.time,\n                        value: value,\n                        location: location_1,\n                        style: (_a = styleAndLocation === null || styleAndLocation === void 0 ? void 0 : styleAndLocation.style) !== null && _a !== void 0 ? _a : null,\n                    },\n                    err: null,\n                };\n            }\n            case 'plural':\n            case 'selectordinal':\n            case 'select': {\n                // Parse this range:\n                // {name, plural, options}\n                //              ^---------^\n                var typeEndPosition_1 = this.clonePosition();\n                this.bumpSpace();\n                if (!this.bumpIf(',')) {\n                    return this.error(ErrorKind.EXPECT_SELECT_ARGUMENT_OPTIONS, createLocation(typeEndPosition_1, __assign({}, typeEndPosition_1)));\n                }\n                this.bumpSpace();\n                // Parse offset:\n                // {name, plural, offset:1, options}\n                //                ^-----^\n                //\n                // or the first option:\n                //\n                // {name, plural, one {...} other {...}}\n                //                ^--^\n                var identifierAndLocation = this.parseIdentifierIfPossible();\n                var pluralOffset = 0;\n                if (argType !== 'select' && identifierAndLocation.value === 'offset') {\n                    if (!this.bumpIf(':')) {\n                        return this.error(ErrorKind.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE, createLocation(this.clonePosition(), this.clonePosition()));\n                    }\n                    this.bumpSpace();\n                    var result = this.tryParseDecimalInteger(ErrorKind.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE, ErrorKind.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);\n                    if (result.err) {\n                        return result;\n                    }\n                    // Parse another identifier for option parsing\n                    this.bumpSpace();\n                    identifierAndLocation = this.parseIdentifierIfPossible();\n                    pluralOffset = result.val;\n                }\n                var optionsResult = this.tryParsePluralOrSelectOptions(nestingLevel, argType, expectingCloseTag, identifierAndLocation);\n                if (optionsResult.err) {\n                    return optionsResult;\n                }\n                var argCloseResult = this.tryParseArgumentClose(openingBracePosition);\n                if (argCloseResult.err) {\n                    return argCloseResult;\n                }\n                var location_2 = createLocation(openingBracePosition, this.clonePosition());\n                if (argType === 'select') {\n                    return {\n                        val: {\n                            type: TYPE.select,\n                            value: value,\n                            options: fromEntries(optionsResult.val),\n                            location: location_2,\n                        },\n                        err: null,\n                    };\n                }\n                else {\n                    return {\n                        val: {\n                            type: TYPE.plural,\n                            value: value,\n                            options: fromEntries(optionsResult.val),\n                            offset: pluralOffset,\n                            pluralType: argType === 'plural' ? 'cardinal' : 'ordinal',\n                            location: location_2,\n                        },\n                        err: null,\n                    };\n                }\n            }\n            default:\n                return this.error(ErrorKind.INVALID_ARGUMENT_TYPE, createLocation(typeStartPosition, typeEndPosition));\n        }\n    };\n    Parser.prototype.tryParseArgumentClose = function (openingBracePosition) {\n        // Parse: {value, number, ::currency/GBP }\n        //\n        if (this.isEOF() || this.char() !== 125 /* `}` */) {\n            return this.error(ErrorKind.EXPECT_ARGUMENT_CLOSING_BRACE, createLocation(openingBracePosition, this.clonePosition()));\n        }\n        this.bump(); // `}`\n        return { val: true, err: null };\n    };\n    /**\n     * See: https://github.com/unicode-org/icu/blob/af7ed1f6d2298013dc303628438ec4abe1f16479/icu4c/source/common/messagepattern.cpp#L659\n     */\n    Parser.prototype.parseSimpleArgStyleIfPossible = function () {\n        var nestedBraces = 0;\n        var startPosition = this.clonePosition();\n        while (!this.isEOF()) {\n            var ch = this.char();\n            switch (ch) {\n                case 39 /* `'` */: {\n                    // Treat apostrophe as quoting but include it in the style part.\n                    // Find the end of the quoted literal text.\n                    this.bump();\n                    var apostrophePosition = this.clonePosition();\n                    if (!this.bumpUntil(\"'\")) {\n                        return this.error(ErrorKind.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE, createLocation(apostrophePosition, this.clonePosition()));\n                    }\n                    this.bump();\n                    break;\n                }\n                case 123 /* `{` */: {\n                    nestedBraces += 1;\n                    this.bump();\n                    break;\n                }\n                case 125 /* `}` */: {\n                    if (nestedBraces > 0) {\n                        nestedBraces -= 1;\n                    }\n                    else {\n                        return {\n                            val: this.message.slice(startPosition.offset, this.offset()),\n                            err: null,\n                        };\n                    }\n                    break;\n                }\n                default:\n                    this.bump();\n                    break;\n            }\n        }\n        return {\n            val: this.message.slice(startPosition.offset, this.offset()),\n            err: null,\n        };\n    };\n    Parser.prototype.parseNumberSkeletonFromString = function (skeleton, location) {\n        var tokens = [];\n        try {\n            tokens = parseNumberSkeletonFromString(skeleton);\n        }\n        catch (e) {\n            return this.error(ErrorKind.INVALID_NUMBER_SKELETON, location);\n        }\n        return {\n            val: {\n                type: SKELETON_TYPE.number,\n                tokens: tokens,\n                location: location,\n                parsedOptions: this.shouldParseSkeletons\n                    ? parseNumberSkeleton(tokens)\n                    : {},\n            },\n            err: null,\n        };\n    };\n    /**\n     * @param nesting_level The current nesting level of messages.\n     *     This can be positive when parsing message fragment in select or plural argument options.\n     * @param parent_arg_type The parent argument's type.\n     * @param parsed_first_identifier If provided, this is the first identifier-like selector of\n     *     the argument. It is a by-product of a previous parsing attempt.\n     * @param expecting_close_tag If true, this message is directly or indirectly nested inside\n     *     between a pair of opening and closing tags. The nested message will not parse beyond\n     *     the closing tag boundary.\n     */\n    Parser.prototype.tryParsePluralOrSelectOptions = function (nestingLevel, parentArgType, expectCloseTag, parsedFirstIdentifier) {\n        var _a;\n        var hasOtherClause = false;\n        var options = [];\n        var parsedSelectors = new Set();\n        var selector = parsedFirstIdentifier.value, selectorLocation = parsedFirstIdentifier.location;\n        // Parse:\n        // one {one apple}\n        // ^--^\n        while (true) {\n            if (selector.length === 0) {\n                var startPosition = this.clonePosition();\n                if (parentArgType !== 'select' && this.bumpIf('=')) {\n                    // Try parse `={number}` selector\n                    var result = this.tryParseDecimalInteger(ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR, ErrorKind.INVALID_PLURAL_ARGUMENT_SELECTOR);\n                    if (result.err) {\n                        return result;\n                    }\n                    selectorLocation = createLocation(startPosition, this.clonePosition());\n                    selector = this.message.slice(startPosition.offset, this.offset());\n                }\n                else {\n                    break;\n                }\n            }\n            // Duplicate selector clauses\n            if (parsedSelectors.has(selector)) {\n                return this.error(parentArgType === 'select'\n                    ? ErrorKind.DUPLICATE_SELECT_ARGUMENT_SELECTOR\n                    : ErrorKind.DUPLICATE_PLURAL_ARGUMENT_SELECTOR, selectorLocation);\n            }\n            if (selector === 'other') {\n                hasOtherClause = true;\n            }\n            // Parse:\n            // one {one apple}\n            //     ^----------^\n            this.bumpSpace();\n            var openingBracePosition = this.clonePosition();\n            if (!this.bumpIf('{')) {\n                return this.error(parentArgType === 'select'\n                    ? ErrorKind.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT\n                    : ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT, createLocation(this.clonePosition(), this.clonePosition()));\n            }\n            var fragmentResult = this.parseMessage(nestingLevel + 1, parentArgType, expectCloseTag);\n            if (fragmentResult.err) {\n                return fragmentResult;\n            }\n            var argCloseResult = this.tryParseArgumentClose(openingBracePosition);\n            if (argCloseResult.err) {\n                return argCloseResult;\n            }\n            options.push([\n                selector,\n                {\n                    value: fragmentResult.val,\n                    location: createLocation(openingBracePosition, this.clonePosition()),\n                },\n            ]);\n            // Keep track of the existing selectors\n            parsedSelectors.add(selector);\n            // Prep next selector clause.\n            this.bumpSpace();\n            (_a = this.parseIdentifierIfPossible(), selector = _a.value, selectorLocation = _a.location);\n        }\n        if (options.length === 0) {\n            return this.error(parentArgType === 'select'\n                ? ErrorKind.EXPECT_SELECT_ARGUMENT_SELECTOR\n                : ErrorKind.EXPECT_PLURAL_ARGUMENT_SELECTOR, createLocation(this.clonePosition(), this.clonePosition()));\n        }\n        if (this.requiresOtherClause && !hasOtherClause) {\n            return this.error(ErrorKind.MISSING_OTHER_CLAUSE, createLocation(this.clonePosition(), this.clonePosition()));\n        }\n        return { val: options, err: null };\n    };\n    Parser.prototype.tryParseDecimalInteger = function (expectNumberError, invalidNumberError) {\n        var sign = 1;\n        var startingPosition = this.clonePosition();\n        if (this.bumpIf('+')) {\n        }\n        else if (this.bumpIf('-')) {\n            sign = -1;\n        }\n        var hasDigits = false;\n        var decimal = 0;\n        while (!this.isEOF()) {\n            var ch = this.char();\n            if (ch >= 48 /* `0` */ && ch <= 57 /* `9` */) {\n                hasDigits = true;\n                decimal = decimal * 10 + (ch - 48);\n                this.bump();\n            }\n            else {\n                break;\n            }\n        }\n        var location = createLocation(startingPosition, this.clonePosition());\n        if (!hasDigits) {\n            return this.error(expectNumberError, location);\n        }\n        decimal *= sign;\n        if (!isSafeInteger(decimal)) {\n            return this.error(invalidNumberError, location);\n        }\n        return { val: decimal, err: null };\n    };\n    Parser.prototype.offset = function () {\n        return this.position.offset;\n    };\n    Parser.prototype.isEOF = function () {\n        return this.offset() === this.message.length;\n    };\n    Parser.prototype.clonePosition = function () {\n        // This is much faster than `Object.assign` or spread.\n        return {\n            offset: this.position.offset,\n            line: this.position.line,\n            column: this.position.column,\n        };\n    };\n    /**\n     * Return the code point at the current position of the parser.\n     * Throws if the index is out of bound.\n     */\n    Parser.prototype.char = function () {\n        var offset = this.position.offset;\n        if (offset >= this.message.length) {\n            throw Error('out of bound');\n        }\n        var code = codePointAt(this.message, offset);\n        if (code === undefined) {\n            throw Error(\"Offset \".concat(offset, \" is at invalid UTF-16 code unit boundary\"));\n        }\n        return code;\n    };\n    Parser.prototype.error = function (kind, location) {\n        return {\n            val: null,\n            err: {\n                kind: kind,\n                message: this.message,\n                location: location,\n            },\n        };\n    };\n    /** Bump the parser to the next UTF-16 code unit. */\n    Parser.prototype.bump = function () {\n        if (this.isEOF()) {\n            return;\n        }\n        var code = this.char();\n        if (code === 10 /* '\\n' */) {\n            this.position.line += 1;\n            this.position.column = 1;\n            this.position.offset += 1;\n        }\n        else {\n            this.position.column += 1;\n            // 0 ~ 0x10000 -> unicode BMP, otherwise skip the surrogate pair.\n            this.position.offset += code < 0x10000 ? 1 : 2;\n        }\n    };\n    /**\n     * If the substring starting at the current position of the parser has\n     * the given prefix, then bump the parser to the character immediately\n     * following the prefix and return true. Otherwise, don't bump the parser\n     * and return false.\n     */\n    Parser.prototype.bumpIf = function (prefix) {\n        if (startsWith(this.message, prefix, this.offset())) {\n            for (var i = 0; i < prefix.length; i++) {\n                this.bump();\n            }\n            return true;\n        }\n        return false;\n    };\n    /**\n     * Bump the parser until the pattern character is found and return `true`.\n     * Otherwise bump to the end of the file and return `false`.\n     */\n    Parser.prototype.bumpUntil = function (pattern) {\n        var currentOffset = this.offset();\n        var index = this.message.indexOf(pattern, currentOffset);\n        if (index >= 0) {\n            this.bumpTo(index);\n            return true;\n        }\n        else {\n            this.bumpTo(this.message.length);\n            return false;\n        }\n    };\n    /**\n     * Bump the parser to the target offset.\n     * If target offset is beyond the end of the input, bump the parser to the end of the input.\n     */\n    Parser.prototype.bumpTo = function (targetOffset) {\n        if (this.offset() > targetOffset) {\n            throw Error(\"targetOffset \".concat(targetOffset, \" must be greater than or equal to the current offset \").concat(this.offset()));\n        }\n        targetOffset = Math.min(targetOffset, this.message.length);\n        while (true) {\n            var offset = this.offset();\n            if (offset === targetOffset) {\n                break;\n            }\n            if (offset > targetOffset) {\n                throw Error(\"targetOffset \".concat(targetOffset, \" is at invalid UTF-16 code unit boundary\"));\n            }\n            this.bump();\n            if (this.isEOF()) {\n                break;\n            }\n        }\n    };\n    /** advance the parser through all whitespace to the next non-whitespace code unit. */\n    Parser.prototype.bumpSpace = function () {\n        while (!this.isEOF() && _isWhiteSpace(this.char())) {\n            this.bump();\n        }\n    };\n    /**\n     * Peek at the *next* Unicode codepoint in the input without advancing the parser.\n     * If the input has been exhausted, then this returns null.\n     */\n    Parser.prototype.peek = function () {\n        if (this.isEOF()) {\n            return null;\n        }\n        var code = this.char();\n        var offset = this.offset();\n        var nextCode = this.message.charCodeAt(offset + (code >= 0x10000 ? 2 : 1));\n        return nextCode !== null && nextCode !== void 0 ? nextCode : null;\n    };\n    return Parser;\n}());\nexport { Parser };\n/**\n * This check if codepoint is alphabet (lower & uppercase)\n * @param codepoint\n * @returns\n */\nfunction _isAlpha(codepoint) {\n    return ((codepoint >= 97 && codepoint <= 122) ||\n        (codepoint >= 65 && codepoint <= 90));\n}\nfunction _isAlphaOrSlash(codepoint) {\n    return _isAlpha(codepoint) || codepoint === 47; /* '/' */\n}\n/** See `parseTag` function docs. */\nfunction _isPotentialElementNameChar(c) {\n    return (c === 45 /* '-' */ ||\n        c === 46 /* '.' */ ||\n        (c >= 48 && c <= 57) /* 0..9 */ ||\n        c === 95 /* '_' */ ||\n        (c >= 97 && c <= 122) /** a..z */ ||\n        (c >= 65 && c <= 90) /* A..Z */ ||\n        c == 0xb7 ||\n        (c >= 0xc0 && c <= 0xd6) ||\n        (c >= 0xd8 && c <= 0xf6) ||\n        (c >= 0xf8 && c <= 0x37d) ||\n        (c >= 0x37f && c <= 0x1fff) ||\n        (c >= 0x200c && c <= 0x200d) ||\n        (c >= 0x203f && c <= 0x2040) ||\n        (c >= 0x2070 && c <= 0x218f) ||\n        (c >= 0x2c00 && c <= 0x2fef) ||\n        (c >= 0x3001 && c <= 0xd7ff) ||\n        (c >= 0xf900 && c <= 0xfdcf) ||\n        (c >= 0xfdf0 && c <= 0xfffd) ||\n        (c >= 0x10000 && c <= 0xeffff));\n}\n/**\n * Code point equivalent of regex `\\p{White_Space}`.\n * From: https://www.unicode.org/Public/UCD/latest/ucd/PropList.txt\n */\nfunction _isWhiteSpace(c) {\n    return ((c >= 0x0009 && c <= 0x000d) ||\n        c === 0x0020 ||\n        c === 0x0085 ||\n        (c >= 0x200e && c <= 0x200f) ||\n        c === 0x2028 ||\n        c === 0x2029);\n}\n/**\n * Code point equivalent of regex `\\p{Pattern_Syntax}`.\n * See https://www.unicode.org/Public/UCD/latest/ucd/PropList.txt\n */\nfunction _isPatternSyntax(c) {\n    return ((c >= 0x0021 && c <= 0x0023) ||\n        c === 0x0024 ||\n        (c >= 0x0025 && c <= 0x0027) ||\n        c === 0x0028 ||\n        c === 0x0029 ||\n        c === 0x002a ||\n        c === 0x002b ||\n        c === 0x002c ||\n        c === 0x002d ||\n        (c >= 0x002e && c <= 0x002f) ||\n        (c >= 0x003a && c <= 0x003b) ||\n        (c >= 0x003c && c <= 0x003e) ||\n        (c >= 0x003f && c <= 0x0040) ||\n        c === 0x005b ||\n        c === 0x005c ||\n        c === 0x005d ||\n        c === 0x005e ||\n        c === 0x0060 ||\n        c === 0x007b ||\n        c === 0x007c ||\n        c === 0x007d ||\n        c === 0x007e ||\n        c === 0x00a1 ||\n        (c >= 0x00a2 && c <= 0x00a5) ||\n        c === 0x00a6 ||\n        c === 0x00a7 ||\n        c === 0x00a9 ||\n        c === 0x00ab ||\n        c === 0x00ac ||\n        c === 0x00ae ||\n        c === 0x00b0 ||\n        c === 0x00b1 ||\n        c === 0x00b6 ||\n        c === 0x00bb ||\n        c === 0x00bf ||\n        c === 0x00d7 ||\n        c === 0x00f7 ||\n        (c >= 0x2010 && c <= 0x2015) ||\n        (c >= 0x2016 && c <= 0x2017) ||\n        c === 0x2018 ||\n        c === 0x2019 ||\n        c === 0x201a ||\n        (c >= 0x201b && c <= 0x201c) ||\n        c === 0x201d ||\n        c === 0x201e ||\n        c === 0x201f ||\n        (c >= 0x2020 && c <= 0x2027) ||\n        (c >= 0x2030 && c <= 0x2038) ||\n        c === 0x2039 ||\n        c === 0x203a ||\n        (c >= 0x203b && c <= 0x203e) ||\n        (c >= 0x2041 && c <= 0x2043) ||\n        c === 0x2044 ||\n        c === 0x2045 ||\n        c === 0x2046 ||\n        (c >= 0x2047 && c <= 0x2051) ||\n        c === 0x2052 ||\n        c === 0x2053 ||\n        (c >= 0x2055 && c <= 0x205e) ||\n        (c >= 0x2190 && c <= 0x2194) ||\n        (c >= 0x2195 && c <= 0x2199) ||\n        (c >= 0x219a && c <= 0x219b) ||\n        (c >= 0x219c && c <= 0x219f) ||\n        c === 0x21a0 ||\n        (c >= 0x21a1 && c <= 0x21a2) ||\n        c === 0x21a3 ||\n        (c >= 0x21a4 && c <= 0x21a5) ||\n        c === 0x21a6 ||\n        (c >= 0x21a7 && c <= 0x21ad) ||\n        c === 0x21ae ||\n        (c >= 0x21af && c <= 0x21cd) ||\n        (c >= 0x21ce && c <= 0x21cf) ||\n        (c >= 0x21d0 && c <= 0x21d1) ||\n        c === 0x21d2 ||\n        c === 0x21d3 ||\n        c === 0x21d4 ||\n        (c >= 0x21d5 && c <= 0x21f3) ||\n        (c >= 0x21f4 && c <= 0x22ff) ||\n        (c >= 0x2300 && c <= 0x2307) ||\n        c === 0x2308 ||\n        c === 0x2309 ||\n        c === 0x230a ||\n        c === 0x230b ||\n        (c >= 0x230c && c <= 0x231f) ||\n        (c >= 0x2320 && c <= 0x2321) ||\n        (c >= 0x2322 && c <= 0x2328) ||\n        c === 0x2329 ||\n        c === 0x232a ||\n        (c >= 0x232b && c <= 0x237b) ||\n        c === 0x237c ||\n        (c >= 0x237d && c <= 0x239a) ||\n        (c >= 0x239b && c <= 0x23b3) ||\n        (c >= 0x23b4 && c <= 0x23db) ||\n        (c >= 0x23dc && c <= 0x23e1) ||\n        (c >= 0x23e2 && c <= 0x2426) ||\n        (c >= 0x2427 && c <= 0x243f) ||\n        (c >= 0x2440 && c <= 0x244a) ||\n        (c >= 0x244b && c <= 0x245f) ||\n        (c >= 0x2500 && c <= 0x25b6) ||\n        c === 0x25b7 ||\n        (c >= 0x25b8 && c <= 0x25c0) ||\n        c === 0x25c1 ||\n        (c >= 0x25c2 && c <= 0x25f7) ||\n        (c >= 0x25f8 && c <= 0x25ff) ||\n        (c >= 0x2600 && c <= 0x266e) ||\n        c === 0x266f ||\n        (c >= 0x2670 && c <= 0x2767) ||\n        c === 0x2768 ||\n        c === 0x2769 ||\n        c === 0x276a ||\n        c === 0x276b ||\n        c === 0x276c ||\n        c === 0x276d ||\n        c === 0x276e ||\n        c === 0x276f ||\n        c === 0x2770 ||\n        c === 0x2771 ||\n        c === 0x2772 ||\n        c === 0x2773 ||\n        c === 0x2774 ||\n        c === 0x2775 ||\n        (c >= 0x2794 && c <= 0x27bf) ||\n        (c >= 0x27c0 && c <= 0x27c4) ||\n        c === 0x27c5 ||\n        c === 0x27c6 ||\n        (c >= 0x27c7 && c <= 0x27e5) ||\n        c === 0x27e6 ||\n        c === 0x27e7 ||\n        c === 0x27e8 ||\n        c === 0x27e9 ||\n        c === 0x27ea ||\n        c === 0x27eb ||\n        c === 0x27ec ||\n        c === 0x27ed ||\n        c === 0x27ee ||\n        c === 0x27ef ||\n        (c >= 0x27f0 && c <= 0x27ff) ||\n        (c >= 0x2800 && c <= 0x28ff) ||\n        (c >= 0x2900 && c <= 0x2982) ||\n        c === 0x2983 ||\n        c === 0x2984 ||\n        c === 0x2985 ||\n        c === 0x2986 ||\n        c === 0x2987 ||\n        c === 0x2988 ||\n        c === 0x2989 ||\n        c === 0x298a ||\n        c === 0x298b ||\n        c === 0x298c ||\n        c === 0x298d ||\n        c === 0x298e ||\n        c === 0x298f ||\n        c === 0x2990 ||\n        c === 0x2991 ||\n        c === 0x2992 ||\n        c === 0x2993 ||\n        c === 0x2994 ||\n        c === 0x2995 ||\n        c === 0x2996 ||\n        c === 0x2997 ||\n        c === 0x2998 ||\n        (c >= 0x2999 && c <= 0x29d7) ||\n        c === 0x29d8 ||\n        c === 0x29d9 ||\n        c === 0x29da ||\n        c === 0x29db ||\n        (c >= 0x29dc && c <= 0x29fb) ||\n        c === 0x29fc ||\n        c === 0x29fd ||\n        (c >= 0x29fe && c <= 0x2aff) ||\n        (c >= 0x2b00 && c <= 0x2b2f) ||\n        (c >= 0x2b30 && c <= 0x2b44) ||\n        (c >= 0x2b45 && c <= 0x2b46) ||\n        (c >= 0x2b47 && c <= 0x2b4c) ||\n        (c >= 0x2b4d && c <= 0x2b73) ||\n        (c >= 0x2b74 && c <= 0x2b75) ||\n        (c >= 0x2b76 && c <= 0x2b95) ||\n        c === 0x2b96 ||\n        (c >= 0x2b97 && c <= 0x2bff) ||\n        (c >= 0x2e00 && c <= 0x2e01) ||\n        c === 0x2e02 ||\n        c === 0x2e03 ||\n        c === 0x2e04 ||\n        c === 0x2e05 ||\n        (c >= 0x2e06 && c <= 0x2e08) ||\n        c === 0x2e09 ||\n        c === 0x2e0a ||\n        c === 0x2e0b ||\n        c === 0x2e0c ||\n        c === 0x2e0d ||\n        (c >= 0x2e0e && c <= 0x2e16) ||\n        c === 0x2e17 ||\n        (c >= 0x2e18 && c <= 0x2e19) ||\n        c === 0x2e1a ||\n        c === 0x2e1b ||\n        c === 0x2e1c ||\n        c === 0x2e1d ||\n        (c >= 0x2e1e && c <= 0x2e1f) ||\n        c === 0x2e20 ||\n        c === 0x2e21 ||\n        c === 0x2e22 ||\n        c === 0x2e23 ||\n        c === 0x2e24 ||\n        c === 0x2e25 ||\n        c === 0x2e26 ||\n        c === 0x2e27 ||\n        c === 0x2e28 ||\n        c === 0x2e29 ||\n        (c >= 0x2e2a && c <= 0x2e2e) ||\n        c === 0x2e2f ||\n        (c >= 0x2e30 && c <= 0x2e39) ||\n        (c >= 0x2e3a && c <= 0x2e3b) ||\n        (c >= 0x2e3c && c <= 0x2e3f) ||\n        c === 0x2e40 ||\n        c === 0x2e41 ||\n        c === 0x2e42 ||\n        (c >= 0x2e43 && c <= 0x2e4f) ||\n        (c >= 0x2e50 && c <= 0x2e51) ||\n        c === 0x2e52 ||\n        (c >= 0x2e53 && c <= 0x2e7f) ||\n        (c >= 0x3001 && c <= 0x3003) ||\n        c === 0x3008 ||\n        c === 0x3009 ||\n        c === 0x300a ||\n        c === 0x300b ||\n        c === 0x300c ||\n        c === 0x300d ||\n        c === 0x300e ||\n        c === 0x300f ||\n        c === 0x3010 ||\n        c === 0x3011 ||\n        (c >= 0x3012 && c <= 0x3013) ||\n        c === 0x3014 ||\n        c === 0x3015 ||\n        c === 0x3016 ||\n        c === 0x3017 ||\n        c === 0x3018 ||\n        c === 0x3019 ||\n        c === 0x301a ||\n        c === 0x301b ||\n        c === 0x301c ||\n        c === 0x301d ||\n        (c >= 0x301e && c <= 0x301f) ||\n        c === 0x3020 ||\n        c === 0x3030 ||\n        c === 0xfd3e ||\n        c === 0xfd3f ||\n        (c >= 0xfe45 && c <= 0xfe46));\n}\n","import { __assign } from \"tslib\";\nimport { ErrorKind } from './error';\nimport { Parser } from './parser';\nimport { isDateElement, isDateTimeSkeleton, isNumberElement, isNumberSkeleton, isPluralElement, isSelectElement, isTagElement, isTimeElement, } from './types';\nfunction pruneLocation(els) {\n    els.forEach(function (el) {\n        delete el.location;\n        if (isSelectElement(el) || isPluralElement(el)) {\n            for (var k in el.options) {\n                delete el.options[k].location;\n                pruneLocation(el.options[k].value);\n            }\n        }\n        else if (isNumberElement(el) && isNumberSkeleton(el.style)) {\n            delete el.style.location;\n        }\n        else if ((isDateElement(el) || isTimeElement(el)) &&\n            isDateTimeSkeleton(el.style)) {\n            delete el.style.location;\n        }\n        else if (isTagElement(el)) {\n            pruneLocation(el.children);\n        }\n    });\n}\nexport function parse(message, opts) {\n    if (opts === void 0) { opts = {}; }\n    opts = __assign({ shouldParseSkeletons: true, requiresOtherClause: true }, opts);\n    var result = new Parser(message, opts).parse();\n    if (result.err) {\n        var error = SyntaxError(ErrorKind[result.err.kind]);\n        // @ts-expect-error Assign to error object\n        error.location = result.err.location;\n        // @ts-expect-error Assign to error object\n        error.originalMessage = result.err.message;\n        throw error;\n    }\n    if (!(opts === null || opts === void 0 ? void 0 : opts.captureLocation)) {\n        pruneLocation(result.val);\n    }\n    return result.val;\n}\nexport * from './types';\n","//\n// Main\n//\nexport default function memoize(fn, options) {\n    var cache = options && options.cache ? options.cache : cacheDefault;\n    var serializer = options && options.serializer ? options.serializer : serializerDefault;\n    var strategy = options && options.strategy ? options.strategy : strategyDefault;\n    return strategy(fn, {\n        cache: cache,\n        serializer: serializer,\n    });\n}\n//\n// Strategy\n//\nfunction isPrimitive(value) {\n    return (value == null || typeof value === 'number' || typeof value === 'boolean'); // || typeof value === \"string\" 'unsafe' primitive for our needs\n}\nfunction monadic(fn, cache, serializer, arg) {\n    var cacheKey = isPrimitive(arg) ? arg : serializer(arg);\n    var computedValue = cache.get(cacheKey);\n    if (typeof computedValue === 'undefined') {\n        computedValue = fn.call(this, arg);\n        cache.set(cacheKey, computedValue);\n    }\n    return computedValue;\n}\nfunction variadic(fn, cache, serializer) {\n    var args = Array.prototype.slice.call(arguments, 3);\n    var cacheKey = serializer(args);\n    var computedValue = cache.get(cacheKey);\n    if (typeof computedValue === 'undefined') {\n        computedValue = fn.apply(this, args);\n        cache.set(cacheKey, computedValue);\n    }\n    return computedValue;\n}\nfunction assemble(fn, context, strategy, cache, serialize) {\n    return strategy.bind(context, fn, cache, serialize);\n}\nfunction strategyDefault(fn, options) {\n    var strategy = fn.length === 1 ? monadic : variadic;\n    return assemble(fn, this, strategy, options.cache.create(), options.serializer);\n}\nfunction strategyVariadic(fn, options) {\n    return assemble(fn, this, variadic, options.cache.create(), options.serializer);\n}\nfunction strategyMonadic(fn, options) {\n    return assemble(fn, this, monadic, options.cache.create(), options.serializer);\n}\n//\n// Serializer\n//\nvar serializerDefault = function () {\n    return JSON.stringify(arguments);\n};\n//\n// Cache\n//\nfunction ObjectWithoutPrototypeCache() {\n    this.cache = Object.create(null);\n}\nObjectWithoutPrototypeCache.prototype.get = function (key) {\n    return this.cache[key];\n};\nObjectWithoutPrototypeCache.prototype.set = function (key, value) {\n    this.cache[key] = value;\n};\nvar cacheDefault = {\n    create: function create() {\n        // @ts-ignore\n        return new ObjectWithoutPrototypeCache();\n    },\n};\nexport var strategies = {\n    variadic: strategyVariadic,\n    monadic: strategyMonadic,\n};\n","import { __extends } from \"tslib\";\nexport var ErrorCode;\n(function (ErrorCode) {\n    // When we have a placeholder but no value to format\n    ErrorCode[\"MISSING_VALUE\"] = \"MISSING_VALUE\";\n    // When value supplied is invalid\n    ErrorCode[\"INVALID_VALUE\"] = \"INVALID_VALUE\";\n    // When we need specific Intl API but it's not available\n    ErrorCode[\"MISSING_INTL_API\"] = \"MISSING_INTL_API\";\n})(ErrorCode || (ErrorCode = {}));\nvar FormatError = /** @class */ (function (_super) {\n    __extends(FormatError, _super);\n    function FormatError(msg, code, originalMessage) {\n        var _this = _super.call(this, msg) || this;\n        _this.code = code;\n        _this.originalMessage = originalMessage;\n        return _this;\n    }\n    FormatError.prototype.toString = function () {\n        return \"[formatjs Error: \".concat(this.code, \"] \").concat(this.message);\n    };\n    return FormatError;\n}(Error));\nexport { FormatError };\nvar InvalidValueError = /** @class */ (function (_super) {\n    __extends(InvalidValueError, _super);\n    function InvalidValueError(variableId, value, options, originalMessage) {\n        return _super.call(this, \"Invalid values for \\\"\".concat(variableId, \"\\\": \\\"\").concat(value, \"\\\". Options are \\\"\").concat(Object.keys(options).join('\", \"'), \"\\\"\"), ErrorCode.INVALID_VALUE, originalMessage) || this;\n    }\n    return InvalidValueError;\n}(FormatError));\nexport { InvalidValueError };\nvar InvalidValueTypeError = /** @class */ (function (_super) {\n    __extends(InvalidValueTypeError, _super);\n    function InvalidValueTypeError(value, type, originalMessage) {\n        return _super.call(this, \"Value for \\\"\".concat(value, \"\\\" must be of type \").concat(type), ErrorCode.INVALID_VALUE, originalMessage) || this;\n    }\n    return InvalidValueTypeError;\n}(FormatError));\nexport { InvalidValueTypeError };\nvar MissingValueError = /** @class */ (function (_super) {\n    __extends(MissingValueError, _super);\n    function MissingValueError(variableId, originalMessage) {\n        return _super.call(this, \"The intl string context variable \\\"\".concat(variableId, \"\\\" was not provided to the string \\\"\").concat(originalMessage, \"\\\"\"), ErrorCode.MISSING_VALUE, originalMessage) || this;\n    }\n    return MissingValueError;\n}(FormatError));\nexport { MissingValueError };\n","import { isArgumentElement, isDateElement, isDateTimeSkeleton, isLiteralElement, isNumberElement, isNumberSkeleton, isPluralElement, isPoundElement, isSelectElement, isTimeElement, isTagElement, } from '@formatjs/icu-messageformat-parser';\nimport { MissingValueError, InvalidValueError, ErrorCode, FormatError, InvalidValueTypeError, } from './error';\nexport var PART_TYPE;\n(function (PART_TYPE) {\n    PART_TYPE[PART_TYPE[\"literal\"] = 0] = \"literal\";\n    PART_TYPE[PART_TYPE[\"object\"] = 1] = \"object\";\n})(PART_TYPE || (PART_TYPE = {}));\nfunction mergeLiteral(parts) {\n    if (parts.length < 2) {\n        return parts;\n    }\n    return parts.reduce(function (all, part) {\n        var lastPart = all[all.length - 1];\n        if (!lastPart ||\n            lastPart.type !== PART_TYPE.literal ||\n            part.type !== PART_TYPE.literal) {\n            all.push(part);\n        }\n        else {\n            lastPart.value += part.value;\n        }\n        return all;\n    }, []);\n}\nexport function isFormatXMLElementFn(el) {\n    return typeof el === 'function';\n}\n// TODO(skeleton): add skeleton support\nexport function formatToParts(els, locales, formatters, formats, values, currentPluralValue, \n// For debugging\noriginalMessage) {\n    // Hot path for straight simple msg translations\n    if (els.length === 1 && isLiteralElement(els[0])) {\n        return [\n            {\n                type: PART_TYPE.literal,\n                value: els[0].value,\n            },\n        ];\n    }\n    var result = [];\n    for (var _i = 0, els_1 = els; _i < els_1.length; _i++) {\n        var el = els_1[_i];\n        // Exit early for string parts.\n        if (isLiteralElement(el)) {\n            result.push({\n                type: PART_TYPE.literal,\n                value: el.value,\n            });\n            continue;\n        }\n        // TODO: should this part be literal type?\n        // Replace `#` in plural rules with the actual numeric value.\n        if (isPoundElement(el)) {\n            if (typeof currentPluralValue === 'number') {\n                result.push({\n                    type: PART_TYPE.literal,\n                    value: formatters.getNumberFormat(locales).format(currentPluralValue),\n                });\n            }\n            continue;\n        }\n        var varName = el.value;\n        // Enforce that all required values are provided by the caller.\n        if (!(values && varName in values)) {\n            throw new MissingValueError(varName, originalMessage);\n        }\n        var value = values[varName];\n        if (isArgumentElement(el)) {\n            if (!value || typeof value === 'string' || typeof value === 'number') {\n                value =\n                    typeof value === 'string' || typeof value === 'number'\n                        ? String(value)\n                        : '';\n            }\n            result.push({\n                type: typeof value === 'string' ? PART_TYPE.literal : PART_TYPE.object,\n                value: value,\n            });\n            continue;\n        }\n        // Recursively format plural and select parts' option — which can be a\n        // nested pattern structure. The choosing of the option to use is\n        // abstracted-by and delegated-to the part helper object.\n        if (isDateElement(el)) {\n            var style = typeof el.style === 'string'\n                ? formats.date[el.style]\n                : isDateTimeSkeleton(el.style)\n                    ? el.style.parsedOptions\n                    : undefined;\n            result.push({\n                type: PART_TYPE.literal,\n                value: formatters\n                    .getDateTimeFormat(locales, style)\n                    .format(value),\n            });\n            continue;\n        }\n        if (isTimeElement(el)) {\n            var style = typeof el.style === 'string'\n                ? formats.time[el.style]\n                : isDateTimeSkeleton(el.style)\n                    ? el.style.parsedOptions\n                    : formats.time.medium;\n            result.push({\n                type: PART_TYPE.literal,\n                value: formatters\n                    .getDateTimeFormat(locales, style)\n                    .format(value),\n            });\n            continue;\n        }\n        if (isNumberElement(el)) {\n            var style = typeof el.style === 'string'\n                ? formats.number[el.style]\n                : isNumberSkeleton(el.style)\n                    ? el.style.parsedOptions\n                    : undefined;\n            if (style && style.scale) {\n                value =\n                    value *\n                        (style.scale || 1);\n            }\n            result.push({\n                type: PART_TYPE.literal,\n                value: formatters\n                    .getNumberFormat(locales, style)\n                    .format(value),\n            });\n            continue;\n        }\n        if (isTagElement(el)) {\n            var children = el.children, value_1 = el.value;\n            var formatFn = values[value_1];\n            if (!isFormatXMLElementFn(formatFn)) {\n                throw new InvalidValueTypeError(value_1, 'function', originalMessage);\n            }\n            var parts = formatToParts(children, locales, formatters, formats, values, currentPluralValue);\n            var chunks = formatFn(parts.map(function (p) { return p.value; }));\n            if (!Array.isArray(chunks)) {\n                chunks = [chunks];\n            }\n            result.push.apply(result, chunks.map(function (c) {\n                return {\n                    type: typeof c === 'string' ? PART_TYPE.literal : PART_TYPE.object,\n                    value: c,\n                };\n            }));\n        }\n        if (isSelectElement(el)) {\n            var opt = el.options[value] || el.options.other;\n            if (!opt) {\n                throw new InvalidValueError(el.value, value, Object.keys(el.options), originalMessage);\n            }\n            result.push.apply(result, formatToParts(opt.value, locales, formatters, formats, values));\n            continue;\n        }\n        if (isPluralElement(el)) {\n            var opt = el.options[\"=\".concat(value)];\n            if (!opt) {\n                if (!Intl.PluralRules) {\n                    throw new FormatError(\"Intl.PluralRules is not available in this environment.\\nTry polyfilling it using \\\"@formatjs/intl-pluralrules\\\"\\n\", ErrorCode.MISSING_INTL_API, originalMessage);\n                }\n                var rule = formatters\n                    .getPluralRules(locales, { type: el.pluralType })\n                    .select(value - (el.offset || 0));\n                opt = el.options[rule] || el.options.other;\n            }\n            if (!opt) {\n                throw new InvalidValueError(el.value, value, Object.keys(el.options), originalMessage);\n            }\n            result.push.apply(result, formatToParts(opt.value, locales, formatters, formats, values, value - (el.offset || 0)));\n            continue;\n        }\n    }\n    return mergeLiteral(result);\n}\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\nimport { __assign, __spreadArray } from \"tslib\";\nimport { parse } from '@formatjs/icu-messageformat-parser';\nimport memoize, { strategies } from '@formatjs/fast-memoize';\nimport { formatToParts, PART_TYPE, } from './formatters';\n// -- MessageFormat --------------------------------------------------------\nfunction mergeConfig(c1, c2) {\n    if (!c2) {\n        return c1;\n    }\n    return __assign(__assign(__assign({}, (c1 || {})), (c2 || {})), Object.keys(c1).reduce(function (all, k) {\n        all[k] = __assign(__assign({}, c1[k]), (c2[k] || {}));\n        return all;\n    }, {}));\n}\nfunction mergeConfigs(defaultConfig, configs) {\n    if (!configs) {\n        return defaultConfig;\n    }\n    return Object.keys(defaultConfig).reduce(function (all, k) {\n        all[k] = mergeConfig(defaultConfig[k], configs[k]);\n        return all;\n    }, __assign({}, defaultConfig));\n}\nfunction createFastMemoizeCache(store) {\n    return {\n        create: function () {\n            return {\n                get: function (key) {\n                    return store[key];\n                },\n                set: function (key, value) {\n                    store[key] = value;\n                },\n            };\n        },\n    };\n}\nfunction createDefaultFormatters(cache) {\n    if (cache === void 0) { cache = {\n        number: {},\n        dateTime: {},\n        pluralRules: {},\n    }; }\n    return {\n        getNumberFormat: memoize(function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return new ((_a = Intl.NumberFormat).bind.apply(_a, __spreadArray([void 0], args, false)))();\n        }, {\n            cache: createFastMemoizeCache(cache.number),\n            strategy: strategies.variadic,\n        }),\n        getDateTimeFormat: memoize(function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return new ((_a = Intl.DateTimeFormat).bind.apply(_a, __spreadArray([void 0], args, false)))();\n        }, {\n            cache: createFastMemoizeCache(cache.dateTime),\n            strategy: strategies.variadic,\n        }),\n        getPluralRules: memoize(function () {\n            var _a;\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            return new ((_a = Intl.PluralRules).bind.apply(_a, __spreadArray([void 0], args, false)))();\n        }, {\n            cache: createFastMemoizeCache(cache.pluralRules),\n            strategy: strategies.variadic,\n        }),\n    };\n}\nvar IntlMessageFormat = /** @class */ (function () {\n    function IntlMessageFormat(message, locales, overrideFormats, opts) {\n        var _this = this;\n        if (locales === void 0) { locales = IntlMessageFormat.defaultLocale; }\n        this.formatterCache = {\n            number: {},\n            dateTime: {},\n            pluralRules: {},\n        };\n        this.format = function (values) {\n            var parts = _this.formatToParts(values);\n            // Hot path for straight simple msg translations\n            if (parts.length === 1) {\n                return parts[0].value;\n            }\n            var result = parts.reduce(function (all, part) {\n                if (!all.length ||\n                    part.type !== PART_TYPE.literal ||\n                    typeof all[all.length - 1] !== 'string') {\n                    all.push(part.value);\n                }\n                else {\n                    all[all.length - 1] += part.value;\n                }\n                return all;\n            }, []);\n            if (result.length <= 1) {\n                return result[0] || '';\n            }\n            return result;\n        };\n        this.formatToParts = function (values) {\n            return formatToParts(_this.ast, _this.locales, _this.formatters, _this.formats, values, undefined, _this.message);\n        };\n        this.resolvedOptions = function () { return ({\n            locale: Intl.NumberFormat.supportedLocalesOf(_this.locales)[0],\n        }); };\n        this.getAst = function () { return _this.ast; };\n        if (typeof message === 'string') {\n            this.message = message;\n            if (!IntlMessageFormat.__parse) {\n                throw new TypeError('IntlMessageFormat.__parse must be set to process `message` of type `string`');\n            }\n            // Parse string messages into an AST.\n            this.ast = IntlMessageFormat.__parse(message, {\n                ignoreTag: opts === null || opts === void 0 ? void 0 : opts.ignoreTag,\n            });\n        }\n        else {\n            this.ast = message;\n        }\n        if (!Array.isArray(this.ast)) {\n            throw new TypeError('A message must be provided as a String or AST.');\n        }\n        // Creates a new object with the specified `formats` merged with the default\n        // formats.\n        this.formats = mergeConfigs(IntlMessageFormat.formats, overrideFormats);\n        // Defined first because it's used to build the format pattern.\n        this.locales = locales;\n        this.formatters =\n            (opts && opts.formatters) || createDefaultFormatters(this.formatterCache);\n    }\n    Object.defineProperty(IntlMessageFormat, \"defaultLocale\", {\n        get: function () {\n            if (!IntlMessageFormat.memoizedDefaultLocale) {\n                IntlMessageFormat.memoizedDefaultLocale =\n                    new Intl.NumberFormat().resolvedOptions().locale;\n            }\n            return IntlMessageFormat.memoizedDefaultLocale;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    IntlMessageFormat.memoizedDefaultLocale = null;\n    IntlMessageFormat.__parse = parse;\n    // Default format options used as the prototype of the `formats` provided to the\n    // constructor. These are used when constructing the internal Intl.NumberFormat\n    // and Intl.DateTimeFormat instances.\n    IntlMessageFormat.formats = {\n        number: {\n            integer: {\n                maximumFractionDigits: 0,\n            },\n            currency: {\n                style: 'currency',\n            },\n            percent: {\n                style: 'percent',\n            },\n        },\n        date: {\n            short: {\n                month: 'numeric',\n                day: 'numeric',\n                year: '2-digit',\n            },\n            medium: {\n                month: 'short',\n                day: 'numeric',\n                year: 'numeric',\n            },\n            long: {\n                month: 'long',\n                day: 'numeric',\n                year: 'numeric',\n            },\n            full: {\n                weekday: 'long',\n                month: 'long',\n                day: 'numeric',\n                year: 'numeric',\n            },\n        },\n        time: {\n            short: {\n                hour: 'numeric',\n                minute: 'numeric',\n            },\n            medium: {\n                hour: 'numeric',\n                minute: 'numeric',\n                second: 'numeric',\n            },\n            long: {\n                hour: 'numeric',\n                minute: 'numeric',\n                second: 'numeric',\n                timeZoneName: 'short',\n            },\n            full: {\n                hour: 'numeric',\n                minute: 'numeric',\n                second: 'numeric',\n                timeZoneName: 'short',\n            },\n        },\n    };\n    return IntlMessageFormat;\n}());\nexport { IntlMessageFormat };\n","import React from 'react';\nimport { injectIntl } from 'react-intl';\nimport intlMessageformat from 'intl-messageformat';\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar IntlMessageFormat = _interopDefault(intlMessageformat);\n\nconst INITIAL_ZERO = /^0/;\n\nfunction leftTrim(parts) {\n  let previousEmpty = true;\n  return parts.filter(token => {\n    if (token.type === 'literal' && !token.value.trim()) {\n      if (previousEmpty) return false;\n      previousEmpty = true;\n      return true;\n    } else {\n      previousEmpty = false;\n    }\n\n    return true;\n  });\n}\n\nfunction trim(parts, trimFirstPaddedValue = false) {\n  const trimmed = leftTrim(leftTrim(parts).reverse()).reverse();\n\n  if (trimFirstPaddedValue) {\n    const first = trimmed.find(token => token.type !== 'literal');\n    first.value = first.value.replace(INITIAL_ZERO, '');\n  }\n\n  return trimmed;\n}\n\nfunction DurationUnitFormat(locales, options = defaultOptions) {\n  this.locales = locales; // TODO I'm ignoring the unit for now, value is always expressed in seconds\n\n  this.unit = 'second'; // .style determines how the placeholders are converted to plain text\n\n  this.style = options.style || DurationUnitFormat.styles.LONG; // .isTimer determines some special behaviour, we want to keep the 0s\n\n  this.isTimer = this.style === DurationUnitFormat.styles.TIMER; // .format used `seconds`, `minutes`, `hours`, ... as placeholders\n\n  this.format = options.format || (this.isTimer ? '{minutes}:{seconds}' : '{seconds}'); // How to format unit according to style\n\n  this.formatUnits = options.formatUnits || defaultOptions.formatUnits; // .formatDuration determines whether we use a space or not\n\n  this.formatDuration = options.formatDuration || defaultOptions.formatDuration;\n  this.shouldRound = options.round === true;\n}\n\nDurationUnitFormat.units = {\n  DAY: 'day',\n  HOUR: 'hour',\n  MINUTE: 'minute',\n  SECOND: 'second'\n};\nDurationUnitFormat.styles = {\n  CUSTOM: 'custom',\n  TIMER: 'timer',\n  // http://www.unicode.org/cldr/charts/27/summary/pl.html#5556\n  LONG: 'long',\n  SHORT: 'short',\n  NARROW: 'narrow'\n};\n\nDurationUnitFormat.prototype.formatToParts = function (value) {\n  // Extract all the parts that are actually used from the localised format\n  const parts = new IntlMessageFormat(this.format, this.locales).formatToParts({\n    second: {\n      unit: DurationUnitFormat.units.SECOND\n    },\n    seconds: {\n      unit: DurationUnitFormat.units.SECOND\n    },\n    minute: {\n      unit: DurationUnitFormat.units.MINUTE\n    },\n    minutes: {\n      unit: DurationUnitFormat.units.MINUTE\n    },\n    hour: {\n      unit: DurationUnitFormat.units.HOUR\n    },\n    hours: {\n      unit: DurationUnitFormat.units.HOUR\n    },\n    day: {\n      unit: DurationUnitFormat.units.DAY\n    },\n    days: {\n      unit: DurationUnitFormat.units.DAY\n    }\n  }); // Compute the value of each bucket depending on which parts are used\n\n  const buckets = splitSecondsInBuckets(value, this.unit, parts, this.shouldRound); // Each part from the format message could potentially contain multiple parts\n\n  const result = parts.reduce((all, token) => all.concat(this._formatToken(token, buckets)), []);\n  return this._trimOutput(result, parts);\n};\n\nDurationUnitFormat.prototype._formatToken = function (token, buckets) {\n  const {\n    value\n  } = token;\n\n  if (value.unit) {\n    const number = buckets[value.unit];\n    return number || this.isTimer ? this._formatDurationToParts(value.unit, number) : [];\n  } else if (value) {\n    // If there is no .unit it's text, but it could be an empty string\n    return [{\n      type: 'literal',\n      value\n    }];\n  }\n\n  return [];\n};\n\nDurationUnitFormat.prototype._formatDurationToParts = function (unit, number) {\n  if (this.isTimer) {\n    // With timer style, we only show the value\n    return [{\n      type: unit,\n      value: this._formatValue(number)\n    }];\n  } else if (isSpecialStyle(this.style)) {\n    return new Intl.NumberFormat(this.locales, {\n      style: 'unit',\n      unit: unit,\n      unitDisplay: this.style\n    }).formatToParts(number).map(_ => ({\n      // NumberFormat uses 'integer' for types, but I prefer using the unit\n      // This is more similar to what happens in DateTimeFormat\n      type: _.type === 'integer' ? unit : _.type,\n      value: _.value\n    }));\n  } // This is now only needed for the custom formatting\n\n\n  return this.formatDuration.split(SPLIT_POINTS).map(text => {\n    if (text === '{value}') {\n      return {\n        type: unit,\n        value: this._formatValue(number)\n      };\n    }\n\n    if (text === '{unit}') {\n      const message = this.formatUnits[unit] || '{value}';\n      const formattedUnit = new IntlMessageFormat(message, this.locales).format({\n        value: number\n      });\n      return {\n        type: 'unit',\n        value: formattedUnit\n      };\n    }\n\n    if (text) {\n      return {\n        type: 'literal',\n        value: text\n      };\n    }\n  }).filter(Boolean);\n};\n\nDurationUnitFormat.prototype._formatValue = function (number) {\n  return this.isTimer ? number.toString().padStart(2, '0') : number.toString();\n};\n\nDurationUnitFormat.prototype._trimOutput = function (result, parts) {\n  const trimmed = trim(result, this.isTimer);\n\n  if (!trimmed.find(_ => _.type !== 'literal')) {\n    // if everything cancels out and there are only literals,\n    // then return 0 on the lowest available unit\n    const minUnit = [DurationUnitFormat.units.SECOND, DurationUnitFormat.units.MINUTE, DurationUnitFormat.units.HOUR, DurationUnitFormat.units.DAY].find(unit => has(parts, unit));\n    return this._formatDurationToParts(minUnit, 0);\n  }\n\n  return trimmed;\n};\n\nconst defaultOptions = {\n  // unit: DurationUnitFormat.units.SECOND,\n  formatDuration: '{value} {unit}',\n  formatUnits: {\n    // custom values\n    [DurationUnitFormat.units.DAY]: '{value, plural, one {day} other {days}}',\n    [DurationUnitFormat.units.HOUR]: '{value, plural, one {hour} other {hours}}',\n    [DurationUnitFormat.units.MINUTE]: '{value, plural, one {minute} other {minutes}}',\n    [DurationUnitFormat.units.SECOND]: '{value, plural, one {second} other {seconds}}'\n  },\n  style: DurationUnitFormat.styles.LONG\n};\nconst SPLIT_POINTS = /(\\{value\\}|\\{unit\\})/;\nconst SECONDS_IN = {\n  day: 24 * 60 * 60,\n  hour: 60 * 60,\n  minute: 60,\n  second: 1\n};\n\nfunction has(parts, unit) {\n  return !!parts.find(_ => _.value.unit === unit);\n}\n\nfunction splitSecondsInBuckets(value, valueUnit, parts, shouldRound) {\n  let seconds = value * SECONDS_IN[valueUnit]; // Rounding will only affect the lowest unit\n  // check how many seconds we need to add\n\n  if (shouldRound) {\n    const lowestUnit = [DurationUnitFormat.units.SECOND, DurationUnitFormat.units.MINUTE, DurationUnitFormat.units.HOUR, DurationUnitFormat.units.DAY].find(unit => has(parts, unit)); // These many seconds will be ignored by the lowest unit\n\n    const remainder = seconds % SECONDS_IN[lowestUnit];\n\n    if (2 * remainder >= SECONDS_IN[lowestUnit]) {\n      // The remainder is large, add enough seconds to increse the lowest unit\n      seconds += SECONDS_IN[lowestUnit] - remainder;\n    }\n  }\n\n  const buckets = {};\n  [DurationUnitFormat.units.DAY, DurationUnitFormat.units.HOUR, DurationUnitFormat.units.MINUTE, DurationUnitFormat.units.SECOND].forEach(unit => {\n    if (has(parts, unit)) {\n      buckets[unit] = Math.floor(seconds / SECONDS_IN[unit]);\n      seconds -= buckets[unit] * SECONDS_IN[unit];\n    }\n  });\n  return buckets;\n}\n\nfunction isSpecialStyle(style) {\n  return [DurationUnitFormat.styles.LONG, DurationUnitFormat.styles.SHORT, DurationUnitFormat.styles.NARROW].includes(style);\n}\n\nvar durationUnitFormat_cjs = DurationUnitFormat;\n\nvar EXTENDED_FORMAT = 'EXTENDED_FORMAT';\nvar TIMER_FORMAT = 'TIMER_FORMAT';\n\nfunction DurationMessage(_ref) {\n  var _formatUnits;\n\n  var intl = _ref.intl,\n      seconds = _ref.seconds,\n      format = _ref.format,\n      textComponent = _ref.textComponent,\n      unitDisplay = _ref.unitDisplay,\n      valueComponent = _ref.valueComponent,\n      otherProps = _objectWithoutProperties(_ref, [\"intl\", \"seconds\", \"format\", \"textComponent\", \"unitDisplay\", \"valueComponent\"]);\n\n  var actualFormat = intl.messages[\"react-intl-formatted-duration/custom-format/\".concat(format || '')] || format;\n\n  if (!format || format === EXTENDED_FORMAT) {\n    actualFormat = intl.messages['react-intl-formatted-duration.longFormatting'] || '{minutes} {seconds}';\n  }\n\n  if (format === TIMER_FORMAT) {\n    actualFormat = intl.messages['react-intl-formatted-duration.timerFormatting'] || '{minutes}:{seconds}';\n  }\n\n  var actualSytle = unitDisplay;\n\n  if (!actualSytle) {\n    actualSytle = format === TIMER_FORMAT ? durationUnitFormat_cjs.styles.TIMER : durationUnitFormat_cjs.styles.CUSTOM;\n  }\n\n  var parts = new durationUnitFormat_cjs(intl.locale, {\n    format: actualFormat,\n    formatUnits: (_formatUnits = {}, _defineProperty(_formatUnits, durationUnitFormat_cjs.units.DAY, intl.messages['react-intl-formatted-duration.daysUnit'] || '{value, plural, one {day} other {days}}'), _defineProperty(_formatUnits, durationUnitFormat_cjs.units.HOUR, intl.messages['react-intl-formatted-duration.hoursUnit'] || '{value, plural, one {hour} other {hours}}'), _defineProperty(_formatUnits, durationUnitFormat_cjs.units.MINUTE, intl.messages['react-intl-formatted-duration.minutesUnit'] || '{value, plural, one {minute} other {minutes}}'), _defineProperty(_formatUnits, durationUnitFormat_cjs.units.SECOND, intl.messages['react-intl-formatted-duration.secondsUnit'] || '{value, plural, one {second} other {seconds}}'), _formatUnits),\n    formatDuration: intl.messages['react-intl-formatted-duration.duration'] || '{value} {unit}',\n    round: true,\n    // TODO backward compatible, add a prop to configure it\n    style: actualSytle\n  }).formatToParts(seconds);\n  var Text = textComponent || intl.textComponent;\n  var Value = valueComponent || textComponent || intl.textComponent;\n  return React.createElement(Text, otherProps, parts.map(function (token) {\n    if (token.type === 'literal' || token.type === 'unit') return token.value;\n    return React.createElement(Value, {\n      key: token.type\n    }, token.value);\n  }));\n}\n\nvar index = injectIntl(DurationMessage);\n\nexport default index;\nexport { EXTENDED_FORMAT, TIMER_FORMAT };\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\nimport { IntlMessageFormat } from './src/core';\nexport * from './src/formatters';\nexport * from './src/core';\nexport * from './src/error';\nexport default IntlMessageFormat;\n","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport FileProgress from './file-progress.jsx';\nimport { bytesToHumanSize } from '../lib/strformat.js';\nimport { isUrlRelative, sanitizeUrl } from '../lib/utils.js';\n\nexport default class Attachment extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      downloader: null,\n      progress: 0\n    };\n\n    this.downloadFile = this.downloadFile.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  downloadFile(url, filename, mimetype) {\n    if (!url) {\n      this.props.onError(\"Invalid download URL '\" + url + \"'\");\n      return;\n    }\n\n    const downloader = this.props.tinode.getLargeFileHelper();\n    this.setState({downloader: downloader});\n    downloader.download(url, filename, mimetype,\n      (loaded) => {\n        this.setState({progress: loaded / this.props.size});\n      },\n      (err) => {\n        this.props.onError(err, 'err');\n      }\n    ).then(() => {\n      this.setState({downloader: null, progress: 0});\n    }).catch((err) => {\n      if (err) {\n        this.props.onError(\"Error downloading file: \" + err.message, 'err');\n      }\n      this.setState({downloader: null, progress: 0});\n    });\n  }\n\n  handleCancel() {\n    if (this.props.uploading) {\n      this.props.onCancelUpload();\n    } else if (this.state.downloader) {\n      this.state.downloader.cancel();\n    }\n  }\n\n  render() {\n    let filename = this.props.filename || 'file_attachment';\n    if (filename.length > 36) {\n      filename = filename.substr(0, 16) + '...' + filename.substr(-16);\n    }\n    let size = this.props.size > 0 ?\n      <span className=\"small gray\">({bytesToHumanSize(this.props.size)})</span> :\n      null;\n\n    // Detect if the download URL is relative or absolute.\n    // If the URL is relative use LargeFileHelper to attach authentication\n    // credentials to the request.\n    let url, helperFunc;\n    if (!this.props.uploading && !this.state.downloader && isUrlRelative(this.props.downloadUrl)) {\n      // Relative URL. Use download helper.\n      url = '#';\n      helperFunc = (e) => {\n        e.preventDefault();\n        this.downloadFile(this.props.downloadUrl, this.props.filename, this.props.mimetype);\n      };\n    } else {\n      url = sanitizeUrl(this.props.downloadUrl);\n      helperFunc = null;\n    }\n    const downloadWidget = <><i className=\"material-icons\">file_download</i> <FormattedMessage id=\"save_attachment\"\n      defaultMessage=\"save\" description=\"Call to save an attachment\" /></>;\n    return (\n      <div className=\"attachment\">\n        <div><i className=\"material-icons big gray\">insert_drive_file</i></div>\n        <div className=\"flex-column\">\n          <div>{filename} {size}</div>\n          {this.props.uploading || this.state.downloader ?\n            <FileProgress progress={this.props.uploading ? this.props.progress : this.state.progress}\n              onCancel={this.handleCancel} />\n            :\n            <div>{url ?\n              <a href={url} download={this.props.filename} onClick={helperFunc}>{downloadWidget}</a>\n              :\n              <span className=\"light-gray\">{downloadWidget}</span>\n            }</div>\n          }\n        </div>\n      </div>\n    );\n  }\n};\n","// Received/read indicator.\nimport React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport { deliveryMarker } from '../lib/utils.js';\n\nconst messages = defineMessages({\n  message_sending: {\n    id: 'message_sending',\n    defaultMessage: 'sending...',\n    description: 'Message being sent, in place of time stamp'\n  },\n  message_sending_failed: {\n    id: 'message_sending_failed',\n    defaultMessage: 'failed',\n    description: 'Failed to send message, in place of time stamp'\n  }\n});\n\nclass ReceivedMarker extends React.PureComponent {\n  render() {\n    const {formatMessage} = this.props.intl;\n    let timestamp;\n    if (this.props.received <= Tinode.MESSAGE_STATUS_SENDING) {\n      timestamp = formatMessage(messages.message_sending);\n    } else if (this.props.received == Tinode.MESSAGE_STATUS_FAILED) {\n      timestamp = formatMessage(messages.message_sending_failed);\n    } else {\n      timestamp = this.props.timestamp.toLocaleTimeString(this.props.intl.locale, { timeStyle: 'short' });\n    }\n\n    const icon = deliveryMarker(this.props.received);\n    const marker = icon ? <i className={'material-icons small ' + icon.color}>{icon.name}</i> : null;\n\n    return (\n      <span className=\"timestamp\">\n        {timestamp}{'\\u00a0'}{marker}\n      </span>\n    );\n  }\n};\n\nexport default injectIntl(ReceivedMarker);\n","// Single chat message bubble, sent or received.\n\nimport React from 'react';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport FormattedDuration from 'react-intl-formatted-duration';\nimport { Drafty, Tinode } from 'tinode-sdk';\n\nimport Attachment from './attachment.jsx';\nimport LetterTile from './letter-tile.jsx';\nimport ReceivedMarker from './received-marker.jsx'\n\nimport { fullFormatter } from '../lib/formatters.js';\nimport { isVideoCall, sanitizeUrl } from '../lib/utils.js';\n\nclass BaseChatMessage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      progress: 0\n    };\n\n    if (props.uploader) {\n      props.uploader.onProgress = this.handleProgress.bind(this);\n    }\n\n    this.handleImagePreview = this.handleImagePreview.bind(this);\n    this.handleFormButtonClick = this.handleFormButtonClick.bind(this);\n    this.handleContextClick = this.handleContextClick.bind(this);\n    this.handleCancelUpload = this.handleCancelUpload.bind(this);\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n\n    this.formatterContext = {\n      formatMessage: props.intl.formatMessage.bind(props.intl),\n      viewportWidth: props.viewportWidth,\n      authorizeURL: props.tinode.authorizeURL.bind(props.tinode),\n      onImagePreview: this.handleImagePreview,\n      onFormButtonClick: this.handleFormButtonClick,\n      onQuoteClick: this.handleQuoteClick\n    };\n  }\n\n  handleImagePreview(e) {\n    e.preventDefault();\n    this.props.onImagePreview({\n      url: e.target.src,\n      filename: e.target.title,\n      width: e.target.dataset.width,\n      height: e.target.dataset.height,\n      size: e.target.dataset.size,\n      type: e.target.dataset.mime\n    });\n  }\n\n  handleFormButtonClick(e) {\n    e.preventDefault();\n    const data = {\n      seq: this.props.seq\n    };\n    data.resp = {};\n    if (e.target.dataset.name) {\n      data.resp[e.target.dataset.name] = e.target.dataset.val ? e.target.dataset.val :\n        e.target.dataset.val === undefined ? 1 : '' + e.target.dataset.val;\n    }\n    if (e.target.dataset.act == 'url') {\n      data.ref = sanitizeUrl(e.target.dataset.ref) || 'about:blank';\n    }\n    const text = e.target.dataset.title || 'unknown';\n    this.props.onFormResponse(e.target.dataset.act, text, data);\n  }\n\n  handleContextClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const menuItems = [];\n    if (this.props.received == Tinode.MESSAGE_STATUS_FAILED) {\n      menuItems.push('menu_item_send_retry');\n    }\n    if (this.props.userIsWriter &&\n        this.props.received > Tinode.MESSAGE_STATUS_FAILED &&\n        this.props.received < Tinode.MESSAGE_STATUS_DEL_RANGE) {\n      menuItems.push('menu_item_reply');\n    }\n    menuItems.push('menu_item_forward');\n\n    this.props.showContextMenu({\n      seq: this.props.seq,\n      content: this.props.content,\n      userFrom: this.props.userFrom,\n      userName: this.props.userName,\n      y: e.pageY,\n      x: e.pageX,\n      pickReply: this.props.pickReply\n    }, menuItems);\n  }\n\n  handleProgress(ratio) {\n    this.setState({progress: ratio});\n  }\n\n  handleCancelUpload() {\n    this.props.onCancelUpload(this.props.seq, this.props.uploader);\n  }\n\n  handleQuoteClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const replyToSeq = this.props.replyToSeq;\n    if (replyToSeq) {\n      this.props.onQuoteClick(replyToSeq);\n    }\n  }\n\n  render() {\n    const sideClass = this.props.sequence + ' ' + (this.props.response ? 'left' : 'right');\n    const bubbleClass = (this.props.sequence == 'single' || this.props.sequence == 'last') ? 'bubble tip' : 'bubble';\n    const avatar = this.props.userAvatar || true;\n    const fullDisplay = (this.props.isGroup && this.props.response &&\n      (this.props.sequence == 'single' || this.props.sequence == 'last'));\n\n    let content = this.props.content;\n    const attachments = [];\n    if (this.props.mimeType == Drafty.getContentType() && Drafty.isValid(content)) {\n      Drafty.attachments(content, (att, i) => {\n        if (att.mime == 'application/json') {\n          // Don't show json objects as attachments.\n          // They are not meant for users.\n          return;\n        }\n        attachments.push(<Attachment\n          tinode={this.props.tinode}\n          downloadUrl={Drafty.getDownloadUrl(att)}\n          filename={att.name}\n          uploading={Drafty.isProcessing(att)}\n          mimetype={att.mime}\n          size={Drafty.getEntitySize(att)}\n          progress={this.state.progress}\n          onCancelUpload={this.handleCancelUpload}\n          onError={this.props.onError}\n          key={i} />);\n      }, this);\n      const tree = Drafty.format(content, fullFormatter, this.formatterContext);\n      content = React.createElement(React.Fragment, null, tree);\n    } else if (this.props.deleted) {\n      // Message represents a range of deleted messages.\n      content = <><i className=\"material-icons gray\">block</i> <i className=\"gray\">\n        <FormattedMessage id=\"deleted_content\"\n          defaultMessage=\"content deleted\" description=\"Shown when messages are deleted\" />\n      </i></>\n    } else if (isVideoCall(this.props.mimeType)) {\n      // Video calls.\n      const direction = this.props.response ? \"call_received\" : \"call_made\";\n      const text = this.props.response ?\n        <FormattedMessage id=\"calls_incoming\"\n          defaultMessage=\"Incoming Call\" description=\"Incoming call label\" /> :\n        <FormattedMessage id=\"calls_outgoing\"\n          defaultMessage=\"Outgoing Call\" description=\"Outgoing call label\" />;\n      const isCallDropped = this.props.content == \"disconnected\";\n      content = <><i className=\"material-icons\" style={{color: isCallDropped ? \"red\" : \"green\"}}>{direction}</i>{text}\n        { !isCallDropped ?\n          [' (', <FormattedDuration seconds={this.props.duration / 1000} format=\"{hours} {minutes} {seconds}\" />, ')'] :\n          null}\n      </>\n    } else if (typeof content != 'string') {\n      content = <><i className=\"material-icons gray\">warning_amber</i> <i className=\"gray\">\n        <FormattedMessage id=\"invalid_content\"\n          defaultMessage=\"invalid content\" description=\"Shown when the message is unreadable\" /></i></>\n    }\n\n    return (\n      <li ref={this.props.innerRef} className={sideClass}>\n        {this.props.isGroup && this.props.response ?\n          <div className=\"avatar-box\">\n            {fullDisplay ?\n              <LetterTile\n                tinode={this.props.tinode}\n                topic={this.props.userFrom}\n                title={this.props.userName}\n                avatar={avatar} /> :\n              null}\n          </div> :\n          null}\n        <div>\n          <div className={bubbleClass}>\n            <div className=\"content-meta\">\n              <div className=\"message-content\">\n                {content}\n                {attachments}\n              </div>\n              {this.props.timestamp ?\n                <ReceivedMarker\n                  timestamp={this.props.timestamp}\n                  received={this.props.received} />\n                : null}\n            </div>\n            {this.props.showContextMenu ?\n              <span className=\"menuTrigger\">\n                <a href=\"#\" onClick={this.handleContextClick}>\n                  <i className=\"material-icons\">expand_more</i>\n                </a>\n              </span> : null\n            }\n          </div>\n          {fullDisplay ?\n            <div className=\"author\">\n              {this.props.userName ||\n                <i><FormattedMessage id=\"user_not_found\" defaultMessage=\"Not found\"\n                description=\"In place of a user's full name when the user is not found.\" /></i>\n              }\n            </div>\n            : null\n          }\n        </div>\n      </li>\n    );\n  }\n};\n\nconst IntlChatMessage = injectIntl(BaseChatMessage);\nconst ChatMessage = React.forwardRef((props, ref) => <IntlChatMessage innerRef = {ref} {...props} />);\n\nexport default ChatMessage;\n","// Audio recorder widget.\n\nimport React from 'react';\n\nimport AudioPlayer from './audio-player.jsx';\n// Workaround for https://bugs.chromium.org/p/chromium/issues/detail?id=642012\nimport fixWebmDuration from 'fix-webm-duration';\n\nimport { intArrayToBase64 } from '../lib/blob-helpers.js'\nimport { secondsToTime } from '../lib/strformat';\n\n// FFT resolution.\nconst BUFFER_SIZE = 256;\n// Make canvas bigger than the element size to reduce blurring.\nconst CANVAS_UPSCALING = 2.0;\n// Thickness of a visualization bar.\nconst LINE_WIDTH = 3 * CANVAS_UPSCALING;\n// Spacing between two visualization bars.\nconst SPACING = 2 * CANVAS_UPSCALING;\n// Duration represented by one visualization bar.\nconst MILLIS_PER_BAR = 100;\n// Color of histogram bars\nconst BAR_COLOR = '#bbb';\n// Vertical scaling for visualization bars.\nconst BAR_SCALE = 64.0;\n// Minimum duration of a recording in milliseconds.\nconst MIN_DURATION = 200;\n// Maximum duration of a recording in milliseconds (10 min).\nconst MAX_DURATION = 600000;\n// Number of bars in preview.\nconst VISUALIZATION_BARS = 96;\n// Maximum number of samples per bar.\nconst MAX_SAMPLES_PER_BAR = 10;\n\n// Recording format.\nconst AUDIO_MIME_TYPE = 'audio/webm';\n\nexport default class AudioRecorder extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      enabled: true,\n      audioRecord: null,\n      recording: true,\n      paused: false,\n      duration: '0:00',\n      blobUrl: null,\n      preview: null\n    };\n\n    this.visualize = this.visualize.bind(this);\n    this.initMediaRecording = this.initMediaRecording.bind(this);\n    this.initCanvas = this.initCanvas.bind(this);\n    this.getRecording = this.getRecording.bind(this);\n    this.cleanUp = this.cleanUp.bind(this);\n\n    this.handleResume = this.handleResume.bind(this);\n    this.handlePause = this.handlePause.bind(this);\n    this.handleDelete = this.handleDelete.bind(this);\n    this.handleDone = this.handleDone.bind(this);\n\n    this.durationMillis = 0;\n    this.startedOn = null;\n    this.viewBuffer = [];\n    this.canvasRef = React.createRef();\n  }\n\n  componentDidMount() {\n    this.stream = null;\n    this.mediaRecorder = null;\n    this.audioContext = null;\n    this.audioInput = null;\n    this.analyser = null;\n\n    this.audioChunks = [];\n\n    // Start recorder right away.\n    try {\n      navigator.mediaDevices.getUserMedia({audio: true, video: false}).then(this.initMediaRecording, this.props.onError);\n    } catch (err) {\n      this.props.onError(err);\n    }\n  }\n\n  componentWillUnmount() {\n    this.startedOn = null;\n    if (this.stream) {\n      this.cleanUp();\n    }\n  }\n\n  // Draw amplitude of sound.\n  visualize() {\n    this.initCanvas();\n\n    const pcmData = new Uint8Array(this.analyser.frequencyBinCount);\n    const width = this.canvasWidth;\n    const height = this.canvasHeight;\n    // Number of bars.\n    const viewLength = (width / (LINE_WIDTH + SPACING)) | 0;\n    // Duration of audio which fits onto the screen.\n    const viewDuration = MILLIS_PER_BAR * viewLength;\n\n    this.canvasContext.lineWidth = LINE_WIDTH;\n    this.canvasContext.strokeStyle = BAR_COLOR;\n\n    let prevBarCount = 0;\n    let volume = 0.0;\n    let countPerBar = 0;\n    const drawFrame = () => {\n      if (!this.startedOn) {\n        return;\n      }\n      window.requestAnimationFrame(drawFrame);\n\n      const duration = this.durationMillis + (Date.now() - this.startedOn);\n      // Update record length timer.\n      this.setState({duration: secondsToTime(duration / 1000)});\n\n      // Check if record is too long.\n      if (duration > MAX_DURATION) {\n        this.startedOn = null;\n        this.mediaRecorder.pause();\n        this.durationMillis += Date.now() - this.startedOn;\n        this.setState({enabled: false, recording: false, duration: secondsToTime(this.durationMillis / 1000)});\n      }\n\n      // Draw histogram.\n\n      // Get current waveform and calculate its amplitude.\n      this.analyser.getByteTimeDomainData(pcmData);\n      let amp = 0.0;\n      for (const amplitude of pcmData) {\n        amp += (amplitude - 127) ** 2;\n      }\n\n      // Sum the amplitude.\n      volume += Math.sqrt(amp/pcmData.length);\n      countPerBar ++;\n\n      let barCount = (duration / MILLIS_PER_BAR) | 0;\n      // Shift of the histogram along x-axis to make scrolling smooth. No need to shift if recording is too short.\n      const dx = viewDuration > duration ? 0 :\n        (duration - MILLIS_PER_BAR * barCount) / MILLIS_PER_BAR * (LINE_WIDTH + SPACING);\n\n      if (prevBarCount != barCount) {\n        prevBarCount = barCount;\n        // Add new amplitude visualization bar.\n        this.viewBuffer.push(volume/countPerBar);\n        volume = 0.0;\n        countPerBar = 0;\n        if (this.viewBuffer.length > viewLength) {\n          // Keep at most 'viewLength' amplitude bars.\n          this.viewBuffer.shift();\n        }\n      }\n\n      // Clear canvas.\n      this.canvasContext.clearRect(0, 0, width, height);\n\n      // Draw amplitude bars.\n      this.canvasContext.beginPath();\n      for (let i = 0; i < this.viewBuffer.length; i++) {\n        let x = i * (LINE_WIDTH + SPACING) - dx;\n        let y = Math.min(this.viewBuffer[i] / BAR_SCALE, 0.9) * height;\n\n        this.canvasContext.moveTo(x, (height - y) * 0.5);\n        this.canvasContext.lineTo(x, height * 0.5 + y * 0.5);\n      }\n      // Actually draw the bars on canvas.\n      this.canvasContext.stroke();\n    }\n\n    drawFrame();\n  }\n\n  handlePause(e) {\n    e.preventDefault();\n    this.mediaRecorder.pause();\n    this.mediaRecorder.requestData();\n    this.durationMillis += Date.now() - this.startedOn;\n    this.startedOn = null;\n    this.setState({recording: false});\n  }\n\n  handleResume(e) {\n    e.preventDefault();\n    if (this.state.enabled) {\n      this.startedOn = Date.now();\n      this.mediaRecorder.resume();\n      this.setState({recording: true}, this.visualize);\n    }\n  }\n\n  handleDelete(e) {\n    e.preventDefault();\n    this.durationMillis = 0;\n    this.startedOn = null;\n    this.mediaRecorder.stop();\n    this.cleanUp();\n    this.setState({recording: false});\n  }\n\n  handleDone(e) {\n    e.preventDefault();\n    this.setState({recording: false});\n    if (this.startedOn) {\n      this.durationMillis += Date.now() - this.startedOn;\n      this.startedOn = null;\n    }\n    // Stop recording and return data.\n    if (this.mediaRecorder) {\n      this.mediaRecorder.stop();\n    }\n  }\n\n  initCanvas() {\n    this.canvasRef.current.width = this.canvasRef.current.offsetWidth * CANVAS_UPSCALING;\n    this.canvasRef.current.height = this.canvasRef.current.offsetHeight * CANVAS_UPSCALING;\n\n    this.canvasContext = this.canvasRef.current.getContext('2d');\n    this.canvasContext.lineCap = 'round';\n    // To reduce line blurring.\n    this.canvasContext.translate(0.5, 0.5);\n    this.canvasWidth = this.canvasRef.current.width;\n    this.canvasHeight = this.canvasRef.current.height;\n  }\n\n  initMediaRecording(stream) {\n    this.stream = stream;\n    this.mediaRecorder = new MediaRecorder(stream, {mimeType: AUDIO_MIME_TYPE});\n\n    // The following code is needed for visualization.\n    this.audioContext = new AudioContext();\n    this.audioInput = this.audioContext.createMediaStreamSource(stream);\n    this.analyser = this.audioContext.createAnalyser();\n    this.analyser.fftSize = BUFFER_SIZE;\n    this.audioInput.connect(this.analyser);\n\n    this.mediaRecorder.onstop = _ => {\n      if (this.durationMillis > MIN_DURATION) {\n        this.getRecording(this.mediaRecorder.mimeType, this.durationMillis)\n          .then(result => this.props.onFinished(result.url, result.preview, this.durationMillis));\n      } else {\n        this.props.onDeleted();\n      }\n      this.cleanUp();\n    }\n\n    this.mediaRecorder.ondataavailable = (e) => {\n      if (e.data.size > 0) {\n        this.audioChunks.push(e.data);\n      }\n\n      if (this.mediaRecorder.state != 'inactive') {\n        this.getRecording(this.mediaRecorder.mimeType).then(result => {\n          this.setState({\n            blobUrl: result.url,\n            preview: result.preview\n          });\n        });\n      }\n    }\n\n    this.durationMillis = 0;\n    this.startedOn = Date.now();\n    this.mediaRecorder.start();\n    this.visualize();\n  }\n\n  // Obtain data in a form sutable for sending or playing back.\n  // If duration is valid, apply fix for Chrome's WebM duration bug.\n  getRecording(mimeType, duration) {\n    let blob = new Blob(this.audioChunks, {type: mimeType || AUDIO_MIME_TYPE});\n    return (duration > 0 ? fixWebmDuration(blob, duration, {logger: false}) : Promise.resolve(blob))\n      .then(fixedBlob => { blob = fixedBlob; return fixedBlob.arrayBuffer(); })\n      .then(arrayBuff => this.audioContext.decodeAudioData(arrayBuff))\n      .then(decoded => this.createPreview(decoded))\n      .then(preview => ({url: window.URL.createObjectURL(blob), preview: intArrayToBase64(preview)}));\n  }\n\n  // Preview must be calculated at the source: Chrome does not allow background AudioContext.\n  createPreview(audio) {\n    const data = audio.getChannelData(0);\n    // Number of amplitude bars in preview.\n    const viewLength = Math.min(data.length, VISUALIZATION_BARS);\n    // The number of samples in each bar.\n    const totalSPB = (data.length / viewLength) | 0;\n    // Distance between samples: we are going to take just a fracton of samples.\n    const samplingRate = Math.max(1, (totalSPB / MAX_SAMPLES_PER_BAR) | 0);\n\n    let buffer = [];\n    let max = -1;\n    for (let i = 0; i < viewLength; i++) {\n      let amplitude = 0;\n      let count = 0;\n      for (let j = 0; j < totalSPB; j += samplingRate) {\n        amplitude += data[totalSPB * i + j] ** 2;\n        count ++;\n      }\n      const val = Math.sqrt(amplitude / count);\n      buffer.push(val);\n      max = Math.max(max, val);\n    }\n    // Normalize amplitude to 0..100.\n    if (max > 0) {\n      buffer = buffer.map(a => (100 * a / max) | 0);\n    }\n    return buffer;\n  }\n\n  cleanUp() {\n    this.audioInput.disconnect();\n    this.stream.getTracks().forEach(track => track.stop());\n  }\n\n  render() {\n    const resumeClass = 'material-icons ' + (this.state.enabled ? 'red' : 'gray');\n    return (\n      <div className=\"audio\">\n        <a href=\"#\" onClick={this.handleDelete} title=\"Delete\">\n          <i className=\"material-icons gray\">delete_outline</i>\n        </a>\n        {this.state.recording ?\n          <canvas ref={this.canvasRef} />\n          :\n          <AudioPlayer\n            src={this.state.blobUrl}\n            preview={this.state.preview}\n            duration={this.durationMillis}\n            short={true} />\n        }\n        <div className=\"duration\">{this.state.duration}</div>\n        {this.state.recording ?\n          <a href=\"#\" onClick={this.handlePause} title=\"Pause\">\n            <i className=\"material-icons\">pause_circle_outline</i>\n          </a> :\n          <a href=\"#\" onClick={this.handleResume} title=\"Resume\">\n            <i className={resumeClass}>radio_button_checked</i>\n          </a>\n        }\n        <a href=\"#\" onClick={this.handleDone} title=\"Send\">\n          <i className=\"material-icons\">send</i>\n        </a>\n      </div>\n    );\n  }\n}\n","// Send message form.\nimport React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport { Drafty } from 'tinode-sdk';\n\nimport AudioRecorder from './audio-recorder.jsx';\n\nimport { KEYPRESS_DELAY } from '../config.js';\nimport { filePasted } from '../lib/blob-helpers.js';\nimport { replyFormatter } from '../lib/formatters.js';\n\nconst messages = defineMessages({\n  messaging_disabled: {\n    id: 'messaging_disabled_prompt',\n    defaultMessage: 'Messaging disabled',\n    description: 'Prompt in SendMessage in read-only topic'\n  },\n  type_new_message: {\n    id: 'new_message_prompt',\n    defaultMessage: 'New message',\n    description: 'Prompt in send message field'\n  },\n  add_image_caption: {\n    id: 'image_caption_prompt',\n    defaultMessage: 'Image caption',\n    description: 'Prompt in SendMessage for attached image'\n  },\n  file_attachment_too_large: {\n    id: 'file_attachment_too_large',\n    defaultMessage: 'The file size {size} exceeds the {limit} limit.',\n    description: 'Error message when attachment is too large'\n  },\n  cannot_initiate_upload: {\n    id: 'cannot_initiate_file_upload',\n    defaultMessage: 'Cannot initiate file upload.',\n    description: 'Generic error messagewhen attachment fails'\n  },\n});\n\nclass SendMessage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      quote: null,\n      message: '',\n      audioRec: false,\n      audioAvailable: !!navigator.mediaDevices.getUserMedia,\n      // Make initial keypress time as if it happened 5001 milliseconds in the past.\n      keypressTimestamp: new Date().getTime() - KEYPRESS_DELAY - 1\n    };\n\n    this.handlePasteEvent = this.handlePasteEvent.bind(this);\n    this.handleAttachImage = this.handleAttachImage.bind(this);\n    this.handleAttachFile = this.handleAttachFile.bind(this);\n    this.handleAttachAudio = this.handleAttachAudio.bind(this);\n    this.handleSend = this.handleSend.bind(this);\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    this.handleMessageTyping = this.handleMessageTyping.bind(this);\n\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n\n    this.formatReply = this.formatReply.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.messageEditArea) {\n      this.messageEditArea.addEventListener('paste', this.handlePasteEvent, false);\n    }\n\n    this.setState({quote: this.formatReply()});\n  }\n\n  componentWillUnmount() {\n    if (this.messageEditArea) {\n      this.messageEditArea.removeEventListener('paste', this.handlePasteEvent, false);\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.messageEditArea) {\n      this.messageEditArea.focus();\n    }\n\n    if (prevProps.topicName != this.props.topicName) {\n      this.setState({message: '', audioRec: false, quote: null});\n    } else if (prevProps.reply != this.props.reply) {\n      this.setState({quote: this.formatReply()});\n    }\n  }\n\n  formatReply() {\n    return this.props.reply ?\n      Drafty.format(this.props.reply.content, replyFormatter, {\n        formatMessage: this.props.intl.formatMessage.bind(this.props.intl),\n        authorizeURL: this.props.tinode.authorizeURL.bind(this.props.tinode)\n      }) : null;\n  }\n\n  handlePasteEvent(e) {\n    if (this.props.disabled) {\n      return;\n    }\n    // FIXME: handle large files too.\n    if (filePasted(e,\n      (bits, mime, width, height, fname) => {\n        this.props.onAttachImage(mime, bits, width, height, fname);\n      },\n      (mime, bits, fname) => {\n        this.props.onAttachFile(mime, bits, fname);\n      },\n      this.props.onError)) {\n\n      // If a file was pasted, don't paste base64 data into input field.\n      e.preventDefault();\n    }\n  }\n\n  handleAttachImage(e) {\n    if (e.target.files && e.target.files.length > 0) {\n      this.props.onAttachImage(e.target.files[0]);\n    }\n    // Clear the value so the same file can be uploaded again.\n    e.target.value = '';\n  }\n\n  handleAttachFile(e) {\n    if (e.target.files && e.target.files.length > 0) {\n      this.props.onAttachFile(e.target.files[0]);\n    }\n    // Clear the value so the same file can be uploaded again.\n    e.target.value = '';\n  }\n\n  handleAttachAudio(url, preview, duration) {\n    this.setState({audioRec: false});\n    this.props.onAttachAudio(url, preview, duration);\n  }\n\n  handleSend(e) {\n    e.preventDefault();\n    const message = this.state.message.trim();\n    if (message || this.props.acceptBlank || this.props.noInput) {\n      this.props.onSendMessage(message);\n      this.setState({message: ''});\n    }\n  }\n\n  /* Send on Enter key */\n  handleKeyPress(e) {\n    if (this.state.audioRec) {\n      // Ignore key presses while audio is being recorded.\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n\n    // Remove this if you don't want Enter to trigger send\n    if (e.key === 'Enter') {\n      // Have Shift-Enter insert a line break instead\n      if (!e.shiftKey) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        this.handleSend(e);\n      }\n    }\n  }\n\n  handleMessageTyping(e) {\n    const newState = {message: e.target.value};\n    if (this.props.onKeyPress) {\n      const now = new Date().getTime();\n      if (now - this.state.keypressTimestamp > KEYPRESS_DELAY) {\n        this.props.onKeyPress();\n        newState.keypressTimestamp = now;\n      }\n    }\n    this.setState(newState);\n  }\n\n  handleQuoteClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.props.reply && this.props.onQuoteClick) {\n      const replyToSeq = this.props.reply.seq;\n      this.props.onQuoteClick(replyToSeq);\n    }\n  }\n\n  render() {\n    const { formatMessage } = this.props.intl;\n    const prompt = this.props.disabled ?\n      formatMessage(messages.messaging_disabled) :\n      (this.props.messagePrompt ?\n        formatMessage(messages[this.props.messagePrompt]) :\n        formatMessage(messages.type_new_message));\n\n    const quote =\n      (<div id=\"reply-quote-preview\">\n        <div className=\"cancel\">\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onCancelReply();}}><i className=\"material-icons gray\">close</i></a>\n        </div>\n        {this.state.quote}\n      </div>);\n    const audioEnabled = this.state.audioAvailable && this.props.onAttachAudio;\n    return (\n      <div id=\"send-message-wrapper\">\n        {this.state.quote && !this.props.noInput ? quote : null}\n        <div id=\"send-message-panel\">\n          {!this.props.disabled ?\n            <>\n              {this.props.onAttachFile && !this.state.audioRec ?\n                <>\n                  <a href=\"#\" onClick={(e) => {e.preventDefault(); this.attachImage.click();}} title=\"Add image\">\n                    <i className=\"material-icons secondary\">photo</i>\n                  </a>\n                  <a href=\"#\" onClick={(e) => {e.preventDefault(); this.attachFile.click();}} title=\"Attach file\">\n                    <i className=\"material-icons secondary\">attach_file</i>\n                  </a>\n                </>\n                :\n                null}\n              {this.props.noInput ?\n                (this.state.quote ? quote : <div className=\"hr thin\" />) :\n                (this.state.audioRec ?\n                  <AudioRecorder\n                    onDeleted={_ => this.setState({audioRec: false})}\n                    onFinished={this.handleAttachAudio}/> :\n                  <textarea id=\"sendMessage\" placeholder={prompt}\n                    value={this.state.message} onChange={this.handleMessageTyping}\n                    onKeyPress={this.handleKeyPress}\n                    ref={(ref) => {this.messageEditArea = ref;}}\n                    autoFocus />)}\n              {this.state.message || !audioEnabled ?\n                <a href=\"#\" onClick={this.handleSend} title=\"Send\">\n                  <i className=\"material-icons\">send</i>\n                </a> :\n                !this.state.audioRec ?\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.setState({audioRec: true})}} title=\"Voice\">\n                    <i className=\"material-icons\">mic</i>\n                  </a> :\n                  null\n              }\n              <input type=\"file\" ref={(ref) => {this.attachFile = ref;}}\n                onChange={this.handleAttachFile} style={{display: 'none'}} />\n              <input type=\"file\" ref={(ref) => {this.attachImage = ref;}} accept=\"image/*\"\n                onChange={this.handleAttachImage} style={{display: 'none'}} />\n            </>\n            :\n            <div id=\"writing-disabled\">{prompt}</div>\n          }\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(SendMessage);\n","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport SendMessage from '../widgets/send-message.jsx';\n\nimport { bytesToHumanSize, shortenFileName } from '../lib/strformat.js';\n\n// Get material icon name from mime type.\nfunction iconFromMime(mime) {\n  // If more icons become available in material icons, add them to this mime-to-icon mapping.\n  const mimeToIcon = {default: 'insert_drive_file', image: 'image', text: 'description', video: 'theaters'};\n\n  return mimeToIcon[mime] || mimeToIcon[(mime || '').split('/')[0]] || mimeToIcon['default'];\n}\n\nexport default class DocPreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleSendDoc = this.handleSendDoc.bind(this);\n  }\n\n  handleSendDoc(caption) {\n    this.props.onClose();\n    this.props.onSendMessage(this.props.content.file);\n  }\n\n  render() {\n    if (!this.props.content) {\n      return null;\n    }\n    return (\n      <div id=\"image-preview\">\n        <div id=\"image-preview-caption-panel\">\n          <span>{this.props.content.name}</span>\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\n        </div>\n        <div id=\"image-preview-container\">\n          <div className=\"flex-column narrow\">\n            <i className=\"material-icons gray\">{iconFromMime(this.props.content.type)}</i>\n            <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\n              description=\"Label for a file name\" /></b> {shortenFileName(this.props.content.name, 24) || '-'}</div>\n            <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\n              description=\"Label for file content type (mime)\" /></b> {this.props.content.type || 'application/octet-stream'}</div>\n            <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\n              description=\"Label for file size\" /></b> {bytesToHumanSize(this.props.content.size)}</div>\n          </div>\n        </div>\n        <SendMessage\n          noInput={true}\n          tinode={this.props.tinode}\n          reply={this.props.reply}\n          onCancelReply={this.props.onCancelReply}\n          onSendMessage={this.handleSendDoc}\n          onError={this.props.onError} />\n      </div>\n    );\n  }\n};\n","// GroupSubs: a list of group subscribers currently online.\n// Show in the topic title bar\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { MAX_ONLINE_IN_TOPIC } from '../config.js'\n\nimport LetterTile from './letter-tile.jsx';\nimport { makeImageUrl } from '../lib/blob-helpers.js';\n\nexport default class GroupSubs extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const usersOnline = [];\n    const totalCount = (this.props.subscribers || []).length;\n    const countToShow = Math.min(MAX_ONLINE_IN_TOPIC, totalCount);\n\n    (this.props.subscribers || []).some((sub) => {\n      usersOnline.push(\n        <div className=\"avatar-box\" key={sub.user}>\n          <LetterTile\n            tinode={this.props.tinode}\n            topic={sub.user}\n            avatar={makeImageUrl(sub.public ? sub.public.photo : null) || true}\n            title={sub.public ? sub.public.fn : null} />\n        </div>\n      );\n      return usersOnline.length == countToShow;\n    });\n\n    return (\n      <div id=\"topic-users\">{usersOnline} {totalCount > countToShow ?\n        <span>\n          <FormattedMessage id=\"more_online_members\" defaultMessage=\"+{overflow} more\"\n              description=\"Shown in MessagesView title bar when the number of online subscribers exceeds MAX_ONLINE_IN_TOPIC\"\n              values={{ overflow: (totalCount - countToShow) }} />\n        </span> : null}\n      </div>\n    );\n  }\n};\n","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport SendMessage from '../widgets/send-message.jsx';\n\nimport { REM_SIZE } from '../config.js';\nimport { fitImageSize } from '../lib/blob-helpers.js';\nimport { bytesToHumanSize, shortenFileName } from '../lib/strformat.js';\n\nexport default class ImagePreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      width: 0,\n      height: 0\n    };\n\n    this.handleSendImage = this.handleSendImage.bind(this);\n  }\n\n  assignWidth(node) {\n    if (node && !this.state.width) {\n      const bounds = node.getBoundingClientRect();\n      this.setState({\n        width: bounds.width | 0,\n        height: bounds.height | 0\n      });\n    }\n  }\n\n  handleSendImage(caption) {\n    this.props.onClose();\n    this.props.onSendMessage(caption, this.props.content.blob);\n  }\n\n  render() {\n    if (!this.props.content) {\n      return null;\n    }\n\n    const dim = fitImageSize(this.props.content.width, this.props.content.height,\n      this.state.width, this.state.height, false);\n    const size = dim ? { width: dim.dstWidth + 'px', height: dim.dstHeight + 'px' } :\n      ((this.props.content.width > this.props.content.height) ? {width: '100%'} : {height: '100%'});\n    size.maxWidth = '100%';\n    size.maxHeight = '100%';\n\n    // Average font aspect ratio is ~0.5; File name takes 1/3 of the viewport width.\n    const maxlength = Math.max(((this.state.width / REM_SIZE / 1.5) | 0) - 2, 12);\n    const fname = shortenFileName(this.props.content.name, maxlength) || '-';\n\n    const width = this.props.content.width || '-';\n    const height = this.props.content.height || '-';\n    return (\n      <div id=\"image-preview\">\n        <div id=\"image-preview-caption-panel\">\n          {!this.props.onSendMessage ?\n            <a href={this.props.content.url} download={true}>\n              <i className=\"material-icons\">file_download</i> <FormattedMessage\n                id=\"download_action\" defaultMessage=\"download\" description=\"Call to action [download]\" />\n            </a>\n            :\n            <span>{fname}</span>\n          }\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\n        </div>\n        <div id=\"image-preview-container\" ref={(node) => this.assignWidth(node)}>\n          <img src={this.props.content.url} style={size} className=\"image-preview\" alt={this.props.content.name} />\n        </div>\n        {this.props.onSendMessage ?\n          <SendMessage\n            messagePrompt=\"add_image_caption\"\n            acceptBlank={true}\n            tinode={this.props.tinode}\n            reply={this.props.reply}\n            onCancelReply={this.props.onCancelReply}\n            onSendMessage={this.handleSendImage}\n            onError={this.props.onError} />\n          :\n          <div id=\"image-preview-footer\">\n            <div>\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\n                description=\"Label for a file name\" /></b></div>\n              <div><span title={this.props.content.name}>{fname}</span></div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\n                description=\"Label for file content type (mime)\" /></b></div>\n              <div>{this.props.content.type}</div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\n                description=\"Label for file size\" /></b></div>\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\n            </div>\n          </div>}\n      </div>\n    );\n  }\n};\n","// A single topic or user.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport default class Invitation extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleButtonAction = this.handleButtonAction.bind(this);\n  }\n\n  handleButtonAction(evt, data) {\n    evt.preventDefault();\n    this.props.onAction(data);\n  }\n\n  render() {\n    return (\n      <div className=\"accept-invite-panel\">\n        <div className=\"title\">\n          <FormattedMessage id=\"chat_invitation\"\n            defaultMessage=\"You are invited to start a new chat. What would you like to do?\"\n            description=\"New chat invitation message: [Accept] [Ignore] [Block].\" />\n        </div>\n        <div className=\"footer\">\n          <button className=\"primary\" onClick={event => { this.handleButtonAction(event, \"accept\"); }}>\n            <FormattedMessage id=\"chat_invitation_accept\"\n              defaultMessage=\"Accept\" description=\"Action [Accept] for chat invitation.\" />\n          </button>\n          <button className=\"secondary\" onClick={event => { this.handleButtonAction(event, \"delete\"); }}>\n            <FormattedMessage id=\"chat_invitation_ignore\"\n              defaultMessage=\"Ignore\" description=\"Action [Ignore] for chat invitation.\" />\n          </button>\n          <button className=\"secondary\" onClick={event => { this.handleButtonAction(event, \"block\"); }}>\n            <FormattedMessage id=\"chat_invitation_block\"\n              defaultMessage=\"Block\" description=\"Action [Block] for chat invitation.\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n","/* This is just a static page to display when no conversation is selected. */\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport { APP_NAME } from '../config.js';\n\nexport default class LogoView extends React.PureComponent {\n  render() {\n    const version = APP_NAME + ' (' + Tinode.getLibrary() + ')';\n    return (\n      <div id=\"dummy-view\">\n        <div>\n          <a href=\"https://github.com/tinode/chat/\">\n            <img id=\"logo\" alt=\"logo\" src=\"img/logo.svg\" />\n            <h2>Tinode Web</h2>\n          </a>\n          <p><FormattedMessage id=\"label_client\" defaultMessage=\"Client:\"\n            description=\"Label for a client version\" /> {version}</p>\n          <p><FormattedMessage id=\"label_server\" defaultMessage=\"Server:\"\n            description=\"Label for a server version\" /> {this.props.serverVersion} ({this.props.serverAddress})</p>\n        </div>\n      </div>\n    );\n  }\n};\n","// Message bubble with non-payload content, such as an indicator of deleted content or a date stamp.\n\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport default class MetaMessage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    let content = null;\n    let bubbleClass = 'bubble';\n    if (this.props.deleted) {\n      // Message represents a range of deleted messages.\n      content = <><i className=\"material-icons gray\">block</i> <i className=\"gray\">\n        <FormattedMessage id=\"deleted_content\"\n          defaultMessage=\"content deleted\" description=\"Shown when messages are deleted\" />\n      </i></>\n      bubbleClass += ' deleted';\n    } else if (this.props.date) {\n      // A date badge.\n      content = <>{this.props.date}</>\n      bubbleClass += ' date';\n    }\n\n    if (!content) {\n      return <>{null}</>\n    }\n\n    return (\n      <li className=\"meta\">\n        <div className={bubbleClass}>\n          <div className=\"message-content\">\n            {content}\n          </div>\n        </div>\n      </li>\n    );\n  }\n};\n","// Utility class for hash navigation.\n\n// Parse hash as in http://www.example.com/path#hash as if it were\n// path and arguments.\nexport default class HashNavigation {\n  static parseUrlHash(hash) {\n    // Split path from args, path -> parts[0], args->path[1]\n    const parts = hash.split('?', 2);\n    const params = {};\n    let path = [];\n    if (parts[0]) {\n      path = parts[0].replace('#', '').split('/');\n    }\n    if (parts[1]) {\n      parts[1].split('&').forEach(function(part) {\n        const item = part.split('=');\n        if (item[0]) {\n          params[decodeURIComponent(item[0])] = decodeURIComponent(item[1]);\n        }\n      });\n    }\n    return {path: path, params: params};\n  }\n\n  static navigateTo(url) {\n    window.location.hash = url;\n  }\n\n  static composeUrlHash(path, params) {\n    let url = path.join('/');\n    const args = [];\n    for (const key in params) {\n      if (params.hasOwnProperty(key)) {\n        args.push(key + '=' + params[key]);\n      }\n    }\n    if (args.length > 0) {\n      url += '?' + args.join('&');\n    }\n    return url;\n  }\n\n  static addUrlParam(hash, key, value) {\n    const parsed = this.parseUrlHash(hash);\n    parsed.params[key] = value;\n    return this.composeUrlHash(parsed.path, parsed.params);\n  }\n\n  static removeUrlParam(hash, key) {\n    const parsed = this.parseUrlHash(hash);\n    delete parsed.params[key];\n    return this.composeUrlHash(parsed.path, parsed.params);\n  }\n\n  static setUrlSidePanel(hash, sidepanel) {\n    const parsed = this.parseUrlHash(hash);\n    parsed.path[0] = sidepanel;\n    return this.composeUrlHash(parsed.path, parsed.params);\n  }\n\n  static setUrlInfoPanel(hash, infopanel) {\n    const parsed = this.parseUrlHash(hash);\n    if (infopanel) {\n      parsed.params.info = infopanel;\n    } else {\n      delete parsed.params.info;\n    }\n    return this.composeUrlHash(parsed.path, parsed.params);\n  }\n\n  static setUrlTopic(hash, topic) {\n    const parsed = this.parseUrlHash(hash);\n    parsed.path[1] = topic;\n    // Close InfoView on topic change.\n    delete parsed.params.info;\n    return this.composeUrlHash(parsed.path, parsed.params);\n  }\n}\n","// Panel with a chat.\n\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport { Drafty, Tinode } from 'tinode-sdk';\n\nimport CallPanel from '../widgets/call-panel.jsx';\nimport ChatMessage from '../widgets/chat-message.jsx';\nimport ContactBadges from '../widgets/contact-badges.jsx';\nimport DocPreview from '../widgets/doc-preview.jsx';\nimport ErrorPanel from '../widgets/error-panel.jsx';\nimport GroupSubs from '../widgets/group-subs.jsx';\nimport ImagePreview from '../widgets/image-preview.jsx';\nimport Invitation from '../widgets/invitation.jsx';\nimport LetterTile from '../widgets/letter-tile.jsx';\nimport LoadSpinner from '../widgets/load-spinner.jsx';\nimport LogoView from './logo-view.jsx';\nimport MetaMessage from '../widgets/meta-message.jsx';\nimport SendMessage from '../widgets/send-message.jsx';\n\nimport { DEFAULT_P2P_ACCESS_MODE, IMAGE_PREVIEW_DIM, KEYPRESS_DELAY,\n  MESSAGES_PAGE, MAX_EXTERN_ATTACHMENT_SIZE, MAX_IMAGE_DIM, MAX_INBAND_ATTACHMENT_SIZE,\n  READ_DELAY, QUOTED_REPLY_LENGTH, CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS } from '../config.js';\nimport { blobToBase64, fileToBase64, imageScaled, makeImageUrl } from '../lib/blob-helpers.js';\nimport HashNavigation from '../lib/navigation.js';\nimport { bytesToHumanSize, shortDateFormat } from '../lib/strformat.js';\n\n// Run timer with this frequency (ms) for checking notification queue.\nconst NOTIFICATION_EXEC_INTERVAL = 300;\n// Scroll distance before [go to latest message] button is shown.\nconst SHOW_GO_TO_LAST_DIST = 100;\n\nconst messages = defineMessages({\n  online_now: {\n    id: 'online_now',\n    defaultMessage: 'online now',\n    description: 'Indicator that the user or topic is currently online',\n  },\n  last_seen: {\n    id: 'last_seen_timestamp',\n    defaultMessage: 'Last seen',\n    description: 'Label for the timestamp of when the user or topic was last online'\n  },\n  not_found: {\n    id: 'title_not_found',\n    defaultMessage: 'Not found',\n    description: 'Title shown when topic is not found'\n  },\n  channel: {\n    id: 'channel',\n    defaultMessage: 'channel',\n    description: 'Subtitle shown for channels in MessagesView instead of last seen'\n  },\n  file_attachment_too_large: {\n    id: 'file_attachment_too_large',\n    defaultMessage: 'The file size {size} exceeds the {limit} limit.',\n    description: 'Error message when attachment is too large'\n  },\n  invalid_content: {\n    id: 'invalid_content',\n    defaultMessage: 'invalid content',\n    description: 'Shown when the message is unreadable'\n  },\n});\n\n// Checks if the access permissions are granted but not yet accepted.\nfunction isUnconfirmed(acs) {\n  if (acs) {\n    const ex = acs.getExcessive() || '';\n    return acs.isJoiner('given') && (ex.includes('R') || ex.includes('W'));\n  }\n  return false;\n}\n\nfunction isPeerRestricted(acs) {\n  if (acs) {\n    const ms = acs.getMissing() || '';\n    return acs.isJoiner('want') && (ms.includes('R') || ms.includes('W'));\n  }\n  return false;\n}\n\nfunction shouldPresentCallPanel(callState) {\n  // Show call panel if either:\n  // - call is outgoing (and the client is waiting for the other side to pick up) or,\n  // - call is already in progress.\n  return callState == CALL_STATE_OUTGOING_INITATED || callState == CALL_STATE_IN_PROGRESS;\n}\n\nclass MessagesView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = MessagesView.getDerivedStateFromProps(props, {});\n\n    this.leave = this.leave.bind(this);\n    this.sendMessage = this.sendMessage.bind(this);\n    this.retrySend = this.retrySend.bind(this);\n    this.sendImageAttachment = this.sendImageAttachment.bind(this);\n    this.sendFileAttachment = this.sendFileAttachment.bind(this);\n    this.sendAudioAttachment = this.sendAudioAttachment.bind(this);\n    this.sendKeyPress = this.sendKeyPress.bind(this);\n    this.subscribe = this.subscribe.bind(this);\n    this.handleScrollReference = this.handleScrollReference.bind(this);\n    this.handleScrollEvent = this.handleScrollEvent.bind(this);\n    this.handleDescChange = this.handleDescChange.bind(this);\n    this.handleSubsUpdated = this.handleSubsUpdated.bind(this);\n    this.handleMessageUpdate = this.handleMessageUpdate.bind(this);\n    this.handleAllMessagesReceived = this.handleAllMessagesReceived.bind(this);\n    this.handleInfoReceipt = this.handleInfoReceipt.bind(this);\n    this.handleImagePostview = this.handleImagePostview.bind(this);\n    this.handleClosePreview = this.handleClosePreview.bind(this);\n    this.handleFormResponse = this.handleFormResponse.bind(this);\n    this.handleContextClick = this.handleContextClick.bind(this);\n    this.handleShowMessageContextMenu = this.handleShowMessageContextMenu.bind(this);\n    this.handleNewChatAcceptance = this.handleNewChatAcceptance.bind(this);\n    this.handleEnablePeer = this.handleEnablePeer.bind(this);\n    this.handleAttachFile = this.handleAttachFile.bind(this);\n    this.handleAttachImage = this.handleAttachImage.bind(this);\n    this.handleCancelUpload = this.handleCancelUpload.bind(this);\n    this.postReadNotification = this.postReadNotification.bind(this);\n    this.clearNotificationQueue = this.clearNotificationQueue.bind(this);\n    this.goToLatestMessage = this.goToLatestMessage.bind(this);\n\n    this.handlePickReply = this.handlePickReply.bind(this);\n    this.handleCancelReply = this.handleCancelReply.bind(this);\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n    this.handleCallHangup = this.handleCallHangup.bind(this);\n\n    this.chatMessageRefs = {};\n    this.getOrCreateMessageRef = this.getOrCreateMessageRef.bind(this);\n\n    this.readNotificationQueue = [];\n    this.readNotificationTimer = null;\n  }\n\n  getOrCreateMessageRef(seqId) {\n    if (this.chatMessageRefs.hasOwnProperty(seqId)) {\n      return this.chatMessageRefs[seqId];\n    }\n    const ref = React.createRef();\n    this.chatMessageRefs[seqId] = ref;\n    return ref;\n  }\n\n  componentDidMount() {\n    if (this.messagesScroller) {\n      this.messagesScroller.addEventListener('scroll', this.handleScrollEvent);\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.messagesScroller) {\n      this.messagesScroller.removeEventListener('scroll', this.handleScrollEvent);\n    }\n\n    // Flush all notifications.\n    this.clearNotificationQueue();\n  }\n\n  // Scroll last message into view on component update e.g. on message received\n  // or vertical shrinking.\n  componentDidUpdate(prevProps, prevState) {\n    if (this.messagesScroller &&\n      (prevState.topic != this.state.topic || prevState.messageCount != this.state.messageCount)) {\n      // New message.\n      if (this.state.scrollPosition < SHOW_GO_TO_LAST_DIST) {\n        this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight -\n          this.state.scrollPosition -\n          this.messagesScroller.offsetHeight;\n      }\n    }\n\n    const topic = this.props.tinode ? this.props.tinode.getTopic(this.state.topic) : undefined;\n    if (this.state.topic != prevState.topic) {\n      if (prevState.topic && !Tinode.isNewGroupTopicName(prevState.topic)) {\n        this.leave(prevState.topic);\n        if (prevState.rtcPanel) {\n          console.log('hangup: ', prevState.topic);\n          this.handleCallHangup(prevState.topic, prevProps.callSeq);\n        }\n      }\n\n      if (topic) {\n        topic.onData = this.handleMessageUpdate;\n        topic.onAllMessagesReceived = this.handleAllMessagesReceived;\n        topic.onInfo = this.handleInfoReceipt;\n        topic.onMetaDesc = this.handleDescChange;\n        topic.onSubsUpdated = this.handleSubsUpdated;\n        topic.onPres = this.handleSubsUpdated;\n      }\n    }\n\n    if (!this.props.applicationVisible) {\n      // If application is not visible, flush all unsent 'read' notifications.\n      this.clearNotificationQueue();\n    } else {\n      // Otherwise assume there are unread messages.\n      this.postReadNotification(0);\n    }\n\n    if (topic && ((this.state.topic != prevState.topic) || !prevProps.ready)) {\n      // Don't immediately subscribe to a new p2p topic, wait for the first message.\n      if (topic._new && topic.isP2PType()) {\n        topic.getMeta(topic.startMetaQuery().withDesc().build());\n      } else {\n        this.subscribe(topic);\n      }\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    let nextState = {};\n    if (!nextProps.topic) {\n      // Default state: no topic.\n      nextState = {\n        messageCount: 0,\n        latestClearId: -1,\n        onlineSubs: [],\n        topic: null,\n        title: '',\n        avatar: null,\n        isVerified: false,\n        isStaff: false,\n        isDangerous: false,\n        deleted: false,\n        docPreview: null,\n        imagePreview: null,\n        imagePostview: null,\n        rtcPanel: null,\n        typingIndicator: false,\n        scrollPosition: 0,\n        fetchingMessages: false,\n        peerMessagingDisabled: false,\n        channel: false,\n        reply: null,\n        showGoToLastButton: false\n      };\n    } else if (nextProps.topic != prevState.topic) {\n      const topic = nextProps.tinode.getTopic(nextProps.topic);\n\n      let reply = null;\n      if (nextProps.forwardMessage) {\n        // We are forwarding a message. Show preview.\n        const preview = nextProps.forwardMessage.preview;\n        reply = {\n          content: preview,\n          seq: null\n        };\n      }\n\n      nextState = {\n        topic: nextProps.topic,\n        docPreview: null,\n        imagePreview: null,\n        imagePostview: null,\n        rtcPanel: null,\n        typingIndicator: false,\n        scrollPosition: 0,\n        fetchingMessages: false,\n        reply: reply,\n        showGoToLastButton: false,\n        deleted: topic._deleted\n      };\n\n      if (topic) {\n        // Topic exists.\n        const subs = [];\n\n        if (nextProps.connected) {\n          topic.subscribers((sub) => {\n            if (sub.online && sub.user != nextProps.myUserId) {\n              subs.push(sub);\n            }\n          });\n        }\n\n        Object.assign(nextState, {\n          onlineSubs: subs\n        });\n\n        if (topic.public) {\n          Object.assign(nextState, {\n            title: topic.public.fn,\n            avatar: makeImageUrl(topic.public.photo)\n          });\n        } else {\n          Object.assign(nextState, {\n            title: '',\n            avatar: null\n          });\n        }\n\n        const peer = topic.p2pPeerDesc();\n        if (peer) {\n          Object.assign(nextState, {\n            peerMessagingDisabled: isPeerRestricted(peer.acs)\n          });\n        } else if (prevState.peerMessagingDisabled) {\n          Object.assign(nextState, {\n            peerMessagingDisabled: false\n          });\n        }\n        Object.assign(nextState, {\n          messageCount: topic.messageCount(),\n          latestClearId: topic.maxClearId(),\n          channel: topic.isChannelType()\n        });\n\n        if (nextProps.callTopic == topic.name && shouldPresentCallPanel(nextProps.callState)) {\n          Object.assign(nextState, {\n            rtcPanel: nextProps.callTopic,\n          });\n        }\n      } else {\n        // Invalid topic.\n        Object.assign(nextState, {\n          messageCount: 0,\n          latestClearId: -1,\n          onlineSubs: [],\n          title: '',\n          avatar: null,\n          peerMessagingDisabled: false,\n          channel: false\n        });\n      }\n    } else {\n      // We are still in same topic. Show the call panel if necessary.\n      if (nextProps.callTopic == prevState.topic && !prevState.rtcPanel &&\n          shouldPresentCallPanel(nextProps.callState)) {\n        Object.assign(nextState, {\n          rtcPanel: nextProps.callTopic,\n        });\n      }\n    }\n\n    if (nextProps.acs) {\n      if (nextProps.acs.isWriter() != prevState.isWriter) {\n        nextState.isWriter = !prevState.isWriter;\n      }\n      if (nextProps.acs.isReader() != prevState.isReader) {\n        nextState.isReader = !prevState.isReader;\n      }\n      if (!nextProps.acs.isReader('given') != prevState.readingBlocked) {\n        nextState.readingBlocked = !prevState.readingBlocked;\n      }\n      if (nextProps.acs.isSharer() != prevState.isSharer) {\n        nextState.isSharer = !prevState.isSharer;\n      }\n    } else {\n      if (prevState.isWriter) {\n        nextState.isWriter = false;\n      }\n      if (prevState.isReader) {\n        nextState.isReader = false;\n      }\n      if (!prevState.readingBlocked) {\n        prevState.readingBlocked = true;\n      }\n      if (prevState.isSharer) {\n        nextState.isSharer = false;\n      }\n    }\n\n    if (isUnconfirmed(nextProps.acs) == !prevState.unconformed) {\n      nextState.unconfirmed = !prevState.unconformed;\n    }\n\n    // Clear subscribers online when there is no connection.\n    if (!nextProps.connected && prevState.onlineSubs && prevState.onlineSubs.length > 0) {\n      nextState.onlineSubs = [];\n    }\n\n    return nextState;\n  }\n\n  subscribe(topic) {\n    if (topic.isSubscribed() || !this.props.ready) {\n      return;\n    }\n\n    // Is this a new topic?\n    const newTopic = (this.props.newTopicParams && this.props.newTopicParams._topicName == this.props.topic);\n\n    // Don't request the tags. They are useless unless the user\n    // is the owner and is editing the topic.\n    let getQuery = topic.startMetaQuery().withLaterDesc().withLaterSub();\n    if (this.state.isReader || newTopic) {\n      // Reading is either permitted or we don't know because it's a new topic. Ask for messages.\n      getQuery = getQuery.withLaterData(MESSAGES_PAGE);\n      if (this.state.isReader) {\n        getQuery = getQuery.withLaterDel();\n      }\n      // And show \"loading\" spinner.\n      this.setState({ fetchingMessages: true });\n    }\n\n    const setQuery = newTopic ? this.props.newTopicParams : undefined;\n    topic.subscribe(getQuery.build(), setQuery)\n      .then((ctrl) => {\n        if (ctrl.code == 303) {\n          // Redirect to another topic requested.\n          HashNavigation.navigateTo(HashNavigation.setUrlTopic('', ctrl.params.topic));\n          return;\n        }\n        if (this.state.topic != ctrl.topic) {\n          this.setState({topic: ctrl.topic});\n        }\n        this.props.onNewTopicCreated(this.props.topic, ctrl.topic);\n        // If there are unsent messages, try sending them now.\n        topic.queuedMessages((pub) => {\n          if (pub._sending) {\n            return;\n          }\n          if (topic.isSubscribed()) {\n            this.retrySend(pub);\n          }\n        });\n      })\n      .catch((err) => {\n        console.error(\"Failed subscription to\", this.state.topic, err);\n        this.props.onError(err.message, 'err');\n        const blankState = MessagesView.getDerivedStateFromProps({}, {});\n        blankState.title = this.props.intl.formatMessage(messages.not_found);\n        this.setState(blankState);\n      });\n  }\n\n  leave(oldTopicName) {\n    if (!oldTopicName || !this.props.tinode.isTopicCached(oldTopicName)) {\n      return;\n    }\n\n    const oldTopic = this.props.tinode.getTopic(oldTopicName);\n    if (oldTopic && oldTopic.isSubscribed()) {\n      oldTopic.leave(false)\n        .catch(() => { /* do nothing here */ })\n        .finally(() => {\n          // We don't care if the request succeeded or failed.\n          // The topic is dead regardless.\n          this.setState({fetchingMessages: false});\n          oldTopic.onData = undefined;\n          oldTopic.onAllMessagesReceived = undefined;\n          oldTopic.onInfo = undefined;\n          oldTopic.onMetaDesc = undefined;\n          oldTopic.onSubsUpdated = undefined;\n          oldTopic.onPres = undefined;\n        });\n    }\n  }\n\n  // Don't use React.createRef as the ref.current is not available in componentDidMount in this component.\n  handleScrollReference(node) {\n    if (node) {\n      node.addEventListener('scroll', this.handleScrollEvent);\n      this.messagesScroller = node;\n      this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight - this.state.scrollPosition;\n    }\n  }\n\n  // Get older messages and show/hide [go to latest message] button.\n  handleScrollEvent(event) {\n    const pos = event.target.scrollHeight - event.target.scrollTop - event.target.offsetHeight;\n    this.setState({\n      scrollPosition: pos,\n      showGoToLastButton: pos > SHOW_GO_TO_LAST_DIST,\n    });\n\n    if (this.state.fetchingMessages) {\n      return;\n    }\n\n    if (event.target.scrollTop <= 0) {\n      const topic = this.props.tinode.getTopic(this.state.topic);\n      if (topic && topic.isSubscribed() && topic.msgHasMoreMessages()) {\n        this.setState({fetchingMessages: true}, () => {\n          topic.getMessagesPage(MESSAGES_PAGE)\n            .catch((err) => this.props.onError(err.message, 'err'))\n            .finally(() => this.setState({fetchingMessages: false}));\n          });\n      }\n    }\n  }\n\n  goToLatestMessage() {\n    this.setState({scrollPosition: 0});\n    if (this.messagesScroller) {\n      this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight;\n    }\n  }\n\n  handleDescChange(desc) {\n    if (desc.public) {\n      this.setState({\n        title: desc.public.fn,\n        avatar: makeImageUrl(desc.public.photo)\n      });\n    } else {\n      this.setState({\n        title: '',\n        avatar: null\n      });\n    }\n\n    if (desc.acs) {\n      this.setState({\n        isWriter: desc.acs.isWriter(),\n        isReader: desc.acs.isReader(),\n        readingBlocked: !desc.acs.isReader('given'),\n        unconfirmed: isUnconfirmed(desc.acs),\n      });\n    }\n  }\n\n  postReadNotification(seq) {\n    // Ignore notifications if the app is invisible.\n    if (!this.props.applicationVisible) {\n      return;\n    }\n\n    // Set up the timer if it's not running already.\n    if (!this.readNotificationTimer) {\n      this.readNotificationTimer = setInterval(() => {\n        if (this.readNotificationQueue.length == 0) {\n          // Shut down the timer if the queue is empty.\n          clearInterval(this.readNotificationTimer);\n          this.readNotificationTimer = null;\n          return;\n        }\n\n        let seq = -1;\n        while (this.readNotificationQueue.length > 0) {\n          const n = this.readNotificationQueue[0];\n          if (n.topicName != this.state.topic) {\n            // Topic has changed. Drop the notification.\n            this.readNotificationQueue.shift();\n            continue;\n          }\n\n          const now = new Date();\n          if (n.sendAt <= now) {\n            // Remove expired notification from queue.\n            this.readNotificationQueue.shift();\n            seq = Math.max(seq, n.seq);\n          } else {\n            break;\n          }\n        }\n\n        // Send only one notification for the whole batch of messages.\n        if (seq >= 0) {\n          const topic = this.props.tinode.getTopic(this.state.topic);\n          if (topic) {\n            topic.noteRead(seq);\n          }\n        }\n      }, NOTIFICATION_EXEC_INTERVAL);\n    }\n\n    const now = new Date();\n    this.readNotificationQueue.push({\n      topicName: this.state.topic,\n      seq: seq,\n      sendAt: now.setMilliseconds(now.getMilliseconds() + READ_DELAY)\n    });\n  }\n\n  // Clear notification queue and timer.\n  clearNotificationQueue() {\n    this.readNotificationQueue = [];\n    if (this.readNotificationTimer) {\n      clearInterval(this.readNotificationTimer);\n      this.readNotificationTimer = null;\n    }\n  }\n\n  handleSubsUpdated() {\n    if (this.state.topic) {\n      const subs = [];\n      const topic = this.props.tinode.getTopic(this.state.topic);\n      topic.subscribers((sub) => {\n        if (sub.online && sub.user != this.props.myUserId) {\n          subs.push(sub);\n        }\n      });\n      const newState = {onlineSubs: subs};\n      const peer = topic.p2pPeerDesc();\n      if (peer) {\n        Object.assign(newState, {\n          peerMessagingDisabled: isPeerRestricted(peer.acs)\n        });\n      } else if (this.state.peerMessagingDisabled) {\n        Object.assign(newState, {\n          peerMessagingDisabled: false\n        });\n      }\n      this.setState(newState);\n    }\n  }\n\n  // The 'msg' could be false-ish if some message ranges were deleted.\n  handleMessageUpdate(msg) {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    if (!msg) {\n      // msg could be null if one or more messages were deleted.\n      // Updating state to force redraw.\n      this.setState({latestClearId: topic.maxClearId()});\n      return;\n    }\n\n    clearTimeout(this.keyPressTimer)\n    this.setState({messageCount: topic.messageCount(), typingIndicator: false});\n\n    // Scroll to the bottom if the message is added to the end of the message list.\n    // TODO: This should be replaced by showing a \"scroll to bottom\" button.\n    if (topic.isNewMessage(msg.seq)) {\n      if (this.state.scrollPosition > SHOW_GO_TO_LAST_DIST) {\n        this.setState({showGoToLastButton: true});\n      } else {\n        this.setState({scrollPosition: 0});\n      }\n    }\n\n    // Aknowledge messages except own messages. They are\n    // automatically assumed to be read and recived.\n    const status = topic.msgStatus(msg, true);\n    if (status >= Tinode.MESSAGE_STATUS_SENT && msg.from != this.props.myUserId) {\n      this.postReadNotification(msg.seq);\n    }\n    // This will send \"received\" notifications right away.\n    this.props.onData(msg);\n  }\n\n  handleAllMessagesReceived(count) {\n    this.setState({fetchingMessages: false});\n    if (count > 0) {\n      // 0 means \"latest\".\n      this.postReadNotification(0);\n    }\n  }\n\n  handleInfoReceipt(info) {\n    switch (info.what) {\n      case 'kp': {\n        clearTimeout(this.keyPressTimer);\n        this.keyPressTimer = setTimeout(() => {\n          this.setState({typingIndicator: false});\n        }, KEYPRESS_DELAY + 1000);\n        if (!this.state.typingIndicator) {\n          this.setState({typingIndicator: true});\n        }\n        break;\n      }\n      case 'read':\n      case 'recv':\n        // Redraw due to changed recv/read status.\n        this.forceUpdate();\n        break;\n      default:\n        console.info(\"Other change in topic: \", info.what);\n    }\n  }\n\n  handleImagePostview(content) {\n    this.setState({ imagePostview: content });\n  }\n\n  handleClosePreview() {\n    if (this.state.imagePreview && this.state.imagePreview.url) {\n      URL.revokeObjectURL(this.state.imagePreview.url);\n    }\n    this.setState({ imagePostview: null, imagePreview: null, docPreview: null });\n  }\n\n  handleFormResponse(action, text, data) {\n    if (action == 'pub') {\n      this.sendMessage(Drafty.attachJSON(Drafty.parse(text), data));\n    } else if (action == 'url') {\n      const url = new URL(data.ref);\n      const params = url.searchParams;\n      for (let key in data.resp) {\n        if (data.resp.hasOwnProperty(key)) {\n          params.set(key, data.resp[key]);\n        }\n      }\n      ['name', 'seq'].map((key) => {\n        if (data[key]) {\n          params.set(key, data[key]);\n        }\n      });\n      params.set('uid', this.props.myUserId);\n      params.set('topic', this.state.topic);\n      url.search = params;\n      window.open(url, '_blank');\n    } else {\n      console.info(\"Unknown action in form\", action);\n    }\n  }\n\n  handleContextClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.props.showContextMenu({ topicName: this.state.topic, y: e.pageY, x: e.pageX });\n  }\n\n  handleShowMessageContextMenu(params, messageSpecificMenuItems) {\n    if (params.userFrom == 'chan') {\n      params.userFrom = this.state.topic;\n      params.userName = this.state.title;\n    }\n    params.topicName = this.state.topic;\n    const menuItems = messageSpecificMenuItems || [];\n    const topic = this.props.tinode.getTopic(params.topicName);\n    if (topic) {\n      if (!topic.isChannelType()) {\n        menuItems.push('message_delete');\n      }\n      const acs = topic.getAccessMode();\n      if (acs && acs.isDeleter()) {\n        menuItems.push('message_delete_hard');\n      }\n    }\n    this.props.showContextMenu(params, menuItems);\n  }\n\n  handleNewChatAcceptance(action) {\n    this.props.onNewChat(this.state.topic, action);\n  }\n\n  handleEnablePeer(e) {\n    e.preventDefault();\n    this.props.onChangePermissions(this.state.topic, DEFAULT_P2P_ACCESS_MODE, this.state.topic);\n  }\n\n  sendKeyPress() {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    if (topic.isSubscribed()) {\n      topic.noteKeyPress();\n    }\n  }\n\n  // sendMessage sends the message with an optional subscription to topic first.\n  sendMessage(msg, uploadCompletionPromise, uploader) {\n    let head;\n    if (this.props.forwardMessage) {\n      // We are forwarding a message.\n      msg = this.props.forwardMessage.msg;\n      head = this.props.forwardMessage.head;\n      this.handleCancelReply();\n    } else if (this.state.reply && this.state.reply.content) {\n      // We are replying to a message in this topic.\n      head = {reply: '' + this.state.reply.seq};\n      // Turn it into Drafty so we can make a quoted Drafty object later.\n      if (typeof msg == 'string') {\n        msg = Drafty.parse(msg);\n      }\n      msg = Drafty.append(Drafty.sanitizeEntities(this.state.reply.content), msg);\n      this.handleCancelReply();\n    }\n    this.props.sendMessage(msg, uploadCompletionPromise, uploader, head);\n  }\n\n  // Retry sending a message.\n  retrySend(pub) {\n    this.props.sendMessage(pub.content, undefined, undefined, pub.head);\n  }\n\n  // Send attachment as Drafty message:\n  // - if file is too large, upload it and send a s link.\n  // - if file is small enough, just send it in-band.\n  sendFileAttachment(file) {\n    // Server-provided limit reduced for base64 encoding and overhead.\n    const maxInbandAttachmentSize = (this.props.tinode.getServerLimit('maxMessageSize',\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\n\n    if (file.size > maxInbandAttachmentSize) {\n      // Too large to send inband - uploading out of band and sending as a link.\n      const uploader = this.props.tinode.getLargeFileHelper();\n      if (!uploader) {\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n        return;\n      }\n      const uploadCompletionPromise = uploader.upload(file);\n      const msg = Drafty.attachFile(null, {\n        mime: file.type,\n        filename: file.name,\n        size: file.size,\n        urlPromise: uploadCompletionPromise\n      });\n      // Pass data and the uploader to the TinodeWeb.\n      this.sendMessage(msg, uploadCompletionPromise, uploader);\n    } else {\n      // Small enough to send inband.\n      fileToBase64(file)\n        .then(b64 => this.sendMessage(Drafty.attachFile(null, {mime: b64.mime, data: b64.bits, filename: b64.name})))\n        .catch(err => this.props.onError(err));\n    }\n  }\n\n  // handleAttachFile method is called when [Attach file] button is clicked: launch attachment preview.\n  handleAttachFile(file) {\n    const maxExternAttachmentSize = this.props.tinode.getServerLimit('maxFileUploadSize', MAX_EXTERN_ATTACHMENT_SIZE);\n\n    if (file.size > maxExternAttachmentSize) {\n      // Too large.\n      this.props.onError(this.props.intl.formatMessage(messages.file_attachment_too_large,\n        {size: bytesToHumanSize(file.size), limit: bytesToHumanSize(maxExternAttachmentSize)}), 'err');\n    } else {\n      this.setState({\n        docPreview: {\n          file: file,\n          name: file.name,\n          size: file.size,\n          type: file.type\n        }\n      });\n    }\n  }\n\n  handleCallHangup(topic, seq) {\n    this.props.onVideoCallClosed();\n    this.setState({\n      rtcPanel: null\n    });\n    this.props.onCallHangup(topic, seq);\n  }\n\n  // sendImageAttachment sends the image bits inband as Drafty message.\n  sendImageAttachment(caption, blob) {\n    const mime = this.state.imagePreview.mime;\n    const width = this.state.imagePreview.width;\n    const height = this.state.imagePreview.height;\n    const fname = this.state.imagePreview.name;\n\n    // Server-provided limit reduced for base64 encoding and overhead.\n    const maxInbandAttachmentSize = (this.props.tinode.getServerLimit('maxMessageSize',\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\n\n    if (blob.size > maxInbandAttachmentSize) {\n      // Too large to send inband - uploading out of band and sending as a link.\n      const uploader = this.props.tinode.getLargeFileHelper();\n      if (!uploader) {\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n        return;\n      }\n      const uploadCompletionPromise = uploader.upload(blob);\n\n      // Make small preview to show while uploading.\n      imageScaled(blob, IMAGE_PREVIEW_DIM, IMAGE_PREVIEW_DIM, -1, false)\n        // Convert tiny image into base64 for serialization and previewing.\n        .then(scaled => blobToBase64(scaled.blob))\n        .then(b64 => {\n            let msg = Drafty.insertImage(null, 0, {\n              mime: mime,\n              _tempPreview: b64.bits, // This preview will not be serialized.\n              width: width,\n              height: height,\n              filename: fname,\n              size: blob.size,\n              urlPromise: uploadCompletionPromise\n            });\n            if (caption) {\n              msg = Drafty.appendLineBreak(msg);\n              msg = Drafty.append(msg, Drafty.parse(caption));\n            }\n            // Pass data and the uploader to the TinodeWeb.\n            this.sendMessage(msg, uploadCompletionPromise, uploader);\n        }).catch((err) => {\n          this.props.onError(err, 'err');\n        });\n        return;\n    }\n\n    // Upload the image if it's too big to be send inband.\n    blobToBase64(blob)\n      .then(b64 => {\n        let msg = Drafty.insertImage(null, 0, {\n          mime: b64.mime,\n          preview: b64.bits, // Serializable preview\n          width: width,\n          height: height,\n          filename: fname,\n          size: blob.size\n        });\n        if (caption) {\n          msg = Drafty.appendLineBreak(msg);\n          msg = Drafty.append(msg, Drafty.parse(caption));\n        }\n        this.sendMessage(msg);\n      });\n  }\n\n  // handleAttachImage method is called when [Attach image] button is clicked: launch image preview.\n  handleAttachImage(file) {\n    const maxExternAttachmentSize = this.props.tinode.getServerLimit('maxFileUploadSize', MAX_EXTERN_ATTACHMENT_SIZE);\n\n    // Get image dimensions and size, optionally scale it down.\n    imageScaled(file, MAX_IMAGE_DIM, MAX_IMAGE_DIM, maxExternAttachmentSize, false)\n      .then(scaled => {\n        this.setState({imagePreview: {\n          url: URL.createObjectURL(scaled.blob),\n          blob: scaled.blob,\n          name: scaled.name,\n          width: scaled.width,\n          height: scaled.height,\n          size: scaled.blob.size,\n          mime: scaled.mime\n        }});\n      }).catch(err => {\n        this.props.onError(err, 'err');\n      });\n  }\n\n  // sendAudioAttachment sends audio bits inband as Drafty message (no preview).\n  sendAudioAttachment(url, preview, duration) {\n    fetch(url)\n      .then(result => result.blob())\n      .then(blob => {\n        // Server-provided limit reduced for base64 encoding and overhead.\n        const maxInbandAttachmentSize = this.props.tinode.getServerLimit('maxMessageSize', MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024;\n        if (blob.size > maxInbandAttachmentSize) {\n          // Too large to send inband - uploading out of band and sending as a link.\n          const uploader = this.props.tinode.getLargeFileHelper();\n          if (!uploader) {\n            this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n            return;\n          }\n          const uploadCompletionPromise = uploader.upload(blob);\n          const msg = Drafty.appendAudio(null, {\n            mime: blob.type,\n            size: blob.size,\n            duration: duration,\n            preview: preview,\n            urlPromise: uploadCompletionPromise\n          });\n          // Pass data and the uploader to the TinodeWeb.\n          this.sendMessage(msg, uploadCompletionPromise, uploader);\n        } else {\n          // Small enough to send inband.\n          blobToBase64(blob)\n            .then(b64 => {\n              this.sendMessage(Drafty.appendAudio(null, {\n                mime: b64.mime,\n                size: blob.size,\n                data: b64.bits,\n                duration: duration,\n                preview: preview,\n              }))\n            })\n        }\n      })\n      .catch(err => {this.props.onError(err)});;\n  }\n\n  handleCancelUpload(seq, uploader) {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    const found = topic.findMessage(seq);\n    if (found) {\n      found._cancelled = true;\n    }\n    uploader.cancel();\n  }\n\n  // seq: seq ID of the source message\n  // context: message content.\n  // forwarded: true if the source message is also a forwarded message.\n  // senderId: UID of the sender of the source message.\n  // senderName: full name of the sender of the original message.\n  handlePickReply(seq, content, senderId, senderName) {\n    this.setState({reply: null});\n\n    if (!seq || !content) {\n      return;\n    }\n\n    content = typeof content == 'string' ? Drafty.init(content) : content;\n    if (Drafty.isValid(content)) {\n      content = Drafty.replyContent(content, QUOTED_REPLY_LENGTH);\n    } else {\n      // /!\\ invalid content.\n      content = Drafty.append(Drafty.init('\\u26A0 '),\n        Drafty.wrapInto(this.props.intl.formatMessage(messages.invalid_content), 'EM'));\n    }\n\n    this.setState({\n      reply: {\n        content: Drafty.quote(senderName, senderId, content),\n        seq: seq\n      }\n    });\n    this.props.onCancelForwardMessage();\n  }\n\n  handleCancelReply() {\n    this.setState({reply: null});\n    this.props.onCancelForwardMessage();\n  }\n\n  handleQuoteClick(replyToSeq) {\n    const ref = this.getOrCreateMessageRef(replyToSeq);\n    if (ref && ref.current) {\n      ref.current.scrollIntoView({block: \"center\", behavior: \"smooth\"});\n      ref.current.classList.add('flash');\n      setTimeout(() => { ref.current.classList.remove('flash') } , 1000);\n    } else {\n      console.error(\"Unresolved message ref\", replyToSeq);\n    }\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n\n    let component;\n    if (this.props.hideSelf) {\n      component = null;\n    } else if (!this.state.topic) {\n      component = (\n        <LogoView\n          serverVersion={this.props.serverVersion}\n          serverAddress={this.props.serverAddress} />\n      );\n    } else {\n      let component2;\n      if (this.state.imagePreview) {\n        // Preview image before sending.\n        component2 = (\n          <ImagePreview\n            content={this.state.imagePreview}\n            tinode={this.props.tinode}\n            reply={this.state.reply}\n            onCancelReply={this.handleCancelReply}\n            onClose={this.handleClosePreview}\n            onSendMessage={this.sendImageAttachment} />\n        );\n      } else if (this.state.imagePostview) {\n        // Expand received image.\n        component2 = (\n          <ImagePreview\n            content={this.state.imagePostview}\n            onClose={this.handleClosePreview} />\n        );\n      } else if (this.state.docPreview) {\n        // Preview attachment before sending.\n        component2 = (\n          <DocPreview\n            content={this.state.docPreview}\n            tinode={this.props.tinode}\n            reply={this.state.reply}\n            onCancelReply={this.handleCancelReply}\n            onClose={this.handleClosePreview}\n            onSendMessage={this.sendFileAttachment} />\n        );\n      } else if (this.state.rtcPanel) {\n        const topic = this.props.tinode.getTopic(this.state.topic);\n        component2 = (\n          <CallPanel\n            topic={topic}\n            seq={this.props.callSeq}\n            callState={this.props.callState}\n            displayMobile={this.props.displayMobile}\n            tinode={this.props.tinode}\n            title={this.state.title}\n            avatar={this.state.avatar || true}\n\n            onError={this.props.onError}\n            onHangup={this.handleCallHangup}\n            onInvite={this.props.onCallInvite}\n            onSendOffer={this.props.onCallSendOffer}\n            onIceCandidate={this.props.onCallIceCandidate}\n            onSendAnswer={this.props.onCallSendAnswer}\n          />\n        );\n      } else {\n        const topic = this.props.tinode.getTopic(this.state.topic);\n        const isChannel = topic.isChannelType();\n        const groupTopic = topic.isGroupType() && !isChannel;\n        const icon_badges = [];\n        if (topic.trusted) {\n          if (topic.trusted.verified) {\n            icon_badges.push({icon: 'verified', color: 'badge-inv'});\n          }\n          if (topic.trusted.staff) {\n            icon_badges.push({icon: 'staff', color: 'badge-inv'});\n          }\n          if (topic.trusted.danger) {\n            icon_badges.push({icon: 'dangerous', color: 'badge-inv'});\n          }\n        }\n\n        const messageNodes = [];\n        let previousFrom = null;\n        let prevDate = null;\n        let chatBoxClass = null;\n        const dateFmt = new Intl.DateTimeFormat(this.props.intl.locale);\n        topic.messages((msg, prev, next, i) => {\n          let nextFrom = next ? (next.from || 'chan') : null;\n\n          let sequence = 'single';\n          let thisFrom = msg.from || 'chan';\n          if (thisFrom == previousFrom) {\n            if (thisFrom == nextFrom) {\n              sequence = 'middle';\n            } else {\n              sequence = 'last';\n            }\n          } else if (thisFrom == nextFrom) {\n            sequence = 'first';\n          }\n          previousFrom = thisFrom;\n\n          const isReply = !(thisFrom == this.props.myUserId);\n          const deliveryStatus = topic.msgStatus(msg, true);\n\n          let userFrom = thisFrom, userName, userAvatar;\n          const user = topic.userDesc(thisFrom);\n          if (user && user.public) {\n            userName = user.public.fn;\n            userAvatar = makeImageUrl(user.public.photo);\n          }\n          chatBoxClass = groupTopic ? 'chat-box group' : 'chat-box';\n\n          // Ref for this chat message.\n          const ref = this.getOrCreateMessageRef(msg.seq);\n          let replyToSeq = msg.head ? parseInt(msg.head.reply) : null;\n          if (!replyToSeq || isNaN(replyToSeq)) {\n            replyToSeq = null;\n          }\n\n          if (msg.hi) {\n            // Deleted message.\n            messageNodes.push(\n              <MetaMessage\n                deleted={true}\n                key={msg.seq} />\n              );\n          } else {\n            const thisDate = new Date(msg.ts);\n            // This message was sent on a different date than the previous.\n            if (!prevDate || prevDate.toDateString() != thisDate.toDateString()) {\n              messageNodes.push(\n                <MetaMessage\n                  date={dateFmt.format(msg.ts)}\n                  locale={this.props.intl.locale}\n                  key={'date-' + msg.seq} />\n              );\n              prevDate = thisDate;\n            }\n            messageNodes.push(\n              <ChatMessage\n                tinode={this.props.tinode}\n                content={msg.content}\n                mimeType={msg.head ? msg.head.mime : null}\n                timestamp={msg.ts}\n                duration={msg.origTs ? msg.ts - msg.origTs : null}\n                response={isReply}\n                seq={msg.seq}\n                isGroup={groupTopic}\n                isChan={this.state.channel}\n                userFrom={userFrom}\n                userName={userName}\n                userAvatar={userAvatar}\n                sequence={sequence}\n                received={deliveryStatus}\n                uploader={msg._uploader}\n                viewportWidth={this.props.viewportWidth}  // Used by `formatter`.\n                showContextMenu={this.handleShowMessageContextMenu}\n                onImagePreview={this.handleImagePostview}\n                onFormResponse={this.handleFormResponse}\n                onError={this.props.onError}\n                onCancelUpload={this.handleCancelUpload}\n                pickReply={this.handlePickReply}\n                replyToSeq={replyToSeq}\n                onQuoteClick={this.handleQuoteClick}\n                ref={ref}\n                userIsWriter={this.state.isWriter}\n                key={msg.seq} />\n            );\n          }\n        });\n\n        let lastSeen = null;\n        if (isChannel) {\n          lastSeen = formatMessage(messages.channel);\n        } else {\n          const cont = this.props.tinode.getMeTopic().getContact(this.state.topic);\n          if (cont && Tinode.isP2PTopicName(cont.topic)) {\n            if (cont.online) {\n              lastSeen = formatMessage(messages.online_now);\n            } else if (cont.seen) {\n              lastSeen = formatMessage(messages.last_seen) + \": \" +\n                shortDateFormat(cont.seen.when, this.props.intl.locale);\n              // TODO: also handle user agent in c.seen.ua\n            }\n          }\n        }\n        const avatar = this.state.avatar || true;\n        const online = this.state.deleted ? null :\n          this.props.online ? 'online' + (this.state.typingIndicator ? ' typing' : '') : 'offline';\n\n        const titleClass = 'panel-title' + (this.state.deleted ? ' deleted' : '');\n\n        component2 = (\n          <>\n            <div id=\"topic-caption-panel\" className=\"caption-panel\">\n              {this.props.displayMobile ?\n                <a href=\"#\" id=\"hide-message-view\" onClick={(e) => {e.preventDefault(); this.props.onHideMessagesView();}}>\n                  <i className=\"material-icons\">arrow_back</i>\n                </a>\n                :\n                null}\n              <div className=\"avatar-box\">\n                <LetterTile\n                  tinode={this.props.tinode}\n                  avatar={avatar}\n                  topic={this.state.topic}\n                  title={this.state.title}\n                  deleted={this.state.deleted} />\n                {!isChannel ? <span className={online} /> : null}\n              </div>\n              <div id=\"topic-title-group\">\n                <div id=\"topic-title\" className={titleClass}>{\n                  this.state.title ||\n                  <i><FormattedMessage id=\"unnamed_topic\" defaultMessage=\"Unnamed\"\n                    description=\"Title shown when the topic has no name\" /></i>\n                }<ContactBadges badges={icon_badges} /></div>\n                <div id=\"topic-last-seen\">{lastSeen}</div>\n              </div>\n              {groupTopic ?\n                <GroupSubs\n                  tinode={this.props.tinode}\n                  subscribers={this.state.onlineSubs} /> :\n                <div id=\"topic-users\" />\n              }\n              <div>\n                <a href=\"#\" onClick={this.handleContextClick}>\n                  <i className=\"material-icons\">more_vert</i>\n                </a>\n              </div>\n            </div>\n            {this.props.displayMobile ?\n              <ErrorPanel\n                level={this.props.errorLevel}\n                text={this.props.errorText}\n                onClearError={this.props.onError} />\n              : null}\n            <LoadSpinner show={this.state.fetchingMessages} />\n            <div id=\"messages-container\">\n              <button className={'action-button' + (this.state.showGoToLastButton ? '' : ' hidden')}\n                onClick={this.goToLatestMessage}>\n                <i className=\"material-icons\">arrow_downward</i>\n              </button>\n              <div id=\"messages-panel\" ref={this.handleScrollReference}>\n                <ul id=\"scroller\" className={chatBoxClass}>\n                  {messageNodes}\n                </ul>\n              </div>\n              {!this.state.isReader ?\n              <div id=\"write-only-background\">\n                {this.state.readingBlocked ?\n                <div id=\"write-only-note\">\n                  <FormattedMessage id=\"messages_not_readable\" defaultMessage=\"no access to messages\"\n                    description=\"Message shown in topic without the read access\" />\n                </div>\n                : null }\n              </div>\n              : null }\n            </div>\n            {this.state.peerMessagingDisabled && !this.state.unconfirmed ?\n              <div id=\"peer-messaging-disabled-note\">\n                <i className=\"material-icons secondary\">block</i> <FormattedMessage\n                  id=\"peers_messaging_disabled\" defaultMessage=\"Peer's messaging is disabled.\"\n                  description=\"Shown when the p2p peer's messaging is disabled\" /> <a href=\"#\"\n                    onClick={this.handleEnablePeer}><FormattedMessage id=\"enable_peers_messaging\"\n                    defaultMessage=\"Enable\" description=\"Call to action to enable peer's messaging\" /></a>.\n              </div> : null}\n            {this.state.unconfirmed ?\n              <Invitation onAction={this.handleNewChatAcceptance} />\n              :\n              <SendMessage\n                tinode={this.props.tinode}\n                topicName={this.state.topic}\n                noInput={!!this.props.forwardMessage}\n                disabled={!this.state.isWriter || this.state.deleted}\n                onKeyPress={this.sendKeyPress}\n                onSendMessage={this.sendMessage}\n                onAttachFile={this.props.forwardMessage ? null : this.handleAttachFile}\n                onAttachImage={this.props.forwardMessage ? null : this.handleAttachImage}\n                onAttachAudio={this.props.forwardMessage ? null : this.sendAudioAttachment}\n                onError={this.props.onError}\n                reply={this.state.reply}\n                onQuoteClick={this.handleQuoteClick}\n                onCancelReply={this.handleCancelReply} />}\n          </>\n        );\n      }\n      component = <div id=\"topic-view\">{component2}</div>\n    }\n    return component;\n  }\n};\n\nexport default injectIntl(MessagesView);\n","// The <- button to be displayed in title bars.\nimport React from 'react';\n\nexport default class ButtonBack extends React.PureComponent {\n  render() {\n    return (\n      <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onBack();}}>\n        <i className=\"material-icons\">arrow_back</i>\n      </a>\n    );\n  }\n}\n","import React from 'react';\n\nexport default class MenuContacts extends React.PureComponent {\n  render() {\n    return (\n      <div>\n        <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onNewTopic();}}><i className=\"material-icons\">chat</i></a>\n        &nbsp;\n        <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onSettings();}}><i className=\"material-icons\">settings</i></a>\n      </div>\n    );\n  }\n};\n","import React from 'react';\n\nexport default class MenuStart extends React.PureComponent {\n  render() {\n    return (\n        <div>\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onSignUp();}}><i className=\"material-icons\">person_add</i></a>\n          &nbsp;\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onSettings();}}><i className=\"material-icons\">settings</i></a>\n        </div>\n    );\n  }\n};\n","import React from 'react';\n\nimport LetterTile from './letter-tile.jsx';\nimport ButtonBack from './button-back.jsx';\nimport ContactBadges from './contact-badges.jsx';\nimport MenuContacts from './menu-contacts.jsx';\nimport MenuStart from './menu-start.jsx';\n\nimport { sanitizeUrlForMime } from '../lib/utils.js';\n\nexport default class SideNavbar extends React.PureComponent {\n  render() {\n    const icon_badges = [];\n    if (this.props.trustedBadges) {\n      this.props.trustedBadges.map((b) => {\n        icon_badges.push({icon: b, color: 'badge-inv'});\n      });\n    }\n    let avatar = null;\n    if (this.props.tinode) {\n      avatar = this.props.tinode.authorizeURL(sanitizeUrlForMime(this.props.avatar, 'image'));\n    }\n    return (\n      <div id=\"side-caption-panel\" className=\"caption-panel\">\n        {this.props.onCancel ? <ButtonBack onBack={this.props.onCancel} /> : null}\n        {avatar ?\n          <div id=\"self-avatar\" className=\"avatar-box\">\n            <LetterTile\n              tinode={this.props.tinode}\n              avatar={avatar}\n              topic={this.props.myUserId}\n              title={this.props.title} />\n          </div>\n          :\n          null}\n        <div id=\"sidepanel-title\" className=\"panel-title\">{this.props.title}<ContactBadges badges={icon_badges}/></div>\n        {this.props.state === 'login' ?\n            <MenuStart onSignUp={this.props.onSignUp} onSettings={this.props.onSettings} /> :\n          this.props.state === 'contacts' ?\n            <MenuContacts onNewTopic={this.props.onNewTopic} onSettings={this.props.onSettings} /> :\n          null}\n      </div>\n    );\n  }\n};\n","// Edit account parameters.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\nimport BadgeList from '../widgets/badge-list.jsx';\n\nimport { makeImageUrl } from '../lib/blob-helpers.js';\nimport { MAX_TITLE_LENGTH, MAX_TOPIC_DESCRIPTION_LENGTH } from '../config.js';\n\nfunction _clip(str, length) {\n  return str && str.substring(0, length);\n}\n\nexport default class AccountSettingsView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const me = this.props.tinode.getMeTopic();\n    this.state = {\n      fullName: _clip(me.public ? me.public.fn : undefined, MAX_TITLE_LENGTH),\n      description: _clip(me.public ? me.public.note : undefined, MAX_TOPIC_DESCRIPTION_LENGTH),\n      avatar: makeImageUrl(me.public ? me.public.photo : null)\n    };\n  }\n\n  render() {\n    return (\n      <div className=\"scrollable-panel\">\n        <div className=\"panel-form-column\">\n          <a href=\"#\" className=\"flat-button float-right\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('general');}}>\n            <i className=\"material-icons\">edit</i>&nbsp;\n            <FormattedMessage id=\"button_edit\" defaultMessage=\"Edit\" description=\"Call to action [Edit]\" />\n          </a>\n          <center>\n            <AvatarUpload\n              tinode={this.props.tinode}\n              avatar={this.state.avatar}\n              readOnly={true}\n              uid={this.props.myUserId}\n              title={this.state.fullName} />\n          </center>\n          <div className=\"group\">\n            <label className=\"small\">\n              <FormattedMessage id=\"label_your_name\" defaultMessage=\"Your name\"\n                description=\"Label for full name editing\" />\n            </label>\n            <div className=\"large ellipsized\">{this.state.fullName}</div>\n          </div>\n          <div className=\"group\">\n            <label className=\"small\"><FormattedMessage id=\"label_user_id\" defaultMessage=\"ID:\"\n              description=\"Label for user address (ID)\" /></label>&nbsp;\n            <tt>{this.props.myUserId}</tt>\n          </div>\n          <div className=\"group\">\n            <BadgeList trustedBadges={this.props.trustedBadges} />\n          </div>\n          {this.state.description ?\n            <div className=\"group\">\n              <label className=\"small\">\n                <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\n                  description=\"Label for editing topic description\" />\n              </label>\n              <div>{this.state.description}</div>\n            </div> : null}\n        </div>\n        <div className=\"hr\" />\n        <div className=\"panel-form-column\">\n          <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('notif');}}>\n            <i className=\"material-icons\">notifications</i>&nbsp;<FormattedMessage id=\"sidepanel_title_acc_notifications\"\n              defaultMessage=\"Notifications\" description=\"Sidepanel title for AccNotificationsView.\" />\n          </a>\n          <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('security');}}>\n            <i className=\"material-icons\">security</i>&nbsp;<FormattedMessage id=\"button_security\"\n              defaultMessage=\"Security\" description=\"Navigaton button for security panel.\" />\n          </a>\n          <a href=\"#\" className=\"flat-button\" onClick={(e) => {e.preventDefault(); this.props.onNavigate('support');}}>\n            <i className=\"material-icons\">contact_support</i>&nbsp;<FormattedMessage id=\"sidepanel_title_acc_support\"\n              defaultMessage=\"Support\" description=\"Sidepanel title for AccSupportView.\" />\n          </a>\n        </div>\n      </div>\n    );\n  }\n};\n","/* ContactsView holds all contacts-related stuff */\nimport React from 'react';\nimport { FormattedMessage, defineMessages } from 'react-intl';\n\nimport ContactList from '../widgets/contact-list.jsx';\n\nimport { updateFavicon } from '../lib/utils.js';\n\nconst messages = defineMessages({\n  archived_contacts_title: {\n    id: \"archived_contacts\",\n    defaultMessage: \"Archived contacts ({count})\",\n    description: \"Label for archived chats\"\n  }\n});\n\nexport default class ContactsView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleAction = this.handleAction.bind(this);\n\n    this.state = ContactsView.deriveStateFromProps(props);\n  }\n\n  static deriveStateFromProps(props) {\n    const contacts = [];\n    let unreadThreads = 0;\n    let archivedCount = 0;\n    props.chatList.map((c) => {\n      const blocked = c.acs && !c.acs.isJoiner();\n      // Show only blocked contacts only when props.blocked == true.\n      if (blocked && props.blocked) {\n        contacts.push(c);\n      }\n      if (blocked || props.blocked) {\n        return;\n      }\n\n      if (c.private && c.private.arch) {\n        if (props.archive) {\n          contacts.push(c);\n        } else {\n          archivedCount ++;\n        }\n      } else if (!props.archive) {\n        contacts.push(c);\n        unreadThreads += c.unread > 0 ? 1 : 0;\n      }\n    });\n\n    contacts.sort((a, b) => {\n      return (b.touched || 0) - (a.touched || 0);\n    });\n\n    if (archivedCount > 0) {\n      contacts.push({\n        action: 'archive',\n        title: messages.archived_contacts_title,\n        values: {count: archivedCount}\n      });\n    }\n\n    return {\n      contactList: contacts,\n      unreadThreads: unreadThreads\n    };\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevProps.chatList != this.props.chatList ||\n        prevProps.archive != this.props.archive ||\n        prevProps.blocked != this.props.blocked) {\n      const newState = ContactsView.deriveStateFromProps(this.props);\n      this.setState(newState);\n      if (newState.unreadThreads != prevState.unreadThreads) {\n        updateFavicon(newState.unreadThreads);\n      }\n    }\n  }\n\n  handleAction(action_ignored) {\n    this.props.onShowArchive();\n  }\n\n  render() {\n    return (\n      <FormattedMessage id=\"contacts_not_found\"\n        defaultMessage=\"You have no chats<br />¯∖_(ツ)_/¯\"\n        description=\"HTML message shown in ContactList when no contacts are found\">{\n        (no_contacts) => <ContactList\n          tinode={this.props.tinode}\n          connected={this.props.connected}\n          contacts={this.state.contactList}\n          emptyListMessage={no_contacts}\n          topicSelected={this.props.topicSelected}\n          myUserId={this.props.myUserId}\n          showOnline={true}\n          showUnread={true}\n          onTopicSelected={this.props.onTopicSelected}\n          showContextMenu={this.props.showContextMenu}\n          onAction={this.handleAction} />\n      }</FormattedMessage>\n    );\n  }\n};\n","// Helper functions for storing values in localStorage.\n// By default localStorage can store only strings, not objects or other types.\n\nexport default class LocalStorageUtil {\n  // Replace old object with the new one.\n  static setObject(key, value) {\n    localStorage.setItem(key, JSON.stringify(value));\n  }\n\n  // Get stored object.\n  static getObject(key) {\n    const value = localStorage.getItem(key);\n    return value && JSON.parse(value);\n  }\n\n  // Partially or wholly update stored object.\n  static updateObject(key, value) {\n    const oldVal = this.getObject(key);\n    this.setObject(key, Object.assign(oldVal || {}, value));\n  }\n\n  // Just a wrapper.\n  static removeItem(key) {\n    localStorage.removeItem(key);\n  }\n}\n","// Account registration.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport AvatarUpload from '../widgets/avatar-upload.jsx';\nimport CheckBox from '../widgets/checkbox.jsx';\nimport VisiblePassword from '../widgets/visible-password.jsx';\n\nimport LocalStorageUtil from '../lib/local-storage.js';\nimport { theCard } from '../lib/utils.js';\n\nimport { MAX_TITLE_LENGTH } from '../config.js';\n\nexport default class CreateAccountView extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      login: '',\n      password: '',\n      email: '',\n      fn: '', // full/formatted name\n      imageDataUrl: null,\n      errorCleared: false,\n      saveToken: LocalStorageUtil.getObject('keep-logged-in')\n    };\n\n    this.handleLoginChange = this.handleLoginChange.bind(this);\n    this.handlePasswordChange = this.handlePasswordChange.bind(this);\n    this.handleEmailChange = this.handleEmailChange.bind(this);\n    this.handleFnChange = this.handleFnChange.bind(this);\n    this.handleImageChanged = this.handleImageChanged.bind(this);\n    this.handleToggleSaveToken = this.handleToggleSaveToken.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleLoginChange(e) {\n    this.setState({login: e.target.value});\n  }\n\n  handlePasswordChange(password) {\n    this.setState({password: password});\n  }\n\n  handleEmailChange(e) {\n    this.setState({email: e.target.value})\n  }\n\n  handleFnChange(e) {\n    this.setState({fn: e.target.value});\n  }\n\n  handleImageChanged(img) {\n    this.setState({imageDataUrl: img});\n  }\n\n  handleToggleSaveToken() {\n    LocalStorageUtil.setObject('keep-logged-in', !this.state.saveToken);\n    this.setState({saveToken: !this.state.saveToken});\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    this.setState({errorCleared: false});\n    this.props.onCreateAccount(\n      this.state.login.trim(),\n      this.state.password.trim(),\n      theCard(this.state.fn.trim().substring(0, MAX_TITLE_LENGTH), this.state.imageDataUrl),\n      {'meth': 'email', 'val': this.state.email});\n  }\n\n  render() {\n    let submitClasses = 'primary';\n    if (this.props.disabled) {\n      submitClasses += ' disabled';\n    }\n\n    return (\n      <form className=\"panel-form-column\" onSubmit={this.handleSubmit}>\n        <div className=\"panel-form-row\">\n          <div className=\"panel-form-column\">\n            <FormattedMessage id=\"login_prompt\" defaultMessage=\"Login\"\n              description=\"Placeholer for username/login\">{\n              (login_prompt) => <input type=\"text\" placeholder={login_prompt} autoComplete=\"user-name\"\n                value={this.state.login} onChange={this.handleLoginChange} required autoFocus />\n            }</FormattedMessage>\n            <FormattedMessage id=\"password_prompt\" defaultMessage=\"Password\"\n              description=\"Placeholder/prompt for entering password\">{\n              (password_prompt) => <VisiblePassword placeholder={password_prompt} autoComplete=\"new-password\"\n                value={this.state.password} onFinished={this.handlePasswordChange}\n                required={true} />\n            }</FormattedMessage>\n          </div>\n          <AvatarUpload\n            tinode={this.props.tinode}\n            onImageChanged={this.handleImageChanged}\n            onError={this.props.onError} />\n        </div>\n        <div  className=\"panel-form-row\">\n          <FormattedMessage id=\"full_name_prompt\" defaultMessage=\"Full name, e.g. John Doe\"\n            description=\"Input placeholder for person's full name\">{\n            (full_name_prompt) => <input type=\"text\" placeholder={full_name_prompt} autoComplete=\"name\"\n              value={this.state.fn} onChange={this.handleFnChange} required/>\n          }</FormattedMessage>\n        </div>\n        <div className=\"panel-form-row\">\n          <FormattedMessage id=\"email_prompt\" defaultMessage=\"Email, e.g. jdoe@example.com\"\n            description=\"Input placeholder for email entry\">{\n            (email_prompt) => <input type=\"email\" placeholder={email_prompt} autoComplete=\"email\"\n              value={this.state.email} onChange={this.handleEmailChange} required/>\n          }</FormattedMessage>\n        </div>\n        <div className=\"panel-form-row\">\n          <CheckBox id=\"save-token\" name=\"save-token\" checked={this.state.saveToken}\n            onChange={this.handleToggleSaveToken} />\n          <FormattedMessage id=\"stay_logged_in\" defaultMessage=\"Stay logged in\"\n            description=\"Label for a checkbox\">{\n            (stay_logged_in) => <label htmlFor=\"save-token\">&nbsp;{stay_logged_in}</label>\n          }</FormattedMessage>\n        </div>\n        <div className=\"dialog-buttons\">\n          <button className={submitClasses} type=\"submit\">\n            <FormattedMessage id=\"button_sign_up\" defaultMessage=\"Sign up\"\n              description=\"Create account button [Sign Up]\" />\n          </button>\n        </div>\n      </form>\n    );\n  }\n};\n","// Edit account parameters.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport CheckBox from '../widgets/checkbox.jsx';\n\nexport default class EditAccountView extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleCheckboxClick = this.handleCheckboxClick.bind(this);\n  }\n\n  handleCheckboxClick(what, checked) {\n    if (what == 'sound') {\n      this.props.onToggleMessageSounds(checked);\n    } else if (what == 'alert') {\n      this.props.onTogglePushNotifications(checked);\n    } else if (what == 'incognito') {\n      this.props.onToggleIncognitoMode(checked);\n    }\n  }\n\n  render() {\n    return (\n        <div className=\"scrollable-panel\">\n          <div className=\"panel-form-row\">\n            <label htmlFor=\"message-sound\">\n              <FormattedMessage id=\"label_message_sound\" defaultMessage=\"Message sound:\"\n                description=\"Label for message sounds toggle\" />\n            </label>\n            <CheckBox name=\"sound\" id=\"message-sound\"\n              checked={this.props.messageSounds} onChange={this.handleCheckboxClick} />\n          </div>\n          <div className=\"panel-form-row\">\n            <label htmlFor=\"desktop-alerts\">\n            {this.props.desktopAlertsEnabled ?\n              <FormattedMessage id=\"label_push_notifications\" defaultMessage=\"Notification alerts:\"\n                description=\"Label for push notifications switch\" />\n              :\n              <FormattedMessage id=\"label_push_notifications_disabled\"\n                defaultMessage=\"Notification alerts (requires HTTPS):\"\n                description=\"Label for push notifications switch\" />\n            }\n            </label>\n            <CheckBox name=\"alert\" id=\"desktop-alerts\"\n              checked={this.props.desktopAlerts}\n              onChange={this.props.desktopAlertsEnabled ? this.handleCheckboxClick : null} />\n          </div>\n          <div className=\"panel-form-row\">\n            <label htmlFor=\"incognito-mode\">\n              <FormattedMessage id=\"label_incognito_mode\" defaultMessage=\"Incognito mode:\"\n                description=\"Label for incognito mode toggle\" />\n            </label>\n            <CheckBox name=\"incognito\" id=\"incognito-mode\"\n              checked={this.props.incognitoMode} onChange={this.handleCheckboxClick} />\n          </div>\n        </div>\n    );\n  }\n};\n","// Edit account parameters.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport InPlaceEdit from '../widgets/in-place-edit.jsx';\nimport PermissionsEditor from '../widgets/permissions-editor.jsx';\n\nconst messages = defineMessages({\n  delete_account: {\n    id: 'delete_account',\n    defaultMessage: 'Delete account',\n    description: 'Title for delete account warning'\n  },\n  delete_account_warning: {\n    id: 'delete_account_warning',\n    defaultMessage: 'Are you sure you want to delete your account? It cannot be undone.',\n    description: 'Warning message when deleting an account'\n  }\n});\n\nclass AccSecurityView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    const me = this.props.tinode.getMeTopic();\n    let blockedCount = 0;\n    me.contacts((c) => {\n      if (c.acs && !c.acs.isJoiner()) {\n        blockedCount ++;\n      }\n    });\n    const defacs = me.getDefaultAccess();\n    this.state = {\n      auth: defacs ? defacs.auth : null,\n      anon: defacs ? defacs.anon : null,\n      showPermissionEditorFor: undefined,\n      blockedCount: blockedCount,\n    };\n\n    this.handlePasswordUpdate = this.handlePasswordUpdate.bind(this);\n    this.handleLaunchPermissionsEditor = this.handleLaunchPermissionsEditor.bind(this);\n    this.handleHidePermissionsEditor = this.handleHidePermissionsEditor.bind(this);\n    this.handlePermissionsChanged = this.handlePermissionsChanged.bind(this);\n    this.handleDeleteAccount = this.handleDeleteAccount.bind(this);\n  }\n\n  handlePasswordUpdate(pwd) {\n    this.setState({password: pwd});\n    this.props.onUpdatePassword(pwd);\n  }\n\n  handleLaunchPermissionsEditor(which) {\n    this.setState({\n      showPermissionEditorFor: which,\n      editedPermissions: this.state[which]\n    });\n  }\n\n  handleHidePermissionsEditor() {\n    this.setState({showPermissionEditorFor: undefined});\n  }\n\n  handlePermissionsChanged(perm) {\n    let defacs = {};\n    defacs[this.state.showPermissionEditorFor] = perm;\n    this.props.onUpdateAccountDesc('me', undefined, undefined, defacs);\n\n    let newState = {showPermissionEditorFor: undefined};\n    newState[this.state.showPermissionEditorFor] = perm;\n    this.setState(newState);\n  }\n\n  handleDeleteAccount(e) {\n    e.preventDefault();\n    const {formatMessage} = this.props.intl;\n    this.props.onShowAlert(\n      formatMessage(messages.delete_account), // title\n      formatMessage(messages.delete_account_warning), // content\n      (() => { this.props.onDeleteAccount(); }), // onConfirm\n      null, // use default text \"OK\"\n      true, // Show Reject button\n      null  // use default text \"Cancel\"\n    );\n  }\n\n  render() {\n    return (\n      <>{this.state.showPermissionEditorFor ?\n        <PermissionsEditor\n          mode={this.state.editedPermissions}\n          skip=\"O\"\n          onSubmit={this.handlePermissionsChanged}\n          onCancel={this.handleHidePermissionsEditor} />\n        :\n        <div className=\"scrollable-panel\">\n          <div className=\"panel-form-column\">\n            <label className=\"small\">\n              <FormattedMessage id=\"label_password\" defaultMessage=\"Password\"\n                  description=\"Label for password editing\" />\n            </label>\n            <div>\n              <FormattedMessage id=\"password_unchanged_prompt\" defaultMessage=\"Unchanged\"\n                description=\"Message in editor while password is unchanged\">{\n                (password_unchanged) => <InPlaceEdit\n                  placeholder={password_unchanged}\n                  type=\"password\"\n                  onFinished={this.handlePasswordUpdate} />\n              }</FormattedMessage>\n            </div>\n          </div>\n          <div className=\"hr\" />\n          <div className=\"panel-form-column\">\n            <a href=\"#\" className=\"danger flat-button\" onClick={(e) => {e.preventDefault(); this.props.onLogout();}}>\n              <i className=\"material-icons\">exit_to_app</i> &nbsp;<FormattedMessage id=\"button_logout\"\n                defaultMessage=\"Logout\" description=\"Button [Logout]\" />\n            </a>\n            <a href=\"#\" className=\"danger flat-button\" onClick={(e) => {this.handleDeleteAccount(e);}}>\n              <i className=\"material-icons\">delete</i> &nbsp;<FormattedMessage id=\"button_delete_account\"\n                defaultMessage=\"Delete account\" description=\"Button [Delete account]\" />\n            </a>\n          </div>\n          <div className=\"hr\" />\n          <div className=\"panel-form-column\">\n            <div>\n              <label className=\"small\">\n                <FormattedMessage id=\"label_default_access_mode\" defaultMessage=\"Default access mode:\"\n                  description=\"Label for default access mode\" />\n              </label>\n            </div>\n            <div className=\"quoted\">\n              <div>Auth: <tt className=\"clickable\"\n                onClick={this.handleLaunchPermissionsEditor.bind(this, 'auth')}>{this.state.auth}</tt></div>\n              <div>Anon: <tt className=\"clickable\"\n                onClick={this.handleLaunchPermissionsEditor.bind(this, 'anon')}>{this.state.anon}</tt></div>\n            </div>\n          </div>\n          {this.state.blockedCount > 0 ?\n            <>\n              <div className=\"hr\" />\n              <div className=\"panel-form-row\">\n                <i className=\"material-icons\">block</i>&nbsp;\n                <a href=\"#\" className=\"gray\" onClick={(e) => {e.preventDefault(); this.props.onShowBlocked();}}>\n                  <FormattedMessage id=\"blocked_contacts_link\" defaultMessage=\"Blocked contacts ({count})\"\n                    values={{ count: this.state.blockedCount }} description=\"Blocked contacts link\" />\n                </a>\n              </div>\n            </>\n            : null }\n        </div>\n      }</>\n    );\n  }\n};\n\nexport default injectIntl(AccSecurityView);\n","// Edit account parameters.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport { APP_NAME, LINK_CONTACT_US, LINK_PRIVACY_POLICY, LINK_TERMS_OF_SERVICE } from '../config.js';\n\nexport default class AccSupportView extends React.PureComponent {\n  render() {\n    return (\n      <div className=\"scrollable-panel\">\n        <div className=\"panel-form-column\">\n          <a href={LINK_CONTACT_US} className=\"flat-button\" target=\"_blank\">\n            <i className=\"material-icons\">email</i> &nbsp;<FormattedMessage id=\"link_contact_us\"\n              defaultMessage=\"Contact Us\" description=\"Ancor text for contacting us by email\" />\n          </a>\n          <a href={LINK_TERMS_OF_SERVICE} className=\"flat-button\" target=\"_blank\">\n            <i className=\"material-icons\">description</i> &nbsp;<FormattedMessage id=\"link_terms_of_service\"\n              defaultMessage=\"Terms of Service\" description=\"Ancor text for terms of service link\" />\n          </a>\n          <a href={LINK_PRIVACY_POLICY} className=\"flat-button\" target=\"_blank\">\n            <i className=\"material-icons\">policy</i> &nbsp;<FormattedMessage id=\"link_privacy_policy\"\n              defaultMessage=\"Privacy Policy\" description=\"Ancor text for privacy policy link\" />\n          </a>\n        </div>\n        <div className=\"hr\" />\n        <div className=\"panel-form-column\">\n          <div className=\"panel-form-row\">\n            <label className=\"small\"><FormattedMessage id=\"label_client\" defaultMessage=\"Client:\"\n              description=\"Label for a client version\" /></label>\n            {APP_NAME}\n          </div>\n          <div className=\"panel-form-row\">\n            <label className=\"small\"><FormattedMessage id=\"label_sdk\" defaultMessage=\"SDK:\" /></label>\n            {Tinode.getLibrary()}\n          </div>\n          <div className=\"panel-form-row\">\n            <label className=\"small\"><FormattedMessage id=\"label_server\" defaultMessage=\"Server:\"\n              description=\"Label for a server version\" /></label>\n            {this.props.serverVersion}\n          </div>\n          <div className=\"panel-form-row\">\n            <label className=\"small\"><FormattedMessage id=\"label_server_address\" defaultMessage=\"Server address:\" /></label>\n            {this.props.serverAddress}\n          </div>\n        </div>\n      </div>\n    );\n  }\n};\n","// Login form.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport CheckBox from '../widgets/checkbox.jsx';\nimport VisiblePassword from '../widgets/visible-password.jsx';\n\nimport LocalStorageUtil from '../lib/local-storage.js';\n\nexport default class LoginView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      login: props.login,\n      password: '',\n      hostName: props.serverAddress,\n      saveToken: props.persist\n    };\n    this.handleLoginChange = this.handleLoginChange.bind(this);\n    this.handlePasswordChange = this.handlePasswordChange.bind(this);\n    this.handleToggleSaveToken = this.handleToggleSaveToken.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleLoginChange(e) {\n    this.setState({login: e.target.value});\n  }\n\n  handlePasswordChange(e) {\n    this.setState({password: e.target.value});\n  }\n\n  handleToggleSaveToken() {\n    this.props.onPersistenceChange(!this.state.saveToken);\n    this.setState({saveToken: !this.state.saveToken});\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    this.props.onLogin(this.state.login.trim(), this.state.password.trim());\n  }\n\n  render() {\n    let submitClasses = 'primary';\n    if (this.props.disabled) {\n      submitClasses += ' disabled';\n    }\n\n    return (\n      <form id=\"login-form\" onSubmit={this.handleSubmit}>\n        <FormattedMessage id=\"login_prompt\" defaultMessage=\"Login\"\n          description=\"Placeholer for username/login\">\n        {\n          (login_prompt) => <input type=\"text\" id=\"inputLogin\"\n            placeholder={login_prompt}\n            autoComplete=\"username\"\n            autoCorrect=\"off\"\n            autoCapitalize=\"none\"\n            value={this.state.login}\n            onChange={this.handleLoginChange}\n            required autoFocus />\n        }\n        </FormattedMessage>\n        <FormattedMessage id=\"password_prompt\" defaultMessage=\"Password\"\n          description=\"Placeholder/prompt for entering password\">\n        {\n          (password_prompt) => <VisiblePassword type=\"password\" id=\"inputPassword\"\n            placeholder={password_prompt}\n            autoComplete=\"current-password\"\n            value={this.state.password}\n            onChange={this.handlePasswordChange}\n            required={true} />\n        }\n        </FormattedMessage>\n        <div className=\"panel-form-row\">\n          <CheckBox id=\"save-token\" name=\"save-token\" checked={this.state.saveToken}\n            onChange={this.handleToggleSaveToken} />\n          <label htmlFor=\"save-token\">&nbsp;\n            <FormattedMessage id=\"stay_logged_in\" defaultMessage=\"Stay logged in\"\n              description=\"Label for a checkbox\" />\n          </label>\n          <a href=\"#reset\">\n            <FormattedMessage id=\"forgot_password_link\" defaultMessage=\"Forgot password?\"\n              description=\"Link to Reset password form\" />\n          </a>\n        </div>\n        <div className=\"dialog-buttons\">\n          <button className={submitClasses} type=\"submit\">\n            <FormattedMessage id=\"button_sign_in\" defaultMessage=\"Sign in\"\n              description=\"Button [Sign In]\" />\n          </button>\n        </div>\n      </form>\n    );\n  }\n};\n/* END Login */\n","import React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nconst messages = defineMessages({\n  invalid_id: {\n    id: 'error_invalid_id',\n    defaultMessage: 'Invalid ID',\n    description: 'Error message'\n  }\n});\n\nclass NewTopicById extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      groupId: '',\n    };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  handleChange(e) {\n    this.setState({groupId: e.target.value});\n  }\n\n  handleKeyPress(e) {\n    if (e.key === 'Enter') {\n      this.handleSubmit(e);\n    }\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    if (this.state.groupId) {\n      const name = this.state.groupId.trim();\n      const prefix = name.substr(0, 3);\n      if (name.length > 3 && ['usr', 'grp', 'chn'].includes(prefix)) {\n        this.props.onSubmit(name);\n      } else {\n        this.props.onError(this.props.intl.formatMessage(messages.invalid_id), 'err');\n      }\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"panel-form\">\n        <div className=\"panel-form-row\">\n        <FormattedMessage id=\"group_user_id_prompt\" defaultMessage=\"Group or User ID\"\n          description=\"Prompt for entering user or group ID\">{\n          (prompt) => <input type=\"text\" placeholder={prompt}\n            value={this.state.groupId} onChange={this.handleChange}\n            onKeyPress={this.handleKeyPress} required autoFocus />\n        }</FormattedMessage>\n        </div>\n        <div className=\"dialog-buttons\">\n          <button className=\"primary\" onClick={this.handleSubmit}>\n            <FormattedMessage id=\"button_subscribe\" defaultMessage=\"Subscribe\"\n              description=\"Button [Subscribe]\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(NewTopicById);\n","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport AvatarUpload from './avatar-upload.jsx';\nimport CheckBox from './checkbox.jsx';\nimport TagManager from './tag-manager.jsx';\n\nimport { MAX_TITLE_LENGTH, MAX_TOPIC_DESCRIPTION_LENGTH } from '../config.js';\n\nexport default class NewTopicGroup extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.fullName = React.createRef();\n\n    this.state = {\n      fullName: '', // full/formatted name\n      private: '',\n      description: '',\n      imageDataUrl: null,\n      tags: [],\n      isChannel: false\n    };\n\n    this.handleFieldEdit = this.handleFieldEdit.bind(this);\n    this.handleImageChanged = this.handleImageChanged.bind(this);\n    this.handleTagsChanged = this.handleTagsChanged.bind(this);\n    this.handleChannelToggle = this.handleChannelToggle.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  componentDidMount() {\n    // this.fullName.current.focus();\n  }\n\n  handleFieldEdit(name, e) {\n    this.setState({[name]: e.target.value || ''});\n  }\n\n  handleImageChanged(img) {\n    this.setState({imageDataUrl: img});\n  }\n\n  handleTagsChanged(tags) {\n    this.setState({tags: tags});\n  }\n\n  handleChannelToggle() {\n    this.setState({isChannel: !this.state.isChannel});\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n\n    const fn = this.state.fullName.trim().substring(0, MAX_TITLE_LENGTH);\n    const comment = this.state.private.trim().substring(0, MAX_TITLE_LENGTH);\n    const description = this.state.description.trim().substring(0, MAX_TOPIC_DESCRIPTION_LENGTH);\n    if (fn) {\n      this.props.onSubmit(fn, description, this.state.imageDataUrl, comment, this.state.tags, this.state.isChannel);\n    }\n  }\n\n  render() {\n    let submitClasses = 'primary';\n    if (this.props.disabled) {\n      submitClasses += ' disabled';\n    }\n    return (\n      <form className=\"panel-form\" onSubmit={this.handleSubmit}>\n        <div className=\"panel-form-column\">\n          <center>\n            <AvatarUpload\n              tinode={this.props.tinode}\n              onError={this.props.onError}\n              onImageChanged={this.handleImageChanged} />\n          </center>\n          <div className=\"group\">\n            <label className=\"small\" htmlFor=\"new-topic-fn\">\n              <FormattedMessage id=\"label_topic_name\" defaultMessage=\"Name\"\n                description=\"Label for editing topic name\" />\n            </label>\n            <FormattedMessage id=\"topic_name_editing_placeholder\" defaultMessage=\"Freeform name of the group\"\n              description=\"Prompt for entering topic name\">{\n              (placeholder) => <input type=\"text\" id=\"new-topic-fn\" placeholder={placeholder}\n                ref={this.fullName} value={this.state.fullName} onChange={this.handleFieldEdit.bind(this, 'fullName')}\n                autoFocus required tabIndex={0} />\n            }</FormattedMessage>\n          </div>\n          <div className=\"group\">\n            <label className=\"small\" htmlFor=\"new-topic-priv\">\n              <FormattedMessage id=\"label_private\" defaultMessage=\"Private comment\"\n                description=\"Label for editing 'private'\" />\n            </label>\n            <FormattedMessage id=\"private_editing_placeholder\" defaultMessage=\"Visible to you only\"\n              description=\"Placeholder for editing 'private'\">{\n              (placeholder) => <input type=\"text\" id=\"new-topic-priv\" placeholder={placeholder}\n                value={this.state.private} onChange={this.handleFieldEdit.bind(this, 'private')} tabIndex={1} />\n            }</FormattedMessage>\n          </div>\n          <div className=\"group\">\n            <label className=\"small\" htmlFor=\"new-topic-desc\">\n              <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\n                description=\"Label for editing topic description\" />\n            </label>\n            <FormattedMessage id=\"description_editing_placeholder\" defaultMessage=\"Description (optional)\"\n              description=\"Placeholder for editing topic description\">{\n              (placeholder) => <input type=\"text\" id=\"new-topic-desc\" placeholder={placeholder}\n                value={this.state.description} onChange={this.handleFieldEdit.bind(this, 'description')} tabIndex={2} />\n            }</FormattedMessage>\n          </div>\n        </div>\n        <div className=\"panel-form-row\">\n          <CheckBox checked={this.state.isChannel} tabIndex={3} onChange={this.handleChannelToggle} />&nbsp;\n          <label onClick={this.handleChannelToggle}><FormattedMessage id=\"channel_prompt\"\n            defaultMessage=\"This is a channel\"\n            description=\"Checkbox label when creating a channel\" /></label>\n        </div>\n        <FormattedMessage id=\"title_tag_manager\" defaultMessage=\"Tags (search & discovery)\"\n          description=\"Section title for TagManager\">{\n          (title) => <TagManager\n            tinode={this.props.tinode}\n            tags={this.state.tags}\n            activated={true}\n            onTagsChanged={this.handleTagsChanged}\n            tabIndex={4}\n            title={title} />\n        }</FormattedMessage>\n        <div className=\"dialog-buttons\">\n          <button className={submitClasses}>\n            <FormattedMessage id=\"button_create\" defaultMessage=\"Create\"\n              description=\"Button [Create]\" />\n          </button>\n        </div>\n      </form>\n    );\n  }\n};\n","// Create new topic and invite users or send an invite.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport ContactList from '../widgets/contact-list.jsx';\nimport NewTopicById from '../widgets/new-topic-by-id.jsx';\nimport NewTopicGroup from '../widgets/new-topic-group.jsx';\nimport SearchContacts from '../widgets/search-contacts.jsx';\n\nimport HashNavigation from '../lib/navigation.js';\nimport { theCard } from '../lib/utils.js';\n\nconst messages = defineMessages({\n  search_for_contacts: {\n    id: \"search_for_contacts\",\n    defaultMessage: \"Use search to find contacts\",\n    description: \"Text shown in contacts view when user entered no search query.\"\n  },\n  search_no_results: {\n    id: \"search_no_results\",\n    defaultMessage: \"Search returned no results\",\n    description: \"Text shown in contacts view when query returned no results.\"\n  },\n  search_placeholder: {\n    id: \"search_placeholder\",\n    defaultMessage: \"List like email:alice@example.com, tel:17025550003...\",\n    description: \"Placeholder in contacts search field\"\n  },\n});\n\nclass NewTopicView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      tabSelected: 'find',\n      searchQuery: null\n    };\n\n    this.handleTabClick = this.handleTabClick.bind(this);\n    this.handleSearchContacts = this.handleSearchContacts.bind(this);\n    this.handleSearchResultSelected = this.handleSearchResultSelected.bind(this);\n    this.handleNewGroupSubmit = this.handleNewGroupSubmit.bind(this);\n    this.handleGroupByID = this.handleGroupByID.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.onInitFind();\n  }\n\n  handleTabClick(e) {\n    e.preventDefault();\n    HashNavigation.navigateTo(HashNavigation.addUrlParam(window.location.hash, 'tab', e.currentTarget.dataset.id));\n    this.setState({tabSelected: e.currentTarget.dataset.id});\n  }\n\n  handleSearchContacts(query) {\n    this.props.onSearchContacts(query);\n    this.setState({searchQuery: Tinode.isNullValue(query) ? null : query});\n  }\n\n  handleSearchResultSelected(name) {\n    if (this.state.tabSelected == 'find') {\n      HashNavigation.navigateTo(HashNavigation.removeUrlParam(window.location.hash, 'tab'));\n      this.props.onCreateTopic(name);\n    }\n  }\n\n  handleNewGroupSubmit(name, description, dataUrl, priv, tags, isChannel) {\n    HashNavigation.navigateTo(HashNavigation.removeUrlParam(window.location.hash, 'tab'));\n    this.props.onCreateTopic(undefined,\n      {public: theCard(name, dataUrl, null, description), private: priv, tags: tags}, isChannel);\n  }\n\n  handleGroupByID(topicName) {\n    HashNavigation.navigateTo(HashNavigation.removeUrlParam(window.location.hash, 'tab'));\n    this.props.onCreateTopic(topicName);\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    const no_contacts_placeholder = formatMessage(this.state.searchQuery ?\n      messages.search_no_results : messages.search_for_contacts);\n    const search_placeholder = formatMessage(messages.search_placeholder);\n    return (\n      <div className=\"flex-column\">\n        <ul className=\"tabbar\">\n          <li className={this.state.tabSelected === \"find\" ? \"active\" : null}>\n            <a href=\"#\" data-id=\"find\" onClick={this.handleTabClick}>\n              <FormattedMessage id=\"tabtitle_find_user\" defaultMessage=\"find\"\n                description=\"Tab title Find\" />\n            </a>\n          </li>\n          <li className={this.state.tabSelected === \"grp\" ? \"active\" : null}>\n            <a href=\"#\" data-id=\"grp\" onClick={this.handleTabClick}>\n              <FormattedMessage id=\"tabtitle_new_group\" defaultMessage=\"new group\"\n                description=\"Tab title New Group\" />\n            </a>\n          </li>\n          <li className={this.state.tabSelected === \"byid\" ? \"active\" : null}>\n            <a href=\"#\" data-id=\"byid\" onClick={this.handleTabClick}>\n              <FormattedMessage id=\"tabtitle_group_by_id\" defaultMessage=\"by id\"\n                description=\"Tab title Find topic by ID\" />\n            </a>\n          </li>\n        </ul>\n        {this.state.tabSelected === 'grp' ?\n          <NewTopicGroup\n            tinode={this.props.tinode}\n            onSubmit={this.handleNewGroupSubmit} /> :\n          this.state.tabSelected === 'byid' ?\n            <NewTopicById\n              onSubmit={this.handleGroupByID}\n              onError={this.props.onError} /> :\n            <div className=\"flex-column\">\n              <SearchContacts\n                placeholder={search_placeholder}\n                onSearchContacts={this.handleSearchContacts} />\n              <ContactList\n                tinode={this.props.tinode}\n                contacts={this.props.searchResults}\n                myUserId={this.props.myUserId}\n                emptyListMessage={no_contacts_placeholder}\n                showOnline={false}\n                showUnread={false}\n                showContextMenu={false}\n                onTopicSelected={this.handleSearchResultSelected} />\n            </div>}\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(NewTopicView);\n","// A password reset form.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport VisiblePassword from '../widgets/visible-password.jsx';\n\nimport HashNavigation from '../lib/navigation.js';\n\nexport default class PasswordResetView extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      email: '',\n      password: '',\n      sent: false\n    };\n\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleEmailChange = this.handleEmailChange.bind(this);\n    this.handlePasswordChange = this.handlePasswordChange.bind(this);\n  }\n\n  componentDidMount() {\n    const parsed = HashNavigation.parseUrlHash(window.location.hash);\n    this.setState({token: parsed.params.token, scheme: parsed.params.scheme});\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    if (this.state.token) {\n      this.props.onReset(this.state.scheme, this.state.password.trim(), this.state.token);\n    } else if (this.state.sent) {\n      this.props.onCancel();\n    } else {\n      const email = this.state.email.trim();\n      this.setState({email: email});\n      this.props.onRequest('email', email).then(() => {\n        this.setState({sent: true});\n      });\n    }\n  }\n\n  handleEmailChange(e) {\n    this.setState({email: e.target.value});\n  }\n\n  handlePasswordChange(e) {\n    this.setState({password: e.target.value});\n  }\n\n  render() {\n    return (\n      <form id=\"password-reset-form\" onSubmit={this.handleSubmit}>\n        {(this.state.token && this.state.scheme) ?\n          <><label htmlFor=\"new-password\">\n            <FormattedMessage id=\"label_new_password\"\n              defaultMessage=\"New password\"\n              description=\"Label for entering a new password\" />\n          </label>\n          <FormattedMessage id=\"new_password_placeholder\" defaultMessage=\"Enter new password\"\n            description=\"Placeholder for entering new password\">{\n            (placeholder) => <VisiblePassword\n              id=\"new-password\"\n              placeholder={placeholder}\n              autoComplete=\"new-password\"\n              value={this.state.password}\n              required={true} autoFocus={true}\n              onChange={this.handlePasswordChange} />\n          }</FormattedMessage></>\n        : this.state.sent ?\n          <>\n            <br/>\n            <center><i className=\"material-icons huge green\">task_alt</i></center>\n            <br/>\n            <center><FormattedMessage id=\"password_reset_email_sent\"\n              defaultMessage=\"An email has been sent to {email}. Follow the directions in the email to reset your password.\"\n              values={{ email: <tt>{this.state.email}</tt> }}\n              description=\"Notification that the email with password reset instructions has been sent\" /></center>\n          </>\n        :\n          <>\n            <label htmlFor=\"inputEmail\">\n              <FormattedMessage id=\"label_reset_password\"\n                defaultMessage=\"Send a password reset email:\"\n                description=\"Label for password reset field\" />\n            </label>\n            <FormattedMessage id=\"credential_email_prompt\" defaultMessage=\"Your registration email\"\n              description=\"Placeholder for entering email\">{\n              (placeholder) => <input type=\"email\" id=\"inputEmail\"\n                placeholder={placeholder}\n                autoComplete=\"email\"\n                value={this.state.email}\n                onChange={this.handleEmailChange}\n                required autoFocus />\n            }</FormattedMessage>\n          </>\n        }\n        <div className=\"dialog-buttons\">\n          <button className=\"primary\" type=\"submit\">{\n            (this.state.token && this.state.scheme) ?\n            <FormattedMessage id=\"button_reset\" defaultMessage=\"Reset\" description=\"Button [Reset]\" />\n            : this.state.sent ?\n            <FormattedMessage id=\"button_ok\" defaultMessage=\"OK\"\n              description=\"Button [OK]\" />\n            :\n            <FormattedMessage id=\"button_send_request\" defaultMessage=\"Send request\"\n              description=\"Button [Send request]\" />\n          }</button>\n        </div>\n      </form>\n    );\n  }\n}\n","import React from 'react';\n\nimport { KNOWN_HOSTS } from '../config.js';\n\n/* Combobox for selecting host name */\n\nexport default class HostSelector extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      hostName: props.serverAddress,\n      changed: false\n    };\n\n    this.handleHostNameChange = this.handleHostNameChange.bind(this);\n    this.handleEditingFinished = this.handleEditingFinished.bind(this);\n  }\n\n  handleHostNameChange(e) {\n    this.setState({hostName: e.target.value, changed: true});\n  }\n\n  handleEditingFinished() {\n    if (this.state.changed) {\n      this.setState({changed: false});\n      this.props.onServerAddressChange(this.state.hostName.trim());\n    }\n  }\n\n  render() {\n    var hostOptions = [];\n    for (let key in KNOWN_HOSTS) {\n      let item = KNOWN_HOSTS[key];\n      hostOptions.push(\n        <option key={item} value={item} />\n      );\n    }\n    return (\n      <div className=\"panel-form-row\">\n        <input type=\"search\" id=\"host-name\" placeholder={this.props.hostName} list=\"known-hosts\"\n          className=\"quoted\" value={this.state.hostName} onChange={this.handleHostNameChange}\n          onBlur={this.handleEditingFinished} required />\n        <datalist id=\"known-hosts\">\n          {hostOptions}\n        </datalist>\n      </div>\n    );\n  }\n}\n","// Tinode config panel.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport HostSelector from '../widgets/host-selector.jsx';\n\nexport default class SettingsView extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      transport: props.transport || 'def',\n      serverAddress: props.serverAddress,\n    };\n\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleTransportSelected = this.handleTransportSelected.bind(this);\n    this.handleServerAddressChange = this.handleServerAddressChange.bind(this);\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    this.props.onUpdate({\n      transport: this.state.transport,\n      serverAddress: this.state.serverAddress\n    });\n  }\n\n  handleTransportSelected(e) {\n    this.setState({transport: e.currentTarget.value});\n  }\n\n  handleServerAddressChange(name) {\n    this.setState({serverAddress: name});\n  }\n\n  render() {\n    const names = {def: \"default\", ws: \"websocket\", lp: \"long polling\"};\n    const transportOptions = [];\n    ['def', 'ws', 'lp'].map((item) => {\n      const id = 'transport-' + item;\n      const name = names[item];\n      transportOptions.push(\n        <li key={item}>\n          <input type=\"radio\" id={id} name=\"transport-select\" value={item}\n            checked={this.state.transport === item}\n            onChange={this.handleTransportSelected} />\n          <label htmlFor={id}>{name}</label>\n        </li>\n      );\n    });\n\n    return (\n      <form id=\"settings-form\" className=\"panel-form\" onSubmit={this.handleSubmit}>\n        <div className=\"panel-form-row\">\n          <label className=\"small\">\n            <FormattedMessage id=\"label_server_to_use\" defaultMessage=\"Server to use:\"\n              description=\"Label for server selector in SettingsView\" />\n          </label>\n        </div>\n        <HostSelector serverAddress={this.state.serverAddress}\n          onServerAddressChange={this.handleServerAddressChange} />\n        <div className=\"panel-form-row\">\n          <label className=\"small\">\n            <FormattedMessage id=\"label_wire_transport\" defaultMessage=\"Wire transport:\"\n              description=\"Label for wire transport selection in SettingsView\" />\n          </label>\n        </div>\n        <div className=\"panel-form-row\">\n          <ul className=\"quoted\">\n            {transportOptions}\n          </ul>\n        </div>\n        <div className=\"dialog-buttons\">\n          <button type=\"submit\" className=\"primary\">\n            <FormattedMessage id=\"button_update\" defaultMessage=\"Update\"\n              description=\"Button [Update]\" />\n          </button>\n        </div>\n      </form>\n    );\n  }\n};\n","// ValidationView: panel for confirming credentials, like email or phone.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nconst messages = defineMessages({\n  phone: {\n    id: 'phone_dative',\n    defaultMessage: 'phone',\n    description: \"Dative case of 'phone', i.e. 'phone' in 'by phone'\",\n  },\n  email: {\n    id: 'email_dative',\n    defaultMessage: 'email',\n    description: \"Dative case of 'email', i.e. 'email' in 'by email'\",\n  }\n});\n\nclass ValidationView extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      code: props.credCode || ''\n    };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  handleChange(e) {\n    this.setState({code: e.target.value});\n  }\n\n  handleKeyPress(e) {\n    if (e.key === 'Enter') {\n      this.handleSubmit(e);\n    } else if (e.key == 'Escape') {\n      this.handleCancel(e);\n    }\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    if (this.state.code && this.state.code.trim()) {\n      this.props.onSubmit(this.props.credMethod, this.state.code.trim());\n    }\n  }\n\n  handleCancel(e) {\n    e.preventDefault();\n    this.props.onCancel();\n  }\n\n\n  render() {\n    const { formatMessage } = this.props.intl;\n    const methods = {'email': formatMessage(messages.email), 'tel': formatMessage(messages.phone)};\n    let method = methods[this.props.credMethod] || this.props.credMethod;\n    return (\n      <div className=\"panel-form\">\n        <div className=\"panel-form-row\">\n          <label className=\"small\" htmlFor=\"enter-confirmation-code\">\n            <FormattedMessage id=\"enter_confirmation_code_prompt\"\n              defaultMessage=\"Enter confirmation code sent to you by {method}:\"\n              description=\"Request to enter confirmation code\"\n              values={{method: method}} />\n          </label>\n        </div>\n        <div className=\"panel-form-row\">\n        <FormattedMessage id=\"numeric_confirmation_code_prompt\"\n          defaultMessage=\"Numbers only\" description=\"Prompt for numeric conformation code\">{\n          (numbers_only) => <input type=\"text\" id=\"enter-confirmation-code\"\n            placeholder={numbers_only}\n            value={this.state.code} onChange={this.handleChange}\n            onKeyPress={this.handleKeyPress} required />\n        }</FormattedMessage>\n        </div>\n        <div className=\"dialog-buttons\">\n          <button className=\"secondary\" onClick={this.handleCancel}>\n            <FormattedMessage id=\"button_cancel\" defaultMessage=\"Cancel\" description=\"Button [Cancel]\" />\n          </button>\n          <button className=\"primary\" onClick={this.handleSubmit}>\n            <FormattedMessage id=\"button_confirm\" defaultMessage=\"Confirm\" description=\"Button [Confirm]\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(ValidationView);\n","import React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\n\nimport ErrorPanel from '../widgets/error-panel.jsx';\nimport LoadSpinner from '../widgets/load-spinner.jsx';\nimport SideNavbar from '../widgets/side-navbar.jsx';\nimport TopicCommon from '../widgets/topic-common.jsx';\n\nimport AccountSettingsView from './account-settings-view.jsx';\nimport ContactsView from './contacts-view.jsx';\nimport CreateAccountView from './create-account-view.jsx';\nimport AccNotificationsView from './acc-notifications-view.jsx';\nimport AccSecurityView from './acc-security-view.jsx';\nimport AccSupportView from './acc-support-view.jsx';\nimport LoginView from './login-view.jsx';\nimport NewTopicView from './new-topic-view.jsx';\nimport PasswordResetView from './password-reset-view.jsx';\nimport SettingsView from './settings-view.jsx';\nimport ValidationView from './validation-view.jsx';\n\n// Panel titles for translation.\nconst messages = defineMessages({\n  login: {\n    id: 'sidepanel_title_login',\n    description: 'Sidepanel title for LoginView.',\n    defaultMessage: 'Sign In'\n  },\n  register: {\n    id: 'sidepanel_title_register',\n    description: 'Sidepanel title for CreateAccountView.',\n    defaultMessage: 'Create Account'\n  },\n  settings: {\n    id: 'sidepanel_title_settings',\n    description: 'Sidepanel title for SettingsView.',\n    defaultMessage: 'Settings'\n  },\n  edit: {\n    id: 'sidepanel_title_account_settings',\n    description: 'Sidepanel title for AccountSettingsView.',\n    defaultMessage: 'Account Settings'\n  },\n  general: {\n    id: 'panel_title_general',\n    description: 'Title for TopicCommon.',\n    defaultMessage: 'General'\n  },\n  security: {\n    id: 'panel_title_security',\n    description: 'Title for TopicSecirity and AccSecurity.',\n    defaultMessage: 'Security'\n  },\n  crop: {\n    id: 'panel_title_crop',\n    description: 'Title for AvatarCropView.',\n    defaultMessage: 'Drag to Adjust'\n  },\n  notif: {\n    id: 'sidepanel_title_acc_notifications',\n    description: 'Sidepanel title for AccNotificationsView.',\n    defaultMessage: 'Notifications'\n  },\n  support: {\n    id: 'sidepanel_title_acc_support',\n    description: 'Sidepanel title for AccSupportView.',\n    defaultMessage: 'Support'\n  },\n  newtpk: {\n    id: 'sidepanel_title_newtpk',\n    description: 'Sidepanel title for NewTopicView.',\n    defaultMessage: 'Start New Chat'\n  },\n  cred: {\n    id: 'sidepanel_title_cred',\n    description: 'Sidepanel title for ValidationView.',\n    defaultMessage: 'Confirm Credentials'\n  },\n  reset: {\n    id: 'sidepanel_title_reset',\n    description: 'Sidepanel title for PasswordResetView.',\n    defaultMessage: 'Reset Password'\n  },\n  archive: {\n    id: 'sidepanel_title_archive',\n    description: 'Sidepanel title for ContactsView-Archive.',\n    defaultMessage: 'Archived Chats'\n  },\n  blocked: {\n    id: 'sidepanel_title_blocked',\n    description: 'Sidepanel title for ContactsView-Blocked.',\n    defaultMessage: 'Blocked Chats'\n  }\n});\n\nclass SidepanelView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleNewTopic = this.handleNewTopic.bind(this);\n  }\n\n  handleNewTopic() {\n    this.props.onNavigate('newtpk');\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n    const view = this.props.state || (this.props.myUserId ? 'contacts' : 'login');\n\n    let title, avatar, badges;\n    if (view == 'contacts') {\n      title = this.props.title;\n      avatar = this.props.avatar ? this.props.avatar : true;\n      badges = this.props.trustedBadges;\n    } else {\n      title = formatMessage(messages[view]);\n      avatar = false;\n      badges = null;\n    }\n\n    let onCancel;\n    if (['login', 'contacts'].indexOf(view) == -1) {\n      onCancel = this.props.onCancel;\n    }\n\n    return (\n      <div id=\"sidepanel\" className={this.props.hideSelf ? 'nodisplay' : null}>\n        <SideNavbar\n          state={view}\n          title={title}\n          avatar={avatar}\n          tinode={this.props.tinode}\n          trustedBadges={badges}\n          myUserId={this.props.myUserId}\n          onSignUp={this.props.onSignUp}\n          onSettings={this.props.onSettings}\n          onNewTopic={this.handleNewTopic}\n          onCancel={onCancel} />\n\n        <ErrorPanel\n          level={this.props.errorLevel}\n          text={this.props.errorText}\n          action={this.props.errorAction}\n          actionText={this.props.errorActionText}\n          onClearError={this.props.onError} />\n\n        <LoadSpinner show={this.props.loadSpinnerVisible} />\n\n        {view === 'login' ?\n          <LoginView\n            login={this.props.login}\n            disabled={this.props.loginDisabled}\n            persist={this.props.persist}\n            onLogin={this.props.onLoginRequest}\n            onPersistenceChange={this.props.onPersistenceChange} /> :\n\n          view === 'register' ?\n          <CreateAccountView\n            tinode={this.props.tinode}\n            onCreateAccount={this.props.onCreateAccount}\n            onCancel={this.props.onCancel}\n            onError={this.props.onError} /> :\n\n          view === 'settings' ?\n          <SettingsView\n            transport={this.props.transport}\n            serverAddress={this.props.serverAddress}\n            onCancel={this.props.onCancel}\n            onUpdate={this.props.onGlobalSettings} /> :\n\n          view === 'edit' ?\n          <AccountSettingsView\n            tinode={this.props.tinode}\n            myUserId={this.props.myUserId}\n            trustedBadges={this.props.trustedBadges}\n            onNavigate={this.props.onNavigate} /> :\n\n          (view === 'general' || view === 'crop') ?\n          <TopicCommon\n            topic=\"me\"\n            tinode={this.props.tinode}\n            myUserId={this.props.myUserId}\n            onUpdateTopicDesc={this.props.onUpdateAccountDesc}\n            onUpdateTags={this.props.onUpdateAccountTags}\n            onCredAdd={this.props.onCredAdd}\n            onCredDelete={this.props.onCredDelete}\n            onCredConfirm={this.props.onCredConfirm}\n            onError={this.props.onError} /> :\n\n          view === 'notif' ?\n          <AccNotificationsView\n            messageSounds={this.props.messageSounds}\n            desktopAlerts={this.props.desktopAlerts}\n            desktopAlertsEnabled={this.props.desktopAlertsEnabled}\n            incognitoMode={this.props.incognitoMode}\n            onTogglePushNotifications={this.props.onTogglePushNotifications}\n            onToggleMessageSounds={this.props.onToggleMessageSounds}\n            onToggleIncognitoMode={this.props.onToggleIncognitoMode} /> :\n\n          view === 'security' ?\n          <AccSecurityView\n            tinode={this.props.tinode}\n            onUpdateAccountDesc={this.props.onUpdateAccountDesc}\n            onUpdatePassword={this.props.onUpdatePassword}\n            onLogout={this.props.onLogout}\n            onDeleteAccount={this.props.onDeleteAccount}\n            onShowAlert={this.props.onShowAlert}\n            onShowBlocked={this.props.onShowBlocked} /> :\n\n          view === 'support' ?\n          <AccSupportView\n            serverAddress={this.props.serverAddress}\n            serverVersion={this.props.serverVersion} /> :\n\n          (view === 'contacts' || view == 'archive' || view == 'blocked') ?\n          <ContactsView\n            tinode={this.props.tinode}\n            myUserId={this.props.myUserId}\n            connected={this.props.connected}\n            topicSelected={this.props.topicSelected}\n            archive={view == 'archive'}\n            blocked={view == 'blocked'}\n            chatList={this.props.chatList}\n            showContextMenu={this.props.showContextMenu}\n            onTopicSelected={this.props.onTopicSelected}\n            onShowArchive={this.props.onShowArchive} /> :\n\n          view === 'newtpk' ?\n          <NewTopicView\n            tinode={this.props.tinode}\n            searchResults={this.props.searchResults}\n            onInitFind={this.props.onInitFind}\n            onSearchContacts={this.props.onSearchContacts}\n            onCreateTopic={this.props.onCreateTopic}\n            onError={this.props.onError} /> :\n\n          view === 'cred' ?\n          <ValidationView\n            credCode={this.props.credCode}\n            credMethod={this.props.credMethod}\n            onSubmit={this.props.onValidateCredentials}\n            onCancel={this.props.onCancel}\n            onError={this.props.onError} /> :\n\n          view === 'reset' ?\n          <PasswordResetView\n            onRequest={this.props.onPasswordResetRequest}\n            onReset={this.props.onResetPassword}\n            onCancel={this.props.onCancel} /> :\n          null}\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(SidepanelView);\n","import { KNOWN_HOSTS, DEFAULT_HOST } from '../config.js';\n\n// Detect server address from the URL\nexport function detectServerAddress() {\n  let host = DEFAULT_HOST;\n  if (typeof window.location == 'object') {\n    if (window.location.protocol == 'file:' || window.location.hostname == 'localhost') {\n      host = KNOWN_HOSTS.local;\n    } else if (window.location.hostname) {\n      host = window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n    }\n  }\n  return host;\n}\n\n// Detect if the page is served over HTTPS.\nexport function isSecureConnection() {\n  if (typeof window.location == 'object') {\n    return window.location.protocol == 'https:';\n  }\n  return false;\n}\n\nexport function isLocalHost() {\n  if (typeof window.location == 'object') {\n    return window.location.hostname == 'localhost';\n  }\n  return false;\n}\n","// The top-level class to hold all functionality together.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport { initializeApp as firebaseInitApp } from 'firebase/app';\nimport { getMessaging as firebaseGetMessaging, getToken as firebaseGetToken,\n  deleteToken as firebaseDelToken, onMessage as firebaseOnMessage } from 'firebase/messaging';\n\nimport { Drafty, Tinode } from 'tinode-sdk';\n\nimport Alert from '../widgets/alert.jsx';\nimport ContextMenu from '../widgets/context-menu.jsx';\nimport ForwardDialog from '../widgets/forward-dialog.jsx';\n\nimport InfoView from './info-view.jsx';\nimport IncomingCallView from './incoming-call-view.jsx';\nimport MessagesView from './messages-view.jsx';\nimport SidepanelView from './sidepanel-view.jsx';\n\nimport { API_KEY, APP_NAME, DEFAULT_P2P_ACCESS_MODE, FORWARDED_PREVIEW_LENGTH, LOGGING_ENABLED,\n  MEDIA_BREAKPOINT, RECEIVED_DELAY,\n  CALL_STATE_NONE, CALL_STATE_OUTGOING_INITATED,\n  CALL_STATE_INCOMING_RECEIVED, CALL_STATE_IN_PROGRESS } from '../config.js';\nimport { PACKAGE_VERSION } from '../version.js';\nimport { base64ReEncode, makeImageUrl } from '../lib/blob-helpers.js';\nimport { detectServerAddress, isLocalHost, isSecureConnection } from '../lib/host-name.js';\nimport LocalStorageUtil from '../lib/local-storage.js';\nimport HashNavigation from '../lib/navigation.js';\nimport { secondsToTime } from '../lib/strformat.js'\nimport { updateFavicon } from '../lib/utils.js';\n\n// Sound to play on message received.\nconst POP_SOUND = new Audio('audio/msg.mp3');\n\nconst messages = defineMessages({\n  reconnect_countdown: {\n    id: 'reconnect_countdown',\n    defaultMessage: 'Disconnected. Reconnecting in {seconds}…',\n    description: 'Message shown when an app update is available.'\n  },\n  reconnect_now: {\n    id: 'reconnect_now',\n    defaultMessage: 'Try now',\n    description: 'Prompt for reconnecting now'\n  },\n  push_init_failed: {\n    id: 'push_init_failed',\n    defaultMessage: 'Failed to initialize push notifications',\n    description: 'Error message when push notifications have failed to initialize.'\n  },\n  invalid_security_token: {\n    id: 'invalid_security_token',\n    defaultMessage: 'Invalid security token',\n    description: 'Error message when resetting password.'\n  },\n  no_connection: {\n    id: 'no_connection',\n    defaultMessage: 'No connection',\n    description: 'Warning that the user is offline.'\n  },\n  code_doesnot_match: {\n    id: 'code_doesnot_match',\n    defaultMessage: 'Code does not match',\n    description: 'Error message when the credential validation code is incorrect.'\n  },\n  menu_item_info: {\n    id: 'menu_item_info',\n    defaultMessage: 'Info',\n    description: 'Show extended topic information'\n  },\n  menu_item_video_call: {\n    id: 'menu_item_video_call',\n    defaultMessage: 'Video Call',\n    description: 'Start video call'\n  }\n});\n\nclass TinodeWeb extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.selfRef = React.createRef();\n\n    this.state = this.getBlankState();\n\n    this.handleResize = this.handleResize.bind(this);\n    this.handleHashRoute = this.handleHashRoute.bind(this);\n    this.handleOnline = this.handleOnline.bind(this);\n    this.checkForAppUpdate = this.checkForAppUpdate.bind(this);\n    this.handleVisibilityEvent = this.handleVisibilityEvent.bind(this);\n    this.handleError = this.handleError.bind(this);\n    this.handleLoginRequest = this.handleLoginRequest.bind(this);\n    this.handlePersistenceChange = this.handlePersistenceChange.bind(this);\n    this.handleConnected = this.handleConnected.bind(this);\n    this.handleAutoreconnectIteration = this.handleAutoreconnectIteration.bind(this);\n    this.doLogin = this.doLogin.bind(this);\n    this.handleCredentialsRequest = this.handleCredentialsRequest.bind(this);\n    this.handleLoginSuccessful = this.handleLoginSuccessful.bind(this);\n    this.handleDisconnect = this.handleDisconnect.bind(this);\n    this.tnMeMetaDesc = this.tnMeMetaDesc.bind(this);\n    this.tnMeContactUpdate = this.tnMeContactUpdate.bind(this);\n    this.tnMeSubsUpdated = this.tnMeSubsUpdated.bind(this);\n    this.resetContactList = this.resetContactList.bind(this);\n    this.tnData = this.tnData.bind(this);\n    this.tnInitFind = this.tnInitFind.bind(this);\n    this.tnFndSubsUpdated = this.tnFndSubsUpdated.bind(this);\n    this.handleSearchContacts = this.handleSearchContacts.bind(this);\n    this.handleTopicSelected = this.handleTopicSelected.bind(this);\n    this.handleHideMessagesView = this.handleHideMessagesView.bind(this);\n    this.handleSendMessage = this.handleSendMessage.bind(this);\n    this.handleNewChatInvitation = this.handleNewChatInvitation.bind(this);\n    this.handleNewAccount = this.handleNewAccount.bind(this);\n    this.handleNewAccountRequest = this.handleNewAccountRequest.bind(this);\n    this.handleUpdatePasswordRequest = this.handleUpdatePasswordRequest.bind(this);\n    this.handleUpdateAccountTagsRequest = this.handleUpdateAccountTagsRequest.bind(this);\n    this.handleToggleIncognitoMode = this.handleToggleIncognitoMode.bind(this);\n    this.handleSettings = this.handleSettings.bind(this);\n    this.handleGlobalSettings = this.handleGlobalSettings.bind(this);\n    this.handleShowArchive = this.handleShowArchive.bind(this);\n    this.handleShowBlocked = this.handleShowBlocked.bind(this);\n    this.handleToggleMessageSounds = this.handleToggleMessageSounds.bind(this);\n    this.handleCredAdd = this.handleCredAdd.bind(this);\n    this.handleCredDelete = this.handleCredDelete.bind(this);\n    this.handleCredConfirm = this.handleCredConfirm.bind(this);\n    this.initFCMessaging = this.initFCMessaging.bind(this);\n    this.toggleFCMToken = this.toggleFCMToken.bind(this);\n    this.handlePushMessage = this.handlePushMessage.bind(this);\n    this.handleSidepanelCancel = this.handleSidepanelCancel.bind(this);\n    this.handleStartTopicRequest = this.handleStartTopicRequest.bind(this);\n    this.handleNewTopicCreated = this.handleNewTopicCreated.bind(this);\n    this.handleTopicUpdateRequest = this.handleTopicUpdateRequest.bind(this);\n    this.handleUnarchive = this.handleUnarchive.bind(this);\n    this.handleChangePermissions = this.handleChangePermissions.bind(this);\n    this.handleTagsUpdateRequest = this.handleTagsUpdateRequest.bind(this);\n    this.handleLogout = this.handleLogout.bind(this);\n    this.handleDeleteAccount = this.handleDeleteAccount.bind(this);\n    this.handleDeleteTopicRequest = this.handleDeleteTopicRequest.bind(this);\n    this.handleDeleteMessagesRequest = this.handleDeleteMessagesRequest.bind(this);\n    this.handleLeaveUnsubRequest = this.handleLeaveUnsubRequest.bind(this);\n    this.handleBlockTopicRequest = this.handleBlockTopicRequest.bind(this);\n    this.handleReportTopic = this.handleReportTopic.bind(this);\n    this.handleShowContextMenu = this.handleShowContextMenu.bind(this);\n    this.defaultTopicContextMenu = this.defaultTopicContextMenu.bind(this);\n    this.handleHideContextMenu = this.handleHideContextMenu.bind(this);\n    this.handleShowAlert = this.handleShowAlert.bind(this);\n    this.handleShowInfoView = this.handleShowInfoView.bind(this);\n    this.handleMemberUpdateRequest = this.handleMemberUpdateRequest.bind(this);\n    this.handleValidateCredentialsRequest = this.handleValidateCredentialsRequest.bind(this);\n    this.handlePasswordResetRequest = this.handlePasswordResetRequest.bind(this);\n    this.handleResetPassword = this.handleResetPassword.bind(this);\n    this.handleContextMenuAction = this.handleContextMenuAction.bind(this);\n\n    this.handleShowForwardDialog = this.handleShowForwardDialog.bind(this);\n    this.handleHideForwardDialog = this.handleHideForwardDialog.bind(this);\n\n    this.handleStartVideoCall = this.handleStartVideoCall.bind(this);\n    this.handleInfoMessage = this.handleInfoMessage.bind(this);\n    this.handleCallClose = this.handleCallClose.bind(this);\n\n    this.handleCallInvite = this.handleCallInvite.bind(this);\n    this.handleCallRinging = this.handleCallRinging.bind(this);\n    this.handleCallHangup = this.handleCallHangup.bind(this);\n    this.handleCallSendOffer = this.handleCallSendOffer.bind(this);\n    this.handleCallIceCandidate = this.handleCallIceCandidate.bind(this);\n    this.handleCallSendAnswer = this.handleCallSendAnswer.bind(this);\n\n    this.handleCallAcceptCall = this.handleCallAcceptCall.bind(this);\n\n    this.sendMessageToTopic = this.sendMessageToTopic.bind(this);\n  }\n\n  getBlankState() {\n    const settings = LocalStorageUtil.getObject('settings') || {};\n    const persist = !!LocalStorageUtil.getObject('keep-logged-in');\n\n    return {\n      connected: false,\n      // Connected and subscribed to 'me'\n      ready: false,\n      // Try to re-login on new connection.\n      autoLogin: false,\n      transport: settings.transport || null,\n      serverAddress: settings.serverAddress || detectServerAddress(),\n      serverVersion: \"no connection\",\n      // \"On\" is the default, so saving the \"off\" state.\n      messageSounds: !settings.messageSoundsOff,\n      incognitoMode: false,\n      // Persistent request to enable alerts.\n      desktopAlerts: persist && !!settings.desktopAlerts,\n      // Enable / disable checkbox.\n      desktopAlertsEnabled: (isSecureConnection() || isLocalHost()) &&\n        (typeof firebaseInitApp != 'undefined') && (typeof navigator != 'undefined') &&\n        (typeof FIREBASE_INIT != 'undefined'),\n      firebaseToken: persist ? LocalStorageUtil.getObject('firebase-token') : null,\n\n      applicationVisible: !document.hidden,\n\n      errorText: '',\n      errorLevel: null,\n      errorAction: undefined,\n      errorActionText: null,\n\n      sidePanelSelected: 'login',\n      sidePanelTitle: null,\n      sidePanelAvatar: null,\n      myTrustedBadges: [],\n      loadSpinnerVisible: false,\n\n      login: '',\n      password: '',\n      persist: persist,\n      myUserId: null,\n      liveConnection: navigator.onLine,\n      topicSelected: '',\n      topicSelectedOnline: false,\n      topicSelectedAcs: null,\n      newTopicParams: null,\n      loginDisabled: false,\n      displayMobile: (window.innerWidth <= MEDIA_BREAKPOINT),\n      infoPanel: undefined,\n      mobilePanel: 'sidepanel',\n\n      // Video calls.\n      callTopic: undefined,\n      callState: CALL_STATE_NONE,\n      // If true, call state should be transitioned to CALL_STATE_IN_PROGRESS upon\n      // switching to the call topic.\n      callShouldStart: false,\n\n      contextMenuVisible: false,\n      contextMenuBounds: null,\n      contextMenuClickAt: null,\n      contextMenuParams: null,\n      contextMenuItems: [],\n\n      forwardDialogVisible: false,\n      forwardMessage: null,\n\n      // Modal alert dialog.\n      alertVisible: false,\n      alertParams: {},\n\n      // Chats as shown in the ContactsView\n      chatList: [],\n      // Contacts returned by a search query.\n      searchResults: [],\n      // Merged results of a search query and p2p chats.\n      searchableContacts: [],\n      credMethod: undefined,\n      credCode: undefined,\n      // Topic to go to after login.\n      requestedTopic: undefined\n    };\n  }\n\n  componentDidMount() {\n    window.addEventListener('resize', this.handleResize);\n    window.addEventListener('online', (e) => { this.handleOnline(true); });\n    window.addEventListener('offline', (e) => { this.handleOnline(false); });\n    window.addEventListener('hashchange', this.handleHashRoute);\n\n    // Process background notifications from the service worker.\n    if (typeof BroadcastChannel == 'function') {\n      const serviceWorkerChannel = new BroadcastChannel('tinode-sw');\n      serviceWorkerChannel.addEventListener('message', this.handlePushMessage);\n    } else {\n      // Safari is broken by design.\n      console.warn(\"Your browser does not support BroadcastChannel. Some features will not be available\");\n    }\n\n    // Window/tab visible or invisible for pausing timers.\n    document.addEventListener('visibilitychange', this.handleVisibilityEvent);\n\n    this.setState({\n      viewportWidth: document.documentElement.clientWidth,\n      viewportHeight: document.documentElement.clientHeight\n    });\n\n    new Promise((resolve, reject) => {\n      this.tinode = TinodeWeb.tnSetup(this.state.serverAddress, this.state.transport,\n        this.props.intl.locale, this.state.persist, resolve);\n      this.tinode.onConnect = this.handleConnected;\n      this.tinode.onDisconnect = this.handleDisconnect;\n      this.tinode.onAutoreconnectIteration = this.handleAutoreconnectIteration;\n      this.tinode.onInfoMessage = this.handleInfoMessage;\n    }).then(() => {\n      // Initialize desktop alerts.\n      if (this.state.desktopAlertsEnabled) {\n        this.initFCMessaging().then(() => {\n          if (this.state.desktopAlerts) {\n            this.tinode.setDeviceToken(this.state.firebaseToken);\n          }\n        }).catch(() => {\n          // do nothing: handled earlier.\n          // catch needed to pervent unnecessary logging of error.\n        });\n      }\n\n      // Parse and save the hash navigation params.\n      const parsedNav = HashNavigation.parseUrlHash(window.location.hash);\n\n      // Read contacts from cache.\n      this.resetContactList();\n\n      const token = this.state.persist ? LocalStorageUtil.getObject('auth-token') : undefined;\n      if (token) {\n        this.setState({autoLogin: true});\n\n        // When reading from storage, date is returned as string.\n        token.expires = new Date(token.expires);\n        this.tinode.setAuthToken(token);\n        this.tinode.connect().catch((err) => {\n          // Socket error\n          this.handleError(err.message, 'err');\n        });\n      }\n\n      // Maybe navigate to home screen.\n      if (!['cred', 'reset', 'register'].includes(parsedNav.path[0])) {\n        // Save possible topic name.\n        this.setState({requestedTopic: parsedNav.path[1]});\n        HashNavigation.navigateTo('');\n      }\n\n      this.readTimer = null;\n      this.readTimerCallback = null;\n\n      this.handleHashRoute();\n    });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.handleResize);\n    window.removeEventListener('hashchange', this.handleHashRoute);\n    document.removeEventListener('visibilitychange', this.handleVisibilityEvent);\n  }\n\n  // Setup transport (usually websocket) and server address. This will terminate connection with the server.\n  static tnSetup(serverAddress, transport, locale, persistentCache, onSetupCompleted) {\n    const tinode = new Tinode({appName: APP_NAME, host: serverAddress, apiKey: API_KEY, transport: transport,\n      secure: isSecureConnection(), persist: persistentCache}, onSetupCompleted);\n    tinode.setHumanLanguage(locale);\n    tinode.enableLogging(LOGGING_ENABLED, true);\n    return tinode;\n  }\n\n  // Tinode received a push notification from the server.\n  handlePushMessage(payload) {\n    const data = payload.data || {};\n    switch (data.what) {\n    case 'msg':\n      if (Tinode.isChannelTopicName(data.topic)) {\n        // The last argument is a fake user Id: otherwise the update is seen as one from the current user.\n        this.tinode.oobNotification('msg', data.topic, data.seq, 'fake-uid');\n      }\n      break;\n    case 'read':\n      // Message read on another device, clear it here.\n      this.tinode.oobNotification('read', data.topic, data.seq);\n      break;\n    default:\n      console.warn(\"Unknown push type ignored\", data.what, data);\n    }\n  }\n\n  initFCMessaging() {\n    const {formatMessage, locale} = this.props.intl;\n    const onError = (msg, err) => {\n      console.error(msg, err);\n      this.handleError(formatMessage(messages.push_init_failed), 'err');\n      this.setState({desktopAlertsEnabled: false, firebaseToken: null});\n      LocalStorageUtil.updateObject('settings', {desktopAlerts: false});\n    }\n\n    try {\n      this.fcm = firebaseGetMessaging(firebaseInitApp(FIREBASE_INIT, APP_NAME));\n      return navigator.serviceWorker.register('/service-worker.js').then((reg) => {\n        this.checkForAppUpdate(reg);\n        reg.active.postMessage(JSON.stringify({locale: locale, version: PACKAGE_VERSION}));\n        return reg;\n      }).then((reg) => {\n        // Request token.\n        return TinodeWeb.requestFCMToken(this.fcm, reg);\n      }).then((token) => {\n        const persist = LocalStorageUtil.getObject('keep-logged-in');\n        if (token != this.state.firebaseToken) {\n          this.tinode.setDeviceToken(token);\n          if (persist) {\n            LocalStorageUtil.setObject('firebase-token', token);\n          }\n        }\n        this.setState({firebaseToken: token, desktopAlerts: true});\n        if (persist) {\n          LocalStorageUtil.updateObject('settings', {desktopAlerts: true});\n        }\n\n        // Handhe FCM pushes\n        // (a) for channels always,\n        // (b) pushes when the app is in foreground but has no focus.\n        firebaseOnMessage(this.fcm, (payload) => { this.handlePushMessage(payload); });\n      }).catch((err) => {\n        // SW registration or FCM has failed :(\n        onError(err);\n        throw err;\n      });\n    } catch (err) {\n      onError(err);\n      return Promise.reject(err);\n    }\n  }\n\n  // Google's FCM API is idiotic.\n  static requestFCMToken(fcm, sw) {\n    return firebaseGetToken(fcm, {\n      serviceWorkerRegistration: sw,\n      vapidKey: FIREBASE_INIT.messagingVapidKey\n    }).then((token) => {\n      if (token) {\n        return token;\n      } else {\n        // Try to request permissions.\n        return Notification.requestPermission().then((permission) => {\n          if (permission === 'granted') {\n            return firebaseGetToken(fcm, {\n              serviceWorkerRegistration: reg,\n              vapidKey: FIREBASE_INIT.messagingVapidKey\n            }).then((token) => {\n              if (token) {\n                return token;\n              } else {\n                throw new Error(\"Failed to initialize notifications\");\n              }\n            });\n          } else {\n            throw new Error(\"No permission to send notifications: \" + permission);\n          }\n        });\n      }\n    });\n  }\n\n  handleResize() {\n    const mobile = document.documentElement.clientWidth <= MEDIA_BREAKPOINT;\n    this.setState({\n      viewportWidth: document.documentElement.clientWidth,\n      viewportHeight: document.documentElement.clientHeight\n    });\n    if (this.state.displayMobile != mobile) {\n      this.setState({displayMobile: mobile});\n    }\n  }\n\n  // Check if a newer version of TinodeWeb app is available at the server.\n  checkForAppUpdate(reg) {\n    reg.onupdatefound = () => {\n      const installingWorker = reg.installing;\n      installingWorker.onstatechange = () => {\n        if (installingWorker.state == 'installed' && navigator.serviceWorker.controller) {\n          const msg = <>\n            <FormattedMessage id=\"update_available\"\n              defaultMessage=\"Update available.\"\n              description=\"Message shown when an app update is available.\" /> <a href=\"\">\n              <FormattedMessage id=\"reload_update\"\n                defaultMessage=\"Reload\"\n                description=\"Call to action to reload application when update is available.\" />\n            </a>.</>;\n          this.handleError(msg, 'info');\n        }\n      }\n    }\n  }\n\n  // Handle for hashchange event: display appropriate panels.\n  handleHashRoute() {\n    const hash = HashNavigation.parseUrlHash(window.location.hash);\n    if (hash.path && hash.path.length > 0) {\n      // Left-side panel selector.\n      if (['register','settings','edit','notif','security','support','general','crop',\n          'cred','reset','newtpk','archive','blocked','contacts',''].includes(hash.path[0])) {\n        this.setState({sidePanelSelected: hash.path[0]});\n      } else {\n        console.warn(\"Unknown sidepanel view\", hash.path[0]);\n      }\n\n      // Topic for MessagesView selector.\n      let topicName = hash.path[1] || null;\n      if (topicName != this.state.topicSelected) {\n        if (!Tinode.topicType(topicName)) {\n          // Clear invalid topic name.\n          topicName = null;\n        }\n        this.setState({\n          topicSelected: topicName,\n          topicSelectedAcs: this.tinode.getTopicAccessMode(topicName)\n        });\n      }\n    } else {\n      // Empty hashpath\n      this.setState({sidePanelSelected: '', topicSelected: null});\n    }\n\n    // Save validation credentials, if available.\n    if (hash.params.method) {\n      this.setState({ credMethod: hash.params.method });\n    }\n    if (hash.params.code) {\n      this.setState({ credCode: hash.params.code });\n    }\n\n    // Additional parameters of panels.\n    this.setState({\n      infoPanel: hash.params.info,\n      newTopicTabSelected: hash.params.tab\n    });\n  }\n\n  handleOnline(online) {\n    if (online) {\n      this.handleError();\n      clearInterval(this.reconnectCountdown);\n      this.tinode.reconnect();\n    } else {\n      this.handleError(this.props.intl.formatMessage(messages.no_connection), 'warn');\n    }\n    this.setState({liveConnection: online});\n  }\n\n  handleVisibilityEvent() {\n    this.setState({applicationVisible: !document.hidden});\n  }\n\n  handleError(err, level, action, actionText) {\n    this.setState({\n      errorText: err,\n      errorLevel: level,\n      errorAction: action,\n      errorActionText: actionText,\n      callShouldStart: false,\n    });\n  }\n\n  // User clicked Login button in the side panel.\n  handleLoginRequest(login, password) {\n    this.setState({\n      loginDisabled: true,\n      login: login,\n      password: password,\n      loadSpinnerVisible: true,\n      autoLogin: true\n    });\n    this.handleError('', null);\n\n    if (this.tinode.isConnected()) {\n      this.doLogin(login, password, {meth: this.state.credMethod, resp: this.state.credCode});\n    } else {\n      this.tinode.connect().catch((err) => {\n        // Socket error\n        this.setState({loginDisabled: false, autoLogin: false, loadSpinnerVisible: false});\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  // Enable or disable saving the password and IndexedDB.\n  handlePersistenceChange(persist) {\n    if (persist) {\n      this.tinode.initStorage().then(() => {\n        LocalStorageUtil.setObject('keep-logged-in', true);\n        this.setState({persist: true});\n      });\n    } else {\n      this.tinode.clearStorage().then(() => {\n        LocalStorageUtil.setObject('keep-logged-in', false);\n        this.setState({persist: false});\n      });\n    }\n  }\n\n  // Connection succeeded.\n  handleConnected() {\n    // Just to be sure.\n    clearInterval(this.reconnectCountdown);\n    this.handleError();\n\n    const params = this.tinode.getServerInfo();\n    this.setState({\n      serverVersion: params.ver + ' ' + (params.build ? params.build : 'none')\n    });\n\n    if (this.state.autoLogin) {\n      this.doLogin(this.state.login, this.state.password, {meth: this.state.credMethod, resp: this.state.credCode});\n    }\n  }\n\n  // Called for each auto-reconnect iteration.\n  handleAutoreconnectIteration(sec, prom) {\n    clearInterval(this.reconnectCountdown);\n\n    if (sec < 0) {\n      // Clear error\n      this.handleError();\n      return;\n    }\n\n    if (prom) {\n      // Reconnecting now\n      prom.then(() => {\n        // Reconnected: clear error\n        this.handleError();\n      }).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n      return;\n    }\n\n    const {formatMessage} = this.props.intl;\n    let count = sec / 1000;\n    count = count | count;\n    this.reconnectCountdown = setInterval(() => {\n      const timeLeft = (count > 99) ? secondsToTime(count) : count;\n      this.handleError(\n        formatMessage(messages.reconnect_countdown, {seconds: timeLeft}),\n        'warn',\n        () => {\n          clearInterval(this.reconnectCountdown);\n          this.tinode.reconnect();\n        },\n        formatMessage(messages.reconnect_now)\n      );\n      count -= 1;\n    }, 1000);\n  }\n\n  // Connection lost\n  handleDisconnect(err) {\n    this.setState({\n      connected: false,\n      ready: false,\n      topicSelectedOnline: false,\n      errorText: err && err.message ? err.message : \"Disconnected\",\n      errorLevel: err && err.message ? 'err' : 'warn',\n      loginDisabled: false,\n      contextMenuVisible: false,\n      forwardDialogVisible: false,\n      serverVersion: \"no connection\"\n    });\n  }\n\n  doLogin(login, password, cred) {\n    if (this.tinode.isAuthenticated()) {\n      // Already logged in. Go to default screen.\n      HashNavigation.navigateTo('');\n      return;\n    }\n    // Sanitize and package credentail.\n    cred = Tinode.credential(cred);\n    // Try to login with login/password. If they are not available, try token. If no token, ask for login/password.\n    let promise = null;\n    let token = this.tinode.getAuthToken();\n    if (login && password) {\n      token = null;\n      this.setState({password: null});\n      promise = this.tinode.loginBasic(login, password, cred);\n    } else if (token) {\n      promise = this.tinode.loginToken(token.token, cred);\n    }\n\n    if (promise) {\n      promise.then((ctrl) => {\n        if (ctrl.code >= 300 && ctrl.text === 'validate credentials') {\n          this.setState({loadSpinnerVisible: false});\n          if (cred) {\n            this.handleError(this.props.intl.formatMessage(messages.code_doesnot_match), 'warn');\n          }\n          this.handleCredentialsRequest(ctrl.params);\n        } else {\n          this.handleLoginSuccessful();\n        }\n      }).catch((err) => {\n        // Login failed, report error.\n        this.setState({\n          loginDisabled: false,\n          credMethod: undefined,\n          credCode: undefined,\n          loadSpinnerVisible: false,\n          autoLogin: false\n        });\n        this.handleError(err.message, 'err');\n        if (token) {\n          this.handleLogout();\n        }\n        HashNavigation.navigateTo('');\n      });\n    } else {\n      // No login credentials provided.\n      // Make sure we are on the login page.\n      HashNavigation.navigateTo('');\n      this.setState({loginDisabled: false});\n    }\n  }\n\n  handleCredentialsRequest(params) {\n    const parsed = HashNavigation.parseUrlHash(window.location.hash);\n    parsed.path[0] = 'cred';\n    parsed.params['method'] = params.cred[0];\n    HashNavigation.navigateTo(HashNavigation.composeUrlHash(parsed.path, parsed.params));\n  }\n\n  handleLoginSuccessful() {\n    this.handleError();\n\n    // Refresh authentication token.\n    if (LocalStorageUtil.getObject('keep-logged-in')) {\n      LocalStorageUtil.setObject('auth-token', this.tinode.getAuthToken());\n    }\n\n    const goToTopic = this.state.requestedTopic;\n    // Logged in fine, subscribe to 'me' attaching callbacks from the contacts view.\n    const me = this.tinode.getMeTopic();\n    me.onMetaDesc = this.tnMeMetaDesc;\n    me.onContactUpdate = this.tnMeContactUpdate;\n    me.onSubsUpdated = this.tnMeSubsUpdated;\n    this.setState({\n      connected: true,\n      credMethod: undefined,\n      credCode: undefined,\n      myUserId: this.tinode.getCurrentUserID(),\n      autoLogin: true,\n      requestedTopic: undefined,\n    });\n    // Subscribe, fetch topic desc, the list of subscriptions. Messages are not fetched.\n    me.subscribe(\n      me.startMetaQuery().\n        withLaterSub().\n        withDesc().\n        withTags().\n        withCred().\n        build()\n      ).catch((err) => {\n        this.tinode.disconnect();\n        localStorage.removeItem('auth-token');\n        this.handleError(err.message, 'err');\n        HashNavigation.navigateTo('');\n      }).finally(() => {\n        this.setState({loadSpinnerVisible: false});\n      });\n    let urlHash = HashNavigation.setUrlSidePanel(window.location.hash, 'contacts');\n    if (goToTopic) {\n      urlHash = HashNavigation.setUrlTopic(urlHash, goToTopic);\n    }\n    HashNavigation.navigateTo(urlHash);\n  }\n\n  tnMeMetaDesc(desc) {\n    if (desc) {\n      if (desc.public) {\n        this.setState({\n          sidePanelTitle: desc.public.fn,\n          sidePanelAvatar: makeImageUrl(desc.public.photo)\n        });\n      }\n      if (desc.trusted) {\n        const badges = [];\n        for (const [key, val] of Object.entries(desc.trusted)) {\n          if (val) {\n            badges.push(key);\n          }\n        }\n        this.setState({\n          myTrustedBadges: badges,\n        });\n      }\n      if (desc.acs) {\n        this.setState({\n          incognitoMode: !desc.acs.isPresencer()\n        });\n      }\n    }\n  }\n\n  // Reactions to updates to the contact list.\n  tnMeContactUpdate(what, cont) {\n    if (what == 'on' || what == 'off') {\n      this.resetContactList();\n      if (this.state.topicSelected == cont.topic) {\n        this.setState({topicSelectedOnline: (what == 'on')});\n      }\n    } else if (what == 'read') {\n      this.resetContactList();\n    } else if (what == 'msg') {\n      // Check if the topic is archived. If so, don't play a sound.\n      const topic = this.tinode.getTopic(cont.topic);\n      const archived = topic && topic.isArchived();\n\n      // New message received. Maybe the message is from the current user, then unread is 0.\n      if (cont.unread > 0 && this.state.messageSounds && !archived) {\n        // Skip update if the topic is currently open, otherwise the badge will annoyingly flash.\n        if (document.hidden || this.state.topicSelected != cont.topic) {\n          POP_SOUND.play();\n        }\n      }\n      // Reorder contact list to use possibly updated 'touched'.\n      this.resetContactList();\n    } else if (what == 'recv') {\n      // Explicitly ignoring \"recv\" -- it causes no visible updates to contact list.\n    } else if (what == 'gone' || what == 'unsub') {\n      // Topic deleted or user unsubscribed. Remove topic from view.\n      // If the currently selected topic is gone, clear the selection.\n      if (this.state.topicSelected == cont.topic) {\n        this.handleTopicSelected(null);\n      }\n      // Redraw without the deleted topic.\n      this.resetContactList();\n    } else if (what == 'acs') {\n      // Permissions changed. If it's for the currently selected topic,\n      // update the views.\n      if (this.state.topicSelected == cont.topic) {\n        this.setState({topicSelectedAcs: cont.acs});\n      }\n    } else if (what == 'del') {\n      // TODO: messages deleted (hard or soft) -- update pill counter.\n    } else if (what == 'upd') {\n      // upd - handled by the SDK. Explicitly ignoring here.\n    } else {\n      // TODO(gene): handle other types of notifications:\n      // * ua -- user agent changes (maybe display a pictogram for mobile/desktop).\n      console.info(\"Unsupported (yet) presence update:\" + what + \" in: \" + cont.topic);\n    }\n  }\n\n  tnMeSubsUpdated(unused) {\n    this.resetContactList();\n  }\n\n  // Merge search results and contact list to create a single flat\n  // list of known contacts for GroupManager to use.\n  static prepareSearchableContacts(chatList, foundContacts) {\n    const merged = {};\n\n    // For chatList topics merge only p2p topics and convert them to the\n    // same format as foundContacts.\n    for (const c of chatList) {\n      if (Tinode.isP2PTopicName(c.topic)) {\n          merged[c.topic] = {\n            user: c.topic,\n            updated: c.updated,\n            public: c.public,\n            private: c.private,\n            acs: c.acs\n          };\n      }\n    }\n\n    // Add all foundCountacts if they have not been added already.\n    for (const c of foundContacts) {\n      if (!merged[c.user]) {\n        merged[c.user] = c;\n      }\n    }\n\n    return Object.values(merged);\n  }\n\n  resetContactList() {\n    const newState = {\n      chatList: []\n    };\n\n    if (!this.state.ready) {\n      newState.ready = true;\n    }\n\n    this.tinode.getMeTopic().contacts((c) => {\n      if (!c.topic && !c.user) {\n        // Contacts expect c.topic to be set.\n        c.topic = c.name;\n      }\n\n      newState.chatList.push(c);\n      if (this.state.topicSelected == c.topic) {\n        newState.topicSelectedOnline = c.online;\n        newState.topicSelectedAcs = c.acs;\n      }\n    });\n\n    const past = new Date(0);\n    newState.chatList.sort((a, b) => {\n      return (a.touched || past).getTime() - (b.touched || past).getTime();\n    });\n\n    // Merge search results and chat list.\n    newState.searchableContacts = TinodeWeb.prepareSearchableContacts(newState.chatList, this.state.searchResults);\n    this.setState(newState);\n  }\n\n  // Sending \"received\" notifications\n  tnData(data) {\n    const topic = this.tinode.getTopic(data.topic);\n    if (topic.msgStatus(data, true) >= Tinode.MESSAGE_STATUS_SENT && data.from != this.state.myUserId) {\n      clearTimeout(this.receivedTimer);\n      this.receivedTimer = setTimeout(() => {\n        this.receivedTimer = undefined;\n        topic.noteRecv(data.seq);\n      }, RECEIVED_DELAY);\n    }\n  }\n\n  /* Fnd topic: find contacts by tokens */\n  tnInitFind() {\n    const fnd = this.tinode.getFndTopic();\n    fnd.onSubsUpdated = this.tnFndSubsUpdated;\n    if (fnd.isSubscribed()) {\n      this.tnFndSubsUpdated();\n    } else {\n      fnd.subscribe(fnd.startMetaQuery().withSub().build()).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  tnFndSubsUpdated() {\n    const foundContacts = [];\n    // Don't attempt to create P2P topics which already exist. Server will reject the duplicates.\n    this.tinode.getFndTopic().contacts((s) => {\n      foundContacts.push(s);\n    });\n    this.setState({\n      searchResults: foundContacts,\n      searchableContacts: TinodeWeb.prepareSearchableContacts(this.state.chatList, foundContacts)\n    });\n  }\n\n  /** Called when the user enters a contact into the contact search field in the NewAccount panel\n    @param query {Array} is an array of contacts to search for\n   */\n  handleSearchContacts(query) {\n    const fnd = this.tinode.getFndTopic();\n    fnd.setMeta({desc: {public: query}}).then((ctrl) => {\n      return fnd.getMeta(fnd.startMetaQuery().withSub().build());\n    }).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  // User clicked on a topic in the side panel or deleted a topic.\n  handleTopicSelected(topicName) {\n    // Clear newTopicParams after use.\n    if (this.state.newTopicParams && this.state.newTopicParams._topicName != topicName) {\n      this.setState({\n        newTopicParams: null\n      });\n    }\n\n    if (topicName) {\n      this.setState({\n        errorText: '',\n        errorLevel: null,\n        mobilePanel: 'topic-view',\n        infoPanel: undefined\n      });\n      // Different topic selected.\n      if (this.state.topicSelected != topicName) {\n        this.setState({\n          topicSelectedOnline: this.tinode.isTopicOnline(topicName),\n          topicSelectedAcs: this.tinode.getTopicAccessMode(topicName),\n          forwardMessage: null\n        });\n        HashNavigation.navigateTo(HashNavigation.setUrlTopic('', topicName));\n      }\n    } else {\n      // Currently selected contact deleted\n      this.setState({\n        errorText: '',\n        errorLevel: null,\n        mobilePanel: 'sidepanel',\n        topicSelectedOnline: false,\n        topicSelectedAcs: null,\n        infoPanel: undefined,\n        forwardMessage: null\n      });\n\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic('', null));\n    }\n  }\n\n  // In mobile view user requested to show sidepanel\n  handleHideMessagesView() {\n    this.setState({\n      mobilePanel: 'sidepanel'\n    });\n    HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, null));\n  }\n\n  // User is sending a message, either plain text or a drafty object, possibly\n  // with attachments.\n  //  - msg - Drafty message with content\n  //  - promise - Promise to be resolved when the upload is completed\n  //  - uploadCompletionPromise - for tracking progress\n  //  - head - head dictionary to be attached to the message\n  handleSendMessage(msg, uploadCompletionPromise, uploader, head) {\n    const topic = this.tinode.getTopic(this.state.topicSelected);\n    /* TODO: check if return is required */\n    return this.sendMessageToTopic(topic, msg, uploadCompletionPromise, uploader, head);\n  }\n\n  sendMessageToTopic(topic, msg, uploadCompletionPromise, uploader, head) {\n    msg = topic.createMessage(msg, false);\n    // The uploader is used to show progress.\n    msg._uploader = uploader;\n\n    if (head) {\n      msg.head = Object.assign(msg.head || {}, head);\n    }\n\n    const completion = [];\n    if (uploadCompletionPromise) {\n      completion.push(uploadCompletionPromise);\n    }\n\n    if (!topic.isSubscribed()) {\n      // Topic is not subscribed yet. Subscribe.\n      const subscribePromise =\n        topic.subscribe()\n          .then(() => {\n            // If there are unsent messages, try sending them now.\n            topic.queuedMessages(pub => {\n              if (pub._sending || pub.seq == msg.seq) {\n                return;\n              }\n              if (topic.isSubscribed()) {\n                topic.publishMessage(pub);\n              }\n            });\n          });\n      completion.push(subscribePromise);\n    }\n\n    // TODO: check if return is required.\n    return topic.publishDraft(msg, Promise.all(completion))\n      .then(_ => {\n        if (topic.isArchived()) {\n          topic.archive(false);\n        }\n        return ctrl;\n      })\n      .catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n  }\n\n  handleNewChatInvitation(topicName, action) {\n    const topic = this.tinode.getTopic(topicName);\n    let response = null;\n    switch (action) {\n      case 'accept':\n        // Accept given permissions.\n        const mode = topic.getAccessMode().getGiven();\n        response = topic.setMeta({sub: {mode: mode}});\n        if (topic.isP2PType()) {\n          // For P2P topics change 'given' permission of the peer too.\n          // In p2p topics the other user has the same name as the topic.\n          response = response.then((ctrl) => {\n            topic.setMeta({sub: {user: topicName, mode: mode}});\n          });\n        }\n        break;\n      case 'delete':\n        // Ignore invitation by deleting it.\n        response = topic.delTopic(true);\n        break;\n      case 'block':\n        // Ban the topic making futher invites impossible.\n        // Just self-ban.\n        const am = topic.getAccessMode().updateWant('-JP').getWant();\n        response = topic.setMeta({sub: {mode: am}}).then((ctrl) => {\n          return this.handleTopicSelected(null);\n        });\n        break;\n      default:\n        console.warn(\"Unknown invitation action\", '\"' + action + '\"\"');\n    }\n\n    if (response != null) {\n      response.catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  // User chose a Sign Up menu item.\n  handleNewAccount() {\n    this.handleError();\n\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, 'register'));\n  }\n\n  // Actual registration of a new account.\n  handleNewAccountRequest(login_, password_, public_, cred_, tags_) {\n    // Clear old error, if any.\n    this.handleError();\n\n    this.tinode.connect(this.state.serverAddress)\n      .then(() => {\n        return this.tinode.createAccountBasic(login_, password_,\n          {public: public_, tags: tags_, cred: Tinode.credential(cred_)});\n      }).then((ctrl) => {\n        if (ctrl.code >= 300 && ctrl.text == 'validate credentials') {\n          this.handleCredentialsRequest(ctrl.params);\n        } else {\n          this.handleLoginSuccessful(this);\n        }\n      }).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n  }\n\n  handleToggleIncognitoMode(on) {\n    // Make state undefined.\n    this.setState({incognitoMode: null});\n\n    const me = this.tinode.getMeTopic();\n    const am = me.getAccessMode().updateWant(on ? '-P' : '+P').getWant();\n    me.setMeta({sub: {mode: am}}).catch((err) => {\n      // Request failed, keep existing state.\n      this.setState({incognitoMode: !on});\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleUpdateAccountTagsRequest(tags) {\n    this.tinode.getMeTopic().setMeta({tags: tags})\n      .catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n  }\n\n  // User chose Settings menu item.\n  handleSettings() {\n    this.handleError();\n\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash,\n      this.state.myUserId ? 'edit' : 'settings'));\n  }\n\n  // User updated global parameters.\n  handleGlobalSettings(settings) {\n    const serverAddress = settings.serverAddress || this.state.serverAddress;\n    const transport = settings.transport || this.state.transport;\n    if (this.tinode) {\n      this.tinode.clearStorage();\n      this.tinode.onDisconnect = undefined;\n      this.tinode.disconnect();\n    }\n    this.tinode = TinodeWeb.tnSetup(serverAddress, transport, this.props.intl.locale,\n      LocalStorageUtil.getObject('keep-logged-in'));\n    this.tinode.onConnect = this.handleConnected;\n    this.tinode.onDisconnect = this.handleDisconnect;\n    this.tinode.onAutoreconnectIteration = this.handleAutoreconnectIteration;\n\n    this.setState({\n      serverAddress: serverAddress,\n      transport: transport\n    });\n    LocalStorageUtil.setObject('settings', {\n      serverAddress: serverAddress,\n      transport: transport\n    });\n\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, ''));\n  }\n\n  // User chose 'Archived chats'.\n  handleShowArchive() {\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash,\n      this.state.myUserId ? 'archive' : ''));\n  }\n\n  // User viewes 'Blocked chats'.\n  handleShowBlocked() {\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash,\n      this.state.myUserId ? 'blocked' : ''));\n  }\n\n  toggleFCMToken(enabled) {\n    if (enabled) {\n      this.setState({desktopAlerts: null});\n      if (!this.state.firebaseToken) {\n        this.initFCMessaging();\n      } else {\n        this.setState({desktopAlerts: true});\n        if (LocalStorageUtil.getObject('keep-logged-in')) {\n          LocalStorageUtil.updateObject('settings', {desktopAlerts: true});\n        }\n      }\n    } else if (this.state.firebaseToken && this.fcm) {\n      firebaseDelToken(this.fcm).catch((err) => {\n        console.error(\"Unable to delete token.\", err);\n      }).finally(() => {\n        LocalStorageUtil.updateObject('settings', {desktopAlerts: false});\n        localStorage.removeItem('firebase-token');\n        this.setState({desktopAlerts: false, firebaseToken: null});\n        // Inform the server that the token was deleted.\n        this.tinode.setDeviceToken(null);\n      });\n    } else {\n      this.setState({desktopAlerts: false, firebaseToken: null});\n      LocalStorageUtil.updateObject('settings', {desktopAlerts: false});\n    }\n  }\n\n  handleToggleMessageSounds(enabled) {\n    this.setState({messageSounds: enabled});\n    LocalStorageUtil.updateObject('settings', {\n      messageSoundsOff: !enabled\n    });\n  }\n\n  handleCredAdd(method, value) {\n    const me = this.tinode.getMeTopic();\n    me.setMeta({cred: {meth: method, val: value}}).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleCredDelete(method, value) {\n    const me = this.tinode.getMeTopic();\n    me.delCredential(method, value).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleCredConfirm(method, response) {\n    this.handleCredentialsRequest({cred: [method]});\n  }\n\n  // User clicked Cancel button in Setting or Sign Up panel.\n  handleSidepanelCancel() {\n    const parsed = HashNavigation.parseUrlHash(window.location.hash);\n    let path = '';\n    if (['security','support','general','notif'].includes(parsed.path[0])) {\n      path = 'edit';\n    } else if ('crop' == parsed.path[0]) {\n      path = 'general';\n    } else if ('blocked' == parsed.path[0]) {\n      path = 'security';\n    } else if (this.state.myUserId) {\n      path = 'contacts';\n    }\n    parsed.path[0] = path;\n    if (parsed.params) {\n      delete parsed.params.code;\n      delete parsed.params.method;\n      delete parsed.params.tab;\n      delete parsed.params.scheme;\n      delete parsed.params.token;\n    }\n    HashNavigation.navigateTo(HashNavigation.composeUrlHash(parsed.path, parsed.params));\n    this.setState({errorText: '', errorLevel: null});\n  }\n\n  // Sidepanel navigator. No need to bind to 'this'.\n  basicNavigator(hash) {\n    HashNavigation.navigateTo(HashNavigation.setUrlSidePanel(window.location.hash, hash));\n  }\n\n  // Topic info navigator. No need to bind to 'this'.\n  infoNavigator(hash) {\n    HashNavigation.navigateTo(HashNavigation.setUrlInfoPanel(window.location.hash, hash));\n  }\n\n  // Request to start a topic, new or selected from search results, or \"by ID\".\n  handleStartTopicRequest(topicName, newTopicParams, isChannel) {\n    // Check if topic is indeed new. If not, launch it.\n    if (topicName && this.tinode.isTopicCached(topicName)) {\n      this.handleTopicSelected(topicName);\n      return;\n    }\n\n    const params = {};\n    if (Tinode.isP2PTopicName(topicName)) {\n      // Because we are initialing the subscription, set 'want' to all permissions.\n      params.sub = {mode: DEFAULT_P2P_ACCESS_MODE};\n      // Give the other user all permissions too.\n      params.desc = {defacs: {auth: DEFAULT_P2P_ACCESS_MODE}};\n    } else {\n      topicName = topicName || this.tinode.newGroupTopicName(isChannel);\n      if (newTopicParams) {\n        params.desc = {public: newTopicParams.public, private: {comment: newTopicParams.private}};\n        params.tags = newTopicParams.tags;\n      }\n    }\n    params._topicName = topicName;\n    this.setState({newTopicParams: params}, () => {this.handleTopicSelected(topicName)});\n  }\n\n  // New topic was created, here is the new topic name.\n  handleNewTopicCreated(oldName, newName) {\n    let nextState = {};\n    if (this.state.callShouldStart) {\n      nextState = {callState: CALL_STATE_IN_PROGRESS, callShouldStart: false};\n    }\n    if (this.state.topicSelected == oldName && oldName != newName) {\n      // If the current URl contains the old topic name, replace it with new.\n      // Update the name of the selected topic first so the navigator doen't clear\n      // the state.\n      const newTopic = {topicSelected: newName};\n      this.setState(...nextState, ...newTopic, () => {\n        HashNavigation.navigateTo(HashNavigation.setUrlTopic('', newName));\n      });\n    } else {\n      this.setState(nextState, () => {\n        HashNavigation.navigateTo(HashNavigation.setUrlTopic('', newName));\n      });\n    }\n  }\n\n  handleTopicUpdateRequest(topicName, pub, priv, defacs) {\n    this.handleError();\n\n    const topic = this.tinode.getTopic(topicName);\n    if (topic) {\n      const params = {};\n      let attachments;\n      if (pub) {\n        if (pub.photo) {\n          if (pub.photo.ref && pub.photo.ref != Tinode.DEL_CHAR) {\n            attachments = [pub.photo.ref];\n          } else if (!pub.photo.data || pub.photo.data == Tinode.DEL_CHAR) {\n            pub.photo = Tinode.DEL_CHAR;\n          }\n        }\n        params.public = pub;\n      }\n\n      if (typeof priv == 'string') {\n        params.private = (priv === Tinode.DEL_CHAR) ?\n          Tinode.DEL_CHAR : {comment: priv};\n      }\n      if (defacs) {\n        params.defacs = defacs;\n      }\n      topic.setMeta({desc: params, attachments: attachments}).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  handleUnarchive(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (topic) {\n      topic.archive(false);\n    }\n  }\n\n  handleUpdatePasswordRequest(password)  {\n    this.handleError();\n\n    if (password) {\n      this.tinode.updateAccountBasic(null, this.tinode.getCurrentLogin(), password).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  handleChangePermissions(topicName, mode, uid) {\n    const topic = this.tinode.getTopic(topicName);\n    if (topic) {\n      const am = topic.getAccessMode();\n      if (uid) {\n        am.updateGiven(mode);\n        mode = am.getGiven();\n      } else {\n        am.updateWant(mode);\n        mode = am.getWant();\n      }\n      topic.setMeta({sub: {user: uid, mode: mode}}).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  handleTagsUpdateRequest(topicName, tags) {\n    const topic = this.tinode.getTopic(topicName);\n    if (topic) {\n      topic.setMeta({tags: tags}).catch((err) => {\n        this.handleError(err.message, 'err');\n      });\n    }\n  }\n\n  handleLogout() {\n    updateFavicon(0);\n\n    // Remove stored data.\n    localStorage.removeItem('auth-token');\n    localStorage.removeItem('firebase-token');\n    localStorage.removeItem('settings');\n    if (this.state.firebaseToken) {\n      firebaseDelToken(this.fcm);\n    }\n\n    clearInterval(this.reconnectCountdown);\n\n    let cleared;\n    if (this.tinode) {\n      cleared = this.tinode.clearStorage();\n      this.tinode.onDisconnect = undefined;\n      this.tinode.disconnect();\n    } else {\n      cleared = Promose.resolve();\n    }\n    this.setState(this.getBlankState());\n\n    cleared.then(() => {\n      this.tinode = TinodeWeb.tnSetup(this.state.serverAddress,\n        this.state.transport, this.props.intl.locale, LocalStorageUtil.getObject('keep-logged-in'), () => {\n          this.tinode.onConnect = this.handleConnected;\n          this.tinode.onDisconnect = this.handleDisconnect;\n          this.tinode.onAutoreconnectIteration = this.handleAutoreconnectIteration;\n          HashNavigation.navigateTo('');\n        })\n    });\n  }\n\n  handleDeleteAccount() {\n    this.tinode.delCurrentUser(true).then(_ => {\n      this.handleLogout();\n    });\n  }\n\n  handleDeleteTopicRequest(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n\n    // Request to hard-delete topic.\n    topic.delTopic(true).then((ctrl) => {\n      // Hide MessagesView and InfoView panels.\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\n    }).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleDeleteMessagesRequest(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n\n    // Request hard-delete all messages.\n    topic.delMessagesAll(true).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleLeaveUnsubRequest(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n\n    topic.leave(true).then((ctrl) => {\n      // Hide MessagesView and InfoView panels.\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\n    }).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleBlockTopicRequest(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n\n    topic.updateMode(null, '-JP').then(_ => {\n      // Hide MessagesView and InfoView panels.\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\n    }).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleReportTopic(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n\n    // Publish spam report.\n    this.tinode.report('report', topicName);\n\n    // Remove J and P permissions.\n    topic.updateMode(null, '-JP').then((ctrl) => {\n      // Hide MessagesView and InfoView panels.\n      HashNavigation.navigateTo(HashNavigation.setUrlTopic(window.location.hash, ''));\n    }).catch((err) => {\n      this.handleError(err.message, 'err');\n    });\n  }\n\n  handleShowContextMenu(params, menuItems) {\n    this.setState({\n      contextMenuVisible: true,\n      contextMenuClickAt: {x: params.x, y: params.y},\n      contextMenuParams: params,\n      contextMenuItems: menuItems || this.defaultTopicContextMenu(params.topicName),\n      contextMenuBounds: this.selfRef.current.getBoundingClientRect()\n    });\n  }\n\n  //\n  handleShowForwardDialog(params) {\n    if (this.state.sidePanelSelected == 'newtpk') {\n      // If the Find panel is active, close it.\n      this.handleSidepanelCancel();\n    }\n    const header = '➦ ' + params.userName;\n    const content = typeof params.content == 'string' ? Drafty.init(params.content) : Drafty.forwardedContent(params.content);\n    const preview = Drafty.preview(content, FORWARDED_PREVIEW_LENGTH, true);\n    const msg = Drafty.append(Drafty.appendLineBreak(Drafty.mention(header, params.userFrom)), content);\n    const msgPreview = Drafty.quote(header, params.userFrom, preview);\n\n    const head = {\n      forwarded: params.topicName + ':' + params.seq\n    };\n    this.setState({\n      forwardDialogVisible: true,\n      forwardMessage: { head: head, msg: msg, preview: msgPreview }\n    });\n  }\n\n  defaultTopicContextMenu(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n\n    let muted = false, blocked = false, self_blocked = false, subscribed = false, deleter = false, archived = false;\n    if (topic) {\n      subscribed = topic.isSubscribed();\n      archived = topic.isArchived();\n\n      const acs = topic.getAccessMode();\n      if (acs) {\n        muted = acs.isMuted();\n        blocked = !acs.isJoiner();\n        self_blocked = !acs.isJoiner('want');\n        deleter = acs.isDeleter();\n      }\n    }\n\n    return [\n      subscribed ? {\n        title: this.props.intl.formatMessage(messages.menu_item_info),\n        handler: this.handleShowInfoView\n      } : null,\n      subscribed && Tinode.isP2PTopicName(topicName) ? {\n        title: this.props.intl.formatMessage(messages.menu_item_video_call),\n        handler: this.handleStartVideoCall\n      } : null,\n      subscribed ? 'messages_clear' : null,\n      subscribed && deleter ? 'messages_clear_hard' : null,\n      muted ? (blocked ? null : 'topic_unmute') : 'topic_mute',\n      self_blocked ? 'topic_unblock' : 'topic_block',\n      archived ? 'topic_restore' : 'topic_archive',\n      'topic_delete'\n    ];\n  }\n\n  handleHideContextMenu() {\n    this.setState({\n      contextMenuVisible: false,\n      contextMenuClickAt: null,\n      contextMenuParams: null,\n      contextMenuBounds: null\n    });\n  }\n\n  handleHideForwardDialog(keepForwardedMessage) {\n    this.setState({\n      forwardDialogVisible: false,\n      forwardMessage: keepForwardedMessage ? this.state.forwardMessage : null\n    });\n  }\n\n  handleContextMenuAction(action, promise, params) {\n    if (action == 'topic_archive') {\n      if (promise && params.topicName && params.topicName == this.state.topicSelected) {\n        promise.then(() => {\n          this.handleTopicSelected(null);\n        });\n      }\n    } else if (action == 'menu_item_forward') {\n      this.handleShowForwardDialog(params);\n    }\n  }\n\n  handleShowAlert(title, content, onConfirm, confirmText, onReject, rejectText) {\n    this.setState({\n      alertVisible: true,\n      alertParams: {\n        title: title,\n        content: content,\n        onConfirm: onConfirm,\n        confirm: confirmText,\n        onReject: onReject,\n        reject: rejectText\n      }\n    });\n  }\n\n  handleShowInfoView() {\n    HashNavigation.navigateTo(HashNavigation.addUrlParam(window.location.hash, 'info', 'info'));\n    this.setState({infoPanel: 'info'});\n  }\n\n  handleMemberUpdateRequest(topicName, added, removed) {\n    if (!topicName) {\n      return;\n    }\n\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n\n    if (added && added.length > 0) {\n      added.map((uid) => {\n        topic.invite(uid, null).catch((err) => {\n          this.handleError(err.message, 'err');\n        });\n      });\n    }\n\n    if (removed && removed.length > 0) {\n      removed.map((uid) => {\n        topic.delSubscription(uid).catch((err) => {\n          this.handleError(err.message, 'err');\n        });\n      });\n    }\n  }\n\n  handleValidateCredentialsRequest(cred, code) {\n    if (this.tinode.isAuthenticated()) {\n      const me = this.tinode.getMeTopic();\n      me.setMeta({cred: {meth: cred, resp: code}})\n        .then(() => {\n          HashNavigation.navigateTo('');\n        })\n        .catch((err) => {\n          this.handleError(err.message, 'err');\n        });\n    } else {\n      this.setState({credMethod: cred, credCode: code});\n      this.doLogin(null, null, {meth: cred, resp: code});\n    }\n  }\n\n  handlePasswordResetRequest(method, value) {\n    // If already connected, connnect() will return a resolved promise.\n    return this.tinode.connect()\n      .then(() => {\n        return this.tinode.requestResetAuthSecret('basic', method, value);\n      })\n      .catch((err) => {\n        // Socket error\n        this.handleError(err.message, 'err');\n      });\n  }\n\n  handleResetPassword(scheme, newPassword, token) {\n    token = base64ReEncode(token);\n    if (!token) {\n      this.handleError(this.props.intl.formatMessage(messages.invalid_security_token), 'err');\n    } else {\n      this.tinode.connect()\n        .then(() => {\n          return this.tinode.updateAccountBasic(null, null, newPassword, {token: token});\n        })\n        .then(() => {\n          HashNavigation.navigateTo('');\n        })\n        .catch((err) => {\n          // Socket error\n          this.handleError(err.message, 'err');\n        });\n    }\n  }\n\n  handleStartVideoCall() {\n    this.setState({\n      callTopic: this.state.topicSelected,\n      callState: CALL_STATE_OUTGOING_INITATED\n    });\n  }\n\n  handleCallInvite(callTopic, callSeq, callState) {\n    switch (callState) {\n      case CALL_STATE_OUTGOING_INITATED:\n        let head = {mime: 'application/tinode-video-call'};\n        this.handleSendMessage('started', undefined, undefined, head)\n          .then((ctrl) => {\n            if (ctrl.code < 200 || ctrl.code >= 300 ||\n                typeof ctrl.params == 'undefined' || typeof ctrl.params['seq'] == 'undefined') {\n              this.handleCallClose();\n              return;\n            }\n            this.setState({callSeq: ctrl.params['seq']});\n          });\n        break;\n      case CALL_STATE_IN_PROGRESS:\n        const topic = this.tinode.getTopic(callTopic);\n        if (!topic) {\n          return;\n        }\n        // We've accepted the call. Let the other side know.\n        topic.call('accept', callSeq).catch((err) => {\n          this.handleCallClose();\n          this.handleError(err.message, 'err');\n        });\n        break;\n    }\n  }\n\n  handleCallRinging(callTopic, callSeq) {\n    const topic = this.tinode.getTopic(callTopic);\n    if (!topic) {\n      return;\n    }\n\n    topic.call('ringing', callSeq);\n  }\n\n  handleCallHangup(callTopic, callSeq) {\n    const topic = this.tinode.getTopic(callTopic);\n    if (!topic) {\n      return;\n    }\n\n    topic.call('hang-up', callSeq);\n  }\n\n  handleCallSendOffer(callTopic, callSeq, sdp) {\n    const topic = this.tinode.getTopic(callTopic);\n    if (!topic) {\n      return;\n    }\n\n    topic.call('offer', callSeq, sdp);\n  }\n\n  handleCallIceCandidate(callTopic, callSeq, candidate) {\n    const topic = this.tinode.getTopic(callTopic);\n    if (!topic) {\n      return;\n    }\n\n    topic.call('ice-candidate', callSeq, candidate);\n  }\n  handleCallSendAnswer(callTopic, callSeq, sdp) {\n    const topic = this.tinode.getTopic(callTopic);\n    if (!topic) {\n      return;\n    }\n\n    topic.call('answer', callSeq, sdp);\n  }\n\n  handleCallClose() {\n    if (this.state.callTimeout) {\n      console.log('closing call timeout ', this.state.callTimeout);\n      clearTimeout(this.state.callTimeout);\n    }\n    this.setState({\n      callTopic: undefined,\n      callState: CALL_STATE_NONE\n    });\n  }\n\n  handleCallAcceptCall(topicName) {\n    const topic = this.tinode.getTopic(topicName);\n    if (!topic) {\n      return;\n    }\n    if (topic.isSubscribed()) {\n      this.handleTopicSelected(this.state.callTopic);\n      this.setState({\n        callState: CALL_STATE_IN_PROGRESS\n      });\n    } else {\n      // We need to switch and subscribe to callTopic first.\n      this.setState({\n        callShouldStart: true,\n      }, () => this.handleTopicSelected(this.state.callTopic));\n    }\n  }\n\n  handleInfoMessage(info) {\n    if (info.what != 'call') {\n      return;\n    }\n    switch (info.event) {\n      case 'invite':\n        console.log('invite: ', info);\n        if (info.from != this.state.myUserId) {\n          // Incoming call.\n          this.setState({\n            callTopic: info.src,\n            callState: CALL_STATE_INCOMING_RECEIVED,\n            callSeq: info.seq\n          });\n        }\n        break;\n      case 'accept':\n        console.log('TinodeWeb: received accept msg ', info);\n        // If another my session has accepted the call.\n        if (info.topic == 'me' && info.from == this.state.myUserId) {\n          this.setState({\n            callTopic: null,\n            callState: CALL_STATE_NONE,\n            callSeq: null\n          });\n          return;\n        }\n        if (info.topic == this.state.callTopic) {\n          // Update state.\n          this.setState({callState: CALL_STATE_IN_PROGRESS});\n        }\n        break;\n      case 'hang-up':\n        // Remote hangup.\n        this.handleCallClose();\n        break;\n    }\n  }\n\n  render() {\n    return (\n      <div id=\"app-container\" ref={this.selfRef}>\n        {this.state.contextMenuVisible ?\n          <ContextMenu\n            tinode={this.tinode}\n            bounds={this.state.contextMenuBounds}\n            clickAt={this.state.contextMenuClickAt}\n            params={this.state.contextMenuParams}\n            items={this.state.contextMenuItems}\n            hide={this.handleHideContextMenu}\n            onShowAlert={this.handleShowAlert}\n            onAction={this.handleContextMenuAction}\n            onTopicRemoved={(topicName) => {\n              if (topicName == this.state.topicSelected) {\n                this.handleTopicSelected(null);\n              }\n            }}\n            onError={this.handleError} />\n          :\n          null\n        }\n        {this.state.forwardDialogVisible ?\n          <ForwardDialog\n            tinode={this.tinode}\n            contacts={this.state.chatList}\n            topicSelected={this.state.topicSelected}\n            myUserId={this.state.myUserId}\n\n            hide={this.handleHideForwardDialog}\n            onInitFind={this.tnInitFind}\n            searchResults={this.state.searchResults}\n            onSearchContacts={this.handleSearchContacts}\n            onTopicSelected={this.handleStartTopicRequest}\n          />\n          :\n          null\n        }\n        <Alert\n          visible={this.state.alertVisible}\n          title={this.state.alertParams.title}\n          content={this.state.alertParams.content}\n          onReject={this.state.alertParams.onReject ? (() => { this.setState({alertVisible: false}); }) : null}\n          reject={this.state.alertParams.reject}\n          onConfirm={() => { this.setState({alertVisible: false}); this.state.alertParams.onConfirm(); }}\n          confirm={this.state.alertParams.confirm}\n          />\n        <SidepanelView\n          tinode={this.tinode}\n          connected={this.state.connected}\n          displayMobile={this.state.displayMobile}\n          hideSelf={this.state.displayMobile && this.state.mobilePanel !== 'sidepanel'}\n          state={this.state.sidePanelSelected}\n          title={this.state.sidePanelTitle}\n          avatar={this.state.sidePanelAvatar}\n          trustedBadges={this.state.myTrustedBadges}\n          login={this.state.login}\n          persist={this.state.persist}\n          myUserId={this.state.myUserId}\n          loginDisabled={this.state.loginDisabled}\n          loadSpinnerVisible={this.state.loadSpinnerVisible}\n\n          errorText={this.state.errorText}\n          errorLevel={this.state.errorLevel}\n          errorAction={this.state.errorAction}\n          errorActionText={this.state.errorActionText}\n\n          topicSelected={this.state.topicSelected}\n          chatList={this.state.chatList}\n          credMethod={this.state.credMethod}\n          credCode={this.state.credCode}\n\n          transport={this.state.transport}\n          messageSounds={this.state.messageSounds}\n          desktopAlerts={this.state.desktopAlerts}\n          desktopAlertsEnabled={this.state.desktopAlertsEnabled}\n          incognitoMode={this.state.incognitoMode}\n          serverAddress={this.state.serverAddress}\n          serverVersion={this.state.serverVersion}\n\n          onGlobalSettings={this.handleGlobalSettings}\n          onSignUp={this.handleNewAccount}\n          onSettings={this.handleSettings}\n          onNavigate={this.basicNavigator}\n          onLoginRequest={this.handleLoginRequest}\n          onPersistenceChange={this.handlePersistenceChange}\n          onCreateAccount={this.handleNewAccountRequest}\n          onUpdateAccountDesc={this.handleTopicUpdateRequest}\n          onUpdatePassword={this.handleUpdatePasswordRequest}\n          onUpdateAccountTags={this.handleUpdateAccountTagsRequest}\n          onTogglePushNotifications={this.toggleFCMToken}\n          onToggleMessageSounds={this.handleToggleMessageSounds}\n          onToggleIncognitoMode={this.handleToggleIncognitoMode}\n          onCredAdd={this.handleCredAdd}\n          onCredDelete={this.handleCredDelete}\n          onCredConfirm={this.handleCredConfirm}\n          onTopicSelected={this.handleTopicSelected}\n          onCreateTopic={this.handleStartTopicRequest}\n          onLogout={this.handleLogout}\n          onDeleteAccount={this.handleDeleteAccount}\n          onShowAlert={this.handleShowAlert}\n          onCancel={this.handleSidepanelCancel}\n          onError={this.handleError}\n          onValidateCredentials={this.handleValidateCredentialsRequest}\n          onPasswordResetRequest={this.handlePasswordResetRequest}\n          onResetPassword={this.handleResetPassword}\n          onShowArchive={this.handleShowArchive}\n          onShowBlocked={this.handleShowBlocked}\n\n          onInitFind={this.tnInitFind}\n          searchResults={this.state.searchResults}\n          onSearchContacts={this.handleSearchContacts}\n\n          showContextMenu={this.handleShowContextMenu} />\n\n        <MessagesView\n          tinode={this.tinode}\n          connected={this.state.connected}\n          ready={this.state.ready}\n          online={this.state.topicSelectedOnline}\n          acs={this.state.topicSelectedAcs}\n          displayMobile={this.state.displayMobile}\n          viewportWidth={this.state.viewportWidth}\n          viewportHeight={this.state.viewportHeight}\n          hideSelf={this.state.displayMobile &&\n            (this.state.mobilePanel !== 'topic-view' || this.state.infoPanel)}\n          topic={this.state.topicSelected}\n          myUserId={this.state.myUserId}\n          // User public.fn.\n          myUserName={this.state.sidePanelTitle}\n          serverVersion={this.state.serverVersion}\n          serverAddress={this.state.serverAddress}\n          applicationVisible={this.state.applicationVisible}\n\n          forwardMessage={this.state.forwardMessage}\n          onCancelForwardMessage={this.handleHideForwardDialog}\n\n          callTopic={this.state.callTopic}\n          callSeq={this.state.callSeq}\n          callState={this.state.callState}\n          onCallHangup={this.handleCallHangup}\n\n          onCallInvite={this.handleCallInvite}\n          onCallSendOffer={this.handleCallSendOffer}\n          onCallIceCandidate={this.handleCallIceCandidate}\n          onCallSendAnswer={this.handleCallSendAnswer}\n\n          errorText={this.state.errorText}\n          errorLevel={this.state.errorLevel}\n          errorAction={this.state.errorAction}\n          errorActionText={this.state.errorActionText}\n\n          newTopicParams={this.state.newTopicParams}\n\n          onHideMessagesView={this.handleHideMessagesView}\n          onData={this.tnData}\n          onError={this.handleError}\n          onNewTopicCreated={this.handleNewTopicCreated}\n          showContextMenu={this.handleShowContextMenu}\n          onChangePermissions={this.handleChangePermissions}\n          onNewChat={this.handleNewChatInvitation}\n          sendMessage={this.handleSendMessage}\n          onVideoCallClosed={this.handleCallClose} />\n\n        {this.state.infoPanel ?\n          <InfoView\n            tinode={this.tinode}\n            connected={this.state.connected}\n            displayMobile={this.state.displayMobile}\n            topic={this.state.topicSelected}\n            searchableContacts={this.state.searchableContacts}\n            myUserId={this.state.myUserId}\n            panel={this.state.infoPanel}\n\n            errorText={this.state.errorText}\n            errorLevel={this.state.errorLevel}\n            errorAction={this.state.errorAction}\n            errorActionText={this.state.errorActionText}\n\n            onNavigate={this.infoNavigator}\n            onTopicDescUpdateRequest={this.handleTopicUpdateRequest}\n            onShowAlert={this.handleShowAlert}\n            onChangePermissions={this.handleChangePermissions}\n            onMemberUpdateRequest={this.handleMemberUpdateRequest}\n            onDeleteTopic={this.handleDeleteTopicRequest}\n            onDeleteMessages={this.handleDeleteMessagesRequest}\n            onLeaveTopic={this.handleLeaveUnsubRequest}\n            onBlockTopic={this.handleBlockTopicRequest}\n            onReportTopic={this.handleReportTopic}\n            onAddMember={this.handleManageGroupMembers}\n            onTopicTagsUpdateRequest={this.handleTagsUpdateRequest}\n            onTopicUnArchive={this.handleUnarchive}\n            onInitFind={this.tnInitFind}\n            onError={this.handleError}\n\n            showContextMenu={this.handleShowContextMenu}\n            />\n          :\n          null\n        }\n\n        {this.state.callTopic && this.state.callState == CALL_STATE_INCOMING_RECEIVED ?\n          <IncomingCallView\n            tinode={this.tinode}\n            onClose={this.handleCallClose}\n            topic={this.state.callTopic}\n            seq={this.state.callSeq}\n            callState={this.state.callState}\n            onRinging={this.handleCallRinging}\n            onAcceptCall={this.handleCallAcceptCall}\n            onReject={this.handleCallHangup}\n            />\n          :\n          null\n        }\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(TinodeWeb);\n","// Put all packages together.\n// Used to generate umd/index.prod.js\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport { IntlProvider } from 'react-intl';\n\nimport allMessages from './messages.json';\nimport TinodeWeb from './views/tinode-web.jsx';\nimport HashNavigation from './lib/navigation.js';\n\n// Detect human language to use in the UI:\n//  Check parameters from URL hash #?hl=ru, then browser, then use 'en' as a fallback.\nconst { params } = HashNavigation.parseUrlHash(window.location.hash);\nconst language = (params && params.hl) ||\n  (navigator.languages && navigator.languages[0]) ||\n  navigator.language ||\n  navigator.userLanguage ||\n  'en';\n\n// Get the base language 'en' from a more specific 'en_GB' or 'en-US' as a partial fallback.\nconst baseLanguage = language.toLowerCase().split(/[-_]/)[0];\n\n// Try the full locale first, then the locale without the region code, fallback to 'en'.\nconst htmlLang = allMessages[language] ? language : allMessages[baseLanguage] ? baseLanguage : 'en';\nconst messages = allMessages[htmlLang];\n\n// Set lang attribute of the HTML element: <html lang=\"XX\">\ndocument.getElementsByTagName('html')[0].setAttribute('lang', htmlLang);\n\nReactDOM.render(\n  <React.StrictMode>\n    <IntlProvider locale={language} messages={messages} textComponent={React.Fragment}>\n      <TinodeWeb />\n    </IntlProvider>\n  </React.StrictMode>,\n  document.getElementById('mountPoint')\n);\n"],"names":["sections","name","type","doInherit","newClass","baseClass","prototype","Object","create","constructor","WebmBase","this","WebmUint","call","padHex","hex","length","WebmFloat","WebmContainer","WebmFile","source","setSource","fixWebmDuration","blob","duration","callback","options","undefined","Promise","resolve","reader","FileReader","onloadend","file","Uint8Array","result","fixDuration","toBlob","ex","readAsArrayBuffer","updateBySource","updateByData","setData","data","i","toString","substr","parseInt","getValue","setValue","value","getFloatArrayType","Float32Array","Float64Array","byteArray","reverse","floatArray","buffer","readByte","offset","readUint","firstByte","bytes","end","id","len","Math","min","slice","info","ctr","section","push","idHex","writeUint","x","draft","flag","c","writeSections","content","contentLength","set","getSectionById","logger","message","console","log","segmentSection","infoSection","timeScaleSection","durationSection","mimeType","Blob","default","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","defineProperty","enumerable","get","g","globalThis","Function","e","window","obj","prop","hasOwnProperty","React","ReactDOM","ReactIntl","stringToByteArray$1","str","out","p","charCodeAt","base64","byteToCharMap_","charToByteMap_","byteToCharMapWebSafe_","charToByteMapWebSafe_","ENCODED_VALS_BASE","ENCODED_VALS","ENCODED_VALS_WEBSAFE","HAS_NATIVE_SUPPORT","atob","encodeByteArray","input","webSafe","Array","isArray","Error","init_","byteToCharMap","output","byte1","haveByte2","byte2","haveByte3","byte3","outByte1","outByte2","outByte3","outByte4","join","encodeString","btoa","decodeString","pos","c1","String","fromCharCode","c2","u","c3","byteArrayToString","decodeStringToByteArray","charToByteMap","charAt","byte4","base64urlEncodeWithoutPadding","utf8Bytes","base64Encode","replace","Deferred","reject","promise","wrapCallback","error","catch","isIndexedDBAvailable","indexedDB","validateIndexedDBOpenable","preExist","DB_CHECK_NAME","request","self","open","onsuccess","close","deleteDatabase","onupgradeneeded","onerror","_a","FirebaseError","code","customData","super","setPrototypeOf","captureStackTrace","ErrorFactory","service","serviceName","errors","fullCode","template","PATTERN","_","replaceTemplate","fullMessage","deepEqual","b","aKeys","keys","bKeys","k","includes","aProp","bProp","isObject","thing","getModularInstance","_delegate","promisifyRequest","errorMessage","event","target","DBWrapper","_db","objectStoreNames","transaction","storeNames","mode","TransactionWrapper","createObjectStore","storeName","ObjectStoreWrapper","_transaction","complete","oncomplete","onabort","objectStore","_store","index","IndexWrapper","createIndex","keypath","put","delete","clear","_index","openDB","dbName","dbVersion","upgradeCallback","oldVersion","newVersion","async","deleteDB","Component","instanceFactory","multipleInstances","serviceProps","instantiationMode","onInstanceCreated","setInstantiationMode","setMultipleInstances","setServiceProps","props","setInstanceCreatedCallback","DEFAULT_ENTRY_NAME","Provider","container","component","instances","Map","instancesDeferred","instancesOptions","onInitCallbacks","identifier","normalizedIdentifier","normalizeInstanceIdentifier","has","deferred","isInitialized","shouldAutoInitialize","instance","getOrInitializeService","instanceIdentifier","getImmediate","optional","getComponent","setComponent","isComponentEager","instanceDeferred","entries","clearInstance","services","from","values","all","filter","map","INTERNAL","_delete","isComponentSet","getOptions","initialize","opts","onInit","existingCallbacks","Set","add","existingInstance","invokeOnInitCallbacks","callbacks","ComponentContainer","providers","addComponent","provider","getProvider","addOrOverwriteComponent","getProviders","LogLevel","levelStringToEnum","DEBUG","VERBOSE","INFO","WARN","ERROR","SILENT","defaultLogLevel","ConsoleMethod","defaultLogHandler","logType","args","logLevel","now","Date","toISOString","method","PlatformLoggerServiceImpl","getPlatformInfoString","isVersionServiceProvider","library","version","logString","name$o","version$1","_logLevel","_logHandler","_userLogHandler","val","TypeError","setLogLevel","logHandler","userLogHandler","debug","warn","PLATFORM_LOG_STRING","_apps","_components","_addComponent","app","_registerComponent","componentName","heartbeatController","triggerHeartbeat","ERROR_FACTORY","FirebaseAppImpl","config","_isDeleted","_options","assign","_config","_name","_automaticDataCollectionEnabled","automaticDataCollectionEnabled","_container","checkDestroyed","isDeleted","appName","initializeApp","rawConfig","existingApp","newApp","registerVersion","libraryKeyOrName","variant","libraryMismatch","match","versionMismatch","warning","STORE_NAME","dbPromise","getDbPromise","db","originalErrorMessage","writeHeartbeatsToIndexedDB","heartbeatObject","tx","computeKey","appId","HeartbeatServiceImpl","_heartbeatsCache","_storage","HeartbeatStorageImpl","_heartbeatsCachePromise","read","then","agent","date","getUTCDateString","lastSentHeartbeatDate","heartbeats","some","singleDateHeartbeat","hbTimestamp","valueOf","overwrite","heartbeatsToSend","unsentEntries","heartbeatsCache","maxSize","heartbeatEntry","find","hb","dates","countBytes","pop","extractHeartbeatsForHeader","headerString","JSON","stringify","substring","_canUseIndexedDBPromise","runIndexedDBEnvironmentCheck","readHeartbeatsFromIndexedDB","heartbeatsObject","existingHeartbeatsObject","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","TOKEN_EXPIRATION_BUFFER","isServerError","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","responseExpiresIn","Number","creationTime","getErrorFromResponse","requestName","errorData","json","serverCode","serverMessage","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","sleep","ms","setTimeout","VALID_FID_PATTERN","generateFid","fidByteArray","crypto","msCrypto","getRandomValues","fid","array","encode","test","getKey","fidChangeCallbacks","fidChanged","callFidChangeCallbacks","channel","getBroadcastChannel","postMessage","closeBroadcastChannel","broadcastFidChange","broadcastChannel","BroadcastChannel","onmessage","size","OBJECT_STORE_NAME","oldValue","remove","update","updateFn","store","newValue","getInstallationEntry","installations","registrationPromise","installationEntry","oldEntry","clearTimedOutRequest","registrationStatus","updateOrCreateInstallationEntry","entryWithPromise","navigator","onLine","inProgressEntry","registrationTime","registeredInstallationEntry","heartbeatServiceProvider","endpoint","heartbeatService","heartbeatsHeader","getHeartbeatsHeader","body","authVersion","sdkVersion","fetch","ok","responseValue","authToken","createInstallationRequest","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","entry","updateInstallationRequest","generateAuthTokenRequest","getGenerateAuthTokenEndpoint","installation","refreshAuthToken","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","getToken","installationsImpl","completeInstallationRegistration","getMissingValueError","valueName","INSTALLATIONS_NAME","internalFactory","getId","configKeys","keyName","extractAppConfig","DEFAULT_VAPID_KEY","CONSOLE_CAMPAIGN_ID","MessageType$1","MessageType","arrayToBase64","uint8Array","base64ToArray","base64String","repeat","rawData","outputArray","OLD_DB_NAME","OLD_OBJECT_STORE_NAME","upgradeDb","dbGet","firebaseDependencies","tokenDetails","oldTokenDetails","senderId","dbNames","databases","upgradeTransaction","contains","oldDetails","auth","p256dh","fcmToken","createTime","subscriptionOptions","swScope","vapidKey","checkTokenDetails","migrateOldDatabase","dbSet","requestDeleteToken","unsubscribeOptions","getEndpoint","responseData","errorInfo","err","getBody","web","applicationPubKey","getTokenInternal","messaging","pushSubscription","swRegistration","subscription","pushManager","getSubscription","subscribe","userVisibleOnly","applicationServerKey","getPushSubscription","scope","dbOptions","currentOptions","isVapidKeyEqual","isEndpointEqual","isAuthEqual","isP256dhEqual","isTokenValid","updatedToken","updateOptions","requestUpdateToken","updatedTokenDetails","deleteTokenInternal","updateToken","getNewToken","dbRemove","unsubscribe","subscribeOptions","requestGetToken","externalizePayload","internalPayload","payload","collapseKey","collapse_key","messageId","fcmMessageId","messagePayloadInternal","notification","title","image","propagateNotificationPayload","propagateDataPayload","fcmOptions","link","analyticsLabel","analytics_label","propagateFcmOptions","_mergeStrings","s1","s2","resultArray","MessagingService","analyticsProvider","deliveryMetricsExportedToBigQueryEnabled","onBackgroundMessageHandler","onMessageHandler","logEvents","isLogServiceStarted","messagingSenderId","registerDefaultSw","serviceWorker","register","browserErrorMessage","getToken$1","Notification","permission","requestPermission","updateVapidKey","ServiceWorkerRegistration","updateSwReg","serviceWorkerRegistration","logToScion","messageType","eventType","NOTIFICATION_CLICKED","PUSH_RECEIVED","getEventType","logEvent","message_id","message_name","message_time","message_device_time","floor","messageEventListener","isFirebaseMessaging","next","dataPayload","WindowMessagingInternalFactory","isWindowSupported","cookieEnabled","PushSubscription","getMessagingInWindow","isSupported","deleteToken","deleteToken$1","onMessage","nextOrObserver","onMessage$1","addEventListener","Tinode","Alert","render","visible","className","onReject","onClick","FormattedMessage","defaultMessage","onConfirm","confirm","APP_NAME","KNOWN_HOSTS","hosted","local","DEFAULT_HOST","KEYPRESS_DELAY","DEFAULT_P2P_ACCESS_MODE","REM_SIZE","AVATAR_SIZE","MAX_INBAND_ATTACHMENT_SIZE","MAX_EXTERN_ATTACHMENT_SIZE","IMAGE_THUMBNAIL_DIM","MAX_TITLE_LENGTH","MAX_TOPIC_DESCRIPTION_LENGTH","CALL_WEBRTC_CONFIG","iceServers","urls","username","credential","messages","defineMessages","clear_messages","clear_for_all","delete_for_all","send_retry","mute","unmute","reply","forward","topic_delete","topic_delete_warning","delete_messages_warning","unblock","block","topic_block_warning","member_delete","archive","unarchive","edit_permissions","clear_messages_warning","ContextMenu","selfRef","formatMessage","intl","handlePageClick","bind","handleEscapeKey","handleClick","MenuItems","handler","params","errorHandler","onShowAlert","deleteMessages","retryMessage","replyToMessage","topicPermissionSetter","ctrl","onTopicRemoved","topicName","topic","tinode","getTopic","delTopic","user","delSubscription","componentDidMount","document","componentWillUnmount","removeEventListener","current","preventDefault","stopPropagation","hide","keyCode","item","items","currentTarget","dataset","onAction","onError","hard","cancelSend","seq","delMessagesAll","delMessagesList","flushMessage","msg","createMessage","publishDraft","updateMode","pickReply","userFrom","userName","menu","count","vSize","position","left","bounds","right","clickAt","top","bottom","y","style","ref","injectIntl","icon_mapping","ContactBadges","badges","color","icon","secondsToTime","seconds","fixedMin","sec","bytesToHumanSize","sizes","bucket","log2","pow","round","toFixed","shortenFileName","filename","maxLength","idToColorClass","light","fg","userId","abs","hash","stringToColorHash","updateFavicon","oldIcon","getElementById","head","getElementsByTagName","newIcon","createElement","rel","href","removeChild","appendChild","theCard","imageUrl","imageMimeType","note","card","trim","matches","exec","photo","indexOf","arrayEqual","sort","l","sanitizeUrl","url","allowedSchemes","schemes","RegExp","sanitizeUrlForMime","mimeMajor","sanitizedUrl","deliveryMarker","received","cancelablePromise","hasCanceled","isCanceled","cancel","isVideoCall","mime","clipStr","LetterTile","avatar","isGroup","iconColor","letter","deleted","authorizeURL","alt","src","UnreadBadge","SUPPORTED_IMAGE_FORMATS","MIME_EXTENSIONS","makeImageUrl","startsWith","fitImageSize","width","height","maxWidth","maxHeight","forceSquare","scale","dstWidth","dstHeight","srcWidth","srcHeight","xoffset","yoffset","fileNameForMime","fname","idx","ext","at","lastIndexOf","imageScaled","fileOrBlob","img","Image","crossOrigin","onload","URL","revokeObjectURL","dim","canvas","ctx","getContext","imageSmoothingEnabled","drawImage","clearRect","createObjectURL","blobToBase64","bits","split","readAsDataURL","intArrayToBase64","arr","bin","forEach","base64ToIntArray","b64","BAR_COLOR_DARK","AudioPlayer","preview","state","canPlay","playing","currentTime","longMin","initAudio","initCanvas","resampleBars","visualize","handlePlay","handleSeek","handleError","audioPlayer","viewBuffer","canvasRef","oncanplay","ontimeupdate","onended","pause","componentDidUpdate","prevProps","setState","Audio","offsetWidth","offsetHeight","canvasContext","lineCap","effectiveWidth","lineWidth","drawFrame","requestAnimationFrame","thumbAt","max","LINE_WIDTH","beginPath","strokeStyle","stroke","moveTo","lineTo","arc","PI","fillStyle","fill","original","barCount","factor","amps","lo","hi","amp","j","play","rect","getBoundingClientRect","clientX","playClass","short","LazyImage","padding","whenDone","FileProgress","progress","onCancel","UploadingImage","onCancelUpload","drafty_form","drafty_attachment","drafty_image","drafty_unknown","handleImageData","el","attr","viewportWidth","minWidth","minHeight","Drafty","onImagePreview","loading","fullFormatter","stack","quoteFormatter","onFormButtonClick","inner","child","onQuoteClick","concat","previewFormatter","inlineImageAttr","quoteImage","buf","ArrayBuffer","base64ToBlob","evt","statusText","scaled","replyFormatter","loadedPromise","Contact","handleContextClick","onSelected","showContextMenu","pageY","pageX","online","icon_badges","isVerified","isStaff","isDangerous","acs","showMode","getMode","isMuted","isJoiner","previewIsVideoCall","previewIsResponse","marker","titleClass","showCheckmark","selected","showOnline","isChannel","unread","small","comment","ContactAction","action","badge_you","badge_owner","ContactList","topicSelected","contactNodes","contactsCount","contacts","filterFunc","filterOn","private","toLowerCase","public","myUserId","isOwner","forwarded","deliveryStatus","latestMessage","_status","msgStatus","showUnread","connected","onTopicSelected","trusted","verified","staff","danger","_deleted","noScroll","dangerouslySetInnerHTML","__html","emptyListMessage","SearchContacts","edited","search","handleSearchChange","handleSearch","handleClear","handleKeyDown","onSearchContacts","query","placeholder","onChange","onKeyDown","required","autoFocus","ForwardDialog","handleClose","handleSearchContacts","handleContactSelected","onInitFind","uid","searchResults","isWriter","desription","search_placeholder","not_found_placeholder","LoadSpinner","large","centered","show","AvatarUpload","handleFileReceived","files","onImageUpdated","randId","random","readOnly","accept","htmlFor","uploading","badge_verified","badge_staff","badge_danger","BadgeList","trustedBadges","CheckBox","handleChange","checked","MenuCancel","ErrorPanel","level","onClearError","text","whiteSpace","actionText","Chip","handleCancel","invalid","noAvatar","ChipInput","deriveStateFromProps","focused","handleTextInput","removeChipAt","handleChipCancel","handleFocusGained","handleFocusLost","chips","prompt","sortedChips","sortChips","staticMembers","chipIndex","indexChips","prevState","keep","normal","removed","onChipRemoved","onFocusLost","onEnter","avatarDisabled","tabIndex","onFocus","onBlur","no_contacts","contacts_not_found_short","GroupManager","members","indexMembers","keepInitialMembers","requiredMember","contactFilter","noContactsMessage","selectedContacts","handleMemberRemoved","handleContactFilter","handleSubmit","m","delta","present","keepInitial","stat","sel","splice","added","onSubmit","doContactFiltering","joiner","writer","preser","approver","sharer","deleter","owner","PermissionsEditor","names","skip","compare","userTitle","userAvatar","modeTitle","compareTitle","Cropper","panX","panY","originX","originY","zoom","minZoom","maxZoom","overlay","cutout","boundingBox","imageWidth","imageHeight","mouseX","mouseY","prevDistance","cutoutRect","bBoxRect","initScaling","onZoom","handleZoom","mouseDown","mouseUp","mouseMove","mouseTouch","positionAll","translate","passive","currPan","nextDiff","imgRect","imgLeft","imgRight","coLeft","coRight","imgTop","imgBottom","coTop","coBottom","touches","dX","dY","checkBound","touch0","touch1","distance","sqrt","t3d","orig","transform","transformOrigin","onLoad","step","AvatarCrop","objURL","VisiblePassword","handleVisibility","handeTextChange","handleEditingFinished","onFinished","activeElement","autoComplete","InPlaceEdit","active","initialValue","handleStartEditing","handlePasswordFinished","focus","checkValidity","spanText","spanClass","multiline","element","rows","TagManager","tags","tagInput","activated","handleTagInput","handleAddTag","handleRemoveTag","nextProps","last","tag","maxTagCount","getServerLimit","onTagsChanged","minTagLength","maxTagLength","add_tags_prompt","TopicDescEdit","getAccessMode","isMe","fullName","description","newAvatar","newAvatarMime","previousOnTags","tnNewTags","handleFullNameUpdate","handleImageUpdated","handleAvatarCropped","handlePrivateUpdate","handleDescriptionUpdate","uploadAvatar","handleAvatarCropCancel","handleTagsUpdated","onTagsUpdated","onUpdateTopicDesc","desc","readyToUpload","uploader","getLargeFileHelper","upload","finally","du","onUpdateTags","editable","full_name_placeholder","group_name_placeholder","private_placeholder","title_tag_manager","TopicCommon","credentials","getCredentials","addCredActive","addCredInvalid","newCred","previousTagsUpdated","tnCredsUpdated","handleCredChange","handleCredKeyDown","handleCredEntered","onCredsUpdated","getType","creds","asPhone","asEmail","onCredAdd","onTopicTagsUpdateRequest","cred","meth","done","onCredConfirm","onCredDelete","delete_messages","leave_chat","leave_chat_warning","block_contact","block_contact_warning","report_chat","report_chat_warning","other_user","TopicSecurity","handleDeleteTopic","handleDeleteMessages","handleLeave","handleBlock","handleReport","onDeleteTopic","onDeleteMessages","onLeaveTopic","onBlockTopic","onReportTopic","groupTopic","onLaunchPermissionsEditor","access","anon","modeGiven2","general","security","crop","perm_want","perm_given","perm_auth","perm_anon","perm_user","InfoView","admin","muted","address","selectedContact","modeGiven","modeWant","modeWant2","contactList","previousMetaDesc","previousSubsUpdated","resetSubs","resetDesc","resetTags","onMetaDesc","onSubsUpdated","handleImageChanged","handleMuted","handleUnarchive","handlePermissionsChanged","handleLaunchPermissionsEditor","handleShowAddMembers","handleMemberUpdateRequest","handleMemberSelected","handleContextMenu","handleBackNavigate","newState","user2","subscriber","getGiven","getWant","subscribers","sub","defacs","getDefaultAccess","isAdmin","isSharer","isDeleter","archived","isArchived","isGroupType","isChannelType","chan","getMeta","startMetaQuery","withTags","build","subs","onTopicDescUpdate","ignored","onChangePermissions","ignored2","onTopicUnArchive","which","perm","onTopicDescUpdateRequest","userPermissionsEdited","toEdit","toCompare","toSkip","titleEdit","titleCompare","userPermissionsTitle","userPermissionsAvatar","editedPermissions","immutablePermissions","editedPermissionsTitle","immutablePermissionsTitle","editedPermissionsSkipped","onNavigate","onMemberUpdateRequest","panel","menuItems","view","shift","panelTitle","displayMobile","errorLevel","errorText","searchableContacts","no_members","RING_SOUND","IncomingCallView","handleRejectCall","handleAcceptCall","ringTimer","callState","setInterval","onRinging","clearInterval","onAcceptCall","onClose","CallPanel","localStream","pc","previousOnInfo","localStreamConstraints","audio","video","localRef","remoteRef","onInfo","start","createPeerConnection","handleNegotiationNeededEvent","handleICECandidateEvent","handleNewICECandidateMsg","handleICEConnectionStateChangeEvent","handleSignalingStateChangeEvent","handleICEGatheringStateChangeEvent","handleTrackEvent","handleVideoOfferMsg","handleVideoAnswerMsg","reportError","handleGetUserMediaError","stop","stopTracks","handleCloseClick","handleToggleCameraClick","handleToggleMicClick","toggleMedia","handleRemoteHangup","handleVideoCallAccepted","stream","getTracks","track","kind","readyState","addTrack","what","onInvite","mediaDevices","getUserMedia","srcObject","RTCPeerConnection","onicecandidate","oniceconnectionstatechange","onicegatheringstatechange","onsignalingstatechange","onnegotiationneeded","ontrack","RTCSessionDescription","setRemoteDescription","errMessage","createOffer","offer","setLocalDescription","onSendOffer","localDescription","toJSON","candidate","onIceCandidate","RTCIceCandidate","addIceCandidate","iceConnectionState","signalingState","streams","forceUpdate","createAnswer","answer","onSendAnswer","tracks","enabled","onremovetrack","onremovestream","onHangup","remoteActive","audioIcon","getAudioTracks","videoIcon","getVideoTracks","onHideMessagesView","autoPlay","playsInline","extendStatics","__proto__","__extends","__","__assign","t","s","arguments","apply","__spreadArray","to","pack","ar","ErrorKind","TYPE","SKELETON_TYPE","isLiteralElement","literal","isArgumentElement","argument","isNumberElement","number","isDateElement","isTimeElement","time","isSelectElement","select","isPluralElement","plural","isPoundElement","pound","isTagElement","isNumberSkeleton","isDateTimeSkeleton","dateTime","SPACE_SEPARATOR_REGEX","DATE_TIME_REGEX","parseDateTimeSkeleton","skeleton","era","year","RangeError","month","day","weekday","hour12","hourCycle","hour","minute","second","timeZoneName","FRACTION_PRECISION_REGEX","SIGNIFICANT_PRECISION_REGEX","INTEGER_WIDTH_REGEX","CONCISE_INTEGER_WIDTH_REGEX","parseSignificantPrecision","roundingPriority","g1","g2","minimumSignificantDigits","maximumSignificantDigits","parseSign","signDisplay","currencySign","parseConciseScientificAndEngineeringStem","stem","notation","minimumIntegerDigits","parseNotationOptions","opt","signOpts","parseNumberSkeleton","tokens","_i","tokens_1","currency","useGrouping","maximumFractionDigits","unit","compactDisplay","reduce","currencyDisplay","unitDisplay","parseFloat","g3","g4","g5","minimumFractionDigits","trailingZeroDisplay","conciseScientificAndEngineeringOpts","SPACE_SEPARATOR_START_REGEX","SPACE_SEPARATOR_END_REGEX","createLocation","hasNativeStartsWith","hasNativeFromCodePoint","fromCodePoint","hasNativeFromEntries","fromEntries","hasNativeCodePointAt","codePointAt","hasTrimStart","trimStart","hasTrimEnd","trimEnd","isSafeInteger","isFinite","REGEX_SUPPORTS_U_AND_Y","RE","matchIdentifierAtIndex","codePoints","elements","entries_1","v","first","IDENTIFIER_PREFIX_RE_1","lastIndex","_isWhiteSpace","_isPatternSyntax","Parser","line","column","ignoreTag","requiresOtherClause","shouldParseSkeletons","parse","parseMessage","nestingLevel","parentArgType","expectingCloseTag","isEOF","char","parseArgument","peek","UNMATCHED_CLOSING_TAG","clonePosition","_isAlpha","parseTag","parseLiteral","bump","location","startPosition","tagName","parseTagName","bumpSpace","bumpIf","childrenResult","children","endTagStartPosition","INVALID_TAG","closingTagNameStartPosition","UNCLOSED_TAG","startOffset","parseQuoteResult","tryParseQuote","parseUnquotedResult","tryParseUnquoted","parseLeftAngleResult","tryParseLeftAngleBracket","codepoint","ch","openingBracePosition","EXPECT_ARGUMENT_CLOSING_BRACE","EMPTY_ARGUMENT","parseIdentifierIfPossible","MALFORMED_ARGUMENT","parseArgumentOptions","startingPosition","endOffset","bumpTo","typeStartPosition","argType","typeEndPosition","EXPECT_ARGUMENT_TYPE","styleAndLocation","styleStartPosition","parseSimpleArgStyleIfPossible","EXPECT_ARGUMENT_STYLE","styleLocation","argCloseResult","tryParseArgumentClose","location_1","parseNumberSkeletonFromString","EXPECT_DATE_TIME_SKELETON","pattern","parsedOptions","typeEndPosition_1","EXPECT_SELECT_ARGUMENT_OPTIONS","identifierAndLocation","pluralOffset","EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE","tryParseDecimalInteger","INVALID_PLURAL_ARGUMENT_OFFSET_VALUE","optionsResult","tryParsePluralOrSelectOptions","location_2","pluralType","INVALID_ARGUMENT_TYPE","nestedBraces","apostrophePosition","bumpUntil","UNCLOSED_QUOTE_IN_ARGUMENT_STYLE","stringTokens_1","stemAndOptions","options_1","INVALID_NUMBER_SKELETON","expectCloseTag","parsedFirstIdentifier","hasOtherClause","parsedSelectors","selector","selectorLocation","EXPECT_PLURAL_ARGUMENT_SELECTOR","INVALID_PLURAL_ARGUMENT_SELECTOR","DUPLICATE_SELECT_ARGUMENT_SELECTOR","DUPLICATE_PLURAL_ARGUMENT_SELECTOR","EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT","EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT","fragmentResult","EXPECT_SELECT_ARGUMENT_SELECTOR","MISSING_OTHER_CLAUSE","expectNumberError","invalidNumberError","sign","hasDigits","decimal","prefix","currentOffset","targetOffset","nextCode","pruneLocation","els","SyntaxError","originalMessage","captureLocation","memoize","cache","cacheDefault","serializer","serializerDefault","strategy","strategyDefault","monadic","arg","cacheKey","computedValue","variadic","assemble","context","serialize","ObjectWithoutPrototypeCache","ErrorCode","strategies","PART_TYPE","FormatError","_super","_this","InvalidValueError","variableId","INVALID_VALUE","InvalidValueTypeError","MissingValueError","MISSING_VALUE","isFormatXMLElementFn","formatToParts","locales","formatters","formats","currentPluralValue","els_1","getNumberFormat","format","varName","object","getDateTimeFormat","medium","value_1","formatFn","chunks","other","Intl","PluralRules","MISSING_INTL_API","rule","getPluralRules","parts","part","lastPart","mergeLiteral","mergeConfigs","defaultConfig","configs","createFastMemoizeCache","IntlMessageFormat","overrideFormats","defaultLocale","formatterCache","pluralRules","ast","resolvedOptions","locale","NumberFormat","supportedLocalesOf","getAst","__parse","DateTimeFormat","memoizedDefaultLocale","configurable","integer","percent","long","full","_defineProperty","writable","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","INITIAL_ZERO","leftTrim","previousEmpty","DurationUnitFormat","defaultOptions","styles","LONG","isTimer","TIMER","formatUnits","formatDuration","shouldRound","units","DAY","HOUR","MINUTE","SECOND","CUSTOM","SHORT","NARROW","minutes","hours","days","buckets","valueUnit","SECONDS_IN","lowestUnit","remainder","splitSecondsInBuckets","_formatToken","_trimOutput","_formatDurationToParts","_formatValue","SPLIT_POINTS","Boolean","padStart","trimmed","trimFirstPaddedValue","minUnit","durationUnitFormat_cjs","TIMER_FORMAT","_ref","_formatUnits","textComponent","valueComponent","otherProps","actualFormat","actualSytle","Text","Value","Attachment","downloader","downloadFile","mimetype","download","loaded","helperFunc","isUrlRelative","downloadUrl","downloadWidget","message_sending","message_sending_failed","ReceivedMarker","timestamp","toLocaleTimeString","timeStyle","BaseChatMessage","onProgress","handleProgress","handleImagePreview","handleFormButtonClick","handleCancelUpload","handleQuoteClick","formatterContext","resp","act","onFormResponse","userIsWriter","ratio","replyToSeq","sideClass","sequence","bubbleClass","fullDisplay","attachments","att","tree","direction","isCallDropped","innerRef","IntlChatMessage","MILLIS_PER_BAR","AUDIO_MIME_TYPE","AudioRecorder","audioRecord","recording","paused","blobUrl","initMediaRecording","getRecording","cleanUp","handleResume","handlePause","handleDelete","handleDone","durationMillis","startedOn","mediaRecorder","audioContext","audioInput","analyser","audioChunks","pcmData","frequencyBinCount","canvasWidth","canvasHeight","viewLength","viewDuration","prevBarCount","volume","countPerBar","getByteTimeDomainData","amplitude","dx","requestData","resume","MediaRecorder","AudioContext","createMediaStreamSource","createAnalyser","fftSize","connect","onstop","onDeleted","ondataavailable","fixedBlob","arrayBuffer","arrayBuff","decodeAudioData","decoded","createPreview","getChannelData","totalSPB","samplingRate","disconnect","resumeClass","messaging_disabled","type_new_message","add_image_caption","file_attachment_too_large","cannot_initiate_upload","SendMessage","quote","audioRec","audioAvailable","keypressTimestamp","getTime","handlePasteEvent","handleAttachImage","handleAttachFile","handleAttachAudio","handleSend","handleKeyPress","handleMessageTyping","formatReply","messageEditArea","disabled","onImageSuccess","onAttachmentSuccess","clipboardData","originalEvent","getAsFile","filePasted","onAttachImage","onAttachFile","onAttachAudio","acceptBlank","noInput","onSendMessage","shiftKey","onKeyPress","messagePrompt","onCancelReply","audioEnabled","attachImage","click","attachFile","display","DocPreview","handleSendDoc","caption","mimeToIcon","iconFromMime","GroupSubs","usersOnline","totalCount","countToShow","overflow","ImagePreview","handleSendImage","assignWidth","node","maxlength","Invitation","handleButtonAction","LogoView","serverVersion","serverAddress","MetaMessage","HashNavigation","path","decodeURIComponent","parsed","parseUrlHash","composeUrlHash","sidepanel","infopanel","online_now","last_seen","not_found","invalid_content","isUnconfirmed","getExcessive","isPeerRestricted","getMissing","shouldPresentCallPanel","MessagesView","getDerivedStateFromProps","leave","sendMessage","retrySend","sendImageAttachment","sendFileAttachment","sendAudioAttachment","sendKeyPress","handleScrollReference","handleScrollEvent","handleDescChange","handleSubsUpdated","handleMessageUpdate","handleAllMessagesReceived","handleInfoReceipt","handleImagePostview","handleClosePreview","handleFormResponse","handleShowMessageContextMenu","handleNewChatAcceptance","handleEnablePeer","postReadNotification","clearNotificationQueue","goToLatestMessage","handlePickReply","handleCancelReply","handleCallHangup","chatMessageRefs","getOrCreateMessageRef","readNotificationQueue","readNotificationTimer","seqId","messagesScroller","messageCount","scrollPosition","scrollTop","scrollHeight","rtcPanel","callSeq","onData","onAllMessagesReceived","onPres","applicationVisible","ready","_new","isP2PType","withDesc","nextState","forwardMessage","docPreview","imagePreview","imagePostview","typingIndicator","fetchingMessages","showGoToLastButton","onlineSubs","peer","p2pPeerDesc","peerMessagingDisabled","latestClearId","maxClearId","callTopic","isReader","readingBlocked","unconformed","unconfirmed","isSubscribed","newTopic","newTopicParams","_topicName","getQuery","withLaterDesc","withLaterSub","withLaterData","withLaterDel","setQuery","onNewTopicCreated","queuedMessages","pub","_sending","navigateTo","setUrlTopic","blankState","oldTopicName","isTopicCached","oldTopic","msgHasMoreMessages","getMessagesPage","sendAt","noteRead","setMilliseconds","getMilliseconds","clearTimeout","keyPressTimer","isNewMessage","searchParams","messageSpecificMenuItems","onNewChat","noteKeyPress","uploadCompletionPromise","maxInbandAttachmentSize","urlPromise","fileToBase64","maxExternAttachmentSize","limit","onVideoCallClosed","onCallHangup","_tempPreview","found","findMessage","_cancelled","senderName","onCancelForwardMessage","scrollIntoView","behavior","classList","hideSelf","component2","onCallInvite","onCallSendOffer","onCallIceCandidate","onCallSendAnswer","messageNodes","previousFrom","prevDate","chatBoxClass","dateFmt","prev","nextFrom","thisFrom","isReply","userDesc","isNaN","thisDate","ts","toDateString","origTs","isChan","_uploader","lastSeen","cont","getMeTopic","getContact","seen","userLanguage","language","getFullYear","getMonth","getDate","toLocaleDateString","shortDateFormat","when","ButtonBack","onBack","MenuContacts","onNewTopic","onSettings","MenuStart","onSignUp","SideNavbar","_clip","AccountSettingsView","me","archived_contacts_title","ContactsView","handleAction","unreadThreads","archivedCount","chatList","blocked","arch","touched","action_ignored","onShowArchive","LocalStorageUtil","localStorage","setItem","getItem","oldVal","getObject","setObject","removeItem","CreateAccountView","login","password","email","imageDataUrl","errorCleared","saveToken","handleLoginChange","handlePasswordChange","handleEmailChange","handleFnChange","handleToggleSaveToken","onCreateAccount","submitClasses","login_prompt","password_prompt","onImageChanged","full_name_prompt","email_prompt","stay_logged_in","EditAccountView","handleCheckboxClick","onToggleMessageSounds","onTogglePushNotifications","onToggleIncognitoMode","messageSounds","desktopAlertsEnabled","desktopAlerts","incognitoMode","delete_account","delete_account_warning","AccSecurityView","blockedCount","showPermissionEditorFor","handlePasswordUpdate","handleHidePermissionsEditor","handleDeleteAccount","pwd","onUpdatePassword","onUpdateAccountDesc","onDeleteAccount","password_unchanged","onLogout","onShowBlocked","AccSupportView","LoginView","hostName","persist","onPersistenceChange","onLogin","autoCorrect","autoCapitalize","invalid_id","NewTopicById","groupId","NewTopicGroup","handleFieldEdit","handleTagsChanged","handleChannelToggle","search_for_contacts","search_no_results","NewTopicView","tabSelected","searchQuery","handleTabClick","handleSearchResultSelected","handleNewGroupSubmit","handleGroupByID","addUrlParam","removeUrlParam","onCreateTopic","dataUrl","priv","no_contacts_placeholder","PasswordResetView","sent","scheme","onReset","onRequest","HostSelector","changed","handleHostNameChange","onServerAddressChange","hostOptions","list","SettingsView","transport","handleTransportSelected","handleServerAddressChange","onUpdate","def","ws","lp","transportOptions","phone","ValidationView","credCode","credMethod","numbers_only","settings","edit","notif","support","newtpk","reset","SidepanelView","handleNewTopic","errorAction","errorActionText","loadSpinnerVisible","loginDisabled","onLoginRequest","onGlobalSettings","onUpdateAccountTags","onValidateCredentials","onPasswordResetRequest","onResetPassword","detectServerAddress","host","protocol","hostname","port","isSecureConnection","POP_SOUND","reconnect_countdown","reconnect_now","push_init_failed","invalid_security_token","no_connection","code_doesnot_match","menu_item_info","menu_item_video_call","TinodeWeb","getBlankState","handleResize","handleHashRoute","handleOnline","checkForAppUpdate","handleVisibilityEvent","handleLoginRequest","handlePersistenceChange","handleConnected","handleAutoreconnectIteration","doLogin","handleCredentialsRequest","handleLoginSuccessful","handleDisconnect","tnMeMetaDesc","tnMeContactUpdate","tnMeSubsUpdated","resetContactList","tnData","tnInitFind","tnFndSubsUpdated","handleTopicSelected","handleHideMessagesView","handleSendMessage","handleNewChatInvitation","handleNewAccount","handleNewAccountRequest","handleUpdatePasswordRequest","handleUpdateAccountTagsRequest","handleToggleIncognitoMode","handleSettings","handleGlobalSettings","handleShowArchive","handleShowBlocked","handleToggleMessageSounds","handleCredAdd","handleCredDelete","handleCredConfirm","initFCMessaging","toggleFCMToken","handlePushMessage","handleSidepanelCancel","handleStartTopicRequest","handleNewTopicCreated","handleTopicUpdateRequest","handleChangePermissions","handleTagsUpdateRequest","handleLogout","handleDeleteTopicRequest","handleDeleteMessagesRequest","handleLeaveUnsubRequest","handleBlockTopicRequest","handleReportTopic","handleShowContextMenu","defaultTopicContextMenu","handleHideContextMenu","handleShowAlert","handleShowInfoView","handleValidateCredentialsRequest","handlePasswordResetRequest","handleResetPassword","handleContextMenuAction","handleShowForwardDialog","handleHideForwardDialog","handleStartVideoCall","handleInfoMessage","handleCallClose","handleCallInvite","handleCallRinging","handleCallSendOffer","handleCallIceCandidate","handleCallSendAnswer","handleCallAcceptCall","sendMessageToTopic","autoLogin","messageSoundsOff","FIREBASE_INIT","firebaseToken","hidden","sidePanelSelected","sidePanelTitle","sidePanelAvatar","myTrustedBadges","liveConnection","topicSelectedOnline","topicSelectedAcs","innerWidth","infoPanel","mobilePanel","callShouldStart","contextMenuVisible","contextMenuBounds","contextMenuClickAt","contextMenuParams","contextMenuItems","forwardDialogVisible","alertVisible","alertParams","requestedTopic","documentElement","clientWidth","viewportHeight","clientHeight","tnSetup","onConnect","onDisconnect","onAutoreconnectIteration","onInfoMessage","setDeviceToken","parsedNav","expires","setAuthToken","readTimer","readTimerCallback","persistentCache","onSetupCompleted","secure","setHumanLanguage","enableLogging","oobNotification","updateObject","fcm","firebaseGetMessaging","firebaseInitApp","reg","requestFCMToken","firebaseOnMessage","sw","firebaseGetToken","messagingVapidKey","mobile","onupdatefound","installingWorker","installing","onstatechange","controller","getTopicAccessMode","newTopicTabSelected","tab","reconnectCountdown","reconnect","isConnected","initStorage","clearStorage","getServerInfo","ver","prom","timeLeft","isAuthenticated","getAuthToken","loginBasic","loginToken","goToTopic","onContactUpdate","getCurrentUserID","withCred","urlHash","setUrlSidePanel","isPresencer","unused","foundContacts","merged","updated","past","prepareSearchableContacts","receivedTimer","noteRecv","fnd","getFndTopic","withSub","setMeta","isTopicOnline","completion","subscribePromise","publishMessage","am","updateWant","login_","password_","public_","cred_","tags_","createAccountBasic","on","firebaseDelToken","delCredential","basicNavigator","infoNavigator","setUrlInfoPanel","newGroupTopicName","oldName","newName","updateAccountBasic","getCurrentLogin","updateGiven","cleared","Promose","delCurrentUser","report","header","msgPreview","self_blocked","subscribed","keepForwardedMessage","confirmText","rejectText","invite","requestResetAuthSecret","newPassword","base64ReEncode","sdp","callTimeout","myUserName","onAddMember","handleManageGroupMembers","hl","languages","baseLanguage","htmlLang","allMessages","setAttribute","IntlProvider"],"sourceRoot":""}